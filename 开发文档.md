# 1、增加数据大屏中明细表和汇总表的下载Excel带格式的功能

首先通过查看页面，发现在数据大屏的透视表中本身是支持“导出Excel(带格式)”的功能的。

## 1. “查看数据”按钮的实现

- 透视图（如“UserView”组件）在预览或编辑时，右上角会有一个“查看数据”按钮。

- 这个按钮实际上是 ComponentEditBar.vue 组件中的一项，点击后会触发 userViewEnlargeOpen($event, 'details') 事件。

- 事件会通过 ComponentWrapper.vue 组件的 @userViewEnlargeOpen 向上传递，最终调用 UserViewEnlarge.vue 组件的 dialogInit 方法，弹出“查看数据”弹窗。

------

## 2. “查看数据”弹窗的实现

- 弹窗组件为 UserViewEnlarge.vue，以 <el-dialog> 形式展示。

- 弹窗内会根据 optType 为 details，渲染表格数据（透视表），并在顶部渲染导出按钮。

------

## 3. 三个下载链接的实现

- 在 UserViewEnlarge.vue 头部，optType 为 details 时，会显示如下按钮：

- “导出Excel” —— @click="downloadViewDetails('view')"

- “导出原始明细” —— @click="downloadViewDetails('dataset')"

- “导出Excel(带格式)”（仅透视表类型）—— @click="exportAsFormattedExcel"

- 相关方法：

- downloadViewDetails(type)：调用 exportExcelDownload 方法，下载普通 Excel 或原始明细。

- exportAsFormattedExcel()：调用 exportPivotExcel 方法，下载带格式的 Excel（透视表专用）。

- 这些方法最终会调用后端接口或前端导出逻辑，将数据以 Excel 文件下载到本地。

------

## 4. 相关主要文件

- core/core-frontend/src/components/visualization/ComponentEditBar.vue（右上角操作栏）

- core/core-frontend/src/components/visualization/UserViewEnlarge.vue（弹窗及导出按钮）

- core/core-frontend/src/views/chart/components/js/util.ts、common_table.ts（导出实现）

------

### 总结

你看到的“查看数据”弹窗和三个下载链接，正是通过上述组件和方法实现的。

如需定制导出逻辑、按钮权限、样式或其它行为，可以直接在 UserViewEnlarge.vue 里修改。

如需进一步分析某个导出类型的实现细节或想自定义行为，请告知！
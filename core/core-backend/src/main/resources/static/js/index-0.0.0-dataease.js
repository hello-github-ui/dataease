import{u as P,a as E,b as q,s as D,c as L,d as O}from"../assets/chunk/index-0.0.0-dataease.js";import{d as U,r as B,ah as $,o as S,Z as v,_ as j,u as F,a0 as M,au as N}from"../assets/chunk/@vue-0.0.0-dataease.js";/* empty css                                          */import"../assets/chunk/@antv-0.0.0-dataease.js";import{_ as Q,u as T,a as V,r as b,c as z,i as J,b as Z,d as G,p as _,g as y,s as H,e as K}from"../assets/chunk/ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{u as X}from"../assets/chunk/vue-router-0.0.0-dataease.js";import{_ as Y}from"../assets/chunk/ExportExcel.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{u as tt,a as et,s as rt}from"../assets/chunk/usePageLoading-0.0.0-dataease.js";import{installDirective as it}from"../assets/chunk/index-0.0.0-dataease2.js";import{useAppStoreWithOut as ot}from"../assets/chunk/app-0.0.0-dataease.js";import{getDefaultSettings as at,getRoleRouters as pt}from"../assets/chunk/common-0.0.0-dataease.js";import{i as st}from"../assets/chunk/interactive-0.0.0-dataease.js";import{useAppearanceStoreWithOut as nt}from"../assets/chunk/appearance-0.0.0-dataease.js";import{S as mt}from"../assets/chunk/sockjs-client-0.0.0-dataease.js";import{S as ct}from"../assets/chunk/stompjs-0.0.0-dataease.js";import"../assets/chunk/mitt-0.0.0-dataease.js";import"../assets/chunk/web-storage-cache-0.0.0-dataease.js";import"../assets/chunk/@amap-0.0.0-dataease.js";import"../assets/chunk/vue-types-0.0.0-dataease.js";import"../assets/chunk/is-plain-object-0.0.0-dataease.js";import"../assets/chunk/pinia-0.0.0-dataease.js";import"../assets/chunk/vue-demi-0.0.0-dataease.js";import"../assets/chunk/element-plus-secondary-0.0.0-dataease.js";import"../assets/chunk/@vueuse-0.0.0-dataease.js";import"../assets/chunk/@element-plus-0.0.0-dataease.js";import"../assets/chunk/lodash-es-0.0.0-dataease.js";import"../assets/chunk/dayjs-0.0.0-dataease.js";import"../assets/chunk/async-validator-0.0.0-dataease.js";import"../assets/chunk/@ctrl-0.0.0-dataease.js";import"../assets/chunk/@popperjs-0.0.0-dataease.js";import"../assets/chunk/escape-html-0.0.0-dataease.js";import"../assets/chunk/normalize-wheel-es-0.0.0-dataease.js";import"../assets/chunk/memoize-one-0.0.0-dataease.js";import"../assets/chunk/eventemitter3-0.0.0-dataease.js";import"../assets/chunk/lodash-0.0.0-dataease.js";import"../assets/chunk/@mapbox-0.0.0-dataease.js";import"../assets/chunk/pbf-0.0.0-dataease.js";import"../assets/chunk/ieee754-0.0.0-dataease.js";import"../assets/chunk/supercluster-0.0.0-dataease.js";import"../assets/chunk/@babel-0.0.0-dataease.js";import"../assets/chunk/gl-matrix-0.0.0-dataease.js";import"../assets/chunk/tslib-0.0.0-dataease.js";import"../assets/chunk/topojson-client-0.0.0-dataease.js";import"../assets/chunk/viewport-mercator-project-0.0.0-dataease.js";import"../assets/chunk/@turf-0.0.0-dataease.js";import"../assets/chunk/polygon-clipping-0.0.0-dataease.js";import"../assets/chunk/splaytree-0.0.0-dataease.js";import"../assets/chunk/robust-predicates-0.0.0-dataease.js";import"../assets/chunk/d3-scale-0.0.0-dataease.js";import"../assets/chunk/d3-collection-0.0.0-dataease.js";import"../assets/chunk/d3-format-0.0.0-dataease.js";import"../assets/chunk/d3-time-format-0.0.0-dataease.js";import"../assets/chunk/d3-time-0.0.0-dataease.js";import"../assets/chunk/d3-color-0.0.0-dataease.js";import"../assets/chunk/d3-array-0.0.0-dataease.js";import"../assets/chunk/earcut-0.0.0-dataease.js";import"../assets/chunk/regl-0.0.0-dataease.js";import"../assets/chunk/mapbox-gl-0.0.0-dataease.js";import"../assets/chunk/d3-dsv-0.0.0-dataease.js";import"../assets/chunk/geojson-vt-0.0.0-dataease.js";import"../assets/chunk/hammerjs-0.0.0-dataease.js";import"../assets/chunk/element-resize-detector-0.0.0-dataease.js";import"../assets/chunk/batch-processor-0.0.0-dataease.js";import"../assets/chunk/d3-hexbin-0.0.0-dataease.js";import"../assets/chunk/detect-browser-0.0.0-dataease.js";import"../assets/chunk/d3-ease-0.0.0-dataease.js";import"../assets/chunk/d3-interpolate-0.0.0-dataease.js";import"../assets/chunk/d3-timer-0.0.0-dataease.js";import"../assets/chunk/fecha-0.0.0-dataease.js";import"../assets/chunk/size-sensor-0.0.0-dataease.js";import"../assets/chunk/d3-regression-0.0.0-dataease.js";import"../assets/chunk/d3-hierarchy-0.0.0-dataease.js";import"../assets/chunk/fmin-0.0.0-dataease.js";import"../assets/chunk/pdfast-0.0.0-dataease.js";import"../assets/chunk/jspdf-0.0.0-dataease.js";import"../assets/chunk/fflate-0.0.0-dataease.js";import"../assets/chunk/vue-i18n-0.0.0-dataease.js";import"../assets/chunk/@intlify-0.0.0-dataease.js";import"../assets/chunk/axios-0.0.0-dataease.js";import"../assets/chunk/qs-0.0.0-dataease.js";import"../assets/chunk/side-channel-0.0.0-dataease.js";import"../assets/chunk/es-errors-0.0.0-dataease.js";import"../assets/chunk/object-inspect-0.0.0-dataease.js";import"../assets/chunk/crypto-js-0.0.0-dataease.js";import"../assets/chunk/side-channel-list-0.0.0-dataease.js";import"../assets/chunk/side-channel-map-0.0.0-dataease.js";import"../assets/chunk/get-intrinsic-0.0.0-dataease.js";import"../assets/chunk/es-object-atoms-0.0.0-dataease.js";import"../assets/chunk/math-intrinsics-0.0.0-dataease.js";import"../assets/chunk/gopd-0.0.0-dataease.js";import"../assets/chunk/es-define-property-0.0.0-dataease.js";import"../assets/chunk/has-symbols-0.0.0-dataease.js";import"../assets/chunk/get-proto-0.0.0-dataease.js";import"../assets/chunk/dunder-proto-0.0.0-dataease.js";import"../assets/chunk/call-bind-apply-helpers-0.0.0-dataease.js";import"../assets/chunk/function-bind-0.0.0-dataease.js";import"../assets/chunk/hasown-0.0.0-dataease.js";import"../assets/chunk/call-bound-0.0.0-dataease.js";import"../assets/chunk/side-channel-weakmap-0.0.0-dataease.js";import"../assets/chunk/vue-0.0.0-dataease.js";import"../assets/chunk/echarts-0.0.0-dataease.js";import"../assets/chunk/zrender-0.0.0-dataease.js";import"../assets/chunk/tinymce-0.0.0-dataease.js";import"../assets/chunk/icon_download_outlined-0.0.0-dataease.js";import"../assets/chunk/de-delete-0.0.0-dataease.js";import"../assets/chunk/icon_refresh_outlined-0.0.0-dataease.js";import"../assets/chunk/EmptyBackground-0.0.0-dataease.js";import"../assets/chunk/none-0.0.0-dataease.js";import"../assets/chunk/nothing-tree-0.0.0-dataease.js";import"../assets/chunk/_plugin-vue_export-helper-0.0.0-dataease.js";import"../assets/chunk/dataset-0.0.0-dataease.js";import"../assets/chunk/nprogress-0.0.0-dataease.js";import"../assets/chunk/dataVisualization-0.0.0-dataease.js";import"../assets/chunk/datasource-0.0.0-dataease.js";import"../assets/chunk/font-0.0.0-dataease.js";import"../assets/chunk/less-0.0.0-dataease.js";import"../assets/chunk/copy-anything-0.0.0-dataease.js";import"../assets/chunk/is-what-0.0.0-dataease.js";import"../assets/chunk/net-0.0.0-dataease.js";import"../assets/chunk/websocket-0.0.0-dataease.js";import"../assets/chunk/es5-ext-0.0.0-dataease.js";const ut=U({__name:"App",setup(t){const n=X(),i=B();return P({name:"data-export-center",callback:a=>{i.value.init(a)}}),(a,o)=>{const e=$("router-view");return S(),v(Q,null,{default:j(()=>[(S(),v(e,{key:F(n).path})),M(Y,{ref_key:"exportExcelRef",ref:i},null,512)]),_:1})}}}),g=nt(),{wsCache:l}=E(),m=T(),dt=st(),C=V(),k=ot(),{start:lt,done:R}=tt(),{loadStart:ft,loadDone:W}=et(),ht=["/login","/de-link","/chart-view","/admin-login","/401"],wt=["/dvCanvas","/dashboard","/preview","/dataset-embedded-form"],gt=["/dataset-embedded","/dataset-form","/dataset-embedded-form"];b.beforeEach(async(t,n,i)=>{lt(),ft();const h=z();let a=l.get("app.desktop");if(a===null&&(await k.setAppModel(),a=k.getDesktop),J()&&!["/chart-view"].includes(t.path)){if(R(),W(),t.name==="link"){let e="";if(Object.keys(t.query)){const p=Object.keys(t.query).map(c=>c+"="+t.query[c]).join("&");p&&(e="?"+p)}window.location.href=window.origin+"/mobile.html#"+t.path+e}else if(l.get("user.token")||a||!Z()&&!G()){let e=window.location.pathname;e=e.substring(0,e.length-1);let p=window.origin+e+"/mobile.html#/index";window.location.search&&(p+=window.location.search),window.location.href=p}}await g.setAppearance(),await g.setFontList();const o=await at();if(l.set("TreeSort-backend",o["basic.defaultSort"]??"1"),l.set("open-backend",o["basic.defaultOpen"]??"0"),(l.get("user.token")||a)&&!t.path.startsWith("/de-link/"))if(C.getUid||await C.setUser(),t.path==="/login")i({path:"/workbranch/index"});else{if(m.setCurrentPath(t.path),m.getIsAddRouters){let r="";if((n.query.redirect||"?").split("?")[0]===t.path&&(r=(window.location.hash||"?").split("?").reverse()[0],r.includes("redirect=")&&(r="")),r&&(t.fullPath+="?"+r,t.query=r.split("&").reduce((w,A)=>{const[I,x]=A.split("=");return w[I]=x,w},{})),!_(t.path)&&t.path!=="/404"&&!t.path.startsWith("/de-link")){const w=y();i({path:w||"/404"});return}i();return}let e=await pt()||[];a&&(e=e.filter(r=>r.name!=="system"));const p=e;p.forEach(r=>r.top=!0),await m.generateRoutes(p),m.getAddRouters.forEach(r=>{b.addRoute(r)});const c=n.query.redirect||t.path,d=decodeURIComponent(c),u=t.path===d?{...t,replace:!0}:{path:d};if(m.setIsAddRouters(!0),await dt.initInteractive(!0),!_(t.path)&&t.path!=="/404"&&!t.path.startsWith("/de-link")){const r=y();i({path:r||"/404"});return}i(u)}else if(q().getToken&&k.getIsIframe&&gt.includes(t.path)){if(t.path.includes("/dataset-form")){i({path:"/dataset-embedded-form",query:t.query});return}m.setCurrentPath(t.path),i()}else!h&&wt.includes(t.path)||ht.includes(t.path)||t.path.startsWith("/de-link/")?(await g.setFontList(),m.setCurrentPath(t.path),i()):i(`/login?redirect=${t.fullPath||t.path}`)});b.afterEach(()=>{R(),W()});const{wsCache:f}=E();let s;const kt={install(){const t=[{topic:"/task-export-topic",event:"task-export-topic-call"},{topic:"/report-notice",event:"report-notice-call"}];function n(){return f.get("app.desktop")?!0:f.get("user.token")&&f.get("user.uid")}function i(){var d;if(!n()||s&&s.connected)return;let o="/";(d=window.DataEaseBi)!=null&&d.baseUrl?o=window.DataEaseBi.baseUrl:o=location.origin+location.pathname,o.endsWith("/")||(o+="/");const e=f.get("app.desktop")?1:f.get("user.uid"),p=new mt(o+"websocket?userId="+e);s=ct.over(p);const c={userId:e};s.connect(c,()=>{t.forEach(u=>{s.subscribe("/user/"+e+u.topic,r=>{r&&r.body&&P().emitter.emit(u.event,r.body)})})},u=>{console.error("连接失败: "+u)})}function h(){s&&s.connected&&s.disconnect(function(){console.info("断开连接")},function(o){console.info("断开连接失败: "+o)})}function a(){i(),setInterval(()=>{if(!n()){h();return}(!s||!s.connected)&&i()},5e3)}a()}},bt=async()=>{const t=N(ut);it(t),D(t),await H(t),K(t),L(t),rt(t),O(t),t.use(kt),t.mount("#app")};bt();

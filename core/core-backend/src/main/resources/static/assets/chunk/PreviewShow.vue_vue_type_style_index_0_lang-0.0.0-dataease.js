import{l as we,n as fe,p as me,h as _e,d as he}from"./element-plus-secondary-0.0.0-dataease.js";import{d as ye,k as d,r as l,l as ke,b as Se,R as Pe,ah as j,ak as ge,o,c as k,a as Ce,Z as c,a3 as x,u as n,Y as s,a0 as p,_ as w,z as B,W as G,M as H,n as E,X as De,a4 as Ie,a2 as K}from"./@vue-0.0.0-dataease.js";import{i as Ae}from"./icon_add_outlined-0.0.0-dataease.js";import xe from"./DeResourceTree-0.0.0-dataease.js";import{d as Be}from"./dvMain-0.0.0-dataease.js";import U from"./DeResourceArrow-0.0.0-dataease.js";import{_ as Ee}from"./PreviewHead.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{E as X}from"./EmptyBackground-0.0.0-dataease.js";import{s as Ve}from"./pinia-0.0.0-dataease.js";import{useAppStoreWithOut as Re}from"./app-0.0.0-dataease.js";import{P as Te,i as Me,o as Ne}from"./canvasUtils-0.0.0-dataease.js";import{a as be,u as Oe,j as ze,h as Le}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{u as qe}from"./useMoveLine-0.0.0-dataease.js";import{a as Fe,c as We}from"./imgUtils-0.0.0-dataease.js";import{M as $e}from"./MultiplexPreviewShow-0.0.0-dataease.js";import{_ as je}from"./DvPreview.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{A as Ge}from"./AppExportForm-0.0.0-dataease.js";import{u as He}from"./index-0.0.0-dataease.js";const Ke={class:"dv-preview"},Ue={key:1,class:"content multiplexing-content"},wa=ye({__name:"PreviewShow",props:{showPosition:{required:!1,type:String,default:"preview"},noClose:{required:!1,type:Boolean,default:!1}},setup(i,{expose:Y}){const Z=be(),J=d(()=>Z.getName),{t:h}=ze(),S=Be(),{dvInfo:Q,canvasViewDataInfo:V}=Ve(S),P=l(null),R=l(null),y=l(!0);Oe();const f=l(!0),m=l(!1),{width:g,node:ee}=qe("DASHBOARD"),T=l(null),C=i,_=l(),M=d(()=>{var e;return(e=_.value)==null?void 0:e.hasData}),N=d(()=>{var e;return(e=_.value)==null?void 0:e.mounted}),ae=d(()=>{var e;return(e=_.value)==null?void 0:e.rootManage}),D=Re(),oe=d(()=>D.getIsDataEaseBi);function te(){var e;(e=_.value)==null||e.createNewObject()}const b=(e,r,t)=>{const q=C.showPosition==="multiplexing"?Te:Me;f.value=!1,q(e,"dataV",function({canvasDataResult:F,canvasStyleResult:W,dvInfo:u,canvasViewInfoPreview:I,curPreviewGap:A}){u.weight=r,u.ext=t||0,a.canvasDataPreview=F,a.canvasStylePreview=W,a.canvasViewInfoPreview=I,a.dvInfo=u,a.curPreviewGap=A,f.value=!0,C.showPosition==="preview"&&(S.updateCurDvInfo(u),E(()=>{var $;($=R.value)==null||$.restore()})),E(()=>{Ne({resourceId:e})})})},O=e=>{m.value=!0,setTimeout(()=>{const r=P.value.querySelector(".canvas-container");Fe(e,r,a.dvInfo.name,()=>{m.value=!1})},200)},z=(e,r)=>{m.value=!0,E(()=>{const t=P.value.querySelector(".canvas-container");We(e,t,a.dvInfo.name,r,()=>{m.value=!1})})},ne=e=>{e==="template"?z(e,null):e==="app"&&se()},se=()=>{const e=ie();e&&e.length>0?me.warning(`当前仪表板中[${e}]属于模版图表，无法导出，请先设置数据集！`):T.value.init({appName:a.dvInfo.name,icon:null,version:"2.0",creator:J.value,required:"2.9.0",description:null})},ie=()=>{let e=",";return Object.keys(V.value).forEach(r=>{const t=V.value[r];t&&(t==null?void 0:t.dataFrom)==="template"&&(e=e+t.title+",")}),e.slice(1)},Xe=()=>{y.value=!y.value},re=e=>{b(e,a.dvInfo.weight,a.dvInfo.ext)},le=e=>{b(e.id,e.weight,e.ext)},ce=d(()=>{var e;return((e=a.canvasStylePreview)==null?void 0:e.screenAdaptor)==="keep"}),a=ke({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,curPreviewGap:0}),v=l(!0),L=e=>{v.value=e},ve=()=>{D.setArrowSide(!0)},ue=()=>{D.setArrowSide(!1)},de=()=>a,pe=e=>{z("app",e)};return Se(()=>{He({name:"canvasDownload",callback:function(){O("img")}})}),Y({getPreviewStateInfo:de}),Pe(()=>{C.showPosition==="preview"&&S.canvasDataInit()}),(e,r)=>{const t=we,q=j("ArrowLeft"),F=he,W=j("ArrowRight"),u=_e,I=fe,A=ge("loading");return o(),k(H,null,[Ce("div",Ke,[i.noClose?s("",!0):(o(),c(U,{key:0,style:x({left:(v.value?n(g)-12:0)+"px"}),onChangeSideTreeStatus:L,isInside:!v.value},null,8,["style","isInside"])),p(t,{class:B(["resource-area",{"close-side":!y.value,retract:!v.value}]),onMouseenter:ve,onMouseleave:ue,ref_key:"node",ref:ee,style:x({width:n(g)+"px"})},{default:w(()=>[i.noClose?s("",!0):(o(),c(U,{key:0,isInside:!v.value,style:x({left:(v.value?n(g)-12:0)+"px"}),onChangeSideTreeStatus:L},null,8,["isInside","style"])),G(p(xe,{ref_key:"resourceTreeRef",ref:_,"cur-canvas-type":"dataV","show-position":i.showPosition,onNodeClick:le},null,8,["show-position"]),[[De,y.value]])]),_:1},8,["class","style"]),G((o(),c(I,{class:B(["preview-area",{"no-data":!M.value}])},{default:w(()=>[s("",!0),n(Q).name?(o(),k(H,{key:1},[i.showPosition==="preview"?(o(),c(Ee,{key:0,onReload:re,onDownload:O,onDownloadAsAppTemplate:ne})):s("",!0),i.showPosition==="multiplexing"&&f.value?(o(),k("div",Ue,[p($e,{"component-data":a.canvasDataPreview,"canvas-style-data":a.canvasStylePreview,"canvas-view-info":a.canvasViewInfoPreview,"dv-info":a.dvInfo},null,8,["component-data","canvas-style-data","canvas-view-info","dv-info"])])):s("",!0),i.showPosition==="preview"?(o(),k("div",{key:2,class:B([{"canvas_keep-size":ce.value},"content"]),ref_key:"previewCanvasContainer",ref:P},[a.canvasStylePreview&&f.value?(o(),c(je,{key:0,ref_key:"dvPreviewRef",ref:R,"show-position":i.showPosition,"canvas-data-preview":a.canvasDataPreview,"canvas-style-preview":a.canvasStylePreview,"canvas-view-info-preview":a.canvasViewInfoPreview,"dv-info":a.dvInfo,"cur-preview-gap":a.curPreviewGap,"download-status":m.value},null,8,["show-position","canvas-data-preview","canvas-style-preview","canvas-view-info-preview","dv-info","cur-preview-gap","download-status"])):s("",!0)],2)):s("",!0)],64)):M.value&&N.value?(o(),c(X,{key:2,description:n(h)("visualization.select_screen_tips"),"img-type":"select"},null,8,["description"])):N.value?(o(),c(X,{key:3,description:n(h)("visualization.no_screen"),"img-type":"none"},{default:w(()=>[ae.value&&!oe.value?(o(),c(u,{key:0,onClick:te,type:"primary"},{icon:w(()=>[p(n(Le),{name:"icon_add_outlined"},{default:w(()=>[p(n(Ae),{class:"svg-icon"})]),_:1})]),default:w(()=>[Ie(" "+K(n(h)("commons.create"))+K(n(h)("work_branch.big_data_screen")),1)]),_:1})):s("",!0)]),_:1},8,["description"])):s("",!0)]),_:1},8,["class"])),[[A,!f.value]])]),p(Ge,{ref_key:"appExportFormRef",ref:T,"dv-info":a.dvInfo,"component-data":a.canvasDataPreview,"canvas-view-info":a.canvasViewInfoPreview,onDownLoadApp:pe},null,8,["dv-info","component-data","canvas-view-info"])],64)}}});export{wa as _};

import{u as we}from"./index-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import"./el-aside-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import{a as fe,u as me,o as _e,n as he,D as ye,y as ke,j as Se}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as Pe,G as d,ah as ge,r as l,Z as De,o as Ce,ak as Ie,e as G,aa as Ae,f as o,L as k,M as xe,g as c,V as x,j as n,a0 as s,k as p,i as w,U as B,T as $,Y as U,n as V,W as Be,a5 as Ve,a6 as H}from"./vue-0.0.0-dataease.js";import{i as Ee}from"./icon_add_outlined-0.0.0-dataease.js";import Te from"./DeResourceTree-0.0.0-dataease.js";import{d as Me}from"./dvMain-0.0.0-dataease.js";import K from"./DeResourceArrow-0.0.0-dataease.js";import{_ as Ne}from"./PreviewHead.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{E as Y}from"./EmptyBackground-0.0.0-dataease.js";import{useAppStoreWithOut as Re}from"./app-0.0.0-dataease.js";import{P as Oe,i as be,o as Le}from"./canvasUtils-0.0.0-dataease.js";import{u as ze}from"./useMoveLine-0.0.0-dataease.js";import{a as qe,c as Fe}from"./imgUtils-0.0.0-dataease.js";import{M as We}from"./MultiplexPreviewShow-0.0.0-dataease.js";import{_ as je}from"./DvPreview.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{A as Ge}from"./AppExportForm-0.0.0-dataease.js";import{a as $e,c as Ue}from"./index-0.0.0-dataease14.js";const He={class:"dv-preview"},Ke={key:1,class:"content multiplexing-content"},ma=Pe({__name:"PreviewShow",props:{showPosition:{required:!1,type:String,default:"preview"},noClose:{required:!1,type:Boolean,default:!1}},setup(i,{expose:Z}){const J=fe(),Q=d(()=>J.getName),{t:h}=_e(),S=Me(),{dvInfo:X,canvasViewDataInfo:E}=ge(S),P=l(null),T=l(null),y=l(!0);me();const f=l(!0),m=l(!1),{width:g,node:ee}=ze("DASHBOARD"),M=l(null),D=i,_=l(),N=d(()=>{var e;return(e=_.value)==null?void 0:e.hasData}),R=d(()=>{var e;return(e=_.value)==null?void 0:e.mounted}),ae=d(()=>{var e;return(e=_.value)==null?void 0:e.rootManage}),C=Re(),oe=d(()=>C.getIsDataEaseBi);function te(){var e;(e=_.value)==null||e.createNewObject()}const O=(e,r,t)=>{const q=D.showPosition==="multiplexing"?Oe:be;f.value=!1,q(e,"dataV",function({canvasDataResult:F,canvasStyleResult:W,dvInfo:u,canvasViewInfoPreview:I,curPreviewGap:A}){u.weight=r,u.ext=t||0,a.canvasDataPreview=F,a.canvasStylePreview=W,a.canvasViewInfoPreview=I,a.dvInfo=u,a.curPreviewGap=A,f.value=!0,D.showPosition==="preview"&&(S.updateCurDvInfo(u),V(()=>{var j;(j=T.value)==null||j.restore()})),V(()=>{Le({resourceId:e})})})},b=e=>{m.value=!0,setTimeout(()=>{const r=P.value.querySelector(".canvas-container");qe(e,r,a.dvInfo.name,()=>{m.value=!1})},200)},L=(e,r)=>{m.value=!0,V(()=>{const t=P.value.querySelector(".canvas-container");Fe(e,t,a.dvInfo.name,r,()=>{m.value=!1})})},ne=e=>{e==="template"?L(e,null):e==="app"&&se()},se=()=>{const e=ie();e&&e.length>0?ye.warning(`当前仪表板中[${e}]属于模版图表，无法导出，请先设置数据集！`):M.value.init({appName:a.dvInfo.name,icon:null,version:"2.0",creator:Q.value,required:"2.9.0",description:null})},ie=()=>{let e=",";return Object.keys(E.value).forEach(r=>{const t=E.value[r];t&&(t==null?void 0:t.dataFrom)==="template"&&(e=e+t.title+",")}),e.slice(1)},Ye=()=>{y.value=!y.value},re=e=>{O(e,a.dvInfo.weight,a.dvInfo.ext)},le=e=>{O(e.id,e.weight,e.ext)},ce=d(()=>{var e;return((e=a.canvasStylePreview)==null?void 0:e.screenAdaptor)==="keep"}),a=De({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,curPreviewGap:0}),v=l(!0),z=e=>{v.value=e},ve=()=>{C.setArrowSide(!0)},ue=()=>{C.setArrowSide(!1)},de=()=>a,pe=e=>{L("app",e)};return Ce(()=>{we({name:"canvasDownload",callback:function(){b("img")}})}),Z({getPreviewStateInfo:de}),Ie(()=>{D.showPosition==="preview"&&S.canvasDataInit()}),(e,r)=>{const t=$e,q=G("ArrowLeft"),F=Se,W=G("ArrowRight"),u=ke,I=Ue,A=Ae("loading");return o(),k(U,null,[xe("div",He,[i.noClose?s("",!0):(o(),c(K,{key:0,style:x({left:(v.value?n(g)-12:0)+"px"}),onChangeSideTreeStatus:z,isInside:!v.value},null,8,["style","isInside"])),p(t,{class:B(["resource-area",{"close-side":!y.value,retract:!v.value}]),onMouseenter:ve,onMouseleave:ue,ref_key:"node",ref:ee,style:x({width:n(g)+"px"})},{default:w(()=>[i.noClose?s("",!0):(o(),c(K,{key:0,isInside:!v.value,style:x({left:(v.value?n(g)-12:0)+"px"}),onChangeSideTreeStatus:z},null,8,["isInside","style"])),$(p(Te,{ref_key:"resourceTreeRef",ref:_,"cur-canvas-type":"dataV","show-position":i.showPosition,onNodeClick:le},null,8,["show-position"]),[[Be,y.value]])]),_:1},8,["class","style"]),$((o(),c(I,{class:B(["preview-area",{"no-data":!N.value}])},{default:w(()=>[s("",!0),n(X).name?(o(),k(U,{key:1},[i.showPosition==="preview"?(o(),c(Ne,{key:0,onReload:re,onDownload:b,onDownloadAsAppTemplate:ne})):s("",!0),i.showPosition==="multiplexing"&&f.value?(o(),k("div",Ke,[p(We,{"component-data":a.canvasDataPreview,"canvas-style-data":a.canvasStylePreview,"canvas-view-info":a.canvasViewInfoPreview,"dv-info":a.dvInfo},null,8,["component-data","canvas-style-data","canvas-view-info","dv-info"])])):s("",!0),i.showPosition==="preview"?(o(),k("div",{key:2,class:B([{"canvas_keep-size":ce.value},"content"]),ref_key:"previewCanvasContainer",ref:P},[a.canvasStylePreview&&f.value?(o(),c(je,{key:0,ref_key:"dvPreviewRef",ref:T,"show-position":i.showPosition,"canvas-data-preview":a.canvasDataPreview,"canvas-style-preview":a.canvasStylePreview,"canvas-view-info-preview":a.canvasViewInfoPreview,"dv-info":a.dvInfo,"cur-preview-gap":a.curPreviewGap,"download-status":m.value},null,8,["show-position","canvas-data-preview","canvas-style-preview","canvas-view-info-preview","dv-info","cur-preview-gap","download-status"])):s("",!0)],2)):s("",!0)],64)):N.value&&R.value?(o(),c(Y,{key:2,description:n(h)("visualization.select_screen_tips"),"img-type":"select"},null,8,["description"])):R.value?(o(),c(Y,{key:3,description:n(h)("visualization.no_screen"),"img-type":"none"},{default:w(()=>[ae.value&&!oe.value?(o(),c(u,{key:0,onClick:te,type:"primary"},{icon:w(()=>[p(n(he),{name:"icon_add_outlined"},{default:w(()=>[p(n(Ee),{class:"svg-icon"})]),_:1})]),default:w(()=>[Ve(" "+H(n(h)("commons.create"))+H(n(h)("work_branch.big_data_screen")),1)]),_:1})):s("",!0)]),_:1},8,["description"])):s("",!0)]),_:1},8,["class"])),[[A,!f.value]])]),p(Ge,{ref_key:"appExportFormRef",ref:M,"dv-info":a.dvInfo,"component-data":a.canvasDataPreview,"canvas-view-info":a.canvasViewInfoPreview,onDownLoadApp:pe},null,8,["dv-info","component-data","canvas-view-info"])],64)}}});export{ma as _};

import{p as r,q as A,r as U,h as M,w as $,o as L,x as j,d as J,y as W,v as X}from"./element-plus-secondary-0.0.0-dataease.js";import{d as Z,r as G,l as H,k as K,ah as Q,o as T,c as D,a0 as a,_ as i,u as s,a as d,a4 as g,a2 as _,W as Y,a3 as ee,X as te,M as oe,ab as ae,Z as me}from"./@vue-0.0.0-dataease.js";import{f as pe,n as C,c as v,d as re}from"./template-0.0.0-dataease.js";import{i as ne}from"./imgUtils-0.0.0-dataease.js";import{j as ie}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{_ as le}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./html2canvas-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./dvMain-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./@antv-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./@turf-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./element-resize-detector-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./mathjs-0.0.0-dataease.js";import"./decimal.js-0.0.0-dataease.js";import"./typed-function-0.0.0-dataease.js";import"./complex.js-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./exceljs-0.0.0-dataease.js";import"./file-saver-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./html-to-image-0.0.0-dataease.js";const se={class:"template-import"},ce={class:"flex-template"},fe={class:"custom-dropdown__empty"},de={class:"custom-option-line"},_e=35e6,ue=Z({__name:"DeTemplateImport",props:{pid:{type:String,required:!0},templateCategories:{type:Array,required:!0},optType:{type:String,required:!0,default:"insert"},templateId:{type:String,required:!1}},emits:["closeEditTemplateDialog","refresh","addCategoryInfo"],setup(I,{emit:E}){const l=E,{t}=ie(),x=G(null),c=I,e=H({categories:[],nameList:[],importTemplateInfo:{snapshot:""},templateInfoRules:{name:[{required:!0,message:t("commons.input_content"),trigger:"change"},{max:50,message:t("commons.char_can_not_more_50"),trigger:"change"}],categories:[{required:!0,message:t("commons.input_content"),trigger:"change"}]},recover:!1,templateInfo:{id:null,level:"1",pid:c.pid,categories:[],dvType:"dashboard",nodeType:"template",name:"",templateStyle:null,templateData:null,dynamicData:null,appData:null,staticResource:null,snapshot:"",version:null}}),w=K(()=>e.templateInfo.snapshot?{background:`url(${ne(e.templateInfo.snapshot)}) no-repeat`}:{}),k=()=>{l("closeEditTemplateDialog")},b=()=>{if(!e.templateInfo.name)return r.warning(t("chart.name_can_not_empty")),!1;if(e.templateInfo.name.length>50)return r.warning(t("commons.char_can_not_more_50")),!1;if(!e.templateInfo.templateData)return r.warning(t("chart.template_can_not_empty")),!1;if(!e.templateInfo.categories.length)return r.warning(t("template_manage.please_select_catalog")),!1;c.optType==="insert"?S():R()},R=()=>{const m={pid:e.templateInfo.pid,id:e.templateInfo.id,name:e.templateInfo.name,categories:e.templateInfo.categories,optType:c.optType};C(m).then(o=>{o.data.indexOf("exist")>-1?r.warning(t("template_manage.exists_name_hint")):v(e.templateInfo).then(p=>{r.success(t("template_manage.edit_success")),l("refresh",h()),l("closeEditTemplateDialog")})})},h=()=>{const m=e.templateInfo.categories[0];let o="";return c.templateCategories.forEach(p=>{p.id===m&&(o=p.name)}),{optType:"refresh",refreshPid:m,refreshPName:o}},S=()=>{const m={pid:e.templateInfo.pid,name:e.templateInfo.name,categories:e.templateInfo.categories,optType:c.optType};re(m).then(o=>{o.data.indexOf("exist")>-1?A.confirm(t("template_manage.hint"),{tip:t("template_manage.cover_exists_hint"),confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1}).then(()=>{v(e.templateInfo).then(()=>{r.success(t("template_manage.cover_success")),l("refresh",h()),l("closeEditTemplateDialog")})}):C(m).then(p=>{p.data.indexOf("exist")>-1?r.warning(t("template_manage.exists_name_hint")):v(e.templateInfo).then(f=>{r.success(t("template_manage.import_success")),l("refresh",h()),l("closeEditTemplateDialog")})})})},q=m=>{const o=m.target.files[0],p=new FileReader;if(o.size>_e){r.success(t("template_manage.template_size_hint"));return}p.onload=f=>{const u=f.target.result;e.importTemplateInfo=JSON.parse(u),e.templateInfo.name=e.importTemplateInfo.name,e.templateInfo.dvType=e.importTemplateInfo.dvType,e.templateInfo.templateStyle=e.importTemplateInfo.canvasStyleData,e.templateInfo.templateData=e.importTemplateInfo.componentData,e.templateInfo.snapshot=e.importTemplateInfo.snapshot,e.templateInfo.dynamicData=e.importTemplateInfo.dynamicData,e.templateInfo.appData=e.importTemplateInfo.appData,e.templateInfo.staticResource=e.importTemplateInfo.staticResource,e.templateInfo.nodeType=e.importTemplateInfo.nodeType||"template",e.templateInfo.version=e.importTemplateInfo.version},p.readAsText(o)},V=()=>{x.value.click()},B=()=>{l("refresh",{optType:"addCategory"})};return c.templateId&&pe(c.templateId).then(m=>{e.templateInfo=m.data}),(m,o)=>{const p=U,f=M,u=$,y=L,F=j,P=Q("Plus"),N=J,O=W,z=X;return T(),D("div",se,[a(z,{ref:"templateImportForm",class:"de-form-item",model:e.templateInfo,rules:e.templateInfoRules,"label-position":"top"},{default:i(()=>[a(u,{label:s(t)("template_manage.template_name"),prop:"name"},{default:i(()=>[d("div",ce,[a(p,{modelValue:e.templateInfo.name,"onUpdate:modelValue":o[0]||(o[0]=n=>e.templateInfo.name=n),placeholder:s(t)("template_manage.enter_template_name_hint"),clearable:""},null,8,["modelValue","placeholder"]),a(f,{style:{"margin-left":"10px"},icon:"Upload",secondary:"",onClick:V},{default:i(()=>[g(_(s(t)("template_manage.import_template")),1)]),_:1}),d("input",{id:"input",ref_key:"filesRef",ref:x,type:"file",accept:".DET2,.DET2APP",hidden:"",onChange:q},null,544)])]),_:1},8,["label"]),Y(a(y,{class:"preview",style:ee(w.value)},null,8,["style"]),[[te,!!e.templateInfo.snapshot]]),a(u,{label:s(t)("template_manage.select_catalog"),prop:"categories",style:{"margin-top":"16px"}},{default:i(()=>[a(O,{modelValue:e.templateInfo.categories,"onUpdate:modelValue":o[1]||(o[1]=n=>e.templateInfo.categories=n),multiple:"",style:{width:"100%"},"popper-class":I.templateCategories.length?"custom-category-padding":"custom-category-empty custom-category-padding"},{default:i(()=>[(T(!0),D(oe,null,ae(I.templateCategories,n=>(T(),me(F,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128)),d("div",fe,[d("span",null,_(s(t)("template_manage.no_selectable_catalog")),1)]),d("div",de,[d("div",{onClick:B,class:"flex-align-center"},[a(N,null,{default:i(()=>[a(P)]),_:1}),g(" "+_(s(t)("template_manage.add_catalog")),1)])])]),_:1},8,["modelValue","popper-class"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),a(y),a(y,{class:"de-root-class"},{default:i(()=>[a(f,{secondary:"",onClick:o[2]||(o[2]=n=>k())},{default:i(()=>[g(_(s(t)("commons.cancel")),1)]),_:1}),a(f,{type:"primary",onClick:o[3]||(o[3]=n=>b())},{default:i(()=>[g(_(s(t)("commons.confirm")),1)]),_:1})]),_:1})])}}});const qo=le(ue,[["__scopeId","data-v-3df9e65e"]]);export{qo as default};

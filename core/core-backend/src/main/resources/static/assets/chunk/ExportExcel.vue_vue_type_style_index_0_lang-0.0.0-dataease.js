import{a as fe,u as V,F as me}from"./index-0.0.0-dataease.js";import{E as ve}from"./el-dialog-0.0.0-dataease.js";import{o as ge,U as xe,y as v,n as S,D as L,V as P,F as R,j as Se}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as he}from"./el-drawer-0.0.0-dataease.js";import{a as we,E as Ee}from"./el-table-column-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Ce}from"./el-progress-0.0.0-dataease.js";import{i as B}from"./icon_download_outlined-0.0.0-dataease.js";import{d as G}from"./de-delete-0.0.0-dataease.js";import{f as d,L as x,M as m,d as ke,r as g,aj as be,G as ye,aa as Le,T as Ne,g as f,i as l,k as o,Y as j,a9 as De,j as s,a5 as E,a6 as u,a0 as p,U as Ie,h as N}from"./vue-0.0.0-dataease.js";import{i as Ae}from"./icon_refresh_outlined-0.0.0-dataease.js";import{E as Fe}from"./EmptyBackground-0.0.0-dataease.js";import{E as Te,a as $e}from"./el-tabs-0.0.0-dataease.js";import{t as J,u as Ue,v as Ve,w as Pe,x as Re}from"./dataset-0.0.0-dataease.js";import{useAppStoreWithOut as Be}from"./app-0.0.0-dataease.js";import{E as Ge}from"./index-0.0.0-dataease3.js";const Oe={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function He(W,C){return d(),x("svg",Oe,C[0]||(C[0]=[m("path",{d:"M4 2.5C4 1.94772 4.44772 1.5 5 1.5H14.7929C14.9255 1.5 15.0527 1.55268 15.1464 1.64645L19.8536 6.35355C19.9473 6.44732 20 6.5745 20 6.70711V21.5C20 22.0523 19.5523 22.5 19 22.5H5C4.44772 22.5 4 22.0523 4 21.5V2.5Z",fill:"#34C724"},null,-1),m("path",{d:"M15 1.54492C15.054 1.56949 15.1037 1.6037 15.1464 1.64646L19.8536 6.35357C19.8963 6.39632 19.9305 6.44602 19.9551 6.50001H16C15.4477 6.50001 15 6.0523 15 5.50001V1.54492Z",fill:"#2EA121"},null,-1),m("path",{d:"M11.308 13.5956L8.33203 17.9996H9.60403L11.98 14.4596L14.284 17.9996H15.676L12.664 13.5956L15.496 9.43164H14.224L11.992 12.7796L9.85603 9.43164H8.48803L11.308 13.5956Z",fill:"white"},null,-1)]))}const Me={render:He},ze={class:"name-excel"},je={class:"name-content"},Je={class:"fileName"},We=["onClick"],Ze={key:1,class:"success"},Ye={key:0,class:"red-line"},qe={key:0},Ke={key:1},Qe={key:2},Xe={class:"dialog-footer"},St=ke({__name:"ExportExcel",setup(W,{expose:C}){const{t}=ge(),h=g([]),D=g(!1),k=g(!1),b=g(!1),I=g(""),c=g("ALL"),_=g([]),y=g(t("data_set.no_tasks_yet")),A=g([{label:t("data_set.exporting")+"(0)",name:"IN_PROGRESS"},{label:t("data_set.success")+"(0)",name:"SUCCESS"},{label:t("data_set.fail")+"(0)",name:"FAILED"},{label:t("data_set.waiting")+"(0)",name:"PENDING"},{label:t("data_set.all")+"(0)",name:"ALL"}]);let F;const Z=()=>{k.value=!1,clearInterval(F)},{wsCache:T}=fe(),Y=T.get("open-backend")==="1"?"_self":"_blank";T.get("xpack-model-distributed");const q=T.get("app.desktop");be(()=>{clearInterval(F)});const w=e=>{e&&(c.value=e.paneName),c.value==="ALL"?y.value=t("data_export.no_file"):c.value==="FAILED"?y.value=t("data_export.no_failed_file"):y.value=t("data_export.no_task"),D.value=!0,J(c.value).then(r=>{A.value.forEach(a=>{a.name==="ALL"&&(a.label=t("data_set.all")+"("+r.data.length+")"),a.name==="IN_PROGRESS"&&(a.label=t("data_set.exporting")+"("+r.data.filter(i=>i.exportStatus==="IN_PROGRESS").length+")"),a.name==="SUCCESS"&&(a.label=t("data_set.success")+"("+r.data.filter(i=>i.exportStatus==="SUCCESS").length+")"),a.name==="FAILED"&&(a.label=t("data_set.fail")+"("+r.data.filter(i=>i.exportStatus==="FAILED").length+")"),a.name==="PENDING"&&(a.label=t("data_set.waiting")+"("+r.data.filter(i=>i.exportStatus==="PENDING").length+")")}),c.value==="ALL"?h.value=r.data:h.value=r.data.filter(a=>a.exportStatus===c.value)}).finally(()=>{D.value=!1})},K=e=>{k.value=!0,e&&e.activeName!==void 0&&(c.value=e.activeName),w(),F=setInterval(()=>{c.value==="IN_PROGRESS"&&J(c.value).then(r=>{A.value.forEach(a=>{a.name==="ALL"&&(a.label=t("data_set.all")+"("+r.data.length+")"),a.name==="IN_PROGRESS"&&(a.label=t("data_set.exporting")+"("+r.data.filter(i=>i.exportStatus==="IN_PROGRESS").length+")"),a.name==="SUCCESS"&&(a.label=t("data_set.success")+"("+r.data.filter(i=>i.exportStatus==="SUCCESS").length+")"),a.name==="FAILED"&&(a.label=t("data_set.fail")+"("+r.data.filter(i=>i.exportStatus==="FAILED").length+")"),a.name==="PENDING"&&(a.label=t("data_set.waiting")+"("+r.data.filter(i=>i.exportStatus==="PENDING").length+")")}),c.value==="ALL"?h.value=r.data:h.value=r.data.filter(a=>a.exportStatus===c.value)})},5e3)},Q=xe(),O=Be(),X=ye(()=>O.getIsDataEaseBi),ee=e=>{if(!Q.getLinkToken&&!X.value&&!O.getIsIframe){if(JSON.parse(e).exportStatus==="SUCCESS"){H(JSON.parse(e).exportFromName+` ${t("data_set.successful_go_to")}`,"success",ae);return}JSON.parse(e).exportStatus==="FAILED"&&H(JSON.parse(e).exportFromName+` ${t("data_set.failed_go_to")}`,"error",te)}},H=(e,r="success",a)=>{const i=`de-message-${r||"success"} de-message-export`;L({message:N("p",null,[N("span",{title:t(e),class:"ellipsis m50-export"},t(e)),N(v,{text:!0,size:"small",class:"btn-text",onClick:()=>{a()}},t("data_export.export_center"))]),icon:r==="loading"?N(me):"",type:r,showClose:!0,customClass:i})},te=()=>{V().emitter.emit("data-export-center",{activeName:"FAILED"})},ae=()=>{V().emitter.emit("data-export-center",{activeName:"SUCCESS"})},M=()=>{if(_.value.length===0){h.value.forEach(e=>{window.open(P+"/exportCenter/download/"+e.id)});return}_.value.map(e=>{window.open(P+"/exportCenter/download/"+e.id)})},le=e=>{I.value="",I.value=e.msg,b.value=!0},oe=e=>e?new Date(e).toLocaleString():"-",ne=e=>{window.open(P+"/exportCenter/download/"+e.id,Y)},se=e=>{Ue(e.id).then(()=>{w()})},re=e=>{R.confirm(t("data_export.sure_del"),{confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1}).then(()=>{Ve(e.id).then(()=>{L.success(t("commons.delete_success")),w()})}).catch(()=>{})},ie=e=>{_.value=e},z=()=>{if(_.value.length===0){R.confirm(t("data_export.sure_del_all"),{confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1}).then(()=>{Pe(c.value,_.value.map(e=>e.id)).then(()=>{L.success(t("commons.delete_success")),w()})}).catch(()=>{});return}R.confirm(t("data_export.sure_del"),{confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1}).then(()=>{Re(_.value.map(e=>e.id)).then(()=>{L.success(t("commons.delete_success")),w()})}).catch(()=>{})};return V({name:"task-export-topic-call",callback:ee}),C({init:K}),(e,r)=>{const a=we,i=Se,de=Ce,$=Ge,ce=Ee,ue=he,pe=ve,_e=Le("loading");return d(),x(j,null,[Ne((d(),f(ue,{"custom-class":"de-export-excel",title:e.$t("data_export.export_center"),modelValue:k.value,"onUpdate:modelValue":r[1]||(r[1]=n=>k.value=n),direction:"rtl",size:"1000px","append-to-body":"","before-close":Z},{default:l(()=>[o(s($e),{modelValue:c.value,"onUpdate:modelValue":r[0]||(r[0]=n=>c.value=n),onTabClick:w},{default:l(()=>[(d(!0),x(j,null,De(A.value,n=>(d(),f(s(Te),{key:n.name,label:n.label,name:n.name},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),c.value==="SUCCESS"&&_.value.length===0?(d(),f(s(v),{key:0,secondary:"",onClick:M},{icon:l(()=>[o(S,{name:"dv-preview-download"},{default:l(()=>[o(s(B),{class:"svg-icon"})]),_:1})]),default:l(()=>[E(" "+u(e.$t("data_export.download_all")),1)]),_:1})):p("",!0),c.value==="SUCCESS"&&_.value.length!==0?(d(),f(s(v),{key:1,secondary:"",onClick:M},{icon:l(()=>[o(S,{name:"dv-preview-download"},{default:l(()=>[o(s(B),{class:"svg-icon"})]),_:1})]),default:l(()=>[E(" "+u(e.$t("data_export.download")),1)]),_:1})):p("",!0),_.value.length===0?(d(),f(s(v),{key:2,secondary:"",onClick:z},{icon:l(()=>[o(S,{name:"de-delete"},{default:l(()=>[o(s(G),{class:"svg-icon"})]),_:1})]),default:l(()=>[E(u(e.$t("data_export.del_all")),1)]),_:1})):p("",!0),_.value.length!==0?(d(),f(s(v),{key:3,secondary:"",onClick:z},{icon:l(()=>[o(S,{name:"de-delete"},{default:l(()=>[o(s(G),{class:"svg-icon"})]),_:1})]),default:l(()=>[E(u(e.$t("commons.delete")),1)]),_:1})):p("",!0),m("div",{class:Ie(["table-container",!h.value.length&&"hidden-bottom"])},[o(ce,{ref:"multipleTable",data:h.value,height:"100%",style:{width:"100%"},onSelectionChange:ie},{empty:l(()=>[o(s(Fe),{description:y.value,"img-type":"noneWhite"},null,8,["description"])]),default:l(()=>[o(a,{type:"selection",width:"50"}),o(a,{prop:"fileName",label:e.$t("driver.file_name"),width:"332"},{default:l(n=>[m("div",ze,[o(i,{style:{"font-size":"24px"}},{default:l(()=>[o(S,{name:"icon_file-excel_colorful"},{default:l(()=>[o(s(Me),{class:"svg-icon"})]),_:1})]),_:1}),m("div",je,[m("div",Je,u(n.row.fileName),1),n.row.exportStatus==="FAILED"?(d(),x("div",{key:0,class:"failed",onClick:U=>le(n.row)},u(e.$t("data_export.export_failed")),9,We)):p("",!0),n.row.exportStatus==="SUCCESS"?(d(),x("div",Ze,u(n.row.fileSize)+u(n.row.fileSizeUnit),1)):p("",!0)])]),n.row.exportStatus==="FAILED"?(d(),x("div",Ye)):p("",!0),n.row.exportStatus==="IN_PROGRESS"?(d(),f(de,{key:1,percentage:+n.row.exportProgress},null,8,["percentage"])):p("",!0)]),_:1},8,["label"]),o(a,{prop:"exportFromName",label:e.$t("data_export.export_obj"),width:"200"},null,8,["label"]),o(a,{prop:"exportTime",width:"180",label:e.$t("data_export.export_time")},{default:l(n=>[m("span",null,u(oe(n.row.exportTime)),1)]),_:1},8,["label"]),o(a,{prop:"exportFromType",width:"120",label:e.$t("data_export.export_from")},{default:l(n=>[n.row.exportFromType==="dataset"?(d(),x("span",qe,u(s(t)("data_set.data_set")),1)):p("",!0),n.row.exportFromType==="chart"?(d(),x("span",Ke,u(s(t)("data_set.view")),1)):p("",!0),n.row.exportFromType==="data_filling"?(d(),x("span",Qe,u(s(t)("data_fill.data_fill")),1)):p("",!0)]),_:1},8,["label"]),s(q)?p("",!0):(d(),f(a,{key:0,prop:"orgName",label:s(t)("data_set.organization"),width:"200"},null,8,["label"])),o(a,{fixed:"right",prop:"operate",width:"90",label:e.$t("commons.operating")},{default:l(n=>[o($,{effect:"dark",content:s(t)("data_set.download"),placement:"top"},{default:l(()=>[n.row.exportStatus==="SUCCESS"?(d(),f(s(v),{key:0,text:"",onClick:U=>ne(n.row)},{icon:l(()=>[o(i,null,{default:l(()=>[o(S,{name:"dv-preview-download"},{default:l(()=>[o(s(B),{class:"svg-icon"})]),_:1})]),_:1})]),_:2},1032,["onClick"])):p("",!0)]),_:2},1032,["content"]),o($,{effect:"dark",content:s(t)("data_set.re_export"),placement:"top"},{default:l(()=>[n.row.exportStatus==="FAILED"?(d(),f(s(v),{key:0,text:"",onClick:U=>se(n.row)},{icon:l(()=>[o(S,{name:"icon_refresh_outlined"},{default:l(()=>[o(s(Ae),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])):p("",!0)]),_:2},1032,["content"]),o($,{effect:"dark",content:s(t)("data_set.delete"),placement:"top"},{default:l(()=>[o(s(v),{text:"",onClick:U=>re(n.row)},{icon:l(()=>[o(S,{name:"de-delete"},{default:l(()=>[o(s(G),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data"])],2)]),_:1},8,["title","modelValue"])),[[_e,D.value]]),o(pe,{title:s(t)("data_set.reason_for_failure"),modelValue:b.value,"onUpdate:modelValue":r[3]||(r[3]=n=>b.value=n),width:"30%"},{footer:l(()=>[m("span",Xe,[o(s(v),{type:"primary",onClick:r[2]||(r[2]=n=>b.value=!1)},{default:l(()=>[E(u(s(t)("data_set.closure")),1)]),_:1})])]),default:l(()=>[m("span",null,u(I.value),1)]),_:1},8,["title","modelValue"])],64)}}});export{St as _};

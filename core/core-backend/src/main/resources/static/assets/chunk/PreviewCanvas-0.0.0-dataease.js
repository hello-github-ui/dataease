import{d as x,f as z}from"./dvMain-0.0.0-dataease.js";import{k as U}from"./DePreview-0.0.0-dataease.js";import{r as a,D as A,o as M,v as V,Z as X,aQ as Y}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{p as H,b as K,u as Q}from"./index-0.0.0-dataease.js";import{U as $,i as tt,o as rt}from"./canvasUtils-0.0.0-dataease.js";import{g as B}from"./base64-0.0.0-dataease.js";import{g as ot}from"./outerParams-0.0.0-dataease.js";import{a as et}from"./imgUtils-0.0.0-dataease.js";import{E as it}from"./EmptyBackground-0.0.0-dataease.js";import{d as at,r as T,Z as mt,w as pt,o as nt,G as st,aa as ct,f,L as q,T as ut,U as lt,g as j,a0 as D,j as y,k as F,Y as dt,n as L,u as vt}from"./vue-0.0.0-dataease.js";import{_ as ft}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./index-0.0.0-dataease19.js";import"./library-0.0.0-dataease.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./index-0.0.0-dataease20.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./el-row-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./style-0.0.0-dataease.js";import"./translate-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";import"./Component-0.0.0-dataease16.js";import"./DeShortcutKey-0.0.0-dataease.js";import"./snapshot-0.0.0-dataease.js";import"./canvasStyle-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./ModelUtil-0.0.0-dataease.js";import"./Component-0.0.0-dataease15.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./icon_edit_outlined-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import"./el-form-item-0.0.0-dataease.js";import"./el-dialog-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./el-popover-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./dropdown-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./el-tree-0.0.0-dataease.js";import"./index-0.0.0-dataease13.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tree-select-0.0.0-dataease.js";import"./el-checkbox-group-0.0.0-dataease.js";import"./el-tabs-0.0.0-dataease.js";import"./el-radio-group-0.0.0-dataease.js";import"./el-radio-0.0.0-dataease.js";import"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import"./el-dropdown-menu-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./icon_more_outlined-0.0.0-dataease.js";import"./more_v-0.0.0-dataease.js";import"./icon_add_outlined-0.0.0-dataease.js";import"./icon_drag_outlined-0.0.0-dataease.js";import"./icon_visible_outlined-0.0.0-dataease.js";import"./dv-folder-0.0.0-dataease.js";import"./icon_dataset-0.0.0-dataease.js";import"./icon_warning_filled-0.0.0-dataease.js";import"./icon_info_outlined-0.0.0-dataease.js";import"./vuedraggable-es-0.0.0-dataease.js";import"./time-format-0.0.0-dataease.js";import"./dayjs.min-0.0.0-dataease.js";import"./time-format-dayjs-0.0.0-dataease.js";import"./attr-0.0.0-dataease20.js";import"./el-time-picker-0.0.0-dataease.js";import"./el-date-picker-0.0.0-dataease.js";import"./arrays-0.0.0-dataease.js";import"./index-0.0.0-dataease17.js";import"./el-input-number-0.0.0-dataease.js";import"./icon_admin_outlined-0.0.0-dataease.js";import"./index-0.0.0-dataease25.js";import"./index-0.0.0-dataease26.js";import"./use-route-0.0.0-dataease.js";import"./index-0.0.0-dataease27.js";import"./index-0.0.0-dataease28.js";import"./index-0.0.0-dataease29.js";import"./index-0.0.0-dataease30.js";import"./el-virtual-list-0.0.0-dataease.js";import"./el-select-v2-0.0.0-dataease.js";import"./fixed-size-list-0.0.0-dataease.js";import"./browser-0.0.0-dataease.js";import"./chart-list-0.0.0-dataease.js";import"./field-list-0.0.0-dataease.js";import"./treeSortUtils-0.0.0-dataease.js";import"./Attr-0.0.0-dataease19.js";import"./CommonAttr-0.0.0-dataease.js";import"./el-collapse-item-0.0.0-dataease.js";import"./CommonBorderSetting.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-radio-button-0.0.0-dataease.js";import"./position-0.0.0-dataease.js";import"./BackgroundOverallCommon-0.0.0-dataease.js";import"./el-upload-0.0.0-dataease.js";import"./el-progress-0.0.0-dataease.js";import"./board-list-0.0.0-dataease.js";import"./ImgViewDialog-0.0.0-dataease.js";import"./el-space-0.0.0-dataease.js";import"./icon_italic_outlined-0.0.0-dataease.js";import"./icon_right-alignment_outlined-0.0.0-dataease.js";import"./CarouselSetting.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./CollapseSwitchItem-0.0.0-dataease.js";import"./el-switch-0.0.0-dataease.js";import"./icon_replace_outlined-0.0.0-dataease.js";import"./icon_download_outlined-0.0.0-dataease.js";import"./Component.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./watermark-0.0.0-dataease2.js";import"./user-0.0.0-dataease.js";import"./el-divider-0.0.0-dataease.js";import"./ChartComponentS2-0.0.0-dataease.js";import"./ViewTrackBar-0.0.0-dataease.js";import"./el-pagination-0.0.0-dataease.js";import"./ChartError-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import"./index-0.0.0-dataease14.js";import"./LinkageSet-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import"./el-aside-0.0.0-dataease.js";import"./dv-link-target-0.0.0-dataease.js";import"./dv-dashboard-spine-0.0.0-dataease.js";import"./dv-screen-spine-0.0.0-dataease.js";import"./CodeMirror-0.0.0-dataease.js";import"./dv-empty-0.0.0-dataease.js";import"./Attr.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import"./Component-0.0.0-dataease14.js";import"./index-0.0.0-dataease31.js";import"./ChartComponentG2Plot-0.0.0-dataease.js";import"./PluginComponent.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./DrillPath-0.0.0-dataease.js";import"./DeRichTextView-0.0.0-dataease.js";import"./Component-0.0.0-dataease10.js";import"./ChartEmptyInfo-0.0.0-dataease.js";import"./chart-dark-list-0.0.0-dataease.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./Component-0.0.0-dataease11.js";import"./Attr-0.0.0-dataease13.js";import"./Attr-0.0.0-dataease.js";import"./Component-0.0.0-dataease3.js";import"./Attr.vue_vue_type_style_index_0_lang-0.0.0-dataease2.js";import"./Attr-0.0.0-dataease7.js";import"./Component-0.0.0-dataease5.js";import"./Attr-0.0.0-dataease5.js";import"./Component-0.0.0-dataease4.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease2.js";import"./Component-0.0.0-dataease12.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease3.js";import"./Component.vue_vue_type_script_setup_true_lang-0.0.0-dataease2.js";import"./Attr-0.0.0-dataease8.js";import"./Component-0.0.0-dataease9.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease4.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease5.js";import"./Component-0.0.0-dataease8.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease6.js";import"./Component-0.0.0-dataease6.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease7.js";import"./Component-0.0.0-dataease13.js";import"./Attr-0.0.0-dataease16.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease8.js";import"./Attr-0.0.0-dataease12.js";import"./DatasetSelect-0.0.0-dataease.js";import"./icon_done_outlined-0.0.0-dataease.js";import"./Threshold-0.0.0-dataease.js";import"./TableThresholdEdit-0.0.0-dataease.js";import"./icon_info_filled-0.0.0-dataease.js";import"./TextLabelThresholdEdit-0.0.0-dataease.js";import"./TextThresholdEdit-0.0.0-dataease.js";import"./LineThresholdEdit-0.0.0-dataease.js";import"./PictureGroupThresholdEdit-0.0.0-dataease.js";import"./Component-0.0.0-dataease2.js";import"./icon_left_outlined-0.0.0-dataease.js";import"./el-empty-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";const wt=at({__name:"PreviewCanvas",props:{publicLinkStatus:{type:Boolean,required:!1,default:!1},isSelector:{type:Boolean,default:!1},ticketArgs:H.string.def(null)},setup(W,{expose:E}){const _=vt(),e=x(),{t:I}=M(),g=K(),S=T(null),w=T(!1),t=mt({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,curPreviewGap:0,initState:!0,showPosition:null}),d=W,k=async(r,n,u=!1)=>{const v=g.jumpInfoParam||a.currentRoute.value.query.jumpInfoParam;let m;if(v){m=JSON.parse(B.decode(decodeURIComponent(v)));const o={sourceDvId:m.sourceDvId,sourceViewId:m.sourceViewId,sourceFieldId:null,targetDvId:r};try{await $(o).then(p=>{e.setNowTargetPanelJumpInfo(p.data)})}catch(p){console.error(p)}}let s=null;try{s=JSON.parse(d.ticketArgs)}catch(o){console.error(o)}const l=s&&Object.keys(s);let c;await ot(r).then(o=>{e.setNowPanelOuterParamsInfoV2(o.data,r)});const i=a.currentRoute.value.query.attachParams;if(i||l)try{i&&(c=JSON.parse(B.decode(decodeURIComponent(i)))),l&&(c=Object.assign({},c,s))}catch(o){console.error(o),A.error(I("visualization.outer_param_decode_error"))}const G=()=>{if(t.canvasStylePreview.refreshBrowserEnable&&Y()){const o=t.canvasStylePreview.refreshBrowserUnit==="minute"?60:1,p=t.canvasStylePreview.refreshBrowserTime*o*1e3;setTimeout(()=>{window.location.reload()},p)}};await tt(r,n,async function({canvasDataResult:o,canvasStyleResult:p,dvInfo:P,canvasViewInfoPreview:J,curPreviewGap:N}){m&&(await z(o),e.addViewTrackFilter(m)),t.canvasDataPreview=o,t.canvasStylePreview=p,t.canvasViewInfoPreview=J,t.dvInfo=P,t.curPreviewGap=N,u||(t.initState=!1,e.addOuterParamsFilter(c),t.initState=!0),d.publicLinkStatus&&(document.title=P.name,X(P.name)),G(),await L(()=>{rt({resourceId:r})})})},O=r=>{w.value=!0,L(()=>{const n=S.value.querySelector(".canvas-container");et(r,n,t.dvInfo.name,()=>{w.value=!1})})};pt(()=>({path:_.path,params:_.params}),()=>{location.reload()},{deep:!0});let h=null,b=null;const C=()=>h(!0),R=()=>b(!0);nt(async()=>{Q({name:"canvasDownload",callback:function(i="img"){O(i)}}),await Promise.all([new Promise(i=>h=i),new Promise(i=>b=i)]);let r=g.dvId||a.currentRoute.value.query.dvId;a.currentRoute.value.query.jumpInfoParam&&a.currentRoute.value.query.dvId&&(r=a.currentRoute.value.query.dvId);const n=a.currentRoute.value.query.ignoreParams==="true",u=a.currentRoute.value.query.popWindow==="true",v=window.self!==window.top;e.setIframeFlag(v),e.setIsPopWindow(u);const{dvType:m,callBackFlag:s,taskId:l,showWatermark:c}=a.currentRoute.value.query;if(l&&e.setCanvasAttachInfo({taskId:l,showWatermark:c}),r){await k(r,m,n);return}e.setEmbeddedCallBack(s||"no"),e.setPublicLinkStatus(d.publicLinkStatus)});const Z=st(()=>{var r;return((r=t.canvasStylePreview)==null?void 0:r.screenAdaptor)==="keep"});return E({loadCanvasDataAsync:k}),(r,n)=>{const u=ct("loading");return f(),q(dt,null,[ut((f(),q("div",{class:lt(["content",{"canvas_keep-size":Z.value}]),ref_key:"previewCanvasContainer",ref:S},[t.canvasStylePreview&&t.initState?(f(),j(U,{key:0,ref:"dvPreview","component-data":t.canvasDataPreview,"canvas-style-data":t.canvasStylePreview,"canvas-view-info":t.canvasViewInfoPreview,"dv-info":t.dvInfo,"cur-gap":t.curPreviewGap,"is-selector":d.isSelector,"download-status":w.value,"show-pop-bar":!0},null,8,["component-data","canvas-style-data","canvas-view-info","dv-info","cur-gap","is-selector","download-status"])):D("",!0),t.initState?D("",!0):(f(),j(it,{key:1,description:y(I)("visualization.no_params_tips"),"img-type":"noneWhite"},null,8,["description"]))],2)),[[u,!t.initState]]),F(y(V),{jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvTmV3V2luZG93SGFuZGxlcg==",onLoaded:C,onLoadFail:C}),F(y(V),{jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvRW50cmFuY2Vz",onInitIframe:R,onLoadFail:R})],64)}}});const Qe=ft(wt,[["__scopeId","data-v-4cfdb544"]]);export{Qe as default};

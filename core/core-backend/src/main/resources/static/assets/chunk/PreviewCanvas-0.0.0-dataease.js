import{d as G,f as x}from"./dvMain-0.0.0-dataease.js";import{k as A}from"./DePreview-0.0.0-dataease.js";import{r as m,j as M,l as V,I as U,a2 as X}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{p as Y,b as H,u as K}from"./index-0.0.0-dataease.js";import{U as $,i as Q,o as tt}from"./canvasUtils-0.0.0-dataease.js";import{g as B}from"./js-base64-0.0.0-dataease.js";import{g as rt}from"./outerParams-0.0.0-dataease.js";import{p as ot}from"./element-plus-secondary-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import{a as it}from"./imgUtils-0.0.0-dataease.js";import{E as et}from"./EmptyBackground-0.0.0-dataease.js";import{u as mt}from"./vue-router-0.0.0-dataease.js";import{d as pt,r as q,l as at,w as nt,b as st,k as ct,ak as ut,o as f,c as T,W as lt,z as dt,Z as W,Y as j,u as y,a0 as F,M as vt,n as D}from"./@vue-0.0.0-dataease.js";import{_ as ft}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./@antv-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./@turf-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./element-resize-detector-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./mathjs-0.0.0-dataease.js";import"./decimal.js-0.0.0-dataease.js";import"./typed-function-0.0.0-dataease.js";import"./complex.js-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./exceljs-0.0.0-dataease.js";import"./file-saver-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./style-0.0.0-dataease.js";import"./translate-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";import"./Component-0.0.0-dataease16.js";import"./DeShortcutKey-0.0.0-dataease.js";import"./snapshot-0.0.0-dataease.js";import"./canvasStyle-0.0.0-dataease.js";import"./html2canvas-0.0.0-dataease.js";import"./html-to-image-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./ModelUtil-0.0.0-dataease.js";import"./Component-0.0.0-dataease15.js";import"./icon_edit_outlined-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import"./icon_more_outlined-0.0.0-dataease.js";import"./more_v-0.0.0-dataease.js";import"./icon_add_outlined-0.0.0-dataease.js";import"./icon_drag_outlined-0.0.0-dataease.js";import"./icon_visible_outlined-0.0.0-dataease.js";import"./dv-folder-0.0.0-dataease.js";import"./icon_dataset-0.0.0-dataease.js";import"./icon_warning_filled-0.0.0-dataease.js";import"./icon_info_outlined-0.0.0-dataease.js";import"./vuedraggable-0.0.0-dataease.js";import"./time-format-0.0.0-dataease.js";import"./time-format-dayjs-0.0.0-dataease.js";import"./attr-0.0.0-dataease20.js";import"./icon_admin_outlined-0.0.0-dataease.js";import"./vant-0.0.0-dataease.js";import"./@vant-0.0.0-dataease.js";import"./chart-list-0.0.0-dataease.js";import"./field-list-0.0.0-dataease.js";import"./treeSortUtils-0.0.0-dataease.js";import"./Attr-0.0.0-dataease19.js";import"./CommonAttr-0.0.0-dataease.js";import"./CommonBorderSetting.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./BackgroundOverallCommon-0.0.0-dataease.js";import"./board-list-0.0.0-dataease.js";import"./ImgViewDialog-0.0.0-dataease.js";import"./icon_italic_outlined-0.0.0-dataease.js";import"./icon_right-alignment_outlined-0.0.0-dataease.js";import"./CarouselSetting.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./CollapseSwitchItem-0.0.0-dataease.js";import"./icon_replace_outlined-0.0.0-dataease.js";import"./icon_download_outlined-0.0.0-dataease.js";import"./Component.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./watermark-0.0.0-dataease2.js";import"./user-0.0.0-dataease.js";import"./jquery-0.0.0-dataease.js";import"./ChartComponentS2-0.0.0-dataease.js";import"./ViewTrackBar-0.0.0-dataease.js";import"./ChartError-0.0.0-dataease.js";import"./LinkageSet-0.0.0-dataease.js";import"./dv-link-target-0.0.0-dataease.js";import"./dv-dashboard-spine-0.0.0-dataease.js";import"./dv-screen-spine-0.0.0-dataease.js";import"./CodeMirror-0.0.0-dataease2.js";import"./@codemirror-0.0.0-dataease.js";import"./@lezer-0.0.0-dataease.js";import"./style-mod-0.0.0-dataease.js";import"./crelt-0.0.0-dataease.js";import"./@marijn-0.0.0-dataease.js";import"./w3c-keyname-0.0.0-dataease.js";import"./codemirror-0.0.0-dataease.js";import"./dv-empty-0.0.0-dataease.js";import"./Attr.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import"./Component-0.0.0-dataease14.js";import"./index-0.0.0-dataease17.js";import"./ChartComponentG2Plot-0.0.0-dataease.js";import"./PluginComponent.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./DrillPath-0.0.0-dataease.js";import"./DeRichTextView-0.0.0-dataease.js";import"./@tinymce-0.0.0-dataease.js";import"./@npkg-0.0.0-dataease.js";import"./Component-0.0.0-dataease10.js";import"./ChartEmptyInfo-0.0.0-dataease.js";import"./chart-dark-list-0.0.0-dataease.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./Component-0.0.0-dataease11.js";import"./Attr-0.0.0-dataease13.js";import"./Attr-0.0.0-dataease.js";import"./Component-0.0.0-dataease3.js";import"./Attr.vue_vue_type_style_index_0_lang-0.0.0-dataease2.js";import"./Attr-0.0.0-dataease7.js";import"./Component-0.0.0-dataease5.js";import"./Attr-0.0.0-dataease5.js";import"./Component-0.0.0-dataease4.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease2.js";import"./Component-0.0.0-dataease12.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease3.js";import"./Component.vue_vue_type_script_setup_true_lang-0.0.0-dataease2.js";import"./Attr-0.0.0-dataease8.js";import"./Component-0.0.0-dataease9.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease4.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease5.js";import"./Component-0.0.0-dataease8.js";import"./@videojs-player-0.0.0-dataease.js";import"./video.js-0.0.0-dataease.js";import"./global-0.0.0-dataease.js";import"./keycode-0.0.0-dataease.js";import"./safe-json-parse-0.0.0-dataease.js";import"./@videojs-0.0.0-dataease.js";import"./is-function-0.0.0-dataease.js";import"./url-toolkit-0.0.0-dataease.js";import"./videojs-vtt.js-0.0.0-dataease.js";import"./m3u8-parser-0.0.0-dataease.js";import"./mpd-parser-0.0.0-dataease.js";import"./@xmldom-0.0.0-dataease.js";import"./mux.js-0.0.0-dataease.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease6.js";import"./Component-0.0.0-dataease6.js";import"./flv.js-0.0.0-dataease.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease7.js";import"./Component-0.0.0-dataease13.js";import"./Attr-0.0.0-dataease16.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease8.js";import"./Attr-0.0.0-dataease12.js";import"./DatasetSelect-0.0.0-dataease.js";import"./icon_done_outlined-0.0.0-dataease.js";import"./Threshold-0.0.0-dataease.js";import"./TableThresholdEdit-0.0.0-dataease.js";import"./icon_info_filled-0.0.0-dataease.js";import"./TextLabelThresholdEdit-0.0.0-dataease.js";import"./TextThresholdEdit-0.0.0-dataease.js";import"./LineThresholdEdit-0.0.0-dataease.js";import"./PictureGroupThresholdEdit-0.0.0-dataease.js";import"./Component-0.0.0-dataease2.js";import"./icon_left_outlined-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";const wt=pt({__name:"PreviewCanvas",props:{publicLinkStatus:{type:Boolean,required:!1,default:!1},isSelector:{type:Boolean,default:!1},ticketArgs:Y.string.def(null)},setup(L,{expose:E}){const _=mt(),i=G(),{t:I}=M(),g=H(),S=q(null),w=q(!1),t=at({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,curPreviewGap:0,initState:!0,showPosition:null}),d=L,k=async(r,n,u=!1)=>{const v=g.jumpInfoParam||m.currentRoute.value.query.jumpInfoParam;let p;if(v){p=JSON.parse(B.decode(decodeURIComponent(v)));const o={sourceDvId:p.sourceDvId,sourceViewId:p.sourceViewId,sourceFieldId:null,targetDvId:r};try{await $(o).then(a=>{i.setNowTargetPanelJumpInfo(a.data)})}catch(a){console.error(a)}}let s=null;try{s=JSON.parse(d.ticketArgs)}catch(o){console.error(o)}const l=s&&Object.keys(s);let c;await rt(r).then(o=>{i.setNowPanelOuterParamsInfoV2(o.data,r)});const e=m.currentRoute.value.query.attachParams;if(e||l)try{e&&(c=JSON.parse(B.decode(decodeURIComponent(e)))),l&&(c=Object.assign({},c,s))}catch(o){console.error(o),ot.error(I("visualization.outer_param_decode_error"))}const N=()=>{if(t.canvasStylePreview.refreshBrowserEnable&&X()){const o=t.canvasStylePreview.refreshBrowserUnit==="minute"?60:1,a=t.canvasStylePreview.refreshBrowserTime*o*1e3;setTimeout(()=>{window.location.reload()},a)}};await Q(r,n,async function({canvasDataResult:o,canvasStyleResult:a,dvInfo:P,canvasViewInfoPreview:Z,curPreviewGap:z}){p&&(await x(o),i.addViewTrackFilter(p)),t.canvasDataPreview=o,t.canvasStylePreview=a,t.canvasViewInfoPreview=Z,t.dvInfo=P,t.curPreviewGap=z,u||(t.initState=!1,i.addOuterParamsFilter(c),t.initState=!0),d.publicLinkStatus&&(document.title=P.name,U(P.name)),N(),await D(()=>{tt({resourceId:r})})})},O=r=>{w.value=!0,D(()=>{const n=S.value.querySelector(".canvas-container");it(r,n,t.dvInfo.name,()=>{w.value=!1})})};nt(()=>({path:_.path,params:_.params}),()=>{location.reload()},{deep:!0});let h=null,b=null;const C=()=>h(!0),R=()=>b(!0);st(async()=>{K({name:"canvasDownload",callback:function(e="img"){O(e)}}),await Promise.all([new Promise(e=>h=e),new Promise(e=>b=e)]);let r=g.dvId||m.currentRoute.value.query.dvId;m.currentRoute.value.query.jumpInfoParam&&m.currentRoute.value.query.dvId&&(r=m.currentRoute.value.query.dvId);const n=m.currentRoute.value.query.ignoreParams==="true",u=m.currentRoute.value.query.popWindow==="true",v=window.self!==window.top;i.setIframeFlag(v),i.setIsPopWindow(u);const{dvType:p,callBackFlag:s,taskId:l,showWatermark:c}=m.currentRoute.value.query;if(l&&i.setCanvasAttachInfo({taskId:l,showWatermark:c}),r){await k(r,p,n);return}i.setEmbeddedCallBack(s||"no"),i.setPublicLinkStatus(d.publicLinkStatus)});const J=ct(()=>{var r;return((r=t.canvasStylePreview)==null?void 0:r.screenAdaptor)==="keep"});return E({loadCanvasDataAsync:k}),(r,n)=>{const u=ut("loading");return f(),T(vt,null,[lt((f(),T("div",{class:dt(["content",{"canvas_keep-size":J.value}]),ref_key:"previewCanvasContainer",ref:S},[t.canvasStylePreview&&t.initState?(f(),W(A,{key:0,ref:"dvPreview","component-data":t.canvasDataPreview,"canvas-style-data":t.canvasStylePreview,"canvas-view-info":t.canvasViewInfoPreview,"dv-info":t.dvInfo,"cur-gap":t.curPreviewGap,"is-selector":d.isSelector,"download-status":w.value,"show-pop-bar":!0},null,8,["component-data","canvas-style-data","canvas-view-info","dv-info","cur-gap","is-selector","download-status"])):j("",!0),t.initState?j("",!0):(f(),W(et,{key:1,description:y(I)("visualization.no_params_tips"),"img-type":"noneWhite"},null,8,["description"]))],2)),[[u,!t.initState]]),F(y(V),{jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvTmV3V2luZG93SGFuZGxlcg==",onLoaded:C,onLoadFail:C}),F(y(V),{jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvRW50cmFuY2Vz",onInitIframe:R,onLoadFail:R})],64)}}});const im=ft(wt,[["__scopeId","data-v-4cfdb544"]]);export{im as default};

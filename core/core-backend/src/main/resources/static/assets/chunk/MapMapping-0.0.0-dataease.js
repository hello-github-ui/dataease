import{V as G,r as K,d as L,h as W,T as q,a4 as R}from"./element-plus-secondary-0.0.0-dataease.js";import{d as X,t as Z,w as j,r as c,l as E,k as H,b as Q,ah as Y,o as D,c as ee,a0 as s,_ as d,a4 as ae,a as b,u as p,W as V,X as k,z as S,a2 as te,Z as re,ac as oe,aa as ne,n as ie}from"./@vue-0.0.0-dataease.js";import{p as pe,n as le,o as se}from"./util-0.0.0-dataease2.js";import{d as me,v as ue}from"./lodash-es-0.0.0-dataease.js";import{_ as ce}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";const de={style:{width:"100%"}},ge=["id"],fe=["title"],ve=X({__name:"MapMapping",props:{chart:{type:Object,required:!0},themes:{type:String,default:"dark"}},emits:["onMapMappingChange"],setup(A,{emit:F}){const $=A,I=F,{chart:_,themes:m}=Z($);j([()=>{var e;return(e=_.value)==null?void 0:e.senior.areaMapping},()=>{var e;return(e=_.value)==null?void 0:e.customAttr.map.id}],()=>{x()},{deep:!0});const h=c("body"),g=c(""),N=c(""),f=c(!1),w=c(""),z=c(null),M=E([]),v=H(()=>{var e;return(e=_.value)==null?void 0:e.customAttr.map.id}),n=E({mappingForm:{},currentData:[]}),l=E({pageSize:10,total:100,currentPage:1}),x=async()=>{var a;const e=JSON.parse(JSON.stringify(_.value));if(e!=null&&e.senior){let o=pe(e.senior);n.mappingForm=o.areaMapping;let t=(a=n.mappingForm)==null?void 0:a[v.value];t||(t=await B(v.value));const i=[];ue(t,(u,C)=>{i.push({originName:C,mappedName:u})}),n.currentData.splice(0,n.currentData.length,...i),l.total=n.currentData.length,y()}},B=async e=>e?e.startsWith("custom_")?(await le(e)).data.reduce((t,i)=>(t[i.name]=i.name,t),{}):(await se(e)).features.reduce((o,t)=>(o[t.properties.name]=t.properties.name,o),{}):{},J=e=>{var a;h.value=`#area-${e.$index}-input`,N.value=e.row.originName,g.value=e.row.mappedName,f.value=!0,ie((a=z.value)==null?void 0:a.focus)},P=()=>{h.value="body",f.value=!1;let e=n.mappingForm[v.value];e||(e=n.currentData.reduce((o,t)=>(o[t.originName]=t.mappedName,o),{})),e[N.value]!==g.value&&(e[N.value]=g.value,n.mappingForm[v.value]||(n.mappingForm[v.value]=e),T())},y=me(()=>{const e=n.currentData.filter(t=>{var i,u;return(i=w.value)!=null&&i.trim()?(u=t.mappedName)==null?void 0:u.includes(w.value):!0}),a=(l.currentPage-1)*l.pageSize,o=a+l.pageSize;M.splice(0,M.length,...e.slice(a,o)),l.total=e.length},300),T=()=>{I("onMapMappingChange",n.mappingForm)};return Q(()=>{x()}),(e,a)=>{const o=G,t=K,i=Y("Edit"),u=L,C=W,O=q,U=R;return D(),ee("div",de,[s(O,{size:"mini",class:S(["area-map-table","area-map-table-"+p(m)]),"header-cell-class-name":"area-map-table-header-cell-"+p(m),"header-row-class-name":"area-map-table-header-row-"+p(m),"cell-class-name":"area-map-table-cell-"+p(m),"row-class-name":"area-map-table-row-"+p(m),data:M},{empty:d(()=>a[6]||(a[6]=[ae(" 暂无数据 ")])),default:d(()=>[s(o,{label:"图形",prop:"originName",width:"80","show-overflow-tooltip":""}),s(o,{width:"140"},{header:d(()=>[a[5]||(a[5]=b("span",null,"属性",-1)),s(t,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=r=>w.value=r),size:"small",class:"area-filter",effect:p(m),onInput:p(y)},null,8,["modelValue","effect","onInput"])]),default:d(r=>[b("div",{id:`area-${r.$index}-input`},null,8,ge),V(s(C,{class:S(["area-edit-btn","area-edit-btn-"+p(m)]),size:"small",onClick:_e=>J(r)},{default:d(()=>[b("span",{title:r.row.mappedName},te(r.row.mappedName),9,fe),s(u,null,{default:d(()=>[s(i)]),_:1})]),_:2},1032,["class","onClick"]),[[k,!f.value||h.value!==`#area-${r.$index}-input`]])]),_:1})]),_:1},8,["class","header-cell-class-name","header-row-class-name","cell-class-name","row-class-name","data"]),s(U,{small:"","hide-on-single-page":"",layout:"prev, pager, next",class:"area-page","current-page":l.currentPage,"onUpdate:currentPage":a[1]||(a[1]=r=>l.currentPage=r),total:l.total,"page-size":l.pageSize,"pager-count":5,onCurrentChange:p(y)},null,8,["current-page","total","page-size","onCurrentChange"]),(D(),re(ne,{to:h.value,disabled:!f.value},[V(b("div",null,[s(t,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=r=>g.value=r),size:"small",ref_key:"areaNameInput",ref:z,effect:p(m),onBlur:a[3]||(a[3]=r=>P()),onKeyup:a[4]||(a[4]=oe(r=>r.target.blur(),["enter"]))},null,8,["modelValue","effect"])],512),[[k,f.value]])],8,["to","disabled"]))])}}});const ya=ce(ve,[["__scopeId","data-v-90c377b3"]]);export{ya as default};

import"./index-0.0.0-dataease.js";import{E as L}from"./el-pagination-0.0.0-dataease.js";import{G as O,j,y as q}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{a as K,E as W}from"./el-table-column-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{d as R,t as Z,w as H,r as c,Z as E,G as Q,o as X,e as Y,f as D,L as ee,k as p,i as d,a5 as ae,M as b,j as s,T as k,W as S,U as V,a6 as te,g as ne,ac as re,af as oe,n as le}from"./vue-0.0.0-dataease.js";import{p as se,n as ie,o as pe}from"./util-0.0.0-dataease2.js";import{e as me,q as ue}from"./lodash-0.0.0-dataease.js";import{_ as ce}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";const de={style:{width:"100%"}},ge=["id"],fe=["title"],ve=R({__name:"MapMapping",props:{chart:{type:Object,required:!0},themes:{type:String,default:"dark"}},emits:["onMapMappingChange"],setup(A,{emit:F}){const $=A,I=F,{chart:_,themes:m}=Z($);H([()=>{var e;return(e=_.value)==null?void 0:e.senior.areaMapping},()=>{var e;return(e=_.value)==null?void 0:e.customAttr.map.id}],()=>{z()},{deep:!0});const h=c("body"),g=c(""),M=c(""),f=c(!1),w=c(""),x=c(null),N=E([]),v=Q(()=>{var e;return(e=_.value)==null?void 0:e.customAttr.map.id}),o=E({mappingForm:{},currentData:[]}),i=E({pageSize:10,total:100,currentPage:1}),z=async()=>{var a;const e=JSON.parse(JSON.stringify(_.value));if(e!=null&&e.senior){let r=se(e.senior);o.mappingForm=r.areaMapping;let t=(a=o.mappingForm)==null?void 0:a[v.value];t||(t=await B(v.value));const l=[];ue(t,(u,C)=>{l.push({originName:C,mappedName:u})}),o.currentData.splice(0,o.currentData.length,...l),i.total=o.currentData.length,y()}},B=async e=>e?e.startsWith("custom_")?(await ie(e)).data.reduce((t,l)=>(t[l.name]=l.name,t),{}):(await pe(e)).features.reduce((r,t)=>(r[t.properties.name]=t.properties.name,r),{}):{},J=e=>{var a;h.value=`#area-${e.$index}-input`,M.value=e.row.originName,g.value=e.row.mappedName,f.value=!0,le((a=x.value)==null?void 0:a.focus)},P=()=>{h.value="body",f.value=!1;let e=o.mappingForm[v.value];e||(e=o.currentData.reduce((r,t)=>(r[t.originName]=t.mappedName,r),{})),e[M.value]!==g.value&&(e[M.value]=g.value,o.mappingForm[v.value]||(o.mappingForm[v.value]=e),T())},y=me(()=>{const e=o.currentData.filter(t=>{var l,u;return(l=w.value)!=null&&l.trim()?(u=t.mappedName)==null?void 0:u.includes(w.value):!0}),a=(i.currentPage-1)*i.pageSize,r=a+i.pageSize;N.splice(0,N.length,...e.slice(a,r)),i.total=e.length},300),T=()=>{I("onMapMappingChange",o.mappingForm)};return X(()=>{z()}),(e,a)=>{const r=K,t=O,l=Y("Edit"),u=j,C=q,G=W,U=L;return D(),ee("div",de,[p(G,{size:"mini",class:V(["area-map-table","area-map-table-"+s(m)]),"header-cell-class-name":"area-map-table-header-cell-"+s(m),"header-row-class-name":"area-map-table-header-row-"+s(m),"cell-class-name":"area-map-table-cell-"+s(m),"row-class-name":"area-map-table-row-"+s(m),data:N},{empty:d(()=>a[6]||(a[6]=[ae(" 暂无数据 ")])),default:d(()=>[p(r,{label:"图形",prop:"originName",width:"80","show-overflow-tooltip":""}),p(r,{width:"140"},{header:d(()=>[a[5]||(a[5]=b("span",null,"属性",-1)),p(t,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=n=>w.value=n),size:"small",class:"area-filter",effect:s(m),onInput:s(y)},null,8,["modelValue","effect","onInput"])]),default:d(n=>[b("div",{id:`area-${n.$index}-input`},null,8,ge),k(p(C,{class:V(["area-edit-btn","area-edit-btn-"+s(m)]),size:"small",onClick:_e=>J(n)},{default:d(()=>[b("span",{title:n.row.mappedName},te(n.row.mappedName),9,fe),p(u,null,{default:d(()=>[p(l)]),_:1})]),_:2},1032,["class","onClick"]),[[S,!f.value||h.value!==`#area-${n.$index}-input`]])]),_:1})]),_:1},8,["class","header-cell-class-name","header-row-class-name","cell-class-name","row-class-name","data"]),p(U,{small:"","hide-on-single-page":"",layout:"prev, pager, next",class:"area-page","current-page":i.currentPage,"onUpdate:currentPage":a[1]||(a[1]=n=>i.currentPage=n),total:i.total,"page-size":i.pageSize,"pager-count":5,onCurrentChange:s(y)},null,8,["current-page","total","page-size","onCurrentChange"]),(D(),ne(oe,{to:h.value,disabled:!f.value},[k(b("div",null,[p(t,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=n=>g.value=n),size:"small",ref_key:"areaNameInput",ref:x,effect:s(m),onBlur:a[3]||(a[3]=n=>P()),onKeyup:a[4]||(a[4]=re(n=>n.target.blur(),["enter"]))},null,8,["modelValue","effect"])],512),[[S,f.value]])],8,["to","disabled"]))])}}});const Oe=ce(ve,[["__scopeId","data-v-90c377b3"]]);export{Oe as default};

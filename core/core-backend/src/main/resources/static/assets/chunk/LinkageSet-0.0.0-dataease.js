import{b as ht,a as yt,M as $e,aA as kt,u as wt,p as It}from"./index-0.0.0-dataease.js";import{E as Ge}from"./el-dialog-0.0.0-dataease.js";import{o as Ue,v as xt,D as ke,n as He,j as je,y as Xe,G as bt,P as Vt}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import"./el-aside-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as Ct,a as St}from"./el-tabs-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as Qe,a as Ye}from"./el-select-0.0.0-dataease.js";import{E as et}from"./el-tree-0.0.0-dataease.js";import{E as tt}from"./el-checkbox-0.0.0-dataease.js";import{E as At}from"./el-tree-select-0.0.0-dataease.js";import{a as Jt,E as Ft}from"./el-form-item-0.0.0-dataease.js";import"./el-radio-group-0.0.0-dataease.js";import{E as lt,a as at}from"./el-radio-0.0.0-dataease.js";import{E as it}from"./el-col-0.0.0-dataease.js";import{E as nt}from"./el-switch-0.0.0-dataease.js";import{E as Be}from"./el-row-0.0.0-dataease.js";import{f as u,L as b,M as s,d as ze,r as z,t as ot,Z as We,a as zt,g as _,ah as st,G as me,w as Oe,aa as rt,T as K,i as t,k as e,a6 as r,j as a,m as M,a5 as m,ab as se,U as le,a0 as P,Y as D,a9 as q,n as we,e as Pe,W as te}from"./vue-0.0.0-dataease.js";import{i as fe}from"./field-list-0.0.0-dataease.js";import{a as re}from"./chart-list-0.0.0-dataease.js";import{d as Fe}from"./dv-link-target-0.0.0-dataease.js";import{d as Lt}from"./dv-dashboard-spine-0.0.0-dataease.js";import{d as Tt}from"./dv-folder-0.0.0-dataease.js";import{i as Me}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as Re}from"./icon_info_outlined-0.0.0-dataease.js";import{d as Et}from"./dv-screen-spine-0.0.0-dataease.js";import{H as Dt,I as Nt,J as $t,q as dt,K as Ot,j as Pt,k as Mt,L as Ut,M as jt}from"./canvasUtils-0.0.0-dataease.js";import{d as ut}from"./dvMain-0.0.0-dataease.js";import{f as W}from"./attr-0.0.0-dataease20.js";import{e as Bt,r as Wt}from"./dataVisualization-0.0.0-dataease.js";import{o as ct,I as Kt}from"./dataset-0.0.0-dataease.js";import qt from"./CodeMirror-0.0.0-dataease.js";import{s as pt}from"./snapshot-0.0.0-dataease.js";import{E as Ze}from"./EmptyBackground-0.0.0-dataease.js";import{useAppStoreWithOut as Rt}from"./app-0.0.0-dataease.js";import{g as Zt}from"./util-0.0.0-dataease.js";import{t as Gt}from"./treeSortUtils-0.0.0-dataease.js";import{E as Ht,b as Xt,c as Qt}from"./index-0.0.0-dataease14.js";import{E as Yt}from"./index-0.0.0-dataease3.js";import{_ as Ke}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import{d as el}from"./dv-empty-0.0.0-dataease.js";import{E as tl}from"./el-popover-0.0.0-dataease.js";import{A as ll}from"./dataVisualization-0.0.0-dataease2.js";const al={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function il(ae,O){return u(),b("svg",al,O[0]||(O[0]=[s("path",{d:"M0.666016 5.09541C0.666016 4.83398 0.818817 4.59668 1.05681 4.4885L7.72348 1.45819C7.89876 1.37852 8.09993 1.37852 8.27522 1.45819L14.9419 4.4885C15.1799 4.59668 15.3327 4.83398 15.3327 5.09541V11.5874C15.3327 11.84 15.19 12.0708 14.9642 12.1837L8.29749 15.5171C8.10981 15.6109 7.88889 15.6109 7.70121 15.5171L1.03454 12.1837C0.808684 12.0708 0.666016 11.84 0.666016 11.5874V5.09541ZM12.8112 4.98463L7.99935 2.79741L3.16148 4.99644L7.97266 7.06896L12.8112 4.98463ZM8.66602 8.22206V13.8421L13.9993 11.1754V5.92461L8.66602 8.22206ZM1.99935 5.94761V11.1754L7.33268 13.8421V8.24505L1.99935 5.94761Z",fill:"#3370FF"},null,-1)]))}const ft={render:il},nl=ze({__name:"JumpSetOuterContentEditor",props:{linkJumpInfoArray:Array,linkJumpInfo:Object},setup(ae,{expose:O}){const U=z(null),w=z(null),H=ae,{linkJumpInfo:de}=ot(H),L=We({name2Auto:[],content:""}),d=z(null),T=J=>{w.value.dispatch({changes:{from:w.value.viewState.state.selection.ranges[0].from,insert:J},selection:{anchor:w.value.viewState.state.selection.ranges[0].from}})},x=(J,A,C,N)=>{if(!C)return C;let l=C;const p=H.linkJumpInfoArray.reduce((Z,$)=>(Z[$[J]]=$[A],Z),{}),j=C.match(/\[(.+?)\]/g);return j&&j.forEach(Z=>{const $=Z.slice(1,-1);N&&N.push(p[$]),l=l.replace(`[${$}]`,`[${p[$]}]`)}),l};return O({editorInit:J=>{L.name2Auto=[],w.value||(w.value=U.value.codeComInit()),L.content=x("sourceFieldId","sourceFieldName",J,L.name2Auto),w.value.dispatch({changes:{from:0,to:w.value.viewState.state.doc.length,insert:L.content}}),clearTimeout(d.value),d.value=setInterval(()=>{const A=w.value?w.value.state.doc.toString():"",C=x("sourceFieldName","sourceFieldId",A,L.name2Auto);de.value.content=C},1500)},insertFieldToCodeMirror:T}),zt(()=>{var J,A;clearTimeout(d.value),w.value&&((A=(J=w.value).destroy)==null||A.call(J))}),(J,A)=>(u(),_(qt,{quotaMap:H.linkJumpInfoArray.map(C=>C.sourceFieldName),ref_key:"myCm",ref:U,"dom-id":"jumpSetField",style:{height:"100%"}},null,8,["quotaMap"]))}}),ol={class:"top-area"},sl={class:"top-area-text"},rl={class:"top-area-value"},dl={class:"top-area-text margin-left"},ul={class:"top-area-value"},cl={class:"head-text"},pl={class:"head-filter"},fl={class:"custom-tree-node"},ml={class:"auth-span"},_l=["title"],vl={class:"tree-select-field"},gl={class:"title"},hl={class:"title"},yl={class:"title"},kl={class:"m-row"},wl={style:{flex:"1"}},Il={class:"icon-center"},xl={style:{flex:"1"}},bl={class:"label-content-details"},Vl=["title"],Cl={class:"jump-com-list"},Sl={style:{flex:"1"}},Al={class:"custom-option"},Jl={style:{float:"left","margin-left":"4px","font-size":"14px"}},Fl={class:"icon-center"},zl={style:{flex:"1"}},Ll={class:"custom-option"},Tl={style:{float:"left","margin-left":"4px","font-size":"14px"}},El={style:{flex:"1",margin:"0 8px"}},Dl={class:"custom-option"},Nl={style:{float:"left","margin-left":"4px","font-size":"14px"}},$l={key:0},Ol={key:1},Pl={style:{flex:"1"}},Ml={class:"custom-option"},Ul={style:{float:"left","margin-left":"4px","font-size":"14px"}},jl={class:"icon-center"},Bl={style:{flex:"1"}},Wl={class:"custom-option"},Kl={style:{float:"left","margin-left":"4px","font-size":"14px"}},ql={class:"url-text"},Rl={class:"outer-content-mirror"},Zl={class:"url-text"},Gl=["innerHTML"],Hl={class:"outer-content-right"},Xl=["title","onClick"],Ql={key:1,class:"empty"},Yl="_blank",ea=ze({__name:"LinkJumpSet",setup(ae,{expose:O}){const U=ut(),{dvInfo:w,canvasViewInfo:H,componentData:de}=st(U),L=z(null),{t:d}=Ue(),T=z(!1),x=pt(),R=Rt(),J=ht(),A=me(()=>w.value.type==="dashboard"?d("work_branch.dashboard"):d("work_branch.big_data_screen")),C=d("visualization.select_target_resource"),N=d("visualization.target_dashboard_dataV");w.value.type==="dashboard"?d("visualization.cur_dashboard"):d("visualization.cur_screen");const l=We({curDataVWeight:0,activeCollapse:"view",loading:!1,showSelected:!1,curJumpViewInfo:{},curDatasetInfo:{},tempId:null,initState:!1,viewId:null,name2Auto:[],searchField:"",searchFunction:"",inputType:"self",fieldName:"name",tableRadio:null,keyWordSearch:"",columnLabel:d("visualization.belong_to_category"),templateList:[],importTemplateInfo:{snapshot:""},sourceViewFields:[],dvSelectProps:{label:"name",children:"children",value:"id",isLeaf:"leaf",disabled:"disabled"},treeProp:{id:"sourceFieldId",label:"sourceFieldName",children:"children"},linkJump:null,linkJumpInfoArray:[],linkJumpInfoXArray:[],linkJumpCurViewFieldArray:[],linkJumpCurFilterFieldArray:[],mapJumpInfoArray:{},panelList:[],linkJumpInfo:null,currentFiledTreeNode:null,defaultLinkJumpInfo:{linkType:"outer",jumpType:"_self",targetViewInfoList:[]},defaultTargetViewInfo:{targetViewId:null,targetFieldId:null},currentLinkPanelViewArray:[],viewIdFieldArrayMap:{},dimensionData:[],dimensionList:[],quotaList:[],quotaData:[],dimension:[],quota:[],currentOutParams:[]}),{wsCache:p}=yt(),j=z(null),Z=c=>{l.showSelected=!1,T.value=!0,l.initState=!1,ie(c)},$=c=>{c.forEach(n=>{n.component==="VQuery"&&n.propValue instanceof Array?n.propValue.forEach(o=>{o.checkedFields.includes(l.viewId)&&l.linkJumpCurFilterFieldArray.push({id:o.id,name:o.name,deType:"filter"})}):n.component==="Group"?$(n.propValue):n.component==="DeTabs"&&n.propValue.forEach(o=>{$(o.componentData)})})},ie=c=>{l.initState=!1,l.viewId=c.id,l.activeCollapse="view";const n=H.value[l.viewId];l.curJumpViewInfo=n;let o=JSON.stringify(n.xAxis)+JSON.stringify(n.xAxisExt)+JSON.stringify(n.yAxis)+JSON.stringify(n.yAxisExt)+JSON.stringify(n.drillFields),i;if(n.type.indexOf("stack")>-1&&n.extStack.length>2){const v=n.yAxis,k=v.length>0?JSON.stringify(v[0]):"[]";o=JSON.stringify(n.xAxis)+JSON.stringify(n.xAxisExt)+JSON.stringify(k)+JSON.stringify(n.yAxisExt)+JSON.stringify(n.drillFields),i=o}else n.type==="table-pivot"?i=o:n.type==="table-info"?i=JSON.stringify(n.xAxis)+JSON.stringify(n.drillFields):i=o;Bt({busiFlag:"dashboard-dataV"}).then(v=>{var V;v&&((V=v[0])==null?void 0:V.id)==="0"?l.panelList=v[0].children:l.panelList=v,l.panelList=Dt(l.panelList);const k=p.get(`TreeSort-${w.value.type}`)||"time_asc";l.panelList=Gt(l.panelList,k)}),l.linkJumpCurFilterFieldArray=[],$(de.value),n.tableId&&(ct(n.tableId).then(v=>{l.curDatasetInfo=v||{}}),Kt(n.tableId).then(v=>{l.linkJumpCurViewFieldArray=[],v.data.forEach(V=>{o.indexOf(V.id)>-1&&l.linkJumpCurViewFieldArray.push(V)})}),Nt(w.value.id,l.viewId).then(v=>{l.linkJump=v.data,l.linkJumpInfoArray=[],l.linkJumpInfoXArray=[],l.linkJump.linkJumpInfoArray.forEach(V=>{i.indexOf(V.sourceFieldId)>-1?(l.mapJumpInfoArray[V.sourceFieldId]=V,l.linkJumpInfoArray.push(V),l.linkJumpInfoXArray.push(V)):o.indexOf(V.sourceFieldId)>-1&&l.linkJumpInfoArray.push(V)});const k=l.linkJumpInfoArray[0];l.initState=!0,we(()=>{L.value.setCurrentKey(k==null?void 0:k.sourceFieldId),ue(k)})}))},ne=()=>{let c=0;l.linkJump.linkJumpInfoArray.forEach(n=>{if(n.checked){let o=0;n.linkType==="inner"&&(n.targetDvId||(o++,c++),n.targetViewInfoList&&n.targetViewInfoList.forEach(function(i){i.sourceFieldActiveId&&i.targetFieldId&&i.targetViewId||(o++,c++)})),n.linkType==="outer"&&(n.content||(o++,c++)),o>0&&ke.error(d("visualization.jump_null_tips",[n.sourceFieldName]))}}),!c&&(l.loading=!0,$t(l.linkJump).then(()=>{x.recordSnapshotCache("updateJumpSet"),ke.success(d("common.save_success")),dt(w.value.id).then(n=>{U.setNowPanelJumpInfo(n.data),ge()}),l.loading=!1}).catch(()=>{l.loading=!1}))},ue=c=>{l.linkJumpInfo=l.mapJumpInfoArray[c.sourceFieldId],l.linkJumpInfo.windowSize||(l.linkJumpInfo.windowSize="middle"),l.linkJumpInfo.linkType||(l.linkJumpInfo.linkType="outer"),l.linkJumpInfo.jumpType||(l.linkJumpInfo.jumpType="_blank"),l.linkJumpInfo.content||(l.linkJumpInfo.content="http://"),l.linkJumpInfo.attachParams||(l.linkJumpInfo.attachParams=!1),l.linkJumpInfo.targetDvId&&_e(l.linkJumpInfo.targetDvId),Ie(l.linkJumpInfo.content)},Ie=c=>{we(()=>{var n;(n=j.value)==null||n.editorInit(c)})},_e=c=>{Ot(c).then(n=>{l.viewIdFieldArrayMap={},l.currentLinkPanelViewArray=n.data.visualizationViewTables,l.currentLinkPanelViewArray&&l.currentLinkPanelViewArray.forEach(o=>{l.viewIdFieldArrayMap[o.id]=o.tableFields}),l.currentOutParams=n.data.outParamsJumpInfo||[],l.currentOutParams&&l.currentOutParams.length>0&&l.currentOutParams.forEach(o=>{l.currentLinkPanelViewArray.push(o),l.viewIdFieldArrayMap[o.id]=[{id:"1000001",name:d("visualization.out_params_no_select")}]}),JSON.parse(n.data.bashComponentData).forEach(o=>{o.component==="VQuery"&&o.propValue instanceof Array&&o.propValue.forEach(i=>{l.currentLinkPanelViewArray.push({id:i.id,type:"filter",name:i.name,title:i.name}),l.viewIdFieldArrayMap[i.id]=[{id:"1000001",name:d("visualization.filter_no_select")}]})})})},xe=c=>{c.leaf&&(l.curDataVWeight=c.weight,l.linkJumpInfo.targetViewInfoList=[],ve(),_e(c.id))},ve=(c="view")=>{l.linkJumpInfo.targetViewInfoList.push({targetId:Zt(),targetViewId:"",targetType:c,targetFieldId:""})},be=c=>{if(c){let n;l.linkJumpInfo.targetViewInfoList.forEach((o,i)=>{c===o.targetId&&(n=i)}),n!==void 0&&l.linkJumpInfo.targetViewInfoList.splice(n,1)}},Le=c=>l.viewIdFieldArrayMap[c.targetViewId]&&l.viewIdFieldArrayMap[c.targetViewId].length===1&&l.viewIdFieldArrayMap[c.targetViewId][0].id==="1000001"||!c.sourceFieldActiveId,Ve=c=>{l.viewIdFieldArrayMap[c.targetViewId]&&l.viewIdFieldArrayMap[c.targetViewId].length===1&&l.viewIdFieldArrayMap[c.targetViewId][0].id==="1000001"?c.targetFieldId="1000001":c.targetFieldId=null},Te=c=>{we(()=>{L.value.setCurrentKey(c.sourceFieldId),ue(c)})},ge=()=>{T.value=!1,l.initState=!1},he=c=>{j.value.insertFieldToCodeMirror(c)},ye=me(()=>l.linkJumpInfo&&l.linkJumpInfo.linkType==="outer"&&T.value),Ee=(c,n)=>!c||n.checked,De=me(()=>R.getIsDataEaseBi||R.getIsIframe),Ce=async c=>{if(l.curDataVWeight&&l.curDataVWeight<7){ke.error(d("visualization.no_edit_auth"));return}let n;await Wt(c).then(h=>{n=h.data});const o=n==="dataV"?"#/dvCanvas?dvId=":"#/dashboard?resourceId=";if(De.value){J.clearState(),w.value.type==="dataV"?J.setDvId(c):J.setResourceId(c),wt().emitter.emit("changeCurrentComponent",w.value.type==="dataV"?"VisualizationEditor":"DashboardEditor");return}const i=window.open(o+c,Yl);Se(i)},oe=z(null),Se=c=>{if(oe!=null&&oe.value){const n={methodName:"initOpenHandler",args:c};oe.value.invokeMethod(n)}};return Oe(()=>l.showSelected,c=>{var n;(n=L.value)==null||n.filter(c)}),Oe(()=>ye.value,c=>{c&&Ie(l.linkJumpInfo.content)}),O({dialogInit:Z}),(c,n)=>{const o=He,i=Be,h=nt,v=tt,k=je,V=et,S=it,E=lt,X=at,ee=Jt,Ae=Ht,Q=Qe,Y=Ye,ce=At,Je=Ct,Ne=St,g=Xe,G=Ft,F=Yt,mt=bt,_t=Xt,vt=Qt,gt=Ge,qe=rt("loading");return K((u(),_(gt,{ref:"enlargeDialog","append-to-body":!0,title:a(d)("visualization.jump_set"),modelValue:T.value,"onUpdate:modelValue":n[16]||(n[16]=I=>T.value=I),width:"70vw",top:"10vh",trigger:"click"},{default:t(()=>[l.initState?(u(),b("div",{key:0,onKeydown:n[14]||(n[14]=se(()=>{},["stop"])),onKeyup:n[15]||(n[15]=se(()=>{},["stop"])),style:{height:"550px"}},[e(i,{style:{"flex-direction":"row"}},{default:t(()=>[s("div",ol,[s("span",sl,r(a(d)("visualization.selected_view"))+"：",1),s("span",rl,[e(o,{"class-name":"view-type-icon"},{default:t(()=>[(u(),_(M(a(re)[l.curJumpViewInfo.type]),{class:"svg-icon view-type-icon"}))]),_:1}),m(" "+r(l.curJumpViewInfo.title),1)]),s("span",dl,r(a(d)("visualization.used_dataset"))+"：",1),s("span",ul,[e(o,{name:"dataset-outline"},{default:t(()=>[e(a(ft),{style:{"vertical-align":"-0.2em"},class:"svg-icon view-type-icon"})]),_:1}),m(" "+r(l.curDatasetInfo.name),1)])])]),_:1}),K((u(),_(i,null,{default:t(()=>[e(i,{class:"preview"},{default:t(()=>[e(S,{span:8,style:{height:"100%","overflow-y":"auto"}},{default:t(()=>[e(i,{class:"tree-head"},{default:t(()=>[s("span",cl,r(a(d)("visualization.to_select_view")),1),s("span",pl,[m(r(a(d)("visualization.show_selected_only"))+" ",1),e(h,{size:"small",modelValue:l.showSelected,"onUpdate:modelValue":n[0]||(n[0]=I=>l.showSelected=I)},null,8,["modelValue"])])]),_:1}),e(V,{menu:"",ref_key:"linkJumpInfoTree",ref:L,"filter-node-method":Ee,data:l.linkJumpInfoXArray,"node-key":"sourceFieldId","highlight-current":"",props:l.treeProp,onNodeClick:ue},{default:t(({data:I})=>[s("span",fl,[s("span",null,[s("div",{onClick:n[1]||(n[1]=se(()=>{},["stop"]))},[s("span",ml,[e(v,{modelValue:I.checked,"onUpdate:modelValue":B=>I.checked=B,onChange:B=>Te(I)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),s("span",{title:I.sourceFieldName},[s("span",vl,[e(k,{style:{"margin-right":"4px"}},{default:t(()=>[e(o,null,{default:t(()=>[(u(),_(M(a(fe)[a(W)[I.sourceDeType]]),{class:le(["svg-icon",`field-icon-${a(W)[I.sourceDeType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m(" "+r(I.sourceFieldName),1)])],8,_l)])]),_:1},8,["data","props"])]),_:1}),e(S,{span:16,class:"preview-show"},{default:t(()=>[e(vt,{class:"settings-container"},{default:t(()=>[e(Ae,{class:"settings-header"},{default:t(()=>{var I;return[e(ee,{class:"radio-group-box"},{label:t(()=>[s("span",gl,r(a(d)("visualization.link_type")),1)]),default:t(()=>[l.linkJumpInfo?(u(),_(X,{key:0,class:"larger-radio",modelValue:l.linkJumpInfo.linkType,"onUpdate:modelValue":n[2]||(n[2]=B=>l.linkJumpInfo.linkType=B)},{default:t(()=>[e(E,{label:"outer"},{default:t(()=>[m(r(a(d)("visualization.link_outer")),1)]),_:1}),e(E,{label:"inner"},{default:t(()=>[m(r(a(d)("visualization.dashboard_dataV")),1)]),_:1})]),_:1},8,["modelValue"])):P("",!0),l.linkJumpInfo?P("",!0):(u(),_(X,{key:1,class:"larger-radio",disabled:""},{default:t(()=>[e(E,{label:"outer"},{default:t(()=>[m(r(a(d)("visualization.link_outer")),1)]),_:1}),e(E,{label:"inner"},{default:t(()=>[m(r(A.value),1)]),_:1})]),_:1}))]),_:1}),e(ee,{class:"radio-group-box"},{label:t(()=>[s("span",hl,r(a(d)("visualization.open_model")),1)]),default:t(()=>[l.linkJumpInfo?(u(),_(X,{key:0,class:"larger-radio",modelValue:l.linkJumpInfo.jumpType,"onUpdate:modelValue":n[3]||(n[3]=B=>l.linkJumpInfo.jumpType=B)},{default:t(()=>[e(E,{label:"_self"},{default:t(()=>[m(r(a(d)("visualization.now_window")),1)]),_:1}),e(E,{label:"_blank"},{default:t(()=>[m(r(a(d)("visualization.new_window")),1)]),_:1}),e(E,{label:"newPop"},{default:t(()=>[m(r(a(d)("visualization.pop_window")),1)]),_:1})]),_:1},8,["modelValue"])):P("",!0),l.linkJumpInfo?P("",!0):(u(),_(X,{key:1,class:"larger-radio",disabled:""},{default:t(()=>[e(E,{label:"_self"},{default:t(()=>[m(r(a(d)("visualization.now_window")),1)]),_:1}),e(E,{label:"_blank"},{default:t(()=>[m(r(a(d)("visualization.new_window")),1)]),_:1}),e(E,{label:"newPop"},{default:t(()=>[m(r(a(d)("visualization.pop_window")),1)]),_:1})]),_:1}))]),_:1}),((I=l.linkJumpInfo)==null?void 0:I.jumpType)==="newPop"?(u(),_(ee,{key:0,class:"radio-group-box"},{label:t(()=>[s("span",yl,r(a(d)("visualization.window_size")),1)]),default:t(()=>[e(X,{class:"larger-radio",modelValue:l.linkJumpInfo.windowSize,"onUpdate:modelValue":n[4]||(n[4]=B=>l.linkJumpInfo.windowSize=B)},{default:t(()=>[e(E,{label:"large"},{default:t(()=>[m(r(a(d)("visualization.window_size_large")),1)]),_:1}),e(E,{label:"middle"},{default:t(()=>[m(r(a(d)("visualization.window_size_middle")),1)]),_:1}),e(E,{label:"small"},{default:t(()=>[m(r(a(d)("visualization.window_size_small")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):P("",!0)]}),_:1}),e(_t,{class:"settings-main"},{default:t(()=>[l.linkJumpInfo?(u(),b(D,{key:0},[l.linkJumpInfo.linkType==="inner"?(u(),_(G,{key:0,"label-position":"top",class:"main-form"},{default:t(()=>{var I,B;return[s("div",kl,[s("div",wl,[e(ee,null,{label:t(()=>[m(r(a(w).type==="dashboard"?a(d)("visualization.cur_dashboard"):a(d)("visualization.cur_screen")),1)]),default:t(()=>[e(Y,{style:{width:"100%"},modelValue:a(w).name,"onUpdate:modelValue":n[5]||(n[5]=y=>a(w).name=y),disabled:""},{default:t(()=>[(u(),_(Q,{key:a(w).name,label:a(w).name,value:a(w).name},null,8,["label","value"]))]),_:1},8,["modelValue"])]),_:1})]),s("div",Il,[e(o,{name:"dv-link-target"},{default:t(()=>[e(a(Fe),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),s("div",xl,[e(ee,null,{label:t(()=>[m(r(a(N)),1)]),default:t(()=>[e(ce,{modelValue:l.linkJumpInfo.targetDvId,"onUpdate:modelValue":n[6]||(n[6]=y=>l.linkJumpInfo.targetDvId=y),data:l.panelList,props:l.dvSelectProps,"render-after-expand":!1,filterable:"",onNodeClick:xe,class:"dv-selector"},{default:t(({node:y,data:pe})=>[s("div",bl,[pe.leaf?(u(),_(k,{key:0,size:"18px",style:{display:"inline-block"}},{default:t(()=>[e(o,{name:"dv-dashboard-spine"},{default:t(()=>[pe.type==="dashboard"?(u(),_(a(Lt),{key:0,class:"svg-icon"})):(u(),_(a(Et),{key:1,class:"svg-icon"}))]),_:2},1024)]),_:2},1024)):(u(),_(k,{key:1,size:"18px",style:{display:"inline-block"}},{default:t(()=>[e(o,{name:"dv-folder"},{default:t(()=>[e(a(Tt),{class:"svg-icon"})]),_:1})]),_:1})),s("span",{style:{"margin-left":"8px","font-size":"14px"},title:y.label},r(y.label),9,Vl)])]),_:1},8,["modelValue","data","props"])]),_:1})])]),l.linkJumpInfo.targetDvId?(u(),b(D,{key:0},[s("div",Cl,[e(Ne,{size:"small",modelValue:l.activeCollapse,"onUpdate:modelValue":n[7]||(n[7]=y=>l.activeCollapse=y)},{default:t(()=>[e(Je,{label:a(d)("visualization.linkage_view"),name:"view"},null,8,["label"]),e(Je,{label:a(d)("visualization.with_filter_params"),name:"filter"},null,8,["label"])]),_:1},8,["modelValue"])]),l.activeCollapse==="view"?(u(),b(D,{key:0},[e(i,{style:{"margin-bottom":"8px"},gutter:8},{default:t(()=>[e(S,{span:7},{default:t(()=>[m(r(a(d)("visualization.source_field")),1)]),_:1}),e(S,{span:2}),e(S,{span:7,style:{"margin-left":"-2.9%"}},{default:t(()=>[m(r(a(d)("visualization.link_view_field")),1)]),_:1}),e(S,{span:8})]),_:1}),s("div",{class:le(["main-scrollbar-container",{"main-scrollbar-container-min":((I=l.linkJumpInfo)==null?void 0:I.jumpType)==="newPop"}])},[e(a($e),{height:"fit-content","max-height":"178px"},{default:t(()=>[(u(!0),b(D,null,q(l.linkJumpInfo.targetViewInfoList.filter(y=>y.targetType==="view"),(y,pe)=>(u(),b("div",{style:{display:"flex","margin-bottom":"6px"},key:pe},[s("div",Sl,[e(Y,{modelValue:y.sourceFieldActiveId,"onUpdate:modelValue":f=>y.sourceFieldActiveId=f,placeholder:a(d)("chart.pls_select_field"),style:{width:"100%"}},{default:t(()=>[(u(!0),b(D,null,q(l.linkJumpCurViewFieldArray,f=>(u(),_(Q,{key:f.id,label:f.name,value:f.id},{default:t(()=>[s("span",Al,[e(o,null,{default:t(()=>[(u(),_(M(a(fe)[a(W)[f.deType]]),{class:le(["svg-icon",`field-icon-${a(W)[f.deType]}`]),style:{width:"14px",height:"14px"}},null,8,["class"]))]),_:2},1024),s("span",Jl,r(f.name),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),s("div",Fl,[e(o,{name:"dv-link-target"},{default:t(()=>[e(a(Fe),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),s("div",zl,[e(Y,{modelValue:y.targetViewId,"onUpdate:modelValue":f=>y.targetViewId=f,disabled:!y.sourceFieldActiveId,placeholder:a(d)("visualization.select_view"),style:{width:"100%"},onChange:f=>Ve(y)},{default:t(()=>[(u(!0),b(D,null,q(l.currentLinkPanelViewArray.filter(f=>f.type!=="outerParams"),f=>(u(),_(Q,{key:f.id,label:f.title,value:f.id},{default:t(()=>[s("span",Ll,[e(o,null,{default:t(()=>[(u(),_(M(a(re)[f.type]),{class:"svg-icon view-type-icon",style:{width:"14px",height:"14px"}}))]),_:2},1024),s("span",Tl,r(f.title),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","placeholder","onChange"])]),s("div",El,[e(Y,{modelValue:y.targetFieldId,"onUpdate:modelValue":f=>y.targetFieldId=f,placeholder:a(d)("chart.pls_select_field"),disabled:Le(y),style:{width:"100%"}},{default:t(()=>[(u(!0),b(D,null,q(l.viewIdFieldArrayMap[y.targetViewId],f=>(u(),_(Q,{key:f.id,label:f.name,value:f.id},{default:t(()=>[s("span",Dl,[e(o,null,{default:t(()=>[(u(),_(M(a(fe)[a(W)[f.deType]]),{class:le(["svg-icon",`field-icon-${a(W)[f.deType]}`]),style:{width:"14px",height:"14px"}},null,8,["class"]))]),_:2},1024),s("span",Nl,r(f.name),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","disabled"])]),e(g,{class:"m-del-icon-btn",text:"",onClick:f=>be(y.targetId)},{default:t(()=>[e(k,{size:"20px"},{default:t(()=>[e(o,{name:"icon_delete-trash_outlined"},{default:t(()=>[e(a(Me),{class:"svg-icon"})]),_:1})]),_:1})]),_:2},1032,["onClick"])]))),128))]),_:1}),e(g,{style:{"margin-top":"8px"},disabled:!l.linkJumpInfo.targetDvId,type:"primary",icon:"Plus",text:"",onClick:n[8]||(n[8]=y=>ve("view"))},{default:t(()=>[m(r(a(d)("visualization.add_jump_field")),1)]),_:1},8,["disabled"])],2)],64)):P("",!0),l.activeCollapse==="filter"?(u(),b(D,{key:1},[l.currentOutParams.length===0?(u(),b("span",$l,[m(r(a(d)("visualization.link_target_tips1")),1),s("a",{class:"target_jump",onClick:n[9]||(n[9]=y=>Ce(l.linkJumpInfo.targetDvId))},r(a(d)("visualization.link_target_tips2")),1)])):l.linkJumpCurFilterFieldArray.length===0?(u(),b("span",Ol,r(a(d)("visualization.jump_no_banding_tips")),1)):l.currentOutParams.length>0?(u(),b(D,{key:2},[e(i,{style:{"margin-bottom":"8px"},gutter:8},{default:t(()=>[e(S,{span:12},{default:t(()=>[m(r(a(d)("visualization.source_filter")),1)]),_:1}),e(S,{span:1}),e(S,{span:10,style:{"margin-left":"-2.9%"}},{default:t(()=>[m(r(a(d)("visualization.link_outer_params")),1)]),_:1})]),_:1}),s("div",{class:le(["main-scrollbar-container",{"main-scrollbar-container-min":((B=l.linkJumpInfo)==null?void 0:B.jumpType)==="newPop"}])},[e(a($e),{height:"fit-content","max-height":"178px"},{default:t(()=>[(u(!0),b(D,null,q(l.linkJumpInfo.targetViewInfoList.filter(y=>y.targetType==="outerParams"),(y,pe)=>(u(),b("div",{style:{display:"flex","margin-bottom":"6px"},key:pe},[s("div",Pl,[e(Y,{modelValue:y.sourceFieldActiveId,"onUpdate:modelValue":f=>y.sourceFieldActiveId=f,placeholder:a(d)("chart.pls_select_field"),style:{width:"100%"}},{default:t(()=>[(u(!0),b(D,null,q(l.linkJumpCurFilterFieldArray,f=>(u(),_(Q,{key:f.id,label:f.name,value:f.id},{default:t(()=>[s("span",Ml,[e(o,null,{default:t(()=>[(u(),_(M(a(re).filter),{class:"svg-icon",style:{width:"14px",height:"14px"}}))]),_:1}),s("span",Ul,r(f.name),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),s("div",jl,[e(o,{name:"dv-link-target"},{default:t(()=>[e(a(Fe),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),s("div",Bl,[e(Y,{modelValue:y.targetViewId,"onUpdate:modelValue":f=>y.targetViewId=f,disabled:!y.sourceFieldActiveId,placeholder:a(d)("visualization.select_param"),style:{width:"100%"},onChange:f=>Ve(y)},{default:t(()=>[(u(!0),b(D,null,q(l.currentOutParams,f=>(u(),_(Q,{key:f.id,label:f.title,value:f.id},{default:t(()=>[s("span",Wl,[e(o,null,{default:t(()=>[(u(),_(M(a(re)[f.type]),{class:"svg-icon view-type-icon",style:{width:"14px",height:"14px"}}))]),_:2},1024),s("span",Kl,r(f.title),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","placeholder","onChange"])]),e(g,{class:"m-del-icon-btn",text:"",onClick:f=>be(y.targetId)},{default:t(()=>[e(k,{size:"20px"},{default:t(()=>[e(o,{name:"icon_delete-trash_outlined"},{default:t(()=>[e(a(Me),{class:"svg-icon"})]),_:1})]),_:1})]),_:2},1032,["onClick"])]))),128))]),_:1}),e(g,{style:{"margin-top":"8px"},disabled:!l.linkJumpInfo.targetDvId,type:"primary",icon:"Plus",text:"",onClick:n[10]||(n[10]=y=>ve("outerParams"))},{default:t(()=>[m(r(a(d)("visualization.add_jump_field")),1)]),_:1},8,["disabled"])],2)],64)):P("",!0)],64)):P("",!0)],64)):(u(),_(Ze,{key:1,style:{height:"auto"},description:a(C),"img-type":"noneWhite"},null,8,["description"]))]}),_:1})):P("",!0),ye.value?(u(),_(i,{key:1,gutter:8,class:"main-form"},{default:t(()=>[e(S,{span:16,style:{height:"100%"}},{default:t(()=>[s("div",ql,[m(r(a(d)("visualization.target_url"))+" ",1),e(F,{class:"item",effect:"dark",placement:"bottom"},{content:t(()=>[m(r(c.$t("visualization.target_url_tips")),1)]),default:t(()=>[e(k,{size:"16px",class:"hint-icon"},{default:t(()=>[e(o,{name:"icon_info_outlined"},{default:t(()=>[e(a(Re),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),s("div",Rl,[e(nl,{ref_key:"outerContentEditor",ref:j,"link-jump-info":l.linkJumpInfo,"link-jump-info-array":l.linkJumpInfoArray},null,8,["link-jump-info","link-jump-info-array"])])]),_:1}),e(S,{span:8,style:{height:"100%"}},{default:t(()=>[s("div",Zl,[m(r(a(d)("visualization.select_world"))+" ",1),e(F,{class:"item",effect:"dark",placement:"bottom"},{content:t(()=>[s("span",{innerHTML:c.$t("chart.reference_field_tip")},null,8,Gl)]),default:t(()=>[e(k,{size:"16px",class:"hint-icon"},{default:t(()=>[e(o,{name:"icon_info_outlined"},{default:t(()=>[e(a(Re),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),s("div",Hl,[e(mt,{modelValue:l.searchField,"onUpdate:modelValue":n[11]||(n[11]=I=>l.searchField=I),placeholder:a(d)("dataset.search"),"prefix-icon":a(kt),clearable:""},null,8,["modelValue","placeholder","prefix-icon"]),e(a($e),{style:{"margin-top":"12px"},height:"250px"},{default:t(()=>[(u(!0),b(D,null,q(l.linkJumpInfoArray.filter(I=>!l.searchField||I.sourceFieldName.indexOf(l.searchField)>-1),I=>(u(),b("span",{key:I.sourceFieldId,class:"item-dimension",title:I.sourceFieldName,onClick:B=>he("["+I.sourceFieldName+"]")},[e(k,null,{default:t(()=>[e(o,null,{default:t(()=>[(u(),_(M(a(fe)[a(W)[I.sourceDeType]]),{class:le(["svg-icon",`field-icon-${a(W)[I.sourceDeType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m(" "+r(I.sourceFieldName),1)],8,Xl))),128))]),_:1})])]),_:1})]),_:1})):P("",!0)],64)):(u(),b("div",Ql,[e(Ze,{description:a(d)("visualization.select_dimension_hint"),"img-type":"noneWhite"},null,8,["description"])]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})),[[qe,l.loading]]),e(i,{class:"root-class"},{default:t(()=>[e(g,{size:"mini",onClick:n[12]||(n[12]=I=>ge())},{default:t(()=>[m(r(a(d)("common.cancel")),1)]),_:1}),e(g,{type:"primary",size:"mini",onClick:n[13]||(n[13]=I=>ne())},{default:t(()=>[m(r(a(d)("dataset.confirm")),1)]),_:1})]),_:1})],32)):P("",!0),e(a(xt),{ref_key:"openHandler",ref:oe,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)]),_:1},8,["title","modelValue"])),[[qe,l.loading]])}}});const Ci=Ke(ea,[["__scopeId","data-v-96cda48b"]]),ta={class:"option-set ed-dialog__title"},la={style:{"font-weight":"normal"}},aa={style:{"font-weight":"normal"}},ia=ze({__name:"LinkageSetOption",props:{title:It.string,baseWidth:{required:!1,type:String,default:"100%"},actionSelection:{required:!0,type:Object},themes:{type:String,default:"dark"}},setup(ae){const{t:O}=Ue(),U=ae;z();const w=()=>{},{title:H,themes:de,actionSelection:L}=ot(U);return(d,T)=>{const x=Pe("Setting"),R=je,J=Be,A=lt,C=at,N=tl;return u(),_(N,{placement:"right-start",width:"auto","popper-style":"max-width:"+ae.baseWidth,trigger:"click","show-arrow":!1},{reference:t(()=>[s("span",ta,[m(r(a(O)("visualization.linkage_setting"))+" ",1),e(R,{style:{margin:"5px 0 0 5px"}},{default:t(()=>[e(x)]),_:1})])]),default:t(()=>[e(J,null,{default:t(()=>[m(r(a(O)("visualization.select_linkage_tips")),1)]),_:1}),e(J,null,{default:t(()=>[e(C,{style:{"margin-top":"12px"},modelValue:a(L).linkageActive,"onUpdate:modelValue":T[0]||(T[0]=l=>a(L).linkageActive=l),onChange:w,class:"radio_group"},{default:t(()=>[e(A,{label:"custom"},{default:t(()=>[s("span",la,r(a(O)("visualization.linkage_option1")),1)]),_:1}),e(A,{label:"auto"},{default:t(()=>[s("span",aa,r(a(O)("visualization.linkage_option2")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["popper-style"])}}});const na=Ke(ia,[["__scopeId","data-v-b54512a6"]]),oa={class:"top-area"},sa={class:"top-area-text",style:{"margin-left":"0"}},ra={class:"top-area-value"},da={class:"top-area-text"},ua={class:"top-area-value"},ca={class:"head-text"},pa={class:"head-filter"},fa={class:"custom-tree-node"},ma={class:"auth-span"},_a={class:"tree-select-field"},va={class:"custom-tree-node"},ga={class:"auth-span"},ha={class:"tree-select-field"},ya={style:{display:"flex"},class:"inner-content"},ka={style:{flex:"1"}},wa={style:{flex:"1"}},Ia={style:{width:"100%","max-height":"350px","overflow-y":"auto"}},xa={style:{flex:"1"}},ba={class:"select-filed"},Va={class:"custom-option"},Ca={style:{float:"left","margin-left":"4px","font-size":"14px"}},Sa={style:{flex:"1"}},Aa={class:"select-filed"},Ja={class:"custom-option"},Fa={style:{float:"left","margin-left":"4px","font-size":"14px"}},za={style:{"margin-top":"8px","font-size":"14px"}},La=ze({__name:"LinkageSet",setup(ae,{expose:O}){const U=ut(),{dvInfo:w,canvasViewInfo:H,componentData:de,curComponent:L}=st(U),d=z(null),T=z(null),{t:x}=Ue(),R=z(!1),J=z(!1),A=z([]),C=z([]),N=z([]),l=pt(),p=We({sourceLinkageInfo:{},showSelected:!1,curLinkageViewInfo:{},curDatasetInfo:{},initState:!1,viewId:null,tableId:null,treeProp:{id:"targetViewId",label:"targetViewName",children:"children"},linkageInfo:null}),j=z(!1),Z=z(!1),$=z(Vt(ll)),ie=z(!0),ne=z(!0),ue=()=>{const o=C.value.filter(i=>i.linkageActive).length;j.value=o===C.value.length,Z.value=o>0&&o<C.value.length},Ie=o=>{C.value.forEach(i=>{o?(i.linkageActive=!0,j.value=!0,Ce(i)):(i.linkageActive=!1,j.value=!1)}),Z.value=!1},_e=me(()=>C.value&&C.value.length>0),xe=me(()=>N.value&&N.value.length>0),ve=o=>{p.showSelected=!1,R.value=!0,p.initState=!1,Le(o)},be=o=>{const i=[];Ut(de.value,i);const h={dvId:w.value.id,sourceViewId:o,targetViewIds:i,linkageInfo:null};jt(h).then(v=>{A.value=v.data||[],A.value.forEach(S=>{S.targetViewId===o&&(p.sourceLinkageInfo=S)}),A.value=A.value.filter(S=>S.targetViewId!==p.viewId),C.value=A.value.filter(S=>S.tableId===p.tableId),N.value=A.value.filter(S=>S.tableId!==p.tableId);let k,V;C.value&&C.value.length>0?(k=C.value[0],V="sameDs"):N.value&&N.value.length>0&&(k=N.value[0],V="diffDs"),p.initState=!0,we(()=>{k&&(V==="sameDs"?d.value:T.value).setCurrentKey(k.targetViewId),he(k),ue()})})},Le=o=>{p.initState=!1,p.viewId=o.id,A.value=[];const i=H.value[p.viewId];p.curLinkageViewInfo=i,i.tableId&&(p.tableId=i.tableId,ct(i.tableId).then(h=>{p.curDatasetInfo=h||{}})),$.value=L.value.actionSelection,be(p.viewId)},Ve=()=>{let o=0;if(A.value.forEach(h=>{let v=0;const k=h.linkageFields;if(k&&h.linkageActive&&k.forEach(function(V){V.sourceField&&V.targetField||(v++,o++)}),v>0){ke.error("【"+h.targetViewName+"】-"+x("visualization.exit_un_march_linkage_field"));return}}),o)return;const i={dvId:w.value.id,sourceViewId:p.viewId,linkageInfo:A.value};J.value=!0,Pt(i).then(()=>{L.value.actionSelection.linkageActive=$.value.linkageActive,l.recordSnapshotCache("saveLinkageSetting"),ke.success("保存成功"),Mt(w.value.id).then(h=>{U.setNowPanelTrackInfo(h.data)}),Te(),dt(w.value.id).then(h=>{U.setNowPanelJumpInfo(h.data),c()}),J.value=!1}).catch(()=>{J.value=!1})},Te=()=>{U.clearLinkageSettingInfo()},ge=(o,i)=>{i==="sameDs"?(d.value.setCurrentKey(o.targetViewId),T.value.setCurrentKey(null)):(d.value.setCurrentKey(null),T.value.setCurrentKey(o.targetViewId)),he(o)},he=o=>{p.linkageInfo=o},ye=(o,i,h)=>{const v={sourceField:i,targetField:h};o.linkageFields.push(v)},Ee=(o,i)=>{const h={sourceField:o,targetField:i};p.linkageInfo.linkageFields.push(h)},De=o=>{p.linkageInfo.linkageFields.splice(o,1)},Ce=async o=>{if(o.linkageActive){const i=H.value[o.targetViewId];if(i&&i.tableId&&o.linkageFields.length===0)if(p.curLinkageViewInfo.tableId===i.tableId){if(o.linkageFields&&o.linkageFields.length===0){const h=JSON.stringify(p.curLinkageViewInfo.xAxis)+JSON.stringify(p.curLinkageViewInfo.xAxisExt)+JSON.stringify(p.curLinkageViewInfo.extStack)+(p.curLinkageViewInfo.type.includes("chart-mix")?JSON.stringify(p.curLinkageViewInfo.extBubble):""),v=JSON.stringify(i.xAxis)+JSON.stringify(i.xAxisExt)+JSON.stringify(p.curLinkageViewInfo.extStack)+(i.type.includes("chart-mix")?JSON.stringify(i.extBubble):"");p.sourceLinkageInfo.targetViewFields.forEach(k=>{h.includes(k.id)&&v.includes(k.id)&&o.linkageFields&&ye(o,k.id,k.id)})}}else ye(o,"","")}},oe=me(()=>{if(p.sourceLinkageInfo.targetViewFields){const o=JSON.stringify(p.curLinkageViewInfo.xAxis)+JSON.stringify(p.curLinkageViewInfo.drillFields)+JSON.stringify(p.curLinkageViewInfo.xAxisExt)+JSON.stringify(p.curLinkageViewInfo.extStack)+(p.curLinkageViewInfo.type.includes("chart-mix")?JSON.stringify(p.curLinkageViewInfo.extBubble):"")+(p.curLinkageViewInfo.type.includes("table-normal")?JSON.stringify(p.curLinkageViewInfo.yAxis):"");return p.sourceLinkageInfo.targetViewFields.filter(i=>o.includes(i.id))}else return[]}),Se=(o,i)=>{we(()=>{o==="sameDs"?(d.value.setCurrentKey(i.targetViewId),T.value.setCurrentKey(null)):(d.value.setCurrentKey(null),T.value.setCurrentKey(i.targetViewId)),he(i),Ce(i),ue()})},c=()=>{R.value=!1,p.initState=!1},n=(o,i)=>!o||i.linkageActive;return Oe(()=>p.showSelected,o=>{var i,h;(i=d.value)==null||i.filter(o),(h=T.value)==null||h.filter(o)}),O({dialogInit:ve}),(o,i)=>{const h=He,v=Be,k=nt,V=Pe("CaretBottom"),S=Pe("CaretRight"),E=je,X=tt,ee=et,Ae=it,Q=Qe,Y=Ye,ce=Xe,Je=Ge,Ne=rt("loading");return u(),_(Je,{ref:"enlargeDialog","append-to-body":!0,modelValue:R.value,"onUpdate:modelValue":i[13]||(i[13]=g=>R.value=g),width:"70vw",top:"10vh",trigger:"click"},{default:t(()=>[a(L)&&a(L).actionSelection?(u(),_(na,{key:0,"action-selection":$.value},null,8,["action-selection"])):P("",!0),p.initState?K((u(),b("div",{key:1,onKeydown:i[11]||(i[11]=se(()=>{},["stop"])),onKeyup:i[12]||(i[12]=se(()=>{},["stop"])),style:{height:"550px","margin-top":"22px"}},[e(v,{style:{"flex-direction":"row"}},{default:t(()=>[s("div",oa,[s("span",sa,r(a(x)("visualization.selected_view"))+"：",1),s("span",ra,[e(h,{"class-name":"view-type-icon"},{default:t(()=>[(u(),_(M(a(re)[p.curLinkageViewInfo.type]),{class:"svg-icon view-type-icon"}))]),_:1}),m(" "+r(p.curLinkageViewInfo.title),1)]),s("span",da,r(a(x)("visualization.used_dataset"))+"：",1),s("span",ua,[e(h,{"class-name":"view-type-icon",name:"dataset-outline"},{default:t(()=>[e(a(ft),{style:{"vertical-align":"-0.2em"},class:"svg-icon view-type-icon"})]),_:1}),m(" "+r(p.curDatasetInfo.name),1)])])]),_:1}),e(v,null,{default:t(()=>[e(v,{class:"preview"},{default:t(()=>[e(Ae,{span:8,style:{height:"100%","overflow-y":"auto"}},{default:t(()=>[e(v,{class:"tree-head"},{default:t(()=>[s("span",ca,r(a(x)("visualization.to_select_view")),1),s("span",pa,[m(r(a(x)("visualization.show_selected_only"))+" ",1),e(k,{size:"small",modelValue:p.showSelected,"onUpdate:modelValue":i[0]||(i[0]=g=>p.showSelected=g)},null,8,["modelValue"])])]),_:1}),K(e(v,{class:"tree-dataset-head"},{default:t(()=>[s("span",null,[e(E,{class:"toggle-icon",onClick:i[1]||(i[1]=()=>ie.value=!ie.value)},{default:t(()=>[K(e(V,null,null,512),[[te,ie.value]]),K(e(S,null,null,512),[[te,!ie.value]])]),_:1}),s("span",null,r(a(x)("visualization.same_dataset")),1)]),e(X,{modelValue:j.value,"onUpdate:modelValue":i[2]||(i[2]=g=>j.value=g),indeterminate:Z.value,onChange:Ie},{default:t(()=>[m(r(a(x)("visualization.select_all")),1)]),_:1},8,["modelValue","indeterminate"])]),_:1},512),[[te,_e.value]]),K(e(ee,{class:"custom-tree",menu:"",ref_key:"linkageInfoTree",ref:d,"empty-text":a(x)("visualization.no_available_view"),"filter-node-method":n,data:C.value,"node-key":"targetViewId","highlight-current":"",props:p.treeProp,onNodeClick:i[4]||(i[4]=g=>ge(g,"sameDs"))},{default:t(({data:g})=>[s("span",fa,[s("span",null,[s("div",{onClick:i[3]||(i[3]=se(()=>{},["stop"]))},[s("span",ma,[e(X,{modelValue:g.linkageActive,"onUpdate:modelValue":G=>g.linkageActive=G,onChange:G=>Se("sameDs",g)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),s("span",null,[s("span",_a,[e(h,{"class-name":"view-type-icon"},{default:t(()=>[(u(),_(M(a(re)[g.targetViewType]),{style:{"margin-right":"4px"},class:"svg-icon view-type-icon"}))]),_:2},1024),m(" "+r(g.targetViewName),1)])])])]),_:1},8,["empty-text","data","props"]),[[te,ie.value&&_e.value]]),K(e(v,{class:"tree-dataset-head tree-dataset-head-top"},{default:t(()=>[s("span",null,[e(E,{class:"toggle-icon",onClick:i[5]||(i[5]=()=>ne.value=!ne.value)},{default:t(()=>[K(e(V,null,null,512),[[te,ne.value]]),K(e(S,null,null,512),[[te,!ne.value]])]),_:1}),s("span",null,r(a(x)("visualization.diff_dataset")),1)])]),_:1},512),[[te,xe.value]]),K(e(ee,{class:"custom-tree",menu:"",ref_key:"linkageInfoTreeDiffDs",ref:T,"empty-text":a(x)("visualization.no_available_view"),"filter-node-method":n,data:N.value,"node-key":"targetViewId","highlight-current":"",props:p.treeProp,onNodeClick:i[7]||(i[7]=g=>ge(g,"diffDs"))},{default:t(({data:g})=>[s("span",va,[s("span",null,[s("div",{onClick:i[6]||(i[6]=se(()=>{},["stop"]))},[s("span",ga,[e(X,{modelValue:g.linkageActive,"onUpdate:modelValue":G=>g.linkageActive=G,onChange:G=>Se("diffDs",g)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),s("span",null,[s("span",ha,[e(h,{name:g.targetViewType},{default:t(()=>[(u(),_(M(a(re)[g.targetViewType]),{class:"svg-icon view-type-icon",style:{"margin-right":"4px"}}))]),_:2},1032,["name"]),m(" "+r(g.targetViewName),1)])])])]),_:1},8,["empty-text","data","props"]),[[te,ne.value&&xe.value]])]),_:1}),e(Ae,{span:16,class:"preview-show"},{default:t(()=>[e(v,{class:"content-head"},{default:t(()=>[m(r(a(x)("visualization.linkage_setting_tips1")),1)]),_:1}),p.linkageInfo&&p.linkageInfo.linkageActive?(u(),_(v,{key:0},{default:t(()=>[e(v,{style:{"margin-top":"5px"}},{default:t(()=>[s("div",ya,[s("div",ka,r(a(x)("visualization.current_chart_source_field")),1),i[14]||(i[14]=s("div",{style:{width:"36px"}},null,-1)),s("div",wa,r(a(x)("visualization.link_view_field")),1),i[15]||(i[15]=s("div",{style:{width:"32px"}},null,-1))]),s("div",Ia,[(u(!0),b(D,null,q(p.linkageInfo.linkageFields,(g,G)=>(u(),b("div",{style:{display:"flex",padding:"0 16px 8px"},key:G},[s("div",xa,[s("div",ba,[e(Y,{modelValue:g.sourceField,"onUpdate:modelValue":F=>g.sourceField=F,placeholder:a(x)("chart.pls_select_field"),style:{width:"100%"}},{default:t(()=>[(u(!0),b(D,null,q(oe.value,F=>(u(),_(Q,{key:F.id,label:F.name,value:F.id},{default:t(()=>[s("span",Va,[e(h,null,{default:t(()=>[(u(),_(M(a(fe)[a(W)[F.deType]]),{style:{width:"14px",height:"14px"},class:le([`field-icon-${a(W)[F.deType]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024),s("span",Ca,r(F.name),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])]),e(E,{class:"link-icon-join"},{default:t(()=>[e(h,{style:{width:"20px",height:"20px"},name:"dv-link-target"},{default:t(()=>[e(a(Fe),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),_:1}),s("div",Sa,[s("div",Aa,[e(Y,{modelValue:g.targetField,"onUpdate:modelValue":F=>g.targetField=F,placeholder:a(x)("common.selectText"),style:{width:"100%"}},{default:t(()=>[(u(!0),b(D,null,q(p.linkageInfo.targetViewFields,F=>(u(),_(Q,{key:F.id,label:F.name,value:F.id},{default:t(()=>[s("span",Ja,[e(h,null,{default:t(()=>[(u(),_(M(a(fe)[a(W)[F.deType]]),{style:{width:"14px",height:"14px"},class:le(["svg-icon",`field-icon-${a(W)[F.deType]}`])},null,8,["class"]))]),_:2},1024),s("span",Fa,r(F.name),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])]),e(ce,{class:"m-del-icon-btn",text:"",onClick:F=>De(G)},{default:t(()=>[e(E,{size:"16px"},{default:t(()=>[e(h,{name:"icon_delete-trash_outlined"},{default:t(()=>[e(a(Me),{class:"svg-icon"})]),_:1})]),_:1})]),_:2},1032,["onClick"])]))),128))]),e(v,{style:{width:"100%","padding-left":"16px"}},{default:t(()=>[e(ce,{type:"primary",icon:"Plus",text:"",onClick:i[8]||(i[8]=g=>Ee("",""))},{default:t(()=>[m(r(a(x)("visualization.add_linkage_dependency_fields")),1)]),_:1})]),_:1})]),_:1})]),_:1})):(u(),_(v,{key:1,style:{height:"100%"},class:"custom-position"},{default:t(()=>[e(h,{name:"dv-empty"},{default:t(()=>[e(a(el),{style:{width:"125px",height:"125px"},class:"svg-icon"})]),_:1}),s("span",za,r(a(x)("visualization.select_linkage_tips")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(v,{class:"root-class"},{default:t(()=>[e(ce,{size:"mini",onClick:i[9]||(i[9]=g=>c())},{default:t(()=>[m(r(a(x)("common.cancel")),1)]),_:1}),e(ce,{type:"primary",size:"mini",onClick:i[10]||(i[10]=g=>Ve())},{default:t(()=>[m(r(a(x)("dataset.confirm")),1)]),_:1})]),_:1})],32)),[[Ne,J.value]]):P("",!0)]),_:1},8,["modelValue"])}}});const Si=Ke(La,[["__scopeId","data-v-6a887676"]]);export{Ci as L,Si as a};

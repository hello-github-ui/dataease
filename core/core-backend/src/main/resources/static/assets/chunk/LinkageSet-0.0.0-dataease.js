import{a as Ne,p as ke,o as Ue,H as He,z as Xe,d as je,t as Ge,B as Qe,O as Ye,P as et,w as ht,k as yt,x as tt,y as lt,s as kt,Q as wt,R as It,h as at,v as xt,e as bt,r as Vt,m as Ct,n as St,L as nt,f as At}from"./element-plus-secondary-0.0.0-dataease.js";import{j as Be,l as Jt,h as it,A as Ft}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{o as u,c as b,a as o,d as ze,r as z,t as st,l as Ke,e as zt,Z as m,k as _e,w as Oe,ak as ot,W,_ as t,a0 as e,a2 as r,u as a,$ as M,a4 as _,a1 as oe,z as le,Y as P,M as E,ab as q,n as we,ah as Pe,X as te}from"./@vue-0.0.0-dataease.js";import{i as fe}from"./field-list-0.0.0-dataease.js";import{a as re}from"./chart-list-0.0.0-dataease.js";import{d as Fe}from"./dv-link-target-0.0.0-dataease.js";import{d as Lt}from"./dv-dashboard-spine-0.0.0-dataease.js";import{d as Tt}from"./dv-folder-0.0.0-dataease.js";import{i as Me}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as Re}from"./icon_info_outlined-0.0.0-dataease.js";import{d as Dt}from"./dv-screen-spine-0.0.0-dataease.js";import{H as Et,I as $t,J as Nt,q as rt,K as Ot,j as Pt,k as Mt,L as Ut,M as jt}from"./canvasUtils-0.0.0-dataease.js";import{d as dt}from"./dvMain-0.0.0-dataease.js";import{f as K}from"./attr-0.0.0-dataease20.js";import{s as ut}from"./pinia-0.0.0-dataease.js";import{e as Bt,r as Kt}from"./dataVisualization-0.0.0-dataease.js";import{o as ct,I as Wt}from"./dataset-0.0.0-dataease.js";import qt from"./CodeMirror-0.0.0-dataease2.js";import{K as Rt}from"./@element-plus-0.0.0-dataease.js";import{s as pt}from"./snapshot-0.0.0-dataease.js";import{E as Ze}from"./EmptyBackground-0.0.0-dataease.js";import{b as Zt,a as Ht,u as Xt,p as Gt}from"./index-0.0.0-dataease.js";import{useAppStoreWithOut as Qt}from"./app-0.0.0-dataease.js";import{g as Yt}from"./util-0.0.0-dataease.js";import{t as el}from"./treeSortUtils-0.0.0-dataease.js";import{_ as We}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import{d as tl}from"./dv-empty-0.0.0-dataease.js";import{A as ll}from"./dataVisualization-0.0.0-dataease2.js";const al={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function nl(ae,O){return u(),b("svg",al,O[0]||(O[0]=[o("path",{d:"M0.666016 5.09541C0.666016 4.83398 0.818817 4.59668 1.05681 4.4885L7.72348 1.45819C7.89876 1.37852 8.09993 1.37852 8.27522 1.45819L14.9419 4.4885C15.1799 4.59668 15.3327 4.83398 15.3327 5.09541V11.5874C15.3327 11.84 15.19 12.0708 14.9642 12.1837L8.29749 15.5171C8.10981 15.6109 7.88889 15.6109 7.70121 15.5171L1.03454 12.1837C0.808684 12.0708 0.666016 11.84 0.666016 11.5874V5.09541ZM12.8112 4.98463L7.99935 2.79741L3.16148 4.99644L7.97266 7.06896L12.8112 4.98463ZM8.66602 8.22206V13.8421L13.9993 11.1754V5.92461L8.66602 8.22206ZM1.99935 5.94761V11.1754L7.33268 13.8421V8.24505L1.99935 5.94761Z",fill:"#3370FF"},null,-1)]))}const ft={render:nl},il=ze({__name:"JumpSetOuterContentEditor",props:{linkJumpInfoArray:Array,linkJumpInfo:Object},setup(ae,{expose:O}){const U=z(null),w=z(null),X=ae,{linkJumpInfo:de}=st(X),L=Ke({name2Auto:[],content:""}),d=z(null),T=J=>{w.value.dispatch({changes:{from:w.value.viewState.state.selection.ranges[0].from,insert:J},selection:{anchor:w.value.viewState.state.selection.ranges[0].from}})},x=(J,A,C,$)=>{if(!C)return C;let l=C;const p=X.linkJumpInfoArray.reduce((Z,N)=>(Z[N[J]]=N[A],Z),{}),j=C.match(/\[(.+?)\]/g);return j&&j.forEach(Z=>{const N=Z.slice(1,-1);$&&$.push(p[N]),l=l.replace(`[${N}]`,`[${p[N]}]`)}),l};return O({editorInit:J=>{L.name2Auto=[],w.value||(w.value=U.value.codeComInit()),L.content=x("sourceFieldId","sourceFieldName",J,L.name2Auto),w.value.dispatch({changes:{from:0,to:w.value.viewState.state.doc.length,insert:L.content}}),clearTimeout(d.value),d.value=setInterval(()=>{const A=w.value?w.value.state.doc.toString():"",C=x("sourceFieldName","sourceFieldId",A,L.name2Auto);de.value.content=C},1500)},insertFieldToCodeMirror:T}),zt(()=>{var J,A;clearTimeout(d.value),w.value&&((A=(J=w.value).destroy)==null||A.call(J))}),(J,A)=>(u(),m(qt,{quotaMap:X.linkJumpInfoArray.map(C=>C.sourceFieldName),ref_key:"myCm",ref:U,"dom-id":"jumpSetField",style:{height:"100%"}},null,8,["quotaMap"]))}}),sl={class:"top-area"},ol={class:"top-area-text"},rl={class:"top-area-value"},dl={class:"top-area-text margin-left"},ul={class:"top-area-value"},cl={class:"head-text"},pl={class:"head-filter"},fl={class:"custom-tree-node"},_l={class:"auth-span"},ml=["title"],vl={class:"tree-select-field"},gl={class:"title"},hl={class:"title"},yl={class:"title"},kl={class:"m-row"},wl={style:{flex:"1"}},Il={class:"icon-center"},xl={style:{flex:"1"}},bl={class:"label-content-details"},Vl=["title"],Cl={class:"jump-com-list"},Sl={style:{flex:"1"}},Al={class:"custom-option"},Jl={style:{float:"left","margin-left":"4px","font-size":"14px"}},Fl={class:"icon-center"},zl={style:{flex:"1"}},Ll={class:"custom-option"},Tl={style:{float:"left","margin-left":"4px","font-size":"14px"}},Dl={style:{flex:"1",margin:"0 8px"}},El={class:"custom-option"},$l={style:{float:"left","margin-left":"4px","font-size":"14px"}},Nl={key:0},Ol={key:1},Pl={style:{flex:"1"}},Ml={class:"custom-option"},Ul={style:{float:"left","margin-left":"4px","font-size":"14px"}},jl={class:"icon-center"},Bl={style:{flex:"1"}},Kl={class:"custom-option"},Wl={style:{float:"left","margin-left":"4px","font-size":"14px"}},ql={class:"url-text"},Rl={class:"outer-content-mirror"},Zl={class:"url-text"},Hl=["innerHTML"],Xl={class:"outer-content-right"},Gl=["title","onClick"],Ql={key:1,class:"empty"},Yl="_blank",ea=ze({__name:"LinkJumpSet",setup(ae,{expose:O}){const U=dt(),{dvInfo:w,canvasViewInfo:X,componentData:de}=ut(U),L=z(null),{t:d}=Be(),T=z(!1),x=pt(),R=Qt(),J=Zt(),A=_e(()=>w.value.type==="dashboard"?d("work_branch.dashboard"):d("work_branch.big_data_screen")),C=d("visualization.select_target_resource"),$=d("visualization.target_dashboard_dataV");w.value.type==="dashboard"?d("visualization.cur_dashboard"):d("visualization.cur_screen");const l=Ke({curDataVWeight:0,activeCollapse:"view",loading:!1,showSelected:!1,curJumpViewInfo:{},curDatasetInfo:{},tempId:null,initState:!1,viewId:null,name2Auto:[],searchField:"",searchFunction:"",inputType:"self",fieldName:"name",tableRadio:null,keyWordSearch:"",columnLabel:d("visualization.belong_to_category"),templateList:[],importTemplateInfo:{snapshot:""},sourceViewFields:[],dvSelectProps:{label:"name",children:"children",value:"id",isLeaf:"leaf",disabled:"disabled"},treeProp:{id:"sourceFieldId",label:"sourceFieldName",children:"children"},linkJump:null,linkJumpInfoArray:[],linkJumpInfoXArray:[],linkJumpCurViewFieldArray:[],linkJumpCurFilterFieldArray:[],mapJumpInfoArray:{},panelList:[],linkJumpInfo:null,currentFiledTreeNode:null,defaultLinkJumpInfo:{linkType:"outer",jumpType:"_self",targetViewInfoList:[]},defaultTargetViewInfo:{targetViewId:null,targetFieldId:null},currentLinkPanelViewArray:[],viewIdFieldArrayMap:{},dimensionData:[],dimensionList:[],quotaList:[],quotaData:[],dimension:[],quota:[],currentOutParams:[]}),{wsCache:p}=Ht(),j=z(null),Z=c=>{l.showSelected=!1,T.value=!0,l.initState=!1,ne(c)},N=c=>{c.forEach(i=>{i.component==="VQuery"&&i.propValue instanceof Array?i.propValue.forEach(s=>{s.checkedFields.includes(l.viewId)&&l.linkJumpCurFilterFieldArray.push({id:s.id,name:s.name,deType:"filter"})}):i.component==="Group"?N(i.propValue):i.component==="DeTabs"&&i.propValue.forEach(s=>{N(s.componentData)})})},ne=c=>{l.initState=!1,l.viewId=c.id,l.activeCollapse="view";const i=X.value[l.viewId];l.curJumpViewInfo=i;let s=JSON.stringify(i.xAxis)+JSON.stringify(i.xAxisExt)+JSON.stringify(i.yAxis)+JSON.stringify(i.yAxisExt)+JSON.stringify(i.drillFields),n;if(i.type.indexOf("stack")>-1&&i.extStack.length>2){const v=i.yAxis,k=v.length>0?JSON.stringify(v[0]):"[]";s=JSON.stringify(i.xAxis)+JSON.stringify(i.xAxisExt)+JSON.stringify(k)+JSON.stringify(i.yAxisExt)+JSON.stringify(i.drillFields),n=s}else i.type==="table-pivot"?n=s:i.type==="table-info"?n=JSON.stringify(i.xAxis)+JSON.stringify(i.drillFields):n=s;Bt({busiFlag:"dashboard-dataV"}).then(v=>{var V;v&&((V=v[0])==null?void 0:V.id)==="0"?l.panelList=v[0].children:l.panelList=v,l.panelList=Et(l.panelList);const k=p.get(`TreeSort-${w.value.type}`)||"time_asc";l.panelList=el(l.panelList,k)}),l.linkJumpCurFilterFieldArray=[],N(de.value),i.tableId&&(ct(i.tableId).then(v=>{l.curDatasetInfo=v||{}}),Wt(i.tableId).then(v=>{l.linkJumpCurViewFieldArray=[],v.data.forEach(V=>{s.indexOf(V.id)>-1&&l.linkJumpCurViewFieldArray.push(V)})}),$t(w.value.id,l.viewId).then(v=>{l.linkJump=v.data,l.linkJumpInfoArray=[],l.linkJumpInfoXArray=[],l.linkJump.linkJumpInfoArray.forEach(V=>{n.indexOf(V.sourceFieldId)>-1?(l.mapJumpInfoArray[V.sourceFieldId]=V,l.linkJumpInfoArray.push(V),l.linkJumpInfoXArray.push(V)):s.indexOf(V.sourceFieldId)>-1&&l.linkJumpInfoArray.push(V)});const k=l.linkJumpInfoArray[0];l.initState=!0,we(()=>{L.value.setCurrentKey(k==null?void 0:k.sourceFieldId),ue(k)})}))},ie=()=>{let c=0;l.linkJump.linkJumpInfoArray.forEach(i=>{if(i.checked){let s=0;i.linkType==="inner"&&(i.targetDvId||(s++,c++),i.targetViewInfoList&&i.targetViewInfoList.forEach(function(n){n.sourceFieldActiveId&&n.targetFieldId&&n.targetViewId||(s++,c++)})),i.linkType==="outer"&&(i.content||(s++,c++)),s>0&&ke.error(d("visualization.jump_null_tips",[i.sourceFieldName]))}}),!c&&(l.loading=!0,Nt(l.linkJump).then(()=>{x.recordSnapshotCache("updateJumpSet"),ke.success(d("common.save_success")),rt(w.value.id).then(i=>{U.setNowPanelJumpInfo(i.data),ge()}),l.loading=!1}).catch(()=>{l.loading=!1}))},ue=c=>{l.linkJumpInfo=l.mapJumpInfoArray[c.sourceFieldId],l.linkJumpInfo.windowSize||(l.linkJumpInfo.windowSize="middle"),l.linkJumpInfo.linkType||(l.linkJumpInfo.linkType="outer"),l.linkJumpInfo.jumpType||(l.linkJumpInfo.jumpType="_blank"),l.linkJumpInfo.content||(l.linkJumpInfo.content="http://"),l.linkJumpInfo.attachParams||(l.linkJumpInfo.attachParams=!1),l.linkJumpInfo.targetDvId&&me(l.linkJumpInfo.targetDvId),Ie(l.linkJumpInfo.content)},Ie=c=>{we(()=>{var i;(i=j.value)==null||i.editorInit(c)})},me=c=>{Ot(c).then(i=>{l.viewIdFieldArrayMap={},l.currentLinkPanelViewArray=i.data.visualizationViewTables,l.currentLinkPanelViewArray&&l.currentLinkPanelViewArray.forEach(s=>{l.viewIdFieldArrayMap[s.id]=s.tableFields}),l.currentOutParams=i.data.outParamsJumpInfo||[],l.currentOutParams&&l.currentOutParams.length>0&&l.currentOutParams.forEach(s=>{l.currentLinkPanelViewArray.push(s),l.viewIdFieldArrayMap[s.id]=[{id:"1000001",name:d("visualization.out_params_no_select")}]}),JSON.parse(i.data.bashComponentData).forEach(s=>{s.component==="VQuery"&&s.propValue instanceof Array&&s.propValue.forEach(n=>{l.currentLinkPanelViewArray.push({id:n.id,type:"filter",name:n.name,title:n.name}),l.viewIdFieldArrayMap[n.id]=[{id:"1000001",name:d("visualization.filter_no_select")}]})})})},xe=c=>{c.leaf&&(l.curDataVWeight=c.weight,l.linkJumpInfo.targetViewInfoList=[],ve(),me(c.id))},ve=(c="view")=>{l.linkJumpInfo.targetViewInfoList.push({targetId:Yt(),targetViewId:"",targetType:c,targetFieldId:""})},be=c=>{if(c){let i;l.linkJumpInfo.targetViewInfoList.forEach((s,n)=>{c===s.targetId&&(i=n)}),i!==void 0&&l.linkJumpInfo.targetViewInfoList.splice(i,1)}},Le=c=>l.viewIdFieldArrayMap[c.targetViewId]&&l.viewIdFieldArrayMap[c.targetViewId].length===1&&l.viewIdFieldArrayMap[c.targetViewId][0].id==="1000001"||!c.sourceFieldActiveId,Ve=c=>{l.viewIdFieldArrayMap[c.targetViewId]&&l.viewIdFieldArrayMap[c.targetViewId].length===1&&l.viewIdFieldArrayMap[c.targetViewId][0].id==="1000001"?c.targetFieldId="1000001":c.targetFieldId=null},Te=c=>{we(()=>{L.value.setCurrentKey(c.sourceFieldId),ue(c)})},ge=()=>{T.value=!1,l.initState=!1},he=c=>{j.value.insertFieldToCodeMirror(c)},ye=_e(()=>l.linkJumpInfo&&l.linkJumpInfo.linkType==="outer"&&T.value),De=(c,i)=>!c||i.checked,Ee=_e(()=>R.getIsDataEaseBi||R.getIsIframe),Ce=async c=>{if(l.curDataVWeight&&l.curDataVWeight<7){ke.error(d("visualization.no_edit_auth"));return}let i;await Kt(c).then(h=>{i=h.data});const s=i==="dataV"?"#/dvCanvas?dvId=":"#/dashboard?resourceId=";if(Ee.value){J.clearState(),w.value.type==="dataV"?J.setDvId(c):J.setResourceId(c),Xt().emitter.emit("changeCurrentComponent",w.value.type==="dataV"?"VisualizationEditor":"DashboardEditor");return}const n=window.open(s+c,Yl);Se(n)},se=z(null),Se=c=>{if(se!=null&&se.value){const i={methodName:"initOpenHandler",args:c};se.value.invokeMethod(i)}};return Oe(()=>l.showSelected,c=>{var i;(i=L.value)==null||i.filter(c)}),Oe(()=>ye.value,c=>{c&&Ie(l.linkJumpInfo.content)}),O({dialogInit:Z}),(c,i)=>{const s=it,n=Ue,h=He,v=Xe,k=je,V=Ge,S=Qe,D=Ye,G=et,ee=ht,Ae=yt,Q=tt,Y=lt,ce=kt,Je=wt,$e=It,g=at,H=xt,F=bt,_t=Vt,mt=Ct,vt=St,gt=nt,qe=ot("loading");return W((u(),m(gt,{ref:"enlargeDialog","append-to-body":!0,title:a(d)("visualization.jump_set"),modelValue:T.value,"onUpdate:modelValue":i[16]||(i[16]=I=>T.value=I),width:"70vw",top:"10vh",trigger:"click"},{default:t(()=>[l.initState?(u(),b("div",{key:0,onKeydown:i[14]||(i[14]=oe(()=>{},["stop"])),onKeyup:i[15]||(i[15]=oe(()=>{},["stop"])),style:{height:"550px"}},[e(n,{style:{"flex-direction":"row"}},{default:t(()=>[o("div",sl,[o("span",ol,r(a(d)("visualization.selected_view"))+"：",1),o("span",rl,[e(s,{"class-name":"view-type-icon"},{default:t(()=>[(u(),m(M(a(re)[l.curJumpViewInfo.type]),{class:"svg-icon view-type-icon"}))]),_:1}),_(" "+r(l.curJumpViewInfo.title),1)]),o("span",dl,r(a(d)("visualization.used_dataset"))+"：",1),o("span",ul,[e(s,{name:"dataset-outline"},{default:t(()=>[e(a(ft),{style:{"vertical-align":"-0.2em"},class:"svg-icon view-type-icon"})]),_:1}),_(" "+r(l.curDatasetInfo.name),1)])])]),_:1}),W((u(),m(n,null,{default:t(()=>[e(n,{class:"preview"},{default:t(()=>[e(S,{span:8,style:{height:"100%","overflow-y":"auto"}},{default:t(()=>[e(n,{class:"tree-head"},{default:t(()=>[o("span",cl,r(a(d)("visualization.to_select_view")),1),o("span",pl,[_(r(a(d)("visualization.show_selected_only"))+" ",1),e(h,{size:"small",modelValue:l.showSelected,"onUpdate:modelValue":i[0]||(i[0]=I=>l.showSelected=I)},null,8,["modelValue"])])]),_:1}),e(V,{menu:"",ref_key:"linkJumpInfoTree",ref:L,"filter-node-method":De,data:l.linkJumpInfoXArray,"node-key":"sourceFieldId","highlight-current":"",props:l.treeProp,onNodeClick:ue},{default:t(({data:I})=>[o("span",fl,[o("span",null,[o("div",{onClick:i[1]||(i[1]=oe(()=>{},["stop"]))},[o("span",_l,[e(v,{modelValue:I.checked,"onUpdate:modelValue":B=>I.checked=B,onChange:B=>Te(I)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),o("span",{title:I.sourceFieldName},[o("span",vl,[e(k,{style:{"margin-right":"4px"}},{default:t(()=>[e(s,null,{default:t(()=>[(u(),m(M(a(fe)[a(K)[I.sourceDeType]]),{class:le(["svg-icon",`field-icon-${a(K)[I.sourceDeType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),_(" "+r(I.sourceFieldName),1)])],8,ml)])]),_:1},8,["data","props"])]),_:1}),e(S,{span:16,class:"preview-show"},{default:t(()=>[e(vt,{class:"settings-container"},{default:t(()=>[e(Ae,{class:"settings-header"},{default:t(()=>{var I;return[e(ee,{class:"radio-group-box"},{label:t(()=>[o("span",gl,r(a(d)("visualization.link_type")),1)]),default:t(()=>[l.linkJumpInfo?(u(),m(G,{key:0,class:"larger-radio",modelValue:l.linkJumpInfo.linkType,"onUpdate:modelValue":i[2]||(i[2]=B=>l.linkJumpInfo.linkType=B)},{default:t(()=>[e(D,{label:"outer"},{default:t(()=>[_(r(a(d)("visualization.link_outer")),1)]),_:1}),e(D,{label:"inner"},{default:t(()=>[_(r(a(d)("visualization.dashboard_dataV")),1)]),_:1})]),_:1},8,["modelValue"])):P("",!0),l.linkJumpInfo?P("",!0):(u(),m(G,{key:1,class:"larger-radio",disabled:""},{default:t(()=>[e(D,{label:"outer"},{default:t(()=>[_(r(a(d)("visualization.link_outer")),1)]),_:1}),e(D,{label:"inner"},{default:t(()=>[_(r(A.value),1)]),_:1})]),_:1}))]),_:1}),e(ee,{class:"radio-group-box"},{label:t(()=>[o("span",hl,r(a(d)("visualization.open_model")),1)]),default:t(()=>[l.linkJumpInfo?(u(),m(G,{key:0,class:"larger-radio",modelValue:l.linkJumpInfo.jumpType,"onUpdate:modelValue":i[3]||(i[3]=B=>l.linkJumpInfo.jumpType=B)},{default:t(()=>[e(D,{label:"_self"},{default:t(()=>[_(r(a(d)("visualization.now_window")),1)]),_:1}),e(D,{label:"_blank"},{default:t(()=>[_(r(a(d)("visualization.new_window")),1)]),_:1}),e(D,{label:"newPop"},{default:t(()=>[_(r(a(d)("visualization.pop_window")),1)]),_:1})]),_:1},8,["modelValue"])):P("",!0),l.linkJumpInfo?P("",!0):(u(),m(G,{key:1,class:"larger-radio",disabled:""},{default:t(()=>[e(D,{label:"_self"},{default:t(()=>[_(r(a(d)("visualization.now_window")),1)]),_:1}),e(D,{label:"_blank"},{default:t(()=>[_(r(a(d)("visualization.new_window")),1)]),_:1}),e(D,{label:"newPop"},{default:t(()=>[_(r(a(d)("visualization.pop_window")),1)]),_:1})]),_:1}))]),_:1}),((I=l.linkJumpInfo)==null?void 0:I.jumpType)==="newPop"?(u(),m(ee,{key:0,class:"radio-group-box"},{label:t(()=>[o("span",yl,r(a(d)("visualization.window_size")),1)]),default:t(()=>[e(G,{class:"larger-radio",modelValue:l.linkJumpInfo.windowSize,"onUpdate:modelValue":i[4]||(i[4]=B=>l.linkJumpInfo.windowSize=B)},{default:t(()=>[e(D,{label:"large"},{default:t(()=>[_(r(a(d)("visualization.window_size_large")),1)]),_:1}),e(D,{label:"middle"},{default:t(()=>[_(r(a(d)("visualization.window_size_middle")),1)]),_:1}),e(D,{label:"small"},{default:t(()=>[_(r(a(d)("visualization.window_size_small")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):P("",!0)]}),_:1}),e(mt,{class:"settings-main"},{default:t(()=>[l.linkJumpInfo?(u(),b(E,{key:0},[l.linkJumpInfo.linkType==="inner"?(u(),m(H,{key:0,"label-position":"top",class:"main-form"},{default:t(()=>{var I,B;return[o("div",kl,[o("div",wl,[e(ee,null,{label:t(()=>[_(r(a(w).type==="dashboard"?a(d)("visualization.cur_dashboard"):a(d)("visualization.cur_screen")),1)]),default:t(()=>[e(Y,{style:{width:"100%"},modelValue:a(w).name,"onUpdate:modelValue":i[5]||(i[5]=y=>a(w).name=y),disabled:""},{default:t(()=>[(u(),m(Q,{key:a(w).name,label:a(w).name,value:a(w).name},null,8,["label","value"]))]),_:1},8,["modelValue"])]),_:1})]),o("div",Il,[e(s,{name:"dv-link-target"},{default:t(()=>[e(a(Fe),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),o("div",xl,[e(ee,null,{label:t(()=>[_(r(a($)),1)]),default:t(()=>[e(ce,{modelValue:l.linkJumpInfo.targetDvId,"onUpdate:modelValue":i[6]||(i[6]=y=>l.linkJumpInfo.targetDvId=y),data:l.panelList,props:l.dvSelectProps,"render-after-expand":!1,filterable:"",onNodeClick:xe,class:"dv-selector"},{default:t(({node:y,data:pe})=>[o("div",bl,[pe.leaf?(u(),m(k,{key:0,size:"18px",style:{display:"inline-block"}},{default:t(()=>[e(s,{name:"dv-dashboard-spine"},{default:t(()=>[pe.type==="dashboard"?(u(),m(a(Lt),{key:0,class:"svg-icon"})):(u(),m(a(Dt),{key:1,class:"svg-icon"}))]),_:2},1024)]),_:2},1024)):(u(),m(k,{key:1,size:"18px",style:{display:"inline-block"}},{default:t(()=>[e(s,{name:"dv-folder"},{default:t(()=>[e(a(Tt),{class:"svg-icon"})]),_:1})]),_:1})),o("span",{style:{"margin-left":"8px","font-size":"14px"},title:y.label},r(y.label),9,Vl)])]),_:1},8,["modelValue","data","props"])]),_:1})])]),l.linkJumpInfo.targetDvId?(u(),b(E,{key:0},[o("div",Cl,[e($e,{size:"small",modelValue:l.activeCollapse,"onUpdate:modelValue":i[7]||(i[7]=y=>l.activeCollapse=y)},{default:t(()=>[e(Je,{label:a(d)("visualization.linkage_view"),name:"view"},null,8,["label"]),e(Je,{label:a(d)("visualization.with_filter_params"),name:"filter"},null,8,["label"])]),_:1},8,["modelValue"])]),l.activeCollapse==="view"?(u(),b(E,{key:0},[e(n,{style:{"margin-bottom":"8px"},gutter:8},{default:t(()=>[e(S,{span:7},{default:t(()=>[_(r(a(d)("visualization.source_field")),1)]),_:1}),e(S,{span:2}),e(S,{span:7,style:{"margin-left":"-2.9%"}},{default:t(()=>[_(r(a(d)("visualization.link_view_field")),1)]),_:1}),e(S,{span:8})]),_:1}),o("div",{class:le(["main-scrollbar-container",{"main-scrollbar-container-min":((I=l.linkJumpInfo)==null?void 0:I.jumpType)==="newPop"}])},[e(a(Ne),{height:"fit-content","max-height":"178px"},{default:t(()=>[(u(!0),b(E,null,q(l.linkJumpInfo.targetViewInfoList.filter(y=>y.targetType==="view"),(y,pe)=>(u(),b("div",{style:{display:"flex","margin-bottom":"6px"},key:pe},[o("div",Sl,[e(Y,{modelValue:y.sourceFieldActiveId,"onUpdate:modelValue":f=>y.sourceFieldActiveId=f,placeholder:a(d)("chart.pls_select_field"),style:{width:"100%"}},{default:t(()=>[(u(!0),b(E,null,q(l.linkJumpCurViewFieldArray,f=>(u(),m(Q,{key:f.id,label:f.name,value:f.id},{default:t(()=>[o("span",Al,[e(s,null,{default:t(()=>[(u(),m(M(a(fe)[a(K)[f.deType]]),{class:le(["svg-icon",`field-icon-${a(K)[f.deType]}`]),style:{width:"14px",height:"14px"}},null,8,["class"]))]),_:2},1024),o("span",Jl,r(f.name),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),o("div",Fl,[e(s,{name:"dv-link-target"},{default:t(()=>[e(a(Fe),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),o("div",zl,[e(Y,{modelValue:y.targetViewId,"onUpdate:modelValue":f=>y.targetViewId=f,disabled:!y.sourceFieldActiveId,placeholder:a(d)("visualization.select_view"),style:{width:"100%"},onChange:f=>Ve(y)},{default:t(()=>[(u(!0),b(E,null,q(l.currentLinkPanelViewArray.filter(f=>f.type!=="outerParams"),f=>(u(),m(Q,{key:f.id,label:f.title,value:f.id},{default:t(()=>[o("span",Ll,[e(s,null,{default:t(()=>[(u(),m(M(a(re)[f.type]),{class:"svg-icon view-type-icon",style:{width:"14px",height:"14px"}}))]),_:2},1024),o("span",Tl,r(f.title),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","placeholder","onChange"])]),o("div",Dl,[e(Y,{modelValue:y.targetFieldId,"onUpdate:modelValue":f=>y.targetFieldId=f,placeholder:a(d)("chart.pls_select_field"),disabled:Le(y),style:{width:"100%"}},{default:t(()=>[(u(!0),b(E,null,q(l.viewIdFieldArrayMap[y.targetViewId],f=>(u(),m(Q,{key:f.id,label:f.name,value:f.id},{default:t(()=>[o("span",El,[e(s,null,{default:t(()=>[(u(),m(M(a(fe)[a(K)[f.deType]]),{class:le(["svg-icon",`field-icon-${a(K)[f.deType]}`]),style:{width:"14px",height:"14px"}},null,8,["class"]))]),_:2},1024),o("span",$l,r(f.name),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","disabled"])]),e(g,{class:"m-del-icon-btn",text:"",onClick:f=>be(y.targetId)},{default:t(()=>[e(k,{size:"20px"},{default:t(()=>[e(s,{name:"icon_delete-trash_outlined"},{default:t(()=>[e(a(Me),{class:"svg-icon"})]),_:1})]),_:1})]),_:2},1032,["onClick"])]))),128))]),_:1}),e(g,{style:{"margin-top":"8px"},disabled:!l.linkJumpInfo.targetDvId,type:"primary",icon:"Plus",text:"",onClick:i[8]||(i[8]=y=>ve("view"))},{default:t(()=>[_(r(a(d)("visualization.add_jump_field")),1)]),_:1},8,["disabled"])],2)],64)):P("",!0),l.activeCollapse==="filter"?(u(),b(E,{key:1},[l.currentOutParams.length===0?(u(),b("span",Nl,[_(r(a(d)("visualization.link_target_tips1")),1),o("a",{class:"target_jump",onClick:i[9]||(i[9]=y=>Ce(l.linkJumpInfo.targetDvId))},r(a(d)("visualization.link_target_tips2")),1)])):l.linkJumpCurFilterFieldArray.length===0?(u(),b("span",Ol,r(a(d)("visualization.jump_no_banding_tips")),1)):l.currentOutParams.length>0?(u(),b(E,{key:2},[e(n,{style:{"margin-bottom":"8px"},gutter:8},{default:t(()=>[e(S,{span:12},{default:t(()=>[_(r(a(d)("visualization.source_filter")),1)]),_:1}),e(S,{span:1}),e(S,{span:10,style:{"margin-left":"-2.9%"}},{default:t(()=>[_(r(a(d)("visualization.link_outer_params")),1)]),_:1})]),_:1}),o("div",{class:le(["main-scrollbar-container",{"main-scrollbar-container-min":((B=l.linkJumpInfo)==null?void 0:B.jumpType)==="newPop"}])},[e(a(Ne),{height:"fit-content","max-height":"178px"},{default:t(()=>[(u(!0),b(E,null,q(l.linkJumpInfo.targetViewInfoList.filter(y=>y.targetType==="outerParams"),(y,pe)=>(u(),b("div",{style:{display:"flex","margin-bottom":"6px"},key:pe},[o("div",Pl,[e(Y,{modelValue:y.sourceFieldActiveId,"onUpdate:modelValue":f=>y.sourceFieldActiveId=f,placeholder:a(d)("chart.pls_select_field"),style:{width:"100%"}},{default:t(()=>[(u(!0),b(E,null,q(l.linkJumpCurFilterFieldArray,f=>(u(),m(Q,{key:f.id,label:f.name,value:f.id},{default:t(()=>[o("span",Ml,[e(s,null,{default:t(()=>[(u(),m(M(a(re).filter),{class:"svg-icon",style:{width:"14px",height:"14px"}}))]),_:1}),o("span",Ul,r(f.name),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),o("div",jl,[e(s,{name:"dv-link-target"},{default:t(()=>[e(a(Fe),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),o("div",Bl,[e(Y,{modelValue:y.targetViewId,"onUpdate:modelValue":f=>y.targetViewId=f,disabled:!y.sourceFieldActiveId,placeholder:a(d)("visualization.select_param"),style:{width:"100%"},onChange:f=>Ve(y)},{default:t(()=>[(u(!0),b(E,null,q(l.currentOutParams,f=>(u(),m(Q,{key:f.id,label:f.title,value:f.id},{default:t(()=>[o("span",Kl,[e(s,null,{default:t(()=>[(u(),m(M(a(re)[f.type]),{class:"svg-icon view-type-icon",style:{width:"14px",height:"14px"}}))]),_:2},1024),o("span",Wl,r(f.title),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","placeholder","onChange"])]),e(g,{class:"m-del-icon-btn",text:"",onClick:f=>be(y.targetId)},{default:t(()=>[e(k,{size:"20px"},{default:t(()=>[e(s,{name:"icon_delete-trash_outlined"},{default:t(()=>[e(a(Me),{class:"svg-icon"})]),_:1})]),_:1})]),_:2},1032,["onClick"])]))),128))]),_:1}),e(g,{style:{"margin-top":"8px"},disabled:!l.linkJumpInfo.targetDvId,type:"primary",icon:"Plus",text:"",onClick:i[10]||(i[10]=y=>ve("outerParams"))},{default:t(()=>[_(r(a(d)("visualization.add_jump_field")),1)]),_:1},8,["disabled"])],2)],64)):P("",!0)],64)):P("",!0)],64)):(u(),m(Ze,{key:1,style:{height:"auto"},description:a(C),"img-type":"noneWhite"},null,8,["description"]))]}),_:1})):P("",!0),ye.value?(u(),m(n,{key:1,gutter:8,class:"main-form"},{default:t(()=>[e(S,{span:16,style:{height:"100%"}},{default:t(()=>[o("div",ql,[_(r(a(d)("visualization.target_url"))+" ",1),e(F,{class:"item",effect:"dark",placement:"bottom"},{content:t(()=>[_(r(c.$t("visualization.target_url_tips")),1)]),default:t(()=>[e(k,{size:"16px",class:"hint-icon"},{default:t(()=>[e(s,{name:"icon_info_outlined"},{default:t(()=>[e(a(Re),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),o("div",Rl,[e(il,{ref_key:"outerContentEditor",ref:j,"link-jump-info":l.linkJumpInfo,"link-jump-info-array":l.linkJumpInfoArray},null,8,["link-jump-info","link-jump-info-array"])])]),_:1}),e(S,{span:8,style:{height:"100%"}},{default:t(()=>[o("div",Zl,[_(r(a(d)("visualization.select_world"))+" ",1),e(F,{class:"item",effect:"dark",placement:"bottom"},{content:t(()=>[o("span",{innerHTML:c.$t("chart.reference_field_tip")},null,8,Hl)]),default:t(()=>[e(k,{size:"16px",class:"hint-icon"},{default:t(()=>[e(s,{name:"icon_info_outlined"},{default:t(()=>[e(a(Re),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),o("div",Xl,[e(_t,{modelValue:l.searchField,"onUpdate:modelValue":i[11]||(i[11]=I=>l.searchField=I),placeholder:a(d)("dataset.search"),"prefix-icon":a(Rt),clearable:""},null,8,["modelValue","placeholder","prefix-icon"]),e(a(Ne),{style:{"margin-top":"12px"},height:"250px"},{default:t(()=>[(u(!0),b(E,null,q(l.linkJumpInfoArray.filter(I=>!l.searchField||I.sourceFieldName.indexOf(l.searchField)>-1),I=>(u(),b("span",{key:I.sourceFieldId,class:"item-dimension",title:I.sourceFieldName,onClick:B=>he("["+I.sourceFieldName+"]")},[e(k,null,{default:t(()=>[e(s,null,{default:t(()=>[(u(),m(M(a(fe)[a(K)[I.sourceDeType]]),{class:le(["svg-icon",`field-icon-${a(K)[I.sourceDeType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),_(" "+r(I.sourceFieldName),1)],8,Gl))),128))]),_:1})])]),_:1})]),_:1})):P("",!0)],64)):(u(),b("div",Ql,[e(Ze,{description:a(d)("visualization.select_dimension_hint"),"img-type":"noneWhite"},null,8,["description"])]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})),[[qe,l.loading]]),e(n,{class:"root-class"},{default:t(()=>[e(g,{size:"mini",onClick:i[12]||(i[12]=I=>ge())},{default:t(()=>[_(r(a(d)("common.cancel")),1)]),_:1}),e(g,{type:"primary",size:"mini",onClick:i[13]||(i[13]=I=>ie())},{default:t(()=>[_(r(a(d)("dataset.confirm")),1)]),_:1})]),_:1})],32)):P("",!0),e(a(Jt),{ref_key:"openHandler",ref:se,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)]),_:1},8,["title","modelValue"])),[[qe,l.loading]])}}});const rn=We(ea,[["__scopeId","data-v-96cda48b"]]),ta={class:"option-set ed-dialog__title"},la={style:{"font-weight":"normal"}},aa={style:{"font-weight":"normal"}},na=ze({__name:"LinkageSetOption",props:{title:Gt.string,baseWidth:{required:!1,type:String,default:"100%"},actionSelection:{required:!0,type:Object},themes:{type:String,default:"dark"}},setup(ae){const{t:O}=Be(),U=ae;z();const w=()=>{},{title:X,themes:de,actionSelection:L}=st(U);return(d,T)=>{const x=Pe("Setting"),R=je,J=Ue,A=Ye,C=et,$=At;return u(),m($,{placement:"right-start",width:"auto","popper-style":"max-width:"+ae.baseWidth,trigger:"click","show-arrow":!1},{reference:t(()=>[o("span",ta,[_(r(a(O)("visualization.linkage_setting"))+" ",1),e(R,{style:{margin:"5px 0 0 5px"}},{default:t(()=>[e(x)]),_:1})])]),default:t(()=>[e(J,null,{default:t(()=>[_(r(a(O)("visualization.select_linkage_tips")),1)]),_:1}),e(J,null,{default:t(()=>[e(C,{style:{"margin-top":"12px"},modelValue:a(L).linkageActive,"onUpdate:modelValue":T[0]||(T[0]=l=>a(L).linkageActive=l),onChange:w,class:"radio_group"},{default:t(()=>[e(A,{label:"custom"},{default:t(()=>[o("span",la,r(a(O)("visualization.linkage_option1")),1)]),_:1}),e(A,{label:"auto"},{default:t(()=>[o("span",aa,r(a(O)("visualization.linkage_option2")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["popper-style"])}}});const ia=We(na,[["__scopeId","data-v-b54512a6"]]),sa={class:"top-area"},oa={class:"top-area-text",style:{"margin-left":"0"}},ra={class:"top-area-value"},da={class:"top-area-text"},ua={class:"top-area-value"},ca={class:"head-text"},pa={class:"head-filter"},fa={class:"custom-tree-node"},_a={class:"auth-span"},ma={class:"tree-select-field"},va={class:"custom-tree-node"},ga={class:"auth-span"},ha={class:"tree-select-field"},ya={style:{display:"flex"},class:"inner-content"},ka={style:{flex:"1"}},wa={style:{flex:"1"}},Ia={style:{width:"100%","max-height":"350px","overflow-y":"auto"}},xa={style:{flex:"1"}},ba={class:"select-filed"},Va={class:"custom-option"},Ca={style:{float:"left","margin-left":"4px","font-size":"14px"}},Sa={style:{flex:"1"}},Aa={class:"select-filed"},Ja={class:"custom-option"},Fa={style:{float:"left","margin-left":"4px","font-size":"14px"}},za={style:{"margin-top":"8px","font-size":"14px"}},La=ze({__name:"LinkageSet",setup(ae,{expose:O}){const U=dt(),{dvInfo:w,canvasViewInfo:X,componentData:de,curComponent:L}=ut(U),d=z(null),T=z(null),{t:x}=Be(),R=z(!1),J=z(!1),A=z([]),C=z([]),$=z([]),l=pt(),p=Ke({sourceLinkageInfo:{},showSelected:!1,curLinkageViewInfo:{},curDatasetInfo:{},initState:!1,viewId:null,tableId:null,treeProp:{id:"targetViewId",label:"targetViewName",children:"children"},linkageInfo:null}),j=z(!1),Z=z(!1),N=z(Ft(ll)),ne=z(!0),ie=z(!0),ue=()=>{const s=C.value.filter(n=>n.linkageActive).length;j.value=s===C.value.length,Z.value=s>0&&s<C.value.length},Ie=s=>{C.value.forEach(n=>{s?(n.linkageActive=!0,j.value=!0,Ce(n)):(n.linkageActive=!1,j.value=!1)}),Z.value=!1},me=_e(()=>C.value&&C.value.length>0),xe=_e(()=>$.value&&$.value.length>0),ve=s=>{p.showSelected=!1,R.value=!0,p.initState=!1,Le(s)},be=s=>{const n=[];Ut(de.value,n);const h={dvId:w.value.id,sourceViewId:s,targetViewIds:n,linkageInfo:null};jt(h).then(v=>{A.value=v.data||[],A.value.forEach(S=>{S.targetViewId===s&&(p.sourceLinkageInfo=S)}),A.value=A.value.filter(S=>S.targetViewId!==p.viewId),C.value=A.value.filter(S=>S.tableId===p.tableId),$.value=A.value.filter(S=>S.tableId!==p.tableId);let k,V;C.value&&C.value.length>0?(k=C.value[0],V="sameDs"):$.value&&$.value.length>0&&(k=$.value[0],V="diffDs"),p.initState=!0,we(()=>{k&&(V==="sameDs"?d.value:T.value).setCurrentKey(k.targetViewId),he(k),ue()})})},Le=s=>{p.initState=!1,p.viewId=s.id,A.value=[];const n=X.value[p.viewId];p.curLinkageViewInfo=n,n.tableId&&(p.tableId=n.tableId,ct(n.tableId).then(h=>{p.curDatasetInfo=h||{}})),N.value=L.value.actionSelection,be(p.viewId)},Ve=()=>{let s=0;if(A.value.forEach(h=>{let v=0;const k=h.linkageFields;if(k&&h.linkageActive&&k.forEach(function(V){V.sourceField&&V.targetField||(v++,s++)}),v>0){ke.error("【"+h.targetViewName+"】-"+x("visualization.exit_un_march_linkage_field"));return}}),s)return;const n={dvId:w.value.id,sourceViewId:p.viewId,linkageInfo:A.value};J.value=!0,Pt(n).then(()=>{L.value.actionSelection.linkageActive=N.value.linkageActive,l.recordSnapshotCache("saveLinkageSetting"),ke.success("保存成功"),Mt(w.value.id).then(h=>{U.setNowPanelTrackInfo(h.data)}),Te(),rt(w.value.id).then(h=>{U.setNowPanelJumpInfo(h.data),c()}),J.value=!1}).catch(()=>{J.value=!1})},Te=()=>{U.clearLinkageSettingInfo()},ge=(s,n)=>{n==="sameDs"?(d.value.setCurrentKey(s.targetViewId),T.value.setCurrentKey(null)):(d.value.setCurrentKey(null),T.value.setCurrentKey(s.targetViewId)),he(s)},he=s=>{p.linkageInfo=s},ye=(s,n,h)=>{const v={sourceField:n,targetField:h};s.linkageFields.push(v)},De=(s,n)=>{const h={sourceField:s,targetField:n};p.linkageInfo.linkageFields.push(h)},Ee=s=>{p.linkageInfo.linkageFields.splice(s,1)},Ce=async s=>{if(s.linkageActive){const n=X.value[s.targetViewId];if(n&&n.tableId&&s.linkageFields.length===0)if(p.curLinkageViewInfo.tableId===n.tableId){if(s.linkageFields&&s.linkageFields.length===0){const h=JSON.stringify(p.curLinkageViewInfo.xAxis)+JSON.stringify(p.curLinkageViewInfo.xAxisExt)+JSON.stringify(p.curLinkageViewInfo.extStack)+(p.curLinkageViewInfo.type.includes("chart-mix")?JSON.stringify(p.curLinkageViewInfo.extBubble):""),v=JSON.stringify(n.xAxis)+JSON.stringify(n.xAxisExt)+JSON.stringify(p.curLinkageViewInfo.extStack)+(n.type.includes("chart-mix")?JSON.stringify(n.extBubble):"");p.sourceLinkageInfo.targetViewFields.forEach(k=>{h.includes(k.id)&&v.includes(k.id)&&s.linkageFields&&ye(s,k.id,k.id)})}}else ye(s,"","")}},se=_e(()=>{if(p.sourceLinkageInfo.targetViewFields){const s=JSON.stringify(p.curLinkageViewInfo.xAxis)+JSON.stringify(p.curLinkageViewInfo.drillFields)+JSON.stringify(p.curLinkageViewInfo.xAxisExt)+JSON.stringify(p.curLinkageViewInfo.extStack)+(p.curLinkageViewInfo.type.includes("chart-mix")?JSON.stringify(p.curLinkageViewInfo.extBubble):"")+(p.curLinkageViewInfo.type.includes("table-normal")?JSON.stringify(p.curLinkageViewInfo.yAxis):"");return p.sourceLinkageInfo.targetViewFields.filter(n=>s.includes(n.id))}else return[]}),Se=(s,n)=>{we(()=>{s==="sameDs"?(d.value.setCurrentKey(n.targetViewId),T.value.setCurrentKey(null)):(d.value.setCurrentKey(null),T.value.setCurrentKey(n.targetViewId)),he(n),Ce(n),ue()})},c=()=>{R.value=!1,p.initState=!1},i=(s,n)=>!s||n.linkageActive;return Oe(()=>p.showSelected,s=>{var n,h;(n=d.value)==null||n.filter(s),(h=T.value)==null||h.filter(s)}),O({dialogInit:ve}),(s,n)=>{const h=it,v=Ue,k=He,V=Pe("CaretBottom"),S=Pe("CaretRight"),D=je,G=Xe,ee=Ge,Ae=Qe,Q=tt,Y=lt,ce=at,Je=nt,$e=ot("loading");return u(),m(Je,{ref:"enlargeDialog","append-to-body":!0,modelValue:R.value,"onUpdate:modelValue":n[13]||(n[13]=g=>R.value=g),width:"70vw",top:"10vh",trigger:"click"},{default:t(()=>[a(L)&&a(L).actionSelection?(u(),m(ia,{key:0,"action-selection":N.value},null,8,["action-selection"])):P("",!0),p.initState?W((u(),b("div",{key:1,onKeydown:n[11]||(n[11]=oe(()=>{},["stop"])),onKeyup:n[12]||(n[12]=oe(()=>{},["stop"])),style:{height:"550px","margin-top":"22px"}},[e(v,{style:{"flex-direction":"row"}},{default:t(()=>[o("div",sa,[o("span",oa,r(a(x)("visualization.selected_view"))+"：",1),o("span",ra,[e(h,{"class-name":"view-type-icon"},{default:t(()=>[(u(),m(M(a(re)[p.curLinkageViewInfo.type]),{class:"svg-icon view-type-icon"}))]),_:1}),_(" "+r(p.curLinkageViewInfo.title),1)]),o("span",da,r(a(x)("visualization.used_dataset"))+"：",1),o("span",ua,[e(h,{"class-name":"view-type-icon",name:"dataset-outline"},{default:t(()=>[e(a(ft),{style:{"vertical-align":"-0.2em"},class:"svg-icon view-type-icon"})]),_:1}),_(" "+r(p.curDatasetInfo.name),1)])])]),_:1}),e(v,null,{default:t(()=>[e(v,{class:"preview"},{default:t(()=>[e(Ae,{span:8,style:{height:"100%","overflow-y":"auto"}},{default:t(()=>[e(v,{class:"tree-head"},{default:t(()=>[o("span",ca,r(a(x)("visualization.to_select_view")),1),o("span",pa,[_(r(a(x)("visualization.show_selected_only"))+" ",1),e(k,{size:"small",modelValue:p.showSelected,"onUpdate:modelValue":n[0]||(n[0]=g=>p.showSelected=g)},null,8,["modelValue"])])]),_:1}),W(e(v,{class:"tree-dataset-head"},{default:t(()=>[o("span",null,[e(D,{class:"toggle-icon",onClick:n[1]||(n[1]=()=>ne.value=!ne.value)},{default:t(()=>[W(e(V,null,null,512),[[te,ne.value]]),W(e(S,null,null,512),[[te,!ne.value]])]),_:1}),o("span",null,r(a(x)("visualization.same_dataset")),1)]),e(G,{modelValue:j.value,"onUpdate:modelValue":n[2]||(n[2]=g=>j.value=g),indeterminate:Z.value,onChange:Ie},{default:t(()=>[_(r(a(x)("visualization.select_all")),1)]),_:1},8,["modelValue","indeterminate"])]),_:1},512),[[te,me.value]]),W(e(ee,{class:"custom-tree",menu:"",ref_key:"linkageInfoTree",ref:d,"empty-text":a(x)("visualization.no_available_view"),"filter-node-method":i,data:C.value,"node-key":"targetViewId","highlight-current":"",props:p.treeProp,onNodeClick:n[4]||(n[4]=g=>ge(g,"sameDs"))},{default:t(({data:g})=>[o("span",fa,[o("span",null,[o("div",{onClick:n[3]||(n[3]=oe(()=>{},["stop"]))},[o("span",_a,[e(G,{modelValue:g.linkageActive,"onUpdate:modelValue":H=>g.linkageActive=H,onChange:H=>Se("sameDs",g)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),o("span",null,[o("span",ma,[e(h,{"class-name":"view-type-icon"},{default:t(()=>[(u(),m(M(a(re)[g.targetViewType]),{style:{"margin-right":"4px"},class:"svg-icon view-type-icon"}))]),_:2},1024),_(" "+r(g.targetViewName),1)])])])]),_:1},8,["empty-text","data","props"]),[[te,ne.value&&me.value]]),W(e(v,{class:"tree-dataset-head tree-dataset-head-top"},{default:t(()=>[o("span",null,[e(D,{class:"toggle-icon",onClick:n[5]||(n[5]=()=>ie.value=!ie.value)},{default:t(()=>[W(e(V,null,null,512),[[te,ie.value]]),W(e(S,null,null,512),[[te,!ie.value]])]),_:1}),o("span",null,r(a(x)("visualization.diff_dataset")),1)])]),_:1},512),[[te,xe.value]]),W(e(ee,{class:"custom-tree",menu:"",ref_key:"linkageInfoTreeDiffDs",ref:T,"empty-text":a(x)("visualization.no_available_view"),"filter-node-method":i,data:$.value,"node-key":"targetViewId","highlight-current":"",props:p.treeProp,onNodeClick:n[7]||(n[7]=g=>ge(g,"diffDs"))},{default:t(({data:g})=>[o("span",va,[o("span",null,[o("div",{onClick:n[6]||(n[6]=oe(()=>{},["stop"]))},[o("span",ga,[e(G,{modelValue:g.linkageActive,"onUpdate:modelValue":H=>g.linkageActive=H,onChange:H=>Se("diffDs",g)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),o("span",null,[o("span",ha,[e(h,{name:g.targetViewType},{default:t(()=>[(u(),m(M(a(re)[g.targetViewType]),{class:"svg-icon view-type-icon",style:{"margin-right":"4px"}}))]),_:2},1032,["name"]),_(" "+r(g.targetViewName),1)])])])]),_:1},8,["empty-text","data","props"]),[[te,ie.value&&xe.value]])]),_:1}),e(Ae,{span:16,class:"preview-show"},{default:t(()=>[e(v,{class:"content-head"},{default:t(()=>[_(r(a(x)("visualization.linkage_setting_tips1")),1)]),_:1}),p.linkageInfo&&p.linkageInfo.linkageActive?(u(),m(v,{key:0},{default:t(()=>[e(v,{style:{"margin-top":"5px"}},{default:t(()=>[o("div",ya,[o("div",ka,r(a(x)("visualization.current_chart_source_field")),1),n[14]||(n[14]=o("div",{style:{width:"36px"}},null,-1)),o("div",wa,r(a(x)("visualization.link_view_field")),1),n[15]||(n[15]=o("div",{style:{width:"32px"}},null,-1))]),o("div",Ia,[(u(!0),b(E,null,q(p.linkageInfo.linkageFields,(g,H)=>(u(),b("div",{style:{display:"flex",padding:"0 16px 8px"},key:H},[o("div",xa,[o("div",ba,[e(Y,{modelValue:g.sourceField,"onUpdate:modelValue":F=>g.sourceField=F,placeholder:a(x)("chart.pls_select_field"),style:{width:"100%"}},{default:t(()=>[(u(!0),b(E,null,q(se.value,F=>(u(),m(Q,{key:F.id,label:F.name,value:F.id},{default:t(()=>[o("span",Va,[e(h,null,{default:t(()=>[(u(),m(M(a(fe)[a(K)[F.deType]]),{style:{width:"14px",height:"14px"},class:le([`field-icon-${a(K)[F.deType]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024),o("span",Ca,r(F.name),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])]),e(D,{class:"link-icon-join"},{default:t(()=>[e(h,{style:{width:"20px",height:"20px"},name:"dv-link-target"},{default:t(()=>[e(a(Fe),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),_:1}),o("div",Sa,[o("div",Aa,[e(Y,{modelValue:g.targetField,"onUpdate:modelValue":F=>g.targetField=F,placeholder:a(x)("common.selectText"),style:{width:"100%"}},{default:t(()=>[(u(!0),b(E,null,q(p.linkageInfo.targetViewFields,F=>(u(),m(Q,{key:F.id,label:F.name,value:F.id},{default:t(()=>[o("span",Ja,[e(h,null,{default:t(()=>[(u(),m(M(a(fe)[a(K)[F.deType]]),{style:{width:"14px",height:"14px"},class:le(["svg-icon",`field-icon-${a(K)[F.deType]}`])},null,8,["class"]))]),_:2},1024),o("span",Fa,r(F.name),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])]),e(ce,{class:"m-del-icon-btn",text:"",onClick:F=>Ee(H)},{default:t(()=>[e(D,{size:"16px"},{default:t(()=>[e(h,{name:"icon_delete-trash_outlined"},{default:t(()=>[e(a(Me),{class:"svg-icon"})]),_:1})]),_:1})]),_:2},1032,["onClick"])]))),128))]),e(v,{style:{width:"100%","padding-left":"16px"}},{default:t(()=>[e(ce,{type:"primary",icon:"Plus",text:"",onClick:n[8]||(n[8]=g=>De("",""))},{default:t(()=>[_(r(a(x)("visualization.add_linkage_dependency_fields")),1)]),_:1})]),_:1})]),_:1})]),_:1})):(u(),m(v,{key:1,style:{height:"100%"},class:"custom-position"},{default:t(()=>[e(h,{name:"dv-empty"},{default:t(()=>[e(a(tl),{style:{width:"125px",height:"125px"},class:"svg-icon"})]),_:1}),o("span",za,r(a(x)("visualization.select_linkage_tips")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(v,{class:"root-class"},{default:t(()=>[e(ce,{size:"mini",onClick:n[9]||(n[9]=g=>c())},{default:t(()=>[_(r(a(x)("common.cancel")),1)]),_:1}),e(ce,{type:"primary",size:"mini",onClick:n[10]||(n[10]=g=>Ve())},{default:t(()=>[_(r(a(x)("dataset.confirm")),1)]),_:1})]),_:1})],32)),[[$e,J.value]]):P("",!0)]),_:1},8,["modelValue"])}}});const dn=We(La,[["__scopeId","data-v-6a887676"]]);export{rn as L,dn as a};

import{i as q}from"./imgUtils-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";import{d as G}from"./dvMain-0.0.0-dataease.js";import{b as z}from"./chart-0.0.0-dataease2.js";import{p as _}from"./util-0.0.0-dataease2.js";import{m as W}from"./index-0.0.0-dataease19.js";import{d as Z,ah as $,Z as D,r as p,t as H,G as V,w as K,ak as Q,f,L as O,g as L,V as X,j as N,n as m}from"./vue-0.0.0-dataease.js";import Y from"./ChartEmptyInfo-0.0.0-dataease.js";import b from"./ChartError-0.0.0-dataease.js";import{_ as k}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./util-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./index-0.0.0-dataease20.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./el-row-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./chart-dark-list-0.0.0-dataease.js";import"./chart-list-0.0.0-dataease.js";import"./el-dialog-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import"./index-0.0.0-dataease14.js";const ee={class:"pic-main"},te=["src"],oe=Z({__name:"Component",props:{element:{type:Object,default(){return{propValue:{urlList:[]}}}},showPosition:{required:!1,type:String,default:"preview"},view:{type:Object,default(){return{propValue:null}}}},setup(R,{expose:A}){const I=G(),{canvasViewInfo:C,editMode:re,mobileInPc:E,canvasStyleData:ie}=$(I),s=D({emptyValue:"-",data:null,viewDataInfo:null,showUrl:null,firstRender:!0,previewFirstRender:!0,curImgList:[]}),l=p(!0),F=R,v=p(!1),x=p(""),U=p({}),c=p({}),h=p([]);let u=null;const{element:i,view:g,showPosition:J}=H(F),S=V(()=>J.value.includes("canvas")&&!E.value);K(()=>S.value,()=>{w()});const w=()=>{var n,r;u&&clearInterval(u),u=null;const t=((n=i.value.propValue.urlList)==null?void 0:n.length)||0,{threshold:o}=_(g.value.senior);if(!S.value&&!o.enable&&t>0&&((r=i.value.carousel)!=null&&r.enable)){const e=(i.value.carousel.time||5)*1e3;let a=1;u=setInterval(()=>{const d=a%i.value.propValue.urlList.length;a++,m(()=>{s.showUrl=i.value.propValue.urlList[d].url})},e)}},M=V(()=>{const t={position:"relative",width:"100%",height:"100%"};return i.value.style.adaptation==="original"?(t.width="auto",t.height="auto"):i.value.style.adaptation==="equiratio"&&(t.height="auto"),t}),T=t=>{if(h.value=[],U.value={},c.value={},t.data&&t.data.sourceFields){const o=JSON.stringify(t.xAxis)+JSON.stringify(t.xAxisExt)+JSON.stringify(t.yAxis)+JSON.stringify(t.yAxisExt);t.data.sourceFields.forEach(e=>{o.indexOf(e.id)>-1&&h.value.push(`[${e.name}]`)}),o.indexOf('"记录数*"')>-1&&h.value.push("[记录数*]");const n=t.data.fields.reduce((e,a)=>(e[a.dataeaseName]=a.name,e),{}),r=t.data.tableRow[0];for(const e in r)c.value[n[e]]=r[e]}B(g.value)},B=t=>{if(s.showUrl=null,!t||!t.senior)return;const{threshold:o}=_(t.senior);if(!o.enable)return;const n=o.tableThreshold??[];if((n==null?void 0:n.length)>0)for(let r=0;r<n.length;r++){const e=n[r];let a=null;const d=W(c.value[e.field.name],a,e,"url");d&&(s.showUrl=d)}},y=()=>{i.value.propValue.urlList&&i.value.propValue.urlList.length>0&&(s.showUrl=i.value.propValue.urlList[0].url),w()},P=(t,o)=>{v.value=!1;const{threshold:n}=_(t.senior);if(!n.enable){y(),o==null||o();return}if(t.tableId||t.dataFrom==="template"){const r=JSON.parse(JSON.stringify(t));r.type="table-info",r.render="antv",r.resultCount=1,z(r).then(e=>{if(e.code&&e.code!==0)v.value=!0,x.value=e.msg;else{e.type="picture-group",e.render="custom",s.data=e==null?void 0:e.data,s.viewDataInfo=e,s.totalItems=e==null?void 0:e.totalItems;const a=C.value[i.value.id];a.curFields=e.data.fields,I.setViewDataDetails(i.value.id,e),l.value=!0,T(e),w()}o==null||o(),m(()=>{l.value=!0})}).catch(e=>{console.error(e),m(()=>{l.value=!0}),o==null||o()})}else t.tableId?(y(),m(()=>{l.value=!0}),o==null||o()):(l.value=!0,y(),o==null||o(),m(()=>{l.value=!0}))},j=t=>{};return Q(()=>{u&&(clearInterval(u),u=null)}),A({calcData:P,renderChart:j}),(t,o)=>(f(),O("div",ee,[v.value?(f(),L(b,{key:0,"err-msg":x.value},null,8,["err-msg"])):s.showUrl?(f(),O("img",{key:1,draggable:"false",style:X(M.value),src:N(q)(s.showUrl)},null,12,te)):(f(),L(Y,{key:2,"view-icon":N(g).type},null,8,["view-icon"]))]))}});const He=k(oe,[["__scopeId","data-v-c9aa9026"]]);export{He as default};

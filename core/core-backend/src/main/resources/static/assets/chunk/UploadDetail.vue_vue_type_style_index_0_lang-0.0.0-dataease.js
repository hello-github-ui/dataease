import{p as _,r as Y,w as Z,h as $,K as G,v as H,L as P}from"./element-plus-secondary-0.0.0-dataease.js";import{j as Q,h as ee}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as ae,l as B,r as m,ak as te,o as g,Z as v,_ as l,a as oe,a0 as s,a4 as y,a2 as h,u as r,W as u,a1 as le,Y as S,X as D}from"./@vue-0.0.0-dataease.js";import{i as se}from"./icon_upload_outlined-0.0.0-dataease.js";import{u as ne,e as ie}from"./font-0.0.0-dataease.js";import re from"./FontInfo-0.0.0-dataease.js";import{e as E}from"./lodash-es-0.0.0-dataease.js";const me={class:"dialog-footer"},ye=ae({__name:"UploadDetail",emits:["finish"],setup(ue,{expose:U,emit:I}){const i=B({fileList:null}),f=m(!1),j=m(),{t:o}=Q(),T=()=>{const t=new FormData;return t.append("file",i.fileList.raw),f.value=!0,ne(t).then(e=>{var n;a.name=e.data.name,a.size=e.data.size,a.sizeType=e.data.sizeType,a.fileTransName=e.data.fileTransName,a.fileName=i.fileList.raw.name,(n=j.value)==null||n.clearFiles()}).catch(e=>{e.code==="ECONNABORTED"&&_({type:"error",message:e.message,showClose:!0})}).finally(()=>{f.value=!1})},b=m(""),c=m(!1),d=m(""),w={id:null,name:"",fileName:"",fileTransName:"",size:0,sizeType:"",isDefault:0,isBuiltin:0,updateTime:0},a=B(E(w)),A=(t,e,n)=>{b.value=t||o("system.add_font"),d.value=e,c.value=!0,Object.assign(a,E(w)),Object.assign(a,JSON.parse(JSON.stringify(n)))},q=()=>{i.fileList=null},F=m(),M={name:[{required:!0,message:o("system.the_font_name"),trigger:"blur"},{min:1,max:50,message:o("system.character_length_1_50"),trigger:"blur"}]};U({init:A});const V=t=>t.name.toLocaleLowerCase().endsWith(".ttf")?!0:(_.error(o("system.in_ttf_format")),!1),z=t=>{var e,n;(n=(e=t.raw)==null?void 0:e.name)!=null&&n.toLocaleLowerCase().endsWith(".ttf")&&(i.fileList=t)},C=t=>{t.toString().replace("Error: ","")},R=I,N=()=>{Object.assign(a,E(w)),F.value.clearValidate(),i.fileList=null,c.value=!1},W=()=>{F.value.validate(t=>{if(t){if(d.value==="uploadFile"&&a.fileTransName===""){_.error(o("system.upload_font_file_de"));return}ie(a).then(()=>{_.success(b.value+o("data_set.success")),N(),R("finish")})}})};return(t,e)=>{const n=Y,x=Z,J=ee,p=$,k=G,K=H,X=P,O=te("loading");return g(),v(X,{class:"create-dialog add-form_font_dialog",modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=L=>c.value=L),"before-close":N,title:b.value,width:"420"},{footer:l(()=>[oe("div",me,[s(p,{onClick:N},{default:l(()=>[y(h(r(o)("userimport.cancel")),1)]),_:1}),u((g(),v(p,{type:"primary",onClick:W},{default:l(()=>[y(h(r(o)("userimport.sure")),1)]),_:1})),[[O,f.value]])])]),default:l(()=>[s(K,{onSubmit:e[1]||(e[1]=le(()=>{},["prevent"])),ref_key:"ruleFormRef",ref:F,model:a,"label-position":"top",rules:M,"label-width":"auto",class:"demo-ruleForm"},{default:l(()=>[d.value!=="uploadFile"?(g(),v(x,{key:0,label:r(o)("system.font_name"),prop:"name"},{default:l(()=>[s(n,{placeholder:r(o)("system.the_font_name"),modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=L=>a.name=L),modelModifiers:{trim:!0}},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):S("",!0),d.value!=="rename"?u((g(),v(x,{key:1,label:r(o)("system.font_file_de")},{default:l(()=>[u(s(k,{action:"",multiple:!1,ref:"uploadAgain","show-file-list":!1,accept:".ttf","on-change":z,"before-upload":V,"http-request":T,"on-error":C,name:"file"},{trigger:l(()=>[s(p,{secondary:""},{icon:l(()=>[s(J,{name:"icon_upload_outlined"},{default:l(()=>[s(r(se),{class:"svg-icon"})]),_:1})]),default:l(()=>[y(" "+h(r(o)("system.upload_font_file")),1)]),_:1})]),_:1},512),[[D,!i.fileList]]),u(s(re,{onDel:q,size:a.size+" "+a.sizeType,name:a.fileName},null,8,["size","name"]),[[D,i.fileList]]),u(s(k,{action:"",multiple:!1,ref:"uploadAgain","before-upload":V,"show-file-list":!1,accept:".ttf","on-change":z,"http-request":T,"on-error":C,name:"file"},{trigger:l(()=>[s(p,{text:""},{default:l(()=>[y(h(r(o)("data_source.reupload")),1)]),_:1})]),_:1},512),[[D,i.fileList]])]),_:1},8,["label"])),[[O,f.value]]):S("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}});export{ye as _};

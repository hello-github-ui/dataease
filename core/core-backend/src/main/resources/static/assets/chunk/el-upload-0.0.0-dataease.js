import{P as E,d as F,r as se,f as b,g as P,i as w,L,Y as ce,a9 as fe,U as g,j as t,ac as ae,$ as R,a0 as k,M as j,ab as O,k as S,a6 as X,V as pe,aB as me,H as ve,Q as ye,s as z,w as G,ap as ge,G as Q,a as he,R as be,S as ke,aw as J,a4 as Y}from"./vue-0.0.0-dataease.js";import{m as I,H as Ee,j as T,a9 as $e}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{t as W,i as N,o as y,f as D,aj as Re,Q as we,aa as Ce,B as Se,E as Le,ak as Pe,al as Fe,am as Ue,a1 as Te,w as Oe}from"./index-0.0.0-dataease.js";import{E as _e}from"./el-progress-0.0.0-dataease.js";import{h as oe}from"./lodash-0.0.0-dataease.js";const ne=Symbol("uploadContextKey"),Be="ElUpload";class je extends Error{constructor(r,s,n,d){super(r),this.name="UploadAjaxError",this.status=s,this.method=n,this.url=d}}function Z(a,r,s){let n;return s.response?n=`${s.response.error||s.response}`:s.responseText?n=`${s.responseText}`:n=`fail to ${r.method} ${a} ${s.status}`,new je(n,s.status,r.method,a)}function De(a){const r=a.responseText||a.response;if(!r)return r;try{return JSON.parse(r)}catch{return r}}const Ne=a=>{typeof XMLHttpRequest>"u"&&W(Be,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,s=a.action;r.upload&&r.upload.addEventListener("progress",c=>{const m=c;m.percent=c.total>0?c.loaded/c.total*100:0,a.onProgress(m)});const n=new FormData;if(a.data)for(const[c,m]of Object.entries(a.data))Array.isArray(m)?n.append(c,...m):n.append(c,m);n.append(a.filename,a.file,a.file.name),r.addEventListener("error",()=>{a.onError(Z(s,a,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return a.onError(Z(s,a,r));a.onSuccess(De(r))}),r.open(a.method,s,!0),a.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const d=a.headers||{};if(d instanceof Headers)d.forEach((c,m)=>r.setRequestHeader(m,c));else for(const[c,m]of Object.entries(d))oe(m)||r.setRequestHeader(c,String(m));return r.send(n),r},le=["text","picture","picture-card"];let qe=1;const V=()=>Date.now()+qe++,re=N({action:{type:String,default:"#"},headers:{type:y(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>I({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:y(Array),default:()=>I([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:le,default:"text"},httpRequest:{type:y(Function),default:Ne},disabled:Boolean,limit:Number}),Ae=N({...re,beforeUpload:{type:y(Function),default:E},beforeRemove:{type:y(Function)},onRemove:{type:y(Function),default:E},onChange:{type:y(Function),default:E},onPreview:{type:y(Function),default:E},onSuccess:{type:y(Function),default:E},onProgress:{type:y(Function),default:E},onError:{type:y(Function),default:E},onExceed:{type:y(Function),default:E}}),He=N({files:{type:y(Array),default:()=>I([])},disabled:{type:Boolean,default:!1},handlePreview:{type:y(Function),default:E},listType:{type:String,values:le,default:"text"}}),Me={remove:a=>!!a},Ke=["onKeydown"],ze=["src"],Ie=["onClick"],Ve=["onClick"],We=["onClick"],Xe=F({name:"ElUploadList"}),x=F({...Xe,props:He,emits:Me,setup(a,{emit:r}){const{t:s}=Ee(),n=D("upload"),d=D("icon"),c=D("list"),m=se(!1),C=u=>{r("remove",u)};return(u,v)=>(b(),P(me,{tag:"ul",class:g([t(n).b("list"),t(n).bm("list",u.listType),t(n).is("disabled",u.disabled)]),name:t(c).b()},{default:w(()=>[(b(!0),L(ce,null,fe(u.files,f=>(b(),L("li",{key:f.uid||f.name,class:g([t(n).be("list","item"),t(n).is(f.status),{focusing:m.value}]),tabindex:"0",onKeydown:ae($=>!u.disabled&&C(f),["delete"]),onFocus:v[0]||(v[0]=$=>m.value=!0),onBlur:v[1]||(v[1]=$=>m.value=!1),onClick:v[2]||(v[2]=$=>m.value=!1)},[R(u.$slots,"default",{file:f},()=>[u.listType==="picture"||f.status!=="uploading"&&u.listType==="picture-card"?(b(),L("img",{key:0,class:g(t(n).be("list","item-thumbnail")),src:f.url,alt:""},null,10,ze)):k("v-if",!0),f.status==="uploading"||u.listType!=="picture-card"?(b(),L("div",{key:1,class:g(t(n).be("list","item-info"))},[j("a",{class:g(t(n).be("list","item-name")),onClick:O($=>u.handlePreview(f),["prevent"])},[S(t(T),{class:g(t(d).m("document"))},{default:w(()=>[S(t(Re))]),_:1},8,["class"]),j("span",{class:g(t(n).be("list","item-file-name"))},X(f.name),3)],10,Ie),f.status==="uploading"?(b(),P(t(_e),{key:0,type:u.listType==="picture-card"?"circle":"line","stroke-width":u.listType==="picture-card"?6:2,percentage:Number(f.percentage),style:pe(u.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):k("v-if",!0)],2)):k("v-if",!0),j("label",{class:g(t(n).be("list","item-status-label"))},[u.listType==="text"?(b(),P(t(T),{key:0,class:g([t(d).m("upload-success"),t(d).m("circle-check")])},{default:w(()=>[S(t(we))]),_:1},8,["class"])):["picture-card","picture"].includes(u.listType)?(b(),P(t(T),{key:1,class:g([t(d).m("upload-success"),t(d).m("check")])},{default:w(()=>[S(t(Ce))]),_:1},8,["class"])):k("v-if",!0)],2),u.disabled?k("v-if",!0):(b(),P(t(T),{key:2,class:g(t(d).m("close")),onClick:$=>C(f)},{default:w(()=>[S(t(Se))]),_:2},1032,["class","onClick"])),k(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),k(" This is a bug which needs to be fixed "),k(" TODO: Fix the incorrect navigation interaction "),u.disabled?k("v-if",!0):(b(),L("i",{key:3,class:g(t(d).m("close-tip"))},X(t(s)("el.upload.deleteTip")),3)),u.listType==="picture-card"?(b(),L("span",{key:4,class:g(t(n).be("list","item-actions"))},[j("span",{class:g(t(n).be("list","item-preview")),onClick:$=>u.handlePreview(f)},[S(t(T),{class:g(t(d).m("zoom-in"))},{default:w(()=>[S(t(Le))]),_:1},8,["class"])],10,Ve),u.disabled?k("v-if",!0):(b(),L("span",{key:0,class:g(t(n).be("list","item-delete")),onClick:$=>C(f)},[S(t(T),{class:g(t(d).m("delete"))},{default:w(()=>[S(t(Pe))]),_:1},8,["class"])],10,We))],2)):k("v-if",!0)])],42,Ke))),128)),R(u.$slots,"append")]),_:3},8,["class","name"]))}}),Ge=N({disabled:{type:Boolean,default:!1}}),Qe={file:a=>ve(a)},Je=["onDrop","onDragover"],ie="ElUploadDrag",Ye=F({name:ie}),Ze=F({...Ye,props:Ge,emits:Qe,setup(a,{emit:r}){const s=a,n=ye(ne);n||W(ie,"usage: <el-upload><el-upload-dragger /></el-upload>");const d=D("upload"),c=se(!1),m=u=>{if(s.disabled)return;c.value=!1;const v=Array.from(u.dataTransfer.files),f=n.accept.value;if(!f){r("file",v);return}const $=v.filter(l=>{const{type:e,name:o}=l,p=o.includes(".")?`.${o.split(".").pop()}`:"",h=e.replace(/\/.*$/,"");return f.split(",").map(i=>i.trim()).filter(i=>i).some(i=>i.startsWith(".")?p===i:/\/\*$/.test(i)?h===i.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(i)?e===i:!1)});r("file",$)},C=()=>{s.disabled||(c.value=!0)};return(u,v)=>(b(),L("div",{class:g([t(d).b("dragger"),t(d).is("dragover",c.value)]),onDrop:O(m,["prevent"]),onDragover:O(C,["prevent"]),onDragleave:v[0]||(v[0]=O(f=>c.value=!1,["prevent"]))},[R(u.$slots,"default")],42,Je))}}),xe=N({...re,beforeUpload:{type:y(Function),default:E},onRemove:{type:y(Function),default:E},onStart:{type:y(Function),default:E},onSuccess:{type:y(Function),default:E},onProgress:{type:y(Function),default:E},onError:{type:y(Function),default:E},onExceed:{type:y(Function),default:E}}),et=["onKeydown"],tt=["name","multiple","accept"],st=F({name:"ElUploadContent",inheritAttrs:!1}),ee=F({...st,props:xe,setup(a,{expose:r}){const s=a,n=D("upload"),d=z({}),c=z(),m=e=>{if(e.length===0)return;const{autoUpload:o,limit:p,fileList:h,multiple:i,onStart:q,onExceed:U}=s;if(p&&h.length+e.length>p){U(e,h);return}i||(e=e.slice(0,1));for(const A of e){const _=A;_.uid=V(),q(_),o&&C(_)}},C=async e=>{if(c.value.value="",!s.beforeUpload)return u(e);let o;try{o=await s.beforeUpload(e)}catch{o=!1}if(o===!1){s.onRemove(e);return}let p=e;o instanceof Blob&&(o instanceof File?p=o:p=new File([o],e.name,{type:e.type})),u(Object.assign(p,{uid:e.uid}))},u=e=>{const{headers:o,data:p,method:h,withCredentials:i,name:q,action:U,onProgress:A,onSuccess:_,onError:ue,httpRequest:de}=s,{uid:H}=e,M={headers:o||{},withCredentials:i,file:e,data:p,method:h,filename:q,action:U,onProgress:B=>{A(B,e)},onSuccess:B=>{_(B,e),delete d.value[H]},onError:B=>{ue(B,e),delete d.value[H]}},K=de(M);d.value[H]=K,K instanceof Promise&&K.then(M.onSuccess,M.onError)},v=e=>{const o=e.target.files;o&&m(Array.from(o))},f=()=>{s.disabled||(c.value.value="",c.value.click())},$=()=>{f()};return r({abort:e=>{Fe(d.value).filter(e?([p])=>String(e.uid)===p:()=>!0).forEach(([p,h])=>{h instanceof XMLHttpRequest&&h.abort(),delete d.value[p]})},upload:C}),(e,o)=>(b(),L("div",{class:g([t(n).b(),t(n).m(e.listType),t(n).is("drag",e.drag)]),tabindex:"0",onClick:f,onKeydown:ae(O($,["self"]),["enter","space"])},[e.drag?(b(),P(Ze,{key:0,disabled:e.disabled,onFile:m},{default:w(()=>[R(e.$slots,"default")]),_:3},8,["disabled"])):R(e.$slots,"default",{key:1}),j("input",{ref_key:"inputRef",ref:c,class:g(t(n).e("input")),name:e.name,multiple:e.multiple,accept:e.accept,type:"file",onChange:v,onClick:o[0]||(o[0]=O(()=>{},["stop"]))},null,42,tt)],42,et))}}),te="ElUpload",at=a=>{var r;(r=a.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(a.url)},ot=(a,r)=>{const s=Ue(a,"fileList",void 0,{passive:!0}),n=l=>s.value.find(e=>e.uid===l.uid);function d(l){var e;(e=r.value)==null||e.abort(l)}function c(l=["ready","uploading","success","fail"]){s.value=s.value.filter(e=>!l.includes(e.status))}const m=(l,e)=>{const o=n(e);o&&(console.error(l),o.status="fail",s.value.splice(s.value.indexOf(o),1),a.onError(l,o,s.value),a.onChange(o,s.value))},C=(l,e)=>{const o=n(e);o&&(a.onProgress(l,o,s.value),o.status="uploading",o.percentage=Math.round(l.percent))},u=(l,e)=>{const o=n(e);o&&(o.status="success",o.response=l,a.onSuccess(l,o,s.value),a.onChange(o,s.value))},v=l=>{oe(l.uid)&&(l.uid=V());const e={name:l.name,percentage:0,status:"ready",size:l.size,raw:l,uid:l.uid};if(a.listType==="picture-card"||a.listType==="picture")try{e.url=URL.createObjectURL(l)}catch(o){Te(te,o.message),a.onError(o,e,s.value)}s.value=[...s.value,e],a.onChange(e,s.value)},f=async l=>{const e=l instanceof File?n(l):l;e||W(te,"file to be removed not found");const o=p=>{d(p);const h=s.value;h.splice(h.indexOf(p),1),a.onRemove(p,h),at(p)};a.beforeRemove?await a.beforeRemove(e,s.value)!==!1&&o(e):o(e)};function $(){s.value.filter(({status:l})=>l==="ready").forEach(({raw:l})=>{var e;return l&&((e=r.value)==null?void 0:e.upload(l))})}return G(()=>a.listType,l=>{l!=="picture-card"&&l!=="picture"||(s.value=s.value.map(e=>{const{raw:o,url:p}=e;if(!p&&o)try{e.url=URL.createObjectURL(o)}catch(h){a.onError(h,e,s.value)}return e}))}),G(s,l=>{for(const e of l)e.uid||(e.uid=V()),e.status||(e.status="success")},{immediate:!0,deep:!0}),{uploadFiles:s,abort:d,clearFiles:c,handleError:m,handleProgress:C,handleStart:v,handleSuccess:u,handleRemove:f,submit:$}},nt=F({name:"ElUpload"}),lt=F({...nt,props:Ae,setup(a,{expose:r}){const s=a,n=ge(),d=$e(),c=z(),{abort:m,submit:C,clearFiles:u,uploadFiles:v,handleStart:f,handleError:$,handleRemove:l,handleSuccess:e,handleProgress:o}=ot(s,c),p=Q(()=>s.listType==="picture-card"),h=Q(()=>({...s,fileList:v.value,onStart:f,onProgress:o,onSuccess:e,onError:$,onRemove:l}));return he(()=>{v.value.forEach(({url:i})=>{i!=null&&i.startsWith("blob:")&&URL.revokeObjectURL(i)})}),be(ne,{accept:ke(s,"accept")}),r({abort:m,submit:C,clearFiles:u,handleStart:f,handleRemove:l}),(i,q)=>(b(),L("div",null,[t(p)&&i.showFileList?(b(),P(x,{key:0,disabled:t(d),"list-type":i.listType,files:t(v),"handle-preview":i.onPreview,onRemove:t(l)},J({append:w(()=>[S(ee,Y({ref_key:"uploadRef",ref:c},t(h)),{default:w(()=>[t(n).trigger?R(i.$slots,"trigger",{key:0}):k("v-if",!0),!t(n).trigger&&t(n).default?R(i.$slots,"default",{key:1}):k("v-if",!0)]),_:3},16)]),_:2},[i.$slots.file?{name:"default",fn:w(({file:U})=>[R(i.$slots,"file",{file:U})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):k("v-if",!0),!t(p)||t(p)&&!i.showFileList?(b(),P(ee,Y({key:1,ref_key:"uploadRef",ref:c},t(h)),{default:w(()=>[t(n).trigger?R(i.$slots,"trigger",{key:0}):k("v-if",!0),!t(n).trigger&&t(n).default?R(i.$slots,"default",{key:1}):k("v-if",!0)]),_:3},16)):k("v-if",!0),i.$slots.trigger?R(i.$slots,"default",{key:2}):k("v-if",!0),R(i.$slots,"tip"),!t(p)&&i.showFileList?(b(),P(x,{key:3,disabled:t(d),"list-type":i.listType,files:t(v),"handle-preview":i.onPreview,onRemove:t(l)},J({_:2},[i.$slots.file?{name:"default",fn:w(({file:U})=>[R(i.$slots,"file",{file:U})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):k("v-if",!0)]))}}),ft=Oe(lt);export{ft as E};

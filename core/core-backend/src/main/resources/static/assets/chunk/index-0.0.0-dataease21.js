import{o as fe,v as ve,ag as Te,D as be,j as ye,y as we,G as ke,n as Se}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{a as ge,b as Ce,u as xe}from"./index-0.0.0-dataease.js";import{E as Fe}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as Ee,a as Me}from"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Pe}from"./el-row-0.0.0-dataease.js";import{E as Ie}from"./el-divider-0.0.0-dataease.js";import{d as Ae,r as B,G as k,Z as Ve,w as E,o as Ue,n as C,e as Z,aa as Ne,f as i,L as b,T as f,W as v,g as d,i as o,k as l,M as _,a6 as T,a5 as M,j as c,a0 as x,Y as y,a9 as P,U as Oe}from"./vue-0.0.0-dataease.js";import{n as Re,a as Le}from"./templateMarket-0.0.0-dataease.js";import{useAppStoreWithOut as We}from"./app-0.0.0-dataease.js";import{e as ze}from"./antv-0.0.0-dataease.js";import De from"./MarketPreviewV2-0.0.0-dataease.js";import{i as $}from"./imgUtils-0.0.0-dataease.js";import G from"./CategoryTemplateV2-0.0.0-dataease.js";import Be from"./TemplateSkeleton-0.0.0-dataease.js";import{i as Ze}from"./interactive-0.0.0-dataease.js";import{g as J}from"./base64-0.0.0-dataease.js";import{_ as $e}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./index-0.0.0-dataease13.js";import"./index-0.0.0-dataease3.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./row-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import"./el-collapse-item-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./icon_left_outlined-0.0.0-dataease.js";import"./icon-filter-0.0.0-dataease.js";import"./TemplateMarketPreviewItem-0.0.0-dataease.js";import"./index-0.0.0-dataease14.js";import"./dvMain-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./index-0.0.0-dataease19.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./index-0.0.0-dataease20.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./TemplateMarketV2Item-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./datasource-0.0.0-dataease.js";const Ge=["src"],Je={class:"template-left"},je=["title"],qe={id:"template-show-area",class:"template-right"},He={style:{"text-align":"center"}},Xe=Ae({__name:"index",emits:["close"],setup(Ye,{expose:j,emit:q}){const{t:n}=fe(),{wsCache:I}=ge(),S=Ce(),R=We(),H=Ze(),h=B("full"),X=q,L=()=>{X("close")},Y=k(()=>e.curPosition==="branch"?n("work_branch.template_center"):n("work_branch.new_using_template")),K=k(()=>R.getIsDataEaseBi||R.getIsIframe),e=Ve({initReady:!0,curPosition:"branch",pid:null,treeProps:{value:"label",label:"label"},templateType:"all",templateSourceType:"all",templateClassifyType:"all",treeShow:!0,templateClassifyOptions:[{value:"all",label:n("visualization.all_type")},{value:"app",label:n("visualization.apply_template")},{value:"template",label:n("visualization.style_template")}],templateSourceOptions:[{value:"all",label:n("work_branch.all_source")},{value:"market",label:n("visualization.template_market")},{value:"manage",label:n("template_manage.name")}],templateTypeOptions:[{value:"all",label:n("work_branch.all_types")},{value:"PANEL",label:n("work_branch.dashboard")},{value:"SCREEN",label:n("work_branch.big_data_screen")}],loading:!1,hasResult:!0,templateMiniWidth:250,templateCurWidth:310,templateSpan:"25%",previewVisible:!1,templatePreviewId:"",marketTabs:[],marketActiveTab:null,searchText:null,dvCreateForm:{resourceName:null,name:null,pid:null,nodeType:"panel",templateUrl:null,newFrom:"new_market_template",templateId:null,panelType:"self",panelStyle:{},panelData:"[]"},panelGroupList:[],curApplyTemplate:null,folderSelectShow:!1,baseUrl:"https://dataease.io/templates",currentMarketTemplateShowList:[],curTemplateShowFilter:[],curTemplateIndex:0,curTemplate:null,networkStatus:!0,rule:{name:[{required:!0,message:n("visualization.template_name_tips"),trigger:"blur"}],pid:[{required:!0,message:"",trigger:"blur"}]}}),A=k(()=>{var t,s,m,u;const a=H.getData;return{PANEL:((t=a[0])==null?void 0:t.menuAuth)&&((s=a[0])==null?void 0:s.anyManage),SCREEN:((m=a[1])==null?void 0:m.menuAuth)&&((u=a[1])==null?void 0:u.anyManage)}}),W=k(()=>{let a;return e.templateSourceType==="all"?a=e.marketTabs:a=e.marketTabs.filter(t=>t.source==="public"||t.source===e.templateSourceType),a}),Q=k(()=>e.curTemplate.thumbnail.indexOf("http")>-1||e.curTemplate.thumbnail.indexOf("static-resource")>-1?$(e.curTemplate.thumbnail):$(e.baseUrl+e.curTemplate.thumbnail)),ee=k(()=>e.curPosition==="branch"&&h.value!=="marketPreview"),te=a=>{e.initReady=!1,e.curPosition=a.curPosition,e.templateType=a.templateType,h.value="full",e.pid=a.pid,C(()=>{e.initReady=!0})};E(()=>e.searchText,()=>{w()}),E(()=>e.templateType,()=>{w()}),E(()=>e.templateSourceType,()=>{e.treeShow=!1,w(),C(()=>{e.treeShow=!0,V()})}),E(()=>e.templateClassifyType,()=>{e.treeShow=!1,w(),C(()=>{e.treeShow=!0,V()})});const ae=a=>{e.marketActiveTab=a.label,w()},le=()=>{h.value="full"},re=async()=>{await Le().then(a=>{e.baseUrl=a.data.baseUrl,e.currentMarketTemplateShowList=a.data.contents,V(),w();const t=Te(e.currentMarketTemplateShowList);e.marketTabs=a.data.categories.filter(s=>t.has(s.label)),e.marketActiveTab=e.marketTabs[1].label}).catch(()=>{e.networkStatus=!1})},V=()=>{C(()=>{const a=document.querySelector(".custom-market-tree"),t=document.createElement("hr");t.classList.add("custom-line"),a.firstElementChild.appendChild(t)})},oe=()=>{e.curTemplateIndex>0&&(e.curTemplateIndex--,e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex])},ne=()=>{e.curTemplateIndex<e.curTemplateShowFilter.length-1&&(e.curTemplateIndex++,e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex])},F=a=>{e.curApplyTemplate=a,e.dvCreateForm.name=a.title,e.dvCreateForm.nodeType=a.templateType,a.source==="market"?(e.dvCreateForm.newFrom="new_market_template",e.dvCreateForm.templateUrl=a.metas.theme_repo,e.dvCreateForm.resourceName=a.id):(e.dvCreateForm.newFrom="new_inner_template",e.dvCreateForm.templateId=a.id),se()},se=a=>{if(e.dvCreateForm.newFrom==="new_market_template"&&!e.dvCreateForm.templateUrl)return be.warning(n("template_manage.get_download_link_hint")),!1;const t={newFrom:e.dvCreateForm.newFrom,templateUrl:e.dvCreateForm.templateUrl,resourceName:e.dvCreateForm.resourceName,templateId:e.dvCreateForm.templateId};e.curApplyTemplate.recentUseTime=Date.now(),e.curApplyTemplate.categoryNames.push(n("work_branch.recent"));const s=(["dataV","SCREEN"].includes(e.dvCreateForm.nodeType)?"#/dvCanvas?opt=create&createType=template":"#/dashboard?opt=create&createType=template")+"&templateParams="+encodeURIComponent(J.encode(JSON.stringify(t)));let m=null;if(K.value){S.clearState(),S.setCreateType("template"),S.setTemplateParams(encodeURIComponent(J.encode(JSON.stringify(t)))),S.setOpt("create"),e.pid&&S.setPid(e.pid),xe().emitter.emit("changeCurrentComponent",["dataV","SCREEN"].includes(e.dvCreateForm.nodeType)?"VisualizationEditor":"DashboardEditor");return}const u=I.get("open-backend")==="1"?"_self":"_blank";e.pid?m=window.open(s+`&pid=${e.pid}`,u):m=window.open(s,u),ie(m)},g=B(null),ie=a=>{if(g!=null&&g.value){const t={methodName:"initOpenHandler",args:a};g.value.invokeMethod(t)}},w=()=>{let a=!1;e.currentMarketTemplateShowList.forEach(t=>{t.showFlag=pe(t),t.showFlag&&(a=!0)}),e.currentMarketTemplateShowList.length>0&&(e.hasResult=a)},pe=a=>{let t=!1,s=!1,m=!1,u=!1;return(!e.searchText||a.title.indexOf(e.searchText)>-1)&&(t=!0),(e.templateType==="all"||a.templateType===e.templateType)&&(s=!0),(e.templateSourceType==="all"||a.source===e.templateSourceType)&&(m=!0),(e.templateClassifyType==="all"||a.classify===e.templateClassifyType)&&(u=!0),t&&s&&m&&u},U=a=>{e.curPosition==="branch"?(e.templatePreviewId=a,h.value="marketPreview"):(e.curTemplateShowFilter=e.marketActiveTab===n("work_branch.recommend")?e.currentMarketTemplateShowList.filter(t=>t.showFlag):e.currentMarketTemplateShowList.filter(t=>{var s;return t.showFlag&&((s=t.categoryNames)==null?void 0:s.includes(e.marketActiveTab))}),e.curTemplateIndex=e.curTemplateShowFilter.findIndex(t=>t.id===a),e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex],h.value="createPreview")};Ue(()=>{me(),re();const a=ze(),t=document.getElementById("template-show-area");t&&a.listenTo(t,()=>{C(()=>{const s=t.offsetWidth-26,m=Math.trunc(s/e.templateMiniWidth);e.templateSpan=100/Math.trunc(s/e.templateMiniWidth)+"%",e.templateCurWidth=Math.trunc(s/m)-33})})});const me=()=>{const a=I.get("template-preview-id");a&&(U(a),I.delete("template-preview-id"))};return j({optInit:te}),(a,t)=>{const s=Z("ArrowLeft"),m=ye,u=we,z=Ie,D=Z("Close"),p=Pe,ue=ke,N=Ee,O=Me,ce=Fe,de=Se,he=Ne("loading");return i(),b(y,null,[f((i(),d(p,{class:Oe(["template-outer-body",{"template-outer-body-padding":ee.value}])},{default:o(()=>[f(l(De,{"preview-id":e.templatePreviewId,"create-auth":A.value,onClosePreview:le,onTemplateApply:F},null,8,["preview-id","create-auth"]),[[v,h.value==="marketPreview"]]),h.value==="createPreview"?(i(),d(p,{key:0,class:"main-container"},{default:o(()=>[l(p,{class:"market-head"},{default:o(()=>[l(m,{class:"custom-back-icon hover-icon",onClick:t[0]||(t[0]=r=>h.value="full")},{default:o(()=>[l(s)]),_:1}),_("span",null,T(e.curTemplate.title),1),l(p,{class:"head-right"},{default:o(()=>[l(u,{secondary:"",disabled:e.curTemplateIndex===0,style:{float:"right"},onClick:oe},{default:o(()=>[M(T(c(n)("work_branch.last")),1)]),_:1},8,["disabled"]),l(u,{disabled:e.curTemplateIndex===e.curTemplateShowFilter.length-1,style:{float:"right"},secondary:"",onClick:ne},{default:o(()=>[M(T(c(n)("work_branch.next")),1)]),_:1},8,["disabled"]),l(u,{style:{float:"right"},type:"primary",onClick:t[1]||(t[1]=r=>F(e.curTemplate))},{default:o(()=>[M(T(c(n)("visualization.apply_this_template")),1)]),_:1}),l(z,{class:"custom-divider-line",direction:"vertical"}),l(m,{class:"custom-market-icon hover-icon_custom",onClick:L},{default:o(()=>[l(D)]),_:1})]),_:1})]),_:1}),l(p,{class:"template-area"},{default:o(()=>[l(p,{class:"img-main-create"},{default:o(()=>[_("img",{style:{height:"100%"},src:Q.value,alt:""},null,8,Ge)]),_:1})]),_:1})]),_:1})):x("",!0),f(l(p,{class:"main-container"},{default:o(()=>[l(p,{class:"market-head"},{default:o(()=>[_("span",null,T(Y.value),1),l(p,{class:"head-right"},{default:o(()=>[l(ue,{class:"title-search",modelValue:e.searchText,"onUpdate:modelValue":t[2]||(t[2]=r=>e.searchText=r),"prefix-icon":"Search",placeholder:c(n)("visualization.enter_template_name_tips"),clearable:!0},null,8,["modelValue","placeholder"]),l(O,{class:"title-type",modelValue:e.templateSourceType,"onUpdate:modelValue":t[3]||(t[3]=r=>e.templateSourceType=r),placeholder:"Select"},{default:o(()=>[(i(!0),b(y,null,P(e.templateSourceOptions,r=>(i(),d(N,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),["branchCreate","branch"].includes(e.curPosition)?(i(),d(O,{key:0,class:"title-type",modelValue:e.templateType,"onUpdate:modelValue":t[4]||(t[4]=r=>e.templateType=r),placeholder:"Select"},{default:o(()=>[(i(!0),b(y,null,P(e.templateTypeOptions,r=>(i(),d(N,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):x("",!0),l(O,{class:"title-type",modelValue:e.templateClassifyType,"onUpdate:modelValue":t[5]||(t[5]=r=>e.templateClassifyType=r),placeholder:"Select"},{default:o(()=>[(i(!0),b(y,null,P(e.templateClassifyOptions,r=>(i(),d(N,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),["branchCreate","create"].includes(e.curPosition)?(i(),b(y,{key:1},[l(z,{class:"custom-divider-line",direction:"vertical"}),l(m,{class:"custom-market-icon hover-icon_custom",onClick:L},{default:o(()=>[l(D)]),_:1})],64)):x("",!0)]),_:1})]),_:1}),l(p,{class:"template-area"},{default:o(()=>[_("div",Je,[e.treeShow?(i(),d(ce,{key:0,menu:"",class:"custom-market-tree",modelValue:e.marketActiveTab,"onUpdate:modelValue":t[6]||(t[6]=r=>e.marketActiveTab=r),data:W.value,props:e.treeProps,"node-key":"label","default-expand-all":"","highlight-current":"","current-node-key":e.marketActiveTab,onNodeClick:ae},{default:o(({data:r})=>[_("span",{title:r.label,class:"ed-tree-node__label"},T(r.label),9,je)]),_:1},8,["modelValue","data","props","current-node-key"])):x("",!0)]),f(_("div",qe,[e.marketActiveTab===null?(i(),d(p,{key:0},{default:o(()=>[l(Be,{width:e.templateCurWidth},null,8,["width"])]),_:1})):(i(),b(y,{key:1},[f(l(p,null,{default:o(()=>[l(G,{"search-text":e.searchText,label:e.marketActiveTab,"full-template-show-list":e.currentMarketTemplateShowList,"template-span":e.templateSpan,"base-url":e.baseUrl,"template-cur-width":e.templateCurWidth,"cur-position":e.curPosition,"create-auth":A.value,onTemplateApply:F,onTemplatePreview:U},null,8,["search-text","label","full-template-show-list","template-span","base-url","template-cur-width","cur-position","create-auth"])]),_:1},512),[[v,e.marketActiveTab!==c(n)("work_branch.recommend")]]),f(l(p,null,{default:o(()=>[(i(!0),b(y,null,P(W.value,(r,_e)=>(i(),d(p,{style:{display:"inline",width:"100%","margin-bottom":"32px"},key:_e},{default:o(()=>[r.label!==c(n)("work_branch.recent")?(i(),d(G,{key:0,"search-text":e.searchText,label:r.label,"full-template-show-list":e.currentMarketTemplateShowList,"template-span":e.templateSpan,"base-url":e.baseUrl,"template-cur-width":e.templateCurWidth,"cur-position":e.curPosition,"create-auth":A.value,onTemplateApply:F,onTemplatePreview:U},null,8,["search-text","label","full-template-show-list","template-span","base-url","template-cur-width","cur-position","create-auth"])):x("",!0)]),_:2},1024))),128))]),_:1},512),[[v,e.marketActiveTab===c(n)("work_branch.recommend")]])],64))],512),[[v,e.networkStatus&&e.hasResult]]),f(l(p,{class:"template-empty"},{default:o(()=>[_("div",He,[l(de,{name:"no_result"},{default:o(()=>[l(c(Re),{style:{"margin-bottom":"16px","font-size":"75px"},class:"svg-icon"})]),_:1}),t[7]||(t[7]=_("br",null,null,-1)),_("span",null,T(c(n)("work_branch.relevant_templates_found")),1)])]),_:1},512),[[v,e.networkStatus&&!e.hasResult]]),f(l(p,{class:"template-empty"},{default:o(()=>[M(T(c(n)("visualization.market_network_tips")),1)]),_:1},512),[[v,!e.networkStatus]])]),_:1})]),_:1},512),[[v,h.value==="full"]])]),_:1},8,["class"])),[[he,e.loading],[v,e.initReady]]),l(c(ve),{ref_key:"openHandler",ref:g,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)],64)}}});const la=$e(Xe,[["__scopeId","data-v-6e2af3d6"]]);export{la as default};

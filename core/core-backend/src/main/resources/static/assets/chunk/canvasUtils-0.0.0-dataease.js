import{l as Q,j as G,C as $,a as Z,M as R,k as I,A as aa,m as ea}from"./dataVisualization-0.0.0-dataease2.js";import{e as J}from"./eventBus-0.0.0-dataease.js";import{d as ta}from"./dvMain-0.0.0-dataease.js";import{g as W,h as ra,i as ia,j as oa,u as _,k as sa,l as na,m as ua}from"./dataVisualization-0.0.0-dataease.js";import{ah as la}from"./vue-0.0.0-dataease.js";import{x as v,P as D,o as da,F as fa,D as ca,ac as pa}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{y as ha,S as N}from"./chart-0.0.0-dataease.js";import{s as ya}from"./snapshot-0.0.0-dataease.js";import{a as ga}from"./index-0.0.0-dataease.js";import{g as L}from"./util-0.0.0-dataease.js";import{useAppearanceStoreWithOut as va}from"./appearance-0.0.0-dataease.js";import{i as ba}from"./ModelUtil-0.0.0-dataease.js";import{d as C}from"./lodash-0.0.0-dataease.js";const Pa=a=>v.post({url:"/linkage/getViewLinkageGatherArray",data:a}),Ha=a=>v.post({url:"/linkage/saveLinkage",data:a}),P=a=>v.get({url:"/linkage/getVisualizationAllLinkageInfo/"+a}),Fa=a=>v.post({url:"/linkage/updateLinkageActive",data:a}),Ua=a=>v.post({url:"/linkage/removeLinkage",data:a});function Ya(a,e){return v.get({url:"/linkJump/queryWithViewId/"+a+"/"+e})}function qa(a){return v.post({url:"/linkJump/updateJumpSet",data:a,loading:!0})}function Xa(a){return v.post({url:"/linkJump/queryTargetVisualizationJumpInfo",data:a,loading:!0})}function H(a){return v.get({url:"/linkJump/queryVisualizationJumpInfo/"+a,loading:!1})}function ja(a){return v.get({url:"/linkJump/viewTableDetailList/"+a,loading:!1})}function Ka(a){return v.post({url:"/linkJump/updateJumpSetActive",data:a,loading:!0})}function Qa(a){return v.post({url:"/linkJump/removeJumpSet",data:a,loading:!0})}const f=ta(),{inMobile:Da,dvInfo:g,canvasStyleData:F,componentData:c,canvasViewInfo:T,appData:z}=la(f),Ta=ya(),{t:m}=da(),Ea=va(),{wsCache:U}=ga();function $a(a){const e=a.split("&"),t=e[0],r=e[1];return ka(t,r)}function ka(a,e,t){let r;if(Q.forEach(i=>{(i.component===a||i.component===e)&&(r=C(i),r.component==="DeTabs"&&(r.propValue[0].name=L(),r.titleBackground=D(G)),r.innerType=e,r.innerType==="richText"&&(r.propValue={textValue:""}),f.curOriginThemes==="light"?r.commonBackground=C($):r.commonBackground=C(Z))}),a==="UserView"){const i=ha(e);r.name=i==null?void 0:i.title,r.label=i==null?void 0:i.title,r.render=i==null?void 0:i.render,r.isPlugin=!!t,r.isPlugin&&(r.staticMap=t)}return r}function Za(a,e){const t=a.target.dataset.id;e==="dashboard"?J.emit("handleDragStartMoveIn-canvas-main",t):a.dataTransfer.setData("id",t)}function Ra(a,e){e==="dashboard"&&J.emit("handleDragEnd-canvas-main",a)}function w(a){var e,t;a.x=1+(a.x-1)*2,a.y=1+(a.y-1)*2,a.sizeX=a.sizeX*2,a.sizeY=a.sizeY*2,a.mx=1+(a.mx-1)*2,a.my=1+(a.my-1)*2,a.mSizeX=a.mSizeX*2,a.mSizeY=a.mSizeY*2,a.component==="Group"?(e=a.propValue)==null||e.forEach(r=>{w(r)}):a.component==="DeTabs"&&((t=a.propValue)==null||t.forEach(r=>{r.componentData.forEach(i=>{w(i)})}))}function B(a,e,t,r,i){var n,s,u,o;a.canvasActive=!1,a.component==="VQuery"&&(t==null?void 0:t.source)==="report"&&e&&((n=a.propValue)!=null&&n.forEach)&&((s=a.propValue)==null||s.forEach((l,d)=>{e[l.id]&&(a.propValue[d]=JSON.parse(e[l.id].filterInfo))})),a.component==="DeTabs"&&(a.style.showTabTitle=a.style.showTabTitle===void 0?!0:a.style.showTabTitle),a.expand=a.expand||!1,a.resizeInnerKeep=a.resizeInnerKeep||!1,a.component==="Picture"&&(a.style.adaptation=a.style.adaptation||"adaptation"),a.style.adaptation=a.style.adaptation||"adaptation",a.style.borderActive===void 0?(a.style.borderActive=!1,a.style.borderWidth=1,a.style.borderRadius=5,a.style.borderStyle="solid",a.style.borderColor="#cccccc"):(a.style.borderWidth=a.style.borderWidth===void 0?1:a.style.borderWidth,a.style.borderRadius=a.style.borderRadius===void 0?5:a.style.borderRadius,a.style.borderStyle=a.style.borderStyle===void 0?"solid":a.style.borderStyle,a.style.borderColor=a.style.borderColor===void 0?"#cccccc":a.style.borderColor),a.dashboardHidden=a.dashboardHidden||!1,a.maintainRadio=a.maintainRadio||!1,a.multiDimensional=a.multiDimensional||D(R),a.carousel=a.carousel||D(I),a.aspectRatio=a.aspectRatio||1,a.component==="UserView"&&(a.actionSelection=a.actionSelection||D(aa)),(!r||r===2)&&(i==null?void 0:i.type)==="dashboard"&&w(a),a.events=a.events&&a.events.checked!==void 0&&a.events.type!=="displayChange"?a.events:D(ea),a.events.jump.type=a.events.jump.type||"_blank",a.category=a.category||"base",a.component==="DeTabs"?(a.titleBackground=a.titleBackground||D(G),a.style.fontStyle=a.style.fontStyle||"normal",a.style.fontWeight=a.style.fontWeight||"normal",a.style.textDecoration=a.style.textDecoration||"none",(u=a.propValue)==null||u.forEach(l=>{l.componentData.forEach(d=>{B(d,e,t,r,i)})})):a.component==="Group"&&((o=a.propValue)==null||o.forEach(l=>{B(l,e,t,r,i)}))}function Y(a,e,t,r,i){const n=U.get("x-de-execute-version"),s=t==null?void 0:t.reportFilterInfo;(t==null?void 0:t.checkVersion)===n&&!s||(a.component.seniorStyleSetting=a.component.seniorStyleSetting||D(N),a.fontFamily=a.fontFamily||"PingFang",a.dashboard.showGrid=a.dashboard.showGrid||!1,a.dashboard.matrixBase=a.dashboard.matrixBase||4,a.component.seniorStyleSetting=a.component.seniorStyleSetting||D(N),a.suspensionButtonAvailable=a.suspensionButtonAvailable===void 0?!1:a.suspensionButtonAvailable,a.screenAdaptor=a.screenAdaptor||"widthFirst",a.dashboardAdaptor=a.dashboardAdaptor||"keepHeightAndWidth",a.refreshBrowserEnable=a.refreshBrowserEnable===void 0?!1:a.refreshBrowserEnable,a.refreshBrowserUnit=a.refreshBrowserUnit||"minute",a.refreshBrowserTime=a.refreshBrowserTime||5,a.scaleWidth=a.scale,a.scaleHeight=a.scale,a.popupAvailable=a.popupAvailable===void 0?!0:a.popupAvailable,a.popupButtonAvailable=a.popupButtonAvailable===void 0?!0:a.popupButtonAvailable,e.forEach(u=>{B(u,s,r,i,t)}))}function Ia(a,e){const t=c.value.filter(r=>["ScrollText"].includes(r.component)||r.innerType==="rich-text");if(t&&t.length>0){const r=t.map(i=>i.id);W(a,e,{}).then(i=>{const n=i.data,u=JSON.parse(n.componentData).reduce((o,l)=>(o[l.id]=l,o),{});for(let o=0;o<c.value.length;o++){const l=c.value[o];if(r.includes(l.id)&&u[l.id])if(Da.value)c.value[o].propValue=u[l.id].propValue;else{const{top:d,left:p,height:b,width:h,fontSize:E}=c.value[o].style;u[l.id].style.top=d,u[l.id].style.left=p,u[l.id].style.height=b,u[l.id].style.width=h,E&&(u[l.id].style.fontSize=E),c.value[o]=u[l.id]}}})}}function O(a,e,t){const r=e!=null&&e.includes("-copy"),i=r?e.split("-")[0]:e,n=r?ua:W;let s={source:"main"};if(f.canvasAttachInfo&&f.canvasAttachInfo.taskId&&(s={source:"report",taskId:f.canvasAttachInfo.taskId},f.canvasAttachInfo.hasOwnProperty("showWatermark")&&typeof f.canvasAttachInfo.showWatermark<"u"&&f.canvasAttachInfo.showWatermark!==null)){const o=f.canvasAttachInfo.showWatermark==="true";s.showWatermark=o}n(a,i,s).then(u=>{const o=u.data,l={...o.watermarkInfo,settingContent:JSON.parse(o.watermarkInfo.settingContent)},d={id:o.id,name:o.name,pid:o.pid,status:o.status,selfWatermarkStatus:o.selfWatermarkStatus,type:o.type,creatorName:o.creatorName,updateName:o.updateName,createTime:o.createTime,updateTime:o.updateTime,watermarkInfo:l,weight:o.weight,ext:o.ext,contentId:o.contentId,mobileLayout:o.mobileLayout||!1},p=o.version,b=JSON.parse(o.componentData),h=JSON.parse(o.canvasStyleData),E=o.canvasViewInfo;Y(h,b,o,s,p);const k=d.type==="dashboard"&&h.dashboard.gap==="yes"?h.dashboard.gapSize:0;Ea.setCurrentFont(h.fontFamily),document.documentElement.style.setProperty("--de-canvas_custom_font",`${h.fontFamily}`),t({canvasDataResult:b,canvasStyleResult:h,dvInfo:d,canvasViewInfoPreview:E,curPreviewGap:k})})}async function ae(a,e,t){O(a,e,function({canvasDataResult:r,canvasStyleResult:i,dvInfo:n,canvasViewInfoPreview:s}){f.setComponentData(r),f.setCanvasStyle(i),f.updateCurDvInfo(n),f.setCanvasViewInfo(s),P(n.id).then(u=>{f.setNowPanelTrackInfo(u.data)}),H(n.id).then(u=>{f.setNowPanelJumpInfo(u.data)}),t({canvasDataResult:r,canvasStyleResult:i,dvInfo:n,canvasViewInfoPreview:s})})}async function ee(a,e,t,r){O(a,t,function({canvasDataResult:i,canvasStyleResult:n,canvasViewInfoPreview:s}){const u=i.filter(d=>!!d.inMobile),o=u.map(d=>d.id);c.value.forEach(d=>{if(d.inMobile=o.includes(d.id),d.inMobile){const{mx:p,my:b,mSizeX:h,mSizeY:E,mPropValue:k,mEvents:S,mCommonBackground:A}=u.find(V=>V.id===d.id);d.mx=p,d.my=b,d.mSizeX=h,d.mSizeY=E,d.mEvents=S,d.mCommonBackground=A,d.component==="VQuery"&&(d.mPropValue=k)}}),Object.keys(s).forEach(d=>{if(T.value[d]&&s[d]){const{customAttrMobile:p,customStyleMobile:b}=s[d];T.value[d].customStyleMobile=b,T.value[d].customAttrMobile=p}}),f.setComponentData(c.value);const l=C(F.value);l.mobileSetting?l.mobileSetting=n.mobileSetting:l.mobileSetting={backgroundColorSelect:!1,background:"",color:"#ffffff",backgroundImageEnable:!1,customSetting:!1},f.setCanvasStyle(l),r()})}function te(a,e,t){O(a,e,function({canvasDataResult:r,canvasStyleResult:i,dvInfo:n,canvasViewInfoPreview:s}){const u=r.filter(o=>!!o.inMobile);r.forEach(o=>{var x;const{mx:l,my:d,mSizeX:p,mSizeY:b,mStyle:h,mPropValue:E,mEvents:k,mCommonBackground:S,style:A,propValue:V,events:X,commonBackground:j}=o;o.x=l,o.y=d,o.sizeX=p,o.sizeY=b,o.style=h||A,o.propValue=E||V,o.events=k||X,o.commonBackground=S||j,o.component==="DeTabs"&&((x=o.propValue)==null||x.forEach(K=>{K.componentData.forEach(y=>{y.style=y.mStyle||y.style,y.propValue=y.mPropValue||y.propValue,y.events=y.mEvents||y.events,y.commonBackground=y.mCommonBackground||y.commonBackground})}))}),s&&Object.keys(s).forEach(o=>{const l=s[o],{customAttrMobile:d,customStyleMobile:p}=l;l.customAttr=d||l.customAttr,l.customStyle=p||l.customStyle}),f.setComponentData(u),f.setCanvasStyle(i),f.updateCurDvInfo(n),f.setCanvasViewInfo(s),P(n.id).then(o=>{f.setNowPanelTrackInfo(o.data)}),H(n.id).then(o=>{f.setNowPanelJumpInfo(o.data)}),t({canvasDataResult:u,canvasStyleResult:i,dvInfo:n,canvasViewInfoPreview:s})})}function re(a){if(g.value.id&&g.value.optType!=="copy"&&!ba()){const t={...g.value,watermarkInfo:null},r=(g.value.type==="dashboard"?m("work_branch.dashboard"):m("work_branch.big_data_screen"))+m("visualization.save_conflict_tips");ia(t).then(i=>{i&&i.data==="Repeat"?fa.confirm(r,{confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1}).then(()=>{a()}):a()})}else a()}async function ie(a){f.removeGroupArea();const e=C(c.value);e.forEach(s=>{var u,o;s.component==="UserView"?s.linkageFilters=[]:s.component==="Group"?(u=s.propValue)==null||u.forEach(l=>{l.linkageFilters=[]}):s.component==="DeTabs"&&((o=s.propValue)==null||o.forEach(l=>{l.componentData.forEach(d=>{d.linkageFilters=[]})}))});const t=L(),r={canvasStyleData:JSON.stringify(F.value),componentData:JSON.stringify(e),canvasViewInfo:T.value,appData:z.value,...g.value,checkVersion:U.get("x-de-execute-version"),contentId:t,watermarkInfo:null};let i="success";if(z.value&&await oa({datasetFolderPid:r.datasetFolderPid,datasetFolderName:r.datasetFolderName}).then(s=>{i=s.data}),i==="repeat"){ca.error("数据集分组名称已存在");return}pa(g.value,m("components.length_1_64_characters"));const n=g.value.id&&g.value.optType!=="copy"?_:sa;n===_&&await na({opt:"edit",nodeType:"leaf",name:g.value.name,type:g.value.type,id:g.value.id}),n(r).then(s=>{f.updateDvInfoId(s.data,t),Ta.resetStyleChangeTimes(),a(s)})}function oe(a){return a&&(/^(http(s)?:\/\/)/.test(a.toLowerCase())?a:"http://"+a)}function se(a,e,t,r){if(!t)return t;let i=t;const n=r.reduce((u,o)=>(u[o[a]]=o[e],u),{}),s=t==null?void 0:t.match(/\[(.+?)\]/g);return s&&s.forEach(u=>{const o=u.slice(1,-1);i=i.replace(u,n[o])}),i}function q(a){return a==="canvas-main"}function ne(a){var e;if(a.component==="DeTabs"){let t=!0;return(e=a.propValue)==null||e.forEach(r=>{r.componentData.forEach(i=>{i.component==="Group"&&(t=!1)})}),t}else return!0}function ue(a){var e;if(a.component==="Group"){let t=!0;return(e=a.propValue)==null||e.forEach(r=>{r.component==="DeTabs"&&(t=!1)}),t}else return!0}function le(a,e){if(e==="canvas-main")return q(a.canvasId);const t={};return c.value.forEach(r=>{M(r,null,t)}),e==="pTabGroup"?!!(t[a.id]&&t[a.id].component==="DeTabs"&&t[t[a.id].id]&&t[t[a.id].id].component==="Group"):e==="groupInTab"?!!(a.component==="Group"&&t[t[a.id].id]&&t[t[a.id].id].component==="DeTabs"):e==="tabInGroup"?!!(a.component==="DeTabs"&&t[a.id]&&t[a.id].component==="Group"):!1}function M(a,e,t){var r,i;t[a.id]=e,a.component==="DeTabs"?(r=a.propValue)==null||r.forEach(n=>{n.componentData.forEach(s=>{M(s,a,t)})}):a.component==="Group"&&((i=a.propValue)==null||i.forEach(n=>{M(n,a,t)}))}function de(a,e){return a.canvasId===e}function fe(a){return Ca(a)||ma(a)}function Ca(a){return a&&a.includes("Group")}function ma(a){return a&&!a.includes("Group")&&!q(a)}function ce(a,e=c.value){let t=-1;return e.filter(r=>!r.dashboardHidden).forEach((r,i)=>{r.id===a&&(t=i)}),t}function pe(a,e=c.value){let t=-1;return e.forEach((r,i)=>{r.id===a&&(t=i)}),t}function he(a,e,t=!1){const r=document.querySelector(t?"#point-shadow-main":"#shape-id-"+a.id),i=r.offsetWidth,n=r.offsetHeight;if(a.sizeX=Math.round(i/e.baseWidth),a.sizeY=Math.round(n/e.baseHeight),a.style.width=i,a.style.height=n,t){const s=r.offsetLeft,u=r.offsetTop;a.x=Math.round(s/e.baseWidth),a.y=Math.round(u/e.baseHeight),a.style.left=s,a.style.height=u}}function ye(a,e){a.forEach(t=>{var r,i;t.component==="UserView"&&t.innerType!="VQuery"?e.push(t.id):t.component==="Group"?(r=t.propValue)==null||r.forEach(n=>{e.push(n.id)}):t.component==="DeTabs"&&((i=t.propValue)==null||i.forEach(n=>{n.componentData.forEach(s=>{e.push(s.id)})}))})}function wa(a){return a.filter(e=>e.leaf?!0:e.children&&e.children.length>0?(e.children=wa(e.children),!0):!1)}function ge(a,e){function t(r,i){if(r.children)for(const n of r.children){if(n.id===i)return r.id;const s=t(n,i);if(s!==null)return s}return null}for(const r of a){const i=t(r,e);if(i!==null)return i}return null}async function ve(a,e){let t;await ra(a).then(r=>{const i=r.data,n=JSON.parse(i.componentData),s=i.appData,u=JSON.parse(i.canvasStyleData);n.forEach(o=>{(!i.version||i.version===2)&&i.type==="dashboard"&&w(o)}),u.component.seniorStyleSetting=u.component.seniorStyleSetting||D(N),u.scaleWidth=u.scale,u.scaleHeight=u.scaleHeight,t={canvasStyleData:u,componentData:n,canvasViewInfo:i.canvasViewInfo,appData:s,baseInfo:{preName:i.name}}}).catch(r=>{console.error(r)}),Y(t.canvasStyleData,t.componentData,null,null,null),e(t)}function be(){return g.value.type==="dashboard"}function De(a,e,t,r){const{width:i,height:n}=a.style,s=i,u=n;function o(d){return d===2?75:75+Math.floor(d-2)*35}e.left<0?e.left=0:s-e.left<60&&(e.left=e.left-60);const l=o(r);e.top<0?e.top=0:e.top+l+60>u&&(e.top=e.top-l)}function Sa(a){a&&Array.isArray(a)&&(a.sort((e,t)=>e.y-t.y),a.forEach(e=>{var t;e.component==="DeTabs"&&((t=e.propValue)==null||t.forEach(r=>{Sa(r.componentData)}))}))}function Te(){return c.value.length===0?1:c.value.filter(a=>a.y).map(a=>a.y+a.sizeY).reduce((a,e)=>Math.max(a,e),0)}function Ee(a){let e;return c.value.forEach(t=>{var r,i;t.id===a?e=t:t.component==="Group"?(r=t.propValue)==null||r.forEach(n=>{n.id===a&&(e=n)}):t.component==="DeTabs"&&((i=t.propValue)==null||i.forEach(n=>{n.componentData.forEach(s=>{s.id===a&&(e=s)})}))}),e}function ke(a){try{console.info("Canvas initReady");const e={type:"dataease-embedded-interactive",eventName:"canvas_init_ready",args:a};window.parent.postMessage(e,"*")}catch{console.warn("de_inner_params send error")}}function Ce(a){if(a){const e=T.value[a.id];e.customStyle=a.customStyle,e.customAttr=a.customAttr,e.title=a.title,e.name=a.name}}function me(a){a&&T.value[a.id]&&(["UserView"].includes(a.component)?T.value[a.id].title=a.name:["VQuery"].includes(a.component)&&(T.value[a.id].title=a.name,T.value[a.id].customStyle.component.title=a.name))}export{he as A,pe as B,Ia as C,Ka as D,Fa as E,Ua as F,Qa as G,wa as H,Ya as I,qa as J,ja as K,ye as L,Pa as M,se as N,oe as O,O as P,De as Q,ge as R,Ee as S,ee as T,Xa as U,te as V,Ce as W,Ra as a,re as b,Za as c,ie as d,ne as e,ve as f,ka as g,$a as h,ae as i,Ha as j,P as k,ma as l,M as m,Te as n,ke as o,Ca as p,H as q,q as r,me as s,le as t,ue as u,be as v,fe as w,de as x,Sa as y,ce as z};

import{q as $,h as Ce}from"./element-plus-secondary-0.0.0-dataease.js";import{d as _e}from"./dvMain-0.0.0-dataease.js";import{v as ye,f as Me}from"./formatter-0.0.0-dataease.js";import{z as ke,q as v,B as Ie}from"./@antv-0.0.0-dataease.js";import{u as ee}from"./vue-uuid-0.0.0-dataease.js";import{j as Te}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{g as P,h as be,i as b}from"./index-0.0.0-dataease12.js";import{d as Se,e as we,b as Ne,F as De}from"./lodash-es-0.0.0-dataease.js";import{d as Ee,k as te,b as Be,j as ze,o as Ae,c as Le,a as j,a0 as ne,_ as oe,a4 as re,a2 as ie,u as ae,M as He,n as Ke}from"./@vue-0.0.0-dataease.js";import{_ as Oe}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./@turf-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./element-resize-detector-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./uuid-0.0.0-dataease.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./mathjs-0.0.0-dataease.js";import"./decimal.js-0.0.0-dataease.js";import"./typed-function-0.0.0-dataease.js";import"./complex.js-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./exceljs-0.0.0-dataease.js";import"./file-saver-0.0.0-dataease.js";const Ve=["id"],Ge={class:"button-group"},Re=["id"],ce=1,qe=Ee({__name:"TableHeaderGroupConfig",props:{chart:{type:Object,required:!0},themes:{type:String,default:"dark"},propertyInner:{type:Array}},emits:["onConfigChange","onCancelConfig"],setup(F,{emit:se}){const{t:g}=Te(),le=_e(),H=F,U=se,pe=()=>{U("onCancelConfig")},me=()=>{var M;const c=(M=H.chart.xAxis)==null?void 0:M.map(d=>d.hide!==!0&&d.dataeaseName).filter(d=>d),{fields:o,meta:m}=e.dataCfg,s=m.filter(d=>!c.includes(d.field));U("onConfigChange",{columns:o.columns,meta:s})},de=()=>{var M;const c=we(H.chart),o=c.xAxis,{headerGroupConfig:m}=c.customAttr.tableHeader,s=[];if(o==null||o.forEach(d=>{d.hide!==!0&&s.push({key:d.dataeaseName})}),!!s.length){if((M=m==null?void 0:m.columns)!=null&&M.length){const d=s.map(w=>w.key),q=P(m.columns).map(w=>w.key);if(!Ne(d,q)){const{columns:w,meta:K}=m;w.splice(0,w.length,...s),K.splice(0,K.length)}}else c.customAttr.tableHeader.headerGroupConfig={columns:[...s],meta:[]};Ke(()=>{fe(c)})}},W=te(()=>"menu-group-"+H.chart.id),R=te(()=>"table-container-"+H.chart.id);let e;const fe=c=>{var Q,Y,Z;const o=le.getViewDataDetails(c.id),m=document.getElementById(R.value);let s=[];(Q=o==null?void 0:o.tableRow)!=null&&Q.length&&(s=o.tableRow.slice(0,10));const{headerGroupConfig:M}=c.customAttr.tableHeader,d=[...M.meta],J=M.columns,q=c.xAxis.reduce((a,t)=>(a[t.dataeaseName]=t,a),{});(Y=o==null?void 0:o.fields)!=null&&Y.length?o.fields.forEach(a=>{const t=q[a.dataeaseName];(t==null?void 0:t.hide)!==!0&&d.push({field:a.dataeaseName,name:a.chartShowName??a.name,formatter:function(n){if(!t||n==null||![2,3].includes(t.deType)||!De(n))return n;let k=t.formatterCfg;return k||(k=Me),ye(n,k)}})}):(Z=c.xAxis)==null||Z.forEach(a=>{a.hide!==!0&&d.push({field:a.dataeaseName,name:a.chartShowName??a.name})});const w={fields:{columns:J},meta:d,data:s},K={width:m.getBoundingClientRect().width,height:m.offsetHeight,tooltip:{getContainer:()=>m,renderTooltip:a=>new ge(a),style:{position:"absolute",borderRadius:"4px"}},interaction:{rangeSelection:!1}};e=new ke(m,w,K);const xe=be(c);e.setTheme(xe);const D=document.getElementById(W.value);e.on(v.COL_CELL_CONTEXT_MENU,a=>{var A,L,O,V,G;a.preventDefault();const t=e.dataCfg.fields.columns,n=e.dataCfg.meta,k=e.interaction.getActiveCells(),E=k==null?void 0:k.map(_=>_.getMeta().field),x=b(E,t),p=e.getCell(a.target);if(D.innerText="",x!=null&&x.length&&x.findIndex(N=>N.key===p.getMeta().field)===-1){e.interaction.clearState(),e.hideTooltip();return}if((x==null?void 0:x.length)===1&&p.getMeta().colIndex===-1){e.interaction.clearState(),e.interaction.selectHeaderCell({cell:p});const _=document.createElement("span");D.appendChild(_),_.innerText=g("chart.cancel_group"),_.onclick=()=>{var r,C;e.hideTooltip();const l=p.getMeta().parent;if((l==null?void 0:l.id)==="root"){const u=t.findIndex(i=>i.key===p.getMeta().field),[T]=b([p.getMeta().field],t);t.splice(u,1,...T.children);const I=n.findIndex(i=>i.field===p.getMeta().field);n.splice(I,1),e.setDataCfg({fields:{columns:t},meta:n}),e.render(!0)}else{const[u]=b([l.field],t);if(u){const T=(r=u.children)==null?void 0:r.findIndex(h=>h.key===p.getMeta().field),[I]=b([p.getMeta().field],u.children);(C=u.children)==null||C.splice(T,1,...I.children);const i=n.findIndex(h=>h.field===p.getMeta().field);n.splice(i,1),e.setDataCfg({fields:{columns:t},meta:n}),e.render(!0)}}e.interaction.clearState()};const N=document.createElement("span");D.appendChild(N),N.innerText=g("chart.cancel_all_group"),N.onclick=()=>{var r,C;e.hideTooltip();const l=p.getMeta().parent;if((l==null?void 0:l.id)==="root"){const[u]=b([p.getMeta().field],t),T=P(u.children),I=t.findIndex(y=>y.key===p.getMeta().field);t.splice(I,1,...T);const i=X([u]),h=n.filter(y=>!i.includes(y.field));e.setDataCfg({fields:{columns:t},meta:h}),e.render(!0)}else{const[u]=b([l.field],t);if(u){const[T]=b([p.getMeta().field],u.children),I=P(T.children),i=(r=u.children)==null?void 0:r.findIndex(B=>B.key===p.getMeta().field);(C=u.children)==null||C.splice(i,1,...I);const h=X([T]),y=n.filter(B=>!h.includes(B.field));e.setDataCfg({fields:{columns:t},meta:y}),e.render(!0)}}e.interaction.clearState()};const f=document.createElement("span");D.appendChild(f),f.innerText=g("chart.rename"),f.onclick=()=>{e.hideTooltip();const l=n.find(r=>r.field===p.getMeta().field);$.prompt("",g("chart.group_name"),{confirmButtonText:g("chart.confirm"),cancelButtonText:g("chart.cancel"),showClose:!1,showInput:!0,inputPlaceholder:g("chart.group_name_edit_tip"),inputValue:l.name,inputErrorMessage:g("chart.group_name_error_tip"),inputValidator:r=>(r==null?void 0:r.length)<1||(r==null?void 0:r.length)>20?g("chart.group_name_error_tip"):!0}).then(r=>{l.name=r.value,e.setDataCfg({meta:n}),e.render(!0)}).catch(()=>{})},e.showTooltip({position:{x:a.x,y:a.y},content:D});return}if((x==null?void 0:x.length)>1){if(!k.every(i=>i.getMeta().parent===p.getMeta().parent))return;let N=-1,f=p;for(;(L=(A=f==null?void 0:f.getMeta)==null?void 0:A.call(f))!=null&&L.parent||f!=null&&f.parent;)N++,f=((V=(O=f==null?void 0:f.getMeta)==null?void 0:O.call(f))==null?void 0:V.parent)||(f==null?void 0:f.parent);let l=-1,r=-1;const C=p.getMeta().parent;C.colIndex!==-1?x.forEach(i=>{const h=C.children.findIndex(y=>y.getMeta().field===i.key);(h<l||l===-1)&&(l=h),(h>r||r===-1)&&(r=h)}):x.forEach(i=>{const h=C.children.findIndex(y=>y.key===i.key);(h<l||l===-1)&&(l=h),(h>r||r===-1)&&(r=h)});const u=[];if((C==null?void 0:C.id)==="root")u.push(...t.slice(l,r+1));else{const[i]=b([C.field],t);u.push(...(G=i.children)==null?void 0:G.slice(l,r+1))}if(ue(u)+N>1)return;const I=document.createElement("span");D.appendChild(I),I.innerText=g("chart.merge_group"),I.onclick=()=>{e.hideTooltip(),$.prompt("",g("chart.group_name"),{confirmButtonText:g("chart.confirm"),cancelButtonText:g("chart.cancel"),showClose:!1,showInput:!0,inputPlaceholder:g("chart.group_name_edit_tip"),inputErrorMessage:g("chart.group_name_error_tip"),inputValue:g("chart.group"),inputValidator:i=>(i==null?void 0:i.length)<1||(i==null?void 0:i.length)>20?g("chart.group_name_error_tip"):!0}).then(i=>{var h;if((C==null?void 0:C.id)==="root"){const y=ee.v4();t==null||t.splice(l,r-l+1,{key:y,children:u}),n.push({field:y,name:i.value}),e.setDataCfg({fields:{columns:t},meta:n}),e.render(!0)}else{const[y]=b([C.field],t),B=ee.v4();(h=y.children)==null||h.splice(l,r-l+1,{key:B,children:u}),n.push({field:B,name:i.value}),e.setDataCfg({fields:{columns:t},meta:n}),e.render(!0)}e.interaction.clearState()}).catch(()=>{})},e.showTooltip({position:{x:a.x,y:a.y},content:D});return}}),e.on(v.COL_CELL_CLICK,a=>{const t=e.store.get("lastClickedCell"),n=a.originalEvent;if(!t||!(n!=null&&n.ctrlKey||n!=null&&n.metaKey||n!=null&&n.shiftKey)){const k=e.getCell(a.target);e.store.set("lastClickedCell",k);return}if(n!=null&&n.shiftKey){if(!t){const _=e.getCell(a.target);e.store.set("lastClickedCell",_);return}const k=e.getCell(a.target),E=t.getMeta(),x=k.getMeta();if(E.key===x.key||E.level!==x.level||E.parent!==x.parent)return;const p=x.parent,A=p.children.findIndex(_=>_.key===E.key),L=p.children.findIndex(_=>_.key===x.key),O=Math.min(A,L),V=Math.max(A,L),G=p.children.slice(O,V+1);e.interaction.clearState(),G.forEach(_=>{e.interaction.selectHeaderCell({cell:_.belongsCell,isMultiSelection:!0})})}}),e.render()},X=c=>{const o=[],m=s=>{var M;if(((M=s.children)==null?void 0:M.length)>0){o.push(s.key);for(let d=0;d<s.children.length;d++)m(s.children[d])}};return c.forEach(s=>m(s)),o},ue=c=>{if(!(c!=null&&c.length))return 0;const o=s=>{if(!s.children||s.children.length===0)return 0;const M=s.children.map(d=>o(d));return Math.max(...M)+1},m=c.map(s=>o(s));return Math.max(...m)},he=Se((c,o)=>{e&&(e.changeSheetSize(c,o),e.render(!1))},500),S=[0,0];let z;Be(()=>{de(),z=new ResizeObserver(([c]=[])=>{const[o]=c.borderBoxSize||[];S[0]||S[1]||(S[0]=o.inlineSize,S[1]=o.blockSize);const m=Math.abs(o.inlineSize-S[0]),s=Math.abs(o.blockSize-S[1]);m<ce&&s<ce||(S[0]=o.inlineSize,S[1]=o.blockSize,he(o.inlineSize,Math.round(o.blockSize)))}),z.observe(document.getElementById(R.value))}),ze(()=>{z==null||z.disconnect()});class ge extends Ie{show(o){super.show(o),this.container.style.display="flex"}hide(){this.container&&(this.container.style.display="none")}}return(c,o)=>{const m=Ce;return Ae(),Le(He,null,[j("div",{id:R.value,class:"table-container"},null,8,Ve),j("div",Ge,[ne(m,{effect:F.themes,onClick:pe},{default:oe(()=>[re(ie(ae(g)("chart.cancel")),1)]),_:1},8,["effect"]),ne(m,{type:"primary",onClick:me},{default:oe(()=>[re(ie(ae(g)("chart.confirm")),1)]),_:1})]),j("div",{id:W.value,class:"group-menu"},null,8,Re)],64)}}});const to=Oe(qe,[["__scopeId","data-v-0810f045"]]);export{to as default};

import{_ as x}from"./InfoTemplate.vue_vue_type_style_index_0_scope_true_lang-0.0.0-dataease.js";import H from"./BasicEdit-0.0.0-dataease.js";import{o as J,x as O}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{i as K}from"./ModelUtil-0.0.0-dataease.js";import{d as g}from"./lodash-0.0.0-dataease.js";import{d as Q,r as c,Z as X,G as B,f as C,L as ee,k as P,j as d,g as T,a0 as j,Y as te,n as ae}from"./vue-0.0.0-dataease.js";import{_ as se}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./dv-info-0.0.0-dataease.js";import"./de-copy-0.0.0-dataease.js";import"./index-0.0.0-dataease18.js";import"./index-0.0.0-dataease3.js";import"./el-drawer-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import"./el-form-item-0.0.0-dataease.js";import"./el-radio-group-0.0.0-dataease.js";import"./el-radio-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./el-tree-0.0.0-dataease.js";import"./index-0.0.0-dataease13.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tree-select-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import"./index-0.0.0-dataease17.js";import"./el-switch-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";const le=Q({__name:"BasicInfo",setup(ie){const{t:a}=J(),v=c(),f=c(),b=c(),_=c(),y=c(!1),U=K(),V=[{value:"0",label:a("commons.date.permanent")},{value:"1",label:a("commons.date.one_year")},{value:"2",label:a("commons.date.six_months")},{value:"3",label:a("commons.date.three_months")},{value:"4",label:a("commons.date.one_month")}],k=[{key:"setting_basic.defaultOpen",val:a("setting_basic.default_open_tips")},{key:"setting_basic.frontTimeOut",val:a("system.to_take_effect")},{key:"setting_basic.platformOid",val:a("system.and_platform_docking")},{key:"setting_basic.platformRid",val:a("system.and_platform_docking")},{key:"setting_basic.shareDisable",val:a("setting_basic.share_disable_tips")}],R=["setting_basic.dip","setting_basic.pvp","setting_basic.defaultLogin","setting_basic.loginLimit","setting_basic.loginLimitRate","setting_basic.loginLimitTime"],E=["setting_basic.autoCreateUser","setting_basic.platformOid","setting_basic.platformRid"],s=X({templateList:[],orgOptions:[],roleOptions:[{value:"admin",label:a("role.org_admin"),children:null,disabled:!1},{value:"readonly",label:a("role.average_role"),children:null,disabled:!1}],loginOptions:[{value:"0",label:a("system.normal_login")},{value:"1",label:"LDAP"},{value:"2",label:"OIDC"},{value:"3",label:"CAS"},{value:"9",label:"OAuth2"}],sortOptions:[{value:"0",label:a("resource_sort.time_asc")},{value:"1",label:a("resource_sort.time_desc")},{value:"2",label:a("resource_sort.name_asc")},{value:"3",label:a("resource_sort.name_desc")}],openOptions:[{value:"0",label:a("open_opt.new_page")},{value:"1",label:a("open_opt.local_page")}]});let m=[];const L=c(""),q=c(""),w=c([]),h=c([]),$=c("0"),A=B(()=>s.templateList.filter(l=>!R.concat(E).includes(l.pkey)&&(!U||l.pkey!=="setting_basic.defaultOpen"))),S=B(()=>s.templateList.filter(l=>E.includes(l.pkey))),D=B(()=>s.templateList.filter(t=>R.includes(t.pkey))),z=l=>{const t="/sysParameter/basic/query";m=[],s.templateList=[];const n=[];O.get({url:t}).then(async o=>{m=g(o.data);const r=o.data;for(let p=0;p<r.length;p++){const e=r[p];if(e.pkey==="basic.autoCreateUser"||e.pkey==="basic.dip"||e.pkey==="basic.pwdStrategy"||e.pkey==="basic.shareDisable"||e.pkey==="basic.sharePeRequire"||e.pkey==="basic.loginLimit")e.pval=e.pval==="true"?a("chart.open"):a("system.not_enabled");else if(e.pkey==="basic.platformOid")L.value=e.pval,await F(),e.pval=q.value||a("system.default_organization");else if(e.pkey==="basic.platformRid"){const i=e.pval;if(i!=null&&i.length){const u=i.split(",");w.value=u,await G(),h.value.length?e.pval=h.value.join(","):e.pval=a("system.normal_role")}else w.value=[],e.pval=a("system.normal_role")}else if(e.pkey==="basic.pvp")$.value=e.pval||"0",e.pval=V.filter(i=>i.value===$.value)[0].label;else if(e.pkey==="basic.defaultLogin"){if(await Y(),y.value)if(e.pval){const i=s.loginOptions.filter(u=>u.value===e.pval);i!=null&&i.length?e.pval=i[0].label:(e.pval=s.loginOptions[0].label,Z())}else e.pval=s.loginOptions[0].label}else if(e.pkey==="basic.defaultSort")if(e.pval){const i=s.sortOptions.filter(u=>u.value===e.pval);i!=null&&i.length?e.pval=i[0].label:e.pval=s.sortOptions[1].label}else e.pval=s.sortOptions[1].label;else if(e.pkey==="basic.defaultOpen")if(e.pval){const i=s.openOptions.filter(u=>u.value===e.pval);i!=null&&i.length?e.pval=i[0].label:e.pval=s.openOptions[0].label}else e.pval=s.openOptions[0].label;else e.pval=e.pval;e.pkey="setting_"+e.pkey,(!e.pkey.includes("defaultLogin")||y.value)&&n.push(e)}s.templateList.splice(0,n.length,...n),l&&l()})},N=()=>{z(()=>{ae(()=>{var l,t,n;(l=f==null?void 0:f.value)==null||l.init(),(t=b==null?void 0:b.value)==null||t.init(),(n=_==null?void 0:_.value)==null||n.init()})})};N();const I=(l,t)=>{v==null||v.value.edit(g(m),g(s.orgOptions),g(s.roleOptions),g(s.loginOptions),g(s.sortOptions),g(s.openOptions),l,t)},F=async()=>{const t=(await O.post({url:"/org/mounted",data:{}})).data;M(t),s.orgOptions=t},G=async()=>{const t=(await O.get({url:`/role/queryWithOid/${L.value}`})).data,n=W(t);s.roleOptions[0].children=n.get(!1),s.roleOptions[1].children=n.get(!0)},M=l=>{var n;const t=[...l];for(;t.length;){const o=t.pop();o.id===L.value&&(q.value=o.name),o.value=o.id,o.label=o.name,o.disabled=o.readOnly,(n=o.children)!=null&&n.length&&o.children.forEach(r=>t.push(r))}},W=l=>{const t=new Map;return h.value=[],l.forEach(n=>{w.value.includes(n.id)&&h.value.push(n.name);const o=n.readonly;let r=t.get(o);r||(r=[]),r.push({value:n.id,label:n.name,disabled:!1}),t.set(o,r)}),t},Y=async()=>{const l="/setting/authentication/status",o=(await O.get({url:l})).data.reduce((p,{name:e,enable:i})=>(p[e]=i,p),{});let r=s.loginOptions.length;for(;r--;){const p=s.loginOptions[r];p.value!=="0"&&!o[p.label.toLocaleLowerCase()]&&s.loginOptions.splice(r,1)}if(y.value=s.loginOptions.length>1,!y.value){let p=m.length;for(;p--;)m[p].pkey==="basic.defaultLogin"&&m.splice(p,1)}},Z=()=>{let l=m.length;for(;l--;){const t=m[l];t.pkey==="basic.defaultLogin"&&(t.pval="0")}};return(l,t)=>{var n,o;return C(),ee(te,null,[P(x,{ref_key:"infoTemplate",ref:f,"label-tooltips":k,"setting-key":"basic","setting-title":d(a)("system.basic_settings"),"setting-data":A.value,onEdit:t[0]||(t[0]=r=>I(d(a)("system.basic_settings"),A.value.map(p=>p.pkey.split(".")[1])))},null,8,["setting-title","setting-data"]),(n=D.value)!=null&&n.length?(C(),T(x,{key:0,ref_key:"loginTemplate",ref:b,class:"login-setting-template","label-tooltips":k,"setting-key":"basic","setting-title":d(a)("system.login_settings"),"setting-data":D.value,onEdit:t[1]||(t[1]=r=>I(d(a)("system.login_settings"),D.value.map(p=>p.pkey.split(".")[1])))},null,8,["setting-title","setting-data"])):j("",!0),(o=S.value)!=null&&o.length?(C(),T(x,{key:1,ref_key:"thirdTemplate",ref:_,class:"login-setting-template","label-tooltips":k,"setting-key":"basic","setting-title":d(a)("setting_basic.third_platform_settings"),"setting-data":S.value,onEdit:t[2]||(t[2]=r=>I(d(a)("setting_basic.third_platform_settings"),S.value.map(p=>p.pkey.split(".")[1])))},null,8,["setting-title","setting-data"])):j("",!0),P(H,{ref_key:"editor",ref:v,"label-tooltips":k,onSaved:N},null,512)],64)}}});const ze=se(le,[["__scopeId","data-v-6e6bbcb9"]]);export{ze as default};

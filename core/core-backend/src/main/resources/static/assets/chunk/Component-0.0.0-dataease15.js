import{d as ul,h as wa,L as rl,p as De,x as Ma,y as $e,Z as qa,O as $a,P as Aa,A as ja,z as sl,a7 as qt,s as Rl,r as ol,f as Ll,e as dl,a8 as $t,q as At,Q as Nt,R as Ot,a9 as It,a as Et,w as Dt,v as Rt}from"./element-plus-secondary-0.0.0-dataease.js";import{h as Ta,j as ia,i as nl,O as Lt}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{o as s,c as b,a as v,d as xe,r as ue,Z as I,_ as r,a0 as i,a4 as Z,a2 as g,u as a,x as Na,k as U,ab as ce,M as ae,W as Ca,a1 as Ie,X as cl,t as Qe,w as he,R as fa,Y as j,z as be,$ as Le,i as Ee,a3 as Ae,aa as xl,n as Se,j as xt,b as vl,ak as Ul,l as Gl,q as oa,ad as Va,aX as Ut,ac as Nl,a7 as Yl,e as Gt}from"./@vue-0.0.0-dataease.js";import{i as ka}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as ml}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{e as Yt}from"./eventBus-0.0.0-dataease.js";import{s as Bl}from"./snapshot-0.0.0-dataease.js";import{_ as Bt}from"./jspdf-0.0.0-dataease.js";import{_ as jt}from"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{m as Wt}from"./more_v-0.0.0-dataease.js";import{i as Ba}from"./icon_add_outlined-0.0.0-dataease.js";import{i as Pt}from"./icon_drag_outlined-0.0.0-dataease.js";import{i as zt}from"./icon_visible_outlined-0.0.0-dataease.js";import{d as Qt}from"./dv-folder-0.0.0-dataease.js";import{i as Ht}from"./icon_dataset-0.0.0-dataease.js";import{i as Zt}from"./icon_warning_filled-0.0.0-dataease.js";import{i as Kt}from"./icon_info_outlined-0.0.0-dataease.js";import{s as Wa}from"./pinia-0.0.0-dataease.js";import{B as Jt,y as jl,C as Xt,D as en,E as an,F as Ol,g as ln}from"./dataset-0.0.0-dataease.js";import{d as Wl}from"./vuedraggable-0.0.0-dataease.js";import{e as Re,d as Pl}from"./lodash-es-0.0.0-dataease.js";import{g as zl}from"./util-0.0.0-dataease.js";import{g as Fa,a as tn,b as nn,c as un,d as rn,e as sn,f as on,h as dn,i as cn,j as vn}from"./time-format-0.0.0-dataease.js";import{d as Oa}from"./dvMain-0.0.0-dataease.js";import{g as na,a as je,b as ya,c as pl}from"./time-format-dayjs-0.0.0-dataease.js";import{f as ge}from"./attr-0.0.0-dataease20.js";import{E as il}from"./EmptyBackground-0.0.0-dataease.js";import{d as ke,q as mn}from"./dayjs-0.0.0-dataease.js";import{i as pn}from"./icon_admin_outlined-0.0.0-dataease.js";import{J as Pa}from"./@element-plus-0.0.0-dataease.js";import{s as yn,a as Il,b as fn,c as _n}from"./vant-0.0.0-dataease.js";import{u as ga,a as hn}from"./index-0.0.0-dataease.js";import{_ as Ia}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import{a as gn}from"./chart-list-0.0.0-dataease.js";import{i as Je}from"./field-list-0.0.0-dataease.js";import{t as bn}from"./treeSortUtils-0.0.0-dataease.js";const Vn={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function kn(L,C){return s(),b("svg",Vn,C[0]||(C[0]=[v("path",{d:"M8.00022 9.99975C7.56203 9.99975 7.13323 9.96523 6.71734 9.89921L6.38535 11.1382C6.33771 11.316 6.15493 11.4216 5.9771 11.3739L5.33315 11.2014C5.15533 11.1537 5.0498 10.9709 5.09745 10.7931L5.42255 9.57985C4.88013 9.39561 4.37096 9.15494 3.90491 8.86629L2.8454 9.9258C2.71522 10.056 2.50417 10.056 2.37399 9.9258L1.90259 9.4544C1.77242 9.32422 1.77242 9.11317 1.90259 8.98299L2.83565 8.04994C2.35424 7.59918 1.95209 7.0852 1.64812 6.52421C1.64492 6.51832 1.64162 6.51215 1.63823 6.50575C1.5136 6.27038 1.56023 5.97574 1.75709 5.79635C1.92051 5.64743 2.03596 5.5461 2.13639 5.44567C2.14538 5.43669 2.15521 5.42666 2.16569 5.41583C2.31108 5.2656 2.55902 5.32152 2.64417 5.51246C3.47427 7.37398 5.46211 8.66641 8.00022 8.66641C10.4321 8.66641 12.4664 7.40872 13.2829 5.68239C13.3042 5.63747 13.328 5.5809 13.3519 5.52084C13.4276 5.33064 13.6741 5.27325 13.8188 5.41801C13.9259 5.52508 14.0687 5.66784 14.2471 5.8463C14.4235 6.0227 14.4713 6.29211 14.356 6.51334C14.3279 6.56715 14.3006 6.61785 14.2774 6.65816C13.9638 7.20109 13.5572 7.69751 13.0754 8.1321L13.9263 8.98299C14.0565 9.11317 14.0565 9.32422 13.9263 9.4544L13.4549 9.9258C13.3247 10.056 13.1136 10.056 12.9835 9.9258L11.9888 8.93112C11.5521 9.19111 11.0792 9.40958 10.5779 9.57985L10.903 10.7931C10.9506 10.9709 10.8451 11.1537 10.6673 11.2014L10.0233 11.3739C9.84552 11.4216 9.66274 11.316 9.61509 11.1382L9.2831 9.89921C8.86721 9.96523 8.43842 9.99975 8.00022 9.99975Z"},null,-1)]))}const Tn={render:kn},Cn={t:"1652583161182",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2172",width:"200",height:"200"};function Mn(L,C){return s(),b("svg",Cn,C[0]||(C[0]=[v("path",{d:"M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2173"},null,-1),v("path",{d:"M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2174"},null,-1),v("path",{d:"M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2175"},null,-1),v("path",{d:"M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2176"},null,-1),v("path",{d:"M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2177"},null,-1),v("path",{d:"M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2178"},null,-1)]))}const Sn={render:Mn},Fn=["title"],wn={class:"item-span"},qn={class:"dialog-footer"},$n=xe({__name:"CustomSortFilter",emits:["save"],setup(L,{expose:C,emit:u}){const l=ue([]),d=ue(!1),p=J=>{f(J),d.value=!0},f=J=>{l.value=Re(J)},S=u,E=()=>{d.value=!1},M=()=>{S("save",a(l)),E()};return C({sortInit:p}),(J,re)=>{const m=Ta,F=ul,$=wa,h=rl;return s(),I(h,{"destroy-on-close":"","append-to-body":"",title:J.$t("v_query.custom_sort"),modelValue:d.value,"onUpdate:modelValue":re[0]||(re[0]=ne=>d.value=ne),class:"custom-sort_filter",width:"300px"},{footer:r(()=>[v("div",qn,[i($,{onClick:E},{default:r(()=>[Z(g(J.$t("common.cancel")),1)]),_:1}),i($,{type:"primary",onClick:M},{default:r(()=>[Z(g(J.$t("chart.confirm")),1)]),_:1})])]),default:r(()=>[v("div",null,[i(a(Wl),{list:l.value,animation:"300",class:"drag-list"},{item:r(({element:ne})=>[(s(),b("span",{key:ne.name,class:"item-dimension",title:ne},[i(F,{size:"20px"},{default:r(()=>[i(m,{name:"drag"},{default:r(()=>[i(a(Sn),{class:"svg-icon"})]),_:1})]),_:1}),v("span",wn,g(ne),1)],8,Fn))]),_:1},8,["list"])])]),_:1},8,["title","modelValue"])}}});const{t:An}=ia(),Ql=L=>{const{id:C,name:u,deType:l,type:d,datasetId:p}=L;return{id:zl(),name:u,showError:!0,timeGranularity:"date",timeGranularityMultiple:"datetimerange",field:{id:C,type:d,name:u,deType:l},displayId:C,sortId:"",sort:"asc",defaultMapValue:[],mapValue:[],conditionType:0,conditionValueOperatorF:"eq",conditionValueF:"",conditionValueOperatorS:"like",conditionValueS:"",defaultConditionValueOperatorF:"eq",defaultConditionValueF:"",defaultConditionValueOperatorS:"like",defaultConditionValueS:"",timeType:"fixed",relativeToCurrent:"custom",required:!1,timeNum:0,relativeToCurrentType:"date",around:"f",parametersStart:null,parametersEnd:null,arbitraryTime:new Date,timeNumRange:0,relativeToCurrentTypeRange:"date",aroundRange:"f",arbitraryTimeRange:new Date,auto:!1,defaultValue:void 0,selectValue:void 0,optionValueSource:0,valueSource:[],dataset:{id:p,name:"",fields:[]},visible:!0,defaultValueCheck:!1,multiple:!1,displayType:"0",checkedFields:[],parameters:[],parametersCheck:!1,parametersList:[],checkedFieldsMap:{}}},Nn=()=>{const L={id:"",name:An("v_query.unnamed"),deType:0,type:"VARCHAR",datasetId:""};return Ql(L)},On={class:"cascade-content"},In={style:{display:"flex","align-items":"center","justify-content":"space-between"}},En={class:"cascade-item"},Dn={class:"label"},Rn={class:"item-name"},Ln={class:"label"},xn={class:"item-name"},Un={class:"dialog-footer"},Gn=xe({__name:"TreeFieldDialog",emits:["saveTree"],setup(L,{expose:C,emit:u}){const l=ue(!1),d=ue([]),p=Na([]),f=u,{t:S}=ia(),E=()=>{d.value.push({field:{id:""},id:zl()})},M=()=>{l.value=!1},J=(X,ie)=>{p.value=Re(X),d.value=Re(ie).map(W=>({field:W,id:W.id})),l.value=!0},re=U(()=>d.value.map(X=>X.field).map(X=>X.id)),m=()=>{M()},F=()=>{let X=!1;return{arr:Re(d.value).map(W=>(W.field||(X=!0),W.field)),isError:X}},$=()=>{const{isError:X,arr:ie}=F();if(X){De.error(S("v_query.select_a_field"));return}f("saveTree",ie),M()},h=[S("visualization.number1"),S("visualization.number2"),S("visualization.number3"),S("visualization.number4"),S("visualization.number5")],ne=X=>{d.value.splice(X,1)};return C({init:J}),(X,ie)=>{const W=Ta,w=wa,q=Ma,z=$e,ve=rl;return s(),I(ve,{modelValue:l.value,"onUpdate:modelValue":ie[0]||(ie[0]=e=>l.value=e),width:"600","custom-class":"tree-field_dialog","before-close":M,onMousedown:ie[1]||(ie[1]=Ie(()=>{},["stop"])),onMousedup:ie[2]||(ie[2]=Ie(()=>{},["stop"])),title:a(S)("v_query.tree_structure_design")},{footer:r(()=>[v("div",Un,[i(w,{secondary:"",onClick:m},{default:r(()=>[Z(g(a(S)("common.cancel")),1)]),_:1}),i(w,{type:"primary",onClick:$},{default:r(()=>[Z(g(a(S)("pblink.sure_bt")),1)]),_:1})])]),default:r(()=>[v("div",On,[v("div",In,[i(w,{disabled:d.value.length===5,text:"",onClick:E},{icon:r(()=>[i(W,{name:"icon_add_outlined"},{default:r(()=>[i(a(Ba),{class:"svg-icon"})]),_:1})]),default:r(()=>[Z(" "+g(a(S)("v_query.add_level")),1)]),_:1},8,["disabled"])]),v("div",En,[v("div",Dn,g(a(S)("visualization.level")),1),v("div",Rn,g(a(S)("v_query.tree_query_field")),1)]),(s(!0),b(ae,null,ce(d.value,(e,Ve)=>(s(),b("div",{class:"cascade-item",key:e.id},[v("div",Ln,g(a(S)("visualization.level"))+g(h[Ve]),1),v("div",xn,[i(z,{disabled:Ve===0&&e.field,"value-key":"id",modelValue:e.field,"onUpdate:modelValue":P=>e.field=P,style:{width:"300px"}},{default:r(()=>[(s(!0),b(ae,null,ce(p.value,P=>(s(),I(q,{disabled:re.value.includes(P.id),key:P.id,label:P.name,value:P},null,8,["disabled","label","value"]))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])]),Ca(i(w,{onClick:P=>ne(Ve),class:"cascade-delete",text:""},{icon:r(()=>[i(W,{name:"icon_delete-trash_outlined"},{default:r(()=>[i(a(ml),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"]),[[cl,Ve!==0]])]))),128))])]),_:1},8,["modelValue","title"])}}});const Hl=xe({__name:"DynamicTimeFiltering",props:{config:{type:Object,default:()=>({regularOrTrendsValue:"",intervalType:"none",regularOrTrends:"fixed",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f"})},timeGranularityMultiple:{type:String,default:()=>"yearrange"}},setup(L){const C=L,{config:u}=Qe(C),l=U(()=>{const{relativeToCurrent:f,regularOrTrends:S,intervalType:E,timeNum:M,relativeToCurrentType:J,around:re}=u.value;return{relativeToCurrent:f,timeNum:M,regularOrTrends:S,intervalType:E,relativeToCurrentType:J,around:re,timeGranularityMultiple:C.timeGranularityMultiple}});he(()=>l.value,()=>{p()},{deep:!0});const d=U(()=>{const f=C.timeGranularityMultiple.split("time").join("");return u.value.intervalType==="timeInterval"?f:f.split("range")[0]}),p=()=>{const{relativeToCurrent:f,regularOrTrends:S,timeNum:E,relativeToCurrentType:M,around:J}=l.value;if(S==="fixed"){if(u.value.regularOrTrendsValue&&!Array.isArray(u.value.regularOrTrendsValue))return;u.value.regularOrTrendsValue=new Date;return}if(f==="custom")u.value.regularOrTrendsValue=na(M,J==="f"?"subtract":"add",E);else switch(f){case"thisYear":u.value.regularOrTrendsValue=je("year");break;case"lastYear":u.value.regularOrTrendsValue=ya("year");break;case"thisMonth":u.value.regularOrTrendsValue=je("month");break;case"lastMonth":u.value.regularOrTrendsValue=ya("month");break;case"today":u.value.regularOrTrendsValue=je("day");break;case"yesterday":u.value.regularOrTrendsValue=ya("day");break;case"monthBeginning":u.value.regularOrTrendsValue=je("month");break;case"yearBeginning":u.value.regularOrTrendsValue=je("year");break}};return fa(()=>{p()}),(f,S)=>{const E=qa;return s(),I(E,{disabled:a(u).regularOrTrends!=="fixed",key:d.value,modelValue:a(u).regularOrTrendsValue,"onUpdate:modelValue":S[0]||(S[0]=M=>a(u).regularOrTrendsValue=M),type:d.value,"prefix-icon":a(Pa),placeholder:f.$t("commons.date.select_date_time")},null,8,["disabled","modelValue","type","prefix-icon","placeholder"])}}}),Zl=xe({__name:"DynamicTimeRangeFiltering",props:{config:{type:Object,default:()=>({timeGranularityMultiple:"daterange",regularOrTrendsValue:[],regularOrTrends:"fixed",timeNum:0,intervalType:"none",relativeToCurrentRange:"custom",relativeToCurrentType:"year",around:"f",timeGranularity:"date",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"})},timeGranularityMultiple:{type:String,default:()=>"yearrange"}},setup(L){const C=L,{config:u}=Qe(C),l=U(()=>{const{timeNum:S,relativeToCurrentType:E,around:M,relativeToCurrentRange:J,intervalType:re,regularOrTrends:m,timeGranularity:F,timeNumRange:$,relativeToCurrentTypeRange:h,aroundRange:ne}=u.value;return{timeNum:S,relativeToCurrentType:E,around:M,intervalType:re,relativeToCurrentRange:J,regularOrTrends:m,timeGranularity:F,timeNumRange:$,relativeToCurrentTypeRange:h,aroundRange:ne,timeGranularityMultiple:C.timeGranularityMultiple}}),d=U(()=>{const S=C.timeGranularityMultiple.split("time").join("");return u.value.intervalType==="timeInterval"?S:S.split("range")[0]});he(()=>l.value,()=>{p()},{deep:!0});const p=()=>{const{timeNum:S,relativeToCurrentType:E,around:M,relativeToCurrentRange:J,regularOrTrends:re,timeNumRange:m,relativeToCurrentTypeRange:F,aroundRange:$}=l.value;if(re==="fixed"){if(Array.isArray(u.value.regularOrTrendsValue)&&u.value.regularOrTrendsValue.length)return;u.value.regularOrTrendsValue=[na(F,"add",0),na(F,"add",1)];return}const h=na(E,M==="f"?"subtract":"add",S),ne=na(F,$==="f"?"subtract":"add",m);if(J&&J!=="custom"){u.value.regularOrTrendsValue=pl(J);return}u.value.regularOrTrendsValue=[h,ne]};fa(()=>{p()});const f=U(()=>C.timeGranularityMultiple==="yearrange"?"YYYY":void 0);return(S,E)=>{const M=qa;return s(),I(M,{disabled:a(u).regularOrTrends!=="fixed",modelValue:a(u).regularOrTrendsValue,"onUpdate:modelValue":E[0]||(E[0]=J=>a(u).regularOrTrendsValue=J),key:d.value,type:d.value,"prefix-icon":a(Pa),format:f.value,"popper-class":"custom-dynamic-time-range-filter-popper_class","range-separator":S.$t("cron.to"),"start-placeholder":S.$t("datasource.start_time"),"end-placeholder":S.$t("datasource.end_time")},null,8,["disabled","modelValue","type","prefix-icon","format","range-separator","start-placeholder","end-placeholder"])}}});const Yn={class:"set-time-filtering-range"},Bn={class:"title"},jn={class:"list-item"},Wn={class:"label"},Pn={class:"setting-content"},zn={class:"setting"},Qn={key:0,class:"list-item"},Hn={class:"label"},Zn={class:"setting-content"},Kn={class:"setting"},Jn={key:0,class:"setting"},Xn={class:"setting-label"},ei={class:"setting-value select"},ai={key:1,class:"setting"},li={class:"setting-input"},ti={class:"setting"},ni={class:"setting-label"},ii={class:"setting-value select"},ui={class:"setting-label"},ri={class:"setting-input range"},si={class:"setting-label"},oi={class:"setting-input range"},di={key:0,class:"setting-label"},ci={class:"list-item"},vi={class:"label"},mi={key:0,class:"setting-content maximum-single-query"},pi=xe({__name:"RangeFilterTime",props:{timeRange:{type:Object,default:()=>({intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",relativeToCurrentRange:"custom",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"})},timeGranularityMultiple:{type:String,default:"yearrange"}},setup(L){const C=L,{t:u}=ia(),l=[{label:u("chart.line_symbol_none"),value:"none"},{label:u("v_query.start_at"),value:"start"},{label:u("v_query.end_at"),value:"end"},{label:u("v_query.time_interval"),value:"timeInterval"}],d=U(()=>l.find(F=>F.value===p.value.intervalType).label),{timeRange:p}=Qe(C),f=U(()=>p.value.regularOrTrends!=="fixed"),S=U(()=>{const{intervalType:F}=p.value;return F==="timeInterval"?Zl:Hl}),E=[{label:u("dynamic_time.before"),value:"f"},{label:u("dynamic_time.after"),value:"b"}],M=U(()=>{if(!p.value)return[];let F=["yearrange","monthrange","daterange","datetimerange"].indexOf(C.timeGranularityMultiple)+1;return[{label:u("dynamic_time.year"),value:"year"},{label:u("dynamic_time.month"),value:"month"},{label:u("dynamic_time.date"),value:"day"}].slice(0,F)}),J=U(()=>(M.value[M.value.length-1]||{}).label),re=U(()=>{let F=[];if(!p.value)return F;switch(C.timeGranularityMultiple){case"yearrange":F=[{label:u("dynamic_year.current"),value:"thisYear"},{label:u("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":F=[{label:u("cron.this_month"),value:"thisMonth"},{label:u("dynamic_month.last"),value:"lastMonth"}];break;case"daterange":F=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:u("dynamic_time.endOfMonth"),value:"monthEnd"},{label:u("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetimerange":F=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:u("dynamic_time.endOfMonth"),value:"monthEnd"},{label:u("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...F,{label:u("dynamic_time.custom"),value:"custom"}]}),m=U(()=>{let F=[];if(!p.value)return F;switch(C.timeGranularityMultiple){case"yearrange":F=[{label:u("dynamic_year.current"),value:"thisYear"},{label:u("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":F=[{label:u("cron.this_month"),value:"thisMonth"},{label:u("dynamic_month.last"),value:"lastMonth"},{label:u("v_query.last_3_months"),value:"LastThreeMonths"},{label:u("v_query.last_6_months"),value:"LastSixMonths"},{label:u("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"daterange":case"datetimerange":F=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("v_query.last_3_days"),value:"LastThreeDays"},{label:u("v_query.month_to_date"),value:"monthBeginning"},{label:u("v_query.year_to_date"),value:"yearBeginning"}];break}return[...F,{label:u("dynamic_time.custom"),value:"custom"}]});return(F,$)=>{const h=$a,ne=Aa,X=Ma,ie=$e,W=ja,w=sl;return s(),b("div",Yn,[v("div",Bn,g(a(u)("v_query.time_filter_range")),1),v("div",jn,[v("div",Wn,g(a(u)("v_query.interval_type")),1),v("div",Pn,[v("div",zn,[i(ne,{modelValue:a(p).intervalType,"onUpdate:modelValue":$[0]||($[0]=q=>a(p).intervalType=q)},{default:r(()=>[(s(),b(ae,null,ce(l,q=>i(h,{key:q.value,label:q.value},{default:r(()=>[Z(g(q.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])])])]),a(p).intervalType!=="none"?(s(),b("div",Qn,[v("div",Hn,g(d.value),1),v("div",Zn,[v("div",Kn,[i(ne,{modelValue:a(p).regularOrTrends,"onUpdate:modelValue":$[1]||($[1]=q=>a(p).regularOrTrends=q)},{default:r(()=>[i(h,{label:"fixed"},{default:r(()=>[Z(g(a(u)("dynamic_time.fix")),1)]),_:1}),i(h,{label:"dynamic"},{default:r(()=>[Z(g(a(u)("dynamic_time.dynamic")),1)]),_:1})]),_:1},8,["modelValue"])]),f.value&&a(p).intervalType!=="timeInterval"?(s(),b(ae,{key:0},[a(p).intervalType!=="timeInterval"?(s(),b("div",Jn,[v("div",Xn,g(a(u)("dynamic_time.relative")),1),v("div",ei,[i(ie,{teleported:!1,modelValue:a(p).relativeToCurrent,"onUpdate:modelValue":$[2]||($[2]=q=>a(p).relativeToCurrent=q)},{default:r(()=>[(s(!0),b(ae,null,ce(re.value,q=>(s(),I(X,{key:q.value,label:q.label,value:q.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):j("",!0),a(p).relativeToCurrent==="custom"?(s(),b("div",ai,[v("div",li,[i(W,{modelValue:a(p).timeNum,"onUpdate:modelValue":$[3]||($[3]=q=>a(p).timeNum=q),min:0,"controls-position":"right"},null,8,["modelValue"]),i(ie,{teleported:!1,modelValue:a(p).relativeToCurrentType,"onUpdate:modelValue":$[4]||($[4]=q=>a(p).relativeToCurrentType=q)},{default:r(()=>[(s(!0),b(ae,null,ce(M.value,q=>(s(),I(X,{key:q.value,label:q.label,value:q.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(ie,{teleported:!1,modelValue:a(p).around,"onUpdate:modelValue":$[5]||($[5]=q=>a(p).around=q)},{default:r(()=>[(s(),b(ae,null,ce(E,q=>i(X,{key:q.value,label:q.label,value:q.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):j("",!0)],64)):f.value&&a(p).intervalType==="timeInterval"?(s(),b(ae,{key:1},[v("div",ti,[v("div",ni,g(a(u)("dynamic_time.relative")),1),v("div",ii,[i(ie,{teleported:!1,modelValue:a(p).relativeToCurrentRange,"onUpdate:modelValue":$[6]||($[6]=q=>a(p).relativeToCurrentRange=q)},{default:r(()=>[(s(!0),b(ae,null,ce(m.value,q=>(s(),I(X,{key:q.value,label:q.label,value:q.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(p).relativeToCurrentRange==="custom"?(s(),b(ae,{key:0},[v("div",{class:be(["setting",["yearrange","monthrange"].includes(L.timeGranularityMultiple)&&"is-year-month-range"])},[v("div",ui,g(a(u)("datasource.start_time")),1),v("div",ri,[i(W,{"step-strictly":"",modelValue:a(p).timeNum,"onUpdate:modelValue":$[7]||($[7]=q=>a(p).timeNum=q),min:0,"controls-position":"right"},null,8,["modelValue"]),i(ie,{teleported:!1,modelValue:a(p).relativeToCurrentType,"onUpdate:modelValue":$[8]||($[8]=q=>a(p).relativeToCurrentType=q)},{default:r(()=>[(s(!0),b(ae,null,ce(M.value,q=>(s(),I(X,{key:q.value,label:q.label,value:q.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(ie,{teleported:!1,modelValue:a(p).around,"onUpdate:modelValue":$[9]||($[9]=q=>a(p).around=q)},{default:r(()=>[(s(),b(ae,null,ce(E,q=>i(X,{key:q.value,label:q.label,value:q.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2),v("div",{class:be(["setting",["yearrange","monthrange"].includes(L.timeGranularityMultiple)&&"is-year-month-range"])},[v("div",si,g(a(u)("datasource.end_time")),1),v("div",oi,[i(W,{modelValue:a(p).timeNumRange,"onUpdate:modelValue":$[10]||($[10]=q=>a(p).timeNumRange=q),min:0,"step-strictly":"","controls-position":"right"},null,8,["modelValue"]),i(ie,{teleported:!1,modelValue:a(p).relativeToCurrentTypeRange,"onUpdate:modelValue":$[11]||($[11]=q=>a(p).relativeToCurrentTypeRange=q)},{default:r(()=>[(s(!0),b(ae,null,ce(M.value,q=>(s(),I(X,{key:q.value,label:q.label,value:q.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(ie,{teleported:!1,modelValue:a(p).aroundRange,"onUpdate:modelValue":$[12]||($[12]=q=>a(p).aroundRange=q)},{default:r(()=>[(s(),b(ae,null,ce(E,q=>i(X,{key:q.value,label:q.label,value:q.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2)],64)):j("",!0)],64)):j("",!0)]),v("div",{class:be(["parameters",f.value&&"setting"])},[f.value?(s(),b("div",di,g(a(u)("template_manage.preview")),1)):j("",!0),v("div",{class:be(f.value?"setting-value":"w100")},[(s(),I(Le(S.value),{config:a(p),timeGranularityMultiple:L.timeGranularityMultiple,ref:"inputCom"},null,8,["config","timeGranularityMultiple"]))],2)],2)])):j("",!0),v("div",ci,[v("div",vi,[i(w,{modelValue:a(p).dynamicWindow,"onUpdate:modelValue":$[13]||($[13]=q=>a(p).dynamicWindow=q),label:a(u)("v_query.query_time_window")},null,8,["modelValue","label"])]),a(p).dynamicWindow?(s(),b("div",mi,[Z(g(a(u)("v_query.maximum_single_query"))+" ",1),i(W,{modelValue:a(p).maximumSingleQuery,"onUpdate:modelValue":$[14]||($[14]=q=>a(p).maximumSingleQuery=q),min:1,"controls-position":"right"},null,8,["modelValue"]),Z(" "+g(J.value),1)])):j("",!0)])])}}});const yi={class:"set-time-filtering-range"},fi={class:"title"},_i={class:"list-item"},hi={class:"label"},gi={class:"setting-content"},bi={class:"setting"},Vi={key:0,class:"list-item"},ki={class:"label"},Ti={class:"setting-content"},Ci={class:"setting"},Mi={key:0,class:"setting"},Si={class:"setting-label"},Fi={class:"setting-value select"},wi={key:1,class:"setting"},qi={class:"setting-input"},$i={class:"setting"},Ai={class:"setting-label"},Ni={class:"setting-value select"},Oi={class:"setting-label"},Ii={class:"setting-input range"},Ei={class:"setting-label"},Di={class:"setting-input range"},Ri={key:0,class:"setting-label"},Li=xe({__name:"FilterTime",props:{timeRange:{default:()=>({intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",relativeToCurrentRange:"custom",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"})},timeGranularity:{default:"year"}},setup(L){const C=L,{t:u}=ia(),l=[{label:u("chart.line_symbol_none"),value:"none"},{label:u("v_query.start_at"),value:"start"},{label:u("v_query.end_at"),value:"end"},{label:u("v_query.time_interval"),value:"timeInterval"}],d=U(()=>l.find(F=>F.value===p.value.intervalType).label),{timeRange:p}=Qe(C),f=U(()=>p.value.regularOrTrends!=="fixed"),S=U(()=>{const{intervalType:F}=p.value;return F==="timeInterval"?Zl:Hl}),E=U(()=>C.timeGranularity+"range"),M=[{label:u("dynamic_time.before"),value:"f"},{label:u("dynamic_time.after"),value:"b"}],J=U(()=>{if(!p.value)return[];let F=["year","month","date","datetime"].indexOf(C.timeGranularity)+1;return[{label:u("dynamic_time.year"),value:"year"},{label:u("dynamic_time.month"),value:"month"},{label:u("dynamic_time.date"),value:"day"}].slice(0,F)}),re=U(()=>{let F=[];if(!p.value)return F;switch(C.timeGranularity){case"year":F=[{label:u("dynamic_year.current"),value:"thisYear"},{label:u("dynamic_year.last"),value:"lastYear"}];break;case"month":F=[{label:u("cron.this_month"),value:"thisMonth"},{label:u("dynamic_month.last"),value:"lastMonth"}];break;case"date":F=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:u("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetime":F=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:u("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...F,{label:u("dynamic_time.custom"),value:"custom"}]}),m=U(()=>{let F=[];if(!p.value)return F;switch(C.timeGranularity){case"year":F=[{label:u("dynamic_year.current"),value:"thisYear"},{label:u("dynamic_year.last"),value:"lastYear"}];break;case"month":F=[{label:u("cron.this_month"),value:"thisMonth"},{label:u("dynamic_month.last"),value:"lastMonth"},{label:u("v_query.last_3_months"),value:"LastThreeMonths"},{label:u("v_query.last_6_months"),value:"LastSixMonths"},{label:u("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"date":case"datetime":F=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("v_query.last_3_days"),value:"LastThreeDays"},{label:u("v_query.month_to_date"),value:"monthBeginning"},{label:u("v_query.year_to_date"),value:"yearBeginning"}];break}return[...F,{label:u("dynamic_time.custom"),value:"custom"}]});return(F,$)=>{const h=$a,ne=Aa,X=Ma,ie=$e,W=ja;return s(),b("div",yi,[v("div",fi,g(a(u)("v_query.time_filter_range")),1),v("div",_i,[v("div",hi,g(a(u)("v_query.interval_type")),1),v("div",gi,[v("div",bi,[i(ne,{modelValue:a(p).intervalType,"onUpdate:modelValue":$[0]||($[0]=w=>a(p).intervalType=w)},{default:r(()=>[(s(),b(ae,null,ce(l,w=>i(h,{key:w.value,label:w.value},{default:r(()=>[Z(g(w.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])])])]),a(p).intervalType!=="none"?(s(),b("div",Vi,[v("div",ki,g(d.value),1),v("div",Ti,[v("div",Ci,[i(ne,{modelValue:a(p).regularOrTrends,"onUpdate:modelValue":$[1]||($[1]=w=>a(p).regularOrTrends=w)},{default:r(()=>[i(h,{label:"fixed"},{default:r(()=>[Z(g(a(u)("dynamic_time.fix")),1)]),_:1}),i(h,{label:"dynamic"},{default:r(()=>[Z(g(a(u)("dynamic_time.dynamic")),1)]),_:1})]),_:1},8,["modelValue"])]),f.value&&a(p).intervalType!=="timeInterval"?(s(),b(ae,{key:0},[a(p).intervalType!=="timeInterval"?(s(),b("div",Mi,[v("div",Si,g(a(u)("dynamic_time.relative")),1),v("div",Fi,[i(ie,{teleported:!1,modelValue:a(p).relativeToCurrent,"onUpdate:modelValue":$[2]||($[2]=w=>a(p).relativeToCurrent=w)},{default:r(()=>[(s(!0),b(ae,null,ce(re.value,w=>(s(),I(X,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):j("",!0),a(p).relativeToCurrent==="custom"?(s(),b("div",wi,[v("div",qi,[i(W,{modelValue:a(p).timeNum,"onUpdate:modelValue":$[3]||($[3]=w=>a(p).timeNum=w),min:0,"controls-position":"right"},null,8,["modelValue"]),i(ie,{teleported:!1,modelValue:a(p).relativeToCurrentType,"onUpdate:modelValue":$[4]||($[4]=w=>a(p).relativeToCurrentType=w)},{default:r(()=>[(s(!0),b(ae,null,ce(J.value,w=>(s(),I(X,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(ie,{teleported:!1,modelValue:a(p).around,"onUpdate:modelValue":$[5]||($[5]=w=>a(p).around=w)},{default:r(()=>[(s(),b(ae,null,ce(M,w=>i(X,{key:w.value,label:w.label,value:w.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):j("",!0)],64)):f.value&&a(p).intervalType==="timeInterval"?(s(),b(ae,{key:1},[v("div",$i,[v("div",Ai,g(a(u)("dynamic_time.relative")),1),v("div",Ni,[i(ie,{teleported:!1,modelValue:a(p).relativeToCurrentRange,"onUpdate:modelValue":$[6]||($[6]=w=>a(p).relativeToCurrentRange=w)},{default:r(()=>[(s(!0),b(ae,null,ce(m.value,w=>(s(),I(X,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(p).relativeToCurrentRange==="custom"?(s(),b(ae,{key:0},[v("div",{class:be(["setting",["year","month"].includes(F.timeGranularity)&&"is-year-month-range"])},[v("div",Oi,g(a(u)("datasource.start_time")),1),v("div",Ii,[i(W,{"step-strictly":"",modelValue:a(p).timeNum,"onUpdate:modelValue":$[7]||($[7]=w=>a(p).timeNum=w),min:0,"controls-position":"right"},null,8,["modelValue"]),i(ie,{teleported:!1,modelValue:a(p).relativeToCurrentType,"onUpdate:modelValue":$[8]||($[8]=w=>a(p).relativeToCurrentType=w)},{default:r(()=>[(s(!0),b(ae,null,ce(J.value,w=>(s(),I(X,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(ie,{teleported:!1,modelValue:a(p).around,"onUpdate:modelValue":$[9]||($[9]=w=>a(p).around=w)},{default:r(()=>[(s(),b(ae,null,ce(M,w=>i(X,{key:w.value,label:w.label,value:w.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2),v("div",{class:be(["setting",["year","month"].includes(F.timeGranularity)&&"is-year-month-range"])},[v("div",Ei,g(a(u)("datasource.end_time")),1),v("div",Di,[i(W,{modelValue:a(p).timeNumRange,"onUpdate:modelValue":$[10]||($[10]=w=>a(p).timeNumRange=w),min:0,"step-strictly":"","controls-position":"right"},null,8,["modelValue"]),i(ie,{teleported:!1,modelValue:a(p).relativeToCurrentTypeRange,"onUpdate:modelValue":$[11]||($[11]=w=>a(p).relativeToCurrentTypeRange=w)},{default:r(()=>[(s(!0),b(ae,null,ce(J.value,w=>(s(),I(X,{key:w.value,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(ie,{teleported:!1,modelValue:a(p).aroundRange,"onUpdate:modelValue":$[12]||($[12]=w=>a(p).aroundRange=w)},{default:r(()=>[(s(),b(ae,null,ce(M,w=>i(X,{key:w.value,label:w.label,value:w.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2)],64)):j("",!0)],64)):j("",!0)]),v("div",{class:be(["parameters",f.value&&"setting"])},[f.value?(s(),b("div",Ri,g(a(u)("template_manage.preview")),1)):j("",!0),v("div",{class:be(f.value?"setting-value":"w100")},[(s(),I(Le(S.value),{config:a(p),timeGranularityMultiple:E.value,ref:"inputCom"},null,8,["config","timeGranularityMultiple"]))],2)],2)])):j("",!0)])}}});const xi=xe({__name:"DynamicTime",props:{config:{type:Object,default:()=>({defaultValue:"",selectValue:"",timeType:"fixed",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",arbitraryTime:new Date,defaultValueCheck:!1,timeGranularity:"date"})}},setup(L){const C=L,u=ue(),{config:l}=Qe(C),d=U(()=>{const{relativeToCurrent:f,timeNum:S,relativeToCurrentType:E,around:M,defaultValueCheck:J,arbitraryTime:re,timeGranularity:m}=l.value;return{relativeToCurrent:f,timeNum:S,relativeToCurrentType:E,around:M,defaultValueCheck:J,arbitraryTime:re,timeGranularity:m}});he(()=>d.value,()=>{p()},{deep:!0}),he(()=>u.value,f=>{l.value.defaultValue=f,l.value.selectValue=f}),he(()=>l.value.id,()=>{p()});const p=()=>{const{relativeToCurrent:f,timeNum:S,relativeToCurrentType:E,around:M,defaultValueCheck:J,arbitraryTime:re,timeGranularity:m}=d.value;if(!J){u.value=null;return}if(f==="custom")u.value=Fa(S,E,m,M,m==="datetime"?re:null);else switch(f){case"thisYear":u.value=vn();break;case"lastYear":u.value=cn();break;case"thisMonth":u.value=dn();break;case"lastMonth":u.value=on();break;case"today":u.value=sn();break;case"yesterday":u.value=rn();break;case"monthBeginning":u.value=un();break;case"monthEnd":u.value=nn();break;case"yearBeginning":u.value=tn();break}};return fa(()=>{p()}),(f,S)=>{const E=qa;return s(),I(E,{disabled:"",key:a(l).timeGranularity,modelValue:u.value,"onUpdate:modelValue":S[0]||(S[0]=M=>u.value=M),type:a(l).timeGranularity,"prefix-icon":a(Pa),"popper-class":"custom-dynamic-time-popper_class",placeholder:f.$t("commons.date.select_date_time")},null,8,["modelValue","type","prefix-icon","placeholder"])}}});const Ui=xe({__name:"DynamicTimeRange",props:{config:{type:Object,default:()=>({timeGranularityMultiple:"datetimerange",defaultValue:[],selectValue:[],timeType:"fixed",timeNum:0,relativeToCurrentType:"year",around:"f",arbitraryTime:new Date,defaultValueCheck:!1,timeGranularity:"date",timeNumRange:0,relativeToCurrentRange:"custom",relativeToCurrentTypeRange:"year",aroundRange:"f",arbitraryTimeRange:new Date})}},setup(L){const C=L,u=ue([new Date,new Date]),{config:l}=Qe(C),d=U(()=>{const{timeNum:S,relativeToCurrentType:E,timeGranularityMultiple:M,around:J,relativeToCurrentRange:re,defaultValueCheck:m,arbitraryTime:F,timeGranularity:$,timeNumRange:h,relativeToCurrentTypeRange:ne,aroundRange:X,arbitraryTimeRange:ie}=l.value;return{timeNum:S,relativeToCurrentType:E,around:J,relativeToCurrentRange:re,timeGranularityMultiple:M,defaultValueCheck:m,arbitraryTime:F,timeGranularity:$,timeNumRange:h,relativeToCurrentTypeRange:ne,aroundRange:X,arbitraryTimeRange:ie}});he(()=>d.value,()=>{p()},{deep:!0}),he(()=>u.value,S=>{l.value.defaultValue=S,l.value.selectValue=S}),he(()=>l.value.id,()=>{p()});const p=()=>{const{timeNum:S,relativeToCurrentType:E,around:M,defaultValueCheck:J,arbitraryTime:re,timeGranularity:m,timeGranularityMultiple:F,timeNumRange:$,relativeToCurrentTypeRange:h,aroundRange:ne,relativeToCurrentRange:X,arbitraryTimeRange:ie}=d.value;if(!J){u.value=[new Date,new Date];return}if(X!=="custom"){u.value=pl(X);return}const W=Fa(S,E,m,M,re,F,"start-config"),w=Fa($,h,m,ne,ie,F,"end-config");u.value=[W,w]};fa(()=>{p()});const f=U(()=>l.value.timeGranularityMultiple==="yearrange"?"YYYY":void 0);return(S,E)=>{const M=qa;return s(),I(M,{disabled:"",modelValue:u.value,"onUpdate:modelValue":E[0]||(E[0]=J=>u.value=J),key:a(l).timeGranularityMultiple,type:a(l).timeGranularityMultiple,"prefix-icon":a(Pa),format:f.value,"popper-class":"custom-dynamic-time-range-popper_class","range-separator":S.$t("cron.to"),"start-placeholder":S.$t("datasource.start_time"),"end-placeholder":S.$t("datasource.end_time")},null,8,["modelValue","type","prefix-icon","format","range-separator","start-placeholder","end-placeholder"])}}});const{t:Gi}=ia();ke.extend(mn);function xa(L="month"){return new Date(ke().startOf(L).format("YYYY/MM/DD HH:mm:ss"))}function Ua(L="month"){return new Date(ke().endOf(L).format("YYYY/MM/DD HH:mm:ss"))}function Ga(L="month"){return new Date(ke().subtract(1,L).startOf(L).format("YYYY/MM/DD HH:mm:ss"))}function Ya(L="month"){return new Date(ke().subtract(1,L).endOf(L).format("YYYY/MM/DD HH:mm:ss"))}let pa=()=>{};const Kl=[{text:"dynamic_time.cweek",onClick:({emit:L})=>{const C=new Date(+new Date(xa("week"))+864e5),u=new Date(+new Date(Ua("week"))+24*1e3*3600);pa([C,u])||L("pick",[ke(C),ke(u)])}},{text:"dynamic_month.current",onClick:({emit:L})=>{const C=xa("month"),u=Ua("month");pa([C,u])||L("pick",[ke(C),ke(u)])}},{text:"dynamic_time.cquarter",onClick:({emit:L})=>{const C=xa("quarter"),u=Ua("quarter");pa([C,u])||L("pick",[ke(C),ke(u)])}},{text:"dynamic_year.current",onClick:({emit:L})=>{const C=xa("year"),u=Ua("year");pa([C,u])||L("pick",[ke(C),ke(u)])}},{text:"dynamic_time.lweek",onClick:({emit:L})=>{const C=new Date(+new Date(Ga("week"))+864e5),u=new Date(+new Date(Ya("week"))+24*1e3*3600);pa([C,u])||L("pick",[ke(C),ke(u)])}},{text:"dynamic_month.last",onClick:({emit:L})=>{const C=Ga("month"),u=Ya("month");pa([C,u])||L("pick",[ke(C),ke(u)])}},{text:"dynamic_time.lquarter",onClick:({emit:L})=>{const C=Ga("quarter"),u=Ya("quarter");pa([C,u])||L("pick",[ke(C),ke(u)])}},{text:"dynamic_year.last",onClick:({emit:L})=>{const C=Ga("year"),u=Ya("year");pa([C,u])||L("pick",[ke(C),ke(u)])}}];Kl.forEach(L=>{L.text=Gi(L.text)});const Yi=L=>(pa=L,{shortcuts:Kl}),Jl=xe({__name:"Time",props:{config:{type:Object,default:()=>({selectValue:"",defaultValue:"",queryConditionWidth:0,defaultValueCheck:!1,displayType:"1",timeGranularity:"date",setTimeRange:!1,timeGranularityMultiple:"daterange",timeRange:{intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"}})},isConfig:{type:Boolean,default:!1}},setup(L,{expose:C}){const{t:u}=ia(),l=L,d=Ee("placeholder"),p=U(()=>{var H;return(H=d==null?void 0:d.value)!=null&&H.placeholderShow?l.config.placeholder:" "}),f=ue(),S=ue(!1),E=Oa(),{config:M}=Qe(l),J=new Date("1970/1/1"),re=new Date("2100/1/1");he(()=>M.value.defaultValue,H=>{if(l.isConfig)return;const le=M.value.displayType==="7";le&&(S.value=le),f.value=Array.isArray(H)?[...H]:H,Se(()=>{S.value=le})});const m=H=>{se.value=H[0];const le=H.some(pe=>He(pe));return se.value=0,le},{shortcuts:F}=Yi(m);he(()=>M.value.id,()=>{ne()});const $=()=>{l.isConfig&&(S.value&&M.value.displayType==="7"||(f.value=M.value.displayType==="7"?[]:void 0,S.value=M.value.displayType==="7",M.value.defaultValue=S.value?[]:void 0,f.value=S.value?[]:void 0))};he(()=>M.value.selectValue,H=>{l.isConfig||(M.value.displayType==="7"&&(f.value=Array.isArray(H)?[...H]:H),Se(()=>{S.value=M.value.displayType==="7",S.value||(f.value=Array.isArray(M.value.selectValue)?[...M.value.selectValue]:M.value.selectValue)}))});const h=()=>{const H=Array.isArray(f.value)?[...f.value]:f.value;if(!l.isConfig){M.value.selectValue=Array.isArray(f.value)?[...f.value]:f.value,Se(()=>{W(M.value.id)});return}M.value.defaultValue=Array.isArray(H)?H.map(le=>new Date(le).toLocaleString()):new Date(H).toLocaleString()},ne=()=>{const{defaultValueCheck:H,displayType:le,defaultValue:pe}=M.value,R=le==="7";H?(M.value.selectValue=Array.isArray(pe)?[...pe]:pe,f.value=Array.isArray(pe)?[...pe]:pe):(M.value.selectValue=R?[]:void 0,f.value=R?[]:void 0),S.value=M.value.displayType==="7",e.value=e.value.slice(0,me()+1)},X=Ee("com-width",Function,!0),ie=()=>{var H;return(H=d==null?void 0:d.value)!=null&&H.placeholderShow?l.config.queryConditionWidth===void 0?X():l.config.queryConditionWidth:227},W=Ee("is-confirm-search",Function,!0),w=U(()=>l.isConfig?{}:{width:(S.value?ie()*2:ie())+"px !important"}),q=U(()=>E.mobileInPc?["year","month","day"].slice(0,me()+1):[]),z=U(()=>E.mobileInPc?(S.value?M.value.timeGranularityMultiple:M.value.timeGranularity).includes("datetime"):!1),ve=ue([]),e=ue(["2021","01","01"]),Ve=ue(!1),P=U(()=>E.mobileInPc?+M.value.displayType==7:!1),A=()=>{var le;const H=((le=f.value)==null?void 0:le.length)>1?f.value[1]:null;if(H){const pe=new Date(H);e.value=[`${pe.getFullYear()}`,`${pe.getMonth()+1}`,`${pe.getDate()}`].slice(0,me()+1),z.value&&(ve.value=[`${pe.getHours()}`,`${pe.getMinutes()}`,`${pe.getSeconds()}`])}Ue.value=!0,Ve.value=!0},me=()=>{const H=S.value?M.value.timeGranularityMultiple:M.value.timeGranularity;return["year","month","date"].findIndex(pe=>H.includes(pe))},se=ue(0),Ye=H=>{se.value=+new Date(H[0])},Fe=()=>{se.value=0},Ne=U(()=>{const H=M.value.timeGranularityMultiple.split("time").join("").split("range")[0];return H==="date"?"day":H}),He=H=>{const le=+new Date(H);if(!M.value.setTimeRange)return!1;const{intervalType:pe,regularOrTrends:R,regularOrTrendsValue:Te,relativeToCurrent:Ze,timeNum:D,relativeToCurrentType:ee,around:G,dynamicWindow:_,maximumSingleQuery:V,timeNumRange:K,relativeToCurrentTypeRange:oe,aroundRange:x}=M.value.timeRange||{};let te=!1;if(se.value&&_&&(te=ke(se.value).add(V,Ne.value).startOf(Ne.value).valueOf()-1e3<le||ke(se.value).subtract(V,Ne.value).startOf(Ne.value).valueOf()+1e3>le),pe==="none")return _?te:!1;let de;if(Ze==="custom")de=na(ee,G==="f"?"subtract":"add",D);else switch(Ze){case"thisYear":de=je("year");break;case"lastYear":de=ya("year");break;case"thisMonth":de=je("month");break;case"lastMonth":de=ya("month");break;case"today":de=je("day");break;case"yesterday":de=ya("day");break;case"monthBeginning":de=je("month");break;case"yearBeginning":de=je("year");break}const ye=R==="fixed"?Te:de;if(pe==="start")return le<+new Date(ye)||te;if(pe==="end")return le>+new Date(ye)||te;if(pe==="timeInterval"){const Be=R==="fixed"?new Date(ke(new Date(Te[0])).startOf(Ne.value).format("YYYY/MM/DD HH:mm:ss")):na(ee,G==="f"?"subtract":"add",D),ca=R==="fixed"?new Date(ke(new Date(Te[1])).endOf(Ne.value).format("YYYY/MM/DD HH:mm:ss")):na(oe,x==="f"?"subtract":"add",K);return le<+new Date(Be)-1e3||le>+new Date(ca)||te}},Xe=()=>{if(P.value){const[H]=f.value||[];if(H){const le=new Date(H);e.value=[`${le.getFullYear()}`,`${le.getMonth()+1}`,`${le.getDate()}`].slice(0,me()+1),z.value&&(ve.value=[`${le.getHours()}`,`${le.getMinutes()}`,`${le.getSeconds()}`])}}else{const H=f.value?new Date(f.value):new Date;e.value=[`${H.getFullYear()}`,`${H.getMonth()+1}`,`${H.getDate()}`].slice(0,me()+1),z.value&&(ve.value=[`${H.getHours()}`,`${H.getMinutes()}`,`${H.getSeconds()}`])}Ue.value=!1,Ve.value=!0},ua=()=>{Ve.value=!1},Ue=ue(!1),We=()=>{e.value=e.value.slice(0,me()+1);const H=e.value.length===2?e.value.concat(["01"]):e.value;if(P.value){const[le,pe]=f.value||[];Ue.value?f.value=[le||new Date(`${H.join("/")} ${ve.value.join(":")}`),new Date(`${H.join("/")} ${ve.value.join(":")}`)]:f.value=[new Date(`${H.join("/")} ${ve.value.join(":")}`),pe||new Date(`${H.join("/")} ${ve.value.join(":")}`)]}else f.value=new Date(`${H.join("/")} ${ve.value.join(":")}`)},ea=()=>{Ve.value=!1;const{displayType:H}=M.value,le=H==="7";M.value.selectValue=le?[]:void 0,f.value=le?[]:void 0,h()},T=()=>{We(),h(),Ve.value=!1};fa(()=>{ne()}),C({displayTypeChange:$});const da=U(()=>M.value.timeGranularityMultiple==="yearrange"?"YYYY":void 0);return(H,le)=>{const pe=qa;return s(),b(ae,null,[S.value?(s(),I(pe,{modelValue:f.value,"onUpdate:modelValue":le[0]||(le[0]=R=>f.value=R),key:a(M).timeGranularityMultiple,type:a(M).timeGranularityMultiple,style:Ae(w.value),onVisibleChange:Fe,"disabled-date":He,onCalendarChange:Ye,format:da.value,shortcuts:["datetimerange","daterange"].includes(a(M).timeGranularityMultiple)?a(F):[],onChange:h,editable:!1,"range-separator":H.$t("cron.to"),"start-placeholder":p.value,"end-placeholder":p.value},null,8,["modelValue","type","style","format","shortcuts","range-separator","start-placeholder","end-placeholder"])):(s(),I(pe,{key:a(M).timeGranularity+1,modelValue:f.value,"onUpdate:modelValue":le[1]||(le[1]=R=>f.value=R),onVisibleChange:Fe,"disabled-date":He,type:a(M).timeGranularity,onChange:h,style:Ae(w.value),placeholder:p.value},null,8,["modelValue","type","style","placeholder"])),a(E).mobileInPc?(s(),b("div",{key:2,class:be(["vant-mobile",P.value&&"wl50"]),onClick:Xe},null,2)):j("",!0),a(E).mobileInPc&&P.value?(s(),b("div",{key:3,class:"vant-mobile wr50",onClick:A})):j("",!0),a(E).mobileInPc?(s(),I(a(_n),{key:4,teleport:"body",position:"bottom",show:Ve.value,"onUpdate:show":le[5]||(le[5]=R=>Ve.value=R)},{default:r(()=>[z.value?(s(),I(a(yn),{key:0,onConfirm:T,onCancel:ua,title:a(u)("v_query.time_selection"),tabs:[a(u)("dataset.select_date"),a(u)("dataset.select_time")],"next-step-text":a(u)("sync_datasource.next")},{default:r(()=>[i(a(Il),{"min-date":a(J),"max-date":a(re),"columns-type":q.value,modelValue:e.value,"onUpdate:modelValue":le[2]||(le[2]=R=>e.value=R)},null,8,["min-date","max-date","columns-type","modelValue"]),i(a(fn),{"columns-type":["hour","minute","second"],modelValue:ve.value,"onUpdate:modelValue":le[3]||(le[3]=R=>ve.value=R)},null,8,["modelValue"])]),_:1},8,["title","tabs","next-step-text"])):j("",!0),z.value?j("",!0):(s(),I(a(Il),{key:1,title:a(u)("dataset.select_date"),"columns-type":q.value,onConfirm:T,onCancel:ua,"min-date":a(J),"max-date":a(re),modelValue:e.value,"onUpdate:modelValue":le[4]||(le[4]=R=>e.value=R)},null,8,["title","columns-type","min-date","max-date","modelValue"]))]),_:1},8,["show"])):j("",!0),Ve.value?(s(),I(xl,{key:5,to:".van-picker__toolbar"},[v("button",{style:{position:"absolute",top:"0",right:"60px"},onClick:ea,class:"van-picker__confirm van-haptics-feedback oooo"},g(a(u)("commons.clear")),1)])):j("",!0)],64)}}});const Xl=xe({__name:"Select",props:{config:{type:Object,default:()=>({selectValue:"",queryConditionWidth:0,resultMode:0,defaultValue:"",displayType:"",defaultValueCheck:!1,optionValueSource:0,multiple:!1,checkedFieldsMap:{}})},isConfig:{type:Boolean,default:!1}},setup(L,{expose:C}){const{t:u}=ia(),l=L,{config:d}=Qe(l);let p=[];const f=ue(),S=ue(!1),E=ue(!1),M=Na([]),J=Ee("unmount-select"),re=Ee("placeholder"),m=Ee("release-unmount-select",Function,!0),F=Ee("query-data-for-id",Function,!0),$=Ee("is-confirm-search",Function,!0),h=Ee("com-width",Function,!0),ne=Ee("cascade-list",Function,!0),X=Ee("set-cascade-default",Function,!0),ie=U(()=>{var D;return(D=re==null?void 0:re.value)!=null&&D.placeholderShow?["",void 0].includes(l.config.placeholder)?" ":l.config.placeholder:" "}),W=U(()=>ne()||[]),w=D=>{const{displayId:ee,field:G}=d.value;if(d.value.optionValueSource!==1)return[];let _={},V=[];return D.forEach(K=>{_[K]=[]}),p.forEach(K=>{_[K[ee||(G==null?void 0:G.id)]]&&_[K[ee||(G==null?void 0:G.id)]].push(K[G==null?void 0:G.id])}),Object.values(_).forEach(K=>{V=[...new Set([...V,...K])]}),V};xt(()=>{p=[]});const q=D=>{W.value.forEach(ee=>{ee.forEach(G=>{G.datasetId.split("--")[1]===d.value.id&&(l.isConfig&&(G.selectValue=Array.isArray(D)?[...D]:D),G.currentSelectValue=Array.isArray(D)?[...D]:D)})})},z=()=>{W.value.forEach(D=>{let ee=!1;D.forEach(G=>{G.datasetId.split("--")[1]===d.value.id?ee=!0:ee&&(ga().emitter.emit(`${G.datasetId.split("--")[1]}-select`),ee=!1)})})},ve=()=>{const D=[];return W.value.forEach(ee=>{let G=!1;ee.forEach(_=>{_.datasetId.split("--")[1]===d.value.id?G=!0:G&&(D.push(_.datasetId.split("--")[1]),G=!1)})}),D},e=()=>{const D=[];return W.value.forEach(ee=>{let G=null;ee.forEach(_=>{var x,te;const[V,K,oe]=_.datasetId.split("--");K===d.value.id&&G?(_.fieldId&&(G.fieldId=_.fieldId),D.push(G)):l.isConfig?(x=_.selectValue)!=null&&x.length&&(G={fieldId:oe,operator:"in",value:[..._.selectValue]}):(te=_.currentSelectValue)!=null&&te.length&&(G={fieldId:oe,operator:"in",value:[..._.currentSelectValue]})})}),D},Ve=()=>{const D=Array.isArray(f.value)?[...f.value]:f.value;if(!l.isConfig){d.value.selectValue=Array.isArray(f.value)?[...f.value]:f.value,d.value.mapValue=w(Array.isArray(f.value)?[...f.value]:[f.value]),q(d.value.mapValue),z(),Se(()=>{$(d.value.id)});return}X(ve()),d.value.defaultValue=D,d.value.mapValue=w(Array.isArray(f.value)?[...f.value]:[f.value]),d.value.defaultMapValue=w(Array.isArray(f.value)?[...f.value]:[f.value]),q(d.value.mapValue)},P=()=>{l.isConfig&&(d.value.defaultValue=d.value.multiple?[]:void 0,f.value=d.value.multiple?[]:void 0)},A=D=>{S.value=!0,Jt({fieldIds:D,resultMode:d.value.resultMode||0}).then(ee=>{M.value=(ee||[]).filter(G=>G!==null).map(G=>({label:`${G}`,value:`${G}`}))}).finally(()=>{S.value=!1,d.value.defaultValueCheck?f.value=Array.isArray(d.value.defaultValue)?[...d.value.defaultValue]:d.value.defaultValue:f.value=Array.isArray(f.value)?[...f.value]:f.value,Ne()})},me=D=>{const{displayId:ee}=d.value;if(!ee)return[];let G={},_=[];return D.forEach(V=>{G[V]=[]}),p.forEach(V=>{G[V[ee]]&&G[V[ee]].push(V)}),Object.values(G).forEach(V=>{_=[..._,...V]}),_},se=()=>{var D;(D=d.value.sortList)!=null&&D.length&&d.value.sort==="customSort"&&(M.value=[...M.value.sort(ee=>{if(d.value.sortList.indexOf(ee.value)!==-1)return-1}).sort((ee,G)=>d.value.sortList.indexOf(ee.value)===-1?0:d.value.sortList.indexOf(ee.value)-d.value.sortList.indexOf(G.value))])},Ye=D=>{S.value=!0,jl(D).then(ee=>{var V;let G=[],_=[];(V=f.value)!=null&&V.length&&d.value.multiple&&(G=[...f.value],_=me(G)),p=[...ee||[],..._],M.value=[...new Set((ee||[]).map(K=>`${K[D.displayId||D.queryId]}`).concat(G))].map(K=>({label:`${K}`,value:`${K}`,checked:G.includes(K)})),se()}).finally(()=>{var ee;if(S.value=!1,d.value.defaultValueCheck&&!Xe.value){f.value=Array.isArray(d.value.defaultValue)?[...d.value.defaultValue]:d.value.defaultValue;let G=!1;if(J.value.includes(d.value.id)){const _=w(Array.isArray(f.value)?[...f.value]:[f.value]);(_==null?void 0:_.length)!==((ee=d.value.defaultMapValue)==null?void 0:ee.length)?G=!0:_.every(V=>d.value.defaultMapValue.includes(V))||(G=!0),m(d.value.id)}d.value.mapValue=w(Array.isArray(f.value)?[...f.value]:[f.value]),G&&F(d.value.id)}else f.value=Array.isArray(f.value)?[...f.value]:f.value;Xe.value=!1})},Fe=ue(!1);he(()=>d.value.showEmpty,()=>{Ne()});const Ne=()=>{const{showEmpty:D,displayType:ee,optionValueSource:G}=d.value;if(+ee!=0||G===1)return;const[_]=M.value;D?(_==null?void 0:_.value)!=="_empty_$"&&(M.value=[{label:u("v_query.empty_data"),value:"_empty_$"},...M.value]):(_==null?void 0:_.value)==="_empty_$"&&(M.value=M.value.slice(1))};he(()=>d.value.defaultValue,D=>{d.value.multiple&&(f.value=Array.isArray(D)?[...D]:D),Se(()=>{E.value=d.value.multiple})}),he(()=>d.value.id,()=>{We()}),he(()=>d.value.selectValue,D=>{l.isConfig||(d.value.multiple&&(f.value=Array.isArray(D)?[...D]:D),Se(()=>{E.value=d.value.multiple,d.value.multiple||(f.value=Array.isArray(d.value.selectValue)?[...d.value.selectValue]:d.value.selectValue)}))}),he(()=>d.value.multiple,D=>{l.isConfig&&(D&&(f.value=[]),Se(()=>{E.value=D,D||Se(()=>{f.value=void 0})}))}),he([()=>d.value.field.id,()=>d.value.displayId,()=>d.value.sort,()=>d.value.sortId],D=>{D&&Ue(1)}),he([()=>d.value.sortList],D=>{!(D!=null&&D.length)||d.value.sort!=="customSort"||se()}),he(()=>d.value.optionValueSource,(D,ee)=>{l.isConfig&&([D,ee].includes(2)&&(f.value=Array.isArray(f.value)?[]:void 0,d.value.selectValue=Re(f.value),d.value.defaultValue=Re(f.value)),Ue(D))}),he([()=>d.value.checkedFields,()=>d.value.checkedFieldsMap],()=>{Ue(d.value.optionValueSource)},{deep:!0});const He=ue(""),Xe=ue(!1);he(()=>d.value.valueSource,()=>{d.value.optionValueSource===2&&Ue(2)});const Ue=Pl(D=>{if(D!==d.value.optionValueSource)return;const{optionValueSource:ee,checkedFieldsMap:G,checkedFields:_,field:V,valueSource:K,displayId:oe,sort:x,sortId:te}=d.value;switch(ee){case 0:const de=Object.values(G).filter(ye=>!!ye);_.length&&de.length?A(_.map(ye=>G[ye]).filter(ye=>!!ye)):M.value=[];break;case 1:V.id?Ye({queryId:V.id,displayId:oe||V.id,sort:x==="customSort"?"asc":x,sortId:x==="customSort"?"":te,resultMode:d.value.resultMode||0,searchText:He.value,filter:e()}):M.value=[];break;case 2:M.value=Re((K||[]).map(ye=>({label:`${ye}`,value:`${ye}`}))),Ne();break}},300),We=()=>{const{defaultValueCheck:D,multiple:ee,defaultValue:G,optionValueSource:_}=d.value;D?(d.value.selectValue=Array.isArray(G)?[...G]:G,f.value=Array.isArray(G)?[...G]:G):(d.value.selectValue=ee?[]:void 0,f.value=ee?[]:void 0),Se(()=>{E.value=d.value.multiple}),Ue(_)},ea=()=>{var D;return(D=re==null?void 0:re.value)!=null&&D.placeholderShow?l.config.queryConditionWidth===void 0?h():l.config.queryConditionWidth:227},T=U(()=>l.isConfig?{}:{width:ea()+"px"}),da=ue(),H=ue(),le=()=>{d.value.optionValueSource!==1||![0,2,5].includes(+d.value.displayType)||(d.value.selectValue=d.value.multiple?[]:void 0,f.value=d.value.multiple?[]:void 0,Xe.value=!0,Ue(1))},pe=()=>{ga().emitter.emit("select-hide_lick",d.value.id)},R=D=>{var G;if(D===d.value.id)return;const ee=H.value||da.value;(G=ee==null?void 0:ee.handleClickOutside)==null||G.call(ee)};fa(()=>{We(),ga({name:`${d.value.id}-select`,callback:le}),ga({name:"select-hide_lick",callback:R})});const Te=ue(!1),Ze=U(()=>{let D="filter-select-popper_class";return Fe.value&&(D="load-select "+D),Te.value&&(D=D+" color-scrollbar__thumb"),D});return vl(()=>{Te.value=!!document.querySelector("#canvas-dv-outer")||!!document.querySelector(".datav-preview")}),C({displayTypeChange:P,mult:da,single:H}),(D,ee)=>{const G=qt,_=$a,V=Aa,K=Ul("loading");return E.value?Ca((s(),I(G,{key:"multiple",ref_key:"mult",ref:da,modelValue:f.value,"onUpdate:modelValue":ee[0]||(ee[0]=oe=>f.value=oe),placeholder:ie.value,filterable:"",onClick:pe,onChange:Ve,"popper-class":Ze.value,multiple:"","show-checked":"","scrollbar-always-on":"",clearable:"",style:Ae(T.value),"collapse-tags":"",options:M.value,"collapse-tags-tooltip":""},null,8,["modelValue","placeholder","popper-class","style","options"])),[[K,S.value]]):Ca((s(),I(G,{modelValue:f.value,"onUpdate:modelValue":ee[2]||(ee[2]=oe=>f.value=oe),key:"single",onClick:pe,placeholder:ie.value,"scrollbar-always-on":"",onChange:Ve,clearable:"",ref_key:"single",ref:H,style:Ae(T.value),filterable:"",radio:"","popper-class":Ze.value,options:M.value},{default:r(({item:oe})=>[i(V,{modelValue:f.value,"onUpdate:modelValue":ee[1]||(ee[1]=x=>f.value=x)},{default:r(()=>[i(_,{title:oe.label,label:oe.value},{default:r(()=>[Z(g(oe.label),1)]),_:2},1032,["title","label"])]),_:2},1032,["modelValue"])]),_:1},8,["modelValue","placeholder","style","popper-class","options"])),[[K,S.value]])}}});const El="",Bi=xe({__name:"Tree",props:{config:{type:Object,default:()=>({selectValue:"",defaultValue:"",queryConditionWidth:0,displayType:"",resultMode:0,defaultValueCheck:!1,multiple:!1,checkedFieldsMap:{},treeFieldList:[]})},isConfig:{type:Boolean,default:!1}},setup(L){const C=L,u=Ee("placeholder"),l=U(()=>{var z;return(z=u==null?void 0:u.value)!=null&&z.placeholderShow?["",void 0].includes(C.config.placeholder)?" ":C.config.placeholder:" "}),{config:d}=Qe(C),p=ue(!1),f=z=>{W.value=z,S()},S=()=>{const z=Array.isArray(W.value)?[...W.value]:W.value;if(!C.isConfig){d.value.selectValue=Array.isArray(W.value)?[...W.value]:W.value,Se(()=>{re(d.value.id)});return}d.value.defaultValue=z};he(()=>d.value.defaultValue,z=>{d.value.multiple&&(W.value=Array.isArray(z)?[...z]:z),Se(()=>{p.value=d.value.multiple})}),he(()=>d.value.treeFieldList,()=>{W.value=d.value.multiple?[]:void 0,M.value=!1,ie()});const E=()=>{const{defaultValueCheck:z,multiple:ve,defaultValue:e}=d.value;z?(d.value.selectValue=Array.isArray(e)?Re([...e]):e,W.value=Array.isArray(e)?Re([...e]):e):(d.value.selectValue=ve?[]:void 0,W.value=ve?[]:void 0),Se(()=>{p.value=d.value.multiple}),ie()};he(()=>d.value.id,()=>{E()});const M=ue(!0),J=Ee("com-width",Function,!0),re=Ee("is-confirm-search",Function,!0);he(()=>d.value.id,()=>{ie()}),vl(()=>{setTimeout(()=>{E()},0)}),he(()=>d.value.selectValue,z=>{C.isConfig||(d.value.multiple&&(W.value=Array.isArray(z)?[...z]:z),Se(()=>{p.value=d.value.multiple,d.value.multiple||(W.value=Array.isArray(d.value.selectValue)?[...d.value.selectValue]:d.value.selectValue)}))});const m=ue(!1);he(()=>d.value.multiple,z=>{C.isConfig&&(m.value=!1,z&&(W.value=[]),Se(()=>{p.value=z,z||Se(()=>{W.value=void 0}),Se(()=>{m.value=!0})}))});let F="",$=Na([]);const h=(z,ve)=>(ve.label??"").toLowerCase().includes((z??"").toLowerCase()),ne=z=>(z||[]).map(ve=>{var Ve;let e=[];return(Ve=ve.children)!=null&&Ve.length&&(e=ne(ve.children)),{...ve,value:ve.id,label:ve.text,children:e}}),X=ue(!1),ie=Pl(()=>{X.value=!0,Xt({fieldIds:C.config.treeFieldList.map(z=>z.id),resultMode:d.value.resultMode||0}).then(z=>{$.value=ne(z)}).finally(()=>{X.value=!1,m.value=!0})},300);he(()=>C.config.treeFieldList,z=>{if(!C.isConfig)return;const ve=z.map(e=>e.id).join("");F!==z.map(e=>e.id).join("")&&(F=ve,ie())});const W=ue(),w=()=>{var z;return(z=u==null?void 0:u.value)!=null&&z.placeholderShow?C.config.queryConditionWidth!==void 0?C.config.queryConditionWidth:J():227},q=U(()=>C.isConfig?{}:{width:w()+"px"});return(z,ve)=>{const e=Rl,Ve=Ul("loading");return p.value&&!X.value?(s(),I(e,{modelValue:W.value,"onUpdate:modelValue":ve[0]||(ve[0]=P=>W.value=P),data:a($),clearable:"",onTreeSelectConfirm:f,"render-after-expand":!1,"show-checkbox":"",showBtn:"",placeholder:l.value,"collapse-tags":"","filter-node-method":h,showWholePath:m.value,"collapse-tags-tooltip":"",key:"multipleTree"+w(),filterable:"",style:Ae(q.value),multiple:""},null,8,["modelValue","data","placeholder","showWholePath","style"])):!p.value&&!X.value?(s(),I(e,{modelValue:W.value,"onUpdate:modelValue":ve[1]||(ve[1]=P=>W.value=P),onChange:S,data:a($),"check-strictly":"",clearable:"","filter-node-method":h,placeholder:l.value,"render-after-expand":!1,key:"singleTree"+w(),showWholePath:m.value,style:Ae(q.value),filterable:""},null,8,["modelValue","data","placeholder","showWholePath","style"])):Ca((s(),I(e,{modelValue:El,"onUpdate:modelValue":ve[2]||(ve[2]=P=>El=P),data:[],placeholder:l.value,"render-after-expand":!1,key:"fakeTree",style:Ae(q.value)},null,8,["placeholder","style"])),[[Ve,X.value]])}}});const et=Ia(Bi,[["__scopeId","data-v-968a3a40"]]),ji={class:"label"},Wi={class:"condition-type"},Pi={key:0,class:"condition-type"},zi={class:"condition-type-tip"},Qi={class:"label"},Hi={class:"setting-content",style:{display:"flex","align-items":"center"}},Zi={key:2,class:"list-item"},Ki={class:"label"},Ji={class:"value"},Xi={key:3,class:"list-item"},eu={class:"label"},au={class:"setting-content"},lu={key:0,class:"config-flag range-filter-time-flag"},tu={key:4,class:"list-item"},nu={class:"label"},iu={key:5,class:"list-item"},uu={class:"label"},ru={key:0,class:"setting-content"},su={class:"setting"},ou={class:"setting"},du=["title"],cu={class:"setting-value select"},vu={key:0,class:"setting"},mu={class:"setting"},pu={class:"setting-label"},yu={class:"setting-value select"},fu={class:"setting-label"},_u={class:"setting-input with-date range"},hu={class:"setting-label"},gu={class:"setting-input with-date range"},bu={key:0,class:"setting-label"},Vu=xe({__name:"ConditionDefaultConfiguration",props:{curComponent:{type:Object,required:!0},showPosition:{type:String,default:"main"}},emits:["handleTimeTypeChange"],setup(L,{expose:C,emit:u}){const{t:l}=ia(),d=ue(!1),p=()=>{d.value=!1},f=P=>{P.stopPropagation(),d.value=!d.value},S=U(()=>{const{displayType:P,timeType:A="fixed"}=m.value;return["1","7"].includes(P)?A==="dynamic"?P==="1"?xi:Ui:Jl:P==="9"?et:Xl}),E=u,M=P=>{P==="dynamic"&&E("handleTimeTypeChange")},J=L,re=U(()=>J.showPosition==="main"),{curComponent:m}=Qe(J),F=U(()=>{if(!m.value)return[];let P=["year","month","date","datetime"].indexOf(m.value.timeGranularity)+1;return+m.value.displayType==7&&(P=["yearrange","monthrange","daterange","datetimerange"].indexOf(m.value.timeGranularityMultiple)+1),[{label:l("dynamic_time.year"),value:"year"},{label:l("dynamic_time.month"),value:"month"},{label:l("dynamic_time.date"),value:"date"}].slice(0,P)}),$=U(()=>{let P=[];if(!m.value)return P;switch(m.value.timeGranularity){case"year":P=[{label:l("dynamic_year.current"),value:"thisYear"},{label:l("dynamic_year.last"),value:"lastYear"}];break;case"month":P=[{label:l("cron.this_month"),value:"thisMonth"},{label:l("dynamic_month.last"),value:"lastMonth"}];break;case"date":P=[{label:l("dynamic_time.today"),value:"today"},{label:l("dynamic_time.yesterday"),value:"yesterday"},{label:l("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:l("dynamic_time.endOfMonth"),value:"monthEnd"},{label:l("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetime":P=[{label:l("dynamic_time.today"),value:"today"},{label:l("dynamic_time.yesterday"),value:"yesterday"},{label:l("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:l("dynamic_time.endOfMonth"),value:"monthEnd"},{label:l("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...P,{label:l("dynamic_time.custom"),value:"custom"}]}),h=U(()=>{let P=[];if(!m.value)return P;switch(m.value.timeGranularityMultiple){case"yearrange":P=[{label:l("dynamic_year.current"),value:"thisYear"},{label:l("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":P=[{label:l("cron.this_month"),value:"thisMonth"},{label:l("dynamic_month.last"),value:"lastMonth"},{label:l("v_query.last_3_months"),value:"LastThreeMonths"},{label:l("v_query.last_6_months"),value:"LastSixMonths"},{label:l("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"daterange":case"datetimerange":P=[{label:l("dynamic_time.today"),value:"today"},{label:l("dynamic_time.yesterday"),value:"yesterday"},{label:l("v_query.last_3_days"),value:"LastThreeDays"},{label:l("v_query.month_to_date"),value:"monthBeginning"},{label:l("v_query.year_to_date"),value:"yearBeginning"}];break}return[...P,{label:l("dynamic_time.custom"),value:"custom"}]}),ne=[{label:l("dynamic_time.before"),value:"f"},{label:l("dynamic_time.after"),value:"b"}],X=U(()=>{const{displayType:P,timeType:A}=m.value;return A==="dynamic"&&[1,7].includes(+P)}),ie=[{label:l("v_query.exact_match"),value:"eq"},{label:l("v_query.fuzzy_match"),value:"like"}],W=ue(!1),w=(P,A=!1)=>{A&&(m.value.defaultValue=P?[]:void 0);const{defaultValue:me}=m.value;if(Array.isArray(me)?m.value.selectValue=P?me:void 0:m.value.selectValue=P?me!==void 0?[me]:[]:me,m.value.field.deType===1){m.value.multiple=P;return}m.value.multiple=P},q=P=>{W.value=P},z=ue();return C({multipleChange:w,handleDialogClick:p,changeMultiple:q,displayTypeChange:()=>{var P,A;(A=(P=z.value)==null?void 0:P.displayTypeChange)==null||A.call(P)},mult:()=>{var P,A,me;(me=(A=(P=z.value)==null?void 0:P.mult)==null?void 0:A.handleClickOutside)==null||me.call(A)},single:()=>{var P,A,me;(me=(A=(P=z.value)==null?void 0:P.single)==null?void 0:A.handleClickOutside)==null||me.call(A)}}),(P,A)=>{const me=Ma,se=ol,Ye=sl,Fe=ja,Ne=$a,He=Aa,Xe=Ta,ua=wa,Ue=Ll,We=dl,ea=$t;return s(),b(ae,null,[a(m).displayType==="8"?(s(),b("div",{key:0,class:"list-item top-item",onClick:A[4]||(A[4]=Ie(()=>{},["stop"]))},[v("div",ji,g(a(l)("dynamic_time.set_default")),1),v("div",{class:be(["value",a(m).hideConditionSwitching&&"hide-condition_switching"])},[v("div",Wi,[a(m).hideConditionSwitching?j("",!0):(s(),I(a($e),{key:0,class:"condition-value-select","popper-class":"condition-value-select-popper",modelValue:a(m).defaultConditionValueOperatorF,"onUpdate:modelValue":A[0]||(A[0]=T=>a(m).defaultConditionValueOperatorF=T)},{default:r(()=>[(s(),b(ae,null,ce(ie,T=>i(me,{key:T.value,label:T.label,value:T.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])),i(se,{class:"condition-value-input",modelValue:a(m).defaultConditionValueF,"onUpdate:modelValue":A[1]||(A[1]=T=>a(m).defaultConditionValueF=T)},null,8,["modelValue"]),A[30]||(A[30]=v("div",{class:"bottom-line"},null,-1))]),[1,2].includes(a(m).conditionType)?(s(),b("div",Pi,[v("span",zi,g(a(m).conditionType===1?a(l)("chart.and"):a(l)("chart.or")),1),a(m).hideConditionSwitching?j("",!0):(s(),I(a($e),{key:0,class:"condition-value-select","popper-class":"condition-value-select-popper",modelValue:a(m).defaultConditionValueOperatorS,"onUpdate:modelValue":A[2]||(A[2]=T=>a(m).defaultConditionValueOperatorS=T)},{default:r(()=>[(s(),b(ae,null,ce(ie,T=>i(me,{key:T.value,label:T.label,value:T.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])),i(se,{class:"condition-value-input",modelValue:a(m).defaultConditionValueS,"onUpdate:modelValue":A[3]||(A[3]=T=>a(m).defaultConditionValueS=T)},null,8,["modelValue"]),A[31]||(A[31]=v("div",{class:"bottom-line next-line"},null,-1))])):j("",!0)],2)])):j("",!0),a(m).displayType==="22"?(s(),b("div",{key:1,class:"list-item top-item",onClick:A[8]||(A[8]=Ie(()=>{},["stop"]))},[v("div",Qi,[i(Ye,{modelValue:a(m).defaultValueCheck,"onUpdate:modelValue":A[5]||(A[5]=T=>a(m).defaultValueCheck=T),label:a(l)("dynamic_time.set_default")},null,8,["modelValue","label"])]),v("div",Hi,[i(Fe,{disabled:!a(m).defaultValueCheck,placeholder:a(l)("system.the_minimum_value"),style:{width:"192.5px"},"controls-position":"right",modelValue:a(m).defaultNumValueStart,"onUpdate:modelValue":A[6]||(A[6]=T=>a(m).defaultNumValueStart=T)},null,8,["disabled","placeholder","modelValue"]),A[32]||(A[32]=v("div",{class:"num-value_line"},null,-1)),i(Fe,{placeholder:a(l)("system.the_maximum_value"),style:{width:"192.5px"},"controls-position":"right",disabled:!a(m).defaultValueCheck,modelValue:a(m).defaultNumValueEnd,"onUpdate:modelValue":A[7]||(A[7]=T=>a(m).defaultNumValueEnd=T)},null,8,["placeholder","disabled","modelValue"])])])):j("",!0),!["1","7","8","22"].includes(a(m).displayType)&&re.value?(s(),b("div",Zi,[v("div",Ki,g(a(l)("v_query.option_type")),1),v("div",Ji,[i(He,{class:"larger-radio",onChange:A[9]||(A[9]=T=>w(T,!0)),modelValue:W.value,"onUpdate:modelValue":A[10]||(A[10]=T=>W.value=T)},{default:r(()=>[i(Ne,{label:!1},{default:r(()=>[Z(g(a(l)("visualization.single_choice")),1)]),_:1}),i(Ne,{label:!0},{default:r(()=>[Z(g(a(l)("visualization.multiple_choice")),1)]),_:1})]),_:1},8,["modelValue"])])])):j("",!0),["7","1"].includes(a(m).displayType)&&re.value?(s(),b("div",Xi,[v("div",eu,[i(Ye,{modelValue:a(m).setTimeRange,"onUpdate:modelValue":A[11]||(A[11]=T=>a(m).setTimeRange=T),label:a(l)("v_query.time_filter_range")},null,8,["modelValue","label"])]),v("div",au,[i(Ue,{"show-arrow":!1,"popper-class":"range-filter-time",placement:"bottom-start",width:452,visible:d.value,offset:4},{reference:r(()=>[i(ua,{disabled:!a(m).setTimeRange,onClick:A[12]||(A[12]=T=>f(T)),text:"",style:{"margin-left":"-4px"}},{icon:r(()=>[i(Xe,{name:"icon_admin_outlined"},{default:r(()=>[i(a(pn),{class:"svg-icon"})]),_:1})]),default:r(()=>[Z(" "+g(a(l)("dynamic_time.set")),1)]),_:1},8,["disabled"])]),default:r(()=>[a(m).displayType==="7"?(s(),I(pi,{key:0,timeRange:a(m).timeRange,timeGranularityMultiple:a(m).timeGranularityMultiple},null,8,["timeRange","timeGranularityMultiple"])):(s(),I(Li,{key:1,timeRange:a(m).timeRange,timeGranularity:a(m).timeGranularity},null,8,["timeRange","timeGranularity"]))]),_:1},8,["visible"]),a(m).timeRange&&(a(m).timeRange.intervalType!=="none"||a(m).timeRange.dynamicWindow)?(s(),b("span",lu,g(a(l)("v_query.configured")),1)):j("",!0)])])):j("",!0),+a(m).displayType==0&&a(m).optionValueSource!==1&&re.value?(s(),b("div",tu,[v("div",nu,[i(We,{effect:"dark",content:a(l)("v_query.is_not_supported"),disabled:!a(m).parametersCheck,placement:"top"},{default:r(()=>[i(Ye,{disabled:a(m).parametersCheck,modelValue:a(m).showEmpty,"onUpdate:modelValue":A[13]||(A[13]=T=>a(m).showEmpty=T),label:a(l)("v_query.contains_empty_data")},null,8,["disabled","modelValue","label"])]),_:1},8,["content","disabled"])])])):j("",!0),["8","22"].includes(a(m).displayType)?j("",!0):(s(),b("div",iu,[v("div",uu,[i(Ye,{modelValue:a(m).defaultValueCheck,"onUpdate:modelValue":A[14]||(A[14]=T=>a(m).defaultValueCheck=T),label:a(l)("dynamic_time.set_default")},null,8,["modelValue","label"])]),a(m).defaultValueCheck&&["1","7"].includes(a(m).displayType)?(s(),b("div",ru,[v("div",su,[i(He,{onChange:M,modelValue:a(m).timeType,"onUpdate:modelValue":A[15]||(A[15]=T=>a(m).timeType=T)},{default:r(()=>[i(Ne,{label:"fixed"},{default:r(()=>[Z(g(a(l)("dynamic_time.fix")),1)]),_:1}),i(Ne,{label:"dynamic"},{default:r(()=>[Z(g(a(l)("dynamic_time.dynamic")),1)]),_:1})]),_:1},8,["modelValue"])]),X.value&&a(m).displayType==="1"?(s(),b(ae,{key:0},[v("div",ou,[v("div",{title:a(l)("dynamic_time.relative"),class:"setting-label ellipsis"},g(a(l)("dynamic_time.relative")),9,du),v("div",cu,[i(a($e),{onFocus:p,modelValue:a(m).relativeToCurrent,"onUpdate:modelValue":A[16]||(A[16]=T=>a(m).relativeToCurrent=T)},{default:r(()=>[(s(!0),b(ae,null,ce($.value,T=>(s(),I(me,{key:T.value,label:T.label,value:T.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(m).relativeToCurrent==="custom"?(s(),b("div",vu,[v("div",{class:be(["setting-input",a(m).timeGranularity==="datetime"&&"with-date"])},[i(Fe,{"step-strictly":"",modelValue:a(m).timeNum,"onUpdate:modelValue":A[17]||(A[17]=T=>a(m).timeNum=T),min:0,"controls-position":"right"},null,8,["modelValue"]),i(a($e),{onFocus:p,modelValue:a(m).relativeToCurrentType,"onUpdate:modelValue":A[18]||(A[18]=T=>a(m).relativeToCurrentType=T)},{default:r(()=>[(s(!0),b(ae,null,ce(F.value,T=>(s(),I(me,{key:T.value,label:T.label,value:T.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(a($e),{onFocus:p,modelValue:a(m).around,"onUpdate:modelValue":A[19]||(A[19]=T=>a(m).around=T)},{default:r(()=>[(s(),b(ae,null,ce(ne,T=>i(me,{key:T.value,label:T.label,value:T.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(m).timeGranularity==="datetime"?(s(),I(ea,{key:0,modelValue:a(m).arbitraryTime,"onUpdate:modelValue":A[20]||(A[20]=T=>a(m).arbitraryTime=T)},null,8,["modelValue"])):j("",!0)],2)])):j("",!0)],64)):X.value&&a(m).displayType==="7"?(s(),b(ae,{key:1},[v("div",mu,[v("div",pu,g(a(l)("dynamic_time.relative")),1),v("div",yu,[i(a($e),{onFocus:p,modelValue:a(m).relativeToCurrentRange,"onUpdate:modelValue":A[21]||(A[21]=T=>a(m).relativeToCurrentRange=T)},{default:r(()=>[(s(!0),b(ae,null,ce(h.value,T=>(s(),I(me,{key:T.value,label:T.label,value:T.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(m).relativeToCurrentRange==="custom"?(s(),b("div",{key:0,class:be(["setting",["yearrange","monthrange","daterange"].includes(a(m).timeGranularityMultiple)&&"is-year-month-range"])},[v("div",fu,g(a(l)("datasource.start_time")),1),v("div",_u,[i(Fe,{"step-strictly":"",modelValue:a(m).timeNum,"onUpdate:modelValue":A[22]||(A[22]=T=>a(m).timeNum=T),min:0,"controls-position":"right"},null,8,["modelValue"]),i(a($e),{onFocus:p,modelValue:a(m).relativeToCurrentType,"onUpdate:modelValue":A[23]||(A[23]=T=>a(m).relativeToCurrentType=T)},{default:r(()=>[(s(!0),b(ae,null,ce(F.value,T=>(s(),I(me,{key:T.value,label:T.label,value:T.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(a($e),{onFocus:p,modelValue:a(m).around,"onUpdate:modelValue":A[24]||(A[24]=T=>a(m).around=T)},{default:r(()=>[(s(),b(ae,null,ce(ne,T=>i(me,{key:T.value,label:T.label,value:T.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),i(ea,{modelValue:a(m).arbitraryTime,"onUpdate:modelValue":A[25]||(A[25]=T=>a(m).arbitraryTime=T)},null,8,["modelValue"])])],2)):j("",!0),a(m).relativeToCurrentRange==="custom"?(s(),b("div",{key:1,class:be(["setting",["yearrange","monthrange","daterange"].includes(a(m).timeGranularityMultiple)&&"is-year-month-range"])},[v("div",hu,g(a(l)("datasource.end_time")),1),v("div",gu,[i(Fe,{modelValue:a(m).timeNumRange,"onUpdate:modelValue":A[26]||(A[26]=T=>a(m).timeNumRange=T),min:0,"step-strictly":"","controls-position":"right"},null,8,["modelValue"]),i(a($e),{onFocus:p,modelValue:a(m).relativeToCurrentTypeRange,"onUpdate:modelValue":A[27]||(A[27]=T=>a(m).relativeToCurrentTypeRange=T)},{default:r(()=>[(s(!0),b(ae,null,ce(F.value,T=>(s(),I(me,{key:T.value,label:T.label,value:T.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(a($e),{onFocus:p,modelValue:a(m).aroundRange,"onUpdate:modelValue":A[28]||(A[28]=T=>a(m).aroundRange=T)},{default:r(()=>[(s(),b(ae,null,ce(ne,T=>i(me,{key:T.value,label:T.label,value:T.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),i(ea,{modelValue:a(m).arbitraryTimeRange,"onUpdate:modelValue":A[29]||(A[29]=T=>a(m).arbitraryTimeRange=T)},null,8,["modelValue"])])],2)):j("",!0)],64)):j("",!0)])):j("",!0),a(m).defaultValueCheck?(s(),b("div",{key:1,class:be(["parameters",X.value&&"setting"])},[X.value?(s(),b("div",bu,g(a(l)("template_manage.preview")),1)):j("",!0),v("div",{class:be(X.value?"setting-value":"w100")},[(s(),I(Le(S.value),{config:a(m),isConfig:"",ref_key:"inputCom",ref:z},null,8,["config"]))],2)],2)):j("",!0)]))],64)}}});const ku=Ia(Vu,[["__scopeId","data-v-c27132bd"]]),Tu={class:"query-condition-list"},Cu={class:"title"},Mu=["onDblclick","onClick"],Su=["title"],Fu={class:"condition-icon flex-align-center"},wu={key:0,class:"mask"},qu={class:"title flex-align-center"},$u={class:"flex-align-center"},Au={class:"select-all"},Nu={class:"field-list"},Ou=["title"],Iu=["title"],Eu={class:"flex-align-center icon"},Du=["title"],Ru=["onClick"],Lu={class:"flex-align-center icon"},xu=["title"],Uu=["onClick"],Gu=["title"],Yu=["title"],Bu=["onClick"],ju={key:3,style:{width:"172px","margin-left":"12px"}},Wu={key:0,class:"mask condition"},Pu={class:"title flex-align-center"},zu={class:"configuration-list"},Qu={class:"list-item"},Hu={class:"label"},Zu={class:"value"},Ku={key:0,class:"list-item"},Ju=["title"],Xu={class:"value"},er={key:1,class:"list-item"},ar={class:"label",style:{width:"135px",height:"26px","line-height":"26px"}},lr={class:"search-tree"},tr={class:"level-index"},nr={class:"field-type"},ir={class:"field-tree_name"},ur={key:2,class:"list-item"},rr=["title"],sr={class:"value"},or={key:3,class:"list-item top-item"},dr=["title"],cr={class:"value"},vr={class:"value"},mr={class:"value"},pr={class:"content"},yr=["title"],fr={style:{display:"flex","align-items":"center"},class:"value ellipsis"},_r=["title"],hr=["title"],gr={style:{display:"flex","align-items":"center"},class:"value"},br=["title"],Vr=["title"],kr={class:"value"},Tr={class:"label"},Cr=["title"],Mr={key:1,class:"value flex-align-center"},Sr={class:"manual-input-container"},Fr={class:"title"},wr={class:"select-value"},qr={class:"add-btn"},$r={class:"manual-footer flex-align-center"},Ar={key:0,class:"config-flag flex-align-center"},Nr=["title"],Or={class:"value",style:{"margin-top":"10.5px"}},Ir={key:4,class:"list-item top-item"},Er=["title"],Dr={class:"value"},Rr={class:"value"},Lr={key:5,style:{"margin-bottom":"10.5px"}},xr={key:1,class:"empty"},Ur={key:2,class:"empty"},Gr={key:3,class:"empty"},Yr={class:"dialog-footer"},Br=xe({__name:"QueryConditionConfiguration",props:{queryElement:{type:Object,default(){return{id:null,propValue:[]}}}},emits:["queryData"],setup(L,{expose:C,emit:u}){const{t:l}=ia(),{wsCache:d}=hn(),p=Oa(),{componentData:f,canvasViewInfo:S}=Wa(p),E=ue(null),M=L,J=ue(!1),re=ue([]),m=ue([]),F=ue([]),$=ue(!1),h=Gl({id:"",name:"",visible:!1}),ne={},X=Bl(),ie=()=>{let n=f.value.filter(t=>!["VQuery","DeTabs"].includes(t.innerType)&&t.component!=="Group");return f.value.forEach(t=>{t.innerType==="DeTabs"?t.propValue.forEach(o=>{n=[...n,...o.componentData.filter(y=>!["VQuery","DeTabs"].includes(y.innerType)&&y.component!=="Group")],o.componentData.forEach(y=>{y.component==="Group"&&(n=[...n,y.propValue.filter(k=>!["VQuery","DeTabs"].includes(k.innerType)&&k.component!=="Group")])})}):t.component==="Group"&&(n=[...n,t.propValue.filter(o=>!["VQuery","DeTabs"].includes(o.innerType)&&o.component!=="Group")],t.propValue.forEach(o=>{o.innerType==="DeTabs"&&o.propValue.forEach(y=>{n=[...n,...y.componentData.filter(k=>!["VQuery","DeTabs"].includes(k.innerType)&&k.component!=="Group")]})}))}),n.flat()},W=U(()=>ie().map(n=>{const t=S.value[n.id];if(!t)return null;const{id:o,title:y,tableId:k,type:N}=t;return o&&k?{id:o,type:N,title:y,tableId:k}:null}).filter(n=>!!n)),w=n=>{F.value.forEach(t=>{t.optionValueSource===1&&[0,2,5].includes(+t.displayType)&&n.includes(t.id)&&(t.selectValue=Array.isArray(t.selectValue)?[]:void 0,t.defaultValue=Array.isArray(t.defaultValue)?[]:void 0,t.mapValue=Array.isArray(t.mapValue)?[]:void 0,t.defaultMapValue=Array.isArray(t.defaultMapValue)?[]:void 0)})};let q=[];const z=n=>{q=n},ve=()=>q;oa("set-cascade-default",w),oa("cascade-list",ve);const e=ue(),Ve=ue(),P=ue(""),A=ue(!1),me=Na([]),se=ue(),{queryElement:Ye}=Qe(M),Fe=(n,t)=>{var o;return(o=t.flat().find(y=>y.id===n))==null?void 0:o.deType},Ne=U(()=>{var n;return!e.value||!((n=e.value.checkedFields)!=null&&n.length)?!1:e.value.checkedFields.some(t=>!!e.value.checkedFieldsMap[t])}),He=U(()=>{var y,k;if(!e.value||!((y=e.value.checkedFields)!=null&&y.length)||!((k=se.value)!=null&&k.length))return!1;if(e.value.parameters.length&&ra.value){const N=e.value.parameters.map(Q=>Q.type[1]),[B]=N;if(N.some(Q=>Q!==B))return!0}let n=null,t=0,o=e.value.checkedFields.every(N=>{var B,Q;return(Q=(B=e.value.checkedFieldsMapArrNum)==null?void 0:B[N])==null?void 0:Q.length})&&["22"].includes(e.value.displayType);return e.value.checkedFields.some(N=>{var Ce,fe,we,Ke,_e,ta,Ge,Me,aa;if(o)return!1;if((fe=(Ce=e.value.checkedFieldsMapArrNum)==null?void 0:Ce[N])!=null&&fe.length&&["22","2"].includes(e.value.displayType)&&(t===0&&(t=1),t===2)||!((Ke=(we=e.value.checkedFieldsMapArrNum)==null?void 0:we[N])!=null&&Ke.length)&&["22","2"].includes(e.value.displayType)&&e.value.parameters.some(qe=>[2,3].includes(qe.deType))&&e.value.checkedFieldsMap[N]&&(t===0&&(t=2),t===1))return!0;const B=se.value.find(qe=>qe.componentId===N),Q=(_e=e.value.checkedFieldsMap)==null?void 0:_e[N],Y=Be(Object.values((B==null?void 0:B.fields)||{}).flat()).find(qe=>Q===qe.id);if(!Y)return!1;if(n===null)return n=Y,!1;if((n==null?void 0:n.deType)===(Y==null?void 0:Y.deType)&&(n==null?void 0:n.deType)===1){if(!Array.isArray(Y.type)||!Array.isArray(n.type)||!((ta=n.type)!=null&&ta.length)&&!((Ge=Y.type)!=null&&Ge.length))return!1;if(((Me=n.type)==null?void 0:Me.length)!==((aa=Y.type)==null?void 0:aa.length))return!0}return[2,3].includes(Y==null?void 0:Y.deType)&&[2,3].includes(n.deType)?!1:n.deType!==(Y==null?void 0:Y.deType)})}),Xe=U(()=>{var t,o;if(!e.value||e.value.displayType!=="9"||!((t=e.value.checkedFields)!=null&&t.length)||!((o=se.value)!=null&&o.length))return!1;let n=null;return e.value.checkedFields.some(y=>{const N=se.value.find(B=>B.componentId===y).id;return N?n===null?(n=N,!1):n!==N:!1})}),ua=[{label:l("data_fill.rename"),command:"rename"},{label:l("data_fill.delete"),command:"del"}],Ue=n=>{e.value.checkedFields=n?se.value.map(t=>t.componentId):[],A.value=!1,n&&T()},We=()=>{var n,t;if(e.value.checkedFields.length){let o="",y="",k="";if(se.value.forEach(N=>{var B;e.value.checkedFields.includes(N.componentId)&&e.value.checkedFieldsMap[N.componentId]&&!o&&(o=e.value.checkedFieldsMap[N.componentId],k=N.componentId,y=(B=W.value.find(Q=>Q.id===N.componentId))==null?void 0:B.tableId)}),o&&y){const N=se.value.find(Y=>Y.componentId===k),B=e.value.optionValueSource===0?(n=N==null?void 0:N.fields)==null?void 0:n.dimensionList:(t=(se.value.find(Y=>Y.id===y)||{}).fields)==null?void 0:t.dimensionList;se.value.forEach(Y=>{var Ce;e.value.checkedFields.includes(Y.componentId)&&((Ce=W.value.find(fe=>fe.id===Y.componentId))==null?void 0:Ce.tableId)===y&&(e.value.checkedFieldsMap[Y.componentId]=o)});const Q=B.find(Y=>Y.id===o);if(e.value.treeFieldList.length){const[Y]=e.value.treeFieldList;if(Y&&Y.field!==o){const[Ce]=e.value.treeFieldList||[];if((Ce==null?void 0:Ce.id)===Q.id)return;e.value.treeFieldList=[Q]}}else if(Q){const[Y]=e.value.treeFieldList||[];if((Y==null?void 0:Y.id)===Q.id)return;e.value.treeFieldList=[Q]}}}},ea=n=>{Pe();const t=n.length;$.value=t===se.value.length,A.value=t>0&&t<se.value.length,e.value.displayType!=="8"&&ha()},T=()=>{const n={};Object.keys(e.value.checkedFieldsMap).forEach(t=>{e.value.checkedFieldsMap[t]&&se.value.forEach(o=>{var y;o.componentId===t&&((y=e.value.checkedFields)!=null&&y.includes(o.componentId))&&(n[o.id]=e.value.checkedFieldsMap[o.componentId],n[`active-${o.id}`]=o.activelist)})}),Object.keys(e.value.checkedFieldsMap).forEach(t=>{e.value.checkedFieldsMap[t]||se.value.forEach(o=>{var y;o.componentId===t&&((y=e.value.checkedFields)!=null&&y.includes(o.componentId))&&n[o.id]&&(e.value.checkedFieldsMap[o.componentId]=n[o.id],o.activelist=n[`active-${o.id}`])})})},da=n=>{Pe();const t=n.length;if($.value=t===se.value.length,A.value=t>0&&t<se.value.length,T(),e.value.displayType!=="8"){if(e.value.displayType==="9"){We();return}ha()}},H=n=>{let t=!1;return!ba.value&&ra.value&&Ha.value.length&&n.deType!==1&&(t=!0),t},le=(n,t)=>{var k,N;(N=(k=e.value.checkedFieldsMapArr)==null?void 0:k[t])!=null&&N.length&&(e.value.checkedFieldsMapArr[t]=[],e.value.checkedFieldsMapEnd[t]="",e.value.checkedFieldsMapStart[t]="");const o=e.value.checkedFieldsMapStartNum[t],y=e.value.checkedFieldsMapEndNum[t];o&&(e.value.checkedFieldsMapEndNum[t]=n.find(B=>B!==o)),y&&(e.value.checkedFieldsMapStartNum[t]=n.find(B=>B!==y)),n.length||(e.value.checkedFieldsMap[t]="",e.value.checkedFieldsMapEndNum[t]="",e.value.checkedFieldsMapStartNum[t]="",e.value.parametersArr[t]=[]),e.value.checkedFieldsMapArrNum[t].length&&x(t),va()},pe=(n,t)=>{var k,N;(N=(k=e.value.checkedFieldsMapArrNum)==null?void 0:k[t])!=null&&N.length&&(e.value.checkedFieldsMapArrNum[t]=[],e.value.checkedFieldsMapEndNum[t]="",e.value.checkedFieldsMapStartNum[t]="");const o=e.value.checkedFieldsMapStart[t],y=e.value.checkedFieldsMapEnd[t];o&&(e.value.checkedFieldsMapEnd[t]=n.find(B=>B!==o)),y&&(e.value.checkedFieldsMapStart[t]=n.find(B=>B!==y)),n.length||(e.value.checkedFieldsMap[t]="",e.value.checkedFieldsMapEnd[t]="",e.value.checkedFieldsMapStart[t]="",e.value.displayType="1",e.value.parametersArr[t]=[],e.value.timeGranularity="",e.value.timeGranularityMultiple=""),e.value.checkedFieldsMapArr[t].length&&te(t),va()};let R="",Te="";const Ze=ue(!1),D=ue(0),ee=ue(""),G=ue(!1),_=ue(0),V=ue(""),K=()=>{e.value.checkedFieldsMapArr[R]||(e.value.checkedFieldsMapArr[R]=[]),D.value===0&&(e.value.checkedFieldsMap[R]=Te,e.value.checkedFieldsMapArr[R]=[],e.value.checkedFieldsMapStart[R]="",e.value.checkedFieldsMapEnd[R]=""),D.value===1&&(e.value.checkedFieldsMapStart[R]=Te,e.value.checkedFieldsMapArr[R]=[...new Set([...e.value.checkedFieldsMapArr[R],Te])],e.value.checkedFieldsMapArr[R].length===1?e.value.checkedFieldsMapEnd[R]="":e.value.checkedFieldsMapEnd[R]=e.value.checkedFieldsMapArr[R].length===2?e.value.checkedFieldsMapArr[R].find(n=>n!==Te):Te),D.value===2&&(e.value.checkedFieldsMapArr[R]=[...new Set([...e.value.checkedFieldsMapArr[R],Te])],e.value.checkedFieldsMapEnd[R]=Te,e.value.checkedFieldsMapArr[R].length===1?e.value.checkedFieldsMapStart[R]="":e.value.checkedFieldsMapStart[R]=e.value.checkedFieldsMapArr[R].length===2?e.value.checkedFieldsMapArr[R].find(n=>n!==Te):Te),e.value.displayType=e.value.checkedFieldsMapArr[R].length?"7":"1",te(R),va(),Ze.value=!1},oe=()=>{e.value.checkedFieldsMapArrNum[R]||(e.value.checkedFieldsMapArrNum[R]=[]),_.value===0&&(e.value.checkedFieldsMap[R]=Te,e.value.checkedFieldsMapArrNum[R]=[],e.value.checkedFieldsMapStartNum[R]="",e.value.checkedFieldsMapEndNum[R]=""),_.value===1&&(e.value.checkedFieldsMapStartNum[R]=Te,e.value.checkedFieldsMapArrNum[R]=[...new Set([...e.value.checkedFieldsMapArrNum[R],Te])],e.value.checkedFieldsMapArrNum[R].length===1?e.value.checkedFieldsMapEndNum[R]="":e.value.checkedFieldsMapEndNum[R]=e.value.checkedFieldsMapArrNum[R].length===2?e.value.checkedFieldsMapArrNum[R].find(n=>n!==Te):Te),_.value===2&&(e.value.checkedFieldsMapArrNum[R]=[...new Set([...e.value.checkedFieldsMapArrNum[R],Te])],e.value.checkedFieldsMapEndNum[R]=Te,e.value.checkedFieldsMapArrNum[R].length===1?e.value.checkedFieldsMapStartNum[R]="":e.value.checkedFieldsMapStartNum[R]=e.value.checkedFieldsMapArrNum[R].length===2?e.value.checkedFieldsMapArrNum[R].find(n=>n!==Te):Te),e.value.displayType=e.value.checkedFieldsMapArrNum[R].length?"22":"2",x(R),va(),G.value=!1},x=n=>{e.value.parametersArr[n]=Be(a(se).filter(t=>t.componentId===n).map(t=>Object.values((t==null?void 0:t.fields)||{}).flat()).flat().filter(t=>[e.value.checkedFieldsMapEndNum[n],e.value.checkedFieldsMapStartNum[n]].filter(o=>!!o).includes(t.id)&&!!t.variableName))},te=n=>{if(e.value.parametersArr[n]=Be(a(se).filter(y=>y.componentId===n).map(y=>Object.values((y==null?void 0:y.fields)||{}).flat()).flat().filter(y=>[e.value.checkedFieldsMapEnd[n],e.value.checkedFieldsMapStart[n]].filter(k=>!!k).includes(y.id)&&!!y.variableName)),!e.value.parametersArr[n].length)return;const[t,o]=e.value.parametersArr[n][0].type;e.value.timeGranularityMultiple=_a[o||t]?`${_a[o||t]}range`:"",e.value.timeGranularity=_a[o||t]},de=(n,t)=>{_.value=t.id===e.value.checkedFieldsMapStartNum[n]?1:t.id===e.value.checkedFieldsMapEndNum[n]?2:0,R=n,Te=t.id,V.value=t.variableName,G.value=!0},ye=(n,t)=>{D.value=t.id===e.value.checkedFieldsMapStart[n]?1:t.id===e.value.checkedFieldsMapEnd[n]?2:0,R=n,Te=t.id,ee.value=t.variableName,Ze.value=!0},Be=n=>{const t=[];let o=n.map(y=>y.id);for(let y=0;y<n.length;y++){const k=n[y];o.includes(k.id)&&(t.push(k),o=o.filter(N=>N!==k.id))}return t},ca=n=>{const t=Object.values(e.value.checkedFieldsMap).filter(y=>!!y);e.value.parameters=Be(Object.values((n==null?void 0:n.fields)||{}).flat().filter(y=>t.includes(y.id)&&!!y.variableName).concat(e.value.parameters.filter(y=>t.includes(y.id)))),se.value.forEach(y=>{var k;y.id===n.id&&((k=e.value.checkedFields)!=null&&k.includes(y.componentId))&&!e.value.checkedFieldsMap[y.componentId]&&(y.activelist=n.activelist,e.value.checkedFieldsMap[y.componentId]=e.value.checkedFieldsMap[n.componentId])});const o=e.value.checkedFields.some(y=>e.value.checkedFieldsMapStart[y]||e.value.checkedFieldsMapEnd[y])&&+e.value.displayType==7;Se(()=>{if(ra.value&&!o){const y=e.value.parameters.find(k=>k.deType===1);e.value.timeGranularity=_a[y.type[1]||y.type[0]],e.value.displayType="1"}if(e.value.parameters.length&&(e.value.conditionType=0,e.value.optionValueSource===0&&(e.value.optionValueSource=1)),e.value.displayType==="22"){const y=e.value.checkedFields.some(N=>{var B;return(B=e.value.parameters)==null?void 0:B.some(Q=>[2,3].includes(Q.deType)&&e.value.checkedFieldsMap[N]===Q.id)});e.value.checkedFields.every(N=>{var B,Q;return!((Q=(B=e.value.checkedFieldsMapArr)==null?void 0:B[N])!=null&&Q.length)})&&y&&(e.value.displayType="2")}va()}),!o&&(ha(),e.value.displayType==="9"&&We())},ha=()=>{var n,t;if((n=e.value.checkedFields)!=null&&n.length){const[o]=e.value.checkedFields,y=se.value.find(B=>B.componentId===o),k=(t=e.value.checkedFieldsMap)==null?void 0:t[o],N=Object.values((y==null?void 0:y.fields)||{}).flat().find(B=>k===B.id);if((N==null?void 0:N.deType)!==void 0){let B=e.value.displayType;if(["22"].includes(e.value.displayType)&&[2,3].includes(N==null?void 0:N.deType)||["9"].includes(e.value.displayType))return;(N==null?void 0:N.deType)===1&&e.value.displayType==="7"||(e.value.displayType=`${[3,4].includes(N==null?void 0:N.deType)?2:N==null?void 0:N.deType}`),(N==null?void 0:N.deType)===7&&(e.value.displayType="0"),+B!=+e.value.displayType&&!([3,4].includes(+B)&&+e.value.displayType==2)&&va()}}e.value.checkedFields.some(o=>e.value.checkedFieldsMapStart[o]||e.value.checkedFieldsMapEnd[o])&&+e.value.displayType==1&&(e.value.displayType="7")},va=()=>{Pe(),Se(()=>{var n,t;e.value.field.id="",(t=(n=E.value)==null?void 0:n.displayTypeChange)==null||t.call(n),+e.value.displayType==7&&["yearrange","monthrange","daterange","datetimerange"].includes(e.value.timeGranularity)&&(e.value.timeGranularityMultiple=e.value.timeGranularity),e.value.displayType==="9"&&We()})},ra=U(()=>e.value.checkedFields.some(n=>{var t;return(t=e.value.parameters)==null?void 0:t.some(o=>o.deType===1&&!!o.variableName&&e.value.checkedFieldsMap[n]===o.id)})),ba=U(()=>{var n;return(n=e.value.parameters)==null?void 0:n.some(t=>[2,3].includes(t.deType)&&!!t.variableName)}),za=U(()=>e.value.checkedFields.some(n=>{var t;return((t=e.value.checkedFieldsMapArrNum[n])==null?void 0:t.length)>0})),Qa=U(()=>e.value.checkedFields.every(n=>{var t,o;return((o=(t=e.value.checkedFieldsMapArrNum)==null?void 0:t[n])==null?void 0:o.length)>0})?!1:e.value.checkedFields.some(n=>{var t;return(t=e.value.parameters)==null?void 0:t.some(o=>[2,3].includes(o.deType)&&e.value.checkedFieldsMap[n]===o.id)})),Ea=U(()=>e.value.checkedFields.some(n=>{var t;return((t=e.value.checkedFieldsMapArr[n])==null?void 0:t.length)>0})),Ha=U(()=>{const n=a(se).map(y=>Object.values((y==null?void 0:y.fields)||{}).flat()).flat(),t=Object.values(e.value.checkedFieldsMapArr||{}).flat(),o=n.find(y=>y.id===t[0]);return(o==null?void 0:o.type)||[]}),Da=[{label:l("dynamic_time.year"),value:"year"},{label:l("chart.y_M"),value:"month"},{label:l("chart.y_M_d"),value:"date"},{label:l("chart.y_M_d_H_m_s"),value:"datetime"}],_a={"DATETIME-YEAR":"year","YYYY-MM":"month","YYYY/MM":"month","YYYY-MM-DD":"date","YYYY/MM/DD":"date","YYYY-MM-DD HH:mm:ss":"datetime","YYYY/MM/DD HH:mm:ss":"datetime"},Za=U(()=>{var y;if(!ra.value)return Da;const[n,t]=(y=e.value.parameters)==null?void 0:y.filter(k=>k.deType===1&&!!k.variableName)[0].type;let o=!1;return Da.reduce((k,N)=>(N.value===(_a[t]||_a[n])?(o=!0,k.push(N)):o||k.push(N),k),[])}),Ka=()=>{Pe(),J.value=!1},Ja=()=>{ln({}).then(n=>{var o;const t=n||[];((o=t[0])==null?void 0:o.id)==="0"?Ra(ll(t[0].children)):Ra(ll(t))})},Ra=n=>{const t=d.get("TreeSort-dataset")||"time_desc";me.value=bn(n,t)};let sa="",Sa="";const at=n=>{var y,k,N;if(!((y=e.value.dataset)!=null&&y.id))return;let t=`${(k=e.value.dataset)==null?void 0:k.id}--${e.value.id}`,o=!1;for(let B in q){const[Q,Y]=q[B];(Q!=null&&Q.datasetId.includes(t)||Y!=null&&Y.datasetId.includes(t))&&(o=!0)}o&&(Sa=(N=e.value.dataset)==null?void 0:N.id,sa=n.id)},lt=()=>{e.value.dataset.id=sa,ut(`${Sa}--${e.value.id}`),sa="",Sa="",yl()},yl=()=>{if(sa&&Sa){e.value.dataset.id=Sa,At.confirm(l("v_query.to_modify_it"),{confirmButtonType:"primary",type:"warning",confirmButtonText:l("commons.confirm"),cancelButtonText:l("commons.cancel"),autofocus:!1,showClose:!1}).then(()=>{lt()});return}e.value.field.id="",e.value.displayId="",e.value.sortId="",Tl(e.value.dataset.id,e.value)},Xa=()=>{e.value.defaultValueCheck&&(e.value.defaultValue=e.value.multiple?[]:void 0,e.value.displayId||(e.value.displayId=e.value.field.id))},fl=()=>{if(e.value.defaultValue=e.value.multiple?[]:void 0,el(e.value.multiple),e.value.optionValueSource===1&&!e.value.dataset.id){let n="",t="";Object.keys(e.value.checkedFieldsMap).forEach(o=>{e.value.checkedFieldsMap[o]&&(t=o,n=e.value.checkedFieldsMap[o])}),se.value.forEach(o=>{o.componentId===t&&(e.value.dataset.id=o.id)}),e.value.displayId=n,e.value.sortId=n,e.value.field.id=n,Tl(e.value.dataset.id,e.value)}},el=(n,t=!1)=>{t&&(e.value.defaultValue=n?[]:void 0);const{defaultValue:o}=e.value;Array.isArray(o)?e.value.selectValue=n?o:void 0:e.value.selectValue=n?o!==void 0?[o]:[]:o,e.value.multiple=n},tt=(n,t,o)=>{const{intervalType:y,regularOrTrends:k,regularOrTrendsValue:N,relativeToCurrent:B,timeNum:Q,relativeToCurrentType:Y,around:Ce,dynamicWindow:fe,maximumSingleQuery:we,timeNumRange:Ke,relativeToCurrentTypeRange:_e,aroundRange:ta}=n.timeRange||{};let Ge=!1;const Me=n.timeGranularityMultiple.split("time").join("").split("range")[0],aa=Me==="date"?"day":Me;if(t&&fe&&(Ge=ke(t).add(we,aa).startOf(aa).valueOf()-1e3<o),y==="none")return fe?Ge:!1;let qe;if(B==="custom")qe=na(Y,Ce==="f"?"subtract":"add",Q);else switch(B){case"thisYear":qe=je("year");break;case"lastYear":qe=ya("year");break;case"thisMonth":qe=je("month");break;case"lastMonth":qe=ya("month");break;case"today":qe=je("day");break;case"yesterday":qe=ya("day");break;case"monthBeginning":qe=je("month");break;case"yearBeginning":qe=je("year");break}const ze=k==="fixed"?N:qe;if(y==="start")return t<+new Date(ze)||Ge;if(y==="end")return o>+new Date(ze)||Ge;if(y==="timeInterval"){const la=k==="fixed"?new Date(ke(new Date(N[0])).startOf(Me).format("YYYY/MM/DD HH:mm:ss")):na(Y,Ce==="f"?"subtract":"add",Q),ma=k==="fixed"?new Date(ke(new Date(N[1])).endOf(Me).format("YYYY/MM/DD HH:mm:ss")):na(_e,ta==="f"?"subtract":"add",Ke);return t<+new Date(la)-1e3||o>+new Date(ma)||Ge}},nt=Ut(()=>Bt(()=>import("./QueryCascade-0.0.0-dataease.js"),["./QueryCascade-0.0.0-dataease.js","./element-plus-secondary-0.0.0-dataease.js","./@vue-0.0.0-dataease.js","./@vueuse-0.0.0-dataease.js","./@element-plus-0.0.0-dataease.js","./lodash-es-0.0.0-dataease.js","./dayjs-0.0.0-dataease.js","./@amap-0.0.0-dataease.js","./async-validator-0.0.0-dataease.js","./@ctrl-0.0.0-dataease.js","./@popperjs-0.0.0-dataease.js","./escape-html-0.0.0-dataease.js","./normalize-wheel-es-0.0.0-dataease.js","./memoize-one-0.0.0-dataease.js","..\\css\\element-plus-secondary-0.0.0-dataease.css","./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js","./pinia-0.0.0-dataease.js","./vue-demi-0.0.0-dataease.js","./index-0.0.0-dataease.js","./mitt-0.0.0-dataease.js","./web-storage-cache-0.0.0-dataease.js","./vue-types-0.0.0-dataease.js","./is-plain-object-0.0.0-dataease.js","..\\css\\index-0.0.0-dataease.css","./jspdf-0.0.0-dataease.js","./@babel-0.0.0-dataease.js","./fflate-0.0.0-dataease.js","./vue-i18n-0.0.0-dataease.js","./@intlify-0.0.0-dataease.js","./axios-0.0.0-dataease.js","./qs-0.0.0-dataease.js","./side-channel-0.0.0-dataease.js","./es-errors-0.0.0-dataease.js","./object-inspect-0.0.0-dataease.js","./crypto-js-0.0.0-dataease.js","./side-channel-list-0.0.0-dataease.js","./side-channel-map-0.0.0-dataease.js","./get-intrinsic-0.0.0-dataease.js","./es-object-atoms-0.0.0-dataease.js","./math-intrinsics-0.0.0-dataease.js","./gopd-0.0.0-dataease.js","./es-define-property-0.0.0-dataease.js","./has-symbols-0.0.0-dataease.js","./get-proto-0.0.0-dataease.js","./dunder-proto-0.0.0-dataease.js","./call-bind-apply-helpers-0.0.0-dataease.js","./function-bind-0.0.0-dataease.js","./hasown-0.0.0-dataease.js","./call-bound-0.0.0-dataease.js","./side-channel-weakmap-0.0.0-dataease.js","./vue-router-0.0.0-dataease.js","./lodash-0.0.0-dataease.js","./vue-0.0.0-dataease.js","./echarts-0.0.0-dataease.js","./zrender-0.0.0-dataease.js","./tinymce-0.0.0-dataease.js","..\\css\\ConfigGlobal-0.0.0-dataease.css","./icon_info_colorful-0.0.0-dataease.js","./icon_add_outlined-0.0.0-dataease.js","./icon_delete-trash_outlined-0.0.0-dataease.js","./join-join-0.0.0-dataease.js","./util-0.0.0-dataease.js","./snowflake-id-0.0.0-dataease.js","./dataset-0.0.0-dataease.js","./_plugin-vue_export-helper-0.0.0-dataease.js","..\\css\\QueryCascade-0.0.0-dataease.css"],import.meta.url)),_l=ue(),it=()=>{const n=F.value.filter(t=>{var o;return[0,2,5].includes(+t.displayType)&&t.optionValueSource===1&&!!((o=t.checkedFields)!=null&&o.length)&&!!Object.values(t.checkedFieldsMap).filter(y=>!!y).length}).reduce((t,o)=>{var y,k,N;return t[o.id]={datasetId:o.dataset.id,name:o.name,queryId:o.id,fieldId:o.field.id,deType:(N=(((k=(y=ne[o.dataset.id])==null?void 0:y.fields)==null?void 0:k.dimensionList)||o.dataset.fields).find(B=>B.id===o.field.id))==null?void 0:N.deType},t},{});_l.value.init(n,q)},ut=n=>{for(let t in q){const[o,y]=q[t];o!=null&&o.datasetId.includes(n)?q[t]=[]:y!=null&&y.datasetId.includes(n)&&(q[t]=[o])}q=q.filter(t=>!!t.length)},rt=[l("visualization.number1"),l("visualization.number2"),l("visualization.number3"),l("visualization.number4"),l("visualization.number5")],st=({defaultConditionValueF:n,defaultConditionValueS:t,conditionType:o})=>o===0?n==="":n===""||t==="",hl=n=>{const{defaultConditionValueOperatorF:t,defaultConditionValueF:o,defaultConditionValueOperatorS:y,defaultConditionValueS:k}=n;n.conditionValueOperatorF=t,n.conditionValueF=o,n.conditionValueOperatorS=y,n.conditionValueS=k},ot=()=>F.value.some(n=>{var k,N,B;if(n.auto)return!1;if(!((k=n.checkedFields)!=null&&k.length)||n.checkedFields.some(Q=>!n.checkedFieldsMap[Q]))return De.error(l("v_query.be_linked_first")),!0;if(n.displayType==="22"&&n.defaultValueCheck){if(n.numValueEnd=n.defaultNumValueEnd,n.numValueStart=n.defaultNumValueStart,n.defaultNumValueEnd!==0&&!n.defaultNumValueEnd||n.defaultNumValueStart!==0&&!n.defaultNumValueStart)return De.error(l("v_query.cannot_be_empty_de")),!0;if(!isNaN(n.defaultNumValueEnd)&&!isNaN(n.defaultNumValueStart)&&n.defaultNumValueEnd<n.defaultNumValueStart)return De.error(l("v_query.the_minimum_value")),!0}let t=null,o=l("v_query.cannot_be_performed"),y=0;if(n.checkedFields.some(Q=>{var we,Ke,_e,ta,Ge,Me,aa,qe,ze,la,ma,c,O;if((Ke=(we=n.checkedFieldsMapArrNum)==null?void 0:we[Q])!=null&&Ke.length&&(y===0&&(y=1),y===2)||!((ta=(_e=n.checkedFieldsMapArrNum)==null?void 0:_e[Q])!=null&&ta.length)&&["22"].includes(n.displayType)&&n.parameters.length&&(y===0&&(y=2),y===1))return!0;if(((Me=(Ge=n.checkedFieldsMapArrNum)==null?void 0:Ge[Q])==null?void 0:Me.length)===1&&n.displayType==="22")return o=l("v_query.numerical_parameter_configuration"),!0;if(((qe=(aa=n.checkedFieldsMapArr)==null?void 0:aa[Q])==null?void 0:qe.length)===1&&n.displayType==="7")return o=l("v_query.and_end_time"),!0;const Y=se.value.find(Oe=>Oe.componentId===Q),Ce=(ze=n.checkedFieldsMap)==null?void 0:ze[Q],fe=Be(Object.values((Y==null?void 0:Y.fields)||{}).flat()).find(Oe=>Ce===Oe.id);if(!fe)return!1;if(t===null)return t=fe,!1;if((t==null?void 0:t.deType)===(fe==null?void 0:fe.deType)&&(t==null?void 0:t.deType)===1){if(!Array.isArray(fe.type)||!Array.isArray(t.type)||!((la=t.type)!=null&&la.length)&&!((ma=fe.type)!=null&&ma.length))return!1;if(((c=t.type)==null?void 0:c.length)!==((O=fe.type)==null?void 0:O.length))return o=l("v_query.format_is_inconsistent"),!0;for(let Oe=0;Oe<t.type.length;Oe++)if(t.type[Oe]!==fe.type[Oe])return o=l("v_query.format_is_inconsistent"),!0}return t.deType!==(fe==null?void 0:fe.deType)}))return De.error(o),!0;if(n.required){if(n.displayType==="8"){hl(n);const Q=st(n);return Q&&De.error(l("v_query.cannot_be_empty_de")),Q}if(!n.defaultValueCheck)return De.error(l("v_query.cannot_be_empty_de")),!0;if(n.displayType==="22")return n.defaultNumValueEnd!==0&&!n.defaultNumValueEnd||n.defaultNumValueStart!==0&&!n.defaultNumValueStart?(De.error(l("v_query.cannot_be_empty_de")),!0):!1;if(Array.isArray(n.defaultValue)&&!n.defaultValue.length||n.defaultValue!==0&&!n.defaultValue)return De.error(l("v_query.cannot_be_empty_de")),!0}if(n.displayType==="8")return hl(n),!1;if(!n.defaultValueCheck){const Q=+n.displayType==7||n.multiple;n.selectValue=Q?[]:void 0,n.defaultValue=Q?[]:void 0}if(n.displayType==="1"){if(!n.defaultValueCheck)return!1;if(n.timeType==="fixed"&&!n.defaultValue)return De.error(l("v_query.cannot_be_empty_time")),!0}if(+n.displayType==7){if(!n.defaultValueCheck)return!1;if(n.timeType==="fixed"){const[ma,c]=n.defaultValue||[];if(!ma||!c)return De.error(l("v_query.cannot_be_empty_time")),!0}const{timeNum:Q,relativeToCurrentType:Y,around:Ce,relativeToCurrentRange:fe,timeGranularityMultiple:we,arbitraryTime:Ke,timeGranularity:_e,timeNumRange:ta,relativeToCurrentTypeRange:Ge,aroundRange:Me,arbitraryTimeRange:aa,timeType:qe}=n;let ze=qe==="dynamic"?Fa(Q,Y,_e,Ce,Ke,we,"start-config"):new Date(n.defaultValue[0]),la=qe==="dynamic"?Fa(ta,Ge,_e,Me,aa,we,"end-config"):new Date(n.defaultValue[1]);return fe&&fe!=="custom"&&([ze,la]=pl(fe)),+ze>+la?(De.error(l("v_query.the_start_time")),!0):n.setTimeRange&&tt(n,we.includes("time")?ke(+ze).startOf("day").valueOf():+ze,we.includes("time")?ke(+la).startOf("day").valueOf():+la)?(De.error(l("v_query.range_please_reset")),!0):!1}if([1].includes(+n.displayType))return!1;if(n.displayType!=="9"&&n.optionValueSource===2&&!((N=n.valueSource)!=null&&N.filter(Q=>!!Q).length))return De.error(l("v_query.cannot_be_empty_input")),!0;if(!["9","22"].includes(n.displayType)&&n.optionValueSource===1&&!n.field.id)return De.error((B=n.dataset)!=null&&B.id?l("v_query.the_data_set"):l("v_query.option_value_field")),!0}),dt=()=>{var n,t;(n=E.value)==null||n.mult(),(t=E.value)==null||t.single(),Pe(),J.value=!1},ct=u,vt=()=>{var n,t;ot()||((n=E.value)==null||n.mult(),(t=E.value)==null||t.single(),Pe(),J.value=!1,F.value.forEach(o=>{e.value=o,el(["1","7"].includes(e.value.displayType)?e.value.displayType==="7":e.value.multiple)}),Ye.value.propValue=[],Se(()=>{F.value.forEach(o=>{q.forEach(y=>{y.forEach(k=>{if(k.datasetId.split("--")[1]===o.id&&o.defaultValueCheck){const N=o.mapValue;k.selectValue=Array.isArray(N)?[...N]:N,k.currentSelectValue=Array.isArray(N)?[...N]:N}})})}),Ye.value.cascade=Re(q),q=[],Ye.value.propValue=Re(F.value),X.recordSnapshotCache("confirmClick"),Se(()=>{ct("queryData")})}))},mt=U(()=>e.value.dataset.fields.filter(n=>n.deType===+e.value.displayType||[0,2,3,4].includes(n.deType)&&[0,2].includes(+e.value.displayType)||n.deType===7&&+e.value.displayType==0)),gl=()=>{m.value=Re(e.value.valueSource),m.value.length||m.value.push(""),Ve.value.hide()},pt=()=>{if(m.value.some(n=>typeof n=="string"?!n.trim():!1)){De.error(l("v_query.cannot_be_empty_input"));return}e.value.valueSource=Re(m.value.filter(n=>typeof n=="string"?n.trim():!0)),fl(),gl()},yt=n=>{F.value=Re(M.queryElement.propValue)||[],Vl(n)},ft=()=>{F.value=Re(M.queryElement.propValue)||[],tl(),Vl(F.value[F.value.length-1].id)},bl=(n,t)=>{let o="dimensionList";return n.some((y,k)=>(y||[]).some(N=>N.id===t)?(o=["dimensionList","quotaList","parameterList"][k],!0):!1),o},Vl=n=>{Ja(),re.value=[],al({id:n}),q=Re(Ye.value.cascade||[]),J.value=!0;const t=W.value.map(k=>k.tableId);for(const k in ne)t.includes(k)||delete ne[k];const o=Object.keys(ne);t.every(k=>o.includes(k))&&(se.value=W.value.map(k=>ne[k.tableId]?{...ne[k.tableId],componentId:k.id}:null).filter(k=>!!k));const y=[...new Set(W.value.map(k=>k.tableId).filter(k=>!!k))];y.length&&Promise.all([en(y),an(y)]).then(([k,N])=>{k.filter(B=>!!B).forEach(B=>{B.activelist="dimensionList",B.fields.parameterList=N.filter(Q=>{var Y;return Q.datasetGroupId===B.id&&!((Y=Q.params)!=null&&Y.length)}),B.hasParameter=!!B.fields.parameterList.length,B.fields.dimensionList=(B.fields.dimensionList||[]).filter(Q=>{var Y;return!((Y=Q.params)!=null&&Y.length)}),B.fields.quotaList=(B.fields.quotaList||[]).filter(Q=>{var Y;return!((Y=Q.params)!=null&&Y.length)}),ne[B.id]=B}),se.value=W.value.map(B=>{if(!ne[B.tableId])return null;const Q=ne[B.tableId].fields||{},Y=bl([Q.dimensionList,Q.quotaList,Q.parameterList],e.value.checkedFieldsMap[B.id]);return{...ne[B.tableId],componentId:B.id,activelist:Y}}).filter(B=>!!B)}).finally(()=>{ea(e.value.checkedFields)})},kl=()=>{m.value=Array.from(new Set(m.value))},_t=()=>{Object.entries({timeType:"fixed",hideConditionSwitching:!1,required:!1,defaultMapValue:[],mapValue:[],parametersStart:null,conditionType:0,conditionValueOperatorF:"eq",conditionValueF:"",conditionValueOperatorS:"like",conditionValueS:"",resultMode:0,defaultConditionValueOperatorF:"eq",defaultConditionValueF:"",defaultConditionValueOperatorS:"like",defaultConditionValueS:"",parametersEnd:null,relativeToCurrent:"custom",timeNum:0,relativeToCurrentRange:"custom",relativeToCurrentType:"year",around:"f",arbitraryTime:new Date,timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f",displayId:"",sortId:"",sort:"asc",arbitraryTimeRange:new Date,setTimeRange:!1,showEmpty:!1,defaultNumValueStart:null,defaultNumValueEnd:null,numValueEnd:null,numValueStart:null,timeRange:{intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"},treeFieldList:[]}).forEach(([t,o])=>{e.value[t]??(e.value[t]=o)}),e.value.timeRange.relativeToCurrentRange||(e.value.timeRange.relativeToCurrentRange="custom")},al=n=>{var y;if(Pe(),h.id)return;P.value=n.id;const t=F.value.find(k=>k.id===n.id);t.checkedFieldsMapArr||(t.checkedFieldsMapArr={},t.checkedFieldsMapArrNum={},t.checkedFieldsMapStart={},t.checkedFieldsMapStartNum={},t.checkedFieldsMapEnd={},t.checkedFieldsMapEndNum={},t.parametersArr={}),e.value=t,e.value.dataset.fields=[],Se(()=>{E.value.changeMultiple(e.value.multiple)}),e.value.dataset.id&&Ol(e.value.dataset.id).then(k=>{e.value.dataset.fields=k.data}),e.value.checkedFieldsMapStart||(e.value.checkedFieldsMapStart={}),e.value.checkedFieldsMapStartNum||(e.value.checkedFieldsMapStartNum={}),e.value.checkedFieldsMapEnd||(e.value.checkedFieldsMapEnd={}),e.value.checkedFieldsMapEndNum||(e.value.checkedFieldsMapEndNum={}),e.value.checkedFieldsMapArr||(e.value.checkedFieldsMapArr={}),e.value.checkedFieldsMapArrNum||(e.value.checkedFieldsMapArrNum={}),e.value.parametersArr||(e.value.parametersArr={}),W.value.forEach(k=>{e.value.checkedFieldsMap[k.id]||(e.value.checkedFieldsMap[k.id]=""),e.value.checkedFieldsMapStart[k.id]||(e.value.checkedFieldsMapStart[k.id]=""),e.value.checkedFieldsMapStartNum[k.id]||(e.value.checkedFieldsMapStartNum[k.id]=""),e.value.checkedFieldsMapEnd[k.id]||(e.value.checkedFieldsMapEnd[k.id]=""),e.value.checkedFieldsMapEndNum[k.id]||(e.value.checkedFieldsMapEndNum[k.id]=""),e.value.checkedFieldsMapArr[k.id]||(e.value.checkedFieldsMapArr[k.id]=[]),e.value.checkedFieldsMapArrNum[k.id]||(e.value.checkedFieldsMapArrNum[k.id]=[]),e.value.parametersArr[k.id]||(e.value.parametersArr[k.id]=[])});const o=W.value.map(k=>k.id);e.value.checkedFields=e.value.checkedFields.filter(k=>o.includes(k)),(y=se.value)!=null&&y.length&&(se.value.forEach(k=>{const N=k.fields;k.activelist=bl([N.dimensionList,N.quotaList,N.parameterList],e.value.checkedFieldsMap[k.componentId])}),ea(e.value.checkedFields)),el(e.value.multiple),m.value=Re(e.value.valueSource),m.value.length||m.value.push(""),_t(),Se(()=>{e.value.showError=wl.value,e.value.auto&&(document.querySelector(".chart-field").scrollTop=0)})},Tl=(n,t)=>{Ol(n).then(o=>{t.dataset.fields=o.data})},ht=()=>{Xa(),e.value.sortList=[],Cl()},Cl=()=>{La.value&&(e.value.sort="")},Ml=ue(),gt=n=>{e.value.sortList=Re(n)},bt=async()=>{if(La.value||e.value.sort!=="customSort")return;let n=Re(e.value.sortList||[]);n.length||(n=(await jl({queryId:e.value.sortId,searchText:""})).map(o=>o[e.value.sortId])),Ml.value.sortInit([...new Set(n)])},La=U(()=>{const{sortId:n,displayId:t}=e.value;return n&&t&&n!==t}),Sl=ue(),Fl=()=>{var o;const[n]=e.value.checkedFields,t=se.value.find(y=>y.componentId===n);Sl.value.init((o=t==null?void 0:t.fields)==null?void 0:o.dimensionList.filter(y=>y.deType===+e.value.field.deType),e.value.treeFieldList)},Vt=n=>{e.value.treeFieldList=n},wl=U(()=>{if(!e.value)return!1;const{optionValueSource:n,checkedFieldsMap:t,checkedFields:o,field:y,valueSource:k,displayType:N}=e.value,B=o.filter(Q=>!!t[Q]);if(!o.length||!B.length)return!0;if([1,7,8,22].includes(+N))return!1;if(N==="9"){let Q=null;return o.some(Y=>{const Ce=(se.value||[]).find(we=>we.componentId===Y),fe=Ce==null?void 0:Ce.id;return fe?Q===null?(Q=fe,!1):Q!==fe:!1})}return n===1&&!y.id||n===2&&!k.length}),Pe=()=>{var n;(n=E.value)==null||n.handleDialogClick()},kt=U(()=>{let n=[];if(!e.value)return n;switch(e.value.timeGranularity){case"year":n=[{label:l("dynamic_year.current"),value:"thisYear"},{label:l("dynamic_year.last"),value:"lastYear"}];break;case"month":n=[{label:l("cron.this_month"),value:"thisMonth"},{label:l("dynamic_month.last"),value:"lastMonth"}];break;case"date":n=[{label:l("dynamic_time.today"),value:"today"},{label:l("dynamic_time.yesterday"),value:"yesterday"},{label:l("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:l("dynamic_time.endOfMonth"),value:"monthEnd"},{label:l("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetime":n=[{label:l("dynamic_time.today"),value:"today"},{label:l("dynamic_time.yesterday"),value:"yesterday"},{label:l("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:l("dynamic_time.endOfMonth"),value:"monthEnd"},{label:l("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...n,{label:l("dynamic_time.custom"),value:"custom"}]}),Tt=U(()=>{let n=[];if(!e.value)return n;switch(e.value.timeGranularityMultiple){case"yearrange":n=[{label:l("dynamic_year.current"),value:"thisYear"},{label:l("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":n=[{label:l("cron.this_month"),value:"thisMonth"},{label:l("dynamic_month.last"),value:"lastMonth"},{label:l("v_query.last_3_months"),value:"LastThreeMonths"},{label:l("v_query.last_6_months"),value:"LastSixMonths"},{label:l("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"daterange":case"datetimerange":n=[{label:l("dynamic_time.today"),value:"today"},{label:l("dynamic_time.yesterday"),value:"yesterday"},{label:l("v_query.last_3_days"),value:"LastThreeDays"},{label:l("v_query.month_to_date"),value:"monthBeginning"},{label:l("v_query.year_to_date"),value:"yearBeginning"}];break}return[...n,{label:l("dynamic_time.custom"),value:"custom"}]}),ql=n=>{var t;e.value.relativeToCurrentType=["date","datetime"].includes(n)?"date":n,e.value.relativeToCurrent!=="custom"&&(e.value.relativeToCurrent=(t=kt.value[0])==null?void 0:t.value)},Ct=()=>{e.value.displayType==="1"?ql(e.value.timeGranularity):$l(e.value.timeGranularityMultiple)},$l=n=>{var t;Pe(),e.value.relativeToCurrentType=["daterange","datetimerange"].includes(n)?"date":n.split("range")[0],e.value.relativeToCurrentTypeRange=e.value.relativeToCurrentType,e.value.relativeToCurrentRange!=="custom"&&(e.value.relativeToCurrentRange=(t=Tt.value[0])==null?void 0:t.value),e.value.timeRange={intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",regularOrTrendsValue:"",relativeToCurrent:"custom",relativeToCurrentRange:"custom",timeNum:0,relativeToCurrentType:e.value.relativeToCurrentRange,around:"f",timeNumRange:0,relativeToCurrentTypeRange:e.value.relativeToCurrentRange,aroundRange:"f"}};he(()=>wl.value,n=>{e.value.showError=n});const Mt=n=>{re.value.push(n)},Al=(n,t,o)=>{switch(n){case"del":re.value=[],F.value.splice(o,1),e.value=null;break;case"rename":re.value=[],Object.assign(h,t),setTimeout(()=>{Se(()=>{re.value[0].focus()})},400);break}},St={label:"name",children:"children",value:"id",isLeaf:n=>{var t;return!((t=n.children)!=null&&t.length)}},ll=n=>n.filter(t=>{var o,y;return(o=t.children)!=null&&o.length&&!t.leaf?(t.children=ll(t.children),!!((y=t.children)!=null&&y.length)):t.leaf}),Ft=()=>{var n;if(h.name.trim()===""){De.error(l("v_query.cannot_be_empty_name")),(n=re.value[0])==null||n.focus();return}F.value.some(t=>h.id===t.id?(t.name=h.name,!0):!1),h.id=""},tl=()=>{F.value.push(Nn())},wt=()=>{tl(),al(F.value[F.value.length-1])};return C({setCondition:yt,addCriteriaConfig:()=>(tl(),F.value[F.value.length-1].id),setConditionOut:ft}),(n,t)=>{const o=Ta,y=ul,k=Ta,N=jt,B=ol,Q=dl,Y=$a,Ce=Aa,fe=sl,we=Nt,Ke=Ot,_e=Ma,ta=It,Ge=Et,Me=wa,aa=Rl,qe=Ll,ze=rl,la=Dt,ma=Rt;return s(),b(ae,null,[i(ze,{class:"query-condition-configuration",modelValue:J.value,"onUpdate:modelValue":t[20]||(t[20]=c=>J.value=c),width:"1200px",title:a(l)("v_query.query_condition_setting"),onClick:t[21]||(t[21]=Ie(()=>{},["stop"])),"before-close":dt,onMousedown:t[22]||(t[22]=Ie(()=>{},["stop"])),onMousedup:t[23]||(t[23]=Ie(()=>{},["stop"]))},{footer:r(()=>[v("div",Yr,[i(Me,{class:"query-cascade",onClick:it},{default:r(()=>[Z(g(a(l)("v_query.component_cascade_configuration")),1)]),_:1}),i(Me,{onClick:Ka},{default:r(()=>[Z(g(a(l)("chart.cancel")),1)]),_:1}),i(Me,{onClick:vt,type:"primary"},{default:r(()=>[Z(g(a(l)("chart.confirm")),1)]),_:1})])]),default:r(()=>[v("div",{class:"container",onClick:Pe},[v("div",Tu,[v("div",Cu,[Z(g(a(l)("v_query.query_condition"))+" ",1),i(y,{onClick:wt},{default:r(()=>[i(o,{name:"icon_add_outlined"},{default:r(()=>[i(a(Ba),{class:"svg-icon"})]),_:1})]),_:1})]),i(a(Wl),{tag:"div",list:F.value,handle:".handle"},{item:r(({element:c,index:O})=>[(s(),b("div",{key:c.id,onDblclick:Ie(Oe=>Al("rename",c,O),["stop"]),onClick:Ie(Oe=>al(c),["stop"]),class:be(["list-item_primary",c.id===P.value&&"active"])},[i(y,{class:"handle"},{default:r(()=>[i(o,{name:"icon_drag_outlined"},{default:r(()=>[i(a(Pt),{class:"svg-icon"})]),_:1})]),_:1}),v("div",{class:"label flex-align-center icon",title:c.name},[!c.auto&&c.showError?(s(),I(y,{key:0,style:{"font-size":"16px",color:"#f54a45"}},{default:r(()=>[i(k,{name:"icon_warning_filled"},{default:r(()=>[i(a(Zt),{class:"svg-icon"})]),_:1})]),_:1})):j("",!0),Z(" "+g(c.name),1)],8,Su),v("div",Fu,[i(N,{onHandleCommand:Oe=>Al(Oe,c,O),"menu-list":ua,"icon-name":a(Wt),placement:"bottom-end"},null,8,["onHandleCommand","icon-name"]),c.visible?(s(),I(y,{key:0,class:"hover-icon",onClick:Ie(Oe=>c.visible=!c.visible,["stop"])},{default:r(()=>[i(o,{name:"icon_visible_outlined"},{default:r(()=>[i(a(zt),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])):(s(),I(y,{key:1,class:"hover-icon",onClick:Ie(Oe=>c.visible=!c.visible,["stop"])},{default:r(()=>[i(o,{name:"de_pwd_invisible"},{default:r(()=>[i(a(Tn),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"]))]),h.id===c.id?(s(),b("div",{key:0,onClick:t[1]||(t[1]=Ie(()=>{},["stop"])),class:"rename"},[i(B,{onBlur:Ft,ref:Mt,modelValue:h.name,"onUpdate:modelValue":t[0]||(t[0]=Oe=>h.name=Oe)},null,8,["modelValue"])])):j("",!0)],42,Mu))]),_:1},8,["list"])]),e.value?(s(),b("div",{key:0,class:be(["chart-field",e.value.auto&&"hidden"])},[i(Ge,null,{default:r(()=>[e.value.auto?(s(),b("div",wu)):j("",!0),v("div",qu,[Z(g(a(l)("v_query.chart_and_field"))+" ",1),i(Ce,{class:"ml-4 larger-radio",modelValue:e.value.auto,"onUpdate:modelValue":t[2]||(t[2]=c=>e.value.auto=c)},{default:r(()=>[i(Y,{disabled:!e.value.auto,label:!0},{default:r(()=>[v("div",$u,[Z(g(a(l)("chart.margin_model_auto"))+" ",1),i(Q,{effect:"dark",placement:"top"},{content:r(()=>[v("div",null,[Z(g(a(l)("v_query.be_switched_to"))+" ",1),t[30]||(t[30]=v("br",null,null,-1)),Z(" "+g(a(l)("v_query.to_automatic_again")),1)])]),default:r(()=>[i(y,{style:{"margin-left":"4px",color:"#646a73"}},{default:r(()=>[i(k,{name:"icon_info_outlined"},{default:r(()=>[i(a(Kt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})])]),_:1},8,["disabled"]),i(Y,{label:!1},{default:r(()=>[Z(g(a(l)("commons.custom")),1)]),_:1})]),_:1},8,["modelValue"])]),v("div",Au,[i(fe,{modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=c=>$.value=c),indeterminate:A.value,onChange:Ue},{default:r(()=>[Z(g(a(l)("dataset.check_all")),1)]),_:1},8,["modelValue","indeterminate"])]),v("div",Nu,[i(ta,{modelValue:e.value.checkedFields,"onUpdate:modelValue":t[4]||(t[4]=c=>e.value.checkedFields=c),onChange:da},{default:r(()=>[(s(!0),b(ae,null,ce(se.value,c=>(s(),b("div",{key:c.componentId,class:"list-item_field_de"},[i(fe,{label:c.componentId},{default:r(()=>[i(y,{class:"component-type"},{default:r(()=>[i(o,null,{default:r(()=>[(s(),I(Le(a(gn)[a(S)[c.componentId].type])))]),_:2},1024)]),_:2},1024),v("span",{title:a(S)[c.componentId].title,class:"checkbox-name ellipsis"},g(a(S)[c.componentId].title),9,Ou)]),_:2},1032,["label"]),v("span",{title:c.name,class:"dataset ellipsis"},g(c.name),9,Iu),e.value.checkedFields.includes(c.componentId)&&e.value.checkedFieldsMapArr&&e.value.checkedFieldsMapArr[c.componentId]&&e.value.checkedFieldsMapArr[c.componentId].length?(s(),I(a($e),{onChange:O=>pe(O,c.componentId),onFocus:Pe,multiple:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"",key:"checkedFieldsMapArrTime","multiple-limit":2,class:"field-select--input",style:{"margin-left":"12px"},"popper-class":"field-select--dqp",modelValue:e.value.checkedFieldsMapArr[c.componentId],"onUpdate:modelValue":O=>e.value.checkedFieldsMapArr[c.componentId]=O,clearable:""},Va({header:r(()=>[i(Ke,{stretch:"",class:"params-select--header",modelValue:c.activelist,"onUpdate:modelValue":O=>c.activelist=O},{default:r(()=>[i(we,{disabled:"",label:a(l)("chart.dimension"),name:"dimensionList"},null,8,["label"]),i(we,{disabled:"",label:a(l)("chart.quota"),name:"quotaList"},null,8,["label"]),i(we,{label:a(l)("dataset.param"),name:"parameterList"},null,8,["label"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),default:r(()=>[(s(!0),b(ae,null,ce(c.fields[c.activelist],O=>(s(),I(_e,{key:O.id,label:O.name||O.variableName,value:O.id,disabled:H(O)},{default:r(()=>[v("div",Eu,[i(y,null,{default:r(()=>[i(o,{className:`field-icon-${a(ge)[O.deType]}`},{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[O.deType]]),{class:be(["svg-icon",`field-icon-${a(ge)[O.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),v("span",{title:O.name||O.variableName,class:"ellipsis"},g(O.name||O.variableName),9,Du),e.value.checkedFieldsMapArr[c.componentId].includes(O.id)&&c.activelist==="parameterList"?(s(),b("span",{key:0,onClick:Ie(Oe=>ye(c.componentId,O),["stop"]),class:"range-time_setting"},[Z(g(e.value.checkedFieldsMapStart[c.componentId]===O.id?a(l)("dataset.start_time"):e.value.checkedFieldsMapEnd[c.componentId]===O.id?a(l)("dataset.end_time"):"")+" ",1),i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[i(a(ka),{class:"svg-icon"})]),_:1})]),_:1})],8,Ru)):j("",!0)])]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.checkedFieldsMap[c.componentId]?{name:"prefix",fn:r(()=>[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[Fe(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]]),{class:be(`field-icon-${a(ge)[Fe(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]}`)},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["onChange","modelValue","onUpdate:modelValue"])):e.value.checkedFields.includes(c.componentId)&&e.value.checkedFieldsMapArrNum&&e.value.checkedFieldsMapArrNum[c.componentId]&&e.value.checkedFieldsMapArrNum[c.componentId].length?(s(),I(a($e),{onChange:O=>le(O,c.componentId),onFocus:Pe,multiple:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"",key:"checkedFieldsMapArr","multiple-limit":2,class:"field-select--input",style:{"margin-left":"12px"},"popper-class":"field-select--dqp",modelValue:e.value.checkedFieldsMapArrNum[c.componentId],"onUpdate:modelValue":O=>e.value.checkedFieldsMapArrNum[c.componentId]=O,clearable:""},Va({header:r(()=>[i(Ke,{stretch:"",class:"params-select--header",modelValue:c.activelist,"onUpdate:modelValue":O=>c.activelist=O},{default:r(()=>[i(we,{disabled:"",label:a(l)("chart.dimension"),name:"dimensionList"},null,8,["label"]),i(we,{disabled:"",label:a(l)("chart.quota"),name:"quotaList"},null,8,["label"]),i(we,{label:a(l)("dataset.param"),name:"parameterList"},null,8,["label"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),default:r(()=>[(s(!0),b(ae,null,ce(c.fields[c.activelist],O=>(s(),I(_e,{key:O.id,label:O.name||O.variableName,value:O.id,disabled:![2,3].includes(O.deType)},{default:r(()=>[v("div",Lu,[i(y,null,{default:r(()=>[i(o,{className:`field-icon-${a(ge)[O.deType]}`},{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[O.deType]]),{class:be(["svg-icon",`field-icon-${a(ge)[O.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),v("span",{title:O.name||O.variableName,class:"ellipsis"},g(O.name||O.variableName),9,xu),e.value.checkedFieldsMapArrNum[c.componentId].includes(O.id)&&c.activelist==="parameterList"?(s(),b("span",{key:0,onClick:Ie(Oe=>de(c.componentId,O),["stop"]),class:"range-time_setting"},[Z(g(e.value.checkedFieldsMapStartNum[c.componentId]===O.id?a(l)("chart.min"):e.value.checkedFieldsMapEndNum[c.componentId]===O.id?a(l)("chart.max"):"")+" ",1),i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[i(a(ka),{class:"svg-icon"})]),_:1})]),_:1})],8,Uu)):j("",!0)])]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.checkedFieldsMap[c.componentId]?{name:"prefix",fn:r(()=>[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[Fe(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]]),{class:be(`field-icon-${a(ge)[Fe(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]}`)},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["onChange","modelValue","onUpdate:modelValue"])):e.value.checkedFields.includes(c.componentId)?(s(),I(a($e),{key:2,onChange:O=>ca(c),onFocus:Pe,filterable:"",style:{"margin-left":"12px"},"popper-class":"field-select--dqp",modelValue:e.value.checkedFieldsMap[c.componentId],"onUpdate:modelValue":O=>e.value.checkedFieldsMap[c.componentId]=O,clearable:""},Va({header:r(()=>[i(Ke,{stretch:"",class:"params-select--header",modelValue:c.activelist,"onUpdate:modelValue":O=>c.activelist=O},{default:r(()=>[i(we,{label:a(l)("chart.dimension"),name:"dimensionList"},null,8,["label"]),i(we,{disabled:e.value.displayType==="9",label:a(l)("chart.quota"),name:"quotaList"},null,8,["disabled","label"]),c.hasParameter?(s(),I(we,{key:0,label:a(l)("dataset.param"),disabled:e.value.displayType==="9",name:"parameterList"},null,8,["label","disabled"])):j("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),default:r(()=>[(s(!0),b(ae,null,ce(c.fields[c.activelist],O=>(s(),I(_e,{key:O.id,label:O.name||O.variableName,value:O.id,disabled:O.desensitized||e.value.displayType==="9"&&O.deType===1||H(O)},{default:r(()=>[v("div",{class:"flex-align-center icon",title:O.desensitized?a(l)("v_query.as_query_conditions"):""},[i(y,null,{default:r(()=>[i(o,{className:`field-icon-${a(ge)[O.deType]}`},{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[O.deType]]),{class:be(["svg-icon",`field-icon-${a(ge)[O.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),v("span",{title:O.name||O.variableName,class:"ellipsis"},g(O.name||O.variableName),9,Yu),e.value.checkedFieldsMap[c.componentId]===O.id&&c.activelist==="parameterList"&&(ra.value||ba.value)?(s(),b("span",{key:0,onClick:Ie(()=>ba.value?de(c.componentId,O):ye(c.componentId,O),["stop"]),class:"range-time_setting"},[Z(g(ba.value?a(l)("chart.value_formatter_value"):a(l)("dataset.time"))+" ",1),i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[i(a(ka),{class:"svg-icon"})]),_:1})]),_:1})],8,Bu)):j("",!0)],8,Gu)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.checkedFieldsMap[c.componentId]?{name:"prefix",fn:r(()=>[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[Fe(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]]),{class:be(`field-icon-${a(ge)[Fe(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]}`)},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["onChange","modelValue","onUpdate:modelValue"])):(s(),b("span",ju))]))),128))]),_:1},8,["modelValue"])])]),_:1})],2)):j("",!0),e.value?(s(),b("div",{key:1,class:be(["condition-configuration",e.value.auto&&"condition-configuration_hide"])},[i(Ge,null,{default:r(()=>[e.value.auto?(s(),b("div",Wu)):j("",!0),v("div",Pu,[Z(g(a(l)("v_query.query_condition_configuration"))+" ",1),i(fe,{disabled:e.value.auto,modelValue:e.value.required,"onUpdate:modelValue":t[5]||(t[5]=c=>e.value.required=c),label:a(l)("v_query.required_items")},null,8,["disabled","modelValue","label"])]),Ca(v("div",zu,[v("div",Qu,[v("div",Hu,g(a(l)("v_query.display_type")),1),v("div",Zu,[i(a($e),{onFocus:Pe,onChange:va,modelValue:e.value.displayType,"onUpdate:modelValue":t[6]||(t[6]=c=>e.value.displayType=c)},{default:r(()=>[i(_e,{disabled:!["0","8","9"].includes(e.value.displayType),label:a(l)("v_query.text_drop_down"),value:"0"},null,8,["disabled","label"]),i(_e,{disabled:!["0","8","9"].includes(e.value.displayType),label:a(l)("v_query.text_search"),value:"8"},null,8,["disabled","label"]),i(_e,{disabled:!["0","8","9"].includes(e.value.displayType)||!!e.value.parameters.length,label:a(l)("v_query.drop_down_tree"),value:"9"},null,8,["disabled","label"]),["2","22"].includes(e.value.displayType)?(s(),b(ae,{key:0},[i(_e,{disabled:!["2","22"].includes(e.value.displayType)||za.value,label:a(l)("v_query.number_drop_down"),value:"2"},null,8,["disabled","label"]),i(_e,{disabled:!["2","22"].includes(e.value.displayType)||Qa.value,label:a(l)("v_query.number_range"),value:"22"},null,8,["disabled","label"])],64)):(s(),I(_e,{key:1,disabled:e.value.displayType!=="5",label:a(l)("v_query.number_drop_down"),value:"5"},null,8,["disabled","label"])),i(_e,{disabled:!["1","7"].includes(e.value.displayType)||ra.value&&Ea.value,label:a(l)("dataset.time"),value:"1"},null,8,["disabled","label"]),i(_e,{disabled:!["1","7"].includes(e.value.displayType)||ra.value&&!Ea.value,label:a(l)("common.component.dateRange"),value:"7"},null,8,["disabled","label"])]),_:1},8,["modelValue"])])]),e.value.displayType==="9"?(s(),b("div",Ku,[v("div",{title:a(l)("v_query.of_option_values"),class:"label ellipsis"},g(a(l)("v_query.of_option_values")),9,Ju),v("div",Xu,[i(Ce,{class:"larger-radio",modelValue:e.value.resultMode,"onUpdate:modelValue":t[7]||(t[7]=c=>e.value.resultMode=c)},{default:r(()=>[i(Y,{label:0},{default:r(()=>[Z(g(a(l)("login.default_login")),1)]),_:1}),i(Y,{label:1},{default:r(()=>[Z(g(a(l)("chart.result_mode_all")),1)]),_:1})]),_:1},8,["modelValue"])])])):j("",!0),e.value.displayType==="9"?(s(),b("div",er,[v("div",ar,[Z(g(a(l)("v_query.tree_structure_design"))+" ",1),e.value.treeFieldList&&e.value.treeFieldList.length?(s(),I(Me,{key:0,text:"",onClick:Fl},{icon:r(()=>[i(k,{name:"icon_edit_outlined"},{default:r(()=>[i(a(ka),{class:"svg-icon"})]),_:1})]),_:1})):j("",!0)]),v("div",lr,[e.value.treeFieldList&&e.value.treeFieldList.length?(s(!0),b(ae,{key:0},ce(e.value.treeFieldList,(c,O)=>(s(),b("div",{key:c.id,class:"tree-field"},[v("span",tr,g(a(l)("visualization.level"))+g(rt[O]),1),v("span",nr,[i(y,null,{default:r(()=>[i(o,{className:`field-icon-${a(ge)[c.deType]}`},{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[c.deType]]),{class:be([`field-icon-${a(ge)[c.deType]}`,"svg-icon"])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024)]),v("span",ir,g(c.name),1)]))),128)):(s(),I(Me,{key:1,onClick:Fl,text:""},{icon:r(()=>[i(o,{name:"icon_add_outlined"},{default:r(()=>[i(a(Ba),{class:"svg-icon"})]),_:1})]),default:r(()=>[Z(" "+g(a(l)("v_query.the_tree_structure")),1)]),_:1}))]),i(Gn,{ref_key:"treeDialog",ref:Sl,onSaveTree:Vt},null,512)])):j("",!0),["1","7"].includes(e.value.displayType)?(s(),b("div",ur,[v("div",{title:a(l)("v_query.time_granularity"),class:"label ellipsis"},g(a(l)("v_query.time_granularity")),9,rr),v("div",sr,[e.value.displayType==="7"&&!ra.value?(s(),I(a($e),{key:0,onChange:$l,placeholder:a(l)("v_query.the_time_granularity"),onFocus:Pe,modelValue:e.value.timeGranularityMultiple,"onUpdate:modelValue":t[8]||(t[8]=c=>e.value.timeGranularityMultiple=c)},{default:r(()=>[i(_e,{label:a(l)("chart.y"),value:"yearrange"},null,8,["label"]),i(_e,{label:a(l)("chart.y_M"),value:"monthrange"},null,8,["label"]),i(_e,{label:a(l)("chart.y_M_d"),value:"daterange"},null,8,["label"]),i(_e,{label:a(l)("chart.y_M_d_H_m_s"),value:"datetimerange"},null,8,["label"])]),_:1},8,["placeholder","modelValue"])):(s(),I(a($e),{key:1,onChange:ql,placeholder:a(l)("v_query.the_time_granularity"),modelValue:e.value.timeGranularity,"onUpdate:modelValue":t[9]||(t[9]=c=>e.value.timeGranularity=c)},{default:r(()=>[(s(!0),b(ae,null,ce(Za.value,c=>(s(),I(_e,{key:c.value,label:c.label,value:c.value},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]))])])):j("",!0),["1","7","8","9","22"].includes(e.value.displayType)?j("",!0):(s(),b("div",or,[v("div",{title:a(l)("v_query.option_value_source"),class:"label ellipsis"},g(a(l)("v_query.option_value_source")),9,dr),v("div",cr,[v("div",vr,[i(Ce,{class:"larger-radio",onChange:fl,modelValue:e.value.optionValueSource,"onUpdate:modelValue":t[10]||(t[10]=c=>e.value.optionValueSource=c)},{default:r(()=>[i(Y,{disabled:!!e.value.parameters.length,label:0},{default:r(()=>[Z(g(a(l)("chart.margin_model_auto")),1)]),_:1},8,["disabled"]),i(Y,{label:1},{default:r(()=>[Z(g(a(l)("chart.select_dataset")),1)]),_:1}),i(Y,{label:2},{default:r(()=>[Z(g(a(l)("v_query.manual_input")),1)]),_:1})]),_:1},8,["modelValue"])]),e.value.optionValueSource===1?(s(),b(ae,{key:0},[v("div",mr,[i(aa,{teleported:!1,modelValue:e.value.dataset.id,"onUpdate:modelValue":t[11]||(t[11]=c=>e.value.dataset.id=c),data:me.value,placeholder:a(l)("copilot.pls_choose_dataset"),onChange:yl,onCurrentChange:at,props:St,placement:"bottom","render-after-expand":!1,filterable:"","popper-class":"dataset-tree"},{default:r(({node:c,data:O})=>[v("div",pr,[O.leaf?j("",!0):(s(),I(y,{key:0,size:"18px"},{default:r(()=>[i(o,{name:"dv-folder"},{default:r(()=>[i(a(Qt),{class:"svg-icon"})]),_:1})]),_:1})),O.leaf?(s(),I(y,{key:1,size:"18px"},{default:r(()=>[i(o,{name:"icon_dataset"},{default:r(()=>[i(a(Ht),{class:"svg-icon"})]),_:1})]),_:1})):j("",!0),v("span",{class:"label-tree ellipsis",style:{"margin-left":"8px"},title:c.label},g(c.label),9,yr)])]),_:1},8,["modelValue","data","placeholder"])]),v("div",fr,[v("span",{title:a(l)("v_query.query_field"),class:"label"},g(a(l)("v_query.query_field")),9,_r),i(a($e),{onChange:Xa,placeholder:a(l)("v_query.query_field"),class:"search-field",modelValue:e.value.field.id,"onUpdate:modelValue":t[12]||(t[12]=c=>e.value.field.id=c)},Va({default:r(()=>[(s(!0),b(ae,null,ce(e.value.dataset.fields.filter(c=>c.deType===+e.value.displayType||[3,4].includes(c.deType)&&+e.value.displayType==2||c.deType===7&&+e.value.displayType==0),c=>(s(),I(_e,{key:c.id,label:c.name,value:c.id,disabled:c.desensitized},{default:r(()=>[v("div",{class:"flex-align-center icon",title:c.desensitized?a(l)("v_query.as_query_conditions"):""},[i(y,null,{default:r(()=>[i(o,{className:`field-icon-${a(ge)[c.deType]}`},{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[c.deType]]),{class:be(["svg-icon",`field-icon-${a(ge)[c.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),v("span",null,g(c.name),1)],8,hr)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.field.id?{name:"prefix",fn:r(()=>[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[Fe(e.value.field.id,e.value.dataset.fields)]]),{class:be(["svg-icon",`field-icon-${a(ge)[Fe(e.value.field.id,e.value.dataset.fields)]}`])},null,8,["class"]))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["placeholder","modelValue"])]),v("div",gr,[v("span",{title:a(l)("v_query.display_field"),class:"label ellipsis"},g(a(l)("v_query.display_field")),9,br),i(a($e),{placeholder:a(l)("v_query.display_field"),class:"search-field",modelValue:e.value.displayId,"onUpdate:modelValue":t[13]||(t[13]=c=>e.value.displayId=c),onChange:Cl},Va({default:r(()=>[(s(!0),b(ae,null,ce(mt.value,c=>(s(),I(_e,{key:c.id,label:c.name,value:c.id,disabled:c.desensitized},{default:r(()=>[v("div",{class:"flex-align-center icon",title:c.desensitized?a(l)("v_query.as_query_conditions"):""},[i(y,null,{default:r(()=>[i(o,{className:`field-icon-${a(ge)[c.deType]}`},{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[c.deType]]),{class:be(["svg-icon",`field-icon-${a(ge)[c.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),v("span",null,g(c.name),1)],8,Vr)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.displayId?{name:"prefix",fn:r(()=>[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[Fe(e.value.displayId,e.value.dataset.fields)]]),{class:be(["svg-icon",`field-icon-${a(ge)[Fe(e.value.displayId,e.value.dataset.fields)]}`])},null,8,["class"]))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["placeholder","modelValue"])]),v("div",kr,[v("span",Tr,g(a(l)("chart.total_sort_field")),1),v("div",null,[i(a($e),{clearable:"",placeholder:a(l)("v_query.the_sorting_field"),modelValue:e.value.sortId,"onUpdate:modelValue":t[14]||(t[14]=c=>e.value.sortId=c),class:"sort-field",style:{width:"240px"},onChange:ht},Va({default:r(()=>[(s(!0),b(ae,null,ce(e.value.dataset.fields,c=>(s(),I(_e,{key:c.id,label:c.name,value:c.id,disabled:c.desensitized},{default:r(()=>[v("div",{class:"flex-align-center icon",title:c.desensitized?a(l)("v_query.as_query_conditions"):""},[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[c.deType]]),{class:be([`field-icon-${a(ge)[c.deType]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024)]),_:2},1024),v("span",null,g(c.name),1)],8,Cr)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.sortId?{name:"prefix",fn:r(()=>[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),I(Le(a(Je)[a(ge)[Fe(e.value.sortId,e.value.dataset.fields)]]),{class:be(["svg-icon",`field-icon-${a(ge)[Fe(e.value.sortId,e.value.dataset.fields)]}`])},null,8,["class"]))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["placeholder","modelValue"]),i(a($e),{class:"sort-type",modelValue:e.value.sort,"onUpdate:modelValue":t[15]||(t[15]=c=>e.value.sort=c),onChange:Xa},{default:r(()=>[i(_e,{label:a(l)("chart.asc"),value:"asc"},null,8,["label"]),i(_e,{label:a(l)("chart.desc"),value:"desc"},null,8,["label"]),i(_e,{onClick:bt,title:La.value?n.$t("v_query.display_sort"):"",disabled:La.value,label:a(l)("v_query.custom_sort"),value:"customSort"},null,8,["title","disabled","label"])]),_:1},8,["modelValue"])])])],64)):j("",!0),e.value.optionValueSource===2?(s(),b("div",Mr,[i(qe,{placement:"bottom-start","popper-class":"manual-input",ref_key:"manual",ref:Ve,width:358,trigger:"click"},{reference:r(()=>[i(Me,{text:""},{icon:r(()=>[i(o,{name:"icon_edit_outlined"},{default:r(()=>[i(a(ka),{class:"svg-icon"})]),_:1})]),default:r(()=>[Z(" "+g(a(l)("common.edit")),1)]),_:1})]),default:r(()=>[v("div",Sr,[v("div",Fr,g(a(l)("auth.manual_input")),1),v("div",wr,[v("span",null,g(a(l)("data_fill.form.option_value")),1),(s(!0),b(ae,null,ce(m.value,(c,O)=>(s(),b("div",{key:O,class:"select-item"},[e.value.displayType==="2"?(s(),I(B,{key:0,maxlength:"64",onBlur:kl,modelValue:m.value[O],"onUpdate:modelValue":Oe=>m.value[O]=Oe,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])):(s(),I(B,{key:1,maxlength:"64",onBlur:kl,modelValue:m.value[O],"onUpdate:modelValue":Oe=>m.value[O]=Oe},null,8,["modelValue","onUpdate:modelValue"])),m.value.length!==1?(s(),I(Me,{key:2,onClick:Oe=>m.value.splice(O,1),class:"value",text:""},{icon:r(()=>[i(o,{name:"icon_delete-trash_outlined"},{default:r(()=>[i(a(ml),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])):j("",!0)]))),128))]),v("div",qr,[i(Me,{onClick:t[16]||(t[16]=c=>m.value.push("")),text:""},{icon:r(()=>[i(o,{name:"icon_add_outlined"},{default:r(()=>[i(a(Ba),{class:"svg-icon"})]),_:1})]),default:r(()=>[Z(" "+g(a(l)("data_fill.form.add_option")),1)]),_:1})]),v("div",$r,[i(Me,{onClick:gl},{default:r(()=>[Z(g(a(l)("chart.cancel")),1)]),_:1}),i(Me,{onClick:pt,type:"primary"},{default:r(()=>[Z(g(a(l)("chart.confirm")),1)]),_:1})])])]),_:1},512),e.value.valueSource.length?(s(),b("div",Ar,g(a(l)("v_query.configured")),1)):j("",!0)])):j("",!0)]),v("div",{class:"label ellipsis",title:a(l)("v_query.of_option_values"),style:{"margin-top":"10.5px"}},g(a(l)("v_query.of_option_values")),9,Nr),v("div",Or,[i(Ce,{class:"larger-radio",modelValue:e.value.resultMode,"onUpdate:modelValue":t[17]||(t[17]=c=>e.value.resultMode=c)},{default:r(()=>[i(Y,{label:0},{default:r(()=>[Z(g(a(l)("chart.default")),1)]),_:1}),i(Y,{label:1},{default:r(()=>[Z(g(a(l)("data_set.all")),1)]),_:1})]),_:1},8,["modelValue"])])])),e.value.displayType==="8"?(s(),b("div",Ir,[v("div",{title:a(l)("v_query.condition_type"),class:"label ellipsis"},g(a(l)("v_query.condition_type")),9,Er),v("div",Dr,[v("div",Rr,[i(Ce,{class:"larger-radio",modelValue:e.value.conditionType,"onUpdate:modelValue":t[18]||(t[18]=c=>e.value.conditionType=c)},{default:r(()=>[i(Y,{label:0},{default:r(()=>[Z(g(a(l)("v_query.single_condition")),1)]),_:1}),i(Y,{label:1,disabled:!!e.value.parameters.length},{default:r(()=>[Z(g(a(l)("v_query.with_condition")),1)]),_:1},8,["disabled"]),i(Y,{label:2,disabled:!!e.value.parameters.length},{default:r(()=>[Z(g(a(l)("v_query.or_condition")),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])])])])):j("",!0),e.value.displayType==="8"?(s(),b("div",Lr,[i(fe,{modelValue:e.value.hideConditionSwitching,"onUpdate:modelValue":t[19]||(t[19]=c=>e.value.hideConditionSwitching=c),label:a(l)("v_query.hide_condition_switch")},null,8,["modelValue","label"])])):j("",!0),i(ku,{ref_key:"defaultConfigurationRef",ref:E,onHandleTimeTypeChange:Ct,"cur-component":e.value},null,8,["cur-component"])],512),[[cl,Ne.value&&!He.value&&!Xe.value]]),He.value&&Ne.value?(s(),b("div",xr,[i(il,{description:a(l)("v_query.cannot_be_performed"),"img-type":"error"},null,8,["description"])])):Xe.value&&Ne.value?(s(),b("div",Ur,[i(il,{description:a(l)("v_query.cannot_be_displayed"),"img-type":"error"},null,8,["description"])])):Ne.value?j("",!0):(s(),b("div",Gr,[i(il,{description:a(l)("v_query.be_linked_first"),"img-type":"noneWhite"},null,8,["description"])]))]),_:1})],2)):j("",!0)])]),_:1},8,["modelValue","title"]),i(ze,{title:ee.value,modelValue:Ze.value,"onUpdate:modelValue":t[26]||(t[26]=c=>Ze.value=c),width:"420px"},{footer:r(()=>[i(Me,{secondary:"",onClick:t[25]||(t[25]=c=>Ze.value=!1)},{default:r(()=>[Z(g(a(l)("chart.cancel")),1)]),_:1}),i(Me,{type:"primary",onClick:K},{default:r(()=>[Z(g(a(l)("chart.confirm")),1)]),_:1})]),default:r(()=>[i(ma,{"label-position":"top"},{default:r(()=>[i(la,{label:a(l)("v_query.time_type"),class:"form-item",prop:"name"},{default:r(()=>[i(Ce,{modelValue:D.value,"onUpdate:modelValue":t[24]||(t[24]=c=>D.value=c)},{default:r(()=>[i(Y,{label:0},{default:r(()=>[Z(g(a(l)("data_set.time")),1)]),_:1}),i(Y,{label:1},{default:r(()=>[Z(g(a(l)("datasource.start_time")),1)]),_:1}),i(Y,{label:2},{default:r(()=>[Z(g(a(l)("datasource.end_time")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["title","modelValue"]),i(ze,{title:V.value,modelValue:G.value,"onUpdate:modelValue":t[29]||(t[29]=c=>G.value=c),width:"420px"},{footer:r(()=>[i(Me,{secondary:"",onClick:t[28]||(t[28]=c=>G.value=!1)},{default:r(()=>[Z(g(a(l)("dataset.cancel")),1)]),_:1}),i(Me,{type:"primary",onClick:oe},{default:r(()=>[Z(g(a(l)("dataset.confirm")),1)]),_:1})]),default:r(()=>[i(ma,{"label-position":"top"},{default:r(()=>[i(la,{label:a(l)("chart.map_line_type"),class:"form-item",prop:"name"},{default:r(()=>[i(Ce,{modelValue:_.value,"onUpdate:modelValue":t[27]||(t[27]=c=>_.value=c)},{default:r(()=>[i(Y,{label:0},{default:r(()=>[Z(g(a(l)("chart.value_formatter_value")),1)]),_:1}),i(Y,{label:1},{default:r(()=>[Z(g(a(l)("chart.min")),1)]),_:1}),i(Y,{label:2},{default:r(()=>[Z(g(a(l)("chart.max")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["title","modelValue"]),i($n,{ref_key:"customSortFilterRef",ref:Ml,onSave:gt},null,512),i(a(nt),{onSaveCascade:z,ref_key:"cascadeDialog",ref:_l},null,512)],64)}}});const jr=Oa(),{componentData:Dl,canvasViewInfo:Wr}=Wa(jr),Pr=()=>{const L=()=>{let u=Dl.value.filter(l=>!["VQuery","DeTabs"].includes(l.innerType)&&l.component!=="Group");return Dl.value.forEach(l=>{l.innerType==="DeTabs"?l.propValue.forEach(d=>{u=[...u,...d.componentData.filter(p=>!["VQuery","DeTabs"].includes(p.innerType)&&p.component!=="Group")]}):l.component==="Group"&&(u=[...u,l.propValue.filter(d=>!["VQuery","DeTabs"].includes(d.innerType)&&d.component!=="Group")],l.propValue.forEach(d=>{d.innerType==="DeTabs"&&d.propValue.forEach(p=>{u=[...u,...p.componentData.filter(f=>!["VQuery","DeTabs"].includes(f.innerType)&&f.component!=="Group")]})}))}),u.flat()};return{datasetFieldList:U(()=>L().map(u=>{const l=Wr.value[u.id];if(!l)return null;const{id:d,title:p,tableId:f,type:S}=l;return d&&f?{id:d,type:S,title:p,tableId:f}:null}).filter(u=>!!u))}},zr={class:"condition-type"},Qr={key:0,class:"condition-type"},Hr={class:"condition-type-tip"},Zr=xe({__name:"TextSearch",props:{config:{type:Object,default:()=>({id:"",conditionType:0,queryConditionWidth:0,conditionValueOperatorF:"eq",conditionValueF:"",conditionValueOperatorS:"like",conditionValueS:"",defaultConditionValueOperatorF:"eq",defaultConditionValueF:"",defaultConditionValueOperatorS:"like",defaultConditionValueS:""})},isConfig:{type:Boolean,default:!1}},setup(L){const C=Ee("placeholder"),{t:u}=ia(),l=U(()=>{var W;return(W=C==null?void 0:C.value)!=null&&W.placeholderShow?S.config.placeholder:" "}),d=[{label:u("v_query.exact_match"),value:"eq"},{label:u("v_query.fuzzy_match"),value:"like"}],p=Oa(),{dvInfo:f}=Wa(p),S=L,{config:E}=Qe(S),M=()=>{const{defaultConditionValueOperatorF:W,defaultConditionValueF:w,defaultConditionValueOperatorS:q,defaultConditionValueS:z}=E.value;E.value.conditionValueOperatorF=W,E.value.conditionValueF=w,E.value.conditionValueOperatorS=q,E.value.conditionValueS=z};fa(()=>{M()});const J=Ee("com-width",Function,!0),re=Ee("$custom-style-filter"),m=Ee("is-confirm-search",Function,!0),F=()=>{var W;return(W=C==null?void 0:C.value)!=null&&W.placeholderShow?S.config.queryConditionWidth===void 0?J():S.config.queryConditionWidth:227},$=U(()=>({width:F()+"px"})),h=()=>{if(!S.isConfig){Se(()=>{m(E.value.id)});return}},ne=U(()=>({width:F()-15+"px",background:re.border})),X=()=>{h()},ie=W=>{W.stopPropagation()};return(W,w)=>{const q=Ma,z=$e,ve=ol;return s(),b("div",{onMousedown:ie,class:"text-search-select",style:Ae({background:a(re).background})},[v("div",zr,[a(E).hideConditionSwitching?j("",!0):(s(),I(z,{key:0,class:"condition-value-select",onChange:h,effect:a(f).type==="dataV"?"dark":"","popper-class":"condition-value-select-popper",modelValue:a(E).conditionValueOperatorF,"onUpdate:modelValue":w[0]||(w[0]=e=>a(E).conditionValueOperatorF=e)},{default:r(()=>[(s(),b(ae,null,ce(d,e=>i(q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["effect","modelValue"])),i(ve,{style:Ae($.value),placeholder:l.value,onBlur:h,onKeydown:Nl(X,["enter"]),class:"condition-value-input",modelValue:a(E).conditionValueF,"onUpdate:modelValue":w[1]||(w[1]=e=>a(E).conditionValueF=e)},null,8,["style","placeholder","modelValue"]),v("div",{style:Ae(ne.value),class:"bottom-line"},null,4)]),[1,2].includes(a(E).conditionType)?(s(),b("div",Qr,[v("span",Hr,g(a(E).conditionType===1?a(u)("chart.and"):a(u)("chart.or")),1),a(E).hideConditionSwitching?j("",!0):(s(),I(z,{key:0,class:"condition-value-select",onChange:h,effect:a(f).type==="dataV"?"dark":"","popper-class":"condition-value-select-popper",modelValue:a(E).conditionValueOperatorS,"onUpdate:modelValue":w[2]||(w[2]=e=>a(E).conditionValueOperatorS=e)},{default:r(()=>[(s(),b(ae,null,ce(d,e=>i(q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["effect","modelValue"])),i(ve,{style:Ae($.value),onBlur:h,placeholder:l.value,onKeydown:Nl(X,["enter"]),class:"condition-value-input",modelValue:a(E).conditionValueS,"onUpdate:modelValue":w[3]||(w[3]=e=>a(E).conditionValueS=e)},null,8,["style","placeholder","modelValue"]),v("div",{style:Ae(ne.value),class:"bottom-line next-line"},null,4)])):j("",!0)],36)}}});const Kr=Ia(Zr,[["__scopeId","data-v-6ef236ad"]]),Jr=xe({__name:"NumberInput",props:{config:{type:Object,default:()=>({id:"",queryConditionWidth:0,defaultNumValueEnd:"",defaultNumValueStart:"",numValueEnd:"",numValueStart:"",defaultValueCheck:!1})},isConfig:{type:Boolean,default:!1}},setup(L){Yl(F=>({"6a632d3b":m.value}));const C=Ee("placeholder"),u=U(()=>{var F;return(F=C==null?void 0:C.value)!=null&&F.placeholderShow?l.config.placeholder:" "}),l=L,{config:d}=Qe(l),p=()=>{if(!d.value.defaultValueCheck){d.value.numValueEnd=void 0,d.value.numValueStart=void 0;return}const{defaultNumValueEnd:F,defaultNumValueStart:$}=d.value;d.value.numValueEnd=F,d.value.numValueStart=$};fa(()=>{p()});const f=Ee("com-width",Function,!0),S=Ee("$custom-style-filter"),E=Ee("is-confirm-search",Function,!0),M=()=>{var F;return(F=C==null?void 0:C.value)!=null&&F.placeholderShow?l.config.queryConditionWidth===void 0?f():l.config.queryConditionWidth:227},J=U(()=>({width:M()+"px"})),re=()=>{if(!l.isConfig){Se(()=>{E(d.value.id)});return}},m=U(()=>S.border);return(F,$)=>{const h=ja;return s(),b("div",{class:"num-search-select",style:Ae({background:a(S).background})},[i(h,{placeholder:u.value,onChange:re,style:Ae(J.value),"controls-position":"right",modelValue:a(d).numValueStart,"onUpdate:modelValue":$[0]||($[0]=ne=>a(d).numValueStart=ne)},null,8,["placeholder","style","modelValue"]),$[2]||($[2]=v("div",{class:"num-value_line"},null,-1)),i(h,{placeholder:u.value,style:Ae(J.value),onChange:re,"controls-position":"right",modelValue:a(d).numValueEnd,"onUpdate:modelValue":$[1]||($[1]=ne=>a(d).numValueEnd=ne)},null,8,["placeholder","style","modelValue"])],4)}}});const Xr=Ia(Jr,[["__scopeId","data-v-074392f9"]]),es=xe({__name:"StyleInject",props:{config:{type:Object,default:()=>({selectValue:"",defaultValue:"",displayType:"",defaultValueCheck:!1,optionValueSource:0,multiple:!1,checkedFieldsMap:{}})},customStyle:{type:Object,default:()=>({border:"",background:"",text:""})}},setup(L){const C=L,u=l=>l==="8"?Kr:l==="22"?Xr:["1","7"].includes(l)?Jl:l==="9"?et:Xl;return oa("$custom-style-filter",C.customStyle),(l,d)=>(s(),I(Le(u(L.config.displayType)),{config:L.config,"is-config":!1},null,8,["config"]))}}),as={key:0,class:"no-list-label flex-align-center"},ls={class:"container flex-align-center"},ts={class:"query-fields-container"},ns={class:"label-wrapper"},is={key:0,class:"required"},us={key:0,class:"label-wrapper-tooltip"},rs={class:"query-select"},ss={key:0,class:"query-button"},os=xe({__name:"Component",props:{view:{type:Object,default(){return{customStyle:""}}},element:{type:Object,default(){return{id:null,propValue:[]}}},showPosition:{type:String,required:!0,default:""},scale:{type:Number,required:!1,default:1}},setup(L){Yl(_=>({"326d1a03":pe.value}));const C=L,{element:u,view:l,scale:d}=Qe(C),{t:p}=ia(),f=ue(),S=Oa(),{curComponent:E,canvasViewInfo:M,mobileInPc:J,firstLoadMap:re}=Wa(S),m=ue(!1),F=ue(),h=Gl({...{border:"",placeholderSize:14,placeholderShow:!0,background:"",text:"",layout:"horizontal",btnList:["sure"],titleLayout:"left",titleShow:!1,titleColor:"",textColorShow:!1,labelShow:!0,title:"",labelColor:"#1f2329",fontSize:"14",fontWeight:"",fontStyle:"",fontSizeBtn:"14",fontWeightBtn:"",fontStyleBtn:"",queryConditionWidth:227,nameboxSpacing:8,queryConditionSpacing:16,btnColor:"#3370ff",labelColorBtn:"#ffffff"}}),ne=Bl(),X=U(()=>{const _={backgroundColor:h.btnColor,borderColor:h.btnColor,color:h.labelColorBtn};return h.fontSizeBtn&&(_.fontSize=h.fontSizeBtn+"px"),h.fontWeightBtn&&(_.fontWeight=h.fontWeightBtn),h.fontStyleBtn&&(_.fontStyle=h.fontStyleBtn),_}),ie=U(()=>{const _={backgroundColor:"transparent",borderColor:h.btnColor,color:h.btnColor};return h.fontSizeBtn&&(_.fontSize=h.fontSizeBtn+"px"),h.fontWeightBtn&&(_.fontWeight=h.fontWeightBtn),h.fontStyleBtn&&(_.fontStyle=h.fontStyleBtn),_}),W=U(()=>(M.value[u.value.id]||{}).customStyle),{datasetFieldList:w}=Pr(),q=_=>{const{borderColor:V,btnList:K,titleLayout:oe,labelColor:x,text:te,bgColor:de,layout:ye,titleShow:Be,titleColor:ca,title:ha,fontSize:va,fontWeight:ra,fontStyle:ba,fontSizeBtn:za,fontWeightBtn:Qa,fontStyleBtn:Ea,queryConditionWidth:Ha,nameboxSpacing:Da,queryConditionSpacing:_a,labelColorBtn:Za,btnColor:Ka,placeholderSize:Ja,placeholderShow:Ra,labelShow:sa}=_;h.background=de||"",h.border=V||"",h.btnList=[...K],h.layout=ye,h.placeholderShow=Ra??!0,h.placeholderSize=Ja??14,Se(()=>{f.value.style.setProperty("--ed-component-size",`${h.placeholderSize+18}px`)}),h.titleShow=Be,h.titleColor=ca,h.labelColor=sa&&x||"",h.fontSize=sa&&va||"14",h.fontWeight=sa&&ra||"",h.fontStyle=sa&&ba||"",h.title=ha,h.text=h.placeholderShow&&te||"",h.titleLayout=oe,h.fontSizeBtn=za||"14",h.fontWeightBtn=Qa,h.fontStyleBtn=Ea,h.queryConditionWidth=Ha??227,h.nameboxSpacing=Da??8,h.queryConditionSpacing=_a??16,h.labelColorBtn=Za||"#ffffff",h.labelShow=sa??!0,h.btnColor=Ka||"#3370ff",ne.recordSnapshotCache("setCustomStyle")};he(()=>l.value,_=>{var V,K;(V=_==null?void 0:_.customStyle)!=null&&V.component&&q((K=_==null?void 0:_.customStyle)==null?void 0:K.component)},{deep:!0,immediate:!0}),he(()=>W.value,_=>{_!=null&&_.component&&q(_==null?void 0:_.component)},{deep:!0,immediate:!0});const z=ue([]);he(()=>C.element.propValue,()=>{z.value=[...C.element.propValue]},{immediate:!0});const ve=()=>{E.value.id!==u.value.id&&(m.value=!1)},{emitter:e}=ga(),Ve=Na([]);fa(()=>{Ve.value=z.value.map(_=>_.id)});const P=_=>{Ve.value=Ve.value.filter(V=>V!==_)},A=_=>{let V="",K="";const oe=(u.value.propValue||[]).filter(x=>x.id===_).reduce((x,te)=>{if(te.required)if(te.defaultValueCheck||(V=te.name),te.displayType==="8"){const{conditionValueF:ye,conditionValueS:Be,conditionType:ca}=te;ca===0?V=ye===""?te.name:"":V=[ye||"",Be||""].filter(ha=>ha!=="").length<2?te.name:""}else te.displayType==="22"?(te.numValueStart!==0&&!te.numValueStart||te.numValueEnd!==0&&!te.numValueEnd)&&(V=te.name):(Array.isArray(te.selectValue)&&!te.selectValue.length||te.selectValue!==0&&!te.selectValue)&&(V=te.name);te.displayType==="22"&&(!isNaN(te.numValueEnd)&&!isNaN(te.numValueStart)&&te.numValueEnd<te.numValueStart&&(K=te.name),[te.numValueEnd,te.numValueStart].filter(ye=>![null,void 0,""].includes(ye)).length===1&&(V=te.name));const de=Object.entries(te.checkedFieldsMap).filter(ye=>te.checkedFields.includes(ye[0])).filter(ye=>!!ye[1]).map(ye=>ye[0]);return x=[...new Set([...de,...x])],x},[]);if(V){De.error(`【${V}】${p("v_query.before_querying")}`);return}if(K){De.error(`【${K}】${p("v_query.the_minimum_value")}`);return}oe.length&&oe.forEach(x=>{e.emit(`query-data-${x}`)})},me=()=>h.queryConditionWidth,se=()=>C.element.cascade,Ye=U(()=>({placeholderShow:h.placeholderShow}));oa("is-confirm-search",_=>{le.value||A(_)}),oa("unmount-select",Ve),oa("release-unmount-select",P),oa("query-data-for-id",A),oa("com-width",me),oa("cascade-list",se),oa("placeholder",Ye),Gt(()=>{e.off(`addQueryCriteria${u.value.id}`),e.off(`editQueryCriteria${u.value.id}`),e.off(`updateQueryCriteria${u.value.id}`),Yt.off("componentClick",ve)});const Ne=()=>{S.mobileInPc&&!nl()||Array.isArray(u.value.propValue)&&u.value.propValue.forEach(_=>{if(_.auto){const V={datasetId:_.dataset.id,id:_.field.id},K=[],oe={};w.value.forEach(x=>{x.tableId===V.datasetId&&(K.push(x.id),oe[x.id]=V.id)}),_.checkedFields=K,_.checkedFieldsMap=oe}else{if(!_.dataset.id||_.parameters.length||_.optionValueSource!==1||![0,2,5].includes(+_.displayType))return;const V=w.value.map(K=>K.id);_.checkedFields.forEach(K=>{V.includes(K)||(_.checkedFieldsMap[K]="")}),_.checkedFields=_.checkedFields.filter(K=>V.includes(K))}})};vl(()=>{e.on(`addQueryCriteria${u.value.id}`,We),e.on(`editQueryCriteria${u.value.id}`,Ue),e.on(`updateQueryCriteria${u.value.id}`,Ne),Ne(),S.mobileInPc&&!nl()&&R()});const He=()=>{},Xe=_=>{JSON.parse(_.dataTransfer.getData("dimension")||"{}").forEach(K=>{const oe=[],x={};w.value.forEach(de=>{de.tableId===K.datasetId&&(oe.push(de.id),x[de.id]=K.id)});const te=K.deType===7?0:`${K.deType}`;z.value.push({...Ql(K),auto:!0,optionValueSource:1,checkedFields:oe,checkedFieldsMap:x,displayType:te})}),u.value.propValue=[...z.value],ne.recordSnapshotCache("drop")},ua=_=>{F.value.setCondition(_)},Ue=()=>{if(!z.value.length){We();return}ua(z.value[0].id)},We=()=>{F.value.setConditionOut()},ea=_=>{z.value.splice(_,1),u.value.propValue=[...z.value],ne.recordSnapshotCache("delQueryConfig")},T=()=>{(z.value||[]).reduce((_,V)=>{var oe;V.conditionValueF=V.defaultConditionValueF,V.conditionValueOperatorF=V.defaultConditionValueOperatorF,V.conditionValueS=V.defaultConditionValueS,V.conditionValueOperatorS=V.defaultConditionValueOperatorS,V.displayType==="22"&&(V.numValueEnd=V.defaultNumValueEnd,V.numValueStart=V.defaultNumValueStart),V.defaultValueCheck||(V.defaultValue=V.multiple||+V.displayType==7?[]:void 0),V.selectValue=Array.isArray(V.defaultValue)?[...V.defaultValue]:V.defaultValue,V.optionValueSource===1&&((oe=V.defaultMapValue)!=null&&oe.length)&&(V.mapValue=Array.isArray(V.defaultMapValue)?[...V.defaultMapValue]:V.defaultMapValue),(C.element.cascade||[]).forEach(x=>{x.forEach(te=>{const de=te.datasetId.split("--")[1];V.id===de&&(te.currentSelectValue=Array.isArray(V.selectValue)?V.selectValue:[V.selectValue].filter(ye=>![null,void 0].includes(ye)),ga().emitter.emit(`${te.datasetId.split("--")[1]}-select`))})});const K=Object.entries(V.checkedFieldsMap).filter(x=>V.checkedFields.includes(x[0])).filter(x=>!!x[1]).map(x=>x[0]);return _=[...new Set([...K,..._])],_},[]),!le.value&&R()},da=()=>{(C.element.cascade||[]).forEach(_=>{_.forEach(V=>{var K;(K=V.currentSelectValue)!=null&&K.length&&(ga().emitter.emit(`${V.datasetId.split("--")[1]}-select`),V.currentSelectValue=[])})}),(z.value||[]).reduce((_,V)=>{var oe;if(!V.visible)return _;V.selectValue=V.multiple||+V.displayType==7?[]:void 0,V.optionValueSource===1&&((oe=V.defaultMapValue)!=null&&oe.length)&&(V.mapValue=V.multiple?[]:void 0),V.conditionValueF="",V.conditionValueS="",V.displayType==="22"&&(V.numValueEnd=void 0,V.numValueStart=void 0);const K=Object.entries(V.checkedFieldsMap).filter(x=>V.checkedFields.includes(x[0])).filter(x=>!!x[1]).map(x=>x[0]);return _=[...new Set([...K,..._])],_},[]),!le.value&&R()},H=U(()=>z.value.filter(_=>_.visible)),le=U(()=>h.btnList.includes("sure"));he(()=>le.value,(_,V)=>{!_&&V&&R()},{immediate:!1});const pe=U(()=>`${h.placeholderSize}px`),R=()=>{let _="",V="";const K=(u.value.propValue||[]).reduce((oe,x)=>{if(x.required)if(x.defaultValueCheck||(_=x.name),x.displayType==="8"){const{conditionValueF:de,conditionValueS:ye,conditionType:Be}=x;Be===0?_=de===""?x.name:"":_=[de||"",ye||""].filter(ca=>ca!=="").length<2?x.name:""}else x.displayType==="22"?(x.numValueEnd!==0&&!x.numValueEnd||x.numValueStart!==0&&!x.numValueStart)&&(_=x.name):(Array.isArray(x.selectValue)&&!x.selectValue.length||x.selectValue!==0&&!x.selectValue)&&(_=x.name);x.displayType==="22"&&(!isNaN(x.numValueEnd)&&!isNaN(x.numValueStart)&&x.numValueEnd<x.numValueStart&&(V=x.name),[x.numValueEnd,x.numValueStart].filter(de=>![null,void 0,""].includes(de)).length===1&&(_=x.name));const te=Object.entries(x.checkedFieldsMap).filter(de=>x.checkedFields.includes(de[0])).filter(de=>!!de[1]).map(de=>de[0]);return oe=[...new Set([...te,...oe])],oe},[]);if(_){De.error(`【${_}】${p("v_query.before_querying")}`);return}if(V){De.error(`【${V}】${p("v_query.the_minimum_value")}`);return}K.length&&(S.mobileInPc&&!nl()||S.setFirstLoadMap([...new Set([...K,...re.value])]),K.forEach(oe=>{e.emit(`query-data-${oe}`)}))},Te=U(()=>({textAlign:h.titleLayout||"left",color:h.titleColor||"#1f2329"})),Ze=U(()=>{const _={fontSize:h.fontSize+"px",lineHeight:+h.fontSize+8+"px"};return h.fontWeight&&(_.fontWeight=h.fontWeight),h.fontStyle&&(_.fontStyle=h.fontStyle),h.labelColor&&(_.color=h.labelColor),_}),D=U(()=>({paddingTop:h.layout!=="horizontal"?h.nameboxSpacing+22+"px":"0"})),ee=U(()=>({marginRight:h.layout==="horizontal"?h.nameboxSpacing+"px":"8px"})),G=U(()=>Lt()?{position:"absolute",height:100/d.value+"%!important",width:100/d.value+"%!important",left:50*(1-1/d.value)+"%",top:50*(1-1/d.value)+"%",transform:"scale("+d.value+") translateZ(0)"}:{zoom:d.value});return(_,V)=>{const K=wa,oe=dl,x=Ta,te=ul;return s(),b(ae,null,[v("div",{class:"v-query-container",ref_key:"vQueryRef",ref:f,style:Ae(G.value),onKeydown:V[0]||(V[0]=Ie(()=>{},["stop"])),onKeyup:V[1]||(V[1]=Ie(()=>{},["stop"]))},[h.titleShow?(s(),b("p",{key:0,class:"title",style:Ae(Te.value)},g(h.title),5)):j("",!0),v("div",{class:be(["v-query",h.layout,h.titleShow&&!!h.title&&"title-show"]),onDragover:Ie(He,["prevent","stop"]),onDrop:Ie(Xe,["prevent","stop"])},[H.value.length?j("",!0):(s(),b("div",as,[v("div",ls,[Z(g(a(p)("v_query.here_or_click"))+" ",1),i(K,{disabled:L.showPosition==="preview"||a(J),onClick:We,style:{"font-family":"inherit"},text:""},{default:r(()=>[Z(g(a(p)("v_query.add_query_condition")),1)]),_:1},8,["disabled"])])])),v("div",ts,[(s(!0),b(ae,null,ce(H.value,(de,ye)=>(s(),b("div",{class:"query-item",style:Ae({marginRight:`${h.queryConditionSpacing}px`}),key:de.id},[v("div",{class:"query-field",style:Ae(D.value)},[v("div",{class:"label",style:Ae(ee.value)},[Ca(v("div",ns,[v("div",{class:"label-wrapper-text",style:Ae(Ze.value)},[i(oe,{"popper-class":"label-wrapper-text_tooltip",effect:"dark",content:de.name,"show-arrow":!1,placement:"top-start"},{default:r(()=>[Z(g(de.name),1)]),_:2},1032,["content"])],4),de.required?(s(),b("span",is,"*")):j("",!0)],512),[[cl,h.labelShow]]),L.showPosition!=="preview"&&!a(S).mobileInPc?(s(),b("div",us,[i(oe,{effect:"dark",content:a(p)("v_query.set_filter_condition"),placement:"top"},{default:r(()=>[i(te,{onClick:Be=>ua(de.id)},{default:r(()=>[i(x,{name:"icon_edit_outlined"},{default:r(()=>[i(a(ka),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),i(oe,{effect:"dark",content:a(p)("v_query.delete_condition"),placement:"top"},{default:r(()=>[i(te,{style:{"margin-left":"8px"},onClick:Be=>ea(ye)},{default:r(()=>[i(x,{name:"icon_delete-trash_outlined"},{default:r(()=>[i(a(ml),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])):j("",!0)],4),v("div",rs,[h.queryConditionWidth!==0?(s(),I(es,{key:0,customStyle:h,config:de},null,8,["customStyle","config"])):j("",!0)])],4)],4))),128)),H.value.length?(s(),b("div",ss,[h.btnList.includes("clear")?(s(),I(K,{key:0,onClick:Ie(da,["stop"]),style:Ae(ie.value),plain:""},{default:r(()=>[Z(g(a(p)("commons.clear")),1)]),_:1},8,["style"])):j("",!0),h.btnList.includes("reset")?(s(),I(K,{key:1,onClick:Ie(T,["stop"]),style:Ae(ie.value),plain:""},{default:r(()=>[Z(g(a(p)("chart.reset")),1)]),_:1},8,["style"])):j("",!0),le.value?(s(),I(K,{key:2,onClick:Ie(R,["stop"]),style:Ae([{"margin-right":"7px"},X.value]),type:"primary"},{default:r(()=>[Z(g(a(p)("commons.adv_search.search")),1)]),_:1},8,["style"])):j("",!0)])):j("",!0)])],34)],36),(s(),I(xl,{to:"body"},[i(Br,{"query-element":a(u),onQueryData:R,ref_key:"queryConfig",ref:F},null,8,["query-element"])]))],64)}}});const ds=Ia(os,[["__scopeId","data-v-94513b7c"]]),Qs=Object.freeze(Object.defineProperty({__proto__:null,default:ds},Symbol.toStringTag,{value:"Module"}));export{Qs as C,ds as V,Sn as d};

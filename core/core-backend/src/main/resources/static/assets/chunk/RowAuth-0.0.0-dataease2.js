import{o as H}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import J from"./AuthTree-0.0.0-dataease2.js";import{d as K,r as k,G as I,f as V,L as A,k as Q,M as N}from"./vue-0.0.0-dataease.js";import{_ as W}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./el-dropdown-menu-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./dropdown-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./FilterFiled-0.0.0-dataease2.js";import"./el-popover-0.0.0-dataease.js";import"./el-checkbox-group-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import"./index-0.0.0-dataease17.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./icon_search-outline_outlined-0.0.0-dataease.js";import"./icon_close_outlined-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./options-0.0.0-dataease.js";import"./field-list-0.0.0-dataease.js";import"./icon_down_outlined-0.0.0-dataease.js";const Z={class:"rowAuth"},b={width:"388",height:"100%",class:"real-line"},j=["d"],tt={width:"388",height:"100%",class:"dash-line"},et=["d"],lt=K({__name:"RowAuth",emits:["save"],setup(it,{expose:B,emit:Y}){const{t:p}=H(),d=k(""),v=k("or"),a=k([]),O=I(()=>{const l=a.value.length;let t={x:0,y:0,child:a.value};return t.y=Math.floor(M(t,0)/2),l?w(t):""}),P=I(()=>{const l=a.value.length;let t={x:0,y:0,child:a.value};return t.y=Math.floor(M(t,0)/2),l?R(t):"M48 20 L68 20"}),S=l=>{const{items:t}=l;v.value=l.logic||"or",a.value=x(t||[])},z=()=>{d.value="",q("save",{logic:v.value,items:E(a.value),errorMessage:d.value})},F=({enumValue:l,deType:t,filterType:e,term:i,value:r,name:n,timeValue:o})=>{if(!n){d.value=p("data_set.cannot_be_empty_");return}if(e==="logic"){if(!i){d.value=p("data_set.cannot_be_empty_de_ruler");return}if(!i.includes("null")&&!i.includes("empty")&&["",null,void 0].includes(r)&&t!==1){d.value=p("chart.filter_value_can_null");return}if(!i.includes("null")&&!i.includes("empty")&&["",null,void 0].includes(o)&&t===1){d.value=p("chart.filter_value_can_null");return}if([2,3].includes(t)&&parseFloat(r).toString()==="NaN"){d.value=p("chart.filter_value_can_not_str");return}}if(e==="enum"&&l.length<1){d.value=p("chart.enum_value_can_not_null");return}},x=l=>{const t=[];return l.forEach(e=>{const{subTree:i}=e;if(i){const{items:r=[],logic:n}=i,o=x(r);t.push({logic:n,child:o})}else{const{enumValue:r,fieldId:n,filterType:o,term:s,value:c,timeValue:h,field:f}=e,{name:u,deType:y}=f||{};t.push({enumValue:r.join(","),fieldId:n,filterType:o,term:s,timeValue:h,value:c,name:u,deType:y})}}),t},E=l=>{const t=[];return l.forEach(e=>{const{child:i=[]}=e;if(i.length){const{logic:r}=e,n=E(i);t.push({enumValue:[],fieldId:"",filterType:"",term:"",type:"tree",value:"",timeValue:"",subTree:{logic:r,items:n}})}else{const{enumValue:r,fieldId:n,filterType:o,deType:s,term:c,value:h,name:f,timeValue:u}=e;F({deType:s,enumValue:r,filterType:o,term:c,value:h,name:f,timeValue:u}),n&&t.push({enumValue:r?r.split(","):[],fieldId:n,timeValue:u,filterType:o,term:c,value:h,type:"item",subTree:null})}}),t},G=()=>{a.value=[]},g=l=>{var e;const[t]=l;return(e=t.child)!=null&&e.length?g(t.child):t.y},R=l=>{var i,r;const t=(i=l.child)==null?void 0:i.length;let e="";if(!t&&Array.isArray(l.child)){const{x:n,y:o}=l;e+=`M${48+n*68} ${o*41.4+20} L${88+n*68} ${o*41.4+20}`}else if((r=l.child)!=null&&r.length){let n=Math.max(T(l,0),m(l.child,0)+g(l.child)-1),o=m(l.child,0)*41.4/2+(g(l.child)||0)*41.4;const{x:s}=l;e+=`M${24+s*68} ${o} L${24+s*68} ${n*41.4+20} L${64+s*68} ${n*41.4+20}`,l.child.forEach(c=>{e+=R(c)})}return e},w=l=>{const t=l.child.length;if(!t)return"";let e="";const{x:i,y:r}=l;return l.child.forEach((n,o)=>{var h,f,u,y;const{y:s,z:c}=n;if((h=n.child)!=null&&h.length){let $=m(l.child,0)*41.4/2+(g(l.child)||0)*41.4,L=m(n.child,0)*41.4/2+g(n.child)*41.4,C=0,_=0;$<L?(C=$,_=L):[C,_]=[L,$],r>=s&&(C=$,_=L),e+=`M${24+i*68} ${C} L${24+i*68} ${_} L${68+i*68} ${_}`,e+=w(n)}(f=n.child)!=null&&f.length||(s>=r?e+=`M${24+i*68} ${r*40} L${24+i*68} ${(s+1)*41.4-20.69921875} L${68+i*68} ${(s+1)*41.4-20.69921875}`:e+=`M${24+i*68} ${(s+(t===1&&o===0?0:1)+((y=(u=l.child[o+1])==null?void 0:u.child)!=null&&y.length?r-s-1:0))*41.4+20+(t===1&&o===0?26:0)} L${24+i*68} ${(s+1)*41.4-20.69921875-(t===1&&o===0?(c||0)*1.4:0)} L${68+i*68} ${(s+1)*41.4-20.69921875-(t===1&&o===0?(c||0)*1.4:0)}`)}),e},D=(l,t)=>{l.forEach(e=>{e.child&&(e.logic=t==="and"?"or":"and",D(e.child,e.logic))})},m=(l,t)=>(l.forEach(e=>{var i;(i=e.child)!=null&&i.length?t=m(e.child,t):t+=1}),t+=1,t),T=(l,t)=>(l.child.forEach(e=>{var i;(i=e.child)!=null&&i.length?t=T(e,t):t=Math.max(t,e.y,l.y)}),t),M=(l,t)=>(l.child.forEach(e=>{var i;if(e.x=l.x+1,(i=e.child)!=null&&i.length){let r=m(e.child,0);e.y=Math.floor(r/2)+t,t=M(e,t)}else t+=1,e.y=t-1}),t+=1,t),U=(l,t)=>{a.value.push(l==="condition"?{fieldId:"",value:"",enumValue:"",term:"",filterType:"logic",name:"",timeValue:"",deType:""}:{child:[],logic:t})},X=l=>{a.value.splice(l,1)};B({init:S,submit:z});const q=Y;return(l,t)=>(V(),A("div",Z,[Q(J,{onDel:t[0]||(t[0]=e=>X(e)),onAddCondReal:U,onRemoveRelationList:G,onChangeAndOrDfs:t[1]||(t[1]=e=>D(a.value,e)),relationList:a.value,logic:v.value,"onUpdate:logic":t[2]||(t[2]=e=>v.value=e)},null,8,["relationList","logic"]),(V(),A("svg",b,[N("path",{"stroke-linejoin":"round","stroke-linecap":"round",d:O.value,fill:"none",stroke:"#CCCCCC","stroke-width":"0.5"},null,8,j)])),(V(),A("svg",tt,[N("path",{"stroke-linejoin":"round","stroke-linecap":"round",d:P.value,fill:"none",stroke:"#CCCCCC","stroke-width":"0.5","stroke-dasharray":"4,4"},null,8,et)]))]))}});const St=W(lt,[["__scopeId","data-v-b6b60d4e"]]);export{St as default};

import{M as xe}from"./index-0.0.0-dataease.js";import{E as Ce}from"./el-dialog-0.0.0-dataease.js";import{o as De,G as we,y as Te,n as Ve,j as Ee}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as Fe}from"./el-input-number-0.0.0-dataease.js";import{E as qe}from"./el-row-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Se}from"./el-popover-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as Ne,a as Le}from"./el-select-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{a as Oe,E as $e}from"./el-form-item-0.0.0-dataease.js";import{d as Me,r as C,Z as A,o as Ie,a as Je,w as ee,G as Ue,f as c,L as _,M as i,k as t,i as o,j as a,ac as te,ab as F,U as w,a5 as y,a6 as r,g as T,m as N,Y as L,a9 as O,a0 as Qe,n as ae}from"./vue-0.0.0-dataease.js";import{i as K}from"./icon_info_outlined-0.0.0-dataease.js";import{i as oe}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as le}from"./icon_adjustment_outlined-0.0.0-dataease.js";import{i as Be}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as Re}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import je from"./CodeMirror-0.0.0-dataease.js";import{H as Pe}from"./dataset-0.0.0-dataease.js";import{f as k}from"./attr-0.0.0-dataease20.js";import{g as ze}from"./util-0.0.0-dataease.js";import{i as $}from"./field-list-0.0.0-dataease.js";import{d as V}from"./lodash-0.0.0-dataease.js";import{E as Ae}from"./index-0.0.0-dataease3.js";import{_ as Ke}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./index-0.0.0-dataease17.js";import"./row-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";const Ge={class:"calcu-cont"},He={style:{flex:"1"}},Ye={style:{"max-width":"488px"}},Ze={class:"btn-select"},We={style:{display:"flex","align-items":"center"}},Xe={style:{"margin-left":"5px","font-size":"12px",color:"#8492a6"}},et={class:"mb8 field-exp"},tt={key:0},at={key:1},ot={class:"padding-lr"},lt={class:"mb8"},st={class:"padding-lr-content"},nt={class:"field-height"},it={key:0,class:"field-list"},dt=["title","onClick"],rt=["title"],ct={key:1,class:"class-na"},ut={class:"quota-btn_de"},pt={class:"field-height"},mt={key:0,class:"field-list"},_t=["onClick"],ft=["title"],vt={key:2,class:"icon-right"},gt={key:1,class:"class-na"},ht={class:"padding-lr"},yt={class:"mb8"},bt={key:0},kt={key:1},xt={class:"padding-lr-content"},Ct={key:0,style:{width:"100%"}},Dt=["onClick"],wt={class:"pop-title"},Tt={class:"pop-info"},Vt={class:"pop-info"},Et={key:1,class:"class-na"},Ft={class:"dialog-footer"},qt=Me({__name:"CalcFieldEdit",props:{crossDs:{type:Boolean,default:()=>!1}},setup(se,{expose:ne}){const{t:s}=De(),G=C(),M=C(""),I=C(""),p=C(),H=se,ie=[{label:s("dataset.text"),value:0},{label:s("dataset.time"),value:1},{label:s("dataset.value"),value:2},{label:s("dataset.value")+"("+s("dataset.float")+")",value:3},{label:s("dataset.location"),value:5},{label:"URL",value:7}],Y={originName:"",name:"",groupType:"d",type:"VARCHAR",deType:0,extField:2,id:"",params:[],checked:!0},u=A({functionData:[],dimensionData:[],dimensionList:[],quotaData:[]}),J=C(),h=A({id:null,name:"",value:null}),q=C(!1),de={name:[{required:!0,message:s("data_set.enter_parameter_name"),trigger:"blur"},{min:1,max:50,message:s("data_set.enter_1_50_characters"),trigger:"blur"}],value:[{required:!0,message:s("data_set.parameter_default_value"),trigger:"blur"}]},U=()=>{J.value.resetFields(),q.value=!1},re=()=>{J.value.validate(n=>{if(n){h.id||(h.id=`params_${ze()}`);const e=V(a(h));d.params=[e];const v=u.quotaData.find(g=>g.id===h.id);if(v){const g=p.value.state.doc.toString(),b=[];d.originName=E("name","id",g,b),Object.assign(v,V(a(h))),ae(()=>{p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:E("id","name",d.originName)}})})}else u.quotaData.push(e);U()}})},d=A({...Y}),ce=()=>{const n=p.value.state.doc.toString(),e=[];d.originName=E("name","id",n,e)},E=(n,e,v,g)=>{let b=v;const D=[...u.dimensionData,...u.quotaData].reduce((m,x)=>(m[x[n]]=x[e],m),{}),f=v.match(/\[(.+?)\]/g);return f&&f.forEach(m=>{const x=m.slice(1,-1);g&&g.push(D[x]),b=b.replace(`[${x}]`,`[${D[x]}]`)}),b};let Q=[],B=[];const ue=(n,e,v)=>{if(h.id=null,Object.assign(d,{...Y,...n}),u.dimensionData=e,u.quotaData=v.concat(d.params||[]),Q=V(v.concat(d.params||[])),B=V(e),setTimeout(()=>{j.value.clearValidate()},100),!n.originName){p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:""}});return}ae(()=>{p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:E("id","name",n.originName)}})})},Z=n=>{p.value.dispatch({changes:{from:p.value.viewState.state.selection.ranges[0].from,insert:n},selection:{anchor:p.value.viewState.state.selection.ranges[0].from}})};Ie(()=>{p.value=G.value.codeComInit()}),Je(()=>{var n,e;(e=(n=p.value).destroy)==null||e.call(n)});const pe=n=>{p.value.dispatch({changes:{from:p.value.viewState.state.selection.ranges[0].from,insert:n},selection:{anchor:p.value.viewState.state.selection.ranges[0].from}})};let R=[];const me=()=>{Pe().then(n=>{R=V(n),u.functionData=V(n)})};ee(()=>M.value,n=>{n&&n!==""?(u.dimensionData=JSON.parse(JSON.stringify(B.filter(e=>e.name.toLocaleLowerCase().includes(n.toLocaleLowerCase())&&e.extField===0))),u.quotaData=JSON.parse(JSON.stringify(Q.filter(e=>e.name.toLocaleLowerCase().includes(n.toLocaleLowerCase())&&e.extField===0)))):(u.dimensionData=JSON.parse(JSON.stringify(B)).filter(e=>e.extField===0),u.quotaData=JSON.parse(JSON.stringify(Q)).filter(e=>e.extField===0))}),ee(()=>I.value,n=>{n&&n!==""?u.functionData=JSON.parse(JSON.stringify(R.filter(e=>e.func.toLocaleLowerCase().includes(n.toLocaleLowerCase())))):u.functionData=V(R)});const j=C();ne({initEdit:ue,setFieldForm:ce,fieldForm:d,formField:j});const W=C(""),_e=()=>{P.value||(W.value=s("data_set.add_calculation_parameters"),d.params||(d.params=[]),q.value=!0)},fe=()=>{const[n]=d.params;W.value=s("data_set.edit_calculation_parameters"),Object.assign(h,n||{}),q.value=!0},P=Ue(()=>{var n;return!!((n=d.params)!=null&&n.length)}),ve=()=>{const[n]=d.params;d.params=[];const e=p.value.state.doc.toString(),v=[];d.originName=E("name","id",e,v).replaceAll(`[${n.id}]`,""),u.quotaData=u.quotaData.filter(g=>g.id!==n.id),p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:E("id","name",d.originName)}})};return me(),(n,e)=>{const v=we,g=Oe,b=$e,D=Te,f=Ve,m=Ee,x=Ne,ge=Le,S=Ae,X=xe,he=Se,ye=qe,be=Fe,ke=Ce;return c(),_("div",{onKeydown:e[11]||(e[11]=F(()=>{},["stop"])),onKeyup:e[12]||(e[12]=F(()=>{},["stop"])),class:"calcu-field"},[i("div",Ge,[i("div",He,[i("div",Ye,[t(b,{"require-asterisk-position":"right",ref_key:"formField",ref:j,onKeydown:e[1]||(e[1]=te(F(()=>{},["stop","prevent"]),["enter"])),model:d,"label-position":"top"},{default:o(()=>[t(g,{prop:"name",rules:[{required:!0,message:a(s)("dataset.input_edit_name")},{max:50,message:a(s)("commons.char_can_not_more_50")}],label:a(s)("dataset.field_edit_name")},{default:o(()=>[t(v,{modelValue:d.name,"onUpdate:modelValue":e[0]||(e[0]=l=>d.name=l),placeholder:a(s)("dataset.input_edit_name")},null,8,["modelValue","placeholder"])]),_:1},8,["rules","label"])]),_:1},8,["model"]),i("div",null,[t(b,{"label-position":"top",ref:"form",inline:"",model:d},{default:o(()=>[t(g,{class:"mr12",label:a(s)("dataset.data_type")},{default:o(()=>[i("div",Ze,[t(D,{onClick:e[2]||(e[2]=l=>d.groupType="d"),class:w([d.groupType==="d"&&"is-active"]),text:""},{default:o(()=>[y(r(a(s)("chart.dimension_abb")),1)]),_:1},8,["class"]),t(D,{onClick:e[3]||(e[3]=l=>d.groupType="q"),class:w([d.groupType==="q"&&"is-active"]),text:""},{default:o(()=>[y(r(a(s)("chart.quota_abb")),1)]),_:1},8,["class"])])]),_:1},8,["label"]),t(g,{class:"mr0",label:a(s)("dataset.field_type")},{default:o(()=>[t(ge,{modelValue:d.deType,"onUpdate:modelValue":e[4]||(e[4]=l=>d.deType=l),style:{width:"376px"}},{prefix:o(()=>[t(m,null,{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(N(a($)[a(k)[d.deType]]),{class:w(["svg-icon",`field-icon-${a(k)[d.deType]}`])},null,8,["class"]))]),_:1})]),_:1})]),default:o(()=>[(c(),_(L,null,O(ie,l=>t(x,{key:l.value,label:l.label,value:l.value},{default:o(()=>[i("span",We,[t(m,null,{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(N(a($)[a(k)[l.value]]),{class:w(["svg-icon",`field-icon-${a(k)[l.value]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),i("span",Xe,r(l.label),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),i("div",et,[i("span",null,r(a(s)("dataset.field_exp")),1),e[13]||(e[13]=i("span",null,"*",-1)),t(S,{class:"item",effect:"dark",placement:"top"},{content:o(()=>[H.crossDs?(c(),_("div",tt,r(a(s)("dataset.calc_tips.tip1")),1)):(c(),_("div",at,r(a(s)("dataset.calc_tips.tip1_1")),1)),i("div",null,r(a(s)("dataset.calc_tips.tip2")),1)]),default:o(()=>[t(m,{size:"16px"},{default:o(()=>[t(f,{name:"icon_info_outlined"},{default:o(()=>[t(a(K),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),t(je,{quotaMap:u.quotaData.map(l=>l.name),dimensionMap:u.dimensionData.map(l=>l.name),ref_key:"myCm",ref:G,height:"318px","dom-id":"calcField"},null,8,["quotaMap","dimensionMap"])])]),i("div",ot,[i("span",lt,[y(r(a(s)("dataset.click_ref_field"))+" ",1),t(S,{class:"item",effect:"dark",placement:"bottom"},{content:o(()=>[y(r(a(s)("dataset.calc_tips.tip3"))+" ",1),e[14]||(e[14]=i("br",null,null,-1)),y(" "+r(a(s)("dataset.calc_tips.tip4"))+" ",1),e[15]||(e[15]=i("br",null,null,-1)),y(" "+r(a(s)("dataset.calc_tips.tip5")),1)]),default:o(()=>[t(m,{size:"16px"},{default:o(()=>[t(f,{name:"icon_info_outlined"},{default:o(()=>[t(a(K),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",st,[t(v,{modelValue:M.value,"onUpdate:modelValue":e[5]||(e[5]=l=>M.value=l),placeholder:a(s)("dataset.edit_search"),clearable:""},{prefix:o(()=>[t(m,null,{default:o(()=>[t(f,{name:"icon_search-outline_outlined"},{default:o(()=>[t(a(oe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),i("div",nt,[t(X,null,{default:o(()=>[i("span",null,r(a(s)("chart.dimension")),1),u.dimensionData.length?(c(),_("div",it,[(c(!0),_(L,null,O(u.dimensionData,l=>(c(),_("span",{key:l.id,class:"item-dimension flex-align-center",title:l.name,onClick:z=>Z("["+l.name+"]")},[t(m,null,{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(N(a($)[a(k)[l.deType]]),{class:w(["svg-icon",`field-icon-${a(k)[l.deType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),i("span",{class:"ellipsis",title:l.name},r(l.name),9,rt)],8,dt))),128))])):(c(),_("div",ct,r(a(s)("dataset.na")),1))]),_:1})]),i("div",ut,[i("span",null,r(a(s)("chart.quota")),1),t(S,{effect:"dark",content:P.value?a(s)("data_set.parameter_is_supported"):a(s)("data_set.add_calculation_parameters"),placement:"top"},{default:o(()=>[t(m,{class:"hover-icon_quota",onClick:_e},{default:o(()=>[t(f,{class:w([`field-icon-${a(k)[0]}`,P.value&&"not-allow"]),style:{color:"#646a73"},name:"icon_adjustment_outlined"},{default:o(()=>[t(a(le),{class:"svg-icon"})]),_:1},8,["class"])]),_:1})]),_:1},8,["content"])]),i("div",pt,[t(X,null,{default:o(()=>[u.quotaData.length?(c(),_("div",mt,[(c(!0),_(L,null,O(u.quotaData,l=>(c(),_("span",{key:l.id,class:"item-quota flex-align-center",onClick:z=>Z("["+l.name+"]")},[l.groupType?(c(),T(m,{key:1},{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(N(a($)[a(k)[l.deType]]),{class:w(["svg-icon",`field-icon-${a(k)[l.deType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)):(c(),T(m,{key:0},{default:o(()=>[t(f,{name:"icon_adjustment_outlined"},{default:o(()=>[t(a(le),{class:"svg-icon"})]),_:1})]),_:1})),i("span",{class:"ellipsis",title:l.name},r(l.name),9,ft),l.groupType?Qe("",!0):(c(),_("div",vt,[t(m,{onClick:F(fe,["stop"]),class:"hover-icon"},{default:o(()=>[t(f,{name:"icon_edit_outlined"},{default:o(()=>[t(a(Be),{class:"svg-icon"})]),_:1})]),_:1}),t(m,{onClick:F(ve,["stop"]),class:"hover-icon"},{default:o(()=>[t(f,{name:"icon_delete-trash_outlined"},{default:o(()=>[t(a(Re),{class:"svg-icon"})]),_:1})]),_:1})]))],8,_t))),128))])):(c(),_("div",gt,r(a(s)("dataset.na")),1))]),_:1})])])]),i("div",ht,[i("span",yt,[y(r(a(s)("dataset.click_ref_function"))+" ",1),t(S,{class:"item",effect:"dark",placement:"bottom"},{content:o(()=>[H.crossDs?(c(),_("div",bt,[y(r(a(s)("dataset.calc_tips.tip6"))+" ",1),e[16]||(e[16]=i("br",null,null,-1)),y(" "+r(a(s)("dataset.calc_tips.tip8"))+" ",1),e[17]||(e[17]=i("br",null,null,-1)),e[18]||(e[18]=y(" https://calcite.apache.org/docs/reference.html "))])):(c(),_("div",kt,r(a(s)("dataset.calc_tips.tip7")),1))]),default:o(()=>[t(m,{size:"16px"},{default:o(()=>[t(f,{name:"icon_info_outlined"},{default:o(()=>[t(a(K),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",xt,[t(v,{modelValue:I.value,"onUpdate:modelValue":e[6]||(e[6]=l=>I.value=l),style:{"margin-bottom":"8px"},placeholder:a(s)("dataset.edit_search"),clearable:""},{prefix:o(()=>[t(m,null,{default:o(()=>[t(f,{name:"icon_search-outline_outlined"},{default:o(()=>[t(a(oe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),t(ye,{class:"function-height"},{default:o(()=>[u.functionData.length?(c(),_("div",Ct,[(c(!0),_(L,null,O(u.functionData,(l,z)=>(c(),T(he,{key:z,class:"function-pop",placement:"right",width:"200",trigger:"hover","open-delay":500},{reference:o(()=>[i("span",{class:"function-style flex-align-center",onClick:St=>pe(l.func)},r(l.func),9,Dt)]),default:o(()=>[i("p",wt,r(l.name),1),i("p",Tt,r(l.func),1),i("p",Vt,r(l.desc),1)]),_:2},1024))),128))])):(c(),_("div",Et,r(a(s)("chart.no_function")),1))]),_:1})])])]),t(ke,{"before-close":U,modelValue:q.value,"onUpdate:modelValue":e[10]||(e[10]=l=>q.value=l),"append-to-body":"",class:"create-dialog",title:a(s)("data_set.add_calculation_parameters"),width:"500"},{footer:o(()=>[i("div",Ft,[t(D,{onClick:U},{default:o(()=>[y(r(a(s)("chart.cancel")),1)]),_:1}),t(D,{type:"primary",onClick:re},{default:o(()=>[y(r(a(s)("chart.confirm")),1)]),_:1})])]),default:o(()=>[t(b,{onKeydown:e[9]||(e[9]=te(F(()=>{},["stop","prevent"]),["enter"])),"label-position":"top",ref_key:"formQuotaRef",ref:J,model:h,rules:de},{default:o(()=>[t(g,{label:a(s)("data_set.parameter_name"),prop:"name"},{default:o(()=>[t(v,{style:{width:"100%"},modelValue:h.name,"onUpdate:modelValue":e[7]||(e[7]=l=>h.name=l),placeholder:a(s)("data_set.enter_1_50_characters")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:a(s)("data_set.parameter_default_value_de"),prop:"value"},{default:o(()=>[t(be,{style:{width:"100%"},modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=l=>h.value=l),placeholder:a(s)("data_set.enter_a_number"),"controls-position":"right"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],32)}}});const va=Ke(qt,[["__scopeId","data-v-f1798ec1"]]);export{va as default};

import{r as xe,w as Ce,v as we,h as De,d as Te,x as Ve,y as Fe,e as qe,a as Se,f as Ne,o as Ee,A as Le,L as $e}from"./element-plus-secondary-0.0.0-dataease.js";import{j as Oe,h as Me}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as Ie,r as C,l as j,b as Je,e as Qe,w as ee,k as Ue,o as c,c as _,a as i,a0 as t,_ as o,u as a,ac as te,a1 as q,z as D,a4 as y,a2 as d,Z as T,$ as E,M as L,ab as $,Y as Be,n as ae}from"./@vue-0.0.0-dataease.js";import{i as K}from"./icon_info_outlined-0.0.0-dataease.js";import{i as oe}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as le}from"./icon_adjustment_outlined-0.0.0-dataease.js";import{i as Re}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as ze}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import Ae from"./CodeMirror-0.0.0-dataease2.js";import{H as Pe}from"./dataset-0.0.0-dataease.js";import{f as k}from"./attr-0.0.0-dataease20.js";import{g as je}from"./util-0.0.0-dataease.js";import{i as O}from"./field-list-0.0.0-dataease.js";import{e as V}from"./lodash-es-0.0.0-dataease.js";import{_ as Ke}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./@codemirror-0.0.0-dataease.js";import"./@lezer-0.0.0-dataease.js";import"./style-mod-0.0.0-dataease.js";import"./crelt-0.0.0-dataease.js";import"./@marijn-0.0.0-dataease.js";import"./w3c-keyname-0.0.0-dataease.js";import"./codemirror-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";const He={class:"calcu-cont"},Ye={style:{flex:"1"}},Ze={style:{"max-width":"488px"}},Ge={class:"btn-select"},We={style:{display:"flex","align-items":"center"}},Xe={style:{"margin-left":"5px","font-size":"12px",color:"#8492a6"}},et={class:"mb8 field-exp"},tt={key:0},at={key:1},ot={class:"padding-lr"},lt={class:"mb8"},st={class:"padding-lr-content"},nt={class:"field-height"},it={key:0,class:"field-list"},rt=["title","onClick"],dt=["title"],ct={key:1,class:"class-na"},ut={class:"quota-btn_de"},pt={class:"field-height"},mt={key:0,class:"field-list"},_t=["onClick"],ft=["title"],vt={key:2,class:"icon-right"},gt={key:1,class:"class-na"},ht={class:"padding-lr"},yt={class:"mb8"},bt={key:0},kt={key:1},xt={class:"padding-lr-content"},Ct={key:0,style:{width:"100%"}},wt=["onClick"],Dt={class:"pop-title"},Tt={class:"pop-info"},Vt={class:"pop-info"},Ft={key:1,class:"class-na"},qt={class:"dialog-footer"},St=Ie({__name:"CalcFieldEdit",props:{crossDs:{type:Boolean,default:()=>!1}},setup(se,{expose:ne}){const{t:s}=Oe(),H=C(),M=C(""),I=C(""),p=C(),Y=se,ie=[{label:s("dataset.text"),value:0},{label:s("dataset.time"),value:1},{label:s("dataset.value"),value:2},{label:s("dataset.value")+"("+s("dataset.float")+")",value:3},{label:s("dataset.location"),value:5},{label:"URL",value:7}],Z={originName:"",name:"",groupType:"d",type:"VARCHAR",deType:0,extField:2,id:"",params:[],checked:!0},u=j({functionData:[],dimensionData:[],dimensionList:[],quotaData:[]}),J=C(),h=j({id:null,name:"",value:null}),S=C(!1),re={name:[{required:!0,message:s("data_set.enter_parameter_name"),trigger:"blur"},{min:1,max:50,message:s("data_set.enter_1_50_characters"),trigger:"blur"}],value:[{required:!0,message:s("data_set.parameter_default_value"),trigger:"blur"}]},Q=()=>{J.value.resetFields(),S.value=!1},de=()=>{J.value.validate(n=>{if(n){h.id||(h.id=`params_${je()}`);const e=V(a(h));r.params=[e];const v=u.quotaData.find(g=>g.id===h.id);if(v){const g=p.value.state.doc.toString(),b=[];r.originName=F("name","id",g,b),Object.assign(v,V(a(h))),ae(()=>{p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:F("id","name",r.originName)}})})}else u.quotaData.push(e);Q()}})},r=j({...Z}),ce=()=>{const n=p.value.state.doc.toString(),e=[];r.originName=F("name","id",n,e)},F=(n,e,v,g)=>{let b=v;const w=[...u.dimensionData,...u.quotaData].reduce((m,x)=>(m[x[n]]=x[e],m),{}),f=v.match(/\[(.+?)\]/g);return f&&f.forEach(m=>{const x=m.slice(1,-1);g&&g.push(w[x]),b=b.replace(`[${x}]`,`[${w[x]}]`)}),b};let U=[],B=[];const ue=(n,e,v)=>{if(h.id=null,Object.assign(r,{...Z,...n}),u.dimensionData=e,u.quotaData=v.concat(r.params||[]),U=V(v.concat(r.params||[])),B=V(e),setTimeout(()=>{z.value.clearValidate()},100),!n.originName){p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:""}});return}ae(()=>{p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:F("id","name",n.originName)}})})},G=n=>{p.value.dispatch({changes:{from:p.value.viewState.state.selection.ranges[0].from,insert:n},selection:{anchor:p.value.viewState.state.selection.ranges[0].from}})};Je(()=>{p.value=H.value.codeComInit()}),Qe(()=>{var n,e;(e=(n=p.value).destroy)==null||e.call(n)});const pe=n=>{p.value.dispatch({changes:{from:p.value.viewState.state.selection.ranges[0].from,insert:n},selection:{anchor:p.value.viewState.state.selection.ranges[0].from}})};let R=[];const me=()=>{Pe().then(n=>{R=V(n),u.functionData=V(n)})};ee(()=>M.value,n=>{n&&n!==""?(u.dimensionData=JSON.parse(JSON.stringify(B.filter(e=>e.name.toLocaleLowerCase().includes(n.toLocaleLowerCase())&&e.extField===0))),u.quotaData=JSON.parse(JSON.stringify(U.filter(e=>e.name.toLocaleLowerCase().includes(n.toLocaleLowerCase())&&e.extField===0)))):(u.dimensionData=JSON.parse(JSON.stringify(B)).filter(e=>e.extField===0),u.quotaData=JSON.parse(JSON.stringify(U)).filter(e=>e.extField===0))}),ee(()=>I.value,n=>{n&&n!==""?u.functionData=JSON.parse(JSON.stringify(R.filter(e=>e.func.toLocaleLowerCase().includes(n.toLocaleLowerCase())))):u.functionData=V(R)});const z=C();ne({initEdit:ue,setFieldForm:ce,fieldForm:r,formField:z});const W=C(""),_e=()=>{A.value||(W.value=s("data_set.add_calculation_parameters"),r.params||(r.params=[]),S.value=!0)},fe=()=>{const[n]=r.params;W.value=s("data_set.edit_calculation_parameters"),Object.assign(h,n||{}),S.value=!0},A=Ue(()=>{var n;return!!((n=r.params)!=null&&n.length)}),ve=()=>{const[n]=r.params;r.params=[];const e=p.value.state.doc.toString(),v=[];r.originName=F("name","id",e,v).replaceAll(`[${n.id}]`,""),u.quotaData=u.quotaData.filter(g=>g.id!==n.id),p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:F("id","name",r.originName)}})};return me(),(n,e)=>{const v=xe,g=Ce,b=we,w=De,f=Me,m=Te,x=Ve,ge=Fe,N=qe,X=Se,he=Ne,ye=Ee,be=Le,ke=$e;return c(),_("div",{onKeydown:e[11]||(e[11]=q(()=>{},["stop"])),onKeyup:e[12]||(e[12]=q(()=>{},["stop"])),class:"calcu-field"},[i("div",He,[i("div",Ye,[i("div",Ze,[t(b,{"require-asterisk-position":"right",ref_key:"formField",ref:z,onKeydown:e[1]||(e[1]=te(q(()=>{},["stop","prevent"]),["enter"])),model:r,"label-position":"top"},{default:o(()=>[t(g,{prop:"name",rules:[{required:!0,message:a(s)("dataset.input_edit_name")},{max:50,message:a(s)("commons.char_can_not_more_50")}],label:a(s)("dataset.field_edit_name")},{default:o(()=>[t(v,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=l=>r.name=l),placeholder:a(s)("dataset.input_edit_name")},null,8,["modelValue","placeholder"])]),_:1},8,["rules","label"])]),_:1},8,["model"]),i("div",null,[t(b,{"label-position":"top",ref:"form",inline:"",model:r},{default:o(()=>[t(g,{class:"mr12",label:a(s)("dataset.data_type")},{default:o(()=>[i("div",Ge,[t(w,{onClick:e[2]||(e[2]=l=>r.groupType="d"),class:D([r.groupType==="d"&&"is-active"]),text:""},{default:o(()=>[y(d(a(s)("chart.dimension_abb")),1)]),_:1},8,["class"]),t(w,{onClick:e[3]||(e[3]=l=>r.groupType="q"),class:D([r.groupType==="q"&&"is-active"]),text:""},{default:o(()=>[y(d(a(s)("chart.quota_abb")),1)]),_:1},8,["class"])])]),_:1},8,["label"]),t(g,{class:"mr0",label:a(s)("dataset.field_type")},{default:o(()=>[t(ge,{modelValue:r.deType,"onUpdate:modelValue":e[4]||(e[4]=l=>r.deType=l),style:{width:"376px"}},{prefix:o(()=>[t(m,null,{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(E(a(O)[a(k)[r.deType]]),{class:D(["svg-icon",`field-icon-${a(k)[r.deType]}`])},null,8,["class"]))]),_:1})]),_:1})]),default:o(()=>[(c(),_(L,null,$(ie,l=>t(x,{key:l.value,label:l.label,value:l.value},{default:o(()=>[i("span",We,[t(m,null,{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(E(a(O)[a(k)[l.value]]),{class:D(["svg-icon",`field-icon-${a(k)[l.value]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),i("span",Xe,d(l.label),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),i("div",et,[i("span",null,d(a(s)("dataset.field_exp")),1),e[13]||(e[13]=i("span",null,"*",-1)),t(N,{class:"item",effect:"dark",placement:"top"},{content:o(()=>[Y.crossDs?(c(),_("div",tt,d(a(s)("dataset.calc_tips.tip1")),1)):(c(),_("div",at,d(a(s)("dataset.calc_tips.tip1_1")),1)),i("div",null,d(a(s)("dataset.calc_tips.tip2")),1)]),default:o(()=>[t(m,{size:"16px"},{default:o(()=>[t(f,{name:"icon_info_outlined"},{default:o(()=>[t(a(K),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),t(Ae,{quotaMap:u.quotaData.map(l=>l.name),dimensionMap:u.dimensionData.map(l=>l.name),ref_key:"myCm",ref:H,height:"318px","dom-id":"calcField"},null,8,["quotaMap","dimensionMap"])])]),i("div",ot,[i("span",lt,[y(d(a(s)("dataset.click_ref_field"))+" ",1),t(N,{class:"item",effect:"dark",placement:"bottom"},{content:o(()=>[y(d(a(s)("dataset.calc_tips.tip3"))+" ",1),e[14]||(e[14]=i("br",null,null,-1)),y(" "+d(a(s)("dataset.calc_tips.tip4"))+" ",1),e[15]||(e[15]=i("br",null,null,-1)),y(" "+d(a(s)("dataset.calc_tips.tip5")),1)]),default:o(()=>[t(m,{size:"16px"},{default:o(()=>[t(f,{name:"icon_info_outlined"},{default:o(()=>[t(a(K),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",st,[t(v,{modelValue:M.value,"onUpdate:modelValue":e[5]||(e[5]=l=>M.value=l),placeholder:a(s)("dataset.edit_search"),clearable:""},{prefix:o(()=>[t(m,null,{default:o(()=>[t(f,{name:"icon_search-outline_outlined"},{default:o(()=>[t(a(oe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),i("div",nt,[t(X,null,{default:o(()=>[i("span",null,d(a(s)("chart.dimension")),1),u.dimensionData.length?(c(),_("div",it,[(c(!0),_(L,null,$(u.dimensionData,l=>(c(),_("span",{key:l.id,class:"item-dimension flex-align-center",title:l.name,onClick:P=>G("["+l.name+"]")},[t(m,null,{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(E(a(O)[a(k)[l.deType]]),{class:D(["svg-icon",`field-icon-${a(k)[l.deType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),i("span",{class:"ellipsis",title:l.name},d(l.name),9,dt)],8,rt))),128))])):(c(),_("div",ct,d(a(s)("dataset.na")),1))]),_:1})]),i("div",ut,[i("span",null,d(a(s)("chart.quota")),1),t(N,{effect:"dark",content:A.value?a(s)("data_set.parameter_is_supported"):a(s)("data_set.add_calculation_parameters"),placement:"top"},{default:o(()=>[t(m,{class:"hover-icon_quota",onClick:_e},{default:o(()=>[t(f,{class:D([`field-icon-${a(k)[0]}`,A.value&&"not-allow"]),style:{color:"#646a73"},name:"icon_adjustment_outlined"},{default:o(()=>[t(a(le),{class:"svg-icon"})]),_:1},8,["class"])]),_:1})]),_:1},8,["content"])]),i("div",pt,[t(X,null,{default:o(()=>[u.quotaData.length?(c(),_("div",mt,[(c(!0),_(L,null,$(u.quotaData,l=>(c(),_("span",{key:l.id,class:"item-quota flex-align-center",onClick:P=>G("["+l.name+"]")},[l.groupType?(c(),T(m,{key:1},{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(E(a(O)[a(k)[l.deType]]),{class:D(["svg-icon",`field-icon-${a(k)[l.deType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)):(c(),T(m,{key:0},{default:o(()=>[t(f,{name:"icon_adjustment_outlined"},{default:o(()=>[t(a(le),{class:"svg-icon"})]),_:1})]),_:1})),i("span",{class:"ellipsis",title:l.name},d(l.name),9,ft),l.groupType?Be("",!0):(c(),_("div",vt,[t(m,{onClick:q(fe,["stop"]),class:"hover-icon"},{default:o(()=>[t(f,{name:"icon_edit_outlined"},{default:o(()=>[t(a(Re),{class:"svg-icon"})]),_:1})]),_:1}),t(m,{onClick:q(ve,["stop"]),class:"hover-icon"},{default:o(()=>[t(f,{name:"icon_delete-trash_outlined"},{default:o(()=>[t(a(ze),{class:"svg-icon"})]),_:1})]),_:1})]))],8,_t))),128))])):(c(),_("div",gt,d(a(s)("dataset.na")),1))]),_:1})])])]),i("div",ht,[i("span",yt,[y(d(a(s)("dataset.click_ref_function"))+" ",1),t(N,{class:"item",effect:"dark",placement:"bottom"},{content:o(()=>[Y.crossDs?(c(),_("div",bt,[y(d(a(s)("dataset.calc_tips.tip6"))+" ",1),e[16]||(e[16]=i("br",null,null,-1)),y(" "+d(a(s)("dataset.calc_tips.tip8"))+" ",1),e[17]||(e[17]=i("br",null,null,-1)),e[18]||(e[18]=y(" https://calcite.apache.org/docs/reference.html "))])):(c(),_("div",kt,d(a(s)("dataset.calc_tips.tip7")),1))]),default:o(()=>[t(m,{size:"16px"},{default:o(()=>[t(f,{name:"icon_info_outlined"},{default:o(()=>[t(a(K),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",xt,[t(v,{modelValue:I.value,"onUpdate:modelValue":e[6]||(e[6]=l=>I.value=l),style:{"margin-bottom":"8px"},placeholder:a(s)("dataset.edit_search"),clearable:""},{prefix:o(()=>[t(m,null,{default:o(()=>[t(f,{name:"icon_search-outline_outlined"},{default:o(()=>[t(a(oe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),t(ye,{class:"function-height"},{default:o(()=>[u.functionData.length?(c(),_("div",Ct,[(c(!0),_(L,null,$(u.functionData,(l,P)=>(c(),T(he,{key:P,class:"function-pop",placement:"right",width:"200",trigger:"hover","open-delay":500},{reference:o(()=>[i("span",{class:"function-style flex-align-center",onClick:Nt=>pe(l.func)},d(l.func),9,wt)]),default:o(()=>[i("p",Dt,d(l.name),1),i("p",Tt,d(l.func),1),i("p",Vt,d(l.desc),1)]),_:2},1024))),128))])):(c(),_("div",Ft,d(a(s)("chart.no_function")),1))]),_:1})])])]),t(ke,{"before-close":Q,modelValue:S.value,"onUpdate:modelValue":e[10]||(e[10]=l=>S.value=l),"append-to-body":"",class:"create-dialog",title:a(s)("data_set.add_calculation_parameters"),width:"500"},{footer:o(()=>[i("div",qt,[t(w,{onClick:Q},{default:o(()=>[y(d(a(s)("chart.cancel")),1)]),_:1}),t(w,{type:"primary",onClick:de},{default:o(()=>[y(d(a(s)("chart.confirm")),1)]),_:1})])]),default:o(()=>[t(b,{onKeydown:e[9]||(e[9]=te(q(()=>{},["stop","prevent"]),["enter"])),"label-position":"top",ref_key:"formQuotaRef",ref:J,model:h,rules:re},{default:o(()=>[t(g,{label:a(s)("data_set.parameter_name"),prop:"name"},{default:o(()=>[t(v,{style:{width:"100%"},modelValue:h.name,"onUpdate:modelValue":e[7]||(e[7]=l=>h.name=l),placeholder:a(s)("data_set.enter_1_50_characters")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:a(s)("data_set.parameter_default_value_de"),prop:"value"},{default:o(()=>[t(be,{style:{width:"100%"},modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=l=>h.value=l),placeholder:a(s)("data_set.enter_a_number"),"controls-position":"right"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],32)}}});const Za=Ke(St,[["__scopeId","data-v-f1798ec1"]]);export{Za as default};

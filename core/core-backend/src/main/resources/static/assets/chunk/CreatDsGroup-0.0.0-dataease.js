import{a as fe}from"./index-0.0.0-dataease.js";import{E as ve}from"./el-dialog-0.0.0-dataease.js";import{o as he,ay as ge,D as x,G as be,n as ke,j as ye,y as De}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as we}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Te}from"./el-tree-select-0.0.0-dataease.js";import{a as Ve,E as xe}from"./el-form-item-0.0.0-dataease.js";import{d as Ee,Z as z,r as n,w as Ce,G as E,aa as Fe,f as v,g as C,i as s,j as c,k as r,a5 as H,a6 as y,T as Ne,a0 as F,M as h,L as J,ac as qe,ab as Se,n as O}from"./vue-0.0.0-dataease.js";import{d as Z}from"./dv-folder-0.0.0-dataease.js";import{i as Ie}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{t as Ge}from"./treeSortUtils-0.0.0-dataease.js";import{g as Le,m as Me,J as Be,K as Re}from"./dataset-0.0.0-dataease.js";import{n as Ue}from"./nothing-tree-0.0.0-dataease.js";import{d as Ae}from"./lodash-0.0.0-dataease.js";import{_ as Ke}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./index-0.0.0-dataease13.js";import"./index-0.0.0-dataease3.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";const je=["title"],Pe={key:2},$e={class:"tree-content"},ze={class:"custom-tree-node"},He=["title"],Je={key:0,class:"empty-search"},Oe=["src"],Ze=Ee({__name:"CreatDsGroup",emits:["finish","onDatasetSave"],setup(Qe,{expose:Q,emit:W}){const{t:a}=he(),{wsCache:S}=fe(),u=z({tData:[],nameList:[]}),D=n(""),f=n(),m=n(),g=n(),i=n(""),N=n(),w=n("");let I=[],G=[];const o=z({pid:"",name:""}),L=n(!1),X=(t,e)=>(O(()=>{L.value=N.value.isEmpty}),t?e.name.includes(t):!0);Ce(w,t=>{oe.value=!t,N.value.filter(t),O(()=>{document.querySelectorAll(".node-text").forEach(e=>{const d=e.getAttribute("title");e.innerHTML=d.replace(t,`<span class="highLight">${t}</span>`)})})});const Y=E(()=>f.value==="folder"&&m.value?!1:!["rename","move"].includes(i.value)&&!!m.value),ee=E(()=>f.value==="folder"?a("deDataset.folder_name"):a("dataset.name")),te=E(()=>{let t="";switch(f.value){case"folder":t=a("deDataset.new_folder");break;case"dataset":t=a("common.save")+a("auth.dataset");break}switch(i.value){case"move":t=a("chart.move_to");break;case"rename":t=a("chart.rename");break}return t}),ae=E(()=>i.value!=="move"),M=n(),B=n(!1),oe=n(!0),T=n(),q=n(!1),b=n(!1),se=(t,e)=>e.name.includes(t),R=()=>{b.value=!1},U=t=>{t==null||t.forEach(e=>{var d;e.value=e.id,(d=e.children)!=null&&d.length&&U(e.children)})},le=(t,e)=>e!=null&&e.length?t==="0"&&e[0].id!=="0"?e[0].id:t:"",A=n([]),ne=["time_asc","time_desc","name_asc","name_desc"],re=(t,e,d,p)=>{m.value="",g.value="",i.value="",o.pid="",o.name="",w.value="",f.value=t,D.value=a(t==="folder"?"data_set.a_folder_name":"data_set.the_dataset_name"),t==="dataset"&&(I=e.union,G=e.allfields),e.id&&(Le({leaf:!1,weight:7}).then(_=>{ge(_,"dataset"),U(_),u.tData=_||[];let k=ne[Number(S.get("TreeSort-backend"))??1];k=S.get("TreeSort-dataset")??k,A.value=Ae(c(u.tData)),u.tData=Ge(A.value,k),u.tData.length&&u.tData[0].name==="root"&&u.tData[0].id==="0"&&(u.tData[0].name=a("data_set.data_set")),e.id=le(e.id,u.tData),d?(m.value=e.pid,g.value=e.id,o.pid=e.pid,o.name=e.name):(o.pid=e.id,m.value=e.id)}),i.value=d),p&&(o.name=p),b.value=!0,M.value={name:[{required:!0,message:D.value,trigger:"change"},{required:!0,message:D.value,trigger:"blur"},{min:1,max:64,message:a("datasource.input_limit_1_64",[1,64]),trigger:"blur"}],pid:[{required:!0,message:a("common.please_select"),trigger:"blur"}]},setTimeout(()=>{T.value.clearValidate()},50)},ie=t=>{m.value=t.pid,g.value=t.id},K={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},j=t=>{B.value=!1,o.pid=t.id},de=t=>t!==0&&!t?(x.error(a("data_set.the_destination_folder")),!1):!0,ue=()=>{T.value.validate(t=>{if(t){const e={nodeType:f.value,name:o.name};switch(i.value){case"move":e.pid=B.value?"0":o.pid,e.id=g.value;break;case"rename":e.pid=m.value,e.id=g.value;break;default:e.pid=o.pid||m.value||"0";break}if(f.value==="dataset"&&(e.union=I,e.allFields=G),i.value==="move"&&!de(e.pid))return;q.value=!0,(i.value==="move"?Me:e.id?Be:Re)(e).then(p=>{switch(T.value.resetFields(),b.value=!1,P("finish",p),i.value){case"move":x.success(a("data_set.moved_successfully"));break;case"rename":x.success(a("data_set.rename_successful"));break;default:P("onDatasetSave"),x.success(a("common.save_success"));break}}).finally(()=>{q.value=!1})}})};Q({createInit:re,editeInit:ie});const P=W;return(t,e)=>{const d=be,p=Ve,V=ke,_=ye,k=Te,ce=we,me=xe,$=De,pe=ve,_e=Fe("loading");return v(),C(pe,{title:te.value,modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),class:"create-dialog",width:i.value==="move"?"600px":"420px","before-close":R},{footer:s(()=>[r($,{secondary:"",onClick:R},{default:s(()=>[H(y(c(a)("dataset.cancel")),1)]),_:1}),Ne((v(),C($,{type:"primary",onClick:ue},{default:s(()=>[H(y(c(a)("dataset.confirm")),1)]),_:1})),[[_e,q.value]])]),default:s(()=>[r(me,{"label-position":"top","require-asterisk-position":"right",ref_key:"dataset",ref:T,onKeydown:e[4]||(e[4]=qe(Se(()=>{},["stop","prevent"]),["enter"])),model:o,rules:M.value},{default:s(()=>[ae.value?(v(),C(p,{key:0,label:ee.value,prop:"name"},{default:s(()=>[r(d,{placeholder:D.value,modelValue:o.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.name=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):F("",!0),Y.value?(v(),C(p,{key:1,label:c(a)("deDataset.folder"),prop:"pid"},{default:s(()=>[r(k,{modelValue:o.pid,"onUpdate:modelValue":e[1]||(e[1]=l=>o.pid=l),data:u.tData,"popper-class":"dataset-tree-select","render-after-expand":!1,style:{width:"100%"},props:K,onNodeClick:j,"filter-node-method":se,filterable:""},{default:s(({data:{name:l}})=>[r(_,null,{default:s(()=>[r(V,{name:"dv-folder"},{default:s(()=>[r(c(Z),{class:"svg-icon"})]),_:1})]),_:1}),h("span",{title:l},y(l),9,je)]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):F("",!0),i.value==="move"?(v(),J("div",Pe,[r(d,{style:{"margin-bottom":"12px"},modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l),clearable:""},{prefix:s(()=>[r(_,null,{default:s(()=>[r(V,{name:"icon_search-outline_outlined"},{default:s(()=>[r(c(Ie),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),h("div",$e,[r(ce,{ref_key:"treeRef",ref:N,"filter-node-method":X,filterable:"",modelValue:o.pid,"onUpdate:modelValue":e[3]||(e[3]=l=>o.pid=l),menu:"","empty-text":"",data:u.tData,props:K,onNodeClick:j},{default:s(({data:l})=>[h("span",ze,[r(_,{style:{"font-size":"18px"}},{default:s(()=>[r(V,{name:"dv-folder"},{default:s(()=>[r(c(Z),{class:"svg-icon"})]),_:1})]),_:1}),h("span",{class:"node-text",title:l.name},y(l.name),9,He)])]),_:1},8,["modelValue","data"]),L.value?(v(),J("div",Je,[h("img",{src:c(Ue)},null,8,Oe),h("span",null,y(c(a)("data_set.relevant_content_found")),1)])):F("",!0)])])):F("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","width"])}}});const Et=Ke(Ze,[["__scopeId","data-v-504157b4"]]);export{Et as default};

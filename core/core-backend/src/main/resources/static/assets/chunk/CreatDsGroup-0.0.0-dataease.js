import{L as fe,p as T,r as ve,w as he,d as ge,s as be,t as ke,v as ye,h as De}from"./element-plus-secondary-0.0.0-dataease.js";import{j as we,R as Ve,h as xe}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as Te,l as z,r,w as Ce,k as C,ak as Ee,o as v,Z as E,_ as s,u,a0 as i,a4 as H,a2 as y,W as Fe,Y as F,a as h,c as J,ac as Ne,a1 as qe,n as O}from"./@vue-0.0.0-dataease.js";import{d as W}from"./dv-folder-0.0.0-dataease.js";import{i as Se}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{t as Ie}from"./treeSortUtils-0.0.0-dataease.js";import{a as Le}from"./index-0.0.0-dataease.js";import{g as Re,m as Be,J as Me,K as Ue}from"./dataset-0.0.0-dataease.js";import{n as Ae}from"./nothing-tree-0.0.0-dataease.js";import{e as Ge}from"./lodash-es-0.0.0-dataease.js";import{_ as Ke}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";const Pe=["title"],$e={key:2},je={class:"tree-content"},ze={class:"custom-tree-node"},He=["title"],Je={key:0,class:"empty-search"},Oe=["src"],We=Te({__name:"CreatDsGroup",emits:["finish","onDatasetSave"],setup(Ye,{expose:Y,emit:Z}){const{t:a}=we(),{wsCache:S}=Le(),m=z({tData:[],nameList:[]}),D=r(""),f=r(),c=r(),g=r(),n=r(""),N=r(),w=r("");let I=[],L=[];const o=z({pid:"",name:""}),R=r(!1),Q=(t,e)=>(O(()=>{R.value=N.value.isEmpty}),t?e.name.includes(t):!0);Ce(w,t=>{oe.value=!t,N.value.filter(t),O(()=>{document.querySelectorAll(".node-text").forEach(e=>{const d=e.getAttribute("title");e.innerHTML=d.replace(t,`<span class="highLight">${t}</span>`)})})});const X=C(()=>f.value==="folder"&&c.value?!1:!["rename","move"].includes(n.value)&&!!c.value),ee=C(()=>f.value==="folder"?a("deDataset.folder_name"):a("dataset.name")),te=C(()=>{let t="";switch(f.value){case"folder":t=a("deDataset.new_folder");break;case"dataset":t=a("common.save")+a("auth.dataset");break}switch(n.value){case"move":t=a("chart.move_to");break;case"rename":t=a("chart.rename");break}return t}),ae=C(()=>n.value!=="move"),B=r(),M=r(!1),oe=r(!0),V=r(),q=r(!1),b=r(!1),se=(t,e)=>e.name.includes(t),U=()=>{b.value=!1},A=t=>{t==null||t.forEach(e=>{var d;e.value=e.id,(d=e.children)!=null&&d.length&&A(e.children)})},le=(t,e)=>e!=null&&e.length?t==="0"&&e[0].id!=="0"?e[0].id:t:"",G=r([]),re=["time_asc","time_desc","name_asc","name_desc"],ie=(t,e,d,p)=>{c.value="",g.value="",n.value="",o.pid="",o.name="",w.value="",f.value=t,D.value=a(t==="folder"?"data_set.a_folder_name":"data_set.the_dataset_name"),t==="dataset"&&(I=e.union,L=e.allfields),e.id&&(Re({leaf:!1,weight:7}).then(_=>{Ve(_,"dataset"),A(_),m.tData=_||[];let k=re[Number(S.get("TreeSort-backend"))??1];k=S.get("TreeSort-dataset")??k,G.value=Ge(u(m.tData)),m.tData=Ie(G.value,k),m.tData.length&&m.tData[0].name==="root"&&m.tData[0].id==="0"&&(m.tData[0].name=a("data_set.data_set")),e.id=le(e.id,m.tData),d?(c.value=e.pid,g.value=e.id,o.pid=e.pid,o.name=e.name):(o.pid=e.id,c.value=e.id)}),n.value=d),p&&(o.name=p),b.value=!0,B.value={name:[{required:!0,message:D.value,trigger:"change"},{required:!0,message:D.value,trigger:"blur"},{min:1,max:64,message:a("datasource.input_limit_1_64",[1,64]),trigger:"blur"}],pid:[{required:!0,message:a("common.please_select"),trigger:"blur"}]},setTimeout(()=>{V.value.clearValidate()},50)},ne=t=>{c.value=t.pid,g.value=t.id},K={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},P=t=>{M.value=!1,o.pid=t.id},de=t=>t!==0&&!t?(T.error(a("data_set.the_destination_folder")),!1):!0,me=()=>{V.value.validate(t=>{if(t){const e={nodeType:f.value,name:o.name};switch(n.value){case"move":e.pid=M.value?"0":o.pid,e.id=g.value;break;case"rename":e.pid=c.value,e.id=g.value;break;default:e.pid=o.pid||c.value||"0";break}if(f.value==="dataset"&&(e.union=I,e.allFields=L),n.value==="move"&&!de(e.pid))return;q.value=!0,(n.value==="move"?Be:e.id?Me:Ue)(e).then(p=>{switch(V.value.resetFields(),b.value=!1,$("finish",p),n.value){case"move":T.success(a("data_set.moved_successfully"));break;case"rename":T.success(a("data_set.rename_successful"));break;default:$("onDatasetSave"),T.success(a("common.save_success"));break}}).finally(()=>{q.value=!1})}})};Y({createInit:ie,editeInit:ne});const $=Z;return(t,e)=>{const d=ve,p=he,x=xe,_=ge,k=be,ue=ke,ce=ye,j=De,pe=fe,_e=Ee("loading");return v(),E(pe,{title:te.value,modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),class:"create-dialog",width:n.value==="move"?"600px":"420px","before-close":U},{footer:s(()=>[i(j,{secondary:"",onClick:U},{default:s(()=>[H(y(u(a)("dataset.cancel")),1)]),_:1}),Fe((v(),E(j,{type:"primary",onClick:me},{default:s(()=>[H(y(u(a)("dataset.confirm")),1)]),_:1})),[[_e,q.value]])]),default:s(()=>[i(ce,{"label-position":"top","require-asterisk-position":"right",ref_key:"dataset",ref:V,onKeydown:e[4]||(e[4]=Ne(qe(()=>{},["stop","prevent"]),["enter"])),model:o,rules:B.value},{default:s(()=>[ae.value?(v(),E(p,{key:0,label:ee.value,prop:"name"},{default:s(()=>[i(d,{placeholder:D.value,modelValue:o.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.name=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):F("",!0),X.value?(v(),E(p,{key:1,label:u(a)("deDataset.folder"),prop:"pid"},{default:s(()=>[i(k,{modelValue:o.pid,"onUpdate:modelValue":e[1]||(e[1]=l=>o.pid=l),data:m.tData,"popper-class":"dataset-tree-select","render-after-expand":!1,style:{width:"100%"},props:K,onNodeClick:P,"filter-node-method":se,filterable:""},{default:s(({data:{name:l}})=>[i(_,null,{default:s(()=>[i(x,{name:"dv-folder"},{default:s(()=>[i(u(W),{class:"svg-icon"})]),_:1})]),_:1}),h("span",{title:l},y(l),9,Pe)]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):F("",!0),n.value==="move"?(v(),J("div",$e,[i(d,{style:{"margin-bottom":"12px"},modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l),clearable:""},{prefix:s(()=>[i(_,null,{default:s(()=>[i(x,{name:"icon_search-outline_outlined"},{default:s(()=>[i(u(Se),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),h("div",je,[i(ue,{ref_key:"treeRef",ref:N,"filter-node-method":Q,filterable:"",modelValue:o.pid,"onUpdate:modelValue":e[3]||(e[3]=l=>o.pid=l),menu:"","empty-text":"",data:m.tData,props:K,onNodeClick:P},{default:s(({data:l})=>[h("span",ze,[i(_,{style:{"font-size":"18px"}},{default:s(()=>[i(x,{name:"dv-folder"},{default:s(()=>[i(u(W),{class:"svg-icon"})]),_:1})]),_:1}),h("span",{class:"node-text",title:l.name},y(l.name),9,He)])]),_:1},8,["modelValue","data"]),R.value?(v(),J("div",Je,[h("img",{src:u(Ae)},null,8,Oe),h("span",null,y(u(a)("data_set.relevant_content_found")),1)])):F("",!0)])])):F("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","width"])}}});const aa=Ke(We,[["__scopeId","data-v-504157b4"]]);export{aa as default};

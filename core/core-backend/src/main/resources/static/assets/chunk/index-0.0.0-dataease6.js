import{q as Tt,p as pe,r as Rl,h as Bl,e as Ol,s as Gl,R as jl,t as Yl,T as Zl,W as Pl,D as Xl,X as zl,L as Wl,d as k,Y as Jl,Q as Kl,V as Ql,C as eo,w as to,v as ao,B as lo,x as oo,y as so,o as no,A as io,Z as ro,a as uo}from"./element-plus-secondary-0.0.0-dataease.js";import{o as c,c as w,aW as ka,d as co,r as _,l as xt,w as mo,x as Oe,k as Ge,b as po,e as fo,n as fe,ak as vo,W as J,a as m,a0 as l,_ as s,u as a,M as ne,a2 as f,Y as $,X as ke,a3 as je,z as S,a4 as T,Z as C,h as _o,q as go,v as ho,$ as O,ab as Ve,s as yo}from"./@vue-0.0.0-dataease.js";import{d as bo}from"./dv-folder-0.0.0-dataease.js";import{i as va}from"./icon_left_outlined-0.0.0-dataease.js";import{i as Co}from"./icon_right_outlined-0.0.0-dataease.js";import{r as _a}from"./AddSql-0.0.0-dataease.js";import{i as wo}from"./icon_organization_outlined-0.0.0-dataease.js";import{i as To}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as ga}from"./icon_add_outlined-0.0.0-dataease.js";import{i as xo}from"./icon_refresh_outlined-0.0.0-dataease.js";import{i as ha}from"./icon_expand-right_filled-0.0.0-dataease.js";import{F as ya,i as ba}from"./FieldMore-0.0.0-dataease.js";import{i as Ca}from"./icon_copy_outlined-0.0.0-dataease.js";import{i as Ft}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as wa}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as Fo}from"./icon_info_outlined-0.0.0-dataease.js";import{d as Ta}from"./dayjs-0.0.0-dataease.js";import{i as ko,a as Vo}from"./field-calculated-list-0.0.0-dataease.js";import{l as No,n as Lo,f as Eo,o as Do,q as xa,s as So,r as Io}from"./dataset-0.0.0-dataease.js";import{a as Ao,b as Uo,u as qo}from"./index-0.0.0-dataease.js";import{j as Mo,D as $o,h as y,l as kt}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as Ho}from"./EmptyBackground-0.0.0-dataease.js";import{p as Ro}from"./@vueuse-0.0.0-dataease.js";import Bo from"./CalcFieldEdit-0.0.0-dataease.js";import{u as Oo,b as Go}from"./vue-router-0.0.0-dataease.js";import jo from"./UnionEdit-0.0.0-dataease.js";import Yo from"./CreatDsGroup-0.0.0-dataease.js";import{g as Ne,a as Zo,b as Fa}from"./util-0.0.0-dataease.js";import{f as G}from"./attr-0.0.0-dataease20.js";import{useAppStoreWithOut as Po}from"./app-0.0.0-dataease.js";import{_ as Xo}from"./DatasetUnion.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{i as P}from"./field-list-0.0.0-dataease.js";import{i as zo}from"./datasource-list-0.0.0-dataease.js";import{e as q,d as Wo}from"./lodash-es-0.0.0-dataease.js";import{_ as Jo}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./icon_close_outlined-0.0.0-dataease.js";import"./icon_info_colorful-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";import"./vue-clipboard3-0.0.0-dataease.js";import"./clipboard-0.0.0-dataease.js";import"./CodeMirror-0.0.0-dataease2.js";import"./@codemirror-0.0.0-dataease.js";import"./@lezer-0.0.0-dataease.js";import"./style-mod-0.0.0-dataease.js";import"./crelt-0.0.0-dataease.js";import"./@marijn-0.0.0-dataease.js";import"./w3c-keyname-0.0.0-dataease.js";import"./codemirror-0.0.0-dataease.js";import"./GridTable-0.0.0-dataease.js";import"./ModelUtil-0.0.0-dataease.js";import"./dv-rename-0.0.0-dataease.js";import"./icon_calendar_outlined-0.0.0-dataease.js";import"./more_v-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./icon_adjustment_outlined-0.0.0-dataease.js";import"./UnionFieldList-0.0.0-dataease.js";import"./UnionItemEdit-0.0.0-dataease.js";import"./icon_right-association-0.0.0-dataease.js";import"./join-join-0.0.0-dataease.js";import"./treeSortUtils-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./icon_rename_outlined-0.0.0-dataease.js";import"./icon_more-vertical_outlined-0.0.0-dataease.js";import"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import"./icon_more_outlined-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";const Ko={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function Qo(ve,ie){return c(),w("svg",Ko,ie[0]||(ie[0]=[ka('<g id="icon_sql_outlined"><g id="Union"><path d="M3.73875 8.736V8.60266H2.66342L2.66143 8.73398C2.65762 8.98596 2.70337 9.21143 2.8045 9.40559C2.90241 9.59358 3.03463 9.74989 3.2009 9.87261L3.20211 9.87349C3.3693 9.99402 3.55876 10.0807 3.76906 10.1343C3.97937 10.1906 4.19515 10.2187 4.41609 10.2187C4.68545 10.2187 4.92669 10.1874 5.1378 10.1222C5.34961 10.0578 5.53149 9.96695 5.67904 9.84731C5.82907 9.72491 5.94364 9.57892 6.02023 9.40962C6.09609 9.24194 6.13342 9.06129 6.13342 8.86933C6.13342 8.638 6.08342 8.4359 5.97261 8.27307C5.87491 8.12108 5.7558 7.99733 5.61464 7.90457C5.48072 7.81656 5.34269 7.75187 5.20064 7.71214C5.07741 7.67346 4.97621 7.64561 4.899 7.62994C4.66262 7.56996 4.4704 7.52058 4.32226 7.48178C4.18072 7.4438 4.0736 7.40713 3.99797 7.37258C3.92618 7.33811 3.89834 7.30959 3.88964 7.29545C3.87812 7.27672 3.86675 7.24291 3.86675 7.184C3.86675 7.12132 3.88029 7.0814 3.89769 7.05529C3.92312 7.01714 3.95447 6.98562 3.99243 6.96002C4.03522 6.93355 4.0822 6.91475 4.13422 6.9038C4.19294 6.89144 4.25129 6.88533 4.30942 6.88533C4.405 6.88533 4.48995 6.89359 4.56489 6.9092L4.56594 6.90941C4.64097 6.92441 4.70351 6.94919 4.75555 6.98206C4.80217 7.0115 4.83972 7.05217 4.86856 7.10724L4.87099 7.11148C4.9008 7.16365 4.92211 7.23655 4.92835 7.33631L4.93616 7.46133H6.00542V7.328C6.00542 7.09131 5.95973 6.88155 5.86141 6.70462C5.76997 6.5303 5.64409 6.38644 5.48455 6.27477C5.32744 6.16479 5.1483 6.08729 4.94889 6.04109C4.75657 5.9922 4.55573 5.968 4.34675 5.968C4.1639 5.968 3.98152 5.99278 3.7999 6.04197C3.61506 6.09203 3.44764 6.1696 3.29886 6.27531C3.14805 6.38246 3.02504 6.51755 2.93035 6.67931L2.92983 6.6802C2.83438 6.84621 2.78942 7.03894 2.78942 7.25333C2.78942 7.44367 2.82432 7.61498 2.90011 7.76235L2.90236 7.76637C2.9785 7.90262 3.07744 8.01798 3.19896 8.11115C3.31621 8.20104 3.44808 8.27454 3.59378 8.33205L3.59666 8.33311C3.73574 8.38435 3.87835 8.42826 4.02447 8.46486C4.16423 8.50425 4.3023 8.54011 4.43869 8.57241C4.56867 8.60319 4.68311 8.63868 4.78257 8.67846C4.87681 8.71616 4.94548 8.76069 4.99377 8.80898L4.99639 8.81146C5.03435 8.84742 5.05609 8.89446 5.05609 8.96533C5.05609 9.03643 5.03834 9.08573 5.01058 9.12208C4.9741 9.16593 4.92816 9.20162 4.87076 9.22895C4.80857 9.25856 4.74142 9.2797 4.66879 9.29204C4.5892 9.30189 4.51569 9.30666 4.44809 9.30666C4.34875 9.30666 4.2533 9.29554 4.16148 9.27356C4.07296 9.24893 3.99768 9.21464 3.93414 9.17183C3.87737 9.12793 3.83023 9.07132 3.79305 8.99982C3.75907 8.93447 3.73875 8.84836 3.73875 8.736Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.2467 9.94025L9.76461 9.50152C9.89584 9.33145 9.99908 9.1408 10.0745 8.93029C10.1655 8.67632 10.2103 8.40319 10.2103 8.112C10.2103 7.8142 10.1656 7.53601 10.0748 7.27859C9.98421 7.01824 9.85316 6.78963 9.68094 6.59445C9.50771 6.39812 9.29635 6.24476 9.04862 6.13423C8.79781 6.02233 8.51571 5.968 8.20496 5.968C7.89747 5.968 7.61574 6.02243 7.36199 6.13393L7.3613 6.13423C7.11358 6.24476 6.90221 6.39812 6.72898 6.59445C6.55676 6.78963 6.42571 7.01824 6.33512 7.27859C6.24431 7.53601 6.19963 7.8142 6.19963 8.112C6.19963 8.40321 6.24468 8.67847 6.33544 8.93563C6.42627 9.18921 6.55759 9.41246 6.72985 9.60386C6.90306 9.79631 7.11415 9.94752 7.36129 10.0578L7.36355 10.0587C7.61689 10.1662 7.89807 10.2187 8.20496 10.2187C8.54665 10.2187 8.84912 10.1569 9.10796 10.0284L9.67299 10.5375L10.2467 9.94025ZM7.99391 9.01558L8.25457 9.2529C8.23915 9.25318 8.22262 9.25333 8.20496 9.25333C8.03365 9.25333 7.89703 9.22114 7.78956 9.16335C7.67575 9.09853 7.585 9.01485 7.5154 8.91196C7.44287 8.80474 7.3886 8.68419 7.35307 8.54932C7.32015 8.4071 7.30363 8.26139 7.30363 8.112C7.30363 7.95492 7.32028 7.80354 7.35333 7.65762C7.38906 7.5153 7.44346 7.39173 7.51541 7.28538L7.51639 7.28389C7.586 7.17796 7.67614 7.09532 7.78838 7.03465L7.79077 7.03329C7.8979 6.97249 8.03399 6.93866 8.20496 6.93866C8.37593 6.93866 8.51201 6.97251 8.61913 7.03331L8.62156 7.03463C8.73379 7.09529 8.82391 7.17797 8.89352 7.28389L8.89452 7.28537C8.96615 7.39126 9.01866 7.51431 9.05091 7.65622L9.05161 7.659C9.08798 7.80449 9.10629 7.95539 9.10629 8.112C9.10629 8.30607 9.08578 8.46482 9.04792 8.59102C9.02689 8.6611 9.00256 8.72358 8.97527 8.77894L8.56563 8.4047L7.99391 9.01558Z"></path><path d="M11.62 6.05866H10.516V10.1333H13.476V9.16266H11.62V6.05866Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M1.33341 2C0.965225 2 0.666748 2.29848 0.666748 2.66667V13.3333C0.666748 13.7015 0.965225 14 1.33341 14H14.6667C15.0349 14 15.3334 13.7015 15.3334 13.3333V2.66667C15.3334 2.29848 15.0349 2 14.6667 2H1.33341ZM2.00008 3.33333V12.6667H14.0001V3.33333H2.00008Z"></path></g></g>',1)]))}const es={render:Qo},ts={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function as(ve,ie){return c(),w("svg",ts,ie[0]||(ie[0]=[ka('<g clip-path="url(#clip0_1052_111876)"><path d="M8.00033 15.3332C12.0504 15.3332 15.3337 12.0499 15.3337 7.99984C15.3337 3.94975 12.0504 0.666504 8.00033 0.666504C3.95024 0.666504 0.666992 3.94975 0.666992 7.99984C0.666992 12.0499 3.95024 15.3332 8.00033 15.3332Z" fill="#FF8800"></path><path d="M7.66634 4.6665C7.48225 4.6665 7.33301 4.81574 7.33301 4.99984V8.99984C7.33301 9.18393 7.48225 9.33317 7.66634 9.33317H8.33301C8.5171 9.33317 8.66634 9.18393 8.66634 8.99984V4.99984C8.66634 4.81574 8.5171 4.6665 8.33301 4.6665H7.66634Z" fill="white"></path><path d="M7.66634 9.99984C7.48225 9.99984 7.33301 10.1491 7.33301 10.3332V10.9998C7.33301 11.1839 7.48225 11.3332 7.66634 11.3332H8.33301C8.5171 11.3332 8.66634 11.1839 8.66634 10.9998V10.3332C8.66634 10.1491 8.5171 9.99984 8.33301 9.99984H7.66634Z" fill="white"></path></g><defs><clipPath id="clip0_1052_111876"><rect width="16" height="16" fill="white"></rect></clipPath></defs>',2)]))}const ls={render:as},os={class:"de-dataset-form"},ss={class:"top"},ns={class:"name"},is={key:0,class:"ed-form-item__error"},ds={class:"oprate"},rs={class:"table-list-top"},us={class:"select-ds"},cs={class:"left-outlined"},ms={class:"flex-align-center icon"},ps={key:0},fs={class:"select-ds table-num"},vs={class:"num"},_s={key:0,class:"el-empty"},gs={class:"el-empty__description",style:{"margin-top":"80px",color:"#5e6d82","text-align":"center"}},hs={key:1,class:"table-checkbox-list"},ys={class:"label"},bs=["title","onDragstart","onClick"],Cs={class:"label"},ws={key:0,class:"different-datasource"},Ts={class:"sql-title"},xs={class:"field-data"},Fs={class:"table-preview"},ks={class:"preview-field"},Vs={class:"custom-tree-node father"},Ns=["title"],Ls={class:"operate child"},Es={class:"custom-tree-node father"},Ds=["title"],Ss={class:"operate child"},Is={class:"preview-data"},As={class:"flex-align-center"},Us=["title"],qs={class:"batch-area"},Ms={class:"manage-container"},$s={class:"column-style"},Hs={class:"column-style"},Rs={key:0,style:{color:"#8d9199"}},Bs={key:1,style:{color:"#8d9199"}},Os={key:2},Gs={class:"column-style"},js={key:0},Ys={key:1,style:{color:"#8d9199"}},Zs={class:"select-svg-icon"},Ps={class:"column-style"},Xs={key:0,class:"flex-align-center icon"},zs={key:1,style:{color:"#8d9199"}},Ws={class:"column-style"},Js={class:"column-style"},Ks={key:0},Qs={key:1,style:{color:"#8d9199"}},en={class:"column-style"},tn={key:0},an={key:1,style:{color:"#8d9199"}},ln={class:"select-svg-icon"},on={class:"column-style"},sn={key:0,class:"flex-align-center icon"},nn={key:1,style:{color:"#8d9199"}},dn={key:0,class:"batch-operate flex-align-center"},rn={class:"flex-align-center"},un={class:"num"},cn={class:"cascader-batch"},mn={class:"select-svg-icon"},pn={class:"grouping_settings_label"},fn={style:{width:"100%"}},vn={key:1,class:"group-fields_num"},_n={class:"name"},gn={class:"group-fields_item"};function hn(ve){return typeof ve=="function"||Object.prototype.toString.call(ve)==="[object Object]"&&!yo(ve)}const yn=co({__name:"index",setup(ve){const{wsCache:ie}=Ao(),Ye=Po(),de=Uo(),{t:d}=Mo(),at=Oo(),{push:Va}=Go(),Ze=_(238),Vt=_(),_e=_(!1),j=_(),ge=_(!1),L=_(),K=_(d("data_set.unnamed_dataset")),he=_("preview"),Na=_(""),ae=_(""),Le=_(""),Ee=_(!1),lt=_(!1),re=_(240),Nt=_(0),Lt=_(0),ye=_(!0),Pe=_(!1),be=_(!1),le=_(!1),Et=_(),ot=_({}),V=_({dateFormat:"",id:"",dateFormatType:"",name:"",idArr:[]});let st=!1;const Dt=t=>[d("dataset.text"),d("dataset.time"),d("dataset.value"),d("dataset.value")+"("+d("dataset.float")+")",d("dataset.value"),d("dataset.location")][t],nt=()=>{st=!0},it=[{label:d("dataset.text"),value:0},{label:d("dataset.time"),value:1,children:[{value:"yyyy-MM-dd",label:"yyyy-MM-dd"},{value:"yyyy/MM/dd",label:"yyyy/MM/dd"},{value:"yyyy-MM-dd HH:mm:ss",label:"yyyy-MM-dd HH:mm:ss"},{value:"yyyy/MM/dd HH:mm:ss",label:"yyyy/MM/dd HH:mm:ss"},{value:"custom",label:d("visualization.custom")}]},{label:d("dataset.location"),value:5},{label:d("dataset.value"),value:2},{label:d("dataset.value")+"("+d("dataset.float")+")",value:3},{label:"URL",value:7}],dt=[{label:d("dataset.text"),value:0},{label:d("dataset.time"),value:1},{label:d("dataset.location"),value:5},{label:d("dataset.value"),value:2},{label:d("dataset.value")+"("+d("dataset.float")+")",value:3},{label:"URL",value:7}],St=_(),It=_(),La={name:[{required:!0,message:d("data_set.cannot_be_empty_time"),trigger:"blur"}]},Ea={name:[{required:!0,message:d("dataset.input_edit_name"),trigger:"blur"}]},rt=xt({datasourceId:"",name:"",tableName:d("data_set.custom_sql"),type:"sql"});let Y={id:"",pid:"",name:""};const At={children:"children",label:"label"},H=_(260);let ut=[];const Ut=(t,e)=>{let n="";return t.some(i=>{var r;return i.id===e?(n=i.name,!0):((r=i.children)!=null&&r.length&&(n=Ut(i.children,e)||n),!1)}),n},{height:Da}=Ro(),ct=t=>t.filter(e=>{var n,i;return e.leaf?!0:((n=e.children)!=null&&n.length&&(e.children=ct(e.children||[])),!!((i=e.children)!=null&&i.length))}),Sa=t=>Ut(R.dataSourceList,t),De=()=>{if(Ye.isDataEaseBi){de.clearState(),qo().emitter.emit("changeCurrentComponent","Dataset");return}const t=de.getToken&&Ye.getIsIframe?"dataset-embedded":"dataset";ie.set(`${t}-info-id`,Y.id),history.state.back?history.back():Va({name:t,params:{id:Y.id}})},Ia=()=>{st?Tt.confirm(d("data_set.want_to_exit"),{confirmButtonText:d("dataset.confirm"),cancelButtonText:d("common.cancel"),showCancelButton:!0,confirmButtonType:"primary",type:"warning",autofocus:!1,showClose:!1}).then(()=>{De()}):De()},Aa=()=>{if(V.value.idArr.length){const{idArr:t}=V.value;p.value.forEach(e=>{t.includes(e.id)&&Object.assign(e,{deTypeArr:[...Ke]})}),delete V.value.name,xe()}else ee.value.concat(Q.value).some(t=>t.id===V.value.id?(delete V.value.name,Object.assign(t,{deTypeArr:[...Ke]}),!0):!1);V.value.idArr=[],V.value.id="",le.value=!1},Ua=()=>{if(V.value.idArr.length){const{name:t,idArr:e}=V.value;p.value.forEach(n=>{e.includes(n.id)&&Object.assign(n,{deType:1,dateFormatType:"custom",dateFormat:t,deTypeArr:[1,"custom"]})}),delete V.value.name,xe(),le.value=!1}else St.value.validate(t=>{t&&(ee.value.concat(Q.value).some(e=>e.id===V.value.id?(e.dateFormat=V.value.name,e.deType=1,e.dateFormatType="custom",!0):!1),le.value=!1)})};mo(Le,t=>{z.value=ut.filter(e=>e.tableName.toLowerCase().includes(t.toLowerCase()))});const qa=()=>{const t=[];be.value=!0,we(t,L.value.getNodeList()),So({...Y,name:K.value,union:t,allFields:p.value,nodeType:"dataset"}).then(()=>{st=!1,pe.success(d("data_set.saved_successfully")),wt&&De()}).finally(()=>{be.value=!1})},X=(t,e)=>{nt(),he.value==="manage"&&(Me.value=ce.value.getSelectionRows().map(i=>i.id),$e.value=ue.value.getSelectionRows().map(i=>i.id));const n=["text","time","value","float","value","location","binary","url"];if(n.includes(e)){t.deType=n.indexOf(e),t.dateFormat="";return}switch(Zo.includes(e)&&(V.value.dateFormat=t.dateFormat,V.value.dateFormatType=t.dateFormatType,t.deType=1,t.dateFormatType=e,t.dateFormat=e),e){case"copy":t.extField===3?Ra(t):$a(t);break;case"delete":Oa(t);break;case"translate":Ma(t.id);break;case"editor":t.extField===3?dl(t):Ya(t);break;case"rename":ja(t);break;case"custom":V.value.id=t.id,le.value=!0;break}he.value==="manage"&&xe()},Ma=t=>{const e=p.value.find(n=>n.id===t);e.groupType=e.groupType==="d"?"q":"d"},qt=t=>{const e=me.value.map(n=>n.id);p.value.forEach(n=>{e.includes(n.id)&&(n.groupType=t)}),xe()},$a=t=>{const e=q(t);e.id=Ne(),e.extField=2,e.originName=t.extField===2?t.originName:"["+t.id+"]",e.name=Fa(ee.value.concat(Q.value),t.name),e.dataeaseName=null,e.lastSyncTime=null;const n=p.value.findIndex(i=>i.id===t.id);p.value.splice(n+1,0,e)},Ha=t=>![3].includes(t.extField),Ra=t=>{const e=q(t);e.id=Ne(),e.name=Fa(ee.value.concat(Q.value),t.name);const n=p.value.findIndex(i=>i.id===t.id);p.value.splice(n+1,0,e)},Mt=t=>{const e=[...t];for(;e.length;){const[n]=e;e.shift(),p.value=p.value.filter(u=>u.id!==n);const i=p.value.reduce((u,g)=>(g.extField===2&&(u=[...u,...(g.params||[]).map(F=>F.id)]),u),[]),r=p.value.map(u=>u.id).concat(i);p.value=p.value.filter(u=>{if(![2,3].includes(u.extField))return!0;const g=u.originName.match(/\[(.+?)\]/g);return!g||g.every(N=>{const h=N.slice(1,-1);return r.includes(h)})?!0:(e.push(u.id),!1)})}el()},Ba=(t,e)=>{const n=[...t];let i=[];for(;n.length;){const[r]=n;n.shift(),e=e.filter(g=>g.id!==r);const u=e.map(g=>g.id);e=e.filter(g=>{if(![2,3].includes(g.extField))return!0;const F=g.originName.match(/\[(.+?)\]/g);return!F||F.every(h=>{var E;return(E=g.params)==null?void 0:E.map(I=>I.id).includes(h.slice(1,-1))})||F.every(h=>{const E=h.slice(1,-1);return u.includes(E)})?!0:(n.push(g.id),i.push(g.id),!1)})}return i},Oa=t=>{let e="";e=p.value.reduce((i,r)=>{if(![2,3].includes(r.extField))return i;let u=r.originName.match(/\[(.+?)\]/g)||[];return u=u.filter(F=>{var N;return!((N=r.params)!=null&&N.map(h=>h.id).includes(F.slice(1,-1)))}),i=[...u.map(F=>F.slice(1,-1)),...i],i},[]).includes(t.id)?d("data_set.deleted_confirm_deletion"):"",Tt.confirm(d("data_set.delete_field_a",{a:t.name}),{confirmButtonText:d("dataset.confirm"),tip:e,cancelButtonText:d("common.cancel"),showCancelButton:!0,confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,callback:i=>{i==="confirm"&&(Mt([t.id]),L.value.dfsNodeFieldBackReal(t),pe({message:d("chart.delete_success"),type:"success"}))}})},Ga=t=>{_e.value=!0,mt.value=d("dataset.add_calc_field"),fe(()=>{j.value.initEdit({groupType:t,id:Ne()},ee.value,Q.value)})},Xe=_(!1),oe=_({id:"",name:""}),ja=t=>{const{id:e,name:n}=t;oe.value={id:e,name:n},Xe.value=!0},mt=_(""),Ya=t=>{_e.value=!0,fe(()=>{mt.value=d("dataset.edit_calc_field"),j.value.initEdit(t,ee.value,Q.value)})},$t=()=>{oe.value.id="",oe.value.name="",Xe.value=!1},Za=()=>{It.value.validate(t=>{t&&(p.value.some(e=>e.id===oe.value.id?(e.name=oe.value.name,!0):!1),$t())})},Pa=()=>{_e.value=!1},Xa=()=>{j.value.formField.validate(t=>{if(t){if(j.value.setFieldForm(),!j.value.fieldForm.originName.trim()){pe.error(d("data_set.cannot_be_empty_de_"));return}const e=q(j.value.fieldForm),{deType:n,dateFormat:i,deExtractType:r}=e;e.dateFormat=n===1?i:"",e.dateFormatType=n===1?i:"",e.deTypeArr=n===1&&r===0?[n,i]:[n];const u=p.value.findIndex(g=>e.id===g.id);u!==-1?p.value.splice(u,1,e):p.value.push(e),_e.value=!1}})},za=t=>t.map(e=>({key:e.dataeaseName,deType:e.deType,dataKey:e.dataeaseName,title:e.name,width:150,headerCellRenderer:({column:n})=>{let i;return l("div",{class:"flex-align-center"},[l(k,null,{default:()=>[l(y,null,hn(i=_o(P[G[n.deType]],{class:`svg-icon field-icon-${G[n.deType]}`}))?i:{default:()=>[i]})]}),l("span",{class:"ellipsis",title:n.title,style:{width:"120px",marginLeft:"4px"}},[n.title])])}})),pt=t=>(lt.value=!0,rt.datasourceId=ae.value,Lo({datasourceId:t}).then(e=>{ut=e||[],z.value=[...ut]}).finally(()=>{lt.value=!1})),Wa=async(t,e)=>{await pt(t),e&&(Le.value=e)},Se=_(!1),Ht=_(),Ja=async()=>{var r;let{id:t,datasourceId:e,tableName:n}=at.query,{id:i}=at.params;if(Ye.getIsDataEaseBi&&(t=de.datasetId,e=de.datasourceId,n=de.tableName,i=de.datasetCopyId||i),Se.value=!1,i||t){const u=await Eo(i||t);if(!u||!u.id)return;Se.value=!0}if(e&&(ae.value=e,Wa(e,n)),!(!t&&!i)){be.value=!0;try{const u=await Do(i||t);be.value=!1;let g=[];const{pid:F,name:N}=u||{};Y={id:(u==null?void 0:u.id)||null,pid:F,name:i?d("data_set.copy_a_dataset"):N},i&&(Y.id=""),K.value=Y.name,p.value=u.allFields||[],ma(g,u.union||[]);const[h]=u.union;ae.value=(r=h==null?void 0:h.currentDs)==null?void 0:r.datasourceId,pt(ae.value),L.value.initState(g)}catch(u){console.error(u),be.value=!1}}},Ka=t=>{R.editArr=q(t),ge.value=!0,fe(()=>{qe.value.initState()})},Ie=Oe([]),ft=Oe([]),Q=Ge(()=>p.value.filter(t=>t.groupType==="q")),ee=Ge(()=>p.value.filter(t=>t.groupType==="d")),Rt=(t,e)=>{t.forEach(n=>{var i;e[n.id]=n.tableName,(i=n.children)!=null&&i.length&&Rt(n.children,e)})},Bt=t=>{t!=="preview"&&(_t(),p.value.forEach(e=>{if(!Array.isArray(e.deTypeArr))e.deTypeArr=e.deType===1&&e.deExtractType===0?[e.deType,e.dateFormatType]:[e.deType];else{const[n]=e.deTypeArr;e.deTypeArr.length&&n!==e.deType&&e.deTypeArr.splice(0,1,e.deType)}}))},vt=()=>{var t,e,n;R.nodeNameList=[...L.value.nodeNameList],nt(),(t=R.nodeNameList)!=null&&t.length||(Ie.value=[],ft.value=[]),(n=(e=$o)["/datasetData/previewData"])==null||n.call(e),te.value=!1,_t()},_t=()=>{Rt(L.value.getNodeList(),ot.value)},R=xt({nodeNameList:[],editArr:[],dataSourceList:[],fieldCollapse:["dimension","quota"]}),z=Oe([]),W=t=>{if(t===1)return"time";if(t===0)return"text";if([2,3,4].includes(t))return"value";if(t===5)return"location";if(t===7)return"url"},p=_([]);go("allfields",p);let Qa=+new Date;const Ae=_(!0),Ue=_(!0),Ot=(t,e,n,i)=>{t.forEach(r=>{var u;r.id||(r.id=((u=i.find(g=>g.originName===r.originName))==null?void 0:u.id)||`${++Qa}`,r.datasetTableId=e,r.datasourceId=n)})},Gt=(t,e)=>{e.forEach(n=>{var r;(r=n.children)!=null&&r.length&&Gt(t,n.children);const{currentDsFields:i}=n;t.push(...q(i))})},jt=(t,e)=>{const n=t.map(i=>i.id);return[...e.filter(i=>![2,3].includes(i.extField)).filter(i=>!n.includes(i.id)),...e.filter(i=>[2,3].includes(i.extField))]},Yt=(t,e)=>{const n=t.map(u=>u.id),i=e.map(u=>u.id),r=t.filter(u=>!i.includes(u.id));return q([...e.filter(u=>[2,3].includes(u.extField)),...r,...e.filter(u=>n.includes(u.id))])},Zt=()=>{ul(),qe.value.clearState(),ge.value=!1},qe=_(),gt=()=>{var n;const t=[];Gt(t,L.value.getNodeList());const e=jt(t,p.value);p.value=Yt(t,p.value),Mt(e),Bt("manage"),(n=qe.value)==null||n.clearState()},el=()=>{const t=[],e=p.value.map(i=>i.id);p.value.filter(i=>i.extField===3).forEach(i=>{e.includes(i.originName)||t.push(i.id)}),p.value=p.value.filter(i=>!t.includes(i.id))},ht=(t,e)=>t.reduce((n,i)=>{var r;return i.id===e?n=[...i.currentDsFields]:(r=i.children)!=null&&r.length&&(n=ht(i.children,e)),n},[]),Pt=(t,e,n)=>{e.forEach(i=>{var r;if((r=i.children)!=null&&r.length&&Pt(t,i.children,n),!n.includes(i.id)){const{currentDsFields:u}=i;t.push(...q(u))}})},tl=()=>{const{node:t,parent:e}=qe.value,n=t.id,i=e.id;if(t.unionFields.some(A=>{const{currentField:D,parentField:U}=A;return!D||!U})){pe.error(d("data_set.cannot_be_empty_de_field"));return}const u=ht(L.value.getNodeList(),n),g=ht(L.value.getNodeList(),i);Ot(t.currentDsFields,t.id,t.datasourceId,u),Ot(e.currentDsFields,e.id,e.datasourceId,g);const F=q(t),N=q(e);let h=[];Pt(h,L.value.getNodeList(),[t.id,e.id]),h=[...h,...t.currentDsFields,...e.currentDsFields];const E=jt(h,p.value);let I=Yt(h,p.value);const Z=Ba(E,I);if(Z.length){const A=p.value.reduce((D,U)=>(Z.includes(U.id)&&(D=[...U.originName.match(/\[(.+?)\]/g).map(Qe=>Qe.slice(1,-1)),...D]),D),[]);Tt.confirm(d("data_set.field_selection"),{confirmButtonText:d("dataset.confirm"),cancelButtonText:d("common.cancel"),showCancelButton:!0,tip:`${d("data_set.field")}: ${p.value.filter(D=>[...new Set(A)].includes(D.id)&&![2,3].includes(D.extField)).map(D=>D.name).join(",")}, ${d("data_set.confirm_the_deletion")}`,confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,callback:D=>{D==="confirm"&&(L.value.setStateBack(F,N),gt(),ge.value=!1,vt(),L.value.setChangeStatus(n,i))}});return}L.value.setStateBack(F,N),gt(),ge.value=!1,vt(),L.value.setChangeStatus(n,i)},al=()=>{gt()},Xt=[{value:"lt",label:"<"},{value:"le",label:"<="}],zt=(t,e,n)=>{!e||!e.length?n(new Error(d("chart.value_can_not_empty"))):n()},ze=_([]),ll={name:[{required:!0,message:d("dataset.input_edit_name"),trigger:"blur"}]},Wt={name:"",id:+new Date,datasourceId:"",datasetTableId:"",datasetGroupId:"",originName:"",otherGroup:"",groupType:"d",deType:0,type:"ANY",deExtractType:0,extField:3,deTypeOrigin:null,groupList:[{name:"",text:[],time:"",minTerm:"lt",maxTerm:"lt",min:null,max:null}]},x=xt(q(Wt)),Jt=_(),Ce=_(!1),yt=_(!1),We=Oe([]),Kt=Oe([]),ol=()=>{We.value=p.value.filter(t=>![2,3].includes(t.extField)),Object.assign(x,q(Wt)),x.id=Ne(),bt.value=d("dataset.create_grouping_field"),Ce.value=!0},Qt=t=>{const e=We.value.find(u=>u.id===t),{deType:n}=e;if((n!==x.deExtractType||n===0)&&(ze.value=[],x.groupList=[{name:"",text:[],time:"",minTerm:"lt",maxTerm:"lt",min:null,max:null}]),x.deTypeOrigin=n,n!==0)return;yt.value=!0;const i=[],r=q(a(p));we(i,L.value.getNodeList()),Io({dataset:{union:i,allFields:r},field:e}).then(u=>{Kt.value=u||[]}).finally(()=>{yt.value=!1})},sl=()=>{Ce.value=!1},nl=Ge(()=>{var t;return(t=x.groupList)==null?void 0:t.map(e=>e.text).flat()}),il=(t,e)=>nl.value.includes(t)&&!e.includes(t),bt=_(d("dataset.create_grouping_field")),dl=t=>{We.value=p.value.filter(n=>![2,3].includes(n.extField)),Object.assign(x,t);const e=[];t.groupList.forEach(n=>{const{name:i,text:r=[],startTime:u,endTime:g,min:F,max:N,minTerm:h,maxTerm:E}=n,I={name:i,text:r,min:F,max:N,minTerm:h,maxTerm:E,time:[]};u&&g&&(I.time=[u,g]),e.push(I)}),Qt(x.originName),x.groupList=e,bt.value=d("dataset.editing_grouping_field"),Ce.value=!0},rl=()=>{Jt.value.validate(t=>{let e=0,n;ze.value.forEach(i=>{i==null||i.validate(r=>{r&&e++})}),n=setTimeout(()=>{if(clearTimeout(n),n=null,t&&e===x.groupList.length){const i=[];x.groupList.forEach(u=>{const{name:g,text:F=[],time:N,min:h,max:E,minTerm:I,maxTerm:Z}=u,A={name:g,text:F,min:h,max:E,minTerm:I,maxTerm:Z,startTime:"",endTime:""};if(x.deTypeOrigin===1){const[D,U]=N;A.startTime=Ta(D).format("YYYY-MM-DD HH:mm:ss"),A.endTime=Ta(U).format("YYYY-MM-DD HH:mm:ss")}i.push(A)});const r=p.value.findIndex(u=>u.id===x.id);r!==-1?p.value.splice(r,1,{...x,groupList:i}):p.value.push({...x,groupList:i}),Ce.value=!1}},1e3)})},ul=()=>{L.value.notConfirm()},cl=()=>{x.groupList.push({name:"",text:[],time:"",minTerm:"lt",maxTerm:"lt",min:null,max:null})},ml=t=>{x.groupList.splice(t,1),ze.value.splice(t,1)},ea=(t,e)=>{Nt.value=t.offsetX,Lt.value=t.offsetY,t.dataTransfer.setData("text/plain",JSON.stringify(e)),Pe.value=!0},ta=t=>{t.unableCheck||(Na.value=t.tableName)},pl=()=>{te.value||j.value.formField.validate(t=>{if(t){if(j.value.setFieldForm(),!j.value.fieldForm.originName.trim()){pe.error(d("data_set.cannot_be_empty_de_"));return}const e=q(j.value.fieldForm),{deType:n,dateFormat:i,deExtractType:r}=e;e.dateFormat=n===1?i:"",e.dateFormatType=n===1?i:"",e.deTypeArr=n===1&&r===0?[n,i]:[n];const u=p.value.findIndex(N=>e.id===N.id),g=q(a(p));u!==-1?g.splice(u,1,e):g.push(e);const F=[];we(F,L.value.getNodeList()),te.value=!0,xa({union:F,allFields:g}).then(()=>{pe.success(d("data_set.validation_succeeded"))}).finally(()=>{te.value=!1})}})},Ct=_(!1),fl=()=>{Ct.value=!0,document.querySelector("body").style.userSelect="none",document.querySelector(".dataset-db").addEventListener("mousemove",aa)},vl=()=>{Ct.value=!1,document.querySelector("body").style.userSelect="auto";const t=document.querySelector(".dataset-db");t.removeEventListener("mousemove",aa),t.removeEventListener("mousemove",la)},Je=Ge(()=>{var t;return(t=L.value)==null?void 0:t.crossDatasources}),aa=t=>{if(t.pageX<240){re.value=240;return}if(t.pageX>500){re.value=500;return}re.value=t.pageX},_l=()=>{document.querySelector(".dataset-db").addEventListener("mousemove",la)},la=t=>{const e=document.documentElement.clientHeight;if(t.pageY-56<64){H.value=64,B.value=e-H.value-56;return}if(t.pageY>e-57){H.value=e-113,B.value=e-H.value-56;return}H.value=t.pageY-56,B.value=e-H.value-56,Ze.value=B.value-242},B=_(0),oa=Wo(()=>{const t=document.documentElement.clientHeight;if(t-B.value-56<64){H.value=64,B.value=t-H.value-56;return}H.value=t-B.value-56},60);let wt=!1;const gl=()=>{wt&&De()};let sa=null;const na=()=>sa(!0);po(async()=>{Se.value=!1,await new Promise(t=>sa=t),await Ja(),yl(Se.value?0:2),window.addEventListener("resize",oa),hl(),Ze.value=B.value-242}),fo(()=>{window.removeEventListener("resize",oa)});const hl=()=>{B.value=document.querySelector(".sql-result").offsetHeight},yl=t=>{No(t).then(e=>{const n=e||[];n&&n.length>0&&n[0].id==="0"?R.dataSourceList=ct(n[0].children):R.dataSourceList=ct(n),fe(()=>{var r;const i={methodName:"execute",args:null};(r=Ht.value)==null||r.invokeMethod(i)})})},ia=(t,e)=>{var n;for(let i in t){const r=Ne();e[t[i].currentDs.id]=r,t[i].currentDs.id=r,(n=t[i].childrenDs)!=null&&n.length&&ia(t[i].childrenDs,e)}},bl=t=>{const e={};for(let n in p.value){const i=Ne();e[p.value[n].id]=i,p.value[n].id=i,p.value[n].datasetGroupId=""}return ia(t,e),e},Cl=(t,e)=>{let n=JSON.stringify(t),i=JSON.stringify(ho(L.value.getNodeList())),r=JSON.stringify(a(p.value));return Object.entries(e).forEach(([u,g])=>{n=n.replaceAll(u,g),r=r.replaceAll(u,g),i=i.replaceAll(u,g)}),p.value=JSON.parse(r),L.value.initState(JSON.parse(i)),JSON.parse(n)},da=()=>{if(Y.id){qa();return}let t=[];we(t,L.value.getNodeList());const e=Ye.getIsDataEaseBi?de.datasetPid:at.query.pid||Y.pid;if(!t.length){pe.error(d("data_set.dataset_cannot_be"));return}Y.pid&&!Y.id&&(t=Cl(t,bl(t))),Vt.value.createInit("dataset",{id:e||"0",union:t,allfields:p.value},"",K.value)},wl=()=>{wt=!0,da()},te=_(!1),Tl=()=>{if(te.value)return;const t=[];we(t,L.value.getNodeList()),te.value=!0,xa({union:t,allFields:p.value}).then(e=>{Ie.value=za(e.data.fields||[]),ft.value=e.data.data||[]}).finally(()=>{te.value=!1})},we=(t,e)=>{e.forEach(n=>{var A;const i=[];(A=n.children)!=null&&A.length&&we(i,n.children);const{tableName:r,type:u,datasourceId:g,id:F,info:N,unionType:h,unionFields:E,currentDsFields:I,sqlVariableDetails:Z}=n;t.push({currentDs:{sqlVariableDetails:Z,tableName:r,type:u,datasourceId:g,id:F,info:N},currentDsFields:I,childrenDs:i,unionToParent:{unionType:h,unionFields:E}})})},ue=_(),ce=_(),Me=_([]),$e=_([]),Te=_([]),me=_([]),ra=Ge(()=>!!Te.value.length&&Array.from(new Set(Te.value)).length===1),xl=()=>{ce.value.clearSelection(),ue.value.clearSelection()},se=_([]),ua=()=>{me.value=[...ce.value.getSelectionRows(),...ue.value.getSelectionRows()],Te.value=me.value.map(n=>n.deExtractType);let t=me.value.map(n=>n.deType);const[e]=me.value;if(fe(()=>{Me.value=ce.value.getSelectionRows().map(n=>n.id),$e.value=ue.value.getSelectionRows().map(n=>n.id)}),Array.from(new Set(t)).length!==1){se.value=[];return}se.value=e.deType===1&&e.deExtractType===0?[1,e.dateFormatType]:[e.deType]},Fl=(t,e,n)=>{const i=n.target.parentNode.parentNode;if([...i.classList].includes("no-hide")){i.classList.remove("no-hide");return}i.classList.add("no-hide")};let Ke=[];const kl=t=>{const[e,n]=t;Me.value=ce.value.getSelectionRows().map(r=>r.id),$e.value=ue.value.getSelectionRows().map(r=>r.id);const i=[...$e.value,...Me.value];if(n==="custom"){const[r]=p.value.filter(u=>i.includes(u.id));Ke=r.deType===1?[1,r.dateFormatType]:[r.deType],V.value.id="",V.value.idArr=[...i],V.value.dateFormat="",V.value.dateFormatType=n,le.value=!0,xe();return}p.value.forEach(r=>{i.includes(r.id)&&(r.deType=e,r.dateFormat=e===1?n:"",r.dateFormatType=e===1?n:"",r.deTypeArr=e===1&&r.deExtractType===0?[e,n]:[e])}),xe()},Vl=(t,e)=>{var n;return t?(n=e.name)==null?void 0:n.toLowerCase().includes(t.toLowerCase()):!0},xe=()=>{fe(()=>{Q.value.forEach(t=>{$e.value.includes(t.id)&&ue.value.toggleRowSelection(t,!0)}),ee.value.forEach(t=>{Me.value.includes(t.id)&&ce.value.toggleRowSelection(t,!0)})})},Nl=()=>{Pe.value=!1},ca=(t,e)=>{const[n,i]=e;if(i==="custom"){Ke=t.deType===1?[1,t.dateFormatType]:[t.deType],V.value.id=t.id,le.value=!0;return}t.deType=n,t.dateFormat=n===1?i:"",t.dateFormatType=n===1?i:""},ma=(t,e)=>{e.forEach(n=>{var U;const i=[];(U=n.childrenDs)!=null&&U.length&&ma(i,n.childrenDs);const{unionToParent:r,currentDsFields:u,currentDs:g}=n,{tableName:F,type:N,datasourceId:h,id:E,info:I,sqlVariableDetails:Z}=g||{},{unionType:A,unionFields:D}=r||{};t.push({sqlVariableDetails:Z,tableName:F,type:N,datasourceId:h,id:E,info:I,currentDsFields:u,children:i,unionType:A,unionFields:D})})},Ll=()=>{Ee.value=!0,fe(()=>{Et.value.focus()})},El=t=>{const{id:e,pid:n,name:i}=t;K.value=i,Y={id:e,pid:n,name:i},p.value=t.allFields||[]},Fe=_(""),Dl=()=>{Fe.value="",K.value.trim()||(Fe.value=d("commons.input_content")),K.value.trim().length<1&&(Fe.value=d("datasource.input_limit_1_64",[1,64])),Ee.value=!!Fe.value},Sl={children:"children",label:"name",disabled:t=>{var e;return!((e=t.children)!=null&&e.length)&&!t.leaf||t.extraFlag<0&&t.type!=="API"}},He=_([]),Il=t=>{He.value=t},Al=t=>{if((He==null?void 0:He.value.length)===0||!t.leaf)return null;const e=He.value.filter(n=>n.type===t.type);return e&&e.length>0?e[0].icon:null},Ul=t=>t.leaf?zo[t.type]:bo,pa=(t,e,n=!1)=>e===2?(n?ko:Vo)[t]:P[G[t]];return(t,e)=>{const n=Rl,i=Bl,r=Ol,u=Gl,g=Kl,F=jl,N=Yl,h=Ql,E=Zl,I=Pl,Z=eo,A=Xl,D=zl,U=Wl,M=to,Re=ao,Qe=lo,et=oo,tt=so,ql=no,fa=io,Ml=ro,$l=uo,Be=vo("loading");return c(),w(ne,null,[J((c(),w("div",os,[m("div",ss,[m("span",ns,[l(a(k),{onClick:Ia},{default:s(()=>[l(a(y),{name:"icon_left_outlined"},{default:s(()=>[l(a(va),{class:"svg-icon"})]),_:1})]),_:1}),Ee.value?(c(),w(ne,{key:0},[l(n,{maxlength:"64",ref_key:"editerName",ref:Et,modelValue:K.value,"onUpdate:modelValue":e[0]||(e[0]=o=>K.value=o),onBlur:Dl},null,8,["modelValue"]),Fe.value?(c(),w("div",is,f(Fe.value),1)):$("",!0)],64)):(c(),w("span",{key:1,onClick:Ll,class:"dataset-name ellipsis",style:{"margin-left":"12px"}},f(K.value),1))]),m("span",ds,[l(i,{disabled:Ee.value,type:"primary",onClick:wl},{default:s(()=>[T(f(a(d)("data_set.save_and_return")),1)]),_:1},8,["disabled"]),l(i,{disabled:Ee.value,type:"primary",onClick:da},{default:s(()=>[T(f(a(d)("data_set.save")),1)]),_:1},8,["disabled"])])]),m("div",{class:"container dataset-db",onMouseup:vl},[J(m("p",{class:"arrow-right",onClick:e[1]||(e[1]=o=>ye.value=!0)},[l(a(k),null,{default:s(()=>[l(a(y),{name:"icon_right_outlined"},{default:s(()=>[l(a(Co),{class:"svg-icon"})]),_:1})]),_:1})],512),[[ke,!ye.value]]),J(m("div",{style:je({left:re.value+"px"}),class:S(["drag-left",Ct.value&&"is-dragging"]),onMousedown:fl},null,38),[[ke,ye.value]]),J((c(),w("div",{class:"table-list",style:je({width:re.value+"px"})},[m("div",rs,[m("p",us,[T(f(a(d)("data_set.select_data_source"))+" ",1),m("span",cs,[l(a(k),{style:{color:"#1f2329"},onClick:e[2]||(e[2]=o=>ye.value=!1)},{default:s(()=>[l(a(y),{name:"icon_left_outlined"},{default:s(()=>[l(a(va),{class:"svg-icon"})]),_:1})]),_:1})])]),l(u,{"check-strictly":!1,onChange:pt,placeholder:a(d)("dataset.pls_slc_data_source"),class:"ds-list","filter-node-method":Vl,filterable:"","popper-class":"tree-select-ds_popper",modelValue:ae.value,"onUpdate:modelValue":e[3]||(e[3]=o=>ae.value=o),"node-key":"id",props:Sl,data:R.dataSourceList,"render-after-expand":!1},{default:s(({data:{name:o,leaf:v,type:b,extraFlag:Hl}})=>[m("div",ms,[l(a(k),null,{default:s(()=>[l(a(y),{"static-content":Al({leaf:v,type:b})},{default:s(()=>[(c(),C(O(Ul({leaf:v,type:b})),{class:"svg-icon"}))]),_:2},1032,["static-content"])]),_:2},1024),!v||Hl>-1?(c(),w("span",ps,f(o),1)):(c(),C(r,{key:1,effect:"dark",content:`${a(d)("data_set.invalid_data_source")}:${o}`,placement:"top"},{default:s(()=>[m("span",null,f(o),1)]),_:2},1032,["content"]))])]),_:1},8,["placeholder","modelValue","data"]),m("p",fs,[T(f(a(d)("datasource.data_table"))+" ",1),m("span",vs,[l(a(k),{class:"icon-color"},{default:s(()=>[l(a(y),{name:"reference-table"},{default:s(()=>[l(a(_a),{class:"svg-icon"})]),_:1})]),_:1}),T(" "+f(z.value.length),1)])]),l(n,{modelValue:Le.value,"onUpdate:modelValue":e[4]||(e[4]=o=>Le.value=o),class:"search",placeholder:a(d)("deDataset.by_table_name"),clearable:""},{prefix:s(()=>[l(a(k),null,{default:s(()=>[l(a(y),{name:"icon_search-outline_outlined"},{default:s(()=>[l(a(To),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"])]),!z.value.length&&Le.value!==""?(c(),w("div",_s,[m("div",gs,f(a(d)("data_set.relevant_content_found")),1)])):(c(),w("div",hs,[ae.value?(c(),w("div",{key:0,class:"list-item_primary",onDragstart:e[5]||(e[5]=o=>ea(o,rt)),onDragend:Nl,draggable:!0,onClick:e[6]||(e[6]=o=>ta(rt))},[l(a(k),{class:"icon-color"},{default:s(()=>[l(a(y),{name:"icon_sql_outlined_1"},{default:s(()=>[l(a(es),{class:"svg-icon"})]),_:1})]),_:1}),m("span",ys,f(a(d)("data_set.custom_sql")),1)],32)):$("",!0),l(a(Jl),{itemSize:40,data:z.value,total:z.value.length,width:re.value-17,height:a(Da)-305,scrollbarAlwaysOn:!1,"class-name":"el-select-dropdown__list",layout:"vertical"},{default:s(({index:o,style:v})=>[m("div",{class:"list-item_primary",style:je(v),title:z.value[o].tableName,onDragstart:b=>ea(b,z.value[o]),onDragend:e[7]||(e[7]=b=>Pe.value=!1),draggable:!0,onClick:b=>ta(z.value[o])},[l(a(k),{class:"icon-color"},{default:s(()=>[l(a(y),{name:"reference-table"},{default:s(()=>[l(a(_a),{class:"svg-icon"})]),_:1})]),_:1}),m("span",Cs,f(z.value[o].tableName),1)],44,bs)]),_:1},8,["data","total","width","height"])]))],4)),[[Be,lt.value],[ke,ye.value]]),m("div",{class:"drag-right",style:je({width:`calc(100vw - ${ye.value?re.value:0}px)`})},[Je.value?(c(),w("div",ws,[l(a(k),null,{default:s(()=>[l(a(y),{name:"icon_warning_colorful"},{default:s(()=>[l(a(ls),{class:"svg-icon"})]),_:1})]),_:1}),T(" "+f(a(d)("data_set.be_reported_incorrectly")),1)])):$("",!0),l(Xo,{onReGetName:_t,onJoinEditor:Ka,onChangeUpdate:nt,maskShow:Pe.value,dragHeight:H.value,getDsName:Sa,offsetX:Nt.value,offsetY:Lt.value,ref_key:"datasetDrag",ref:L,onUpdateAllfields:al,onAddComplete:vt},null,8,["maskShow","dragHeight","offsetX","offsetY"]),m("div",{class:"sql-result",style:je({height:B.value?`${Je.value?B.value-40:B.value}px`:`calc(100% - ${Je.value?H.value+40:H.value}px)`})},[m("div",Ts,[m("span",{class:"drag",onMousedown:_l},null,32),m("div",xs,[l(i,{disabled:!p.value.length,onClick:e[8]||(e[8]=o=>Ga("q")),secondary:""},{icon:s(()=>[l(a(k),null,{default:s(()=>[l(a(y),{name:"icon_add_outlined"},{default:s(()=>[l(a(ga),{class:"svg-icon"})]),_:1})]),_:1})]),default:s(()=>[T(" "+f(a(d)("dataset.add_calc_field")),1)]),_:1},8,["disabled"]),l(i,{disabled:!p.value.length,onClick:ol,secondary:""},{icon:s(()=>[l(a(k),null,{default:s(()=>[l(a(y),null,{default:s(()=>[l(a(wo),{class:"svg-icon"})]),_:1})]),_:1})]),default:s(()=>[T(" "+f(a(d)("dataset.create_grouping_field")),1)]),_:1},8,["disabled"]),J((c(),C(i,{style:{"min-width":"70px"},disabled:!p.value.length,onClick:Tl,secondary:""},{icon:s(()=>[l(a(k),null,{default:s(()=>[l(a(y),{name:"icon_refresh_outlined"},{default:s(()=>[l(a(xo),{class:"svg-icon"})]),_:1})]),_:1})]),default:s(()=>[T(" "+f(a(d)("data_set.refresh_data")),1)]),_:1},8,["disabled"])),[[Be,te.value]])])]),l(F,{class:"padding-24",modelValue:he.value,"onUpdate:modelValue":e[9]||(e[9]=o=>he.value=o),onTabChange:Bt},{default:s(()=>[l(g,{label:a(d)("chart.data_preview"),name:"preview"},null,8,["label"]),l(g,{label:a(d)("dataset.batch_manage"),name:"manage"},null,8,["label"])]),_:1},8,["modelValue"]),J(m("div",Fs,[m("div",ks,[m("div",{class:S(["field-d",{open:Ae.value}])},[m("div",{class:S(["title",{expanded:Ae.value}]),onClick:e[10]||(e[10]=o=>Ae.value=!Ae.value)},[l(a(k),{class:"expand"},{default:s(()=>[l(a(y),{name:"icon_expand-right_filled"},{default:s(()=>[l(a(ha),{class:"svg-icon"})]),_:1})]),_:1}),T("  "+f(a(d)("chart.dimension")),1)],2),Ae.value?(c(),C(N,{key:0,data:ee.value,props:At},{default:s(({data:o})=>[m("span",Vs,[l(a(k),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),C(O(pa(o.deType,o.extField)),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",{title:o.name,class:"label-tooltip"},f(o.name),9,Ns),m("div",Ls,[l(ya,{extField:o.extField,"trans-type":a(d)("data_set.convert_to_indicator"),"show-time":o.deExtractType===0,onHandleCommand:v=>X(o,v)},null,8,["extField","trans-type","show-time","onHandleCommand"])])])]),_:1},8,["data"])):$("",!0)],2),m("div",{class:S(["field-q",{open:Ue.value}])},[m("div",{class:S(["title",{expanded:Ue.value}]),onClick:e[11]||(e[11]=o=>Ue.value=!Ue.value)},[l(a(k),{class:"expand"},{default:s(()=>[l(a(y),{name:"icon_expand-right_filled"},{default:s(()=>[l(a(ha),{class:"svg-icon"})]),_:1})]),_:1}),T("  "+f(a(d)("chart.quota")),1)],2),Ue.value?(c(),C(N,{key:0,data:Q.value,props:At},{default:s(({data:o})=>[m("span",Es,[l(a(k),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),C(O(pa(o.deType,o.extField,!0)),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",{title:o.name,class:"label-tooltip"},f(o.name),9,Ds),m("div",Ss,[l(ya,{"trans-type":a(d)("data_set.convert_to_dimension"),typeColor:"green-color","show-time":o.deExtractType===0,extField:o.extField,onHandleCommand:v=>X(o,v)},null,8,["trans-type","show-time","extField","onHandleCommand"])])])]),_:1},8,["data"])):$("",!0)],2)]),m("div",Is,[J((c(),C(E,{class:"dataset-preview_table",onRowClick:Fl,"header-class":"header-cell",data:ft.value,border:"",style:{width:"100%",height:"100%"}},{empty:s(()=>[l(Ho,{description:a(d)("data_set.no_data"),"img-type":"noneWhite"},null,8,["description"])]),default:s(()=>[(c(!0),w(ne,null,Ve(Ie.value,(o,v)=>(c(),C(h,{key:o.dataKey+o.deType,prop:o.dataKey,label:o.title,width:Ie.value.length-1===v?150:"auto",fixed:Ie.value.length-1===v?"right":!1},{header:s(()=>[m("div",As,[l(a(k),{style:{"margin-right":"6px"}},{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),C(O(a(P)[a(G)[o.deType]]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",{class:"ellipsis",title:o.title,style:{width:"120px"}},f(o.title),9,Us)])]),_:2},1032,["prop","label","width","fixed"]))),128))]),_:1},8,["data"])),[[Be,te.value]])])],512),[[ke,he.value==="preview"&&!!p.value.length]]),J(m("div",qs,[m("div",Ms,[l(A,{modelValue:R.fieldCollapse,"onUpdate:modelValue":e[12]||(e[12]=o=>R.fieldCollapse=o),class:"style-collapse"},{default:s(()=>[l(Z,{name:"dimension",title:a(d)("chart.dimension"),class:"dimension-manage-header manage-header"},{default:s(()=>[l(E,{onSelectionChange:ua,ref_key:"dimensionsTable",ref:ce,data:ee.value,height:Ze.value,style:{width:"100%"}},{default:s(()=>[l(h,{selectable:Ha,type:"selection",width:"40"}),l(h,{prop:"name",label:a(d)("dataset.field_name"),width:"264"},{default:s(o=>[m("div",$s,[l(n,{modelValue:o.row.name,"onUpdate:modelValue":v=>o.row.name=v,placeholder:a(d)("commons.input_content")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])]),_:1},8,["label"]),l(h,{prop:"originName",label:a(d)("dataset.origin_name"),width:"240"},{default:s(o=>[m("div",Hs,[o.row.extField===2?(c(),w("span",Rs,f(a(d)("dataset.calc_field")),1)):o.row.extField===3?(c(),w("span",Bs,f(a(d)("dataset.grouping_field")),1)):(c(),w("span",Os,f(o.row.originName),1))])]),_:1},8,["label"]),l(h,{prop:"description",label:a(d)("deDataset.description"),width:"240"},{default:s(o=>[m("div",Gs,[o.row.extField===0?(c(),w("span",js,f(o.row.description),1)):(c(),w("span",Ys," "))])]),_:1},8,["label"]),l(h,{prop:"datasetTableId",label:a(d)("data_set.table_name_de"),width:"240"},{default:s(o=>[T(f(o.row.extField===0?ot.value[o.row.datasetTableId]:""),1)]),_:1},8,["label"]),l(h,{prop:"deType",label:a(d)("dataset.field_type"),width:"200"},{default:s(o=>[l(I,{class:S(!!o.row.deTypeArr&&!!o.row.deTypeArr.length&&"select-type"),"popper-class":"cascader-panel",modelValue:o.row.deTypeArr,"onUpdate:modelValue":v=>o.row.deTypeArr=v,onChange:v=>ca(o.row,v),options:o.row.deExtractType===0?it:dt},{default:s(({data:v})=>[l(a(k),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),C(O(a(P)[W(v.value)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(v.value)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",null,f(v.label),1)]),_:2},1032,["class","modelValue","onUpdate:modelValue","onChange","options"]),m("span",Zs,[l(a(k),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),C(O(a(P)[W(o.row.deType)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.row.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)])]),_:1},8,["label"]),l(h,{prop:"deExtraType",label:a(d)("dataset.origin_type"),width:"168"},{default:s(o=>[m("div",Ps,[o.row.extField===0?(c(),w("span",Xs,[l(a(k),null,{default:s(()=>[l(a(y),{className:"primary-color"},{default:s(()=>[(c(),C(O(a(P)[W(o.row.deExtractType)]),{class:"svg-icon primary-color"}))]),_:2},1024)]),_:2},1024),T(" "+f(Dt(o.row.deExtractType)),1)])):(c(),w("span",zs,f(a(d)("dataset.calc_field")),1))])]),_:1},8,["label"]),l(h,{fixed:"right",label:a(d)("chart.dimension")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("data_set.convert_to_indicator"),placement:"top"},{default:s(()=>[[3].includes(o.row.extField)?$("",!0):(c(),C(i,{key:0,text:"",onClick:v=>X(o.row,"translate")},{icon:s(()=>[l(a(y),{name:"icon_switch_outlined"},{default:s(()=>[l(a(ba),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"]))]),_:2},1032,["content"])]),_:1},8,["label"]),l(h,{fixed:"right",width:"168",label:a(d)("dataset.operator")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("dataset.copy"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:v=>X(o.row,"copy")},{icon:s(()=>[l(a(y),{name:"icon_copy_outlined"},{default:s(()=>[l(a(Ca),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.delete"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:v=>X(o.row,"delete")},{icon:s(()=>[l(a(y),{name:"icon_delete-trash_outlined"},{default:s(()=>[l(a(Ft),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.edit"),placement:"top"},{default:s(()=>[[2,3].includes(o.row.extField)?(c(),C(i,{key:0,text:"",onClick:v=>X(o.row,"editor")},{icon:s(()=>[l(a(y),{name:"icon_edit_outlined"},{default:s(()=>[l(a(wa),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])):$("",!0)]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data","height"])]),_:1},8,["title"]),l(Z,{name:"quota",title:a(d)("chart.quota"),class:"quota-manage-header manage-header"},{default:s(()=>[l(E,{onSelectionChange:ua,ref_key:"quotaTable",ref:ue,height:Ze.value,data:Q.value,style:{width:"100%"}},{default:s(()=>[l(h,{type:"selection",width:"40"}),l(h,{prop:"name",label:a(d)("dataset.field_name"),width:"264"},{default:s(o=>[m("div",Ws,[l(n,{modelValue:o.row.name,"onUpdate:modelValue":v=>o.row.name=v,placeholder:a(d)("commons.input_content")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])]),_:1},8,["label"]),l(h,{prop:"originName",label:a(d)("dataset.origin_name"),width:"240"},{default:s(o=>[m("div",Js,[o.row.extField===0?(c(),w("span",Ks,f(o.row.originName),1)):(c(),w("span",Qs,f(a(d)("dataset.calc_field")),1))])]),_:1},8,["label"]),l(h,{prop:"description",label:a(d)("deDataset.description"),width:"240"},{default:s(o=>[m("div",en,[o.row.extField===0?(c(),w("span",tn,f(o.row.description),1)):(c(),w("span",an," "))])]),_:1},8,["label"]),l(h,{prop:"datasetTableId",label:a(d)("data_set.table_name_de"),width:"240"},{default:s(o=>[T(f(o.row.extField===0?ot.value[o.row.datasetTableId]:""),1)]),_:1},8,["label"]),l(h,{prop:"deType",label:a(d)("dataset.field_type"),width:"200"},{default:s(o=>[l(I,{class:S(!!o.row.deTypeArr&&!!o.row.deTypeArr.length&&"select-type"),"popper-class":"cascader-panel",modelValue:o.row.deTypeArr,"onUpdate:modelValue":v=>o.row.deTypeArr=v,onChange:v=>ca(o.row,v),options:o.row.deExtractType===0?it:dt},{default:s(({data:v})=>[l(a(k),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),C(O(a(P)[W(v.value)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(v.value)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",null,f(v.label),1)]),_:2},1032,["class","modelValue","onUpdate:modelValue","onChange","options"]),m("span",ln,[l(a(k),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),C(O(a(P)[W(o.row.deType)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.row.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)])]),_:1},8,["label"]),l(h,{prop:"deExtraType",label:a(d)("dataset.origin_type"),width:"168"},{default:s(o=>[m("div",on,[o.row.extField===0?(c(),w("span",sn,[l(a(k),null,{default:s(()=>[l(a(y),{className:"green-color"},{default:s(()=>[(c(),C(O(a(P)[W(o.row.deExtractType)]),{class:"svg-icon green-color"}))]),_:2},1024)]),_:2},1024),T(" "+f(Dt(o.row.deExtractType)),1)])):(c(),w("span",nn,f(a(d)("dataset.calc_field")),1))])]),_:1},8,["label"]),l(h,{fixed:"right",label:a(d)("chart.quota")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("data_set.convert_to_dimension"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:v=>X(o.row,"translate")},{icon:s(()=>[l(a(y),{name:"icon_switch_outlined"},{default:s(()=>[l(a(ba),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),_:1},8,["label"]),l(h,{fixed:"right",width:"168",label:a(d)("dataset.operator")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("dataset.copy"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:v=>X(o.row,"copy")},{icon:s(()=>[l(a(y),{name:"icon_copy_outlined"},{default:s(()=>[l(a(Ca),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.delete"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:v=>X(o.row,"delete")},{icon:s(()=>[l(a(y),{name:"icon_delete-trash_outlined"},{default:s(()=>[l(a(Ft),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.edit"),placement:"top"},{default:s(()=>[o.row.extField===2?(c(),C(i,{key:0,text:"",onClick:v=>X(o.row,"editor")},{icon:s(()=>[l(a(y),{name:"icon_edit_outlined"},{default:s(()=>[l(a(wa),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])):$("",!0)]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["height","data"])]),_:1},8,["title"])]),_:1},8,["modelValue"])]),Te.value.length?(c(),w("div",dn,[m("div",rn,[T(f(a(d)("data_set.selected"))+" ",1),m("span",un,f(Te.value.length),1),T(" "+f(a(d)("data_set.bar"))+" ",1),l(i,{onClick:xl,text:"",style:{"margin-left":"16px"}},{default:s(()=>[T(f(a(d)("commons.clear")),1)]),_:1})]),m("div",cn,[l(I,{disabled:!ra.value,class:S(!!se.value.length&&"select-type"),modelValue:se.value,"onUpdate:modelValue":e[13]||(e[13]=o=>se.value=o),onChange:kl,"popper-class":"cascader-panel",options:Te.value.every(o=>o===0)?it:dt},{default:s(({data:o})=>[l(a(k),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),C(O(a(P)[W(o.value)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.value)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",null,f(o.label),1)]),_:1},8,["disabled","class","modelValue","options"]),m("span",mn,[l(a(k),null,{default:s(()=>[l(a(y),{className:`field-icon-${W(se.value[0])}`},{default:s(()=>[(c(),C(O(a(P)[W(se.value[0])]),{class:S(["svg-icon",`field-icon-${W(se.value[0])}`])},null,8,["class"]))]),_:1},8,["className"])]),_:1})]),l(r,{class:"item",effect:"dark",placement:"top"},{content:s(()=>[m("div",null,f(a(d)("dataset.field_diff")),1)]),default:s(()=>[J(l(a(k),{size:"16px",style:{"margin-left":"6px"}},{default:s(()=>[l(a(y),{name:"icon_info_outlined"},{default:s(()=>[l(a(Fo),{class:"svg-icon tip-icon"})]),_:1})]),_:1},512),[[ke,!ra.value]])]),_:1})]),me.value.every(o=>o.groupType==="d")?(c(),C(i,{key:0,onClick:e[14]||(e[14]=o=>qt("q")),plain:"",style:{"margin-left":"200px"}},{default:s(()=>[T(f(a(d)("data_set.convert_to_indicator")),1)]),_:1})):me.value.every(o=>o.groupType==="q")?(c(),C(i,{key:1,onClick:e[15]||(e[15]=o=>qt("d")),plain:"",style:{"margin-left":"200px"}},{default:s(()=>[T(f(a(d)("data_set.convert_to_dimension")),1)]),_:1})):$("",!0)])):$("",!0)],512),[[ke,he.value!=="preview"&&!!p.value.length]])],4)],4)],32),l(D,{title:a(d)("dataset.edit_union_relation"),modelValue:ge.value,"onUpdate:modelValue":e[16]||(e[16]=o=>ge.value=o),"custom-class":"union-dataset-drawer",size:"840px","before-close":Zt,direction:"rtl"},{footer:s(()=>[l(i,{secondary:"",onClick:Zt},{default:s(()=>[T(f(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:tl},{default:s(()=>[T(f(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(jo,{ref_key:"fieldUnion",ref:qe,editArr:R.editArr},null,8,["editArr"])]),_:1},8,["title","modelValue"])])),[[Be,be.value]]),l(Yo,{onFinish:El,onOnDatasetSave:gl,ref_key:"creatDsFolder",ref:Vt},null,512),l(U,{"custom-class":"calc-field-edit-dialog",modelValue:_e.value,"onUpdate:modelValue":e[19]||(e[19]=o=>_e.value=o),width:"1000px",title:mt.value},{footer:s(()=>[l(i,{secondary:"",onClick:e[17]||(e[17]=o=>Pa())},{default:s(()=>[T(f(a(d)("dataset.cancel")),1)]),_:1}),l(i,{secondary:"",onClick:pl},{default:s(()=>[T(f(a(d)("datasource.validate")),1)]),_:1}),l(i,{type:"primary",onClick:e[18]||(e[18]=o=>Xa())},{default:s(()=>[T(f(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(Bo,{ref_key:"calcEdit",ref:j,crossDs:Je.value},null,8,["crossDs"])]),_:1},8,["modelValue","title"]),l(U,{class:"create-dialog",title:a(d)("data_set.format_edit"),modelValue:le.value,"onUpdate:modelValue":e[23]||(e[23]=o=>le.value=o),width:"1000px"},{footer:s(()=>[l(i,{secondary:"",onClick:e[21]||(e[21]=o=>Aa())},{default:s(()=>[T(f(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:e[22]||(e[22]=o=>Ua())},{default:s(()=>[T(f(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(Re,{ref_key:"ruleFormRef",ref:St,rules:La,model:V.value,"label-width":"120px"},{default:s(()=>[l(M,{prop:"name",label:a(d)("data_set.custom_time_format")},{default:s(()=>[l(n,{modelValue:V.value.name,"onUpdate:modelValue":e[20]||(e[20]=o=>V.value.name=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(U,{class:"create-dialog",title:a(d)("datasource.field_rename"),modelValue:Xe.value,"onUpdate:modelValue":e[27]||(e[27]=o=>Xe.value=o),width:"420px"},{footer:s(()=>[l(i,{secondary:"",onClick:e[25]||(e[25]=o=>$t())},{default:s(()=>[T(f(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:e[26]||(e[26]=o=>Za())},{default:s(()=>[T(f(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(Re,{ref_key:"ruleFormFieldRef",ref:It,rules:Ea,model:oe.value,"require-asterisk-position":"right","label-position":"top","label-width":"120px"},{default:s(()=>[l(M,{prop:"name",label:a(d)("dataset.field_name")},{default:s(()=>[l(n,{modelValue:oe.value.name,"onUpdate:modelValue":e[24]||(e[24]=o=>oe.value.name=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(U,{class:"create-dialog group-fields_dialog",title:bt.value,modelValue:Ce.value,"onUpdate:modelValue":e[31]||(e[31]=o=>Ce.value=o),width:"1000px"},{footer:s(()=>[l(i,{secondary:"",onClick:sl},{default:s(()=>[T(f(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:rl},{default:s(()=>[T(f(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[J((c(),C(Re,{ref_key:"ruleGroupFieldRef",ref:Jt,rules:ll,model:x,"require-asterisk-position":"right","label-position":"top","label-width":"120px"},{default:s(()=>[l(ql,{gutter:24},{default:s(()=>[l(Qe,{span:12},{default:s(()=>[l(M,{prop:"name",label:a(d)("dataset.field_name")},{default:s(()=>[l(n,{placeholder:a(d)("dataset.input_edit_name"),modelValue:x.name,"onUpdate:modelValue":e[28]||(e[28]=o=>x.name=o)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1}),l(Qe,{span:12},{default:s(()=>[l(M,{prop:"originName",label:a(d)("dataset.grouping_field")},{default:s(()=>[l(tt,{onChange:Qt,modelValue:x.originName,"onUpdate:modelValue":e[29]||(e[29]=o=>x.originName=o),style:{width:"100%"}},{default:s(()=>[(c(!0),w(ne,null,Ve(We.value,o=>(c(),C(et,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),l(M,{style:{"margin-top":"16px"}},{label:s(()=>[m("div",pn,f(a(d)("dataset.grouping_settings")),1)]),default:s(()=>[m("div",fn,[l($l,{"max-height":"393px"},{default:s(()=>[(c(!0),w(ne,null,Ve(x.groupList,(o,v)=>(c(),w("div",{class:"group-fields_item",key:v},[(c(),C(Re,{ref_for:!0,ref:b=>ze.value[v]=b,model:o,inline:"",key:v,"label-width":"auto",class:"form-dynamic"},{default:s(()=>[(c(),C(M,{key:v+"name",prop:"name",rules:{required:!0,message:a(d)("chart.value_can_not_empty"),trigger:"blur"}},{default:s(()=>[l(n,{style:{width:"278px"},modelValue:o.name,"onUpdate:modelValue":b=>o.name=b,placeholder:a(d)("common.inputText")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["rules"])),[0,null].includes(x.deTypeOrigin)?(c(),C(M,{key:v+"text",prop:"text",style:{width:"100%","margin-left":"24px"},rules:{validator:zt,required:!0,trigger:"change"}},{default:s(()=>[l(tt,{style:{width:"100%"},multiple:"","collapse-tags":"",filterable:"","collapse-tags-tooltip":"","max-collapse-tags":2,modelValue:o.text,"onUpdate:modelValue":b=>o.text=b},{default:s(()=>[(c(!0),w(ne,null,Ve(Kt.value,b=>(c(),C(et,{key:b,label:b,disabled:il(b,o.text),value:b},null,8,["label","disabled","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["rules"])):[2,3,4].includes(x.deTypeOrigin)?(c(),w("div",vn,[(c(),C(M,{key:v+"min",prop:"min",rules:{required:!0,message:a(d)("chart.value_can_not_empty"),trigger:"blur"}},{default:s(()=>[l(fa,{placeholder:a(d)("dataset.please_enter_number"),modelValue:o.min,"onUpdate:modelValue":b=>o.min=b,"controls-position":"right"},null,8,["placeholder","modelValue","onUpdate:modelValue"])]),_:2},1032,["rules"])),(c(),C(M,{key:v+"minTerm"},{default:s(()=>[l(tt,{modelValue:o.minTerm,"onUpdate:modelValue":b=>o.minTerm=b},{default:s(()=>[(c(),w(ne,null,Ve(Xt,b=>l(et,{key:b.value,label:b.label,value:b.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)),m("div",_n,f(a(d)("dataset.field_value")),1),(c(),C(M,{key:v+"maxTerm"},{default:s(()=>[l(tt,{modelValue:o.maxTerm,"onUpdate:modelValue":b=>o.maxTerm=b},{default:s(()=>[(c(),w(ne,null,Ve(Xt,b=>l(et,{key:b.value,label:b.label,value:b.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)),(c(),C(M,{key:v+"max",prop:"max",rules:{required:!0,message:a(d)("chart.value_can_not_empty"),trigger:"blur"}},{default:s(()=>[l(fa,{placeholder:a(d)("dataset.please_enter_number"),modelValue:o.max,"onUpdate:modelValue":b=>o.max=b,"validate-even":!1,"controls-position":"right"},null,8,["placeholder","modelValue","onUpdate:modelValue"])]),_:2},1032,["rules"]))])):[1].includes(x.deTypeOrigin)?(c(),C(M,{key:v+"time",prop:"time",class:"group-fields_num",rules:{required:!0,validator:zt,trigger:"change"}},{default:s(()=>[l(Ml,{"end-placeholder":a(d)("commons.date.end_date"),"start-placeholder":a(d)("commons.date.start_date"),modelValue:o.time,"onUpdate:modelValue":b=>o.time=b,type:"daterange"},null,8,["end-placeholder","start-placeholder","modelValue","onUpdate:modelValue"])]),_:2},1032,["rules"])):$("",!0)]),_:2},1032,["model"])),x.groupList.length!==1?(c(),C(i,{key:0,class:"variable_del",text:"",onClick:b=>ml(v)},{icon:s(()=>[l(a(y),null,{default:s(()=>[l(a(Ft),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])):$("",!0)]))),128))]),_:1})])]),_:1}),l(i,{style:{"margin-top":"-20px"},onClick:cl,text:""},{icon:s(()=>[l(a(y),null,{default:s(()=>[l(a(ga),{class:"svg-icon"})]),_:1})]),default:s(()=>[T(" "+f(a(d)("auth.add_condition")),1)]),_:1}),e[32]||(e[32]=m("div",{class:"line"},null,-1)),m("div",gn,[l(n,{placeholder:a(d)("common.inputText"),style:{width:"278px","margin-right":"24px"},modelValue:x.otherGroup,"onUpdate:modelValue":e[30]||(e[30]=o=>x.otherGroup=o)},null,8,["placeholder","modelValue"]),T(" "+f(a(d)("dataset.ungrouped_value")),1)])]),_:1},8,["model"])),[[Be,yt.value]])]),_:1},8,["title","modelValue"]),l(a(kt),{jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvTmV3V2luZG93SGFuZGxlcg==",onLoaded:na,onLoadFail:na}),l(a(kt),{jsname:"L2NvbXBvbmVudC9wbHVnaW5zLWhhbmRsZXIvRHNDYXRlZ29yeUhhbmRsZXI=",onLoadDsPlugin:Il}),R.dataSourceList?(c(),C(a(kt),{key:0,ref_key:"datasetCheckRef",ref:Ht,"is-edit":Se.value,"ds-list":R.dataSourceList,"ds-id":ae.value,onBack:De,jsname:"L2NvbXBvbmVudC9kYXRhc2V0L2luZGV4"},null,8,["is-edit","ds-list","ds-id"])):$("",!0)],64)}}});const Ld=Jo(yn,[["__scopeId","data-v-479902d2"]]);export{Ld as default};

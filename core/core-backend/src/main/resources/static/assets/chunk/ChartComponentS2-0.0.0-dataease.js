import{o as Fe,L as Ee,a4 as te}from"./element-plus-secondary-0.0.0-dataease.js";import{d as Me,t as De,r as q,l as He,x as Le,k as b,b as Ve,e as qe,o as k,c as oe,a as y,a0 as ae,a3 as j,u as R,Y as O,Z as B,_ as ie,M as je,n as le,i as Re,v as Oe,z as Ne,a1 as re,a2 as We}from"./@vue-0.0.0-dataease.js";import{g as Je}from"./chart-0.0.0-dataease2.js";import{c as Ue}from"./index-0.0.0-dataease12.js";import{useAppStoreWithOut as Ye}from"./app-0.0.0-dataease.js";import{d as Ke}from"./dvMain-0.0.0-dataease.js";import{V as Ze}from"./ViewTrackBar-0.0.0-dataease.js";import{s as Ge}from"./pinia-0.0.0-dataease.js";import Qe from"./ChartError-0.0.0-dataease.js";import{B as Xe}from"./chart-0.0.0-dataease.js";import{r as ne,e as $e,f as et}from"./canvasStyle-0.0.0-dataease.js";import{i as tt,O as ot,A as at}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{u as it}from"./index-0.0.0-dataease.js";import{v as lt,Q as rt}from"./canvasUtils-0.0.0-dataease.js";import{p as nt}from"./util-0.0.0-dataease2.js";import{d as st,A as pt,e as ut}from"./lodash-es-0.0.0-dataease.js";import{_ as mt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./@antv-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./@turf-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./element-resize-detector-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./mathjs-0.0.0-dataease.js";import"./decimal.js-0.0.0-dataease.js";import"./typed-function-0.0.0-dataease.js";import"./complex.js-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./exceljs-0.0.0-dataease.js";import"./file-saver-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./translate-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./snapshot-0.0.0-dataease.js";import"./ModelUtil-0.0.0-dataease.js";const ct={class:"canvas-area"},dt={key:0,class:"canvas-content"},ft={class:"enlarge-image"},gt=["src"],se=1,vt=Me({__name:"ChartComponentS2",props:{element:{type:Object,default(){return{propValue:null}}},view:{type:Object,default(){return{propValue:null}}},showPosition:{type:String,required:!1,default:"canvas"},scale:{type:Number,required:!1,default:1},terminal:{type:String,default:"pc"},drillLength:{type:Number,required:!1,default:0},suffixId:{type:String,required:!1,default:"common"},fontFamily:{type:String,required:!1,default:"inherit"}},emits:["onPointClick","onChartClick","onDrillFilters","onJumpClick"],setup(N,{expose:pe,emit:ue}){const P=Ke(),{nowPanelTrackInfo:W,nowPanelJumpInfo:J,mobileInPc:_,canvasStyleData:U,embeddedCallBack:me,inMobile:F}=Ge(P),{emitter:ce}=it(),f=N,C=ue,Y=!lt()&&tt(),{view:n,showPosition:T,scale:g,terminal:K,drillLength:de,suffixId:fe}=De(f),I=q(!1),Z=q(""),x=Re("chartExtRequest"),a=He({curActionId:null,curTrackMenu:[],trackBarStyle:{position:"absolute",left:"50px",top:"50px"},linkageActiveParam:null,pointParam:null,loading:!1,data:{fields:[]},pageInfo:{total:0,pageSize:20,currentPage:1},totalItems:0,showPage:!1,pageStyle:"simple",currentPageSize:0,imgEnlarge:!1,imgSrc:""});let S=Le({fields:[]});const w="container-"+T.value+"-"+n.value.id+"-"+fe.value,G=q(null),E=(t,e,l=!0)=>{if(t.customAttr.basicStyle.tablePageStyle==="general"?a.currentPageSize!==0&&(t.chartExtRequest.pageSize=a.currentPageSize):delete t.chartExtRequest.pageSize,t.tableId||t.dataFrom==="template"){I.value=!1;const r=JSON.parse(JSON.stringify(t));Je(r).then(o=>{o.code&&o.code!==0?(I.value=!0,Z.value=o.msg):(S.value=o==null?void 0:o.data,a.totalItems=o==null?void 0:o.totalItems,P.setViewDataDetails(t.id,o),C("onDrillFilters",o==null?void 0:o.drillFilters),M(o,l)),e==null||e()}).catch(()=>{e==null||e()})}else e==null||e()};let i=null,d;const ge=(t,e)=>{S.value=e,M(t,!1)},ve=t=>{var l,r;const e=nt(t.customAttr);if(e.tableCell.mergeCells===void 0&&(e.tableCell.mergeCells=!1),t.type==="table-pivot"){(r=(l=e.tableTotal)==null?void 0:l.row)!=null&&r.subTotalsDimensionsNew||(e.tableTotal.row.subTotalsDimensionsNew=!!e.tableTotal.row.subTotalsDimensionsNew);const{tableHeader:o}=e;o.tableHeaderColBgColor||(o.tableHeaderColBgColor=o.tableHeaderBgColor,o.tableHeaderColFontColor=o.tableHeaderFontColor,o.tableTitleColFontSize=o.tableTitleFontSize,o.tableHeaderColAlign=o.tableHeaderAlign,o.isColBolder=o.isBolder,o.isColItalic=o.isItalic,o.tableHeaderCornerBgColor=o.tableHeaderBgColor,o.tableHeaderCornerFontColor=o.tableHeaderFontColor,o.tableTitleCornerFontSize=o.tableTitleFontSize,o.tableHeaderCornerAlign=o.tableHeaderAlign,o.isCornerBolder=o.isBolder,o.isCornerItalic=o.isItalic)}},M=(t,e)=>{t&&(ve(t),d=at({...pt(t,ut(Xe)),data:S.value,fontFamily:f.fontFamily}),ne($e,d.customAttr,g.value,K.value),ne(et,d.customStyle,g.value,K.value),Se(d,e),le(()=>Q(e)))},Q=st(t=>{var l,r,o,p;(r=(l=i==null?void 0:i.facet)==null?void 0:l.timer)==null||r.stop(),(o=i==null?void 0:i.facet)==null||o.cancelScrollFrame(),i==null||i.destroy(),(p=i==null?void 0:i.getCanvasElement())==null||p.remove(),i=Ue.getChartView(d.render,d.type).drawChart({container:w,chart:Oe(d),chartObj:i,pageInfo:a.pageInfo,action:Ce,resizeAction:we,touchAction:Pe}),i==null||i.render(),P.setViewInstanceInfo(d.id,i),z()},500),Se=(t,e)=>{const l=t.customAttr;if(t.type!=="table-info"||l.basicStyle.tablePageMode!=="page"){a.showPage=!1;return}const r=a.pageInfo;a.pageStyle=l.basicStyle.tablePageStyle,a.pageStyle==="general"?a.currentPageSize===0?a.currentPageSize=r.pageSize:r.pageSize=a.currentPageSize:r.pageSize=l.basicStyle.tablePageSize??20,a.totalItems>a.pageInfo.pageSize||a.pageStyle==="general"?(r.total=a.totalItems,a.showPage=!0):a.showPage=!1,e&&(a.pageInfo.currentPage=1)},X=()=>{var t,e;(e=(t=i==null?void 0:i.facet)==null?void 0:t.timer)==null||e.stop()},be=()=>{z()};let D;const z=()=>{D&&clearTimeout(D),D=setTimeout(()=>{var l,r,o;const t=d==null?void 0:d.customAttr,e=d==null?void 0:d.senior;if(i&&((l=e==null?void 0:e.scrollCfg)!=null&&l.open)&&((r=S.value.tableRow)!=null&&r.length)&&(n.value.type==="table-normal"||n.value.type==="table-info"&&!a.showPage)){(o=i.facet.timer)==null||o.stop();let p=i.store.get("scrollY")||0;const m=document.getElementById(w).offsetHeight;if(!m)return;const u=t.tableCell.tableItemHeight,c=t.tableHeader.showTableHeader===!1?1:t.tableHeader.tableTitleHeight,s=i.theme.scrollBar.size,V=u*S.value.tableRow.length+c-m+s;if(V<s)return;p>=V-1&&(i.store.set("scrollY",0),i.render(),p=0);const Be=m-c-s+p,_e=(S.value.tableRow.length-Be/u)/e.scrollCfg.row*e.scrollCfg.interval;i.facet.scrollWithAnimation({offsetY:{value:V,animate:!1}},_e,z)}},1500)},he=b(()=>n.value.type!=="table-info"?!1:a.showPage),$=t=>{let e={goPage:t};x.value&&(e={...e,...x.value});const l={...n.value,chartExtRequest:e};E(l,null,!1)},ke=t=>{a.pageStyle==="general"&&(a.currentPageSize=t);let e={pageSize:t};x.value&&(e={...e,...x.value});const l={...n.value,chartExtRequest:e};E(l,null,!1)},ye=()=>{me.value==="yes"&&H("pointClick")},Pe=t=>{h.value.length||t==null||t()},Ce=t=>{if(a.pointParam=t,a.curActionId=t.data.name,a.curTrackMenu=ee(a.curActionId),ye(),h.value.length<2)H(h.value[0]);else{const e={left:t.x-50,top:t.y+10};rt(f.element,e,f.scale,h.value.length),Y?(a.trackBarStyle.left=e.left+40+"px",a.trackBarStyle.top=e.top+70+"px"):(a.trackBarStyle.left=e.left+"px",a.trackBarStyle.top=e.top+"px"),G.value.trackButtonClick()}};Ye();const H=t=>{var p,m;const e=a.pointParam;if(!((p=e==null?void 0:e.data)!=null&&p.dimensionList))return;const l={option:"linkage",name:a.pointParam.data.name,viewId:n.value.id,dimensionList:a.pointParam.data.dimensionList,quotaList:a.pointParam.data.quotaList};if(["table-info","table-normal"].includes(n.value.type)){l.quotaList=[];const u=[],c=[];n.value.xAxis.forEach(s=>{s.groupType==="d"?u.push(s.id):c.push(s.id)}),n.value.yAxis.forEach(s=>{s.groupType==="d"?u.push(s.id):c.push(s.id)}),u.includes(e.data.name)?l.dimensionList=l.dimensionList.filter(s=>s.id===e.data.name):c.includes(e.data.name)&&(l.dimensionList=l.dimensionList.filter(s=>u.includes(s.id))),n.value}const r={option:"jump",name:a.pointParam.data.name,viewId:n.value.id,dimensionList:a.pointParam.data.dimensionList,quotaList:a.pointParam.data.quotaList,sourceType:a.pointParam.data.sourceType},o={option:"pointClick",name:a.pointParam.data.name,viewId:n.value.id,dimensionList:a.pointParam.data.dimensionList,quotaList:a.pointParam.data.quotaList};switch(t){case"pointClick":C("onPointClick",o);break;case"linkageAndDrill":P.addViewTrackFilter(l),C("onChartClick",e);break;case"drill":C("onChartClick",e);break;case"linkage":P.addViewTrackFilter(l);break;case"jump":if(_.value&&!F.value)return;C("onJumpClick",r);break;case"enlarge":n.value.type==="table-info"&&((m=e.data.dimensionList)==null||m.forEach(u=>{u.id===a.curActionId&&(a.imgSrc=u.value,a.imgEnlarge=!0)}));break}},h=b(()=>["table-info","table-normal"].includes(n.value.type)&&a.curActionId?ee(a.curActionId):Ie.value),Ie=b(()=>{var r,o,p,m;let t=[];if(T.value==="viewDialog")return t;let e=0,l=0;return(o=(r=S.value)==null?void 0:r.fields)==null||o.forEach(u=>{const c=n.value.id+"#"+u.id;W.value[c]&&e++,J.value[c]&&l++}),l&&((p=n.value)!=null&&p.jumpActive)&&(!_.value||F.value)&&t.push("jump"),e&&((m=n.value)!=null&&m.linkageActive)&&t.push("linkage"),n.value.drillFields.length&&t.push("drill"),t.length===3&&f.element.actionSelection.linkageActive==="auto"?t=["jump","linkageAndDrill"]:t.length===2&&f.element.actionSelection.linkageActive==="auto"&&!t.includes("jump")&&(t=["linkageAndDrill"]),t}),ee=t=>{var m,u,c;let e=[];if(T.value==="viewDialog")return e;let l=0,r=0,o=0;const p=n.value.id+"#"+t;return W.value[p]&&l++,J.value[p]&&r++,r&&((m=n.value)!=null&&m.jumpActive)&&(!_.value||F.value)&&e.push("jump"),l&&((u=n.value)!=null&&u.linkageActive)&&e.push("linkage"),n.value.drillFields.length&&n.value.drillFields[de.value].id===t&&o++,o&&e.push("drill"),e.length===3&&f.element.actionSelection.linkageActive==="auto"?e=["jump","linkageAndDrill"]:e.length===2&&f.element.actionSelection.linkageActive==="auto"&&!e.includes("jump")&&(e=["linkageAndDrill"]),n.value.type==="table-info"&&((c=n.value.xAxis)==null||c.forEach(s=>{s.id===t&&s.deType===7&&e.push("enlarge")})),e},we=t=>{var u,c;if(i!=null&&i.facet.timer&&(i==null||i.facet.timer.stop(),le(z)),T.value!=="canvas")return;const e=t.info.meta.field,{basicStyle:l}=n.value.customAttr,r=document.getElementById(w).offsetWidth,o=(u=l.tableFieldWidth)==null?void 0:u.find(s=>s.fieldId===e);let p;const m=parseFloat((t.info.resizedWidth/r*100).toFixed(2));if(o)o.width=m,p=[...l.tableFieldWidth];else{const s={fieldId:e,width:m};p=(c=l.tableFieldWidth)!=null&&c.length?[...l.tableFieldWidth,s]:[s]}ce.emit("set-table-column-width",p)};pe({calcData:E,renderChart:M,renderChartFromDialog:ge,trackMenu:h});let L;const ze=(t,e)=>{L&&clearTimeout(L),L=setTimeout(()=>{var l,r;i!=null&&i.facet?((r=(l=i==null?void 0:i.facet)==null?void 0:l.timer)==null||r.stop(),i==null||i.changeSheetSize(t,e),i==null||i.render()):Q(!1),z()},500)},v=[0,0];let A;Ve(()=>{A=new ResizeObserver(([t]=[])=>{const[e]=t.borderBoxSize||[];v[0]||v[1]||(v[0]=e.inlineSize,v[1]=e.blockSize);const l=Math.abs(e.inlineSize-v[0]),r=Math.abs(e.blockSize-v[1]);l<se&&r<se||(v[0]=e.inlineSize,v[1]=e.blockSize,ze(e.inlineSize,Math.round(e.blockSize)))}),A.observe(document.getElementById(w))}),qe(()=>{var t;try{(t=i==null?void 0:i.facet.timer)==null||t.stop(),i==null||i.destroy(),i=null,A==null||A.disconnect()}catch(e){console.warn(e)}});const Ae=b(()=>ot()?{height:20*g.value+8+"px",width:100/g.value+"%!important",left:50*(1-1/g.value)+"%",transform:"scale("+g.value+") translateZ(0)"}:{zoom:g.value});b(()=>({height:20*g.value+8+"px"}));const Te=b(()=>{var t;return[{"--de-pager-color":(t=U.value.component.seniorStyleSetting)==null?void 0:t.pagerColor}]}),xe=b(()=>{var t;return["#ffffff","#ffffffff","#a6a6a6ff"].includes((t=U.value.component.seniorStyleSetting)==null?void 0:t.pagerColor.toLowerCase())&&"table-page-info_dark"});return(t,e)=>{const l=Fe,r=Ee;return k(),oe(je,null,[y("div",ct,[ae(Ze,{ref_key:"viewTrack",ref:G,"track-menu":h.value,"font-family":N.fontFamily,class:"track-bar",style:j(a.trackBarStyle),onTrackClick:H,"is-data-v-mobile":R(Y),onMousemove:X},null,8,["track-menu","font-family","style","is-data-v-mobile"]),I.value?O("",!0):(k(),oe("div",dt,[y("div",{id:w,style:{position:"relative",height:"100%"},onMousemove:X,onMouseleave:be},null,32)])),he.value&&!I.value?(k(),B(l,{key:1,style:j(Ae.value)},{default:ie(()=>[y("div",{class:Ne(["table-page-info",xe.value]),style:j(Te.value),onKeydown:e[4]||(e[4]=re(()=>{},["stop"])),onKeyup:e[5]||(e[5]=re(()=>{},["stop"]))},[y("div",null,"共"+We(a.pageInfo.total)+"条",1),a.pageStyle!=="general"?(k(),B(R(te),{key:0,class:"table-page-content",layout:"prev, pager, next","page-size":a.pageInfo.pageSize,"onUpdate:pageSize":e[0]||(e[0]=o=>a.pageInfo.pageSize=o),"current-page":a.pageInfo.currentPage,"onUpdate:currentPage":[e[1]||(e[1]=o=>a.pageInfo.currentPage=o),$],"pager-count":5,total:a.pageInfo.total},null,8,["page-size","current-page","total"])):(k(),B(R(te),{key:1,class:"table-page-content",layout:"prev, pager, next, sizes, jumper","page-size":a.currentPageSize,"onUpdate:pageSize":[e[2]||(e[2]=o=>a.currentPageSize=o),ke],"current-page":a.pageInfo.currentPage,"onUpdate:currentPage":[e[3]||(e[3]=o=>a.pageInfo.currentPage=o),$],"pager-count":5,total:a.pageInfo.total},null,8,["page-size","current-page","total"]))],38)]),_:1},8,["style"])):O("",!0),I.value?(k(),B(Qe,{key:2,"err-msg":Z.value},null,8,["err-msg"])):O("",!0)]),ae(r,{modelValue:a.imgEnlarge,"onUpdate:modelValue":e[6]||(e[6]=o=>a.imgEnlarge=o),"append-to-body":"",class:"image-dialog"},{default:ie(()=>[y("div",ft,[y("img",{src:a.imgSrc,style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,gt)])]),_:1},8,["modelValue"])],64)}}});const Va=mt(vt,[["__scopeId","data-v-06951f05"]]);export{Va as default};

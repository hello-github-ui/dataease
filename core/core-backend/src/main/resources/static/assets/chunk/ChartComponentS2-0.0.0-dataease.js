import{u as Fe}from"./index-0.0.0-dataease.js";import{E as _e}from"./el-dialog-0.0.0-dataease.js";import{i as Me,aw as De,P as He}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as Le}from"./el-row-0.0.0-dataease.js";import{d as Ve,ah as je,t as qe,r as j,Z as Re,s as Oe,G as b,o as Ne,a as We,f as k,L as te,M as y,k as ae,V as q,j as R,a0 as O,g as B,i as oe,Y as Ue,n as le,Q as Je,am as Ye,U as Ge,ab as ie,a6 as Ke}from"./vue-0.0.0-dataease.js";import{b as Qe}from"./chart-0.0.0-dataease2.js";import{c as Ze}from"./index-0.0.0-dataease19.js";import{useAppStoreWithOut as Xe}from"./app-0.0.0-dataease.js";import{d as $e}from"./dvMain-0.0.0-dataease.js";import{V as et}from"./ViewTrackBar-0.0.0-dataease.js";import{E as ne}from"./el-pagination-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import tt from"./ChartError-0.0.0-dataease.js";import{B as at}from"./chart-0.0.0-dataease.js";import{r as re,e as ot,f as lt}from"./canvasStyle-0.0.0-dataease.js";import{v as it,Q as nt}from"./canvasUtils-0.0.0-dataease.js";import{p as rt}from"./util-0.0.0-dataease2.js";import{e as st,z as ut,d as ct}from"./lodash-0.0.0-dataease.js";import{_ as pt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./index-0.0.0-dataease20.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./el-dropdown-menu-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./dropdown-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./el-main-0.0.0-dataease.js";import"./index-0.0.0-dataease14.js";import"./translate-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./snapshot-0.0.0-dataease.js";import"./ModelUtil-0.0.0-dataease.js";const dt={class:"canvas-area"},ft={key:0,class:"canvas-content"},mt={class:"enlarge-image"},gt=["src"],se=1,vt=Ve({__name:"ChartComponentS2",props:{element:{type:Object,default(){return{propValue:null}}},view:{type:Object,default(){return{propValue:null}}},showPosition:{type:String,required:!1,default:"canvas"},scale:{type:Number,required:!1,default:1},terminal:{type:String,default:"pc"},drillLength:{type:Number,required:!1,default:0},suffixId:{type:String,required:!1,default:"common"},fontFamily:{type:String,required:!1,default:"inherit"}},emits:["onPointClick","onChartClick","onDrillFilters","onJumpClick"],setup(N,{expose:ue,emit:ce}){const P=$e(),{nowPanelTrackInfo:W,nowPanelJumpInfo:U,mobileInPc:x,canvasStyleData:J,embeddedCallBack:pe,inMobile:F}=je(P),{emitter:de}=Fe(),m=N,w=ce,Y=!it()&&Me(),{view:r,showPosition:T,scale:g,terminal:G,drillLength:fe,suffixId:me}=qe(m),C=j(!1),K=j(""),E=Je("chartExtRequest"),o=Re({curActionId:null,curTrackMenu:[],trackBarStyle:{position:"absolute",left:"50px",top:"50px"},linkageActiveParam:null,pointParam:null,loading:!1,data:{fields:[]},pageInfo:{total:0,pageSize:20,currentPage:1},totalItems:0,showPage:!1,pageStyle:"simple",currentPageSize:0,imgEnlarge:!1,imgSrc:""});let S=Oe({fields:[]});const I="container-"+T.value+"-"+r.value.id+"-"+me.value,Q=j(null),_=(t,e,i=!0)=>{if(t.customAttr.basicStyle.tablePageStyle==="general"?o.currentPageSize!==0&&(t.chartExtRequest.pageSize=o.currentPageSize):delete t.chartExtRequest.pageSize,t.tableId||t.dataFrom==="template"){C.value=!1;const n=JSON.parse(JSON.stringify(t));Qe(n).then(a=>{a.code&&a.code!==0?(C.value=!0,K.value=a.msg):(S.value=a==null?void 0:a.data,o.totalItems=a==null?void 0:a.totalItems,P.setViewDataDetails(t.id,a),w("onDrillFilters",a==null?void 0:a.drillFilters),M(a,i)),e==null||e()}).catch(()=>{e==null||e()})}else e==null||e()};let l=null,f;const ge=(t,e)=>{S.value=e,M(t,!1)},ve=t=>{var i,n;const e=rt(t.customAttr);if(e.tableCell.mergeCells===void 0&&(e.tableCell.mergeCells=!1),t.type==="table-pivot"){(n=(i=e.tableTotal)==null?void 0:i.row)!=null&&n.subTotalsDimensionsNew||(e.tableTotal.row.subTotalsDimensionsNew=!!e.tableTotal.row.subTotalsDimensionsNew);const{tableHeader:a}=e;a.tableHeaderColBgColor||(a.tableHeaderColBgColor=a.tableHeaderBgColor,a.tableHeaderColFontColor=a.tableHeaderFontColor,a.tableTitleColFontSize=a.tableTitleFontSize,a.tableHeaderColAlign=a.tableHeaderAlign,a.isColBolder=a.isBolder,a.isColItalic=a.isItalic,a.tableHeaderCornerBgColor=a.tableHeaderBgColor,a.tableHeaderCornerFontColor=a.tableHeaderFontColor,a.tableTitleCornerFontSize=a.tableTitleFontSize,a.tableHeaderCornerAlign=a.tableHeaderAlign,a.isCornerBolder=a.isBolder,a.isCornerItalic=a.isItalic)}},M=(t,e)=>{t&&(ve(t),f=He({...ut(t,ct(at)),data:S.value,fontFamily:m.fontFamily}),re(ot,f.customAttr,g.value,G.value),re(lt,f.customStyle,g.value,G.value),Se(f,e),le(()=>Z(e)))},Z=st(t=>{var i,n,a,u;(n=(i=l==null?void 0:l.facet)==null?void 0:i.timer)==null||n.stop(),(a=l==null?void 0:l.facet)==null||a.cancelScrollFrame(),l==null||l.destroy(),(u=l==null?void 0:l.getCanvasElement())==null||u.remove(),l=Ze.getChartView(f.render,f.type).drawChart({container:I,chart:Ye(f),chartObj:l,pageInfo:o.pageInfo,action:we,resizeAction:Ie,touchAction:Pe}),l==null||l.render(),P.setViewInstanceInfo(f.id,l),z()},500),Se=(t,e)=>{const i=t.customAttr;if(t.type!=="table-info"||i.basicStyle.tablePageMode!=="page"){o.showPage=!1;return}const n=o.pageInfo;o.pageStyle=i.basicStyle.tablePageStyle,o.pageStyle==="general"?o.currentPageSize===0?o.currentPageSize=n.pageSize:n.pageSize=o.currentPageSize:n.pageSize=i.basicStyle.tablePageSize??20,o.totalItems>o.pageInfo.pageSize||o.pageStyle==="general"?(n.total=o.totalItems,o.showPage=!0):o.showPage=!1,e&&(o.pageInfo.currentPage=1)},X=()=>{var t,e;(e=(t=l==null?void 0:l.facet)==null?void 0:t.timer)==null||e.stop()},be=()=>{z()};let D;const z=()=>{D&&clearTimeout(D),D=setTimeout(()=>{var i,n,a;const t=f==null?void 0:f.customAttr,e=f==null?void 0:f.senior;if(l&&((i=e==null?void 0:e.scrollCfg)!=null&&i.open)&&((n=S.value.tableRow)!=null&&n.length)&&(r.value.type==="table-normal"||r.value.type==="table-info"&&!o.showPage)){(a=l.facet.timer)==null||a.stop();let u=l.store.get("scrollY")||0;const p=document.getElementById(I).offsetHeight;if(!p)return;const c=t.tableCell.tableItemHeight,d=t.tableHeader.showTableHeader===!1?1:t.tableHeader.tableTitleHeight,s=l.theme.scrollBar.size,V=c*S.value.tableRow.length+d-p+s;if(V<s)return;u>=V-1&&(l.store.set("scrollY",0),l.render(),u=0);const Be=p-d-s+u,xe=(S.value.tableRow.length-Be/c)/e.scrollCfg.row*e.scrollCfg.interval;l.facet.scrollWithAnimation({offsetY:{value:V,animate:!1}},xe,z)}},1500)},he=b(()=>r.value.type!=="table-info"?!1:o.showPage),$=t=>{let e={goPage:t};E.value&&(e={...e,...E.value});const i={...r.value,chartExtRequest:e};_(i,null,!1)},ke=t=>{o.pageStyle==="general"&&(o.currentPageSize=t);let e={pageSize:t};E.value&&(e={...e,...E.value});const i={...r.value,chartExtRequest:e};_(i,null,!1)},ye=()=>{pe.value==="yes"&&H("pointClick")},Pe=t=>{h.value.length||t==null||t()},we=t=>{if(o.pointParam=t,o.curActionId=t.data.name,o.curTrackMenu=ee(o.curActionId),ye(),h.value.length<2)H(h.value[0]);else{const e={left:t.x-50,top:t.y+10};nt(m.element,e,m.scale,h.value.length),Y?(o.trackBarStyle.left=e.left+40+"px",o.trackBarStyle.top=e.top+70+"px"):(o.trackBarStyle.left=e.left+"px",o.trackBarStyle.top=e.top+"px"),Q.value.trackButtonClick()}};Xe();const H=t=>{var u,p;const e=o.pointParam;if(!((u=e==null?void 0:e.data)!=null&&u.dimensionList))return;const i={option:"linkage",name:o.pointParam.data.name,viewId:r.value.id,dimensionList:o.pointParam.data.dimensionList,quotaList:o.pointParam.data.quotaList};if(["table-info","table-normal"].includes(r.value.type)){i.quotaList=[];const c=[],d=[];r.value.xAxis.forEach(s=>{s.groupType==="d"?c.push(s.id):d.push(s.id)}),r.value.yAxis.forEach(s=>{s.groupType==="d"?c.push(s.id):d.push(s.id)}),c.includes(e.data.name)?i.dimensionList=i.dimensionList.filter(s=>s.id===e.data.name):d.includes(e.data.name)&&(i.dimensionList=i.dimensionList.filter(s=>c.includes(s.id))),r.value}const n={option:"jump",name:o.pointParam.data.name,viewId:r.value.id,dimensionList:o.pointParam.data.dimensionList,quotaList:o.pointParam.data.quotaList,sourceType:o.pointParam.data.sourceType},a={option:"pointClick",name:o.pointParam.data.name,viewId:r.value.id,dimensionList:o.pointParam.data.dimensionList,quotaList:o.pointParam.data.quotaList};switch(t){case"pointClick":w("onPointClick",a);break;case"linkageAndDrill":P.addViewTrackFilter(i),w("onChartClick",e);break;case"drill":w("onChartClick",e);break;case"linkage":P.addViewTrackFilter(i);break;case"jump":if(x.value&&!F.value)return;w("onJumpClick",n);break;case"enlarge":r.value.type==="table-info"&&((p=e.data.dimensionList)==null||p.forEach(c=>{c.id===o.curActionId&&(o.imgSrc=c.value,o.imgEnlarge=!0)}));break}},h=b(()=>["table-info","table-normal"].includes(r.value.type)&&o.curActionId?ee(o.curActionId):Ce.value),Ce=b(()=>{var n,a,u,p;let t=[];if(T.value==="viewDialog")return t;let e=0,i=0;return(a=(n=S.value)==null?void 0:n.fields)==null||a.forEach(c=>{const d=r.value.id+"#"+c.id;W.value[d]&&e++,U.value[d]&&i++}),i&&((u=r.value)!=null&&u.jumpActive)&&(!x.value||F.value)&&t.push("jump"),e&&((p=r.value)!=null&&p.linkageActive)&&t.push("linkage"),r.value.drillFields.length&&t.push("drill"),t.length===3&&m.element.actionSelection.linkageActive==="auto"?t=["jump","linkageAndDrill"]:t.length===2&&m.element.actionSelection.linkageActive==="auto"&&!t.includes("jump")&&(t=["linkageAndDrill"]),t}),ee=t=>{var p,c,d;let e=[];if(T.value==="viewDialog")return e;let i=0,n=0,a=0;const u=r.value.id+"#"+t;return W.value[u]&&i++,U.value[u]&&n++,n&&((p=r.value)!=null&&p.jumpActive)&&(!x.value||F.value)&&e.push("jump"),i&&((c=r.value)!=null&&c.linkageActive)&&e.push("linkage"),r.value.drillFields.length&&r.value.drillFields[fe.value].id===t&&a++,a&&e.push("drill"),e.length===3&&m.element.actionSelection.linkageActive==="auto"?e=["jump","linkageAndDrill"]:e.length===2&&m.element.actionSelection.linkageActive==="auto"&&!e.includes("jump")&&(e=["linkageAndDrill"]),r.value.type==="table-info"&&((d=r.value.xAxis)==null||d.forEach(s=>{s.id===t&&s.deType===7&&e.push("enlarge")})),e},Ie=t=>{var c,d;if(l!=null&&l.facet.timer&&(l==null||l.facet.timer.stop(),le(z)),T.value!=="canvas")return;const e=t.info.meta.field,{basicStyle:i}=r.value.customAttr,n=document.getElementById(I).offsetWidth,a=(c=i.tableFieldWidth)==null?void 0:c.find(s=>s.fieldId===e);let u;const p=parseFloat((t.info.resizedWidth/n*100).toFixed(2));if(a)a.width=p,u=[...i.tableFieldWidth];else{const s={fieldId:e,width:p};u=(d=i.tableFieldWidth)!=null&&d.length?[...i.tableFieldWidth,s]:[s]}de.emit("set-table-column-width",u)};ue({calcData:_,renderChart:M,renderChartFromDialog:ge,trackMenu:h});let L;const ze=(t,e)=>{L&&clearTimeout(L),L=setTimeout(()=>{var i,n;l!=null&&l.facet?((n=(i=l==null?void 0:l.facet)==null?void 0:i.timer)==null||n.stop(),l==null||l.changeSheetSize(t,e),l==null||l.render()):Z(!1),z()},500)},v=[0,0];let A;Ne(()=>{A=new ResizeObserver(([t]=[])=>{const[e]=t.borderBoxSize||[];v[0]||v[1]||(v[0]=e.inlineSize,v[1]=e.blockSize);const i=Math.abs(e.inlineSize-v[0]),n=Math.abs(e.blockSize-v[1]);i<se&&n<se||(v[0]=e.inlineSize,v[1]=e.blockSize,ze(e.inlineSize,Math.round(e.blockSize)))}),A.observe(document.getElementById(I))}),We(()=>{var t;try{(t=l==null?void 0:l.facet.timer)==null||t.stop(),l==null||l.destroy(),l=null,A==null||A.disconnect()}catch(e){console.warn(e)}});const Ae=b(()=>De()?{height:20*g.value+8+"px",width:100/g.value+"%!important",left:50*(1-1/g.value)+"%",transform:"scale("+g.value+") translateZ(0)"}:{zoom:g.value});b(()=>({height:20*g.value+8+"px"}));const Te=b(()=>{var t;return[{"--de-pager-color":(t=J.value.component.seniorStyleSetting)==null?void 0:t.pagerColor}]}),Ee=b(()=>{var t;return["#ffffff","#ffffffff","#a6a6a6ff"].includes((t=J.value.component.seniorStyleSetting)==null?void 0:t.pagerColor.toLowerCase())&&"table-page-info_dark"});return(t,e)=>{const i=Le,n=_e;return k(),te(Ue,null,[y("div",dt,[ae(et,{ref_key:"viewTrack",ref:Q,"track-menu":h.value,"font-family":N.fontFamily,class:"track-bar",style:q(o.trackBarStyle),onTrackClick:H,"is-data-v-mobile":R(Y),onMousemove:X},null,8,["track-menu","font-family","style","is-data-v-mobile"]),C.value?O("",!0):(k(),te("div",ft,[y("div",{id:I,style:{position:"relative",height:"100%"},onMousemove:X,onMouseleave:be},null,32)])),he.value&&!C.value?(k(),B(i,{key:1,style:q(Ae.value)},{default:oe(()=>[y("div",{class:Ge(["table-page-info",Ee.value]),style:q(Te.value),onKeydown:e[4]||(e[4]=ie(()=>{},["stop"])),onKeyup:e[5]||(e[5]=ie(()=>{},["stop"]))},[y("div",null,"共"+Ke(o.pageInfo.total)+"条",1),o.pageStyle!=="general"?(k(),B(R(ne),{key:0,class:"table-page-content",layout:"prev, pager, next","page-size":o.pageInfo.pageSize,"onUpdate:pageSize":e[0]||(e[0]=a=>o.pageInfo.pageSize=a),"current-page":o.pageInfo.currentPage,"onUpdate:currentPage":[e[1]||(e[1]=a=>o.pageInfo.currentPage=a),$],"pager-count":5,total:o.pageInfo.total},null,8,["page-size","current-page","total"])):(k(),B(R(ne),{key:1,class:"table-page-content",layout:"prev, pager, next, sizes, jumper","page-size":o.currentPageSize,"onUpdate:pageSize":[e[2]||(e[2]=a=>o.currentPageSize=a),ke],"current-page":o.pageInfo.currentPage,"onUpdate:currentPage":[e[3]||(e[3]=a=>o.pageInfo.currentPage=a),$],"pager-count":5,total:o.pageInfo.total},null,8,["page-size","current-page","total"]))],38)]),_:1},8,["style"])):O("",!0),C.value?(k(),B(tt,{key:2,"err-msg":K.value},null,8,["err-msg"])):O("",!0)]),ae(n,{modelValue:o.imgEnlarge,"onUpdate:modelValue":e[6]||(e[6]=a=>o.imgEnlarge=a),"append-to-body":"",class:"image-dialog"},{default:oe(()=>[y("div",mt,[y("img",{src:o.imgSrc,style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,gt)])]),_:1},8,["modelValue"])],64)}}});const ka=pt(vt,[["__scopeId","data-v-06951f05"]]);export{ka as default};

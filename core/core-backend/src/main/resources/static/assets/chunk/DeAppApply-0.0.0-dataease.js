import{a as Q}from"./index-0.0.0-dataease.js";import{o as X,P as ee,ay as x,y as C,G as I,D as ae,n as te,j as oe}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as re,a as se}from"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as le}from"./el-row-0.0.0-dataease.js";import{E as ie}from"./el-col-0.0.0-dataease.js";import{d as de,r as ne,ah as pe,t as me,G as ue,Z as ce,f,g as v,i as r,j as t,M as n,a5 as y,a6 as p,a0 as fe,k as o,ab as h,L as _e,a9 as ve,Y as ye}from"./vue-0.0.0-dataease.js";import{d as S}from"./dv-folder-0.0.0-dataease.js";import{d as he}from"./dv-link-target-0.0.0-dataease.js";import{E as ge}from"./el-drawer-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{a as g,E as be}from"./el-form-item-0.0.0-dataease.js";import"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import{E as A}from"./el-tree-select-0.0.0-dataease.js";import{e as we}from"./dataVisualization-0.0.0-dataease.js";import{g as Te}from"./dataset-0.0.0-dataease.js";import Ve from"./DatasetSelect-0.0.0-dataease.js";import{d as De}from"./dvMain-0.0.0-dataease.js";import{s as ke}from"./snapshot-0.0.0-dataease.js";import{i as N}from"./ModelUtil-0.0.0-dataease.js";import{_ as Fe}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./row-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./index-0.0.0-dataease13.js";import"./el-popover-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import"./el-aside-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import"./icon_dataset-0.0.0-dataease.js";import"./icon_done_outlined-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./treeSortUtils-0.0.0-dataease.js";import"./index-0.0.0-dataease14.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./index-0.0.0-dataease19.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./antv-0.0.0-dataease.js";import"./index-0.0.0-dataease20.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";const ze={class:"app-export"},Ee={class:"de-row-rules",style:{margin:"0 0 16px"}},xe={class:"custom-tree-node"},Ce=["title"],Ie={class:"custom-tree-node"},Se=["title"],Ae={class:"de-row-rules",style:{margin:"0 0 16px"}},Ne={class:"apply",style:{width:"100%"}},qe=de({__name:"DeAppApply",props:{componentData:{type:Object,required:!0},canvasViewInfo:{type:Object,required:!0},curCanvasType:{type:String,required:!0},themes:{type:String,default:"dark"}},emits:["closeDraw","saveAppCanvas"],setup(q,{expose:P,emit:U}){N();const{wsCache:M}=Q("localStorage"),{t:s}=X(),V=U,D=ne(null),j=De(),{dvInfo:u,appData:k}=pe(j),F=ke(),B=q,{componentData:Pe,canvasViewInfo:Ue,curCanvasType:_,themes:Me}=me(B),z=M.get("open-backend")==="1"?"_self":"_blank",E=ue(()=>_.value==="dashboard"?s("work_branch.dashboard"):s("work_branch.big_data_screen")),O=()=>{const i="#/data/datasource?opt=create";window.open(i,z)},e=ce({appApplyDrawer:!1,dvTree:[],dsTree:[],propsTree:{label:"name",children:"children",isLeaf:i=>{var a;return!((a=i.children)!=null&&a.length)}},appData:{datasourceInfo:[]},form:{pid:"",name:s("visualization.new"),datasetFolderPid:null,datasetFolderName:null},rule:{name:[{required:!0,min:2,max:25,message:s("datasource.input_limit_2_25",[2,25]),trigger:"blur"}],pid:[{required:!0,message:s("visualization.select_folder"),trigger:"blur"}],datasetFolderName:[{required:!0,min:2,max:25,message:s("datasource.input_limit_2_25",[2,25]),trigger:"blur"}],datasetFolderPid:[{required:!0,message:s("visualization.select_ds_group_folder"),trigger:"blur"}]}}),K=()=>{window.history.back()},L=()=>{const i={busiFlag:_.value,leaf:!1,weight:7};we(i).then(d=>{x(d,_.value);const c=d||[];b(c),e.dvTree=c||[],e.dvTree.length&&e.dvTree[0].name==="root"&&e.dvTree[0].id==="0"&&(e.dvTree[0].name=_.value==="dataV"?s("work_branch.big_data_screen"):s("work_branch.dashboard"))}),Te({leaf:!1,weight:7}).then(d=>{x(d,"dataset"),b(d),e.dsTree=d||[],e.dsTree.length&&e.dsTree[0].name==="root"&&e.dsTree[0].id==="0"&&(e.dsTree[0].name=s("visualization.dataset"))})},b=i=>{i.forEach(a=>{var d;a.value=a.id,(d=a.children)!=null&&d.length&&b(a.children)})},R=i=>{var a;e.appApplyDrawer=!0,e.form=i.base,e.appData.datasourceInfo=ee((a=k.value)==null?void 0:a.datasourceInfo),L()},W=i=>{e.form.pid=i.id},G=i=>{e.form.datasetFolderPid=i.id},Y=()=>{V("closeDraw"),F.recordSnapshotCache("renderChart"),e.appApplyDrawer=!1},Z=()=>{var a;let i=!0;if(e.appData.datasourceInfo.forEach(d=>{d.systemDatasourceId||(i=!1)}),!i){ae.error(s("visualization.app_no_datasource_tips"));return}(a=D.value)==null||a.validate(d=>{if(d)k.value.datasourceInfo=e.appData.datasourceInfo,u.value.pid=e.form.pid,u.value.name=e.form.name,u.value.datasetFolderPid=e.form.datasetFolderPid,u.value.datasetFolderName=e.form.datasetFolderName,u.value.dataState="ready",F.recordSnapshotCache("renderChart"),V("saveAppCanvas");else return!1})};return P({init:R,close:Y}),(i,a)=>{const d=te,c=oe,m=ie,w=le,$=re,H=se;return f(),v(t(ge),{title:t(s)("visualization.save_app"),modelValue:e.appApplyDrawer,"onUpdate:modelValue":a[8]||(a[8]=l=>e.appApplyDrawer=l),"custom-class":"de-app-drawer","show-close":!1,size:"500px",direction:"rtl","z-index":"1000"},{footer:r(()=>[n("div",Ne,[t(N)()||t(z)==="_self"?(f(),v(t(C),{key:0,onClick:K},{default:r(()=>[y(p(t(s)("visualization.back")),1)]),_:1})):fe("",!0),o(t(C),{type:"primary",onClick:Z},{default:r(()=>[y(p(t(s)("visualization.save")),1)]),_:1})])]),default:r(()=>[n("div",ze,[o(t(be),{ref_key:"appSaveForm",ref:D,model:e.form,rules:e.rule,class:"de-form-item app-form",size:"middle","label-width":"180px","label-position":"top"},{default:r(()=>[n("div",Ee,[n("span",null,p(t(s)("visualization.base_info")),1)]),o(t(g),{label:E.value+t(s)("visualization.name"),prop:"name"},{default:r(()=>[o(t(I),{modelValue:e.form.name,"onUpdate:modelValue":a[0]||(a[0]=l=>e.form.name=l),autocomplete:"off",placeholder:t(s)("visualization.input_tips")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(t(g),{label:E.value+t(s)("visualization.position"),prop:"pid"},{default:r(()=>[o(t(A),{style:{width:"100%"},onKeydown:a[1]||(a[1]=h(()=>{},["stop"])),onKeyup:a[2]||(a[2]=h(()=>{},["stop"])),modelValue:e.form.pid,"onUpdate:modelValue":a[3]||(a[3]=l=>e.form.pid=l),data:e.dvTree,props:e.propsTree,onNodeClick:W,"render-after-expand":!1,filterable:""},{default:r(({data:{name:l}})=>[n("span",xe,[o(c,null,{default:r(()=>[o(d,{name:"dv-folder"},{default:r(()=>[o(t(S),{class:"svg-icon"})]),_:1})]),_:1}),n("span",{title:l},p(l),9,Ce)])]),_:1},8,["modelValue","data","props"])]),_:1},8,["label"]),o(t(g),{label:t(s)("visualization.ds_group_name"),prop:"datasetFolderName"},{default:r(()=>[o(t(I),{modelValue:e.form.datasetFolderName,"onUpdate:modelValue":a[4]||(a[4]=l=>e.form.datasetFolderName=l),autocomplete:"off",placeholder:t(s)("visualization.input_tips")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(t(g),{label:t(s)("visualization.ds_group_position"),prop:"datasetFolderPid"},{default:r(()=>[o(t(A),{style:{width:"100%"},onKeydown:a[5]||(a[5]=h(()=>{},["stop"])),onKeyup:a[6]||(a[6]=h(()=>{},["stop"])),modelValue:e.form.datasetFolderPid,"onUpdate:modelValue":a[7]||(a[7]=l=>e.form.datasetFolderPid=l),data:e.dsTree,props:e.propsTree,onNodeClick:G,"filter-method":i.dsTreeFilterMethod,"render-after-expand":!1,filterable:""},{default:r(({data:{name:l}})=>[n("span",Ie,[o(c,null,{default:r(()=>[o(d,{name:"dv-folder"},{default:r(()=>[o(t(S),{class:"svg-icon"})]),_:1})]),_:1}),n("span",{title:l},p(l),9,Se)])]),_:1},8,["modelValue","data","props","filter-method"])]),_:1},8,["label"]),n("div",Ae,[n("span",null,p(t(s)("visualization.datasource_info")),1)]),o(w,{class:"datasource-link"},{default:r(()=>[o(w,{class:"head"},{default:r(()=>[o(m,{span:11},{default:r(()=>[y(p(t(s)("visualization.app_datasource")),1)]),_:1}),o(m,{span:2}),o(m,{span:11},{default:r(()=>[y(p(t(s)("visualization.sys_datasource")),1)]),_:1})]),_:1}),(f(!0),_e(ye,null,ve(e.appData.datasourceInfo,(l,J)=>(f(),v(w,{key:J,class:"content"},{default:r(()=>[o(m,{span:11},{default:r(()=>[o(H,{style:{width:"100%"},modelValue:l.name,"onUpdate:modelValue":T=>l.name=T,disabled:""},{default:r(()=>[(f(),v($,{key:l.name,label:l.name,value:l.name},null,8,["label","value"]))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(m,{span:2,class:"icon-center"},{default:r(()=>[o(d,{name:"dv-link-target"},{default:r(()=>[o(t(he),{class:"svg-icon",style:{width:"20px",height:"20px"}})]),_:1})]),_:1}),o(m,{span:11},{default:r(()=>[o(Ve,{ref_for:!0,ref:"datasetSelector",modelValue:l.systemDatasourceId,"onUpdate:modelValue":T=>l.systemDatasourceId=T,style:{flex:"1"},"state-obj":e,themes:"light","source-type":"datasource",onAddDsWindow:O,"view-id":"0"},null,8,["modelValue","onUpdate:modelValue","state-obj"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["title","modelValue"])}}});const Ya=Fe(qe,[["__scopeId","data-v-b76e8560"]]);export{Ya as default};

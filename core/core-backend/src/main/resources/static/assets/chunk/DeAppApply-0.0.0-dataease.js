import{h as A,w as v,r as C,s as I,v as J,X as Q,p as ee,d as te,B as oe,o as ae,x as re,y as ie}from"./element-plus-secondary-0.0.0-dataease.js";import{j as se,A as le,R as S,h as pe}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as de,r as me,t as ne,k as ue,l as ce,o as f,Z as h,_ as r,u as o,a as d,a4 as y,a2 as m,Y as fe,a0 as a,a1 as g,c as _e,ab as ve,M as he}from"./@vue-0.0.0-dataease.js";import{d as E}from"./dv-folder-0.0.0-dataease.js";import{d as ye}from"./dv-link-target-0.0.0-dataease.js";import{e as ge}from"./dataVisualization-0.0.0-dataease.js";import{g as be}from"./dataset-0.0.0-dataease.js";import we from"./DatasetSelect-0.0.0-dataease.js";import{d as Te}from"./dvMain-0.0.0-dataease.js";import{s as Ve}from"./pinia-0.0.0-dataease.js";import{s as ke}from"./snapshot-0.0.0-dataease.js";import{a as De}from"./index-0.0.0-dataease.js";import{i as N}from"./ModelUtil-0.0.0-dataease.js";import{_ as Fe}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./icon_dataset-0.0.0-dataease.js";import"./icon_done_outlined-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./treeSortUtils-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./@antv-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./@turf-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./element-resize-detector-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./mathjs-0.0.0-dataease.js";import"./decimal.js-0.0.0-dataease.js";import"./typed-function-0.0.0-dataease.js";import"./complex.js-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./exceljs-0.0.0-dataease.js";import"./file-saver-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";const xe={class:"app-export"},ze={class:"de-row-rules",style:{margin:"0 0 16px"}},Ae={class:"custom-tree-node"},Ce=["title"],Ie={class:"custom-tree-node"},Se=["title"],Ee={class:"de-row-rules",style:{margin:"0 0 16px"}},Ne={class:"apply",style:{width:"100%"}},qe=de({__name:"DeAppApply",props:{componentData:{type:Object,required:!0},canvasViewInfo:{type:Object,required:!0},curCanvasType:{type:String,required:!0},themes:{type:String,default:"dark"}},emits:["closeDraw","saveAppCanvas"],setup(q,{expose:P,emit:U}){N();const{wsCache:B}=De("localStorage"),{t:i}=se(),V=U,k=me(null),M=Te(),{dvInfo:u,appData:D}=Ve(M),F=ke(),j=q,{componentData:Pe,canvasViewInfo:Ue,curCanvasType:_,themes:Be}=ne(j),x=B.get("open-backend")==="1"?"_self":"_blank",z=ue(()=>_.value==="dashboard"?i("work_branch.dashboard"):i("work_branch.big_data_screen")),O=()=>{const l="#/data/datasource?opt=create";window.open(l,x)},e=ce({appApplyDrawer:!1,dvTree:[],dsTree:[],propsTree:{label:"name",children:"children",isLeaf:l=>{var t;return!((t=l.children)!=null&&t.length)}},appData:{datasourceInfo:[]},form:{pid:"",name:i("visualization.new"),datasetFolderPid:null,datasetFolderName:null},rule:{name:[{required:!0,min:2,max:25,message:i("datasource.input_limit_2_25",[2,25]),trigger:"blur"}],pid:[{required:!0,message:i("visualization.select_folder"),trigger:"blur"}],datasetFolderName:[{required:!0,min:2,max:25,message:i("datasource.input_limit_2_25",[2,25]),trigger:"blur"}],datasetFolderPid:[{required:!0,message:i("visualization.select_ds_group_folder"),trigger:"blur"}]}}),R=()=>{window.history.back()},K=()=>{const l={busiFlag:_.value,leaf:!1,weight:7};ge(l).then(p=>{S(p,_.value);const c=p||[];b(c),e.dvTree=c||[],e.dvTree.length&&e.dvTree[0].name==="root"&&e.dvTree[0].id==="0"&&(e.dvTree[0].name=_.value==="dataV"?i("work_branch.big_data_screen"):i("work_branch.dashboard"))}),be({leaf:!1,weight:7}).then(p=>{S(p,"dataset"),b(p),e.dsTree=p||[],e.dsTree.length&&e.dsTree[0].name==="root"&&e.dsTree[0].id==="0"&&(e.dsTree[0].name=i("visualization.dataset"))})},b=l=>{l.forEach(t=>{var p;t.value=t.id,(p=t.children)!=null&&p.length&&b(t.children)})},W=l=>{var t;e.appApplyDrawer=!0,e.form=l.base,e.appData.datasourceInfo=le((t=D.value)==null?void 0:t.datasourceInfo),K()},L=l=>{e.form.pid=l.id},X=l=>{e.form.datasetFolderPid=l.id},Y=()=>{V("closeDraw"),F.recordSnapshotCache("renderChart"),e.appApplyDrawer=!1},Z=()=>{var t;let l=!0;if(e.appData.datasourceInfo.forEach(p=>{p.systemDatasourceId||(l=!1)}),!l){ee.error(i("visualization.app_no_datasource_tips"));return}(t=k.value)==null||t.validate(p=>{if(p)D.value.datasourceInfo=e.appData.datasourceInfo,u.value.pid=e.form.pid,u.value.name=e.form.name,u.value.datasetFolderPid=e.form.datasetFolderPid,u.value.datasetFolderName=e.form.datasetFolderName,u.value.dataState="ready",F.recordSnapshotCache("renderChart"),V("saveAppCanvas");else return!1})};return P({init:W,close:Y}),(l,t)=>{const p=pe,c=te,n=oe,w=ae,$=re,G=ie;return f(),h(o(Q),{title:o(i)("visualization.save_app"),modelValue:e.appApplyDrawer,"onUpdate:modelValue":t[8]||(t[8]=s=>e.appApplyDrawer=s),"custom-class":"de-app-drawer","show-close":!1,size:"500px",direction:"rtl","z-index":"1000"},{footer:r(()=>[d("div",Ne,[o(N)()||o(x)==="_self"?(f(),h(o(A),{key:0,onClick:R},{default:r(()=>[y(m(o(i)("visualization.back")),1)]),_:1})):fe("",!0),a(o(A),{type:"primary",onClick:Z},{default:r(()=>[y(m(o(i)("visualization.save")),1)]),_:1})])]),default:r(()=>[d("div",xe,[a(o(J),{ref_key:"appSaveForm",ref:k,model:e.form,rules:e.rule,class:"de-form-item app-form",size:"middle","label-width":"180px","label-position":"top"},{default:r(()=>[d("div",ze,[d("span",null,m(o(i)("visualization.base_info")),1)]),a(o(v),{label:z.value+o(i)("visualization.name"),prop:"name"},{default:r(()=>[a(o(C),{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=s=>e.form.name=s),autocomplete:"off",placeholder:o(i)("visualization.input_tips")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(o(v),{label:z.value+o(i)("visualization.position"),prop:"pid"},{default:r(()=>[a(o(I),{style:{width:"100%"},onKeydown:t[1]||(t[1]=g(()=>{},["stop"])),onKeyup:t[2]||(t[2]=g(()=>{},["stop"])),modelValue:e.form.pid,"onUpdate:modelValue":t[3]||(t[3]=s=>e.form.pid=s),data:e.dvTree,props:e.propsTree,onNodeClick:L,"render-after-expand":!1,filterable:""},{default:r(({data:{name:s}})=>[d("span",Ae,[a(c,null,{default:r(()=>[a(p,{name:"dv-folder"},{default:r(()=>[a(o(E),{class:"svg-icon"})]),_:1})]),_:1}),d("span",{title:s},m(s),9,Ce)])]),_:1},8,["modelValue","data","props"])]),_:1},8,["label"]),a(o(v),{label:o(i)("visualization.ds_group_name"),prop:"datasetFolderName"},{default:r(()=>[a(o(C),{modelValue:e.form.datasetFolderName,"onUpdate:modelValue":t[4]||(t[4]=s=>e.form.datasetFolderName=s),autocomplete:"off",placeholder:o(i)("visualization.input_tips")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(o(v),{label:o(i)("visualization.ds_group_position"),prop:"datasetFolderPid"},{default:r(()=>[a(o(I),{style:{width:"100%"},onKeydown:t[5]||(t[5]=g(()=>{},["stop"])),onKeyup:t[6]||(t[6]=g(()=>{},["stop"])),modelValue:e.form.datasetFolderPid,"onUpdate:modelValue":t[7]||(t[7]=s=>e.form.datasetFolderPid=s),data:e.dsTree,props:e.propsTree,onNodeClick:X,"filter-method":l.dsTreeFilterMethod,"render-after-expand":!1,filterable:""},{default:r(({data:{name:s}})=>[d("span",Ie,[a(c,null,{default:r(()=>[a(p,{name:"dv-folder"},{default:r(()=>[a(o(E),{class:"svg-icon"})]),_:1})]),_:1}),d("span",{title:s},m(s),9,Se)])]),_:1},8,["modelValue","data","props","filter-method"])]),_:1},8,["label"]),d("div",Ee,[d("span",null,m(o(i)("visualization.datasource_info")),1)]),a(w,{class:"datasource-link"},{default:r(()=>[a(w,{class:"head"},{default:r(()=>[a(n,{span:11},{default:r(()=>[y(m(o(i)("visualization.app_datasource")),1)]),_:1}),a(n,{span:2}),a(n,{span:11},{default:r(()=>[y(m(o(i)("visualization.sys_datasource")),1)]),_:1})]),_:1}),(f(!0),_e(he,null,ve(e.appData.datasourceInfo,(s,H)=>(f(),h(w,{key:H,class:"content"},{default:r(()=>[a(n,{span:11},{default:r(()=>[a(G,{style:{width:"100%"},modelValue:s.name,"onUpdate:modelValue":T=>s.name=T,disabled:""},{default:r(()=>[(f(),h($,{key:s.name,label:s.name,value:s.name},null,8,["label","value"]))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(n,{span:2,class:"icon-center"},{default:r(()=>[a(p,{name:"dv-link-target"},{default:r(()=>[a(o(ye),{class:"svg-icon",style:{width:"20px",height:"20px"}})]),_:1})]),_:1}),a(n,{span:11},{default:r(()=>[a(we,{ref_for:!0,ref:"datasetSelector",modelValue:s.systemDatasourceId,"onUpdate:modelValue":T=>s.systemDatasourceId=T,style:{flex:"1"},"state-obj":e,themes:"light","source-type":"datasource",onAddDsWindow:O,"view-id":"0"},null,8,["modelValue","onUpdate:modelValue","state-obj"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["title","modelValue"])}}});const sa=Fe(qe,[["__scopeId","data-v-b76e8560"]]);export{sa as default};

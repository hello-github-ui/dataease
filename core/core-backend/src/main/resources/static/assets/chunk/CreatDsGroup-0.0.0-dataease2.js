import{a as ge}from"./index-0.0.0-dataease.js";import{E as ye}from"./el-dialog-0.0.0-dataease.js";import{o as be,ay as we,F as ke,D as q,G as De,n as xe,j as Ee,y as Ve}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as Ce}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Te}from"./el-tree-select-0.0.0-dataease.js";import{a as Fe,E as Ne}from"./el-form-item-0.0.0-dataease.js";import{d as Se,Z as H,r as n,w as Ie,n as O,G as F,s as qe,aa as Be,T as Re,f as D,g as B,i as o,k as l,a5 as W,a6 as x,j as f,ac as Ge,ab as Me,a0 as N,M as y,L as Z}from"./vue-0.0.0-dataease.js";import{d as J}from"./dv-folder-0.0.0-dataease.js";import{i as Pe}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{l as Ae,a as Le,b as Ue,u as je}from"./datasource-0.0.0-dataease.js";import{t as Ke}from"./treeSortUtils-0.0.0-dataease.js";import{n as $e}from"./nothing-tree-0.0.0-dataease.js";import{d as ze}from"./lodash-0.0.0-dataease.js";import{_ as He}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./index-0.0.0-dataease13.js";import"./index-0.0.0-dataease3.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";const Oe=["title"],We={key:2},Ze={class:"tree-content"},Je={class:"custom-tree-node"},Qe=["title"],Xe={key:0,class:"empty-search"},Ye=["src"],et=Se({__name:"CreatDsGroup",emits:["finish","handleShowFinishPage"],setup(tt,{expose:Q,emit:X}){const{t:s}=be(),{wsCache:b}=ge(),p=H({tData:[]}),w=n(),_=n(),k=n(),R=n(),d=n(""),S=n(),E=n(""),a=H({pid:"",name:""}),G=n(!1),Y=(t,e)=>(O(()=>{G.value=S.value.isEmpty}),t?e.name.includes(t):!0);Ie(E,t=>{oe.value=!t,S.value.filter(t),O(()=>{document.querySelectorAll(".node-text").forEach(e=>{const i=e.getAttribute("title");e.innerHTML=i.replace(t,`<span class="highLight">${t}</span>`)})})});const ee=F(()=>w.value==="folder"&&_.value?!1:!["rename","move"].includes(d.value)&&!!_.value),te=F(()=>w.value==="folder"?s("deDataset.folder_name"):s("data_source.data_source_name")),ae=F(()=>{let t="";switch(w.value){case"folder":t=s("deDataset.new_folder");break;case"datasource":t=s("deDataset.create")+s("auth.datasource");break}switch(d.value){case"move":t=s("chart.move_to");break;case"rename":t=s("chart.rename");break}return t}),se=F(()=>d.value!=="move"),V=n(""),M=n(),P=n(!1),oe=n(!0),C=n(),v=n(!1),g=n(!1),le=(t,e)=>{if(!e)return!1;e.name.includes(t)},A=()=>{g.value=!1},L=qe([]),re=t=>{p.tData=Ke(L.value,t)},U=t=>{t.forEach(e=>{var i;e.value=e.id,(i=e.children)!=null&&i.length&&U(e.children)})};let c=null,j="";const ne=["time_asc","time_desc","name_asc","name_desc"],ie=(t,e,i,h)=>{_.value="",k.value="",d.value="",a.pid="",a.name="",w.value=t,E.value="",V.value=s(t==="folder"?"data_source.a_folder_name":"data_source.data_source_name_de"),j=e.type,t==="datasource"&&(c=e.request),e.id&&(i!=="rename"&&Ae({leaf:!1,id:e.id,weight:7}).then(m=>{we(m,"datasource"),U(m),p.tData=m||[],p.tData.length&&p.tData[0].name==="root"&&p.tData[0].id==="0"&&(p.tData[0].name=s("data_source.data_source")),L.value=ze(f(p.tData));let u=ne[Number(b.get("TreeSort-backend"))??1];u=b.get("TreeSort-datasource")??u,re(u)}),i?(_.value=e.pid,k.value=e.id,a.pid=e.pid,a.name=e.name,R.value=e.name):(a.pid=e.id,_.value=e.id)),d.value=e.id?i:"",h&&(a.name=h),g.value=!0,M.value={name:[{required:!0,message:V.value,trigger:"change"},{required:!0,message:V.value,trigger:"blur"},{min:1,max:64,message:s("datasource.input_limit_1_64",[1,64]),trigger:"blur"}],pid:[{required:!0,message:s("common.please_select"),trigger:"blur"}]},setTimeout(()=>{C.value.clearValidate()},50)},ue=t=>{_.value=t.pid,k.value=t.id},K={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},$=t=>{P.value=!1,a.pid=t.id},T=()=>{b.set("ds-new-success",!0),C.value.resetFields(),c=null,a.pid="",a.name="",g.value=!1},de=()=>{v.value=!1},ce=t=>t!==0&&!t?(q.error(s("data_source.the_destination_folder")),!1):!0,me=()=>{C.value.validate(t=>{if(t){const e={nodeType:w.value,name:a.name.trim()};switch(d.value){case"move":e.pid=P.value?"0":a.pid,e.id=k.value,e.action="move";break;case"rename":e.pid=_.value,e.id=k.value,e.action="rename";break;default:e.pid=a.pid||_.value||"0",e.action="create";break}if(d.value==="rename"&&R.value===e.name){T();return}if(d.value==="move"&&!ce(e.pid)||v.value)return;if(v.value=!0,c){let i={confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,tip:""};c.apiConfiguration="",Le(c).then(h=>{let m=c.id===""?Ue:je;!c.type.startsWith("API")&&c.type!=="ExcelRemote"&&(c.syncSetting=null),h?ke.confirm(s("datasource.has_same_ds"),i).then(()=>{m({...c,name:a.name,pid:e.pid}).then(u=>{u!==void 0&&(b.set("ds-new-success",!0),I("handleShowFinishPage",{...u,pid:e.pid}),q.success(s("data_source.source_saved_successfully")),T())}).finally(()=>{v.value=!1})}).catch(()=>{v.value=!1,g.value=!1}):m({...c,name:a.name,pid:e.pid}).then(u=>{u!==void 0&&(b.set("ds-new-success",!0),I("handleShowFinishPage",{...u,pid:e.pid}),q.success(s("data_source.source_saved_successfully")),T())}).finally(()=>{v.value=!1})});return}I("finish",e,T,de,d.value,j)}})};Q({createInit:ie,editeInit:ue});const I=X;return(t,e)=>{const i=De,h=Fe,m=xe,u=Ee,pe=Te,fe=Ce,_e=Ne,z=Ve,ve=ye,he=Be("loading");return Re((D(),B(ve,{title:ae.value,modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=r=>g.value=r),width:d.value==="move"?"600px":"420px",class:"create-dialog","before-close":A},{footer:o(()=>[l(z,{secondary:"",onClick:A},{default:o(()=>[W(x(f(s)("dataset.cancel")),1)]),_:1}),l(z,{type:"primary",onClick:me},{default:o(()=>[W(x(f(s)("dataset.confirm")),1)]),_:1})]),default:o(()=>[l(_e,{"label-position":"top","require-asterisk-position":"right",ref_key:"datasource",ref:C,onKeydown:e[4]||(e[4]=Ge(Me(()=>{},["stop","prevent"]),["enter"])),model:a,rules:M.value},{default:o(()=>[se.value?(D(),B(h,{key:0,label:te.value,prop:"name"},{default:o(()=>[l(i,{placeholder:V.value,modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=r=>a.name=r)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):N("",!0),ee.value?(D(),B(h,{key:1,label:f(s)("deDataset.folder"),prop:"pid"},{default:o(()=>[l(pe,{modelValue:a.pid,"onUpdate:modelValue":e[1]||(e[1]=r=>a.pid=r),data:p.tData,"popper-class":"dataset-tree-select",style:{width:"100%"},"render-after-expand":!1,props:K,onNodeClick:$,"filter-method":le,filterable:""},{default:o(({data:{name:r}})=>[l(u,null,{default:o(()=>[l(m,{name:"dv-folder"},{default:o(()=>[l(f(J),{class:"svg-icon"})]),_:1})]),_:1}),y("span",{title:r},x(r),9,Oe)]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):N("",!0),d.value==="move"?(D(),Z("div",We,[l(i,{style:{"margin-bottom":"12px"},modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=r=>E.value=r),clearable:""},{prefix:o(()=>[l(u,null,{default:o(()=>[l(m,{name:"icon_search-outline_outlined"},{default:o(()=>[l(f(Pe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),y("div",Ze,[l(fe,{ref_key:"treeRef",ref:S,"filter-node-method":Y,filterable:"",modelValue:a.pid,"onUpdate:modelValue":e[3]||(e[3]=r=>a.pid=r),menu:"","empty-text":"",data:p.tData,props:K,onNodeClick:$},{default:o(({data:r})=>[y("span",Je,[l(u,{style:{"font-size":"18px"}},{default:o(()=>[l(m,{name:"dv-folder"},{default:o(()=>[l(f(J),{class:"svg-icon"})]),_:1})]),_:1}),y("span",{class:"node-text",title:r.name},x(r.name),9,Qe)])]),_:1},8,["modelValue","data"]),G.value?(D(),Z("div",Xe,[y("img",{src:f($e)},null,8,Ye),y("span",null,x(f(s)("data_source.relevant_content_found")),1)])):N("",!0)])])):N("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","width"])),[[he,v.value]])}}});const It=He(et,[["__scopeId","data-v-4af10152"]]);export{It as default};

import{q as ge,p as q,r as ye,w as be,d as we,s as ke,t as De,v as xe,h as Ve,L as Ce}from"./element-plus-secondary-0.0.0-dataease.js";import{j as Te,R as Ee,h as Fe}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as Ne,l as z,r as i,w as Se,n as H,k as F,x as Ie,ak as qe,W as Re,o as D,Z as R,_ as s,a0 as l,a4 as O,a2 as x,u as f,ac as Be,a1 as Pe,Y as N,a as y,c as Y}from"./@vue-0.0.0-dataease.js";import{d as Z}from"./dv-folder-0.0.0-dataease.js";import{i as Ae}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{l as Le,a as Me,b as Ue,u as Ge}from"./datasource-0.0.0-dataease.js";import{t as Ke}from"./treeSortUtils-0.0.0-dataease.js";import{n as We}from"./nothing-tree-0.0.0-dataease.js";import{a as $e}from"./index-0.0.0-dataease.js";import{e as je}from"./lodash-es-0.0.0-dataease.js";import{_ as ze}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";const He=["title"],Oe={key:2},Ye={class:"tree-content"},Ze={class:"custom-tree-node"},Je=["title"],Qe={key:0,class:"empty-search"},Xe=["src"],et=Ne({__name:"CreatDsGroup",emits:["finish","handleShowFinishPage"],setup(tt,{expose:J,emit:Q}){const{t:o}=Te(),{wsCache:b}=$e(),p=z({tData:[]}),w=i(),_=i(),k=i(),B=i(),d=i(""),S=i(),V=i(""),a=z({pid:"",name:""}),P=i(!1),X=(t,e)=>(H(()=>{P.value=S.value.isEmpty}),t?e.name.includes(t):!0);Se(V,t=>{se.value=!t,S.value.filter(t),H(()=>{document.querySelectorAll(".node-text").forEach(e=>{const n=e.getAttribute("title");e.innerHTML=n.replace(t,`<span class="highLight">${t}</span>`)})})});const ee=F(()=>w.value==="folder"&&_.value?!1:!["rename","move"].includes(d.value)&&!!_.value),te=F(()=>w.value==="folder"?o("deDataset.folder_name"):o("data_source.data_source_name")),ae=F(()=>{let t="";switch(w.value){case"folder":t=o("deDataset.new_folder");break;case"datasource":t=o("deDataset.create")+o("auth.datasource");break}switch(d.value){case"move":t=o("chart.move_to");break;case"rename":t=o("chart.rename");break}return t}),oe=F(()=>d.value!=="move"),C=i(""),A=i(),L=i(!1),se=i(!0),T=i(),v=i(!1),g=i(!1),le=(t,e)=>{if(!e)return!1;e.name.includes(t)},M=()=>{g.value=!1},U=Ie([]),re=t=>{p.tData=Ke(U.value,t)},G=t=>{t.forEach(e=>{var n;e.value=e.id,(n=e.children)!=null&&n.length&&G(e.children)})};let c=null,K="";const ie=["time_asc","time_desc","name_asc","name_desc"],ne=(t,e,n,h)=>{_.value="",k.value="",d.value="",a.pid="",a.name="",w.value=t,V.value="",C.value=o(t==="folder"?"data_source.a_folder_name":"data_source.data_source_name_de"),K=e.type,t==="datasource"&&(c=e.request),e.id&&(n!=="rename"&&Le({leaf:!1,id:e.id,weight:7}).then(m=>{Ee(m,"datasource"),G(m),p.tData=m||[],p.tData.length&&p.tData[0].name==="root"&&p.tData[0].id==="0"&&(p.tData[0].name=o("data_source.data_source")),U.value=je(f(p.tData));let u=ie[Number(b.get("TreeSort-backend"))??1];u=b.get("TreeSort-datasource")??u,re(u)}),n?(_.value=e.pid,k.value=e.id,a.pid=e.pid,a.name=e.name,B.value=e.name):(a.pid=e.id,_.value=e.id)),d.value=e.id?n:"",h&&(a.name=h),g.value=!0,A.value={name:[{required:!0,message:C.value,trigger:"change"},{required:!0,message:C.value,trigger:"blur"},{min:1,max:64,message:o("datasource.input_limit_1_64",[1,64]),trigger:"blur"}],pid:[{required:!0,message:o("common.please_select"),trigger:"blur"}]},setTimeout(()=>{T.value.clearValidate()},50)},ue=t=>{_.value=t.pid,k.value=t.id},W={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},$=t=>{L.value=!1,a.pid=t.id},E=()=>{b.set("ds-new-success",!0),T.value.resetFields(),c=null,a.pid="",a.name="",g.value=!1},de=()=>{v.value=!1},ce=t=>t!==0&&!t?(q.error(o("data_source.the_destination_folder")),!1):!0,me=()=>{T.value.validate(t=>{if(t){const e={nodeType:w.value,name:a.name.trim()};switch(d.value){case"move":e.pid=L.value?"0":a.pid,e.id=k.value,e.action="move";break;case"rename":e.pid=_.value,e.id=k.value,e.action="rename";break;default:e.pid=a.pid||_.value||"0",e.action="create";break}if(d.value==="rename"&&B.value===e.name){E();return}if(d.value==="move"&&!ce(e.pid)||v.value)return;if(v.value=!0,c){let n={confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,tip:""};c.apiConfiguration="",Me(c).then(h=>{let m=c.id===""?Ue:Ge;!c.type.startsWith("API")&&c.type!=="ExcelRemote"&&(c.syncSetting=null),h?ge.confirm(o("datasource.has_same_ds"),n).then(()=>{m({...c,name:a.name,pid:e.pid}).then(u=>{u!==void 0&&(b.set("ds-new-success",!0),I("handleShowFinishPage",{...u,pid:e.pid}),q.success(o("data_source.source_saved_successfully")),E())}).finally(()=>{v.value=!1})}).catch(()=>{v.value=!1,g.value=!1}):m({...c,name:a.name,pid:e.pid}).then(u=>{u!==void 0&&(b.set("ds-new-success",!0),I("handleShowFinishPage",{...u,pid:e.pid}),q.success(o("data_source.source_saved_successfully")),E())}).finally(()=>{v.value=!1})});return}I("finish",e,E,de,d.value,K)}})};J({createInit:ne,editeInit:ue});const I=Q;return(t,e)=>{const n=ye,h=be,m=Fe,u=we,pe=ke,fe=De,_e=xe,j=Ve,ve=Ce,he=qe("loading");return Re((D(),R(ve,{title:ae.value,modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=r=>g.value=r),width:d.value==="move"?"600px":"420px",class:"create-dialog","before-close":M},{footer:s(()=>[l(j,{secondary:"",onClick:M},{default:s(()=>[O(x(f(o)("dataset.cancel")),1)]),_:1}),l(j,{type:"primary",onClick:me},{default:s(()=>[O(x(f(o)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(_e,{"label-position":"top","require-asterisk-position":"right",ref_key:"datasource",ref:T,onKeydown:e[4]||(e[4]=Be(Pe(()=>{},["stop","prevent"]),["enter"])),model:a,rules:A.value},{default:s(()=>[oe.value?(D(),R(h,{key:0,label:te.value,prop:"name"},{default:s(()=>[l(n,{placeholder:C.value,modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=r=>a.name=r)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):N("",!0),ee.value?(D(),R(h,{key:1,label:f(o)("deDataset.folder"),prop:"pid"},{default:s(()=>[l(pe,{modelValue:a.pid,"onUpdate:modelValue":e[1]||(e[1]=r=>a.pid=r),data:p.tData,"popper-class":"dataset-tree-select",style:{width:"100%"},"render-after-expand":!1,props:W,onNodeClick:$,"filter-method":le,filterable:""},{default:s(({data:{name:r}})=>[l(u,null,{default:s(()=>[l(m,{name:"dv-folder"},{default:s(()=>[l(f(Z),{class:"svg-icon"})]),_:1})]),_:1}),y("span",{title:r},x(r),9,He)]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):N("",!0),d.value==="move"?(D(),Y("div",Oe,[l(n,{style:{"margin-bottom":"12px"},modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=r=>V.value=r),clearable:""},{prefix:s(()=>[l(u,null,{default:s(()=>[l(m,{name:"icon_search-outline_outlined"},{default:s(()=>[l(f(Ae),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),y("div",Ye,[l(fe,{ref_key:"treeRef",ref:S,"filter-node-method":X,filterable:"",modelValue:a.pid,"onUpdate:modelValue":e[3]||(e[3]=r=>a.pid=r),menu:"","empty-text":"",data:p.tData,props:W,onNodeClick:$},{default:s(({data:r})=>[y("span",Ze,[l(u,{style:{"font-size":"18px"}},{default:s(()=>[l(m,{name:"dv-folder"},{default:s(()=>[l(f(Z),{class:"svg-icon"})]),_:1})]),_:1}),y("span",{class:"node-text",title:r.name},x(r.name),9,Je)])]),_:1},8,["modelValue","data"]),P.value?(D(),Y("div",Qe,[y("img",{src:f(We)},null,8,Xe),y("span",null,x(f(o)("data_source.relevant_content_found")),1)])):N("",!0)])])):N("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","width"])),[[he,v.value]])}}});const ia=ze(et,[["__scopeId","data-v-4af10152"]]);export{ia as default};

import{L as we,p as F,r as ye,w as be,d as ke,s as Ve,t as ze,v as Te,h as De}from"./element-plus-secondary-0.0.0-dataease.js";import{j as Le,R as Ce,S as Fe,J as Ee,h as Ie}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as Ne,t as Re,l as Q,r as i,k as U,w as xe,ak as Se,o as h,Z as E,_ as n,a1 as V,a0 as s,a4 as X,a2 as z,u as p,W as qe,Y as I,a as v,c as ee,n as Be}from"./@vue-0.0.0-dataease.js";import{d as te}from"./dv-folder-0.0.0-dataease.js";import{i as Ue}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{a as Ae}from"./index-0.0.0-dataease.js";import{n as Ke}from"./nothing-tree-0.0.0-dataease.js";import{e as Me,l as Oe,n as Ge,o as Pe,p as $e,k as je}from"./dataVisualization-0.0.0-dataease.js";import{_ as Je}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";const We={class:"custom-tree-node"},Ye=["title"],Ze={key:2},He={class:"tree-content"},Qe={class:"custom-tree-node"},Xe=["title"],et={key:0,class:"empty-search"},tt=["src"],at=Ne({__name:"DeResourceGroupOpt",props:{curCanvasType:{type:String,required:!0}},emits:["finish"],setup(ae,{expose:oe,emit:le}){const N=ae,{curCanvasType:f}=Re(N),{wsCache:re}=Ae("localStorage"),{t:a}=Le(),d=Q({tData:[],nameList:[],targetInfo:null}),A=i(!1),T=i(!1),K=i(),w=i(),y=i(),u=i(""),R=i(),_=i(""),x=i(""),l=Q({pid:"",pName:null,name:"新建"}),M=U(()=>f.value==="dataV"?a("work_branch.big_data_screen"):a("work_branch.dashboard")),O={move:Pe,copy:$e,newFolder:je},G=i(!1),ne=(t,e)=>(Be(()=>{G.value=R.value.isEmpty}),t?e.name.includes(t):!0);xe(_,t=>{R.value.filter(t)});const ie=t=>!S||S.length===0?!1:S.some(e=>e===t),se=(t,e,o)=>{ie(e)?o(new Error(a("visualization.name_repeat"))):o()},ue=U(()=>["newLeaf","copy","newLeafAfter"].includes(u.value)&&A.value),de=U(()=>!["newLeafAfter","move"].includes(u.value));let S=[];const P=i(),q=i(),g=i(!1),B=i("");let $=[];const me=t=>{d.tData=[...$].filter(e=>e.name.includes(t))},j=()=>{B.value=null,x.value="",l.name=a("visualization.new"),l.pid="",g.value=!1},J=t=>{t.forEach(e=>{var o;e.value=e.id,(o=e.children)!=null&&o.length&&J(e.children)})},pe=t=>({newFolder:a("visualization.new_folder"),newLeaf:N.curCanvasType==="dataV"?a("visualization.new_screen"):a("visualization.new_dashboard"),move:a("visualization.move_to"),copy:a("visualization.copy")+M.value,rename:a("visualization.rename"),newLeafAfter:a("visualization.belong_folder")})[t],D=i(""),ce=(t,e,o,b=!1)=>{A.value=b,d.targetInfo=e,K.value=t;const m=e.leaf||t==="leaf"?M.value:a("visualization.folder"),c=e.leaf||t==="leaf"?N.curCanvasType==="dataV"?a("work_branch.big_data_screen"):a("work_branch.dashboard"):a("visualization.folder");D.value=a("visualization.input_name_tips",[c]),_.value="",B.value=pe(o)+(o==="rename"?m:""),x.value=(o==="move"?"":m)+a("visualization.name");const k={busiFlag:f.value,leaf:!1,weight:7};["newFolder"].includes(o)?l.name="":o==="copy"?l.name=e.name+"_copy":l.name=e.name,Me(k).then(L=>{Ce(L,f.value);const C=L||[];J(C),d.tData=C||[],d.tData.length&&d.tData[0].name==="root"&&d.tData[0].id==="0"&&(d.tData[0].name=f.value==="dataV"?a("work_branch.big_data_screen"):a("work_branch.dashboard")),$=[...d.tData],o==="move"&&Fe(d.tData,e.id),["newLeaf","newFolder"].includes(o)?(l.pid=e.id,w.value=e.id):y.value=e.id}),u.value=o,g.value=!0,P.value={name:[{required:!0,message:D.value,trigger:"change"},{required:!0,message:D.value,trigger:"blur"},{min:1,max:64,message:a("commons.char_1_64"),trigger:"change"},{required:!0,trigger:"blur",validator:se}],pid:[{required:!0,message:a("common.please_select"),trigger:"blur"}]},setTimeout(()=>{q.value.clearValidate()},50)},ve=t=>{w.value=t.pid,y.value=t.id},W={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},Y=t=>{l.pid=t.id,l.pName=t.name},fe=t=>{if(t.pid!==0&&!t.pid)return F.error(a("visualization.select_target_folder")),!1;if(_.value&&!l.pName.includes(_.value))return F.error(a("visualization.select_target_folder")),!1;if(t.pid===t.id){F.warning(a("visualization.select_target_tips"));return}return!0},_e=()=>{q.value.validate(async t=>{var e;if(t){const o={nodeType:K.value,name:l.name,type:f.value,mobileLayout:(e=d.targetInfo)==null?void 0:e.extraFlag};switch(u.value){case"move":o.pid=l.pid,o.id=y.value;break;case"copy":o.id=y.value,o.pid=l.pid||w.value||"0";break;case"rename":o.pid=w.value,o.id=y.value;break;default:o.pid=l.pid||w.value||"0";break}if(Ee(o,a("components.length_1_64_characters")),u.value==="move"&&!fe(o))return;["newLeaf","newLeafAfter","newFolder","rename","move","copy"].includes(u.value)&&await Oe({opt:u.value,...o}),u.value==="newLeaf"?(g.value=!1,Z("finish",{opt:"newLeaf",...o})):(T.value=!0,(O[u.value]?O[u.value]:Ge)(o).then(m=>{if(T.value=!1,g.value=!1,Z("finish"),F.success(a("visualization.save_success")),u.value==="copy"){const c=re.get("open-backend")==="1"?"_self":"_blank",k=f.value==="dataV"?"#/dvCanvas?opt=copy&dvId=":"#/dashboard?opt=copy&resourceId=";window.open(k+m.data,c)}}).finally(()=>{T.value=!1}))}})};oe({optInit:ce,editeInit:ve});const Z=le;return(t,e)=>{const o=ye,b=be,m=Ie,c=ke,k=Ve,L=ze,C=Te,H=De,ge=we,he=Se("loading");return h(),E(ge,{class:"create-dialog",title:B.value,modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=r=>g.value=r),width:u.value==="move"?"600px":"420px","before-close":j,onSubmit:e[11]||(e[11]=V(()=>{},["prevent"]))},{footer:n(()=>[s(H,{secondary:"",onClick:e[8]||(e[8]=r=>j())},{default:n(()=>[X(z(p(a)("visualization.cancel")),1)]),_:1}),s(H,{type:"primary",onClick:e[9]||(e[9]=r=>_e())},{default:n(()=>[X(z(p(a)("visualization.confirm")),1)]),_:1})]),default:n(()=>[qe((h(),E(C,{"label-position":"top","require-asterisk-position":"right",ref_key:"resource",ref:q,model:l,rules:P.value},{default:n(()=>[de.value?(h(),E(b,{key:0,label:x.value,prop:"name"},{default:n(()=>[s(o,{onKeydown:e[0]||(e[0]=V(()=>{},["stop"])),onKeyup:e[1]||(e[1]=V(()=>{},["stop"])),placeholder:D.value,modelValue:l.name,"onUpdate:modelValue":e[2]||(e[2]=r=>l.name=r)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):I("",!0),ue.value?(h(),E(b,{key:1,label:p(a)("visualization.belong_folder"),prop:"pid"},{default:n(()=>[s(k,{style:{width:"100%"},onKeydown:e[3]||(e[3]=V(()=>{},["stop"])),onKeyup:e[4]||(e[4]=V(()=>{},["stop"])),modelValue:l.pid,"onUpdate:modelValue":e[5]||(e[5]=r=>l.pid=r),data:d.tData,props:W,onNodeClick:Y,"filter-method":me,"render-after-expand":!1,filterable:""},{default:n(({data:{name:r}})=>[v("span",We,[s(c,null,{default:n(()=>[s(m,{name:"dv-folder"},{default:n(()=>[s(p(te),{class:"svg-icon"})]),_:1})]),_:1}),v("span",{title:r},z(r),9,Ye)])]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):I("",!0),u.value==="move"?(h(),ee("div",Ze,[s(o,{style:{"margin-bottom":"12px"},modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=r=>_.value=r),clearable:""},{prefix:n(()=>[s(c,null,{default:n(()=>[s(m,{name:"icon_search-outline_outlined"},{default:n(()=>[s(p(Ue),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),v("div",He,[s(L,{ref_key:"treeRef",ref:R,"filter-node-method":ne,filterable:"",modelValue:l.pid,"onUpdate:modelValue":e[7]||(e[7]=r=>l.pid=r),"empty-text":"",menu:"",data:d.tData,props:W,onNodeClick:Y},{default:n(({data:r})=>[v("span",Qe,[s(c,{style:{"font-size":"18px"}},{default:n(()=>[s(m,{name:"dv-folder"},{default:n(()=>[s(p(te),{class:"svg-icon"})]),_:1})]),_:1}),v("span",{title:r.name},z(r.name),9,Xe)])]),_:1},8,["modelValue","data"]),G.value?(h(),ee("div",et,[v("img",{src:p(Ke)},null,8,tt),v("span",null,z(p(a)("visualization.no_content")),1)])):I("",!0)])])):I("",!0)]),_:1},8,["model","rules"])),[[he,T.value]])]),_:1},8,["title","modelValue","width"])}}});const ia=Je(at,[["__scopeId","data-v-06a5819b"]]);export{ia as default};

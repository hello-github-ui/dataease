import{a as ye}from"./index-0.0.0-dataease.js";import{E as we}from"./el-dialog-0.0.0-dataease.js";import{o as be,ay as ke,az as Ve,ac as ze,D as C,G as Te,n as De,j as Ee,y as Le}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as Ce}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Fe}from"./el-tree-select-0.0.0-dataease.js";import{a as Ie,E as Ne}from"./el-form-item-0.0.0-dataease.js";import{d as xe,t as Re,Z as X,r,G as U,w as qe,aa as Se,f as h,g as F,i as s,ab as V,k as i,a5 as Y,a6 as z,j as m,T as Be,a0 as I,M as v,L as ee,n as Ue}from"./vue-0.0.0-dataease.js";import{d as ae}from"./dv-folder-0.0.0-dataease.js";import{i as Ae}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{n as Ge}from"./nothing-tree-0.0.0-dataease.js";import{e as Me,l as Ke,n as Oe,o as Pe,p as $e,k as je}from"./dataVisualization-0.0.0-dataease.js";import{_ as Ze}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./index-0.0.0-dataease13.js";import"./index-0.0.0-dataease3.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";const He={class:"custom-tree-node"},Je=["title"],Qe={key:2},We={class:"tree-content"},Xe={class:"custom-tree-node"},Ye=["title"],ea={key:0,class:"empty-search"},aa=["src"],ta=xe({__name:"DeResourceGroupOpt",props:{curCanvasType:{type:String,required:!0}},emits:["finish"],setup(te,{expose:oe,emit:le}){const N=te,{curCanvasType:f}=Re(N),{wsCache:ne}=ye("localStorage"),{t}=be(),d=X({tData:[],nameList:[],targetInfo:null}),A=r(!1),T=r(!1),G=r(),y=r(),w=r(),u=r(""),x=r(),_=r(""),R=r(""),l=X({pid:"",pName:null,name:"新建"}),M=U(()=>f.value==="dataV"?t("work_branch.big_data_screen"):t("work_branch.dashboard")),K={move:Pe,copy:$e,newFolder:je},O=r(!1),se=(a,e)=>(Ue(()=>{O.value=x.value.isEmpty}),a?e.name.includes(a):!0);qe(_,a=>{x.value.filter(a)});const re=a=>!q||q.length===0?!1:q.some(e=>e===a),ie=(a,e,o)=>{re(e)?o(new Error(t("visualization.name_repeat"))):o()},ue=U(()=>["newLeaf","copy","newLeafAfter"].includes(u.value)&&A.value),de=U(()=>!["newLeafAfter","move"].includes(u.value));let q=[];const P=r(),S=r(),g=r(!1),B=r("");let $=[];const ce=a=>{d.tData=[...$].filter(e=>e.name.includes(a))},j=()=>{B.value=null,R.value="",l.name=t("visualization.new"),l.pid="",g.value=!1},Z=a=>{a.forEach(e=>{var o;e.value=e.id,(o=e.children)!=null&&o.length&&Z(e.children)})},me=a=>({newFolder:t("visualization.new_folder"),newLeaf:N.curCanvasType==="dataV"?t("visualization.new_screen"):t("visualization.new_dashboard"),move:t("visualization.move_to"),copy:t("visualization.copy")+M.value,rename:t("visualization.rename"),newLeafAfter:t("visualization.belong_folder")})[a],D=r(""),pe=(a,e,o,b=!1)=>{A.value=b,d.targetInfo=e,G.value=a;const c=e.leaf||a==="leaf"?M.value:t("visualization.folder"),p=e.leaf||a==="leaf"?N.curCanvasType==="dataV"?t("work_branch.big_data_screen"):t("work_branch.dashboard"):t("visualization.folder");D.value=t("visualization.input_name_tips",[p]),_.value="",B.value=me(o)+(o==="rename"?c:""),R.value=(o==="move"?"":c)+t("visualization.name");const k={busiFlag:f.value,leaf:!1,weight:7};["newFolder"].includes(o)?l.name="":o==="copy"?l.name=e.name+"_copy":l.name=e.name,Me(k).then(E=>{ke(E,f.value);const L=E||[];Z(L),d.tData=L||[],d.tData.length&&d.tData[0].name==="root"&&d.tData[0].id==="0"&&(d.tData[0].name=f.value==="dataV"?t("work_branch.big_data_screen"):t("work_branch.dashboard")),$=[...d.tData],o==="move"&&Ve(d.tData,e.id),["newLeaf","newFolder"].includes(o)?(l.pid=e.id,y.value=e.id):w.value=e.id}),u.value=o,g.value=!0,P.value={name:[{required:!0,message:D.value,trigger:"change"},{required:!0,message:D.value,trigger:"blur"},{min:1,max:64,message:t("commons.char_1_64"),trigger:"change"},{required:!0,trigger:"blur",validator:ie}],pid:[{required:!0,message:t("common.please_select"),trigger:"blur"}]},setTimeout(()=>{S.value.clearValidate()},50)},ve=a=>{y.value=a.pid,w.value=a.id},H={label:"name",children:"children",isLeaf:a=>{var e;return!((e=a.children)!=null&&e.length)}},J=a=>{l.pid=a.id,l.pName=a.name},fe=a=>{if(a.pid!==0&&!a.pid)return C.error(t("visualization.select_target_folder")),!1;if(_.value&&!l.pName.includes(_.value))return C.error(t("visualization.select_target_folder")),!1;if(a.pid===a.id){C.warning(t("visualization.select_target_tips"));return}return!0},_e=()=>{S.value.validate(async a=>{var e;if(a){const o={nodeType:G.value,name:l.name,type:f.value,mobileLayout:(e=d.targetInfo)==null?void 0:e.extraFlag};switch(u.value){case"move":o.pid=l.pid,o.id=w.value;break;case"copy":o.id=w.value,o.pid=l.pid||y.value||"0";break;case"rename":o.pid=y.value,o.id=w.value;break;default:o.pid=l.pid||y.value||"0";break}if(ze(o,t("components.length_1_64_characters")),u.value==="move"&&!fe(o))return;["newLeaf","newLeafAfter","newFolder","rename","move","copy"].includes(u.value)&&await Ke({opt:u.value,...o}),u.value==="newLeaf"?(g.value=!1,Q("finish",{opt:"newLeaf",...o})):(T.value=!0,(K[u.value]?K[u.value]:Oe)(o).then(c=>{if(T.value=!1,g.value=!1,Q("finish"),C.success(t("visualization.save_success")),u.value==="copy"){const p=ne.get("open-backend")==="1"?"_self":"_blank",k=f.value==="dataV"?"#/dvCanvas?opt=copy&dvId=":"#/dashboard?opt=copy&resourceId=";window.open(k+c.data,p)}}).finally(()=>{T.value=!1}))}})};oe({optInit:pe,editeInit:ve});const Q=le;return(a,e)=>{const o=Te,b=Ie,c=De,p=Ee,k=Fe,E=Ce,L=Ne,W=Le,ge=we,he=Se("loading");return h(),F(ge,{class:"create-dialog",title:B.value,modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=n=>g.value=n),width:u.value==="move"?"600px":"420px","before-close":j,onSubmit:e[11]||(e[11]=V(()=>{},["prevent"]))},{footer:s(()=>[i(W,{secondary:"",onClick:e[8]||(e[8]=n=>j())},{default:s(()=>[Y(z(m(t)("visualization.cancel")),1)]),_:1}),i(W,{type:"primary",onClick:e[9]||(e[9]=n=>_e())},{default:s(()=>[Y(z(m(t)("visualization.confirm")),1)]),_:1})]),default:s(()=>[Be((h(),F(L,{"label-position":"top","require-asterisk-position":"right",ref_key:"resource",ref:S,model:l,rules:P.value},{default:s(()=>[de.value?(h(),F(b,{key:0,label:R.value,prop:"name"},{default:s(()=>[i(o,{onKeydown:e[0]||(e[0]=V(()=>{},["stop"])),onKeyup:e[1]||(e[1]=V(()=>{},["stop"])),placeholder:D.value,modelValue:l.name,"onUpdate:modelValue":e[2]||(e[2]=n=>l.name=n)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):I("",!0),ue.value?(h(),F(b,{key:1,label:m(t)("visualization.belong_folder"),prop:"pid"},{default:s(()=>[i(k,{style:{width:"100%"},onKeydown:e[3]||(e[3]=V(()=>{},["stop"])),onKeyup:e[4]||(e[4]=V(()=>{},["stop"])),modelValue:l.pid,"onUpdate:modelValue":e[5]||(e[5]=n=>l.pid=n),data:d.tData,props:H,onNodeClick:J,"filter-method":ce,"render-after-expand":!1,filterable:""},{default:s(({data:{name:n}})=>[v("span",He,[i(p,null,{default:s(()=>[i(c,{name:"dv-folder"},{default:s(()=>[i(m(ae),{class:"svg-icon"})]),_:1})]),_:1}),v("span",{title:n},z(n),9,Je)])]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):I("",!0),u.value==="move"?(h(),ee("div",Qe,[i(o,{style:{"margin-bottom":"12px"},modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=n=>_.value=n),clearable:""},{prefix:s(()=>[i(p,null,{default:s(()=>[i(c,{name:"icon_search-outline_outlined"},{default:s(()=>[i(m(Ae),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),v("div",We,[i(E,{ref_key:"treeRef",ref:x,"filter-node-method":se,filterable:"",modelValue:l.pid,"onUpdate:modelValue":e[7]||(e[7]=n=>l.pid=n),"empty-text":"",menu:"",data:d.tData,props:H,onNodeClick:J},{default:s(({data:n})=>[v("span",Xe,[i(p,{style:{"font-size":"18px"}},{default:s(()=>[i(c,{name:"dv-folder"},{default:s(()=>[i(m(ae),{class:"svg-icon"})]),_:1})]),_:1}),v("span",{title:n.name},z(n.name),9,Ye)])]),_:1},8,["modelValue","data"]),O.value?(h(),ee("div",ea,[v("img",{src:m(Ge)},null,8,aa),v("span",null,z(m(t)("visualization.no_content")),1)])):I("",!0)])])):I("",!0)]),_:1},8,["model","rules"])),[[he,T.value]])]),_:1},8,["title","modelValue","width"])}}});const Na=Ze(ta,[["__scopeId","data-v-06a5819b"]]);export{Na as default};

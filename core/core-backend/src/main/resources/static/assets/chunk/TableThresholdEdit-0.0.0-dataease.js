import{d as _e,x as ye,y as he,w as be,h as ge,o as ve,a5 as xe,B as Ve,A as ke,r as Ce,M as Te}from"./element-plus-secondary-0.0.0-dataease.js";import{j as Ne,h as Se}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as Je,l as Ue,o,Z as c,_ as a,a as A,a0 as t,u as i,a2 as S,c as b,ab as v,M as x,$ as q,z as $,a4 as E,Y as V,a1 as Z}from"./@vue-0.0.0-dataease.js";import{i as Me}from"./icon_info_filled-0.0.0-dataease.js";import{i as H}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as Q}from"./icon_add_outlined-0.0.0-dataease.js";import{a as Oe}from"./chart-0.0.0-dataease.js";import{f as J}from"./attr-0.0.0-dataease20.js";import{i as B}from"./field-list-0.0.0-dataease.js";import{e as Ae}from"./lodash-es-0.0.0-dataease.js";import{_ as Ee}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";const Fe={class:"tip"},Ie={style:{"padding-left":"10px"}},we={style:{margin:"0 -5px"}},qe={style:{margin:"0 -5px"}},$e={style:{display:"flex","align-items":"center","justify-content":"center"}},Be=Je({__name:"TableThresholdEdit",props:{chart:{type:Object,required:!0},threshold:{type:Array,required:!0}},emits:["onTableThresholdChange"],setup(M,{emit:W}){const{t:d}=Ne(),T=M,X=W,ee={term:"",field:"0",value:"0",color:"#ff0000ff",backgroundColor:"#ffffff00",min:"0",max:"1",type:"fixed",dynamicField:{summary:"value"},dynamicMinField:{summary:"value"},dynamicMaxField:{summary:"value"}},le=[{label:"",options:[{value:"eq",label:d("chart.filter_eq")},{value:"not_eq",label:d("chart.filter_not_eq")}]},{label:"",options:[{value:"like",label:d("chart.filter_like")},{value:"not like",label:d("chart.filter_not_like")}]},{label:"",options:[{value:"null",label:d("chart.filter_null")},{value:"not_null",label:d("chart.filter_not_null")}]}],ae=[{label:"",options:[{value:"eq",label:d("chart.filter_eq")},{value:"not_eq",label:d("chart.filter_not_eq")}]},{label:"",options:[{value:"lt",label:d("chart.filter_lt")},{value:"gt",label:d("chart.filter_gt")}]},{label:"",options:[{value:"le",label:d("chart.filter_le")},{value:"ge",label:d("chart.filter_ge")}]}],te=[{label:"",options:[{value:"eq",label:d("chart.filter_eq")},{value:"not_eq",label:d("chart.filter_not_eq")}]},{label:"",options:[{value:"lt",label:d("chart.filter_lt")},{value:"gt",label:d("chart.filter_gt")}]},{label:"",options:[{value:"le",label:d("chart.filter_le")},{value:"ge",label:d("chart.filter_ge")}]},{label:"",options:[{value:"between",label:d("chart.filter_between")}]}],P=Oe,m=Ue({thresholdArr:[],fields:[],thresholdObj:{fieldId:"",field:{},conditions:[]}}),ne=()=>{m.thresholdArr=JSON.parse(JSON.stringify(T.threshold)),oe()},I=(n,s)=>{s&&([0,5,7].includes(s.deType)?n.options=JSON.parse(JSON.stringify(le)):s.deType===1?n.options=JSON.parse(JSON.stringify(ae)):n.options=JSON.parse(JSON.stringify(te)),n.conditions&&n.conditions.forEach(r=>{r.term=""}))},oe=()=>{let n=[];if(T.chart.type==="table-info")n=JSON.parse(JSON.stringify(T.chart.xAxis));else if(T.chart.type==="table-pivot"){const r=JSON.parse(JSON.stringify(T.chart.xAxis)),p=JSON.parse(JSON.stringify(T.chart.xAxisExt)),u=JSON.parse(JSON.stringify(T.chart.yAxis));n=[...r,...p,...u]}else{const r=JSON.parse(JSON.stringify(T.chart.xAxis)),p=JSON.parse(JSON.stringify(T.chart.yAxis));n=[...r,...p]}m.fields.splice(0,m.fields.length,...n);let s=!1;m.thresholdArr.forEach(r=>{m.fields.filter(u=>u.id===r.fieldId).length===0&&(s=!0,r.fieldId=null)}),s&&y()},de=()=>{m.thresholdArr.push(JSON.parse(JSON.stringify(m.thresholdObj))),y()},se=n=>{m.thresholdArr.splice(n,1),y()},y=()=>{X("onTableThresholdChange",m.thresholdArr)},re=n=>{var p,u;const s=JSON.parse(JSON.stringify(ee)),r=(u=(p=T.chart)==null?void 0:p.customAttr)==null?void 0:u.tableCell;r&&(s.backgroundColor=Ae(r.tableItemBgColor)),n.conditions.push(s),y()},ie=(n,s)=>{n.conditions.splice(s,1),y()},F=n=>{m.fields&&m.fields.length>0&&m.fields.forEach(s=>{var r,p,u;n.fieldId===s.id&&(n.field=JSON.parse(JSON.stringify(s)),I(n,n.field)),((r=n.dynamicField)==null?void 0:r.fieldId)===s.id&&(n.dynamicField.field=JSON.parse(JSON.stringify(s)),I(n,n.dynamicField.field)),((p=n.dynamicMinField)==null?void 0:p.fieldId)===s.id&&(n.dynamicMinField.field=JSON.parse(JSON.stringify(s)),I(n,n.dynamicMinField.field)),((u=n.dynamicMaxField)==null?void 0:u.fieldId)===s.id&&(n.dynamicMaxField.field=JSON.parse(JSON.stringify(s)),I(n,n.dynamicMaxField.field))}),y()},ce=[{label:d("chart.field_fixed"),value:"fixed"},{label:d("chart.field_dynamic"),value:"dynamic"}],j=[{id:"value",name:d("chart.field")+d("chart.drag_block_label_value")},{id:"avg",name:d("chart.avg")+d("chart.drag_block_label_value")},{id:"max",name:d("chart.max")},{id:"min",name:d("chart.min")}],z=(n,s,r)=>{var _,U,O,w;const p=m.fields.filter(f=>f.id===n.fieldId);if(p.length===0||((_=p[0])==null?void 0:_.deType)===void 0||((U=p[0])==null?void 0:U.deType)===null)return n.fieldId=null,s.fieldId=null,r.fieldId=null,[];const u=(O=p[0])==null?void 0:O.deType,h=m.fields.filter(f=>[0,1,4,5].includes(u)?f.deType===u:[2,3].includes(u)?f.deType===2||f.deType===3:!1)??[];return h.find(f=>f.id===r.fieldId)||(r.fieldId=(w=h[0])==null?void 0:w.id,F(s)),h},D=n=>{var r,p;const s=(p=(r=m.fields.filter(u=>u.id===n))==null?void 0:r[0])==null?void 0:p.deType;return s===1?j.filter(u=>u.id!=="avg"):s===0||s===5?j.filter(u=>u.id==="value"):j},N=n=>!n.term.includes("null")&&!n.term.includes("empty"),k=n=>n.term==="between",C=n=>n.type==="dynamic",ue=n=>{n.type==="dynamic"&&(n.dynamicField.summary="value",n.dynamicMinField.summary="value",n.dynamicMaxField.summary="value")},pe=n=>ce;return ne(),(n,s)=>{const r=Se,p=_e,u=ye,h=he,_=be,U=ge,O=ve,w=xe,f=Ve,L=ke,fe=Ce,R=Te;return o(),c(f,null,{default:a(()=>[A("div",Fe,[t(r,{name:"icon_info_filled",class:"icon-style"},{default:a(()=>[t(i(Me),{class:"svg-icon icon-style"})]),_:1}),A("span",Ie,S(i(d)("chart.table_threshold_tip")),1)]),A("div",{onKeydown:s[0]||(s[0]=Z(()=>{},["stop"])),onKeyup:s[1]||(s[1]=Z(()=>{},["stop"])),style:{"max-height":"50vh","overflow-y":"auto"}},[(o(!0),b(x,null,v(m.thresholdArr,(g,G)=>(o(),b("div",{key:G,class:"field-item"},[t(O,{style:{"margin-top":"6px","align-items":"center","justify-content":"space-between"}},{default:a(()=>[t(_,{class:"form-item"},{default:a(()=>[t(h,{modelValue:g.fieldId,"onUpdate:modelValue":e=>g.fieldId=e,onChange:e=>F(g)},{default:a(()=>[(o(!0),b(x,null,v(m.fields,e=>(o(),c(u,{class:"series-select-option",key:e.id,label:e.name,value:e.id,disabled:M.chart.type==="table-info"&&e.deType===7},{default:a(()=>[t(p,{style:{"margin-right":"8px"}},{default:a(()=>[t(r,null,{default:a(()=>[(o(),c(q(i(B)[i(J)[e.deType]]),{class:$([`field-icon-${i(J)[[2,3].includes(e.deType)?2:0]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024)]),_:2},1024),E(" "+S(e.name),1)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),t(U,{class:"circle-button m-icon-btn",text:"",style:{float:"right"},onClick:e=>se(G)},{default:a(()=>[t(p,{size:"20px",style:{color:"#646a73"}},{default:a(()=>[t(r,{name:"icon_delete-trash_outlined"},{default:a(()=>[t(i(H),{class:"svg-icon"})]),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),t(O,{style:{marginTop:"16px",borderTop:"1px solid #d5d6d8"}},{default:a(()=>[(o(!0),b(x,null,v(g.conditions,(e,Y)=>(o(),c(O,{key:Y,class:"line-item",gutter:12},{default:a(()=>[t(f,{span:3},{default:a(()=>[t(_,{class:"form-item"},{default:a(()=>[t(h,{modelValue:e.term,"onUpdate:modelValue":l=>e.term=l,onChange:y},{default:a(()=>[(o(!0),b(x,null,v(g.options,(l,me)=>(o(),c(w,{key:me,label:l.label},{default:a(()=>[(o(!0),b(x,null,v(l.options,K=>(o(),c(u,{key:K.value,label:K.label,value:K.value},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),N(e)&&M.chart.type!=="rich-text"?(o(),c(f,{key:0,span:2,style:{"padding-left":"0 !important"}},{default:a(()=>[t(_,{class:"form-item"},{default:a(()=>[t(h,{modelValue:e.type,"onUpdate:modelValue":l=>e.type=l,class:"select-item",onChange:l=>ue(e),style:{width:"100%"}},{default:a(()=>[(o(!0),b(x,null,v(pe(g),l=>(o(),c(u,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024)):V("",!0),N(e)&&!k(e)&&!C(e)?(o(),c(f,{key:1,span:12,style:{"text-align":"center"}},{default:a(()=>[t(_,{class:"form-item"},{default:a(()=>[[2,3].includes(g.field.deType)?(o(),c(L,{key:0,modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,placeholder:i(d)("chart.drag_block_label_value"),"controls-position":"right",class:"value-item",clearable:"",onChange:y},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(o(),c(fe,{key:1,modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,placeholder:i(d)("chart.drag_block_label_value"),"controls-position":"right",clearable:"",onChange:y},null,8,["modelValue","onUpdate:modelValue","placeholder"]))]),_:2},1024)]),_:2},1024)):V("",!0),N(e)&&!k(e)&&C(e)?(o(),c(f,{key:2,span:6},{default:a(()=>[t(_,{class:"form-item"},{default:a(()=>[t(h,{modelValue:e.dynamicField.fieldId,"onUpdate:modelValue":l=>e.dynamicField.fieldId=l,onChange:l=>F(e),style:{width:"100%"}},{default:a(()=>[(o(!0),b(x,null,v(z(g,e,e.dynamicField),l=>(o(),c(u,{class:"series-select-option",key:l.id,label:l.name,value:l.id,disabled:M.chart.type==="table-info"&&l.deType===7},{default:a(()=>[t(p,{style:{"margin-right":"8px"}},{default:a(()=>[t(r,null,{default:a(()=>[(o(),c(q(i(B)[i(J)[l.deType]]),{class:$([`field-icon-${i(J)[[2,3].includes(l.deType)?2:0]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024)]),_:2},1024),E(" "+S(l.name),1)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024)):V("",!0),N(e)&&!k(e)&&C(e)?(o(),c(f,{key:3,span:6,style:{"text-align":"center"}},{default:a(()=>[t(_,{class:"form-item"},{default:a(()=>[t(h,{placeholder:i(d)("chart.aggregation"),modelValue:e.dynamicField.summary,"onUpdate:modelValue":l=>e.dynamicField.summary=l,onChange:y,style:{width:"100%"}},{default:a(()=>[(o(!0),b(x,null,v(D(e.dynamicField.fieldId),l=>(o(),c(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:2},1032,["placeholder","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):V("",!0),N(e)&&k(e)&&!C(e)?(o(),c(f,{key:4,span:5,style:{"text-align":"center"}},{default:a(()=>[t(_,{class:"form-item"},{default:a(()=>[t(L,{modelValue:e.min,"onUpdate:modelValue":l=>e.min=l,"controls-position":"right",class:"between-item",placeholder:i(d)("chart.axis_value_min"),clearable:"",onChange:y},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024)]),_:2},1024)):V("",!0),k(e)&&!C(e)?(o(),c(f,{key:5,span:2,style:{"margin-top":"4px","text-align":"center"}},{default:a(()=>[A("span",we," ≤ "+S(i(d)("chart.drag_block_label_value"))+" ≤ ",1)]),_:1})):V("",!0),N(e)&&k(e)&&!C(e)?(o(),c(f,{key:6,span:5,style:{"text-align":"center"}},{default:a(()=>[t(_,{class:"form-item"},{default:a(()=>[t(L,{modelValue:e.max,"onUpdate:modelValue":l=>e.max=l,"controls-position":"right",class:"between-item",placeholder:i(d)("chart.axis_value_max"),clearable:"",onChange:y},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1024)]),_:2},1024)):V("",!0),N(e)&&k(e)&&C(e)?(o(),c(f,{key:7,class:"minField",span:3},{default:a(()=>[t(_,{class:"form-item"},{default:a(()=>[t(h,{modelValue:e.dynamicMinField.fieldId,"onUpdate:modelValue":l=>e.dynamicMinField.fieldId=l,onChange:l=>F(e)},{default:a(()=>[(o(!0),b(x,null,v(z(g,e,e.dynamicMinField),l=>(o(),c(u,{class:"series-select-option",key:l.id,label:l.name,value:l.id,disabled:M.chart.type==="table-info"&&l.deType===7},{default:a(()=>[t(p,{style:{"margin-right":"8px"}},{default:a(()=>[t(r,null,{default:a(()=>[(o(),c(q(i(B)[i(J)[l.deType]]),{class:$([`field-icon-${i(J)[[2,3].includes(l.deType)?2:0]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024)]),_:2},1024),E(" "+S(l.name),1)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024)):V("",!0),N(e)&&k(e)&&C(e)?(o(),c(f,{key:8,class:"minValue",span:2,style:{"padding-left":"0 !important"}},{default:a(()=>[t(_,{class:"form-item"},{default:a(()=>[t(h,{modelValue:e.dynamicMinField.summary,"onUpdate:modelValue":l=>e.dynamicMinField.summary=l,onChange:y},{default:a(()=>[(o(!0),b(x,null,v(D(e.dynamicMinField.fieldId),l=>(o(),c(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):V("",!0),k(e)&&C(e)?(o(),c(f,{key:9,class:"term",span:2,style:{"margin-top":"4px","text-align":"center"}},{default:a(()=>[A("span",qe," ≤ "+S(i(d)("chart.drag_block_label_value"))+" ≤ ",1)]),_:1})):V("",!0),N(e)&&k(e)&&C(e)?(o(),c(f,{key:10,class:"maxField",span:3},{default:a(()=>[t(_,{class:"form-item"},{default:a(()=>[t(h,{modelValue:e.dynamicMaxField.fieldId,"onUpdate:modelValue":l=>e.dynamicMaxField.fieldId=l,onChange:l=>F(e)},{default:a(()=>[(o(!0),b(x,null,v(z(g,e,e.dynamicMaxField),l=>(o(),c(u,{class:"series-select-option",key:l.id,label:l.name,value:l.id,disabled:M.chart.type==="table-info"&&l.deType===7},{default:a(()=>[t(p,{style:{"margin-right":"8px"}},{default:a(()=>[t(r,null,{default:a(()=>[(o(),c(q(i(B)[i(J)[l.deType]]),{class:$([`field-icon-${i(J)[[2,3].includes(l.deType)?2:0]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024)]),_:2},1024),E(" "+S(l.name),1)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024)):V("",!0),N(e)&&k(e)&&C(e)?(o(),c(f,{key:11,class:"maxValue",span:2,style:{"padding-left":"0 !important"}},{default:a(()=>[t(_,{class:"form-item"},{default:a(()=>[t(h,{modelValue:e.dynamicMaxField.summary,"onUpdate:modelValue":l=>e.dynamicMaxField.summary=l,onChange:y},{default:a(()=>[(o(!0),b(x,null,v(D(e.dynamicMaxField.fieldId),l=>(o(),c(u,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):V("",!0),t(f,{span:3},{default:a(()=>[t(_,{class:"form-item",label:i(d)("chart.textColor")},{default:a(()=>[t(R,{"is-custom":"",size:"large",modelValue:e.color,"onUpdate:modelValue":l=>e.color=l,"show-alpha":"",class:"color-picker-style",predefine:i(P),onChange:y},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:2},1032,["label"])]),_:2},1024),t(f,{span:3},{default:a(()=>[t(_,{class:"form-item",label:i(d)("chart.backgroundColor")},{default:a(()=>[t(R,{"is-custom":"",size:"large",modelValue:e.backgroundColor,"onUpdate:modelValue":l=>e.backgroundColor=l,"show-alpha":"",class:"color-picker-style",predefine:i(P),onChange:y},null,8,["modelValue","onUpdate:modelValue","predefine"])]),_:2},1032,["label"])]),_:2},1024),t(f,{span:1},{default:a(()=>[A("div",$e,[t(U,{class:"circle-button m-icon-btn",text:"",onClick:l=>ie(g,Y)},{default:a(()=>[t(p,{size:"20px",style:{color:"#646a73"}},{default:a(()=>[t(r,{name:"icon_delete-trash_outlined"},{default:a(()=>[t(i(H),{class:"svg-icon"})]),_:1})]),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024),t(U,{style:{"margin-top":"10px"},class:"circle-button",type:"primary",text:"",onClick:e=>re(g)},{icon:a(()=>[t(r,{name:"icon_add_outlined"},{default:a(()=>[t(i(Q),{class:"svg-icon"})]),_:1})]),default:a(()=>[E(" "+S(i(d)("chart.add_style")),1)]),_:2},1032,["onClick"])]))),128))],32),t(U,{class:"circle-button",text:"",type:"primary",style:{"margin-top":"10px"},onClick:de},{icon:a(()=>[t(r,{name:"icon_add_outlined"},{default:a(()=>[t(i(Q),{class:"svg-icon"})]),_:1})]),default:a(()=>[E(" "+S(i(d)("chart.add_condition")),1)]),_:1})]),_:1})}}});const Gl=Ee(Be,[["__scopeId","data-v-cbbcee7e"]]);export{Gl as default};

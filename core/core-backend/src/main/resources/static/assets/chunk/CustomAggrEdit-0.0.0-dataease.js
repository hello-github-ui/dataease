import{M as tt}from"./index-0.0.0-dataease.js";import{E as et}from"./el-row-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as ot}from"./el-popover-0.0.0-dataease.js";import{o as at,n as st,j as nt,G as it}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{d as lt,r as k,Z as q,o as ct,a as rt,w as B,f as r,L as m,M as n,a6 as l,j as s,k as e,i as a,a5 as v,Y as J,a9 as j,g as w,m as dt,U as ut,ab as N,a0 as pt,n as _t}from"./vue-0.0.0-dataease.js";import{i as M}from"./icon_info_outlined-0.0.0-dataease.js";import{i as z}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as mt}from"./icon_adjustment_outlined-0.0.0-dataease.js";import{i as ft}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as vt}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import gt from"./CodeMirror-0.0.0-dataease.js";import{H as ht}from"./dataset-0.0.0-dataease.js";import{f as V}from"./attr-0.0.0-dataease20.js";import{i as yt}from"./field-list-0.0.0-dataease.js";import{d as T}from"./lodash-0.0.0-dataease.js";import{E as kt}from"./index-0.0.0-dataease3.js";import{_ as Ct}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";const xt={class:"calcu-cont"},Dt={style:{flex:"1"}},wt={style:{"max-width":"488px"}},Nt={class:"mb8 field-exp"},Tt={key:0},bt={key:1},St={class:"padding-lr"},Et={class:"mb8"},Ft={class:"padding-lr-content"},qt={class:"quota-btn_de"},Mt={class:"field-height"},Vt={key:0,class:"field-list"},Lt=["title","onClick"],It={key:2,class:"icon-right"},Ot={key:1,class:"class-na"},At={class:"padding-lr"},$t={class:"mb8"},Bt={key:0},Jt={key:1},jt={class:"padding-lr-content"},zt={key:0,style:{width:"100%"}},Pt=["onClick"],Ut={class:"pop-title"},Qt={class:"pop-info"},Rt={class:"pop-info"},Ht={key:1,class:"class-na"},Kt=lt({__name:"CustomAggrEdit",props:{crossDs:{type:Boolean,default:()=>!1}},setup(P,{expose:U}){const{t:c}=at(),L=k(),b=k(""),S=k(""),d=k(),I=P,O={originName:"",name:"",groupType:"d",type:"VARCHAR",deType:0,extField:2,id:"",params:[],checked:!0},u=q({functionData:[],quotaData:[]}),A=q({id:null,name:"",value:null}),Q=k(!1),f=q({...O}),R=()=>{const o=d.value.state.doc.toString(),t=[];f.originName=x("name","id",o,t)},x=(o,t,p,_)=>{let h=p;const C=u.quotaData.reduce((y,g)=>(y[g[o]]=g[t],y),{}),D=p.match(/\[(.+?)\]/g);return D&&D.forEach(y=>{const g=y.slice(1,-1);_&&_.push(C[g]),h=h.replace(`[${g}]`,`[${C[g]}]`)}),h};let E=[];const H=(o,t)=>{if(A.id=null,Object.assign(f,{...O,...o}),u.quotaData=t.concat(f.params||[]),E=T(t.concat(f.params||[])),!o.originName){d.value.dispatch({changes:{from:0,to:d.value.viewState.state.doc.length,insert:""}});return}_t(()=>{d.value.dispatch({changes:{from:0,to:d.value.viewState.state.doc.length,insert:x("id","name",o.originName)}})})},K=o=>{d.value.dispatch({changes:{from:d.value.viewState.state.selection.ranges[0].from,insert:o},selection:{anchor:d.value.viewState.state.selection.ranges[0].from}})};ct(()=>{d.value=L.value.codeComInit()}),rt(()=>{var o,t;(t=(o=d.value).destroy)==null||t.call(o)});const G=o=>{d.value.dispatch({changes:{from:d.value.viewState.state.selection.ranges[0].from,insert:o},selection:{anchor:d.value.viewState.state.selection.ranges[0].from}})};let F=[];const Y=()=>{ht().then(o=>{F=T(o),u.functionData=T(o)})};B(()=>b.value,o=>{o&&o!==""?u.quotaData=JSON.parse(JSON.stringify(E.filter(t=>t.name.toLocaleLowerCase().includes(o.toLocaleLowerCase())&&t.extField===0))):u.quotaData=JSON.parse(JSON.stringify(E)).filter(t=>t.extField===0)}),B(()=>S.value,o=>{o&&o!==""?u.functionData=JSON.parse(JSON.stringify(F.filter(t=>t.func.toLocaleLowerCase().includes(o.toLocaleLowerCase())))):u.functionData=T(F)}),U({initEdit:H,setFieldForm:R,fieldForm:f});const Z=k(""),W=()=>{const[o]=f.params;Z.value="编辑计算参数",Object.assign(A,o||{}),Q.value=!0},X=()=>{const[o]=f.params;f.params=[];const t=d.value.state.doc.toString(),p=[];f.originName=x("name","id",t,p).replaceAll(`[${o.id}]`,""),u.quotaData=u.quotaData.filter(_=>_.id!==o.id),d.value.dispatch({changes:{from:0,to:d.value.viewState.state.doc.length,insert:x("id","name",f.originName)}})};return Y(),(o,t)=>{const p=st,_=nt,h=kt,C=it,D=tt,y=ot,g=et;return r(),m("div",{onKeydown:t[2]||(t[2]=N(()=>{},["stop"])),onKeyup:t[3]||(t[3]=N(()=>{},["stop"])),class:"calcu-field"},[n("div",xt,[n("div",Dt,[n("div",wt,[n("div",Nt,[n("span",null,l(s(c)("dataset.field_exp")),1),t[4]||(t[4]=n("span",null,"*",-1)),e(h,{class:"item",effect:"dark",placement:"top"},{content:a(()=>[I.crossDs?(r(),m("div",Tt,l(s(c)("dataset.calc_tips.tip1")),1)):(r(),m("div",bt,l(s(c)("dataset.calc_tips.tip1_1")),1)),n("div",null,l(s(c)("dataset.calc_tips.tip2")),1)]),default:a(()=>[e(_,{size:"16px"},{default:a(()=>[e(p,{name:"icon_info_outlined"},{default:a(()=>[e(s(M),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),e(gt,{quotaMap:u.quotaData.map(i=>i.name),dimensionMap:[],ref_key:"myCm",ref:L,height:"500px","dom-id":"calcField"},null,8,["quotaMap"])])]),n("div",St,[n("span",Et,[v(l(s(c)("dataset.click_ref_field"))+" ",1),e(h,{class:"item",effect:"dark",placement:"bottom"},{content:a(()=>[v(l(s(c)("dataset.calc_tips.tip3"))+" ",1),t[5]||(t[5]=n("br",null,null,-1)),v(" "+l(s(c)("dataset.calc_tips.tip4"))+" ",1),t[6]||(t[6]=n("br",null,null,-1)),v(" "+l(s(c)("dataset.calc_tips.tip5")),1)]),default:a(()=>[e(_,{size:"16px"},{default:a(()=>[e(p,{name:"icon_info_outlined"},{default:a(()=>[e(s(M),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),n("div",Ft,[e(C,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=i=>b.value=i),placeholder:s(c)("dataset.edit_search"),clearable:""},{prefix:a(()=>[e(_,null,{default:a(()=>[e(p,{name:"icon_search-outline_outlined"},{default:a(()=>[e(s(z),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),n("div",qt,[n("span",null,l(s(c)("chart.quota")),1)]),n("div",Mt,[e(D,null,{default:a(()=>[u.quotaData.length?(r(),m("div",Vt,[(r(!0),m(J,null,j(u.quotaData,i=>(r(),m("span",{key:i.id,class:"item-quota flex-align-center ellipsis",title:i.name,onClick:$=>K("["+i.name+"]")},[i.groupType?(r(),w(_,{key:1},{default:a(()=>[e(p,{className:`field-icon-${s(V)[i.deType]}`},{default:a(()=>[(r(),w(dt(s(yt)[s(V)[i.deType]]),{class:ut(["svg-icon",`field-icon-${s(V)[i.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024)):(r(),w(_,{key:0},{default:a(()=>[e(p,{name:"icon_adjustment_outlined"},{default:a(()=>[e(s(mt),{class:"svg-icon"})]),_:1})]),_:1})),v(" "+l(i.name)+" ",1),i.groupType?pt("",!0):(r(),m("div",It,[e(_,{onClick:N(W,["stop"]),class:"hover-icon"},{default:a(()=>[e(p,{name:"icon_edit_outlined"},{default:a(()=>[e(s(ft),{class:"svg-icon"})]),_:1})]),_:1}),e(_,{onClick:N(X,["stop"]),class:"hover-icon"},{default:a(()=>[e(p,{name:"icon_delete-trash_outlined"},{default:a(()=>[e(s(vt),{class:"svg-icon"})]),_:1})]),_:1})]))],8,Lt))),128))])):(r(),m("div",Ot,l(s(c)("dataset.na")),1))]),_:1})])])]),n("div",At,[n("span",$t,[v(l(s(c)("dataset.click_ref_function"))+" ",1),e(h,{class:"item",effect:"dark",placement:"bottom"},{content:a(()=>[I.crossDs?(r(),m("div",Bt,[v(l(s(c)("dataset.calc_tips.tip6"))+" ",1),t[7]||(t[7]=n("br",null,null,-1)),v(" "+l(s(c)("dataset.calc_tips.tip8"))+" ",1),t[8]||(t[8]=n("br",null,null,-1)),t[9]||(t[9]=v(" https://calcite.apache.org/docs/reference.html "))])):(r(),m("div",Jt,l(s(c)("dataset.calc_tips.tip7")),1))]),default:a(()=>[e(_,{size:"16px"},{default:a(()=>[e(p,{name:"icon_info_outlined"},{default:a(()=>[e(s(M),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),n("div",jt,[e(C,{modelValue:S.value,"onUpdate:modelValue":t[1]||(t[1]=i=>S.value=i),style:{"margin-bottom":"8px"},placeholder:s(c)("dataset.edit_search"),clearable:""},{prefix:a(()=>[e(_,null,{default:a(()=>[e(p,{name:"icon_search-outline_outlined"},{default:a(()=>[e(s(z),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),e(g,{class:"function-height"},{default:a(()=>[u.functionData.length?(r(),m("div",zt,[(r(!0),m(J,null,j(u.functionData,(i,$)=>(r(),w(y,{key:$,class:"function-pop",placement:"right",width:"200",trigger:"hover","open-delay":500},{reference:a(()=>[n("span",{class:"function-style flex-align-center",onClick:Gt=>G(i.func)},l(i.func),9,Pt)]),default:a(()=>[n("p",Ut,l(i.name),1),n("p",Qt,l(i.func),1),n("p",Rt,l(i.desc),1)]),_:2},1024))),128))])):(r(),m("div",Ht,l(s(c)("chart.no_function")),1))]),_:1})])])])],32)}}});const Ce=Ct(Kt,[["__scopeId","data-v-f6c43850"]]);export{Ce as default};

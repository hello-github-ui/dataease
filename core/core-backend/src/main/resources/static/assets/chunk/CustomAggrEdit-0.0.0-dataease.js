import{d as tt,e as et,r as ot,a as at,f as st,o as it}from"./element-plus-secondary-0.0.0-dataease.js";import{j as nt,h as lt}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as rt,r as k,l as E,b as ct,e as dt,w as B,o as c,c as _,a as i,a2 as l,u as s,a0 as e,_ as a,a4 as v,M as J,ab as z,Z as w,$ as pt,z as mt,a1 as b,Y as ut,n as _t}from"./@vue-0.0.0-dataease.js";import{i as V}from"./icon_info_outlined-0.0.0-dataease.js";import{i as P}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as ft}from"./icon_adjustment_outlined-0.0.0-dataease.js";import{i as vt}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as gt}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import ht from"./CodeMirror-0.0.0-dataease2.js";import{H as yt}from"./dataset-0.0.0-dataease.js";import{f as M}from"./attr-0.0.0-dataease20.js";import{i as kt}from"./field-list-0.0.0-dataease.js";import{e as N}from"./lodash-es-0.0.0-dataease.js";import{_ as Ct}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./@codemirror-0.0.0-dataease.js";import"./@lezer-0.0.0-dataease.js";import"./style-mod-0.0.0-dataease.js";import"./crelt-0.0.0-dataease.js";import"./@marijn-0.0.0-dataease.js";import"./w3c-keyname-0.0.0-dataease.js";import"./codemirror-0.0.0-dataease.js";const xt={class:"calcu-cont"},Dt={style:{flex:"1"}},wt={style:{"max-width":"488px"}},bt={class:"mb8 field-exp"},Nt={key:0},Tt={key:1},St={class:"padding-lr"},Ft={class:"mb8"},qt={class:"padding-lr-content"},Et={class:"quota-btn_de"},Vt={class:"field-height"},Mt={key:0,class:"field-list"},Lt=["title","onClick"],It={key:2,class:"icon-right"},Ot={key:1,class:"class-na"},$t={class:"padding-lr"},At={class:"mb8"},Bt={key:0},Jt={key:1},zt={class:"padding-lr-content"},Pt={key:0,style:{width:"100%"}},jt=["onClick"],Qt={class:"pop-title"},Rt={class:"pop-info"},Ut={class:"pop-info"},Ht={key:1,class:"class-na"},Kt=rt({__name:"CustomAggrEdit",props:{crossDs:{type:Boolean,default:()=>!1}},setup(j,{expose:Q}){const{t:r}=nt(),L=k(),T=k(""),S=k(""),d=k(),I=j,O={originName:"",name:"",groupType:"d",type:"VARCHAR",deType:0,extField:2,id:"",params:[],checked:!0},p=E({functionData:[],quotaData:[]}),$=E({id:null,name:"",value:null}),R=k(!1),f=E({...O}),U=()=>{const o=d.value.state.doc.toString(),t=[];f.originName=x("name","id",o,t)},x=(o,t,m,u)=>{let h=m;const C=p.quotaData.reduce((y,g)=>(y[g[o]]=g[t],y),{}),D=m.match(/\[(.+?)\]/g);return D&&D.forEach(y=>{const g=y.slice(1,-1);u&&u.push(C[g]),h=h.replace(`[${g}]`,`[${C[g]}]`)}),h};let F=[];const H=(o,t)=>{if($.id=null,Object.assign(f,{...O,...o}),p.quotaData=t.concat(f.params||[]),F=N(t.concat(f.params||[])),!o.originName){d.value.dispatch({changes:{from:0,to:d.value.viewState.state.doc.length,insert:""}});return}_t(()=>{d.value.dispatch({changes:{from:0,to:d.value.viewState.state.doc.length,insert:x("id","name",o.originName)}})})},K=o=>{d.value.dispatch({changes:{from:d.value.viewState.state.selection.ranges[0].from,insert:o},selection:{anchor:d.value.viewState.state.selection.ranges[0].from}})};ct(()=>{d.value=L.value.codeComInit()}),dt(()=>{var o,t;(t=(o=d.value).destroy)==null||t.call(o)});const Y=o=>{d.value.dispatch({changes:{from:d.value.viewState.state.selection.ranges[0].from,insert:o},selection:{anchor:d.value.viewState.state.selection.ranges[0].from}})};let q=[];const Z=()=>{yt().then(o=>{q=N(o),p.functionData=N(o)})};B(()=>T.value,o=>{o&&o!==""?p.quotaData=JSON.parse(JSON.stringify(F.filter(t=>t.name.toLocaleLowerCase().includes(o.toLocaleLowerCase())&&t.extField===0))):p.quotaData=JSON.parse(JSON.stringify(F)).filter(t=>t.extField===0)}),B(()=>S.value,o=>{o&&o!==""?p.functionData=JSON.parse(JSON.stringify(q.filter(t=>t.func.toLocaleLowerCase().includes(o.toLocaleLowerCase())))):p.functionData=N(q)}),Q({initEdit:H,setFieldForm:U,fieldForm:f});const G=k(""),W=()=>{const[o]=f.params;G.value="编辑计算参数",Object.assign($,o||{}),R.value=!0},X=()=>{const[o]=f.params;f.params=[];const t=d.value.state.doc.toString(),m=[];f.originName=x("name","id",t,m).replaceAll(`[${o.id}]`,""),p.quotaData=p.quotaData.filter(u=>u.id!==o.id),d.value.dispatch({changes:{from:0,to:d.value.viewState.state.doc.length,insert:x("id","name",f.originName)}})};return Z(),(o,t)=>{const m=lt,u=tt,h=et,C=ot,D=at,y=st,g=it;return c(),_("div",{onKeydown:t[2]||(t[2]=b(()=>{},["stop"])),onKeyup:t[3]||(t[3]=b(()=>{},["stop"])),class:"calcu-field"},[i("div",xt,[i("div",Dt,[i("div",wt,[i("div",bt,[i("span",null,l(s(r)("dataset.field_exp")),1),t[4]||(t[4]=i("span",null,"*",-1)),e(h,{class:"item",effect:"dark",placement:"top"},{content:a(()=>[I.crossDs?(c(),_("div",Nt,l(s(r)("dataset.calc_tips.tip1")),1)):(c(),_("div",Tt,l(s(r)("dataset.calc_tips.tip1_1")),1)),i("div",null,l(s(r)("dataset.calc_tips.tip2")),1)]),default:a(()=>[e(u,{size:"16px"},{default:a(()=>[e(m,{name:"icon_info_outlined"},{default:a(()=>[e(s(V),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),e(ht,{quotaMap:p.quotaData.map(n=>n.name),dimensionMap:[],ref_key:"myCm",ref:L,height:"500px","dom-id":"calcField"},null,8,["quotaMap"])])]),i("div",St,[i("span",Ft,[v(l(s(r)("dataset.click_ref_field"))+" ",1),e(h,{class:"item",effect:"dark",placement:"bottom"},{content:a(()=>[v(l(s(r)("dataset.calc_tips.tip3"))+" ",1),t[5]||(t[5]=i("br",null,null,-1)),v(" "+l(s(r)("dataset.calc_tips.tip4"))+" ",1),t[6]||(t[6]=i("br",null,null,-1)),v(" "+l(s(r)("dataset.calc_tips.tip5")),1)]),default:a(()=>[e(u,{size:"16px"},{default:a(()=>[e(m,{name:"icon_info_outlined"},{default:a(()=>[e(s(V),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",qt,[e(C,{modelValue:T.value,"onUpdate:modelValue":t[0]||(t[0]=n=>T.value=n),placeholder:s(r)("dataset.edit_search"),clearable:""},{prefix:a(()=>[e(u,null,{default:a(()=>[e(m,{name:"icon_search-outline_outlined"},{default:a(()=>[e(s(P),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),i("div",Et,[i("span",null,l(s(r)("chart.quota")),1)]),i("div",Vt,[e(D,null,{default:a(()=>[p.quotaData.length?(c(),_("div",Mt,[(c(!0),_(J,null,z(p.quotaData,n=>(c(),_("span",{key:n.id,class:"item-quota flex-align-center ellipsis",title:n.name,onClick:A=>K("["+n.name+"]")},[n.groupType?(c(),w(u,{key:1},{default:a(()=>[e(m,{className:`field-icon-${s(M)[n.deType]}`},{default:a(()=>[(c(),w(pt(s(kt)[s(M)[n.deType]]),{class:mt(["svg-icon",`field-icon-${s(M)[n.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024)):(c(),w(u,{key:0},{default:a(()=>[e(m,{name:"icon_adjustment_outlined"},{default:a(()=>[e(s(ft),{class:"svg-icon"})]),_:1})]),_:1})),v(" "+l(n.name)+" ",1),n.groupType?ut("",!0):(c(),_("div",It,[e(u,{onClick:b(W,["stop"]),class:"hover-icon"},{default:a(()=>[e(m,{name:"icon_edit_outlined"},{default:a(()=>[e(s(vt),{class:"svg-icon"})]),_:1})]),_:1}),e(u,{onClick:b(X,["stop"]),class:"hover-icon"},{default:a(()=>[e(m,{name:"icon_delete-trash_outlined"},{default:a(()=>[e(s(gt),{class:"svg-icon"})]),_:1})]),_:1})]))],8,Lt))),128))])):(c(),_("div",Ot,l(s(r)("dataset.na")),1))]),_:1})])])]),i("div",$t,[i("span",At,[v(l(s(r)("dataset.click_ref_function"))+" ",1),e(h,{class:"item",effect:"dark",placement:"bottom"},{content:a(()=>[I.crossDs?(c(),_("div",Bt,[v(l(s(r)("dataset.calc_tips.tip6"))+" ",1),t[7]||(t[7]=i("br",null,null,-1)),v(" "+l(s(r)("dataset.calc_tips.tip8"))+" ",1),t[8]||(t[8]=i("br",null,null,-1)),t[9]||(t[9]=v(" https://calcite.apache.org/docs/reference.html "))])):(c(),_("div",Jt,l(s(r)("dataset.calc_tips.tip7")),1))]),default:a(()=>[e(u,{size:"16px"},{default:a(()=>[e(m,{name:"icon_info_outlined"},{default:a(()=>[e(s(V),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",zt,[e(C,{modelValue:S.value,"onUpdate:modelValue":t[1]||(t[1]=n=>S.value=n),style:{"margin-bottom":"8px"},placeholder:s(r)("dataset.edit_search"),clearable:""},{prefix:a(()=>[e(u,null,{default:a(()=>[e(m,{name:"icon_search-outline_outlined"},{default:a(()=>[e(s(P),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),e(g,{class:"function-height"},{default:a(()=>[p.functionData.length?(c(),_("div",Pt,[(c(!0),_(J,null,z(p.functionData,(n,A)=>(c(),w(y,{key:A,class:"function-pop",placement:"right",width:"200",trigger:"hover","open-delay":500},{reference:a(()=>[i("span",{class:"function-style flex-align-center",onClick:Yt=>Y(n.func)},l(n.func),9,jt)]),default:a(()=>[i("p",Qt,l(n.name),1),i("p",Rt,l(n.func),1),i("p",Ut,l(n.desc),1)]),_:2},1024))),128))])):(c(),_("div",Ht,l(s(r)("chart.no_function")),1))]),_:1})])])])],32)}}});const uo=Ct(Kt,[["__scopeId","data-v-f6c43850"]]);export{uo as default};

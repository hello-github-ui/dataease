import{p as ee,a as mt,b as ft,u as te,M as vt}from"./index-0.0.0-dataease.js";import{E as _t}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import{n as D,j as L,r as ht,o as Ct,G as gt,R as wt,D as De,v as yt,F as bt,aL as oe}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as Me,a as Ie,b as ze}from"./el-dropdown-menu-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{f as p,L as x,M as N,d as Re,G as W,r as T,k as r,i,g as w,a0 as I,Y as X,a9 as $e,j as a,m as re,a5 as ne,a6 as q,U as ie,ab as Oe,ah as Tt,t as Vt,Z as Dt,w as St,o as kt,aa as xt,T as Se,W as Lt,n as ke}from"./vue-0.0.0-dataease.js";import{d as Ht}from"./dv-dashboard-spine-mobile-0.0.0-dataease.js";import{i as Nt}from"./icon_add_outlined-0.0.0-dataease.js";import{l as Et,o as Mt,q as It,t as zt,p as Rt}from"./dataVisualization-0.0.0-dataease.js";import{d as xe,_ as ae,e as $t}from"./lodash-0.0.0-dataease.js";import{d as me}from"./dv-rename-0.0.0-dataease.js";import{d as Le}from"./dv-dashboard-spine-0.0.0-dataease.js";import{d as Ot}from"./dv-screen-spine-0.0.0-dataease.js";import{d as Pt,i as Bt}from"./icon_file-add_outlined-0.0.0-dataease.js";import{i as Ft}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{d as Wt,a as Zt}from"./dv-sort-desc-0.0.0-dataease.js";import{d as He}from"./dv-folder-0.0.0-dataease.js";import{i as At}from"./icon_operation-analysis_outlined-0.0.0-dataease.js";import{i as qt}from"./icon_edit_outlined-0.0.0-dataease.js";import{_ as Ut}from"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import Gt from"./DeResourceGroupOpt-0.0.0-dataease.js";import{d as Jt}from"./dvMain-0.0.0-dataease.js";import{useAppStoreWithOut as jt}from"./app-0.0.0-dataease.js";import{i as Kt}from"./icon_more_outlined-0.0.0-dataease.js";import Xt from"./ShareHandler-0.0.0-dataease.js";import{u as Pe}from"./share-0.0.0-dataease.js";import{i as Yt}from"./ModelUtil-0.0.0-dataease.js";import{i as Qt}from"./interactive-0.0.0-dataease.js";import{_ as eo}from"./DeResourceCreateOptV2.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{R as to}from"./canvasUtils-0.0.0-dataease.js";import{a as oo,t as Ne}from"./treeSortUtils-0.0.0-dataease.js";import{E as ao}from"./index-0.0.0-dataease3.js";import{_ as no}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./index-0.0.0-dataease13.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./el-dialog-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./el-tree-select-0.0.0-dataease.js";import"./el-form-item-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./index-0.0.0-dataease19.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./antv-0.0.0-dataease.js";import"./index-0.0.0-dataease20.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./el-row-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./el-date-picker-0.0.0-dataease.js";import"./dayjs.min-0.0.0-dataease.js";import"./arrays-0.0.0-dataease.js";import"./index-0.0.0-dataease17.js";import"./el-switch-0.0.0-dataease.js";import"./de-copy-0.0.0-dataease.js";import"./icon_refresh_outlined-0.0.0-dataease.js";import"./icon_close_outlined-0.0.0-dataease.js";import"./icon_done_outlined-0.0.0-dataease.js";import"./ShareTicket-0.0.0-dataease.js";import"./el-table-column-0.0.0-dataease.js";import"./dv-info-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./index-0.0.0-dataease18.js";import"./GridTable-0.0.0-dataease.js";import"./el-pagination-0.0.0-dataease.js";import"./EmptyBackground-0.0.0-dataease.js";import"./el-empty-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./TicketEdit-0.0.0-dataease.js";import"./el-drawer-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import"./CustomLinkPwd-0.0.0-dataease.js";import"./TicketDialog-0.0.0-dataease.js";import"./datasource-0.0.0-dataease.js";import"./index-0.0.0-dataease21.js";import"./el-divider-0.0.0-dataease.js";import"./templateMarket-0.0.0-dataease.js";import"./MarketPreviewV2-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import"./el-collapse-item-0.0.0-dataease.js";import"./icon_left_outlined-0.0.0-dataease.js";import"./icon-filter-0.0.0-dataease.js";import"./TemplateMarketPreviewItem-0.0.0-dataease.js";import"./imgUtils-0.0.0-dataease.js";import"./index-0.0.0-dataease14.js";import"./CategoryTemplateV2-0.0.0-dataease.js";import"./TemplateMarketV2Item-0.0.0-dataease.js";import"./TemplateSkeleton-0.0.0-dataease.js";import"./base64-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";import"./snapshot-0.0.0-dataease.js";const ro={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function io(_,m){return p(),x("svg",ro,m[0]||(m[0]=[N("path",{d:"M3.33333 5.33398V13.334H10V5.33398H3.33333ZM11.3333 4.66732V14.0747C11.3333 14.402 11.0548 14.6673 10.7111 14.6673H2.62222C2.27858 14.6673 2 14.402 2 14.0747V4.59324C2 4.26596 2.27858 4.00065 2.62222 4.00065H10.6667C11.0349 4.00065 11.3333 4.29913 11.3333 4.66732ZM13.8047 1.52925C13.9254 1.64989 14 1.81656 14 2.00065V10.334C14 10.5181 13.8508 10.6673 13.6667 10.6673H13C12.8159 10.6673 12.6667 10.5181 12.6667 10.334V2.66732H6.33333C6.14924 2.66732 6 2.51808 6 2.33398V1.66732C6 1.48322 6.14924 1.33398 6.33333 1.33398H13.3333C13.5174 1.33398 13.6841 1.4086 13.8047 1.52925Z",fill:"#646A73"},null,-1)]))}const so={render:io},lo={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function co(_,m){return p(),x("svg",lo,m[0]||(m[0]=[N("path",{d:"M5.33301 2.66732V2.00065C5.33301 1.63246 5.63148 1.33398 5.99967 1.33398H9.99967C10.3679 1.33398 10.6663 1.63246 10.6663 2.00065V2.66732H14.239C14.3876 2.66732 14.4415 2.68279 14.4958 2.71184C14.5501 2.74089 14.5928 2.78352 14.6218 2.83784C14.6509 2.89216 14.6663 2.94605 14.6663 3.09463V3.57334C14.6663 3.72192 14.6509 3.7758 14.6218 3.83013C14.5928 3.88445 14.5501 3.92708 14.4958 3.95613C14.4415 3.98518 14.3876 4.00065 14.239 4.00065H13.333V14.0007C13.333 14.3688 13.0345 14.6673 12.6663 14.6673H3.33301C2.96482 14.6673 2.66634 14.3688 2.66634 14.0007V4.00065H1.76032C1.61174 4.00065 1.55785 3.98518 1.50353 3.95613C1.44921 3.92708 1.40658 3.88445 1.37753 3.83013C1.34848 3.7758 1.33301 3.72192 1.33301 3.57334V3.09463C1.33301 2.94605 1.34848 2.89216 1.37753 2.83784C1.40658 2.78352 1.44921 2.74089 1.50353 2.71184C1.55785 2.68279 1.61174 2.66732 1.76032 2.66732H5.33301ZM3.99967 4.00065V13.334H11.9997V4.00065H3.99967ZM6.33301 5.33398H6.99967C7.18377 5.33398 7.33301 5.48322 7.33301 5.66732V11.6673C7.33301 11.8514 7.18377 12.0007 6.99967 12.0007H6.33301C6.14891 12.0007 5.99967 11.8514 5.99967 11.6673V5.66732C5.99967 5.48322 6.14891 5.33398 6.33301 5.33398ZM8.99967 5.33398H9.66634C9.85044 5.33398 9.99967 5.48322 9.99967 5.66732V11.6673C9.99967 11.8514 9.85044 12.0007 9.66634 12.0007H8.99967C8.81558 12.0007 8.66634 11.8514 8.66634 11.6673V5.66732C8.66634 5.48322 8.81558 5.33398 8.99967 5.33398Z",fill:"#646A73"},null,-1)]))}const fe={render:co},uo={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function po(_,m){return p(),x("svg",uo,m[0]||(m[0]=[N("path",{d:"M14.0021 1.77734C14.3396 1.77734 14.6186 2.02815 14.6627 2.35355L14.6688 2.44401V13.5614C14.6688 13.8989 14.418 14.1779 14.0926 14.222L14.0021 14.2281H9.89167C9.73059 14.2281 9.59619 14.1138 9.56511 13.962L9.55834 13.8948V13.2281C9.55834 13.067 9.6726 12.9326 9.82449 12.9015L9.89167 12.8948H13.3355V3.11068H4.40563L4.40652 6.11325C4.40652 6.29735 4.25728 6.44659 4.07319 6.44659H3.40652C3.22243 6.44659 3.07319 6.29735 3.07319 6.11325V2.11068C3.07319 1.94959 3.18745 1.8152 3.33934 1.78412L3.40652 1.77734H14.0021ZM6.64113 7.59282C6.73925 7.59282 6.83418 7.6276 6.90908 7.69097L9.70393 10.0559C9.87882 10.2038 9.90063 10.4656 9.75265 10.6405C9.73779 10.658 9.72149 10.6743 9.70393 10.6892L6.90908 13.0541C6.73419 13.202 6.47245 13.1802 6.32447 13.0053C6.26109 12.9304 6.22632 12.8355 6.22632 12.7374L6.22681 11.1164L2.11165 11.1164C1.92756 11.1164 1.77832 10.9672 1.77832 10.7831V10.1164C1.77832 9.93231 1.92756 9.78307 2.11165 9.78307L6.22681 9.78305L6.22632 8.00764C6.22632 7.77854 6.41204 7.59282 6.64113 7.59282Z",fill:"#646A73"},null,-1)]))}const ve={render:po},mo=(_,m,U)=>{let V="",E="",C=0,M=[];const P=(d,o)=>{d.forEach((l,f)=>{var g;l.id===E&&(C=f,V=o),(g=l.children)!=null&&g.length&&P(l.children,l.id)})},h=(d,o)=>{d.forEach(l=>{var g;const f=o.findIndex(S=>S===l.id);f!==-1&&o.splice(f,1),(g=l.children)!=null&&g.length&&o.length===2&&h(l.children,o)})},z=(d,o,l)=>{d.forEach(f=>{var g;f.id===l.id&&(l.pid=o),(g=f.children)!=null&&g.length&&z(f.children,f.id,l)})},n=(d,o)=>{d.forEach(l=>{var f;l.id===V&&l.children.splice(C,0,o),(f=l.children)!=null&&f.length&&n(l.children,o)})},H=(d,o)=>{d.forEach((l,f)=>{var g;l.id===o.id&&d.splice(f,1),(g=l.children)!=null&&g.length&&H(l.children,o)})};return{handleDrop:async(d,o,l)=>{var g,S,F,R,$;const f={id:(g=d.data)==null?void 0:g.id,name:(S=d.data)==null?void 0:S.name,nodeType:(F=d.data)!=null&&F.leaf?"leaf":"folder",pid:"0",opt:"move",type:U};if(l!=="inner"){const O=[f.id,(R=o.data)==null?void 0:R.id];if(h(M,O),O.length===0){H(_[m],d.data),setTimeout(()=>{V==="0"?_[m].splice(C,0,d.data):n(_[m],d.data)},0);return}}try{await Et(f)}catch(O){console.error(O)}delete f.opt,l==="inner"?f.pid=($=o.data)==null?void 0:$.id:z(_[m],"0",f),Mt(f).then(()=>{_.originResourceTree=xe(_[m])}).catch(()=>{if(V==="0"){_[m].splice(C,0,d.data);return}n(_[m],d.data)})},allowDrop:(d,o)=>{var l;return!((l=o.data)!=null&&l.leaf)},handleDragStart:d=>{E=d.data.id,M=xe(_[m]),P(_[m],"0")}}},fo={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function vo(_,m){return p(),x("svg",fo,m[0]||(m[0]=[N("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M17.0855 1.00006H4C3.73478 1.00006 3.48043 1.10542 3.29289 1.29295C3.10536 1.48049 3 1.73484 3 2.00006V22.0001C3 22.2653 3.10536 22.5196 3.29289 22.7072C3.48043 22.8947 3.73478 23.0001 4 23.0001H20C20.2652 23.0001 20.5196 22.8947 20.7071 22.7072C20.8946 22.5196 21 22.2653 21 22.0001V4.91556C21.0001 4.65044 20.8949 4.39614 20.7075 4.20856L17.793 1.29306C17.7001 1.20014 17.5898 1.12643 17.4684 1.07616C17.347 1.02588 17.2169 1.00002 17.0855 1.00006ZM7 8.5C7 8.22386 7.22386 8 7.5 8H16.5C16.7761 8 17 8.22386 17 8.5V9.5C17 9.77614 16.7761 10 16.5 10H7.5C7.22386 10 7 9.77614 7 9.5V8.5ZM11 12.5C11 12.2239 11.2239 12 11.5 12H16.5C16.7761 12 17 12.2239 17 12.5V17.5C17 17.7761 16.7761 18 16.5 18H11.5C11.2239 18 11 17.7761 11 17.5V12.5ZM7 12.5C7 12.2239 7.22386 12 7.5 12H8.5C8.77614 12 9 12.2239 9 12.5V17.5C9 17.7761 8.77614 18 8.5 18H7.5C7.22386 18 7 17.7761 7 17.5V12.5Z",fill:"#FF8800"},null,-1)]))}const Ee={render:vo},_o=Re({__name:"DvHandleMore",props:{menuList:{type:Array},placement:{type:String,default:"bottom-end"},iconName:ee.string.def(""),inTable:ee.bool.def(!1),resourceType:ee.string.def("dashboard"),node:{type:Object,default(){return{}}},anyManage:ee.bool.def(!1)},emits:["handleCommand"],setup(_,{emit:m}){const U=Pe(),V=_,E=W(()=>U.getShareDisable||Yt()),C=T(null),M=T([...V.menuList.map(n=>(!V.anyManage&&(n.command==="copy"||n.command==="move")&&(n.hidden=!0),n))]),P=n=>{if(n==="share"){C.value.execute();return}z("handleCommand",n)},h=n=>{var H;E.value||V.node.leaf&&((H=V.node)==null?void 0:H.weight)>=7&&(M.value[0].divided=!0,M.value.splice(0,0,n))},z=m;return(n,H)=>{const G=L,J=Ie,B=ze,d=Me;return p(),x(X,null,[r(d,{"popper-class":"menu-more-dv_popper",placement:_.placement,trigger:"click",onCommand:P},{dropdown:i(()=>[r(B,null,{default:i(()=>[(p(!0),x(X,null,$e(M.value,o=>(p(),w(J,{divided:o.divided,command:o.command,key:o.label,disabled:o.disabled,class:ie({"de-hidden-drop-item":o.hidden})},{default:i(()=>[o.svgName?(p(),w(G,{key:0,class:"handle-icon",color:"#646a73",size:"16"},{default:i(()=>[r(a(D),null,{default:i(()=>[(p(),w(re(o.svgName),{class:"svg-icon"}))]),_:2},1024)]),_:2},1024)):I("",!0),ne(" "+q(o.label),1)]),_:2},1032,["divided","command","disabled","class"]))),128))]),_:1})]),default:i(()=>[r(G,{class:ie(["hover-icon",_.inTable&&"hover-icon-in-table"]),onClick:H[0]||(H[0]=Oe(()=>{},["stop"]))},{default:i(()=>[r(a(D),null,{default:i(()=>[(p(),w(re(_.iconName||a(Kt)),{class:"svg-icon"}))]),_:1})]),_:1},8,["class"])]),_:1},8,["placement"]),E.value?I("",!0):(p(),w(Xt,{key:0,ref_key:"shareComponent",ref:C,"resource-id":V.node.id,"resource-type":V.resourceType,weight:_.node.weight,onLoaded:h},null,8,["resource-id","resource-type","weight"]))],64)}}});const ho={class:"resource-tree"},Co={class:"tree-header"},go={class:"icon-methods"},wo={class:"title"},yo={key:0,class:"flex-align-center"},bo={key:0,class:"ed-dropdown-menu__item--divided"},To={class:"custom-tree-node"},Vo=["title"],Do={key:3,class:"icon-more"},So=Re({__name:"DeResourceTree",props:{curCanvasType:{type:String,required:!0},showPosition:{required:!1,type:String,default:"preview"}},emits:["nodeClick"],setup(_,{expose:m,emit:U}){const V=Pe(),E=Qt(),{wsCache:C}=mt(),M=Jt(),P=jt(),h=ft(),{dvInfo:z}=Tt(M),{t:n}=Ct(),H=_,G={children:"children",label:"name"},J=T(!1),B=T(!1),d=T(!1),{curCanvasType:o,showPosition:l}=Vt(H),f=o.value==="dataV"?n("work_branch.big_data_screen"):n("work_branch.dashboard"),g=o.value==="dataV"?n("visualization.new_screen"):n("visualization.new_dashboard"),S=T(null),F=T(null),R=T([]),$=T(),O=T(),_e=T(),se=T(!1),c=Dt({pWeightMap:{},curSortType:"time_desc",resourceTree:[],originResourceTree:[],folderMenuList:[{label:n("visualization.move_to"),command:"move",svgName:ve},{label:n("visualization.rename"),command:"rename",svgName:me},{label:n("visualization.delete"),command:"delete",svgName:fe,divided:!0}],sortType:[{label:n("visualization.time_asc"),value:"time_asc"},{label:n("visualization.time_desc"),value:"time_desc"},{label:n("visualization.name_asc"),value:"name_asc"},{label:n("visualization.name_desc"),value:"name_desc"}],templateCreatePid:0}),he=W(()=>o.value==="dashboard"?Le:Ot),Y=W(()=>P.getIsDataEaseBi||P.getIsIframe),Be=W(()=>[{label:n("work_branch.new_empty"),svgName:he.value,command:"newLeaf"},{label:n("work_branch.new_using_template"),svgName:Ee,command:"newFromTemplate"},{label:n("work_branch.new_folder"),divided:!0,svgName:He,command:"newFolder"}]),{handleDrop:Fe,allowDrop:We,handleDragStart:Ze}=mo(c,"resourceTree",o.value),Ae=e=>c.pWeightMap[e]<7?Ue:qe,qe=[{label:n("visualization.copy"),command:"copy",svgName:so},{label:n("visualization.move_to"),command:"move",svgName:ve},{label:n("visualization.rename"),command:"rename",svgName:me},{label:n("visualization.delete"),command:"delete",svgName:fe,divided:!0}],Ue=[{label:n("visualization.move_to"),command:"move",svgName:ve},{label:n("visualization.rename"),command:"rename",svgName:me},{label:n("visualization.delete"),command:"delete",svgName:fe,divided:!0}],Ge=C.get(o.value==="dashboard"?"db-info-id":"dv-info-id"),Je=ht.currentRoute.value.query.dvId,Ce=h.dvId||Ge||Je;C.delete(o.value==="dashboard"?"db-info-id":"dv-info-id"),Ce&&l.value==="preview"&&(S.value=Ce,se.value=!0);const je=e=>{e.id&&R.value.push(e.id)},Ke=e=>{e.id&&R.value.splice(R.value.indexOf(e.id),1)},Xe=(e,t)=>{var s;return e?(s=t.name)==null?void 0:s.toLocaleLowerCase().includes(e.toLocaleLowerCase()):!0},Ye=()=>{oe("/dataVisualization/findById"),oe("/chartData/getData"),oe("/linkage/getVisualizationAllLinkageInfo/**"),oe("/linkJump/queryVisualizationJumpInfo/**")},Qe=e=>{Ye(),S.value=e.id,e.leaf?ot("nodeClick",e):$.value.setCurrentKey(null)},le=async()=>{const e={busiFlag:o.value},t=o.value=="dashboard";await E.setInteractive(e);const s=t?E.getPanel:E.getScreen,u=s.treeNodes;B.value=s.rootManage,d.value=s.anyManage,z.value&&z.value.id&&!JSON.stringify(u).includes(z.value.id)&&l.value!=="multiplexing"&&M.resetDvInfo();let v=ce[Number(C.get("TreeSort-backend"))??1].value;if(v=C.get(`TreeSort-${o.value}`)??v,u.length&&u[0].id==="0"&&u[0].name==="root"){c.originResourceTree=u[0].children||[],Ve(v),we();return}c.originResourceTree=u,Ve(v),we()},et=W(()=>ae.filter(ge(c.resourceTree),e=>e.leaf)),tt=W(()=>et.value.length>0);function ge(e){let t=ae.cloneDeep(e);return ae.forEach(e,s=>{s.children&&s.children.length>0&&(t=ae.union(t,ge(s.children)))}),t}const we=()=>{c.pWeightMap=oo(c.originResourceTree,B.value?9:0),J.value=!0,S.value&&se.value&&(R.value=st(),se.value=!1),ke(()=>{$.value.setCurrentKey(S.value),ke(()=>{if(S.value){const e=document.querySelector(".is-current");e&&e.click()}}),$.value.filter(F.value)})},de=T(!1),Z=C.get("open-backend")==="1"?"_self":"_blank",ot=U,at=(e,t,s)=>{if(e==="delete"){const u=t.leaf?"":n("visualization.delete_tips"),v=t.leaf?f:n("visualization.folder");bt.confirm(n("visualization.delete_warn",[v]),{confirmButtonType:"danger",type:"warning",tip:u,autofocus:!1,showClose:!1}).then(()=>{zt(t.id,o.value).then(()=>{De.success(n("visualization.delete_success")),le()})})}else if(e==="edit")ye(t.id);else if(e==="copy"){const u=to(c.resourceTree,t.id),v={nodeType:s,name:t.name+"-copy",type:o.value,id:t.id,pid:u||"0"};de.value=!0,Rt(v).then(y=>{const ue=o.value==="dataV"?`#/dvCanvas?opt=copy&pid=${v.pid}&dvId=${y.data}`:`#/dashboard?opt=copy&pid=${v.pid}&resourceId=${y.data}`;if(Y.value){h.clearState(),h.setPid(v.pid),h.setOpt("copy"),o.value==="dataV"?h.setDvId(y.data):h.setResourceId(y.data),te().emitter.emit("changeCurrentComponent",o.value==="dataV"?"VisualizationEditor":"DashboardEditor");return}const pe=window.open(ue,Z);Q(pe)}).finally(()=>{de.value=!1})}else O.value.optInit(s,t,e,["copy"].includes(e))},A=(e,t,s,u)=>{if(e==="newLeaf"){const v=o.value==="dataV"?"#/dvCanvas?opt=create":"#/dashboard?opt=create";let y=null;if(Y.value){h.clearState(),h.setOpt("create"),t!=null&&t.id&&h.setPid(t==null?void 0:t.id),te().emitter.emit("changeCurrentComponent",o.value==="dataV"?"VisualizationEditor":"DashboardEditor");return}t!=null&&t.id?y=window.open(v+`&pid=${t.id}`,Z):y=window.open(v,Z),Q(y)}else if(e==="newFromTemplate"){const v={curPosition:"create",pid:t==null?void 0:t.id,templateType:o.value==="dataV"?"SCREEN":"PANEL"};_e.value.optInit(v)}else O.value.optInit(s,t||{},e,u)};function nt(){return A("newLeaf",null,"leaf",!0)}const ye=e=>{const t=o.value==="dataV"?"#/dvCanvas?dvId=":"#/dashboard?resourceId=";if(Y.value){h.clearState(),o.value==="dataV"?h.setDvId(e):h.setResourceId(e),te().emitter.emit("changeCurrentComponent",o.value==="dataV"?"VisualizationEditor":"DashboardEditor");return}const s=window.open(t+e,Z);Q(s)},rt=()=>{le()},it=e=>{C.set("de-template-data",JSON.stringify(e));const t=o.value==="dataV"?"#/dvCanvas?opt=create&createType=template":"#/dashboard?opt=create&createType=template";let s=null;if(Y.value){h.clearState(),h.setOpt("create"),h.setCreateType("template"),c.templateCreatePid&&h.setPid(c.templateCreatePid),te().emitter.emit("changeCurrentComponent",o.value==="dataV"?"VisualizationEditor":"DashboardEditor");return}c.templateCreatePid?s=window.open(t+`&pid=${c.templateCreatePid}`,Z):s=window.open(t,Z),Q(s)},be=(e,t,s=[])=>{for(const u of e){if(u.id===t)return s;if(u.children){const v=[...s,u.id],y=be(u.children,t,v);if(y)return y}}return null},st=()=>{const e=be(c.resourceTree,S.value);return e?[S.value,...e]:[]},ce=[{name:n("visualization.time_asc"),value:"time_asc"},{name:n("visualization.time_desc"),value:"time_desc",divided:!0},{name:n("visualization.name_asc"),value:"name_asc"},{name:n("visualization.name_desc"),value:"name_desc"}],Te=W(()=>ce.find(e=>e.value===c.curSortType).name),lt=e=>{c.resourceTree=Ne(c.originResourceTree,e),c.curSortType=e,C.set("TreeSort-"+o.value,c.curSortType)},Ve=e=>{c.resourceTree=Ne(c.originResourceTree,e),c.curSortType=e},dt=$t((e,t)=>{const u=["dashboard","dataV","dataset","datasource"].findIndex(v=>v===o.value);return u<0||!wt(t,u+1)?We(e,t):(De.warning(n("free.save_error")),!1)},300);St(F,e=>{$.value.filter(e)});const j=T(null),Q=e=>{if(j!=null&&j.value){const t={methodName:"initOpenHandler",args:e};j.value.invokeMethod(t)}},ct=()=>{const e=C.get("TreeSort-"+o.value);e&&(c.curSortType=e)},ut=()=>{It().then(e=>{var s,u;const t={shareDisable:(s=e.data)==null?void 0:s.disable,sharePeRequire:(u=e.data)==null?void 0:u.peRequire};V.setData(t)})};return kt(()=>{ct(),le(),ut()}),m({rootManage:B,hasData:tt,createNewObject:nt,mounted:J}),(e,t)=>{const s=ao,u=Ie,v=ze,y=Me,ue=gt,pe=_t,pt=xt("loading");return p(),x(X,null,[N("div",ho,[N("div",Co,[Se(N("div",go,[N("span",wo,q(a(f)),1),B.value?(p(),x("div",yo,[r(s,{content:a(n)("work_branch.new_folder"),placement:"top",effect:"dark"},{default:i(()=>[r(a(L),{class:"custom-icon btn",style:{"margin-right":"20px"},onClick:t[0]||(t[0]=b=>A("newFolder",null,"folder"))},{default:i(()=>[r(a(D),{name:"dv-new-folder"},{default:i(()=>[r(a(Pt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"]),r(s,{content:a(g),placement:"top",effect:"dark"},{default:i(()=>[r(y,{"popper-class":"menu-outer-dv_popper",trigger:"hover"},{dropdown:i(()=>[r(v,null,{default:i(()=>[r(u,{onClick:t[2]||(t[2]=b=>A("newLeaf",null,"leaf",!0))},{default:i(()=>[r(a(L),{class:ie(`handle-icon color-${a(o)}`)},{default:i(()=>[r(a(D),null,{default:i(()=>[(p(),w(re(he.value),{class:"svg-icon"}))]),_:1})]),_:1},8,["class"]),ne(" "+q(a(n)("work_branch.new_empty")),1)]),_:1}),r(u,{onClick:t[3]||(t[3]=b=>A("newFromTemplate",null,"leaf",!0))},{default:i(()=>[r(a(L),{class:"handle-icon"},{default:i(()=>[r(a(D),{name:"dv-use-template"},{default:i(()=>[r(a(Ee),{class:"svg-icon"})]),_:1})]),_:1}),ne(" "+q(a(n)("work_branch.new_using_template")),1)]),_:1})]),_:1})]),default:i(()=>[r(a(L),{class:"custom-icon btn",onClick:t[1]||(t[1]=b=>A("newLeaf",null,"leaf",!0))},{default:i(()=>[r(a(D),{name:"icon_file-add_outlined"},{default:i(()=>[r(a(Bt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),_:1},8,["content"])])):I("",!0)],512),[[Lt,a(l)==="preview"]]),r(ue,{placeholder:a(n)("commons.search"),modelValue:F.value,"onUpdate:modelValue":t[4]||(t[4]=b=>F.value=b),clearable:"",class:"search-bar"},{prefix:i(()=>[r(a(L),null,{default:i(()=>[r(a(D),{name:"icon_search-outline_outlined"},{default:i(()=>[r(a(Ft),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["placeholder","modelValue"]),r(y,{onCommand:lt,trigger:"click"},{dropdown:i(()=>[r(v,{style:{width:"246px"}},{default:i(()=>[(p(),x(X,null,$e(ce,b=>(p(),x(X,{key:b.value},[r(u,{class:ie(["ed-select-dropdown__item",b.value===c.curSortType&&"selected"]),command:b.value},{default:i(()=>[ne(q(b.name),1)]),_:2},1032,["class","command"]),b.divided?(p(),x("li",bo)):I("",!0)],64))),64))]),_:1})]),default:i(()=>[r(a(L),{class:"filter-icon-span"},{default:i(()=>[r(s,{offset:16,effect:"dark",content:Te.value,placement:"top"},{default:i(()=>[c.curSortType.includes("asc")?(p(),w(a(D),{key:0,name:"dv-sort-asc",class:"opt-icon"},{default:i(()=>[r(a(Wt),{class:"svg-icon opt-icon"})]),_:1})):I("",!0)]),_:1},8,["content"]),r(s,{offset:16,effect:"dark",content:Te.value,placement:"top"},{default:i(()=>[c.curSortType.includes("desc")?(p(),w(a(D),{key:0,name:"dv-sort-desc",class:"opt-icon"},{default:i(()=>[r(a(Zt),{class:"svg-icon opt-icon"})]),_:1})):I("",!0)]),_:1},8,["content"])]),_:1})]),_:1})]),Se((p(),w(a(vt),{class:"custom-tree"},{default:i(()=>[r(pe,{menu:"",ref_key:"resourceListTree",ref:$,"default-expanded-keys":R.value,data:c.resourceTree,props:G,"node-key":"id","highlight-current":"","expand-on-click-node":!0,"filter-node-method":Xe,onNodeExpand:je,onNodeCollapse:Ke,onNodeClick:Qe,onNodeDragStart:a(Ze),"allow-drop":a(dt),onNodeDrop:a(Fe),draggable:""},{default:i(({node:b,data:k})=>[N("span",To,[k.leaf?a(o)==="dashboard"?(p(),w(a(L),{key:1,style:{"font-size":"18px"}},{default:i(()=>[r(a(D),null,{default:i(()=>[(p(),w(re(k.extraFlag?a(Ht):a(Le))))]),_:2},1024)]),_:2},1024)):(p(),w(a(L),{key:2,class:"icon-screen-new color-dataV",style:{"font-size":"18px"}},{default:i(()=>[r(a(D),{name:"icon_operation-analysis_outlined"},{default:i(()=>[r(a(At),{class:"svg-icon"})]),_:1})]),_:1})):(p(),w(a(L),{key:0,style:{"font-size":"18px"}},{default:i(()=>[r(a(D),{name:"dv-folder"},{default:i(()=>[r(a(He),{class:"svg-icon"})]),_:1})]),_:1})),N("span",{title:b.label,class:"label-tooltip"},q(b.label),9,Vo),k.weight>=7&&a(l)==="preview"?(p(),x("div",Do,[k.leaf?(p(),w(a(L),{key:0,onClick:[t[5]||(t[5]=Oe(()=>{},["stop"])),K=>ye(k.id)],class:"hover-icon"},{default:i(()=>[r(a(D),null,{default:i(()=>[r(a(qt),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])):I("",!0),k.leaf?I("",!0):(p(),w(a(Ut),{key:1,onHandleCommand:K=>A(K,k,K==="newFolder"?"folder":"leaf"),"menu-list":Be.value,"icon-name":a(Nt),placement:"bottom-start"},null,8,["onHandleCommand","menu-list","icon-name"])),r(_o,{onHandleCommand:K=>at(K,k,k.leaf?"leaf":"folder"),node:k,"any-manage":d.value,"resource-type":a(o),"menu-list":k.leaf?Ae(k.id):c.folderMenuList},null,8,["onHandleCommand","node","any-manage","resource-type","menu-list"])])):I("",!0)])]),_:1},8,["default-expanded-keys","data","onNodeDragStart","allow-drop","onNodeDrop"]),r(Gt,{"cur-canvas-type":a(o),onFinish:rt,ref_key:"resourceGroupOpt",ref:O},null,8,["cur-canvas-type"]),r(eo,{"cur-canvas-type":a(o),ref_key:"resourceCreateOpt",ref:_e,onFinish:it},null,8,["cur-canvas-type"])]),_:1})),[[pt,de.value]])]),r(a(yt),{ref_key:"openHandler",ref:j,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)],64)}}});const Rn=no(So,[["__scopeId","data-v-5d9d5d01"]]);export{Rn as default};

import{j as ve,l as fe,K as Te,h as be}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{p as ye,d as we,h as ke,g as Se,o as ge,r as Ce,x as xe,y as Fe,t as Me}from"./element-plus-secondary-0.0.0-dataease.js";import{d as Pe,r as B,k,l as Ee,w as M,b as Ie,n as C,ah as Z,ak as Ae,o as n,c as b,W as v,X as f,Z as d,_ as o,a0 as l,a as _,a2 as T,a4 as P,u as c,Y as x,M as y,ab as E,z as Ve}from"./@vue-0.0.0-dataease.js";import{n as Ue,a as Ne}from"./templateMarket-0.0.0-dataease.js";import{a as Oe,b as Re,u as Le}from"./index-0.0.0-dataease.js";import{useAppStoreWithOut as We}from"./app-0.0.0-dataease.js";import{e as ze}from"./element-resize-detector-0.0.0-dataease.js";import De from"./MarketPreviewV2-0.0.0-dataease.js";import{i as $}from"./imgUtils-0.0.0-dataease.js";import J from"./CategoryTemplateV2-0.0.0-dataease.js";import Be from"./TemplateSkeleton-0.0.0-dataease.js";import{i as Ze}from"./interactive-0.0.0-dataease.js";import{g as q}from"./js-base64-0.0.0-dataease.js";import{_ as $e}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./icon_left_outlined-0.0.0-dataease.js";import"./icon-filter-0.0.0-dataease.js";import"./TemplateMarketPreviewItem-0.0.0-dataease.js";import"./html2canvas-0.0.0-dataease.js";import"./dvMain-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./@antv-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./@turf-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./mathjs-0.0.0-dataease.js";import"./decimal.js-0.0.0-dataease.js";import"./typed-function-0.0.0-dataease.js";import"./complex.js-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./exceljs-0.0.0-dataease.js";import"./file-saver-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./html-to-image-0.0.0-dataease.js";import"./TemplateMarketV2Item-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./datasource-0.0.0-dataease.js";const Je=["src"],qe={class:"template-left"},He=["title"],Xe={id:"template-show-area",class:"template-right"},je={style:{"text-align":"center"}},Ge=Pe({__name:"index",emits:["close"],setup(Ke,{expose:H,emit:X}){const{t:i}=ve(),{wsCache:I}=Oe(),S=Re(),R=We(),j=Ze(),h=B("full"),G=X,L=()=>{G("close")},K=k(()=>e.curPosition==="branch"?i("work_branch.template_center"):i("work_branch.new_using_template")),Y=k(()=>R.getIsDataEaseBi||R.getIsIframe),e=Ee({initReady:!0,curPosition:"branch",pid:null,treeProps:{value:"label",label:"label"},templateType:"all",templateSourceType:"all",templateClassifyType:"all",treeShow:!0,templateClassifyOptions:[{value:"all",label:i("visualization.all_type")},{value:"app",label:i("visualization.apply_template")},{value:"template",label:i("visualization.style_template")}],templateSourceOptions:[{value:"all",label:i("work_branch.all_source")},{value:"market",label:i("visualization.template_market")},{value:"manage",label:i("template_manage.name")}],templateTypeOptions:[{value:"all",label:i("work_branch.all_types")},{value:"PANEL",label:i("work_branch.dashboard")},{value:"SCREEN",label:i("work_branch.big_data_screen")}],loading:!1,hasResult:!0,templateMiniWidth:250,templateCurWidth:310,templateSpan:"25%",previewVisible:!1,templatePreviewId:"",marketTabs:[],marketActiveTab:null,searchText:null,dvCreateForm:{resourceName:null,name:null,pid:null,nodeType:"panel",templateUrl:null,newFrom:"new_market_template",templateId:null,panelType:"self",panelStyle:{},panelData:"[]"},panelGroupList:[],curApplyTemplate:null,folderSelectShow:!1,baseUrl:"https://dataease.io/templates",currentMarketTemplateShowList:[],curTemplateShowFilter:[],curTemplateIndex:0,curTemplate:null,networkStatus:!0,rule:{name:[{required:!0,message:i("visualization.template_name_tips"),trigger:"blur"}],pid:[{required:!0,message:"",trigger:"blur"}]}}),A=k(()=>{var t,p,s,u;const a=j.getData;return{PANEL:((t=a[0])==null?void 0:t.menuAuth)&&((p=a[0])==null?void 0:p.anyManage),SCREEN:((s=a[1])==null?void 0:s.menuAuth)&&((u=a[1])==null?void 0:u.anyManage)}}),W=k(()=>{let a;return e.templateSourceType==="all"?a=e.marketTabs:a=e.marketTabs.filter(t=>t.source==="public"||t.source===e.templateSourceType),a}),Q=k(()=>e.curTemplate.thumbnail.indexOf("http")>-1||e.curTemplate.thumbnail.indexOf("static-resource")>-1?$(e.curTemplate.thumbnail):$(e.baseUrl+e.curTemplate.thumbnail)),ee=k(()=>e.curPosition==="branch"&&h.value!=="marketPreview"),te=a=>{e.initReady=!1,e.curPosition=a.curPosition,e.templateType=a.templateType,h.value="full",e.pid=a.pid,C(()=>{e.initReady=!0})};M(()=>e.searchText,()=>{w()}),M(()=>e.templateType,()=>{w()}),M(()=>e.templateSourceType,()=>{e.treeShow=!1,w(),C(()=>{e.treeShow=!0,V()})}),M(()=>e.templateClassifyType,()=>{e.treeShow=!1,w(),C(()=>{e.treeShow=!0,V()})});const ae=a=>{e.marketActiveTab=a.label,w()},le=()=>{h.value="full"},re=async()=>{await Ne().then(a=>{e.baseUrl=a.data.baseUrl,e.currentMarketTemplateShowList=a.data.contents,V(),w();const t=Te(e.currentMarketTemplateShowList);e.marketTabs=a.data.categories.filter(p=>t.has(p.label)),e.marketActiveTab=e.marketTabs[1].label}).catch(()=>{e.networkStatus=!1})},V=()=>{C(()=>{const a=document.querySelector(".custom-market-tree"),t=document.createElement("hr");t.classList.add("custom-line"),a.firstElementChild.appendChild(t)})},oe=()=>{e.curTemplateIndex>0&&(e.curTemplateIndex--,e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex])},ie=()=>{e.curTemplateIndex<e.curTemplateShowFilter.length-1&&(e.curTemplateIndex++,e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex])},F=a=>{e.curApplyTemplate=a,e.dvCreateForm.name=a.title,e.dvCreateForm.nodeType=a.templateType,a.source==="market"?(e.dvCreateForm.newFrom="new_market_template",e.dvCreateForm.templateUrl=a.metas.theme_repo,e.dvCreateForm.resourceName=a.id):(e.dvCreateForm.newFrom="new_inner_template",e.dvCreateForm.templateId=a.id),pe()},pe=a=>{if(e.dvCreateForm.newFrom==="new_market_template"&&!e.dvCreateForm.templateUrl)return ye.warning(i("template_manage.get_download_link_hint")),!1;const t={newFrom:e.dvCreateForm.newFrom,templateUrl:e.dvCreateForm.templateUrl,resourceName:e.dvCreateForm.resourceName,templateId:e.dvCreateForm.templateId};e.curApplyTemplate.recentUseTime=Date.now(),e.curApplyTemplate.categoryNames.push(i("work_branch.recent"));const p=(["dataV","SCREEN"].includes(e.dvCreateForm.nodeType)?"#/dvCanvas?opt=create&createType=template":"#/dashboard?opt=create&createType=template")+"&templateParams="+encodeURIComponent(q.encode(JSON.stringify(t)));let s=null;if(Y.value){S.clearState(),S.setCreateType("template"),S.setTemplateParams(encodeURIComponent(q.encode(JSON.stringify(t)))),S.setOpt("create"),e.pid&&S.setPid(e.pid),Le().emitter.emit("changeCurrentComponent",["dataV","SCREEN"].includes(e.dvCreateForm.nodeType)?"VisualizationEditor":"DashboardEditor");return}const u=I.get("open-backend")==="1"?"_self":"_blank";e.pid?s=window.open(p+`&pid=${e.pid}`,u):s=window.open(p,u),ne(s)},g=B(null),ne=a=>{if(g!=null&&g.value){const t={methodName:"initOpenHandler",args:a};g.value.invokeMethod(t)}},w=()=>{let a=!1;e.currentMarketTemplateShowList.forEach(t=>{t.showFlag=me(t),t.showFlag&&(a=!0)}),e.currentMarketTemplateShowList.length>0&&(e.hasResult=a)},me=a=>{let t=!1,p=!1,s=!1,u=!1;return(!e.searchText||a.title.indexOf(e.searchText)>-1)&&(t=!0),(e.templateType==="all"||a.templateType===e.templateType)&&(p=!0),(e.templateSourceType==="all"||a.source===e.templateSourceType)&&(s=!0),(e.templateClassifyType==="all"||a.classify===e.templateClassifyType)&&(u=!0),t&&p&&s&&u},U=a=>{e.curPosition==="branch"?(e.templatePreviewId=a,h.value="marketPreview"):(e.curTemplateShowFilter=e.marketActiveTab===i("work_branch.recommend")?e.currentMarketTemplateShowList.filter(t=>t.showFlag):e.currentMarketTemplateShowList.filter(t=>{var p;return t.showFlag&&((p=t.categoryNames)==null?void 0:p.includes(e.marketActiveTab))}),e.curTemplateIndex=e.curTemplateShowFilter.findIndex(t=>t.id===a),e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex],h.value="createPreview")};Ie(()=>{se(),re();const a=ze(),t=document.getElementById("template-show-area");t&&a.listenTo(t,()=>{C(()=>{const p=t.offsetWidth-26,s=Math.trunc(p/e.templateMiniWidth);e.templateSpan=100/Math.trunc(p/e.templateMiniWidth)+"%",e.templateCurWidth=Math.trunc(p/s)-33})})});const se=()=>{const a=I.get("template-preview-id");a&&(U(a),I.delete("template-preview-id"))};return H({optInit:te}),(a,t)=>{const p=Z("ArrowLeft"),s=we,u=ke,z=Se,D=Z("Close"),m=ge,ue=Ce,N=xe,O=Fe,ce=Me,de=be,he=Ae("loading");return n(),b(y,null,[v((n(),d(m,{class:Ve(["template-outer-body",{"template-outer-body-padding":ee.value}])},{default:o(()=>[v(l(De,{"preview-id":e.templatePreviewId,"create-auth":A.value,onClosePreview:le,onTemplateApply:F},null,8,["preview-id","create-auth"]),[[f,h.value==="marketPreview"]]),h.value==="createPreview"?(n(),d(m,{key:0,class:"main-container"},{default:o(()=>[l(m,{class:"market-head"},{default:o(()=>[l(s,{class:"custom-back-icon hover-icon",onClick:t[0]||(t[0]=r=>h.value="full")},{default:o(()=>[l(p)]),_:1}),_("span",null,T(e.curTemplate.title),1),l(m,{class:"head-right"},{default:o(()=>[l(u,{secondary:"",disabled:e.curTemplateIndex===0,style:{float:"right"},onClick:oe},{default:o(()=>[P(T(c(i)("work_branch.last")),1)]),_:1},8,["disabled"]),l(u,{disabled:e.curTemplateIndex===e.curTemplateShowFilter.length-1,style:{float:"right"},secondary:"",onClick:ie},{default:o(()=>[P(T(c(i)("work_branch.next")),1)]),_:1},8,["disabled"]),l(u,{style:{float:"right"},type:"primary",onClick:t[1]||(t[1]=r=>F(e.curTemplate))},{default:o(()=>[P(T(c(i)("visualization.apply_this_template")),1)]),_:1}),l(z,{class:"custom-divider-line",direction:"vertical"}),l(s,{class:"custom-market-icon hover-icon_custom",onClick:L},{default:o(()=>[l(D)]),_:1})]),_:1})]),_:1}),l(m,{class:"template-area"},{default:o(()=>[l(m,{class:"img-main-create"},{default:o(()=>[_("img",{style:{height:"100%"},src:Q.value,alt:""},null,8,Je)]),_:1})]),_:1})]),_:1})):x("",!0),v(l(m,{class:"main-container"},{default:o(()=>[l(m,{class:"market-head"},{default:o(()=>[_("span",null,T(K.value),1),l(m,{class:"head-right"},{default:o(()=>[l(ue,{class:"title-search",modelValue:e.searchText,"onUpdate:modelValue":t[2]||(t[2]=r=>e.searchText=r),"prefix-icon":"Search",placeholder:c(i)("visualization.enter_template_name_tips"),clearable:!0},null,8,["modelValue","placeholder"]),l(O,{class:"title-type",modelValue:e.templateSourceType,"onUpdate:modelValue":t[3]||(t[3]=r=>e.templateSourceType=r),placeholder:"Select"},{default:o(()=>[(n(!0),b(y,null,E(e.templateSourceOptions,r=>(n(),d(N,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),["branchCreate","branch"].includes(e.curPosition)?(n(),d(O,{key:0,class:"title-type",modelValue:e.templateType,"onUpdate:modelValue":t[4]||(t[4]=r=>e.templateType=r),placeholder:"Select"},{default:o(()=>[(n(!0),b(y,null,E(e.templateTypeOptions,r=>(n(),d(N,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):x("",!0),l(O,{class:"title-type",modelValue:e.templateClassifyType,"onUpdate:modelValue":t[5]||(t[5]=r=>e.templateClassifyType=r),placeholder:"Select"},{default:o(()=>[(n(!0),b(y,null,E(e.templateClassifyOptions,r=>(n(),d(N,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),["branchCreate","create"].includes(e.curPosition)?(n(),b(y,{key:1},[l(z,{class:"custom-divider-line",direction:"vertical"}),l(s,{class:"custom-market-icon hover-icon_custom",onClick:L},{default:o(()=>[l(D)]),_:1})],64)):x("",!0)]),_:1})]),_:1}),l(m,{class:"template-area"},{default:o(()=>[_("div",qe,[e.treeShow?(n(),d(ce,{key:0,menu:"",class:"custom-market-tree",modelValue:e.marketActiveTab,"onUpdate:modelValue":t[6]||(t[6]=r=>e.marketActiveTab=r),data:W.value,props:e.treeProps,"node-key":"label","default-expand-all":"","highlight-current":"","current-node-key":e.marketActiveTab,onNodeClick:ae},{default:o(({data:r})=>[_("span",{title:r.label,class:"ed-tree-node__label"},T(r.label),9,He)]),_:1},8,["modelValue","data","props","current-node-key"])):x("",!0)]),v(_("div",Xe,[e.marketActiveTab===null?(n(),d(m,{key:0},{default:o(()=>[l(Be,{width:e.templateCurWidth},null,8,["width"])]),_:1})):(n(),b(y,{key:1},[v(l(m,null,{default:o(()=>[l(J,{"search-text":e.searchText,label:e.marketActiveTab,"full-template-show-list":e.currentMarketTemplateShowList,"template-span":e.templateSpan,"base-url":e.baseUrl,"template-cur-width":e.templateCurWidth,"cur-position":e.curPosition,"create-auth":A.value,onTemplateApply:F,onTemplatePreview:U},null,8,["search-text","label","full-template-show-list","template-span","base-url","template-cur-width","cur-position","create-auth"])]),_:1},512),[[f,e.marketActiveTab!==c(i)("work_branch.recommend")]]),v(l(m,null,{default:o(()=>[(n(!0),b(y,null,E(W.value,(r,_e)=>(n(),d(m,{style:{display:"inline",width:"100%","margin-bottom":"32px"},key:_e},{default:o(()=>[r.label!==c(i)("work_branch.recent")?(n(),d(J,{key:0,"search-text":e.searchText,label:r.label,"full-template-show-list":e.currentMarketTemplateShowList,"template-span":e.templateSpan,"base-url":e.baseUrl,"template-cur-width":e.templateCurWidth,"cur-position":e.curPosition,"create-auth":A.value,onTemplateApply:F,onTemplatePreview:U},null,8,["search-text","label","full-template-show-list","template-span","base-url","template-cur-width","cur-position","create-auth"])):x("",!0)]),_:2},1024))),128))]),_:1},512),[[f,e.marketActiveTab===c(i)("work_branch.recommend")]])],64))],512),[[f,e.networkStatus&&e.hasResult]]),v(l(m,{class:"template-empty"},{default:o(()=>[_("div",je,[l(de,{name:"no_result"},{default:o(()=>[l(c(Ue),{style:{"margin-bottom":"16px","font-size":"75px"},class:"svg-icon"})]),_:1}),t[7]||(t[7]=_("br",null,null,-1)),_("span",null,T(c(i)("work_branch.relevant_templates_found")),1)])]),_:1},512),[[f,e.networkStatus&&!e.hasResult]]),v(l(m,{class:"template-empty"},{default:o(()=>[P(T(c(i)("visualization.market_network_tips")),1)]),_:1},512),[[f,!e.networkStatus]])]),_:1})]),_:1},512),[[f,h.value==="full"]])]),_:1},8,["class"])),[[he,e.loading],[f,e.initReady]]),l(c(fe),{ref_key:"openHandler",ref:g,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)],64)}}});const Sl=$e(Ge,[["__scopeId","data-v-6e2af3d6"]]);export{Sl as default};

import{u as E}from"./index-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import"./el-aside-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import{a as _e,u as he,o as ye,n as ge,D as ke,j as Se,y as Ce}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as De,G as v,r as i,Z as Pe,ah as Ie,t as Ae,o as xe,n as b,ak as Ee,e as W,aa as be,f as s,L as j,M as G,g as l,V as B,j as t,a0 as u,k as _,i as d,U as T,T as H,Y as U,W as Be,a5 as Te,a6 as $}from"./vue-0.0.0-dataease.js";import{i as Ne}from"./icon_add_outlined-0.0.0-dataease.js";import Me from"./DeResourceTree-0.0.0-dataease.js";import{d as Re}from"./dvMain-0.0.0-dataease.js";import{k as Ve}from"./DePreview-0.0.0-dataease.js";import{_ as Oe}from"./PreviewHead.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{E as Y}from"./EmptyBackground-0.0.0-dataease.js";import Z from"./DeResourceArrow-0.0.0-dataease.js";import{P as Le,i as Fe,o as qe}from"./canvasUtils-0.0.0-dataease.js";import{useAppStoreWithOut as ze}from"./app-0.0.0-dataease.js";import{u as We}from"./useMoveLine-0.0.0-dataease.js";import{a as je,c as Ge}from"./imgUtils-0.0.0-dataease.js";import{A as He}from"./AppExportForm-0.0.0-dataease.js";import{a as Ue,c as $e}from"./index-0.0.0-dataease14.js";const Ye={class:"dv-preview dv-teleport-query"},fa=De({__name:"DashboardPreviewShow",props:{showPosition:{required:!1,type:String,default:"preview"},noClose:{required:!1,type:Boolean,default:!1}},setup(S,{expose:J}){const K=_e(),Q=v(()=>K.getName),N=i(null),h=Re(),C=i(null),M=i(null),y=i(!0);he();const D=ze(),g=i(!0),m=i(!1),a=Pe({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,curPreviewGap:0}),{fullscreenFlag:X,canvasViewDataInfo:R}=Ie(h),{width:P,node:ee}=We("DASHBOARD"),{t:f}=ye(),ae=S,{showPosition:c}=Ae(ae),w=i(),V=v(()=>{var e;return(e=w.value)==null?void 0:e.hasData}),oe=v(()=>D.getIsDataEaseBi),te=v(()=>{var e;return(e=w.value)==null?void 0:e.rootManage}),O=v(()=>{var e;return(e=w.value)==null?void 0:e.mounted});xe(()=>{E({name:"canvasDownload",callback:function(){F("img")}})});function ne(){var e;(e=w.value)==null||e.createNewObject()}const L=(e,r)=>{const o=c.value==="multiplexing"?Le:Fe;g.value=!1,o(e,"dashboard",function({canvasDataResult:n,canvasStyleResult:k,dvInfo:I,canvasViewInfoPreview:A,curPreviewGap:x}){I.weight=r,a.canvasDataPreview=n,a.canvasStylePreview=k,a.canvasViewInfoPreview=A,a.dvInfo=I,a.curPreviewGap=x,g.value=!0,b(()=>{M.value.restore(),qe({resourceId:e})})})},se=["bubble-map","flow-map","heat-map","map","symbolic-map"],F=e=>{var o;m.value=!0;const r=((o=a.canvasDataPreview)==null?void 0:o.filter(n=>se.includes(n.innerType)).map(n=>n.id))||[];r.forEach(n=>E().emitter.emit("l7-prepare-picture",n)),b(()=>{const n=C.value.querySelector(".canvas-container");je(e,n,a.dvInfo.name,()=>{m.value=!1,r.forEach(k=>E().emitter.emit("l7-unprepare-picture",k))})})},re=e=>{e==="template"?q(e,null):e==="app"&&ie()},ie=()=>{const e=le();e&&e.length>0?ke.warning(f("visualization.export_tips",[e])):N.value.init({appName:a.dvInfo.name,icon:null,version:"2.0",creator:Q.value,required:"2.9.0",description:null})},le=()=>{let e=",";return Object.keys(R.value).forEach(r=>{const o=R.value[r];o&&(o==null?void 0:o.dataFrom)==="template"&&(e=e+o.title+",")}),e.slice(1)},q=(e,r)=>{m.value=!0,b(()=>{const o=C.value.querySelector(".canvas-container");Ge(e,o,a.dvInfo.name,r,()=>{m.value=!1})})},Ze=()=>{y.value=!y.value},ce=()=>a,ue=e=>{L(e,a.dvInfo.weight)},pe=e=>{L(e.id,e.weight),c.value==="multiplexing"&&h.initCurMultiplexingComponents()},ve=v(()=>{var e;return!!((e=h.dvInfo)!=null&&e.name)});Ee(()=>{c.value==="preview"&&h.canvasDataInit()});const p=i(!0),z=e=>{p.value=e},de=()=>{D.setArrowSide(!0)},me=()=>{D.setArrowSide(!1)},fe=e=>{q("app",e)};return J({getPreviewStateInfo:ce}),(e,r)=>{const o=Ue,n=W("ArrowLeft"),k=Se,I=W("ArrowRight"),A=Ce,x=$e,we=be("loading");return s(),j(U,null,[G("div",Ye,[S.noClose?u("",!0):(s(),l(Z,{key:0,style:B({left:(p.value?t(P)-12:0)+"px"}),onChangeSideTreeStatus:z,isInside:!p.value},null,8,["style","isInside"])),_(o,{onMouseenter:de,onMouseleave:me,class:T(["resource-area",{"close-side":!y.value,retract:!p.value}]),ref_key:"node",ref:ee,style:B({width:t(P)+"px"})},{default:d(()=>[S.noClose?u("",!0):(s(),l(Z,{key:0,isInside:!p.value,style:B({left:(p.value?t(P)-12:0)+"px"}),onChangeSideTreeStatus:z},null,8,["isInside","style"])),H(_(Me,{ref_key:"resourceTreeRef",ref:w,"cur-canvas-type":"dashboard","show-position":t(c),onNodeClick:pe},null,8,["show-position"]),[[Be,y.value]])]),_:1},8,["class","style"]),H((s(),l(x,{class:T(["preview-area",{"no-data":!V.value}])},{default:d(()=>[(t(c),u("",!0)),ve.value?(s(),j(U,{key:1},[t(c)==="preview"?(s(),l(Oe,{key:0,onReload:ue,onDownload:F,onDownloadAsAppTemplate:re})):u("",!0),G("div",{ref_key:"previewCanvasContainer",ref:C,class:T(["content",{"de-screen-full":t(X)}]),id:"de-preview-content"},[a.canvasStylePreview&&g.value?(s(),l(Ve,{key:0,ref_key:"dashboardPreview",ref:M,"dv-info":a.dvInfo,"cur-gap":a.curPreviewGap,"component-data":a.canvasDataPreview,"canvas-style-data":a.canvasStylePreview,"canvas-view-info":a.canvasViewInfoPreview,"show-position":t(c),"download-status":m.value},null,8,["dv-info","cur-gap","component-data","canvas-style-data","canvas-view-info","show-position","download-status"])):u("",!0)],2)],64)):V.value&&O.value?(s(),l(Y,{key:2,description:t(f)("visualization.preview_select_tips"),"img-type":"select"},null,8,["description"])):O.value?(s(),l(Y,{key:3,description:t(f)("visualization.have_none_resource"),"img-type":"none"},{default:d(()=>[te.value&&!oe.value?(s(),l(A,{key:0,onClick:ne,type:"primary"},{icon:d(()=>[_(t(ge),{name:"icon_add_outlined"},{default:d(()=>[_(t(Ne),{class:"svg-icon"})]),_:1})]),default:d(()=>[Te(" "+$(t(f)("commons.create"))+$(t(f)("chart.dashboard")),1)]),_:1})):u("",!0)]),_:1},8,["description"])):u("",!0)]),_:1},8,["class"])),[[we,!g.value]])]),_(He,{ref_key:"appExportFormRef",ref:N,"dv-info":a.dvInfo,"component-data":a.canvasDataPreview,"canvas-view-info":a.canvasViewInfoPreview,onDownLoadApp:fe},null,8,["dv-info","component-data","canvas-view-info"])],64)}}});export{fa as _};

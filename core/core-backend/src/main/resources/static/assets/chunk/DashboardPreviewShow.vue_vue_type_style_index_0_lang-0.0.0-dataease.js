import{l as _e,n as he,p as ye,d as ge,h as ke}from"./element-plus-secondary-0.0.0-dataease.js";import{d as Se,k as v,r as i,l as Ce,t as De,b as Pe,n as E,R as Ie,ah as W,ak as Ae,o as s,c as j,a as G,Z as l,a3 as b,u as t,Y as u,a0 as _,_ as d,z as B,W as H,M as $,X as xe,a4 as Ee,a2 as U}from"./@vue-0.0.0-dataease.js";import{i as be}from"./icon_add_outlined-0.0.0-dataease.js";import Be from"./DeResourceTree-0.0.0-dataease.js";import{d as Te}from"./dvMain-0.0.0-dataease.js";import{k as Ne}from"./DePreview-0.0.0-dataease.js";import{_ as Re}from"./PreviewHead.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{E as X}from"./EmptyBackground-0.0.0-dataease.js";import Y from"./DeResourceArrow-0.0.0-dataease.js";import{P as Me,i as Ve,o as Oe}from"./canvasUtils-0.0.0-dataease.js";import{useAppStoreWithOut as Fe}from"./app-0.0.0-dataease.js";import{a as Le,u as qe,j as ze,h as We}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{u as je}from"./useMoveLine-0.0.0-dataease.js";import{a as Ge,c as He}from"./imgUtils-0.0.0-dataease.js";import{s as $e}from"./pinia-0.0.0-dataease.js";import{A as Ue}from"./AppExportForm-0.0.0-dataease.js";import{u as T}from"./index-0.0.0-dataease.js";const Xe={class:"dv-preview dv-teleport-query"},da=Se({__name:"DashboardPreviewShow",props:{showPosition:{required:!1,type:String,default:"preview"},noClose:{required:!1,type:Boolean,default:!1}},setup(S,{expose:Z}){const J=Le(),K=v(()=>J.getName),N=i(null),h=Te(),C=i(null),R=i(null),y=i(!0);qe();const D=Fe(),g=i(!0),m=i(!1),a=Ce({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,curPreviewGap:0}),{fullscreenFlag:Q,canvasViewDataInfo:M}=$e(h),{width:P,node:ee}=je("DASHBOARD"),{t:f}=ze(),ae=S,{showPosition:c}=De(ae),w=i(),V=v(()=>{var e;return(e=w.value)==null?void 0:e.hasData}),oe=v(()=>D.getIsDataEaseBi),te=v(()=>{var e;return(e=w.value)==null?void 0:e.rootManage}),O=v(()=>{var e;return(e=w.value)==null?void 0:e.mounted});Pe(()=>{T({name:"canvasDownload",callback:function(){L("img")}})});function ne(){var e;(e=w.value)==null||e.createNewObject()}const F=(e,r)=>{const o=c.value==="multiplexing"?Me:Ve;g.value=!1,o(e,"dashboard",function({canvasDataResult:n,canvasStyleResult:k,dvInfo:I,canvasViewInfoPreview:A,curPreviewGap:x}){I.weight=r,a.canvasDataPreview=n,a.canvasStylePreview=k,a.canvasViewInfoPreview=A,a.dvInfo=I,a.curPreviewGap=x,g.value=!0,E(()=>{R.value.restore(),Oe({resourceId:e})})})},se=["bubble-map","flow-map","heat-map","map","symbolic-map"],L=e=>{var o;m.value=!0;const r=((o=a.canvasDataPreview)==null?void 0:o.filter(n=>se.includes(n.innerType)).map(n=>n.id))||[];r.forEach(n=>T().emitter.emit("l7-prepare-picture",n)),E(()=>{const n=C.value.querySelector(".canvas-container");Ge(e,n,a.dvInfo.name,()=>{m.value=!1,r.forEach(k=>T().emitter.emit("l7-unprepare-picture",k))})})},re=e=>{e==="template"?q(e,null):e==="app"&&ie()},ie=()=>{const e=le();e&&e.length>0?ye.warning(f("visualization.export_tips",[e])):N.value.init({appName:a.dvInfo.name,icon:null,version:"2.0",creator:K.value,required:"2.9.0",description:null})},le=()=>{let e=",";return Object.keys(M.value).forEach(r=>{const o=M.value[r];o&&(o==null?void 0:o.dataFrom)==="template"&&(e=e+o.title+",")}),e.slice(1)},q=(e,r)=>{m.value=!0,E(()=>{const o=C.value.querySelector(".canvas-container");He(e,o,a.dvInfo.name,r,()=>{m.value=!1})})},Ye=()=>{y.value=!y.value},ce=()=>a,ue=e=>{F(e,a.dvInfo.weight)},pe=e=>{F(e.id,e.weight),c.value==="multiplexing"&&h.initCurMultiplexingComponents()},ve=v(()=>{var e;return!!((e=h.dvInfo)!=null&&e.name)});Ie(()=>{c.value==="preview"&&h.canvasDataInit()});const p=i(!0),z=e=>{p.value=e},de=()=>{D.setArrowSide(!0)},me=()=>{D.setArrowSide(!1)},fe=e=>{q("app",e)};return Z({getPreviewStateInfo:ce}),(e,r)=>{const o=_e,n=W("ArrowLeft"),k=ge,I=W("ArrowRight"),A=ke,x=he,we=Ae("loading");return s(),j($,null,[G("div",Xe,[S.noClose?u("",!0):(s(),l(Y,{key:0,style:b({left:(p.value?t(P)-12:0)+"px"}),onChangeSideTreeStatus:z,isInside:!p.value},null,8,["style","isInside"])),_(o,{onMouseenter:de,onMouseleave:me,class:B(["resource-area",{"close-side":!y.value,retract:!p.value}]),ref_key:"node",ref:ee,style:b({width:t(P)+"px"})},{default:d(()=>[S.noClose?u("",!0):(s(),l(Y,{key:0,isInside:!p.value,style:b({left:(p.value?t(P)-12:0)+"px"}),onChangeSideTreeStatus:z},null,8,["isInside","style"])),H(_(Be,{ref_key:"resourceTreeRef",ref:w,"cur-canvas-type":"dashboard","show-position":t(c),onNodeClick:pe},null,8,["show-position"]),[[xe,y.value]])]),_:1},8,["class","style"]),H((s(),l(x,{class:B(["preview-area",{"no-data":!V.value}])},{default:d(()=>[(t(c),u("",!0)),ve.value?(s(),j($,{key:1},[t(c)==="preview"?(s(),l(Re,{key:0,onReload:ue,onDownload:L,onDownloadAsAppTemplate:re})):u("",!0),G("div",{ref_key:"previewCanvasContainer",ref:C,class:B(["content",{"de-screen-full":t(Q)}]),id:"de-preview-content"},[a.canvasStylePreview&&g.value?(s(),l(Ne,{key:0,ref_key:"dashboardPreview",ref:R,"dv-info":a.dvInfo,"cur-gap":a.curPreviewGap,"component-data":a.canvasDataPreview,"canvas-style-data":a.canvasStylePreview,"canvas-view-info":a.canvasViewInfoPreview,"show-position":t(c),"download-status":m.value},null,8,["dv-info","cur-gap","component-data","canvas-style-data","canvas-view-info","show-position","download-status"])):u("",!0)],2)],64)):V.value&&O.value?(s(),l(X,{key:2,description:t(f)("visualization.preview_select_tips"),"img-type":"select"},null,8,["description"])):O.value?(s(),l(X,{key:3,description:t(f)("visualization.have_none_resource"),"img-type":"none"},{default:d(()=>[te.value&&!oe.value?(s(),l(A,{key:0,onClick:ne,type:"primary"},{icon:d(()=>[_(t(We),{name:"icon_add_outlined"},{default:d(()=>[_(t(be),{class:"svg-icon"})]),_:1})]),default:d(()=>[Ee(" "+U(t(f)("commons.create"))+U(t(f)("chart.dashboard")),1)]),_:1})):u("",!0)]),_:1},8,["description"])):u("",!0)]),_:1},8,["class"])),[[we,!g.value]])]),_(Ue,{ref_key:"appExportFormRef",ref:N,"dv-info":a.dvInfo,"component-data":a.canvasDataPreview,"canvas-view-info":a.canvasViewInfoPreview,onDownLoadApp:fe},null,8,["dv-info","component-data","canvas-view-info"])],64)}}});export{da as _};

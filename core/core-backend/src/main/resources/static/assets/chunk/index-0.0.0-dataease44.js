import"./index-0.0.0-dataease.js";import{a as te,w as ne,n as oe,j as le}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{i as F}from"./icon_right_outlined-0.0.0-dataease.js";import{mountedOrg as re,switchOrg as ie}from"./user-0.0.0-dataease.js";import H from"./OrgCell-0.0.0-dataease.js";import{d as X,r as g,B as se,G as Z,w as ce,a as ue,o as ee,n as M,k as i,T as de,aa as ve,a4 as G,a7 as fe,f as _,L as I,Y as O,M as p,j as L,a6 as W,U as Y,g as R,i as N,a0 as q,a9 as J}from"./vue-0.0.0-dataease.js";import{l as ge}from"./logout-0.0.0-dataease.js";import{s as he}from"./index-0.0.0-dataease56.js";import{c as me,A as V,i as _e,B as pe,n as $,t as K,k as Q,I as ke,w as we}from"./index-0.0.0-dataease26.js";import"./index-0.0.0-dataease27.js";import"./index-0.0.0-dataease57.js";import{_ as ye}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./interactive-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./datasource-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";const[xe,B]=me("image"),be={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:$,height:$,radius:$,lazyLoad:Boolean,iconSize:$,showError:K,errorIcon:Q("photo-fail"),iconPrefix:String,showLoading:K,loadingIcon:Q("photo"),crossorigin:String,referrerpolicy:String};var Ce=X({name:xe,props:be,emits:["load","error"],setup(t,{emit:h,slots:x}){const w=g(!1),u=g(!0),s=g(),{$Lazyload:y}=se().proxy,T=Z(()=>{const e={width:V(t.width),height:V(t.height)};return _e(t.radius)&&(e.overflow="hidden",e.borderRadius=V(t.radius)),e});ce(()=>t.src,()=>{w.value=!1,u.value=!0});const d=e=>{u.value&&(u.value=!1,h("load",e))},b=()=>{const e=new Event("load");Object.defineProperty(e,"target",{value:s.value,enumerable:!0}),d(e)},S=e=>{w.value=!0,u.value=!1,h("error",e)},c=(e,C,D)=>D?D():i(ke,{name:e,size:t.iconSize,class:C,classPrefix:t.iconPrefix},null),k=()=>{if(u.value&&t.showLoading)return i("div",{class:B("loading")},[c(t.loadingIcon,B("loading-icon"),x.loading)]);if(w.value&&t.showError)return i("div",{class:B("error")},[c(t.errorIcon,B("error-icon"),x.error)])},E=()=>{if(w.value||!t.src)return;const e={alt:t.alt,class:B("img"),style:{objectFit:t.fit,objectPosition:t.position},crossorigin:t.crossorigin,referrerpolicy:t.referrerpolicy};return t.lazyLoad?de(i("img",G({ref:s},e),null),[[ve("lazy"),t.src]]):i("img",G({ref:s,src:t.src,onLoad:d,onError:S},e),null)},P=({el:e})=>{const C=()=>{e===s.value&&u.value&&b()};s.value?C():M(C)},z=({el:e})=>{e===s.value&&!w.value&&S()};return y&&pe&&(y.$on("loaded",P),y.$on("error",z),ue(()=>{y.$off("loaded",P),y.$off("error",z)})),ee(()=>{M(()=>{var e;(e=s.value)!=null&&e.complete&&!t.lazyLoad&&b()})}),()=>{var e;return i("div",{class:B({round:t.round,block:t.block}),style:T.value},[E(),k(),(e=x.default)==null?void 0:e.call(x)])}}});const Ie=we(Ce);var Le=Ie;const Be=""+new URL("../png/user-0.0.0-dataease.png",import.meta.url).href;const Se={class:"de-mobile-user"},Ee={class:"mobile-user-top"},Pe={class:"user-name"},ze={class:"cell-org_scroll"},De={class:"grey"},Oe=["onClick"],Ne=X({__name:"index",setup(t){const h=te(),{push:x}=fe(),w=g("组织"),u=g(""),s=g(!0),y=async()=>{await ne(),ge(),x("/login")},T=()=>{s.value=!1},d=g("");let b=null;const S=()=>{var o;const n=[...b];for(;n.length;){const a=n.pop();if((a==null?void 0:a.id)===h.getOid){u.value=a==null?void 0:a.name;break}(o=a==null?void 0:a.children)!=null&&o.length&&a.children.forEach(f=>n.push(f))}};let c=[],k=[];const E=(n,o)=>{n.forEach(a=>{var U;const{name:f,id:r}=a;o<=c.length?(o<c.length&&(c=c.slice(0,o),k=k.slice(0,o)),c.splice(c.length-1,1,r),k.splice(k.length-1,1,f)):(c.push(r),k.push(f));let m=o+1;r===h.getOid&&(l.value=[...k],v.value=[...c],m=999),(U=a==null?void 0:a.children)!=null&&U.length&&m!==999&&E(a==null?void 0:a.children,m)})};ee(()=>{re().then(n=>{b=n.data,j.value=n.data,S(),E(b,1),l.value.pop(),v.value.pop(),d.value=l.value[l.value.length-1]})});const P=n=>{ie(n).then(o=>{const a=o.data.token;h.setToken(a),h.setExp(o.data.exp),h.setTime(Date.now()),window.location.reload()})},z=()=>{l.value.pop(),d.value=l.value[l.value.length-1],v.value.pop(),l.value.length||(s.value=!0)},e=()=>{l.value.length&&(l.value=[],d.value="",v.value=[])},C=(n,o)=>{n!=="right"?P(o.id):(l.value.push(o.name),d.value=o.name,v.value.push(o.id))},D=n=>{n!==v.value.length-1&&(v.value=v.value.slice(0,n+1),l.value=l.value.slice(0,n+1),d.value=l.value[l.value.length-1])},j=g([]),l=g([]),v=g([]),A=(n,o)=>{const a=n.shift();return o.reduce((f,r)=>{if(a&&r.id===a){if(!n.length)return r.children||[];f=A([...n],r.children||[])||[]}return f},[])},ae=Z(()=>v.value.length?A([...v.value],j.value):j.value);return(n,o)=>{const a=oe,f=le;return _(),I("div",Se,[s.value?(_(),I(O,{key:0},[o[0]||(o[0]=p("div",{class:"logout flex-center"},"我的",-1)),p("div",Ee,[i(L(Le),{round:"",width:"48",height:"48",src:L(Be)},null,8,["src"]),p("div",Pe,W(L(h).name),1)]),i(H,{onClick:T,label:"切换组织","prefix-icon":"icon_switch_outlined",tips:u.value,nextlevel:""},null,8,["tips"]),p("div",{class:"logout flex-center danger",onClick:y},"注销")],64)):(_(),I(O,{key:1},[i(L(he),{"safe-area-inset-top":"",title:d.value||w.value,"left-arrow":"",onClickLeft:z},null,8,["title"]),p("div",ze,[p("div",De,[p("div",{onClick:e,class:"flex-align-center"},[p("span",{class:Y(["ellipsis",!!l.value.length&&"active"])},"组织",2),l.value.length?(_(),R(f,{key:0},{default:N(()=>[i(a,{name:"icon_right_outlined"},{default:N(()=>[i(L(F),{class:"svg-icon"})]),_:1})]),_:1})):q("",!0)]),(_(!0),I(O,null,J(l.value,(r,m)=>(_(),I("div",{onClick:U=>D(m),class:"flex-align-center",key:r},[p("span",{class:Y(["ellipsis",r!==d.value&&"active"])},W(r),3),l.value.length>1&&m!==l.value.length-1?(_(),R(f,{key:0},{default:N(()=>[i(a,{name:"icon_right_outlined"},{default:N(()=>[i(L(F),{class:"svg-icon"})]),_:1})]),_:1})):q("",!0)],8,Oe))),128))]),(_(!0),I(O,null,J(ae.value,r=>(_(),R(H,{onClick:m=>C(m,r),key:r.id,label:r.name,nextlevel:r.children,active:u.value===r.name},null,8,["onClick","label","nextlevel","active"]))),128))])],64))])}}});const na=ye(Ne,[["__scopeId","data-v-7b1f6c9e"]]);export{na as default};

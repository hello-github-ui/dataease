import"./index-0.0.0-dataease.js";import{E as M}from"./el-dialog-0.0.0-dataease.js";import{o as $,D as v,y as q,G}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as j}from"./el-row-0.0.0-dataease.js";import{E as A}from"./el-col-0.0.0-dataease.js";import{E as J}from"./el-radio-0.0.0-dataease.js";import{d as P,r as W,Z,G as w,w as H,aa as K,f,g as _,i as a,T as Q,k as o,a5 as m,a6 as u,j as s,M as X,a0 as y,V as h,ab as Y}from"./vue-0.0.0-dataease.js";import{s as ee}from"./template-0.0.0-dataease.js";import{i as te}from"./imgUtils-0.0.0-dataease.js";import{h as ae}from"./dataVisualization-0.0.0-dataease.js";import oe from"./DeTemplatePreviewList-0.0.0-dataease.js";import{_ as le}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./row-0.0.0-dataease.js";import"./dvMain-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./index-0.0.0-dataease19.js";import"./util-0.0.0-dataease2.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./index-0.0.0-dataease20.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./el-tree-0.0.0-dataease.js";import"./index-0.0.0-dataease13.js";import"./el-checkbox-0.0.0-dataease.js";import"./dv-folder-0.0.0-dataease.js";import"./dv-dashboard-spine-0.0.0-dataease.js";import"./icon_operation-analysis_outlined-0.0.0-dataease.js";const ne=P({__name:"DeResourceCreateOpt",props:{curCanvasType:{type:String,required:!0}},emits:["finish"],setup(S,{expose:D,emit:V}){const{t:n}=$(),I=V,g=W(null),b=S,e=Z({dialogShow:!1,loading:!1,inputType:"new_outer_template",fieldName:"name",tableRadio:null,keyWordSearch:"",columnLabel:n("visualization.belong_to_category"),templateList:[],importTemplateInfo:{snapshot:""},dvCreateInfo:{pid:-1,name:null,canvasStyleData:null,componentData:null,templateId:null,dynamicData:null,staticResource:null},templateSelected:!1}),k=w(()=>e.dvCreateInfo.name&&e.templateSelected),C=w(()=>e.importTemplateInfo.snapshot?{background:`url(${te(e.importTemplateInfo.snapshot)}) no-repeat`}:{});H(()=>e.inputType,()=>{T()});const T=()=>{e.templateSelected=!1,e.dvCreateInfo.name=null,e.dvCreateInfo.canvasStyleData=null,e.dvCreateInfo.componentData=null,e.importTemplateInfo.snapshot=null,e.dvCreateInfo.templateId=null},E=l=>{e.dvCreateInfo.templateId=l.id,l.nodeType==="folder"?(e.dvCreateInfo.name=null,e.importTemplateInfo.snapshot=null,e.templateSelected=!1):(e.dvCreateInfo.name=l.name,e.importTemplateInfo.snapshot=l.snapshot,e.templateSelected=!0)},z=()=>{const l={level:"0",leafDvType:b.curCanvasType,withChildren:!0};e.loading=!0,ee(l).then(t=>{e.templateList=t.data,e.loading=!1})},x=()=>{I("finish")},R=()=>{if(!e.dvCreateInfo.name)return v.warning(n("common.save_success")),!1;if(e.dvCreateInfo.name.length>50)return v.warning(n("common.char_can_not_more_50")),!1;if(!e.dvCreateInfo.templateId&&e.inputType==="new_inner_template")return v.warning("chart.template_can_not_empty"),!1;e.dvCreateInfo.newFrom=e.inputType,e.loading=!0,ae(e.dvCreateInfo).then(l=>{e.loading=!1,I("finish",l.data)}).catch(()=>{e.loading=!1})},L=l=>{const t=l.target.files[0],d=new FileReader;d.onload=i=>{e.templateSelected=!0;const c=i.target.result;e.importTemplateInfo=JSON.parse(c),e.dvCreateInfo.name=e.importTemplateInfo.name.name,e.dvCreateInfo.canvasStyleData=e.importTemplateInfo.canvasStyleData,e.dvCreateInfo.componentData=e.importTemplateInfo.componentData,e.dvCreateInfo.dynamicData=e.importTemplateInfo.dynamicData,e.dvCreateInfo.staticResource=e.importTemplateInfo.staticResource},d.readAsText(t)},N=()=>{g.value.click()},B=()=>{e.dialogShow=!1};return D({optInit:()=>{e.dialogShow=!0,T()}}),(l,t)=>{const d=J,i=A,c=q,p=j,U=G,F=M,O=K("loading");return f(),_(F,{class:"create-dialog",title:s(n)("visualization.new_from_template"),modelValue:e.dialogShow,"onUpdate:modelValue":t[5]||(t[5]=r=>e.dialogShow=r),width:"700","before-close":B,onSubmit:t[6]||(t[6]=Y(()=>{},["prevent"]))},{default:a(()=>[Q((f(),_(p,{class:"create-main"},{default:a(()=>[o(p,null,{default:a(()=>[o(i,{span:18,style:{height:"40px"}},{default:a(()=>[o(d,{modelValue:e.inputType,"onUpdate:modelValue":t[0]||(t[0]=r=>e.inputType=r),label:"new_outer_template"},{default:a(()=>[m(u(s(n)("visualization.import_template")),1)]),_:1},8,["modelValue"]),o(d,{modelValue:e.inputType,"onUpdate:modelValue":t[1]||(t[1]=r=>e.inputType=r),label:"new_inner_template",onClick:z},{default:a(()=>[m(u(s(n)("visualization.copy_template")),1)]),_:1},8,["modelValue"])]),_:1}),e.inputType==="new_outer_template"?(f(),_(i,{key:0,span:6,class:"button-main"},{default:a(()=>[o(c,{class:"el-icon-upload",size:"small",type:"primary",onClick:N},{default:a(()=>[m(u(s(n)("visualization.upload_template")),1)]),_:1}),X("input",{id:"input",ref_key:"files",ref:g,type:"file",accept:".DET2",hidden:"",onChange:L},null,544)]),_:1})):y("",!0)]),_:1}),o(p,{style:{"margin-top":"5px"}},{default:a(()=>[o(i,{span:4,class:"name-area"},{default:a(()=>[m(u(s(n)("visualization.name")),1)]),_:1}),o(i,{span:20},{default:a(()=>[o(U,{modelValue:e.dvCreateInfo.name,"onUpdate:modelValue":t[2]||(t[2]=r=>e.dvCreateInfo.name=r),clearable:"",size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),e.inputType==="new_inner_template"?(f(),_(p,{key:0,class:"preview"},{default:a(()=>[o(i,{span:8,style:{height:"100%","overflow-y":"auto"}},{default:a(()=>[o(oe,{"template-list":e.templateList,onShowCurrentTemplateInfo:E},null,8,["template-list"])]),_:1}),o(i,{span:16,style:h(C.value),class:"preview-show"},null,8,["style"])]),_:1})):y("",!0),e.inputType==="new_outer_template"?(f(),_(p,{key:1,class:"preview",style:h(C.value)},null,8,["style"])):y("",!0),o(p,{class:"root-class"},{default:a(()=>[o(c,{size:"small",onClick:t[3]||(t[3]=r=>x())},{default:a(()=>[m(u(s(n)("commons.cancel")),1)]),_:1}),o(c,{type:"primary",size:"small",disabled:!k.value,onClick:t[4]||(t[4]=r=>R())},{default:a(()=>[m(u(s(n)("commons.confirm")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})),[[O,e.loading]])]),_:1},8,["title","modelValue"])}}});const Xe=le(ne,[["__scopeId","data-v-b3ac9a5a"]]);export{Xe as default};

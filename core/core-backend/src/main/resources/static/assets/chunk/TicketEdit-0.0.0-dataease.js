import{p as st,an as nt}from"./index-0.0.0-dataease.js";import{E as it}from"./el-drawer-0.0.0-dataease.js";import{o as lt,x as b,D as L,n as A,y as rt,j as ct,G as mt}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{a as pt,E as dt}from"./el-form-item-0.0.0-dataease.js";import{E as ut}from"./el-input-number-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{d as ft,r as f,Z as k,f as x,g as _t,i as n,j as i,M as m,k as a,a5 as E,a6 as d,ab as y,L as O,a9 as gt,V as vt,Y as kt}from"./vue-0.0.0-dataease.js";import{d as yt}from"./de-copy-0.0.0-dataease.js";import{i as ht}from"./icon_refresh_outlined-0.0.0-dataease.js";import{i as bt}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as Lt}from"./icon_add_outlined-0.0.0-dataease.js";import{d as z}from"./dv-info-0.0.0-dataease.js";import{u as xt}from"./index-0.0.0-dataease18.js";import{E as Et}from"./index-0.0.0-dataease3.js";import{_ as Vt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./index-0.0.0-dataease17.js";const Tt={class:"ticket-row ticket-tips-label"},Ct=["title"],Ft={class:"ticket-form-info-tips"},It={class:"custom-form-item__label"},$t={class:"ticket-form-info-tips"},Nt={class:"custom-form-item__label"},wt=["onClick"],Ut={class:"ticket-add"},At={class:"dialog-footer"},Ot=ft({__name:"TicketEdit",props:{uuid:st.string.def("")},emits:["saved"],setup(B,{expose:S,emit:j}){const{toClipboard:q}=xt(),{t:l}=lt(),u=f(!1),V=f(null),_=f(),D=B,g=f(!1),h=f(""),t=k({form:k({ticket:"",exp:30,args:""}),argList:k([{name:"",val:""}])}),J=k({exp:[{required:!0,message:l("common.require"),trigger:"blur"}]}),T=j,M=async e=>{e&&await e.validate(o=>{if(o){K();const s={uuid:D.uuid,ticket:t.form.ticket,exp:t.form.exp,args:t.form.args};G(),b.post({url:"/ticket/saveTicket",data:s}).then(r=>{r.msg||(L.success(l("common.save_success")),T("saved"),R()),F()}).catch(()=>{F()})}})},C=e=>{e&&(e.resetFields(),u.value=!1)},R=()=>{C(_.value)},G=()=>{V.value=nt.service({target:".ticket-param-drawer"})},F=()=>{var e;(e=V.value)==null||e.close()},P=(e,o)=>{if(X(),h.value=o,g.value=!!(e!=null&&e.ticket),!g.value){I(),u.value=!0;return}for(const s in e)t.form.hasOwnProperty(s)&&(t.form[s]=e[s]);t.form.args&&H(),u.value=!0},I=()=>{const e="/ticket/tempTicket";b.get({url:e}).then(o=>{t.form.ticket=o.data})},Y=()=>{const e={name:"",val:""};t.argList.push(e)},Z=e=>{if(t.argList.length===1){t.argList[e].name="",t.argList[e].val="";return}t.argList.splice(e,1)},H=()=>{var o;if(!t.form.args)return;const e=JSON.parse(t.form.args);for(const s in e){const r=e[s];if(r&&Array.isArray(r)){const p={name:s,val:JSON.stringify(r)};t.argList.push(p)}else{const p={name:s,val:e[s]};t.argList.push(p)}}((o=t.argList)==null?void 0:o.length)>1&&!t.argList[0].name&&t.argList.splice(0,1)},K=()=>{var o;if(!((o=t.argList)!=null&&o.length)){t.form.args="";return}const e={};t.argList.forEach(s=>{s.name&&s.val&&(e[s.name]=s.val)}),t.form.args=JSON.stringify(e)},Q=async e=>{const o=`${h.value}?ticket=${e}`;try{await q(o),L.success(l("common.copy_success"))}catch(s){L.warning(l("common.copy_unsupported"),s)}},W=()=>{if(!g.value){I();return}const e="/ticket/saveTicket",o={ticket:t.form.ticket};o.generateNew=!0,b.post({url:e,data:o}).then(s=>{t.form.ticket=s.data,T("saved")})},X=()=>{t.form={ticket:"",exp:30,args:""},t.argList=[{name:"",val:""}],g.value=!1,h.value=""};return S({edit:P}),(e,o)=>{const s=A,r=rt,p=Et,$=ct,tt=ut,N=pt,w=mt,et=A,ot=dt,at=it;return x(),_t(at,{title:`${i(l)("commons.add")} Ticket`,modelValue:u.value,"onUpdate:modelValue":o[4]||(o[4]=c=>u.value=c),"custom-class":"ticket-param-drawer",size:"600px",direction:"rtl"},{footer:n(()=>[m("span",At,[a(r,{secondary:"",onClick:o[2]||(o[2]=c=>C(_.value))},{default:n(()=>[E(d(i(l)("common.cancel")),1)]),_:1}),a(r,{type:"primary",onClick:o[3]||(o[3]=c=>M(_.value))},{default:n(()=>[E(d(i(l)("commons.save")),1)]),_:1})])]),default:n(()=>[a(ot,{ref_key:"ticketForm",ref:_,"require-asterisk-position":"right",model:t.form,rules:J,"label-width":"80px","label-position":"top"},{default:n(()=>[o[5]||(o[5]=m("div",{class:"ticket-tips-label"},[m("span",null,"Ticket")],-1)),m("div",Tt,[m("span",{title:t.form.ticket},d(t.form.ticket),9,Ct),a(p,{class:"item",effect:"dark",content:i(l)("commons.copy"),placement:"top"},{default:n(()=>[a(r,{text:"",onClick:o[0]||(o[0]=y(c=>Q(t.form.ticket),["stop"]))},{icon:n(()=>[a(s,{name:"de-copy"},{default:n(()=>[a(i(yt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"]),a(p,{class:"item",effect:"dark",content:`${i(l)("link_ticket.refresh")} ticket`,placement:"top"},{default:n(()=>[a(r,{text:"",onClick:y(W,["stop"])},{icon:n(()=>[a(s,{name:"icon_refresh_outlined"},{default:n(()=>[a(i(ht),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])]),a(N,{prop:"exp",label:i(l)("visualization.over_time")},{label:n(()=>[m("div",Ft,[m("span",It,d(i(l)("visualization.over_time")),1),a(p,{effect:"dark",content:i(l)("link_ticket.time_tips"),placement:"top"},{default:n(()=>[a($,null,{default:n(()=>[a(s,{name:"dv-info"},{default:n(()=>[a(i(z),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])]),default:n(()=>[a(tt,{modelValue:t.form.exp,"onUpdate:modelValue":o[1]||(o[1]=c=>t.form.exp=c),autocomplete:"off","step-strictly":"",class:"text-left edit-all-line",min:0,max:1440,placeholder:i(l)("common.inputText"),"controls-position":"right",type:"number"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(N,{prop:"args",label:i(l)("dataset.param"),class:"last-form-item"},{label:n(()=>[m("div",$t,[m("span",Nt,d(i(l)("dataset.param")),1),a(p,{effect:"dark",content:i(l)("link_ticket.arg_format_tips"),placement:"top"},{default:n(()=>[a($,null,{default:n(()=>[a(s,{name:"dv-info"},{default:n(()=>[a(i(z),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])]),default:n(()=>[(x(!0),O(kt,null,gt(t.argList,(c,U)=>(x(),O("div",{class:"args-line",key:U},[a(w,{modelValue:c.name,"onUpdate:modelValue":v=>c.name=v,placeholder:i(l)("visualization.input_param_name")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),a(w,{modelValue:c.val,"onUpdate:modelValue":v=>c.val=v,placeholder:i(l)("link_ticket.arg_val_tips")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),m("div",{style:vt({opacity:t.argList.length!==1?1:0}),class:"arg-del-btn",onClick:y(v=>Z(U),["stop"])},[a(s,null,{default:n(()=>[a(i(bt),{class:"svg-icon"})]),_:1})],12,wt)]))),128))]),_:1},8,["label"]),m("div",Ut,[a(r,{onClick:y(Y,["stop"]),text:""},{icon:n(()=>[a(et,{name:"icon_add_outlined"},{default:n(()=>[a(i(Lt),{class:"svg-icon"})]),_:1})]),default:n(()=>[E(" "+d(i(l)("commons.add")),1)]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}});const ie=Vt(Ot,[["__scopeId","data-v-5472fe65"]]);export{ie as default};

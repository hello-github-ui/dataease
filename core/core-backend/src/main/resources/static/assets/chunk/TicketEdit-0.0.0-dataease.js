import{X as st,p as b,E as it,h as rt,e as nt,d as lt,A as ct,w as mt,r as pt,v as dt}from"./element-plus-secondary-0.0.0-dataease.js";import{j as ut,n as L,h as U}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as _t,r as _,l as k,o as x,Z as ft,_ as i,u as r,a as m,a0 as a,a4 as V,a2 as d,a1 as y,c as O,ab as gt,a3 as vt,M as kt}from"./@vue-0.0.0-dataease.js";import{d as yt}from"./de-copy-0.0.0-dataease.js";import{i as ht}from"./icon_refresh_outlined-0.0.0-dataease.js";import{i as bt}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as Lt}from"./icon_add_outlined-0.0.0-dataease.js";import{d as z}from"./dv-info-0.0.0-dataease.js";import{u as xt}from"./vue-clipboard3-0.0.0-dataease.js";import{p as Vt}from"./index-0.0.0-dataease.js";import{_ as Tt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./clipboard-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";const Et={class:"ticket-row ticket-tips-label"},Ct=["title"],Ft={class:"ticket-form-info-tips"},It={class:"custom-form-item__label"},$t={class:"ticket-form-info-tips"},wt={class:"custom-form-item__label"},Nt=["onClick"],At={class:"ticket-add"},Ut={class:"dialog-footer"},Ot=_t({__name:"TicketEdit",props:{uuid:Vt.string.def("")},emits:["saved"],setup(B,{expose:S,emit:q}){const{toClipboard:j}=xt(),{t:n}=ut(),u=_(!1),T=_(null),f=_(),D=B,g=_(!1),h=_(""),t=k({form:k({ticket:"",exp:30,args:""}),argList:k([{name:"",val:""}])}),J=k({exp:[{required:!0,message:n("common.require"),trigger:"blur"}]}),E=q,M=async e=>{e&&await e.validate(o=>{if(o){K();const s={uuid:D.uuid,ticket:t.form.ticket,exp:t.form.exp,args:t.form.args};P(),L.post({url:"/ticket/saveTicket",data:s}).then(l=>{l.msg||(b.success(n("common.save_success")),E("saved"),R()),F()}).catch(()=>{F()})}})},C=e=>{e&&(e.resetFields(),u.value=!1)},R=()=>{C(f.value)},P=()=>{T.value=it.service({target:".ticket-param-drawer"})},F=()=>{var e;(e=T.value)==null||e.close()},X=(e,o)=>{if(Y(),h.value=o,g.value=!!(e!=null&&e.ticket),!g.value){I(),u.value=!0;return}for(const s in e)t.form.hasOwnProperty(s)&&(t.form[s]=e[s]);t.form.args&&H(),u.value=!0},I=()=>{const e="/ticket/tempTicket";L.get({url:e}).then(o=>{t.form.ticket=o.data})},Z=()=>{const e={name:"",val:""};t.argList.push(e)},G=e=>{if(t.argList.length===1){t.argList[e].name="",t.argList[e].val="";return}t.argList.splice(e,1)},H=()=>{var o;if(!t.form.args)return;const e=JSON.parse(t.form.args);for(const s in e){const l=e[s];if(l&&Array.isArray(l)){const p={name:s,val:JSON.stringify(l)};t.argList.push(p)}else{const p={name:s,val:e[s]};t.argList.push(p)}}((o=t.argList)==null?void 0:o.length)>1&&!t.argList[0].name&&t.argList.splice(0,1)},K=()=>{var o;if(!((o=t.argList)!=null&&o.length)){t.form.args="";return}const e={};t.argList.forEach(s=>{s.name&&s.val&&(e[s.name]=s.val)}),t.form.args=JSON.stringify(e)},Q=async e=>{const o=`${h.value}?ticket=${e}`;try{await j(o),b.success(n("common.copy_success"))}catch(s){b.warning(n("common.copy_unsupported"),s)}},W=()=>{if(!g.value){I();return}const e="/ticket/saveTicket",o={ticket:t.form.ticket};o.generateNew=!0,L.post({url:e,data:o}).then(s=>{t.form.ticket=s.data,E("saved")})},Y=()=>{t.form={ticket:"",exp:30,args:""},t.argList=[{name:"",val:""}],g.value=!1,h.value=""};return S({edit:X}),(e,o)=>{const s=U,l=rt,p=nt,$=lt,tt=ct,w=mt,N=pt,et=U,ot=dt,at=st;return x(),ft(at,{title:`${r(n)("commons.add")} Ticket`,modelValue:u.value,"onUpdate:modelValue":o[4]||(o[4]=c=>u.value=c),"custom-class":"ticket-param-drawer",size:"600px",direction:"rtl"},{footer:i(()=>[m("span",Ut,[a(l,{secondary:"",onClick:o[2]||(o[2]=c=>C(f.value))},{default:i(()=>[V(d(r(n)("common.cancel")),1)]),_:1}),a(l,{type:"primary",onClick:o[3]||(o[3]=c=>M(f.value))},{default:i(()=>[V(d(r(n)("commons.save")),1)]),_:1})])]),default:i(()=>[a(ot,{ref_key:"ticketForm",ref:f,"require-asterisk-position":"right",model:t.form,rules:J,"label-width":"80px","label-position":"top"},{default:i(()=>[o[5]||(o[5]=m("div",{class:"ticket-tips-label"},[m("span",null,"Ticket")],-1)),m("div",Et,[m("span",{title:t.form.ticket},d(t.form.ticket),9,Ct),a(p,{class:"item",effect:"dark",content:r(n)("commons.copy"),placement:"top"},{default:i(()=>[a(l,{text:"",onClick:o[0]||(o[0]=y(c=>Q(t.form.ticket),["stop"]))},{icon:i(()=>[a(s,{name:"de-copy"},{default:i(()=>[a(r(yt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"]),a(p,{class:"item",effect:"dark",content:`${r(n)("link_ticket.refresh")} ticket`,placement:"top"},{default:i(()=>[a(l,{text:"",onClick:y(W,["stop"])},{icon:i(()=>[a(s,{name:"icon_refresh_outlined"},{default:i(()=>[a(r(ht),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])]),a(w,{prop:"exp",label:r(n)("visualization.over_time")},{label:i(()=>[m("div",Ft,[m("span",It,d(r(n)("visualization.over_time")),1),a(p,{effect:"dark",content:r(n)("link_ticket.time_tips"),placement:"top"},{default:i(()=>[a($,null,{default:i(()=>[a(s,{name:"dv-info"},{default:i(()=>[a(r(z),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])]),default:i(()=>[a(tt,{modelValue:t.form.exp,"onUpdate:modelValue":o[1]||(o[1]=c=>t.form.exp=c),autocomplete:"off","step-strictly":"",class:"text-left edit-all-line",min:0,max:1440,placeholder:r(n)("common.inputText"),"controls-position":"right",type:"number"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(w,{prop:"args",label:r(n)("dataset.param"),class:"last-form-item"},{label:i(()=>[m("div",$t,[m("span",wt,d(r(n)("dataset.param")),1),a(p,{effect:"dark",content:r(n)("link_ticket.arg_format_tips"),placement:"top"},{default:i(()=>[a($,null,{default:i(()=>[a(s,{name:"dv-info"},{default:i(()=>[a(r(z),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])]),default:i(()=>[(x(!0),O(kt,null,gt(t.argList,(c,A)=>(x(),O("div",{class:"args-line",key:A},[a(N,{modelValue:c.name,"onUpdate:modelValue":v=>c.name=v,placeholder:r(n)("visualization.input_param_name")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),a(N,{modelValue:c.val,"onUpdate:modelValue":v=>c.val=v,placeholder:r(n)("link_ticket.arg_val_tips")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),m("div",{style:vt({opacity:t.argList.length!==1?1:0}),class:"arg-del-btn",onClick:y(v=>G(A),["stop"])},[a(s,null,{default:i(()=>[a(r(bt),{class:"svg-icon"})]),_:1})],12,Nt)]))),128))]),_:1},8,["label"]),m("div",At,[a(l,{onClick:y(Z,["stop"]),text:""},{icon:i(()=>[a(et,{name:"icon_add_outlined"},{default:i(()=>[a(r(Lt),{class:"svg-icon"})]),_:1})]),default:i(()=>[V(" "+d(r(n)("commons.add")),1)]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}});const Me=Tt(Ot,[["__scopeId","data-v-5472fe65"]]);export{Me as default};

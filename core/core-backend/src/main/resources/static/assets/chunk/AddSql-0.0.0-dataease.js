import{d as _,Y as fl,p as Y,q as hl,r as gl,h as Cl,g as yl,s as bl,e as wl,V as Vl,T as xl,f as Hl,Q as kl,R as Tl,U as Ml,S as Sl,W as El,x as ql,y as $l,Z as Nl,X as Dl}from"./element-plus-secondary-0.0.0-dataease.js";import{o as r,c as m,a as i,d as Ll,t as Zl,r as f,l as De,x as Il,k as Ul,b as Al,e as Ol,w as ge,ak as Pl,a0 as l,u as e,_ as t,a4 as y,a2 as u,Z as b,Y as q,W as Z,X,a3 as G,z as I,a1 as Le,$ as oe,M as B,ab as Q,h as Yl,s as Bl}from"./@vue-0.0.0-dataease.js";import{i as Ze}from"./icon_close_outlined-0.0.0-dataease.js";import{i as Rl}from"./icon_right_outlined-0.0.0-dataease.js";import{i as zl}from"./icon_left_outlined-0.0.0-dataease.js";import{i as Ie}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as Ce}from"./icon_copy_outlined-0.0.0-dataease.js";import{i as Fl}from"./icon_info_outlined-0.0.0-dataease.js";import{i as jl}from"./icon_info_colorful-0.0.0-dataease.js";import{n as Wl,j as Jl,h as p}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{g as R}from"./js-base64-0.0.0-dataease.js";import{p as Xl}from"./@vueuse-0.0.0-dataease.js";import{u as Gl}from"./vue-clipboard3-0.0.0-dataease.js";import{n as Ql,L as Kl,l as ea,M as la}from"./dataset-0.0.0-dataease.js";import aa from"./CodeMirror-0.0.0-dataease2.js";import{G as ta}from"./GridTable-0.0.0-dataease.js";import{E as ye}from"./EmptyBackground-0.0.0-dataease.js";import{t as sa,f as oa,d as be}from"./util-0.0.0-dataease.js";import{f as ne}from"./attr-0.0.0-dataease20.js";import{i as ie,f as na,a as ia,b as da}from"./field-list-0.0.0-dataease.js";import{i as ra}from"./ModelUtil-0.0.0-dataease.js";import{d as ua}from"./lodash-es-0.0.0-dataease.js";import{_ as ca}from"./_plugin-vue_export-helper-0.0.0-dataease.js";const ma={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function _a(H,v){return r(),m("svg",ma,v[0]||(v[0]=[i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M3.15156 1.33301C2.1474 1.33301 1.33337 2.14703 1.33337 3.15119V12.8482C1.33337 13.8523 2.1474 14.6663 3.15155 14.6663H12.8485C13.8527 14.6663 14.6667 13.8523 14.6667 12.8482V3.15119C14.6667 2.14704 13.8527 1.33301 12.8485 1.33301H3.15156ZM13.3334 2.66634H2.66671V5.33301H5.33337H6.66671H9.33337H10.6667H13.3334V2.66634ZM2.66671 9.33301V6.66634H5.33337V9.33301H2.66671ZM2.66671 10.6663V13.333L5.33337 13.333V10.6663H2.66671ZM6.66671 10.6663V13.333H9.33337V10.6663H6.66671ZM10.6667 10.6663V13.333L13.3334 13.333V10.6663H10.6667ZM13.3334 9.33301V6.66634H10.6667V9.33301H13.3334ZM9.33337 9.33301H6.66671V6.66634H9.33337V9.33301Z"},null,-1)]))}const pa={render:_a},va={width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"};function fa(H,v){return r(),m("svg",va,v[0]||(v[0]=[i("path",{d:"M13 7H16.5C16.7761 7 17 7.22386 17 7.5V8.5C17 8.77614 16.7761 9 16.5 9H13V16.5C13 16.7761 12.7761 17 12.5 17H11.5C11.2239 17 11 16.7761 11 16.5V9H7.5C7.22386 9 7 8.77614 7 8.5V7.5C7 7.22386 7.22386 7 7.5 7H11C11 7 13 7.02833 13 7Z"},null,-1),i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2 3C2 2.44772 2.44772 2 3 2H21C21.5523 2 22 2.44772 22 3V21C22 21.5523 21.5523 22 21 22H3C2.44772 22 2 21.5523 2 21V3ZM4 20V4H20V20H4Z"},null,-1)]))}const ha={render:fa},ga={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function Ca(H,v){return r(),m("svg",ga,v[0]||(v[0]=[i("g",{"clip-path":"url(#clip0_4476_153334)"},[i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7.99984 1.66699C11.4976 1.66699 14.3332 4.50261 14.3332 8.00033C14.3332 11.498 11.4976 14.3337 7.99984 14.3337C4.50212 14.3337 1.6665 11.498 1.6665 8.00033C1.6665 4.50261 4.50212 1.66699 7.99984 1.66699ZM7.99984 0.666992C12.0498 0.666992 15.3332 3.95033 15.3332 8.00033C15.3332 12.0503 12.0498 15.3337 7.99984 15.3337C3.94984 15.3337 0.666504 12.0503 0.666504 8.00033C0.666504 3.95033 3.94984 0.666992 7.99984 0.666992ZM6.85744 11.4096L11.4714 8.50657C11.5568 8.45249 11.6271 8.37772 11.6758 8.2892C11.7245 8.20069 11.75 8.1013 11.75 8.00027C11.75 7.89924 11.7245 7.79985 11.6758 7.71133C11.6271 7.62282 11.5568 7.54804 11.4714 7.49397L6.85764 4.59117C6.76324 4.53177 6.65444 4.50037 6.54324 4.50037C6.46511 4.50063 6.38779 4.51628 6.3157 4.54642C6.24361 4.57657 6.17816 4.62061 6.1231 4.67605C6.06803 4.73149 6.02443 4.79723 5.99477 4.86952C5.96511 4.94181 5.94998 5.01923 5.95024 5.09737V10.9036C5.95031 11.0152 5.98155 11.1247 6.04044 11.2196C6.0814 11.2859 6.13508 11.3435 6.1984 11.389C6.26172 11.4345 6.33342 11.4671 6.40937 11.4847C6.48532 11.5024 6.56402 11.5048 6.64092 11.4919C6.71782 11.479 6.79141 11.451 6.85744 11.4096Z"})],-1),i("defs",null,[i("clipPath",{id:"clip0_4476_153334"},[i("rect",{width:"16",height:"16"})])],-1)]))}const ya={render:Ca},ba={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function wa(H,v){return r(),m("svg",ba,v[0]||(v[0]=[i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11 11.333H14.2393C14.3879 11.333 14.4418 11.3485 14.4961 11.3775C14.5505 11.4066 14.5931 11.4492 14.6221 11.5035C14.6512 11.5579 14.6667 11.6117 14.6667 11.7603V12.239C14.6667 12.3876 14.6512 12.4415 14.6221 12.4958C14.5931 12.5501 14.5505 12.5928 14.4961 12.6218C14.4418 12.6509 14.3879 12.6663 14.2393 12.6663H11V14.239C11 14.3876 10.9845 14.4415 10.9555 14.4958C10.9264 14.5501 10.8838 14.5928 10.8295 14.6218C10.7751 14.6509 10.7213 14.6663 10.5727 14.6663H10.094C9.94539 14.6663 9.89151 14.6509 9.83719 14.6218C9.78287 14.5928 9.74024 14.5501 9.71118 14.4958C9.68213 14.4415 9.66666 14.3876 9.66666 14.239V12.6663H1.76064C1.61206 12.6663 1.55817 12.6509 1.50385 12.6218C1.44953 12.5928 1.4069 12.5501 1.37785 12.4958C1.3488 12.4415 1.33333 12.3876 1.33333 12.239V11.7603C1.33333 11.6117 1.3488 11.5579 1.37785 11.5035C1.4069 11.4492 1.44953 11.4066 1.50385 11.3775C1.55817 11.3485 1.61206 11.333 1.76064 11.333H9.66666V9.76032C9.66666 9.61174 9.68213 9.55785 9.71118 9.50353C9.74024 9.44921 9.78287 9.40658 9.83719 9.37753C9.89151 9.34848 9.94539 9.33301 10.094 9.33301H10.5727C10.7213 9.33301 10.7751 9.34848 10.8295 9.37753C10.8838 9.40658 10.9264 9.44921 10.9555 9.50353C10.9845 9.55785 11 9.61174 11 9.76032V11.333ZM4.99999 3.33301V1.76032C4.99999 1.61174 5.01547 1.55785 5.04452 1.50353C5.07357 1.44921 5.1162 1.40658 5.17052 1.37753C5.22484 1.34848 5.27872 1.33301 5.42731 1.33301H5.90601C6.0546 1.33301 6.10848 1.34848 6.1628 1.37753C6.21712 1.40658 6.25976 1.44921 6.28881 1.50353C6.31786 1.55785 6.33333 1.61174 6.33333 1.76032V3.33301H14.2393C14.3879 3.33301 14.4418 3.34848 14.4961 3.37753C14.5505 3.40658 14.5931 3.44921 14.6221 3.50353C14.6512 3.55785 14.6667 3.61174 14.6667 3.76032V4.23903C14.6667 4.38761 14.6512 4.44149 14.6221 4.49582C14.5931 4.55014 14.5505 4.59277 14.4961 4.62182C14.4418 4.65087 14.3879 4.66634 14.2393 4.66634H6.33333V6.23903C6.33333 6.38761 6.31786 6.44149 6.28881 6.49582C6.25976 6.55014 6.21712 6.59277 6.1628 6.62182C6.10848 6.65087 6.0546 6.66634 5.90601 6.66634H5.42731C5.27872 6.66634 5.22484 6.65087 5.17052 6.62182C5.1162 6.59277 5.07357 6.55014 5.04452 6.49582C5.01547 6.44149 4.99999 6.38761 4.99999 6.23903V4.66634H1.76064C1.61206 4.66634 1.55817 4.65087 1.50385 4.62182C1.44953 4.59277 1.4069 4.55014 1.37785 4.49582C1.3488 4.44149 1.33333 4.38761 1.33333 4.23903V3.76032C1.33333 3.61174 1.3488 3.55785 1.37785 3.50353C1.4069 3.44921 1.44953 3.40658 1.50385 3.37753C1.55817 3.34848 1.61206 3.33301 1.76064 3.33301H4.99999Z",fill:"#1F2329"},null,-1)]))}const Va={render:wa},xa={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function Ha(H,v){return r(),m("svg",xa,v[0]||(v[0]=[i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M1.33325 3.66665C1.33325 2.37798 2.37792 1.33331 3.66659 1.33331C4.72358 1.33331 5.61644 2.03615 5.90329 2.99998H14.3333C14.5173 2.99998 14.6666 3.14922 14.6666 3.33331V3.99998C14.6666 4.18407 14.5173 4.33331 14.3333 4.33331H5.90329C5.61644 5.29714 4.72358 5.99998 3.66659 5.99998C2.37792 5.99998 1.33325 4.9553 1.33325 3.66665ZM1.66659 8.66665C1.48249 8.66665 1.33325 8.51741 1.33325 8.33331V7.66665C1.33325 7.48255 1.48249 7.33331 1.66659 7.33331H5.76321C6.05007 6.36949 6.94292 5.66665 7.99992 5.66665C9.05692 5.66665 9.94977 6.36949 10.2366 7.33331H14.3333C14.5173 7.33331 14.6666 7.48255 14.6666 7.66665V8.33331C14.6666 8.51741 14.5173 8.66665 14.3333 8.66665H10.2366C9.94977 9.63047 9.05692 10.3333 7.99992 10.3333C6.94292 10.3333 6.05007 9.63047 5.76321 8.66665H1.66659ZM7.99992 8.99998C8.5522 8.99998 8.99992 8.55226 8.99992 7.99998C8.99992 7.4477 8.5522 6.99998 7.99992 6.99998C7.44764 6.99998 6.99992 7.4477 6.99992 7.99998C6.99992 8.55226 7.44764 8.99998 7.99992 8.99998ZM1.66659 13C1.48249 13 1.33325 12.8507 1.33325 12.6666V12C1.33325 11.8159 1.48249 11.6666 1.66659 11.6666H10.0965C10.3834 10.7028 11.2763 9.99998 12.3333 9.99998C13.6219 9.99998 14.6666 11.0447 14.6666 12.3333C14.6666 13.622 13.6219 14.6666 12.3333 14.6666C11.2763 14.6666 10.3834 13.9638 10.0965 13H1.66659ZM12.3333 11.3333C11.781 11.3333 11.3333 11.781 11.3333 12.3333C11.3333 12.8856 11.781 13.3333 12.3333 13.3333C12.8855 13.3333 13.3333 12.8856 13.3333 12.3333C13.3333 11.781 12.8855 11.3333 12.3333 11.3333ZM3.66659 4.66665C4.21886 4.66665 4.66659 4.21892 4.66659 3.66665C4.66659 3.11436 4.21886 2.66665 3.66659 2.66665C3.1143 2.66665 2.66659 3.11436 2.66659 3.66665C2.66659 4.21892 3.1143 4.66665 3.66659 4.66665Z"},null,-1)]))}const ka={render:Ha},Ta={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ma(H,v){return r(),m("svg",Ta,v[0]||(v[0]=[i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2.53248 2.53248C2.87342 2.19154 3.33584 2 3.818 2H20.182C20.6642 2 21.1266 2.19154 21.4675 2.53248C21.8085 2.87342 22 3.33584 22 3.818V20.182C22 20.6642 21.8085 21.1266 21.4675 21.4675C21.1266 21.8085 20.6642 22 20.182 22H3.818C2.814 22 2 21.186 2 20.182V3.818C2 3.33584 2.19154 2.87342 2.53248 2.53248ZM4 10V14H8V10H4ZM4 16V20H8V16H4ZM10 20H14V16H10V20ZM16 20H20V16H16V20ZM20 14V10H16V14H20ZM14 10H10V14H14V10ZM20 4H4V8H20V4Z",fill:"#1F2329"},null,-1)]))}const Sa={render:Ma},Ea={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function qa(H,v){return r(),m("svg",Ea,v[0]||(v[0]=[i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.9998 2.49994C17.2463 2.49994 21.4998 6.75337 21.4998 11.9999C21.4998 17.2465 17.2463 21.4999 11.9998 21.4999C6.75318 21.4999 2.49976 17.2465 2.49976 11.9999C2.49976 6.75337 6.75318 2.49994 11.9998 2.49994ZM11.9998 0.999939C18.0748 0.999939 22.9998 5.92494 22.9998 11.9999C22.9998 18.0749 18.0748 22.9999 11.9998 22.9999C5.92476 22.9999 0.999756 18.0749 0.999756 11.9999C0.999756 5.92494 5.92476 0.999939 11.9998 0.999939ZM10.2862 17.1138L17.2072 12.7593C17.3352 12.6782 17.4406 12.566 17.5136 12.4333C17.5867 12.3005 17.625 12.1514 17.625 11.9999C17.625 11.8483 17.5867 11.6992 17.5136 11.5664C17.4406 11.4337 17.3352 11.3215 17.2072 11.2404L10.2865 6.8862C10.1449 6.7971 9.98166 6.75 9.81486 6.75C9.69766 6.75039 9.58168 6.77387 9.47355 6.81908C9.36541 6.8643 9.26725 6.93037 9.18465 7.01353C9.10205 7.09668 9.03664 7.19529 8.99215 7.30373C8.94766 7.41216 8.92497 7.5283 8.92536 7.6455V16.3548C8.92547 16.5223 8.97233 16.6865 9.06066 16.8288C9.12209 16.9283 9.20262 17.0147 9.2976 17.083C9.39258 17.1512 9.50013 17.2 9.61406 17.2265C9.72798 17.253 9.84603 17.2567 9.96138 17.2374C10.0767 17.218 10.1871 17.176 10.2862 17.1138Z",fill:"#1F2329"},null,-1)]))}const $a={render:qa},Na=async H=>Wl.post({url:"/sysVariable/query",data:H}),Da={class:"add-sql-name"},La={class:"save-or-cancel flex-align-center"},Za={class:"table-list-top"},Ia={class:"select-ds"},Ua={class:"left-outlined"},Aa={class:"select-ds table-num"},Oa={class:"num"},Pa={key:0,class:"el-empty"},Ya={class:"el-empty__description",style:{"margin-top":"80px",color:"#5e6d82","text-align":"center"}},Ba={key:1,class:"table-checkbox-list"},Ra=["title","onClick"],za={class:"label"},Fa={class:"name-copy"},ja={class:"table-filed"},Wa={class:"top flex-align-center"},Ja={class:"title ellipsis"},Xa={class:"num flex-align-center"},Ga={class:"table-grid"},Qa={class:"flex-align-center icon"},Ka={class:"sql-title"},et={class:"padding-24"},lt={class:"table-sql"},at={key:0,class:"table-scroll"},tt={class:"sql-tips flex-align-center"},st={class:"table-container"},ot={key:1},nt={key:0,class:"handle-system"},it={class:"handle-system_title"},dt={class:"handle-system_list"},rt={class:"system-list"},ut={class:"built-in"},ct=["onClick"],mt={class:"built-in",style:{"margin-top":"16px"}},_t=["onClick"],pt=["title"],vt={class:"content"},ft={class:"select-svg-icon"},ht={key:2,class:"ed-input ed-input--light ed-input-group ed-input-group--prepend de-group__prepend"},gt={class:"ed-input-group__prepend"};function Ct(H){return typeof H=="function"||Object.prototype.toString.call(H)==="[object Object]"&&!Bl(H)}const yt=Ll({__name:"AddSql",props:{sqlNode:{type:Object,default:()=>({})}},emits:["close","save"],setup(H,{emit:v}){const Ue=H,{sqlNode:w}=Zl(Ue),{toClipboard:Ae}=Gl(),{t:n}=Jl(),we=f(""),Ve=f(),V=f(),Oe=n("sql_variable.variable_mgm")+" ",K=f("result"),z=f(""),F=f(!1),de=f(!1),Pe=f(!1),$=f(240),N=f(!0),Ye=f(),c=De({plxTableData:[],variables:[],fields:[],sqlData:[],variablesTmp:[],dataSourceList:[],table:{name:"",id:""},param:{tableId:0}}),x=Il([]),Be=De({currentPage:1,pageSize:10,total:0}),Re=({name:s,enableCheck:o})=>{o&&(we.value=s)},{height:ze}=Xl(),Fe=s=>s.map(o=>({key:o.originName,deType:o.deType,dataKey:o.originName,title:o.originName,width:170,headerCellRenderer:({column:h})=>{let C;return l("div",{class:"flex-align-center"},[l(_,{style:{marginRight:"6px"}},{default:()=>[l(p,null,Ct(C=Yl(ie[ne[h.deType]],{class:`svg-icon field-icon-${ne[h.deType]}`}))?C:{default:()=>[C]})]}),l("span",{class:"ellipsis",title:h.title,style:{width:"120px"}},[h.title])])}})),je=()=>{F.value=!0,ve()},U=f([]),j=f([{id:"sysParams.userId",name:n("system.account")},{id:"sysParams.userName",name:n("datasource.user_name")},{id:"sysParams.userEmail",name:n("commons.email")}]),We=s=>{if(s==="text")return na;if(s==="num")return ia;if(s==="time")return da},Je=s=>{if(s==="text")return"field-icon-text";if(s==="num")return"field-icon-value";if(s==="time")return"field-icon-time"},Xe=Ul(()=>U.value.filter(s=>s.name.toLowerCase().includes(re.value.toLowerCase()))),xe=ra(),ee=f(!1),re=f(""),Ge=()=>{ee.value=!0,ke()},He=s=>{V.value.dispatch({changes:{from:V.value.viewState.state.selection.ranges[0].from,insert:s},selection:{anchor:V.value.viewState.state.selection.ranges[0].from}})},O=(s,o,h,C)=>{let k=h;const L=[...j.value,...U.value].map(E=>E.id),M=[...j.value,...U.value].map(E=>E.name),g=[...j.value,...U.value].reduce((E,T)=>(E[T[s]]=T[o],E),{}),J=h.match(/\[(.+?)\]/g);return J&&J.forEach(E=>{const T=E.slice(1,-1);C&&C.push(g[T]),s==="id"&&L.includes(T)&&(k=k.replace(`[${T}]`,`[${g[T]}]`)),s==="name"&&M.includes(T)&&(k=k.replace(`[${T}]`,`[${g[T]}]`))}),k},ke=async()=>Na({}).then(s=>{U.value=(s==null?void 0:s.data)||[]}),Te=f(!0);Al(async()=>{if(pe(w.value.datasourceId),!xe)try{await ke()}catch(s){s&&(Te.value=!1)}D=R.decode(w.value.sql),V.value=Ve.value.codeComInit(O("id","name",D),!0)}),Ol(()=>{var s,o;(o=(s=V.value).destroy)==null||o.call(s)});const ue=f([]),ce=f(!1),Qe=({datasourceId:s,tableName:o})=>{ce.value=!0,Kl({datasourceId:s,info:JSON.stringify({table:o,sql:""}),tableName:o,type:"db"}).then(C=>{ue.value=C}).finally(()=>{ce.value=!1})},Ke=()=>{ea().then(s=>{const o=s||[];o&&o.length>0&&o[0].id==="0"?c.dataSourceList=o[0].children:c.dataSourceList=o})},W=f(260),el=()=>{document.querySelector(".sql-eidtor").addEventListener("mousemove",Me)},Me=s=>{if(s.pageY-164<64){W.value=64;return}if(s.pageY-164>document.documentElement.clientHeight-200){W.value=document.documentElement.clientHeight-200;return}W.value=s.pageY-164},Se=s=>{if(s.pageX<240){$.value=240;return}if(s.pageX>400){$.value=400;return}$.value=s.pageX},Ee=s=>{V.value.dispatch({changes:{from:0,to:V.value.state.doc.toString().length,insert:""}}),V.value.dispatch({changes:{from:V.value.viewState.state.selection.ranges[0].from,insert:s},selection:{anchor:V.value.viewState.state.selection.ranges[0].from}})};ge(()=>w.value.datasourceId,s=>{pe(s)}),ge(()=>w.value.id,()=>{c.variables=w.value.variables,V.value&&Ee(O("id","name",R.decode(w.value.sql)))},{immediate:!0});const ll={children:"children",label:"name"};Ke();const qe=v;let le=!1;const P=f(!1),$e=()=>{le=!0,P.value=!0};let D="";const al=s=>{if(!w.value.tableName.trim()){Y.error(n("data_set.cannot_be_empty"));return}if(ve(),D=O("name","id",V.value.state.doc.toString()),w.value.changeFlag=!0,!D.trim()){Y.error(n("data_set.cannot_be_empty_de"));return}w.value.sql=R.encode(D),qe("save",{...w.value,sql:R.encode(D),sqlVariableDetails:JSON.stringify(c.variables)},s),le=!1,Y.success(n("common.save_success"))},Ne=()=>{z.value="",c.plxTableData=[],c.fields=[],V.value&&Ee(O("id","name",R.decode(w.value.sql))),qe("close")},tl=()=>{let s=O("name","id",V.value.state.doc.toString());le||D!==s||!s.trim()?hl.confirm(n("chart.tips"),{confirmButtonType:"primary",tip:n("data_set.sure_to_exit"),type:"warning",autofocus:!1,showClose:!1}).then(()=>{Ne(),le=!1,P.value=!1}):(Ne(),P.value=!1)},me=f(!1),sl=()=>{ve(),me.value=!0,la({sql:R.encode(D=O("name","id",V.value.state.doc.toString())),datasourceId:w.value.datasourceId,sqlVariableDetails:JSON.stringify(c.variables)}).then(s=>{c.plxTableData=s.data.data,c.fields=Fe(s.data.fields)}).finally(()=>{me.value=!1})};let _e=[];ge(z,s=>{x.value=_e.filter(o=>o.tableName.includes(s))});const A=s=>{if(["DATETIME-YEAR","DATETIME-YEAR-MONTH","DATETIME","DATETIME-YEAR-MONTH-DAY"].includes(s))return"time";if(s==="TEXT")return"text";if(["LONG","DOUBLE"].includes(s))return"value"},ol=(s,o,h)=>h?`${h} ${n("commons.millisecond")}`:"-",nl=()=>{N.value=!N.value,$.value=N.value?240:0},pe=ua(s=>{de.value=!0,Ql({datasourceId:s}).then(o=>{_e=o||[],x.value=[..._e]}).finally(()=>{de.value=!1})},300),il=()=>{$e(),pe()},ae=async s=>{try{await Ae(s),Y.success(n("data_set.copied_successfully"))}catch(o){Y.warning(n("data_set.not_support_copying"),o)}},dl=()=>{const s=document.querySelector(".sql-eidtor");s.removeEventListener("mousemove",Se),s.removeEventListener("mousemove",Me)},ve=()=>{var C;c.variablesTmp=[];const s=new RegExp("\\${(.*?)}","gim"),o=V.value.state.doc.toString().match(s),h=[];if(o!==null)for(let k=0;k<o.length;k++){let L=o[k].substring(2,o[k].length-1);if(h.indexOf(L)<0){h.push(L);let M;for(let g=0;g<((C=c.variables)==null?void 0:C.length);g++)c.variables[g].variableName===L&&(M=c.variables[g],M.hasOwnProperty("defaultValueScope")||(M.defaultValueScope="EDIT"));M===void 0&&(M={variableName:L,alias:"",type:[],required:!1,defaultValue:"",details:"",defaultValueScope:"EDIT"},M.type.push("TEXT")),c.variablesTmp.push(M)}}c.variables=JSON.parse(JSON.stringify(c.variablesTmp))},rl=()=>{c.variables=JSON.parse(JSON.stringify(c.variablesTmp)),F.value=!1,P.value=!0,Y.success(n("data_set.parameters_set_successfully"))},ul=()=>{document.querySelector(".sql-eidtor").addEventListener("mousemove",Se)};return(s,o)=>{const h=gl,C=Cl,k=yl,L=bl,M=wl,g=Vl,J=xl,E=Hl,T=kl,cl=Tl,ml=Ml,_l=Sl,pl=El,fe=ql,he=$l,te=Nl,vl=Dl,se=Pl("loading");return r(),m(B,null,[i("div",Da,[l(h,{class:"name",ref_key:"editerName",ref:Ye,modelValue:e(w).tableName,"onUpdate:modelValue":o[0]||(o[0]=a=>e(w).tableName=a),onChange:$e},null,8,["modelValue"]),i("div",La,[l(C,{onClick:sl,text:"",style:{color:"#1f2329"}},{icon:t(()=>[l(e(_),null,{default:t(()=>[l(e(p),{name:"reference-play"},{default:t(()=>[l(e(ya),{class:"svg-icon"})]),_:1})]),_:1})]),default:t(()=>[y(" "+u(e(n)("data_set.run")),1)]),_:1}),l(C,{onClick:o[1]||(o[1]=a=>je()),style:{color:"#1f2329"},text:""},{icon:t(()=>[l(e(_),null,{default:t(()=>[l(e(p),{name:"reference-setting"},{default:t(()=>[l(e(Va),{class:"svg-icon"})]),_:1})]),_:1})]),default:t(()=>[y(" "+u(e(n)("data_set.parameter_settings")),1)]),_:1}),!e(xe)&&Te.value?(r(),b(C,{key:0,onClick:Ge,class:"system-text_bg",text:""},{icon:t(()=>[l(e(_),null,{default:t(()=>[l(e(p),null,{default:t(()=>[l(e(ka),{class:"svg-icon"})]),_:1})]),_:1})]),default:t(()=>[y(" "+u(e(n)("auth.sysParams")),1)]),_:1})):q("",!0),l(C,{disabled:!P.value,onClick:o[2]||(o[2]=a=>al(()=>{})),type:"primary"},{default:t(()=>[y(u(e(n)("data_set.save")),1)]),_:1},8,["disabled"]),l(k,{direction:"vertical"}),l(e(_),{class:"hover-icon",onClick:tl},{default:t(()=>[l(e(p),{name:"icon_close_outlined"},{default:t(()=>[l(e(Ze),{class:"svg-icon"})]),_:1})]),_:1})])]),i("div",{class:"sql-eidtor",onMouseup:dl},[Z(i("p",{class:"arrow-right",onClick:nl},[l(e(_),null,{default:t(()=>[l(e(p),{name:"icon_right_outlined"},{default:t(()=>[l(e(Rl),{class:"svg-icon"})]),_:1})]),_:1})],512),[[X,!N.value]]),Z(i("div",{style:G({left:$.value+"px"}),class:"drag-left",onMousedown:ul},null,36),[[X,N.value]]),Z((r(),m("div",{class:"table-list",style:G({width:$.value+"px"})},[i("div",Za,[i("p",Ia,[y(u(e(n)("data_set.current_data_source"))+" ",1),i("span",Ua,[l(e(_),{style:{color:"#1f2329"},onClick:o[3]||(o[3]=a=>N.value=!1)},{default:t(()=>[l(e(p),{name:"icon_left_outlined"},{default:t(()=>[l(e(zl),{class:"svg-icon"})]),_:1})]),_:1})])]),l(L,{"check-strictly":!1,onChange:il,placeholder:e(n)("dataset.pls_slc_data_source"),class:"ds-list","popper-class":"tree-select-ds_popper",modelValue:e(w).datasourceId,"onUpdate:modelValue":o[4]||(o[4]=a=>e(w).datasourceId=a),"node-key":"id",props:ll,data:c.dataSourceList,"render-after-expand":!1},null,8,["placeholder","modelValue","data"]),i("p",Aa,[y(u(e(n)("datasource.data_table")),1),i("span",Oa,[l(e(_),{class:"icon-color"},{default:t(()=>[l(e(p),{name:"reference-table"},{default:t(()=>[l(e(pa),{class:"svg-icon"})]),_:1})]),_:1}),y(" "+u(x.value.length),1)])]),l(h,{modelValue:z.value,"onUpdate:modelValue":o[5]||(o[5]=a=>z.value=a),class:"search",placeholder:e(n)("deDataset.by_table_name"),clearable:""},{prefix:t(()=>[l(e(_),null,{default:t(()=>[l(e(p),{name:"icon_search-outline_outlined"},{default:t(()=>[l(e(Ie),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"])]),!x.value.length&&z.value!==""?(r(),m("div",Pa,[i("div",Ya,u(e(n)("data_set.relevant_content_found")),1)])):(r(),m("div",Ba,[l(e(fl),{itemSize:40,data:x.value,total:x.value.length,width:$.value-17,height:e(ze)-350,scrollbarAlwaysOn:!1,"class-name":"el-select-dropdown__list",layout:"vertical"},{default:t(({index:a,style:d})=>[i("div",{class:I([[{active:we.value===x.value[a].tableName}],"list-item_primary"]),style:G(d),title:x.value[a].tableName,onClick:S=>Re(x.value[a])},[l(e(_),{class:"icon-color"},{default:t(()=>[l(e(p),{name:"icon_form_outlined"},{default:t(()=>[l(e(Sa),{class:"svg-icon"})]),_:1})]),_:1}),i("span",za,u(x.value[a].tableName),1),i("span",Fa,[l(M,{effect:"dark",content:e(n)("common.copy"),placement:"top"},{default:t(()=>[l(e(_),{class:"hover-icon",onClick:S=>ae(x.value[a].tableName)},{default:t(()=>[l(e(p),{name:"icon_copy_outlined"},{default:t(()=>[l(e(Ce),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),l(E,{"popper-class":"sql-table-info",placement:"right",width:502,persistent:!1,onShow:S=>Qe(x.value[a]),trigger:"click"},{reference:t(()=>[l(e(_),{class:"hover-icon"},{default:t(()=>[l(e(p),{name:"icon_info_outlined"},{default:t(()=>[l(e(Fl),{class:"svg-icon"})]),_:1})]),_:1})]),default:t(()=>[Z((r(),m("div",ja,[i("div",Wa,[i("div",Ja,u(x.value[a].name||x.value[a].tableName),1),l(e(_),{class:"hover-icon de-hover-icon-primary",onClick:Le(S=>ae(x.value[a].name||x.value[a].tableName),["stop"])},{default:t(()=>[l(e(p),{name:"icon_copy_outlined"},{default:t(()=>[l(e(Ce),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"]),i("div",Xa,[l(e(_),null,{default:t(()=>[l(e(p),{name:"icon_text-box_outlined"},{default:t(()=>[l(e(ha),{class:"svg-icon"})]),_:1})]),_:1}),y(" "+u(ue.value.length),1)])]),i("div",Ga,[l(J,{height:"405",style:{width:"100%"},"header-cell-class-name":"header-cell",data:ue.value},{default:t(()=>[l(g,{label:e(n)("data_set.physical_field_name")},{default:t(S=>[i("div",Qa,[l(e(_),null,{default:t(()=>[l(e(p),null,{default:t(()=>[(r(),b(oe(e(ie)[e(ne)[S.row.deType]]),{class:I(["svg-icon",`field-icon-${e(ne)[S.row.deType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),y(" "+u(S.row.originName),1)])]),_:1},8,["label"]),l(g,{label:e(n)("common.label")},{default:t(S=>[y(u(S.row.description||"-"),1)]),_:1},8,["label"]),l(g,{label:e(n)("common.operate")},{default:t(S=>[l(e(_),{class:"hover-icon de-hover-icon-primary",onClick:Le(wt=>ae(S.row.originName),["stop"])},{default:t(()=>[l(e(p),{name:"icon_copy_outlined"},{default:t(()=>[l(e(Ce),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])])])),[[se,ce.value]])]),_:2},1032,["onShow"])])],14,Ra)]),_:1},8,["data","total","width","height"])]))],4)),[[se,de.value],[X,N.value]]),i("div",{class:I(["sql-code-right",ee.value&&"p280"]),style:G({width:`calc(100% - ${N.value?$.value:0}px)`})},[l(aa,{onChange:o[6]||(o[6]=a=>P.value=!0),height:`${W.value}px`,"dom-id":"sql-editor",ref_key:"myCm",ref:Ve,quotaMap:U.value.filter(a=>["num"].includes(a.type)).map(a=>a.name),dimensionMap:j.value.concat(U.value.filter(a=>!["num"].includes(a.type))).map(a=>a.name)},null,8,["height","quotaMap","dimensionMap"]),i("div",{class:"sql-result",style:G({height:`calc(100% - ${W.value}px)`})},[i("div",Ka,[i("span",{class:"drag",onMousedown:el},null,32)]),i("div",et,[l(cl,{modelValue:K.value,"onUpdate:modelValue":o[7]||(o[7]=a=>K.value=a)},{default:t(()=>[l(T,{label:e(n)("deDataset.running_results"),name:"result"},null,8,["label"])]),_:1},8,["modelValue"])]),Z(i("div",lt,[c.fields.length?(r(),m("div",at,[l(_l,null,{default:t(({height:a,width:d})=>[Z((r(),b(ml,{columns:c.fields,"header-class":"header-cell",data:c.plxTableData,width:d,height:a,fixed:""},{empty:t(()=>[l(e(ye),{description:e(n)("data_set.no_data"),"img-type":"noneWhite"},null,8,["description"])]),_:2},1032,["columns","data","width","height"])),[[se,me.value]])]),_:1})])):(r(),b(e(ye),{key:1,description:" ","img-type":"noneWhite"},{default:t(()=>[i("div",tt,[y(u(e(n)("data_set.click_above"))+" ",1),l(e(_),null,{default:t(()=>[l(e(p),{name:"icon_play-round_outlined"},{default:t(()=>[l(e($a),{class:"svg-icon"})]),_:1})]),_:1}),y(" "+u(e(n)("data_set.see_the_results")),1)])]),_:1}))],512),[[X,K.value==="result"]]),Z(i("div",st,[Z((r(),b(ta,{"table-data":c.sqlData,"show-pagination":!!c.param.tableId,columns:[],pagination:Be},{default:t(()=>[l(g,{key:"startTimeTable","min-width":"100px",prop:"startTime",label:e(n)("dataset.start_time")},{default:t(a=>[i("span",null,u(e(sa)(a.row.startTime)),1)]),_:1},8,["label"]),l(g,{key:"sql",prop:"sql","show-overflow-tooltip":"",label:e(n)("dataset.sql")},null,8,["label"]),l(g,{key:"spend",prop:"spend",formatter:ol,label:e(n)("dataset.spend_time")},null,8,["label"]),l(g,{key:"status",prop:"status",label:e(n)("dataset.sql_result")},{default:t(a=>[a.row.status?(r(),m("span",{key:0,class:I([`de-${a.row.status}-pre`,"de-status"])},u(e(n)(`dataset.${a.row.status.toLocaleLowerCase()}`)),3)):(r(),m("span",ot,"-"))]),_:1},8,["label"]),l(g,{key:"__operation",label:e(n)("commons.operating"),fixed:"right",width:"100"},{default:t(a=>[l(C,{text:"",onClick:d=>ae(a.row.sql)},{default:t(()=>[y(u(e(n)("common.copy")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["table-data","show-pagination","pagination"])),[[se,Pe.value]])],512),[[X,K.value==="execLog"]])],4),ee.value?(r(),m("div",nt,[i("div",it,[y(u(e(n)("auth.sysParams"))+" ",1),l(e(_),{class:"hover-icon",onClick:o[8]||(o[8]=a=>ee.value=!1)},{default:t(()=>[l(e(p),{name:"icon_close_outlined"},{default:t(()=>[l(e(Ze),{class:"svg-icon"})]),_:1})]),_:1})]),i("div",dt,[l(h,{style:{width:"100%","margin-bottom":"16px"},modelValue:re.value,"onUpdate:modelValue":o[9]||(o[9]=a=>re.value=a),placeholder:e(n)("dataset.edit_search"),clearable:""},{prefix:t(()=>[l(e(_),null,{default:t(()=>[l(e(p),null,{default:t(()=>[l(e(Ie),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),i("div",rt,[i("div",ut,u(e(n)("system.system_built_in_variable")),1),(r(!0),m(B,null,Q(j.value,a=>(r(),m("div",{class:"variable-item flex-align-center",onClick:d=>He(`[${a.name}]`),key:a.id},u(a.name),9,ct))),128)),i("div",mt,u(e(n)("system.custom_variable")),1),(r(!0),m(B,null,Q(Xe.value,a=>(r(),m("div",{class:I(["variable-item flex-align-center",["num"].includes(a.type)&&"with-type"]),key:a.id,onClick:d=>He(`[${a.name}]`)},[l(e(_),null,{default:t(()=>[l(e(p),null,{default:t(()=>[(r(),b(oe(We(a.type)),{class:I(["svg-icon",Je(a.type)])},null,8,["class"]))]),_:2},1024)]),_:2},1024),i("span",{title:a.name},u(a.name),9,pt)],10,_t))),128))])])])):q("",!0)],6)],32),l(vl,{title:Oe,modelValue:F.value,"onUpdate:modelValue":o[12]||(o[12]=a=>F.value=a),"custom-class":"sql-dataset-drawer",size:"870px",direction:"rtl"},{footer:t(()=>[l(C,{secondary:"",onClick:o[10]||(o[10]=a=>F.value=!1)},{default:t(()=>[y(u(e(n)("dataset.cancel")),1)]),_:1}),l(C,{type:"primary",onClick:o[11]||(o[11]=a=>rl())},{default:t(()=>[y(u(e(n)("dataset.confirm")),1)]),_:1})]),default:t(()=>[i("div",vt,[l(e(_),{style:{"font-size":"16px"}},{default:t(()=>[l(e(p),{name:"icon_info_colorful"},{default:t(()=>[l(e(jl),{class:"svg-icon"})]),_:1})]),_:1}),y(" "+u(e(n)("dataset.sql_variable_limit_1")),1),o[13]||(o[13]=i("br",null,null,-1)),y(" "+u(e(n)("dataset.sql_variable_limit_2")),1),o[14]||(o[14]=i("br",null,null,-1))]),l(J,{"header-cell-class-name":"header-cell",data:c.variablesTmp},{empty:t(()=>[l(e(ye),{description:e(n)("data_set.no_data"),"img-type":"noneWhite"},null,8,["description"])]),default:t(()=>[l(g,{width:"220",prop:"variableName",label:e(n)("visualization.param_name")},null,8,["label"]),l(g,{width:"200",label:e(n)("deDataset.parameter_type")},{default:t(a=>[l(pl,{class:"select-type","popper-class":"cascader-panel no-scroll_bar",modelValue:a.row.type,"onUpdate:modelValue":d=>a.row.type=d,options:e(oa),onChange:d=>a.row.defaultValue=""},{default:t(({data:d})=>[l(e(_),null,{default:t(()=>[l(e(p),null,{default:t(()=>[(r(),b(oe(e(ie)[A(d.value)]),{class:I(["svg-icon",`field-icon-${A(d.value)}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),i("span",null,u(d.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","onChange"]),i("span",ft,[l(e(_),null,{default:t(()=>[l(e(p),null,{default:t(()=>[(r(),b(oe(e(ie)[A(a.row.type[0])]),{class:I(["svg-icon",`field-icon-${A(a.row.type[0])}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)])]),_:1},8,["label"]),l(g,{"min-width":"350",prop:"defaultValue",label:e(n)("commons.params_value")},{header:t(()=>[y(u(e(n)("commons.params_value")),1)]),default:t(a=>[A(a.row.type[0])==="text"?(r(),b(h,{key:0,modelValue:a.row.defaultValue,"onUpdate:modelValue":d=>a.row.defaultValue=d,type:"text",placeholder:e(n)("common.please_input")},{prepend:t(()=>[l(he,{modelValue:a.row.defaultValueScope,"onUpdate:modelValue":d=>a.row.defaultValueScope=d,style:{width:"calc(100% + 22px)"}},{default:t(()=>[(r(!0),m(B,null,Q(e(be),d=>(r(),b(fe,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):q("",!0),A(a.row.type[0])==="value"?(r(),b(h,{key:1,modelValue:a.row.defaultValue,"onUpdate:modelValue":d=>a.row.defaultValue=d,placeholder:e(n)("common.please_input"),type:"number"},{prepend:t(()=>[l(he,{modelValue:a.row.defaultValueScope,"onUpdate:modelValue":d=>a.row.defaultValueScope=d,style:{width:"calc(100% + 22px)"}},{default:t(()=>[(r(!0),m(B,null,Q(e(be),d=>(r(),b(fe,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):q("",!0),A(a.row.type[0])==="time"?(r(),m("div",ht,[i("div",gt,[l(he,{modelValue:a.row.defaultValueScope,"onUpdate:modelValue":d=>a.row.defaultValueScope=d,style:{width:"calc(100% + 22px)"}},{default:t(()=>[(r(!0),m(B,null,Q(e(be),d=>(r(),b(fe,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),a.row.type[0]==="DATETIME-YEAR"?(r(),b(te,{key:0,modelValue:a.row.defaultValue,"onUpdate:modelValue":d=>a.row.defaultValue=d,type:"year",format:"YYYY","value-format":"YYYY",placeholder:e(n)("dataset.select_year")},null,8,["modelValue","onUpdate:modelValue","placeholder"])):q("",!0),a.row.type[0]==="DATETIME-YEAR-MONTH"?(r(),b(te,{key:1,modelValue:a.row.defaultValue,"onUpdate:modelValue":d=>a.row.defaultValue=d,type:"month",format:a.row.type[1],"value-format":a.row.type[1],placeholder:e(n)("dataset.select_month")},null,8,["modelValue","onUpdate:modelValue","format","value-format","placeholder"])):q("",!0),a.row.type[0]==="DATETIME-YEAR-MONTH-DAY"?(r(),b(te,{key:2,modelValue:a.row.defaultValue,"onUpdate:modelValue":d=>a.row.defaultValue=d,type:"date",format:a.row.type[1],"value-format":a.row.type[1],placeholder:e(n)("dataset.select_date")},null,8,["modelValue","onUpdate:modelValue","format","value-format","placeholder"])):q("",!0),a.row.type[0]==="DATETIME"?(r(),b(te,{key:3,modelValue:a.row.defaultValue,"onUpdate:modelValue":d=>a.row.defaultValue=d,type:"datetime",format:a.row.type[1],"value-format":a.row.type[1],placeholder:e(n)("dataset.select_time")},null,8,["modelValue","onUpdate:modelValue","format","value-format","placeholder"])):q("",!0)])):q("",!0)]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}});const bt=ca(yt,[["__scopeId","data-v-18d0ea44"]]),Ft=Object.freeze(Object.defineProperty({__proto__:null,default:bt},Symbol.toStringTag,{value:"Module"}));export{bt as A,Ft as a,ha as i,pa as r};

import{q as X,p as ee,d as Se,r as Re,e as Me,t as Oe,I as Je,J as je,G as qe,a as Ue,l as We,g as ze,V as Ie,T as He,m as Ke,n as Pe,w as Qe,v as Ye,h as Ze,L as Xe,x as eo,y as oo}from"./element-plus-secondary-0.0.0-dataease.js";import{j as to,n as ao,a6 as so,h as no}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as lo,r as _,l as j,R as ro,o as v,c as C,a0 as o,_ as a,a as s,a2 as d,u as l,z as io,a1 as q,Y as oe,Z as ue,a4 as x,M as U,a3 as co,ab as mo,n as pe}from"./@vue-0.0.0-dataease.js";import{i as te}from"./icon_add_outlined-0.0.0-dataease.js";import{i as uo}from"./icon_more_outlined-0.0.0-dataease.js";import{i as po}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as _o}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as _e}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{o as fe,F as fo,M as yo,G as vo,N as go,O as ho,n as bo,P as Co,Q as ko}from"./util-0.0.0-dataease2.js";import{E as ye}from"./EmptyBackground-0.0.0-dataease.js";import Ao from"./GeometryEdit-0.0.0-dataease.js";import{a as wo}from"./index-0.0.0-dataease.js";import{T as Eo,d as xo}from"./@antv-0.0.0-dataease.js";import{e as To}from"./@turf-0.0.0-dataease.js";import{d as Bo,e as ve}from"./lodash-es-0.0.0-dataease.js";import{_ as Vo}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./escape-html-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./dv-info-0.0.0-dataease.js";import"./icon_upload_outlined-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./element-resize-detector-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";const Do={class:"geo-title"},Go={class:"geo-search"},Lo={class:"map-tree-container"},Fo=["title","innerHTML"],No={key:1,class:"geo-operate-container"},$o={class:"custom-area-root"},So=["title"],Ro={class:"opt-icon"},Mo={key:0,class:"geo-content-container"},Oo={key:1,class:"geo-content-container"},Jo={class:"geo-content-top"},jo={class:"geo-content-middle"},qo={class:"geo-area"},Uo={class:"area-label"},Wo={class:"area-content"},zo={class:"geo-area"},Io={class:"area-label"},Ho={class:"area-content"},Ko={key:0,class:"area-secondary"},Po={class:"geo-content-bottom"},Qo={class:"area-label"},Yo={key:0},Zo={key:1,class:"sub-area-view"},Xo={class:"sub-area-editor"},et={class:"header"},ot={class:"label"},tt={class:"area-edit-btn"},at=["onClick"],st=["onClick"],nt={class:"dialog-footer"},lt={class:"dialog-footer"},rt=lo({__name:"Geometry",setup(it){const{wsCache:ae}=wo(),{t:n}=to(),W=_(""),F=_([]),N=_(),$=_(null),ge=_(!1),g=_(null),z=_(!0),he=async t=>{var m;g.value=t,(m=H.value)==null||m.setCurrentKey(null),u==null||u.destroy(),u=null,A.id="";const e=ve(await fe(t.id));g.value.geoJson=JSON.stringify(e);const r=t.pid;if(r){const c=$.value.getNode(r);c&&(g.value.parentName=c.data.name)}z.value=!0},be=t=>{X.confirm(n("system.delete_this_node"),{confirmButtonType:"danger",type:"warning",confirmButtonText:n("common.delete"),cancelButtonText:n("dataset.cancel"),autofocus:!1,showClose:!1}).then(()=>{const e="/geometry/delete/"+t.id;ao.post({url:e}).then(()=>{var r;((r=g.value)==null?void 0:r.id)===t.id&&(g.value=null),ee.success(n("common.delete_success")),I(!1)})}).catch(()=>{ge.value=!1})},Ce=t=>{var e;(e=$.value)==null||e.filter(t)},se=(t,e)=>(so(e,t),t?e.name.toLocaleLowerCase().includes(t.toLocaleLowerCase()):!0),I=t=>{const e="de-area-tree",r=ae.get(e);if(r&&t){F.value=r;return}fo().then(m=>{const c=m.data;F.value=[c],ae.set(e,F.value)}).catch(m=>{console.error(m)})},ke=t=>{N==null||N.value.edit(t)};I(!0);const S=_([{id:"000",name:n("system.custom_area")}]),T=_(!1),A=j({id:"",name:""}),H=_(),ne=_(),Ae=async()=>{var t;(t=ne.value)==null||t.validate(async e=>{if(e){const r=await yo(w);if(r.code){ee.error(r.msg);return}await K(),T.value=!1}})},K=async()=>{await vo().then(t=>{var e;(e=t.data)!=null&&e.length?(S.value[0].children=t.data,A.id&&pe(()=>{var r;(r=H.value)==null||r.setCurrentKey(A.id)})):S.value[0].children=null})},w=j({id:"",name:""}),le=t=>{t?(w.id=t.id,w.name=t.name):(w.id="",w.name=""),T.value=!0},we=t=>{X.confirm(n("system.delete_custom_area_tip"),"",{type:"warning",confirmButtonType:"danger",customClass:"area-delete-dialog",autofocus:!1,confirmButtonText:n("common.delete"),showClose:!1}).then(async()=>{var e;await go(t.id),await K(),!((e=S.value[0].children)!=null&&e.length)||t.id===A.id?(R.value=!0,u==null||u.destroy(),u=null):R.value=!1}).catch(()=>{})};let B=null;const Ee=()=>{ho().then(t=>{M.value.splice(0,M.value.length,...t.data),B||(B=M.value.reduce((e,r)=>(e[r.id]=r.name,e),{}))})},R=_(!1),P=async(t,e)=>{var r;(r=$.value)==null||r.setCurrentKey(null),!(t.id==="000"||A.id===t.id&&e!==!0)&&(R.value=!1,A.id=t.id,bo(t.id).then(m=>{const c=m.data.reduce((f,h)=>{var L;const k=((L=h.scope)==null?void 0:L.split(","))||[];h.scopeArr=k;const b=[];k.forEach(Q=>{b.push(B==null?void 0:B[Q])});const E={...h,scopeName:b.join(",")};return f.push(E),f},[]);D.value.splice(0,D.value.length,...c),z.value=!1,pe(()=>{Be()})}))},V=_(!1),p=j({id:"",name:"",scope:"",geoAreaId:"",scopeArr:[]}),M=_([]),D=_([]),re=_(),ie=j({name:[{type:"string",required:!0,message:n("common.input_name"),trigger:"change"},{min:1,max:50,message:n("common.input_limit",[1,50]),trigger:"blur"}],scopeArr:[{type:"array",required:!0,message:n("system.please_select_area"),trigger:"change"}]}),ce=t=>{p.geoAreaId=A.id,t?(p.name=t.name,p.scopeArr=t.scopeArr,p.id=t.id,p.scope=t.scope):(p.name="",p.scopeArr=[],p.id="",p.scope=""),V.value=!0},xe=async()=>{var t;(t=re.value)==null||t.validate(async e=>{if(!e)return;p.scope=p.scopeArr.join(",");const r=await Co(p);if(r.code){ee.error(r.msg);return}await P({id:A.id},!0),V.value=!1})},Te=async t=>{X.confirm(n("system.delete_custom_sub_area_tip"),"",{type:"warning",confirmButtonType:"danger",customClass:"area-delete-dialog",autofocus:!1,confirmButtonText:n("common.delete"),showClose:!1}).then(async()=>{await ko(t.id),await P({id:A.id},!0)}).catch(()=>{})};K(),Ee();const O=["#1E90FF","#90EE90","#00CED1","#E2BD84","#7A90E0","#3BA272","#2BE7FF","#0A8ADA","#FFD700"],G={map:{type:"mapbox",style:"blank"},geoArea:{type:"geojson"},source:{data:[],joinBy:{sourceField:"name",geoField:"name"}},viewLevel:{adcode:"all",level:"world"},autoFit:!0,chinaBorder:!1,style:{stroke:"grey",opacity:1,lineWidth:.6,lineOpacity:1},label:!1,state:{active:{stroke:"green",lineWidth:1}},legend:!1,tooltip:!1,customFetchGeoData:()=>null};let u=null;const Be=Bo(async()=>{var m;if(!G.source.joinBy.geoData){const c=ve(await fe("156"));G.source.joinBy.geoData=c}const t=G.source.joinBy.geoData.features.reduce((c,f)=>(f.properties.adcode&&(c["156"+f.properties.adcode]=f),c),{}),e=[];(m=D.value)==null||m.forEach(c=>{var h;const f=[];if((h=c.scopeArr)==null||h.forEach(k=>{const b=t[k];b&&f.push(b)}),f.length){const b=To({type:"FeatureCollection",features:f});e.push({name:c.name,x:b.geometry.coordinates[0],y:b.geometry.coordinates[1]})}});const r=new Eo({name:"areaTextLayer",source:{data:e,parser:{type:"json",x:"x",y:"y"}},field:"name",style:{fill:"black",fontSize:20,opacity:1,fontWeight:"bold",textAnchor:"center",textAllowOverlap:!0}});if(u){const c=u.getLayerByName("areaTextLayer");c&&u.removeLayer(c),u.addLayer(r),u.update({})}else G.color={field:["name","adcode"],value:c=>{var h;let f="white";return(h=D.value)==null||h.forEach((k,b)=>{var E;(E=k.scopeArr)!=null&&E.includes("156"+c.adcode)&&(f=O[b%O.length])}),f},scale:{type:"quantize",unknown:"white"}},u=new xo("map-container",G),u.on("loaded",()=>{u.addLayer(r)})},500);return ro(()=>{u==null||u.destroy()}),(t,e)=>{const r=no,m=Se,c=Re,f=Me,h=Oe,k=Je,b=je,E=qe,L=Ue,Q=We,Ve=ze,Y=Ie,De=He,Ge=Ke,Le=Pe,Z=Qe,me=Ye,J=Ze,de=Xe,Fe=eo,Ne=oo;return v(),C(U,null,[o(Le,{class:"geometry-container"},{default:a(()=>[o(Q,{class:"geonetry-aside"},{default:a(()=>[s("div",Do,[s("span",null,d(l(n)("online_map.geometry")),1)]),s("div",Go,[o(c,{class:"m16 w100",modelValue:W.value,"onUpdate:modelValue":e[0]||(e[0]=i=>W.value=i),clearable:"",placeholder:l(n)("commons.search"),onChange:Ce},{prefix:a(()=>[o(m,null,{default:a(()=>[o(r,{name:"icon_search-outline_outlined"},{default:a(()=>[o(l(_o),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"])]),s("div",Lo,[o(L,{class:"menu-tree"},{default:a(()=>[o(h,{menu:"",ref_key:"areaTreeRef",ref:$,"node-key":"id",data:F.value,onNodeClick:he,"highlight-current":!0,"expand-on-click-node":!1,"default-expand-all":!1,"filter-node-method":se},{default:a(({node:i,data:y})=>[s("span",{class:io(["custom-tree-node",{"is-disabled":i.disabled||y.root}])},[s("span",{class:"geo-name-span",title:y.name,innerHTML:y.colorName&&W.value?y.colorName:y.name},null,8,Fo),y.id==="000"?(v(),C("span",{key:0,class:"add-icon-span",onClick:e[1]||(e[1]=q($e=>ke(),["stop"]))},[o(m,null,{default:a(()=>[o(r,{name:"icon_add_outlined"},{default:a(()=>[o(l(te),{class:"svg-icon"})]),_:1})]),_:1})])):oe("",!0),y.custom?(v(),C("span",No,[o(f,{class:"box-item",effect:"dark",content:l(n)("common.delete"),placement:"top"},{default:a(()=>[o(m,{onClick:q($e=>be(y),["stop"]),class:"hover-icon"},{default:a(()=>[o(r,{name:"icon_delete-trash_outlined"},{default:a(()=>[o(l(_e),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])):oe("",!0)],2)]),_:1},8,["data"]),o(h,{menu:"",ref_key:"customAreaTreeRef",ref:H,"node-key":"id",data:S.value,"highlight-current":!0,"expand-on-click-node":!1,"default-expand-all":!1,"filter-node-method":se,onNodeClick:P},{default:a(({data:i})=>[s("span",$o,[s("span",{class:"label",title:i.name},d(i.name),9,So),i.id==="000"?(v(),C("span",{key:0,class:"opt-icon",onClick:e[2]||(e[2]=q(y=>le(),["stop"]))},[o(m,null,{default:a(()=>[o(r,{name:"icon_add_outlined"},{default:a(()=>[o(l(te))]),_:1})]),_:1})])):(v(),ue(E,{key:1,placement:"bottom-end","popper-class":"area-opt-popper"},{dropdown:a(()=>[o(b,null,{default:a(()=>[o(k,{onClick:y=>le(i)},{default:a(()=>[x(d(l(n)("chart.rename")),1)]),_:2},1032,["onClick"]),o(k,{onClick:q(y=>we(i),["stop"])},{default:a(()=>[x(d(l(n)("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[s("span",Ro,[o(m,null,{default:a(()=>[o(r,{name:"icon_more_outlined"},{default:a(()=>[o(l(uo))]),_:1})]),_:1})])]),_:2},1024))])]),_:1},8,["data"])]),_:1})])]),_:1}),o(Ge,{class:"geometry-main"},{default:a(()=>[z.value?(v(),C(U,{key:0},[g.value?(v(),C("div",Oo,[s("div",Jo,[s("span",null,d(g.value.name),1)]),s("div",jo,[s("div",qo,[s("div",Uo,[s("span",null,d(l(n)("system.region_code")),1)]),s("div",Wo,[s("span",null,d(g.value.id),1)])]),s("div",zo,[s("div",Io,[s("span",null,d(l(n)("system.superior_region")),1)]),s("div",Ho,[s("span",null,d(g.value.parentName||"-"),1),g.value.pid?(v(),C("span",Ko,d("("+g.value.pid+")"),1)):oe("",!0)])])]),s("div",Po,[s("div",Qo,[s("span",null,d(l(n)("system.coordinate_file")),1)]),o(L,{class:"area-content-geo"},{default:a(()=>[s("span",null,d(g.value.geoJson),1)]),_:1})])])):(v(),C("div",Mo,[o(ye,{"img-type":"noneWhite",description:l(n)("system.on_the_left")},null,8,["description"])]))],64)):(v(),C(U,{key:1},[R.value?(v(),C("div",Yo,[o(ye,{"img-type":"noneWhite",description:l(n)("system.on_the_left")},null,8,["description"])])):(v(),C("div",Zo,[e[14]||(e[14]=s("div",{id:"map-container",class:"map-container"},null,-1)),s("div",Xo,[o(Ve),s("span",et,[s("span",ot,[s("span",null,d(l(n)("system.custom_area")),1),s("span",null,"("+d(l(n)("system.custom_area_tip"))+")",1)]),s("span",{class:"add-btn",onClick:e[3]||(e[3]=i=>ce())},[o(m,null,{default:a(()=>[o(r,{name:"icon_add_outlined"},{default:a(()=>[o(l(te))]),_:1})]),_:1}),s("span",null,d(l(n)("system.add_area")),1)])]),o(De,{data:D.value,stripe:"",style:{width:"100%"},height:300},{default:a(()=>[o(Y,{prop:"name",label:l(n)("system.area_name")},{default:a(({row:i,$index:y})=>[s("span",{class:"area-color-symbol",style:co({backgroundColor:O[y%O.length]})},null,4),s("span",null,d(i.name),1)]),_:1},8,["label"]),o(Y,{prop:"scopeName",label:l(n)("system.area_scope")},null,8,["label"]),o(Y,{fixed:"right",label:l(n)("system.operation"),"min-width":"120"},{default:a(({row:i})=>[s("div",tt,[s("span",{onClick:y=>ce(i)},[o(m,null,{default:a(()=>[o(r,{name:"icon_edit_outlined"},{default:a(()=>[o(l(po))]),_:1})]),_:1})],8,at),s("span",{onClick:y=>Te(i)},[o(m,null,{default:a(()=>[o(r,{name:"icon_delete-trash_outlined"},{default:a(()=>[o(l(_e))]),_:1})]),_:1})],8,st)])]),_:1},8,["label"])]),_:1},8,["data"])])]))],64))]),_:1})]),_:1}),o(Ao,{ref_key:"editor",ref:N,onSaved:e[4]||(e[4]=i=>I(!1))},null,512),o(de,{modelValue:T.value,"onUpdate:modelValue":e[8]||(e[8]=i=>T.value=i),class:"create-dialog",title:`${w.id?l(n)("common.edit"):l(n)("common.add")} ${l(n)("system.custom_area")}`,width:"500","destroy-on-close":""},{footer:a(()=>[s("div",nt,[o(J,{onClick:e[6]||(e[6]=i=>T.value=!1)},{default:a(()=>[x(d(l(n)("common.cancel")),1)]),_:1}),o(J,{type:"primary",onClick:e[7]||(e[7]=i=>Ae())},{default:a(()=>[x(d(l(n)("common.sure")),1)]),_:1})])]),default:a(()=>[o(me,{ref_key:"areaFormRef",ref:ne,model:w,"label-position":"top","label-width":"auto",rules:ie},{default:a(()=>[o(Z,{"label-position":"top",required:"",prop:"name"},{default:a(()=>[o(c,{modelValue:w.name,"onUpdate:modelValue":e[5]||(e[5]=i=>w.name=i),minlenegth:1,maxlength:50},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),o(de,{modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=i=>V.value=i),title:`${p.id?l(n)("common.edit"):l(n)("common.add")} ${l(n)("system.custom_area")}`,width:"500","destroy-on-close":""},{footer:a(()=>[s("div",lt,[o(J,{onClick:e[11]||(e[11]=i=>V.value=!1)},{default:a(()=>[x(d(l(n)("common.cancel")),1)]),_:1}),o(J,{type:"primary",onClick:e[12]||(e[12]=i=>xe())},{default:a(()=>[x(d(l(n)("common.sure")),1)]),_:1})])]),default:a(()=>[o(me,{ref_key:"subAreaFormRef",ref:re,model:p,"label-position":"top","label-width":"auto",rules:ie},{default:a(()=>[o(Z,{label:l(n)("system.area_name"),"label-position":"top",prop:"name"},{default:a(()=>[o(c,{modelValue:p.name,"onUpdate:modelValue":e[9]||(e[9]=i=>p.name=i),minlenegth:1,maxlength:50},null,8,["modelValue"])]),_:1},8,["label"]),o(Z,{label:l(n)("system.sub_area_tip"),"label-position":"top",prop:"scopeArr"},{default:a(()=>[o(Ne,{modelValue:p.scopeArr,"onUpdate:modelValue":e[10]||(e[10]=i=>p.scopeArr=i),multiple:"",style:{width:"100%"},filterable:""},{default:a(()=>[(v(!0),C(U,null,mo(M.value,i=>(v(),ue(Fe,{key:i.id,value:i.id,label:i.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}});const us=Vo(rt,[["__scopeId","data-v-ad52f6ca"]]);export{us as default};

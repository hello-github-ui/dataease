import{a as Se,M as Re}from"./index-0.0.0-dataease.js";import{o as Me,F as X,x as Oe,D as ee,aU as je,n as Je,j as Ue,G as We,y as qe}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as ze,a as Ie}from"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as He}from"./el-dialog-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{a as Ke,E as Pe}from"./el-form-item-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import"./el-aside-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import{a as Qe,E as Ye}from"./el-table-column-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{E as Ze}from"./el-divider-0.0.0-dataease.js";import{a as Xe,b as eo,E as oo}from"./el-dropdown-menu-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import{E as to}from"./el-tree-0.0.0-dataease.js";import{d as ao,r as _,Z as J,ak as so,f as v,L as C,k as o,i as a,M as s,a6 as m,j as l,U as no,ab as U,a0 as oe,g as ue,a5 as x,Y as W,V as lo,a9 as ro,n as pe}from"./vue-0.0.0-dataease.js";import{i as te}from"./icon_add_outlined-0.0.0-dataease.js";import{i as io}from"./icon_more_outlined-0.0.0-dataease.js";import{i as co}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as mo}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as _e}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{o as fe,F as uo,M as po,G as _o,N as fo,O as yo,n as vo,P as go,Q as ho}from"./util-0.0.0-dataease2.js";import{E as ye}from"./EmptyBackground-0.0.0-dataease.js";import bo from"./GeometryEdit-0.0.0-dataease.js";import{T as Co,d as ko}from"./antv-0.0.0-dataease.js";import{c as Ao}from"./index-0.0.0-dataease20.js";import{e as wo,d as ve}from"./lodash-0.0.0-dataease.js";import{E as Eo}from"./index-0.0.0-dataease3.js";import{a as xo,b as To,c as Bo}from"./index-0.0.0-dataease14.js";import{_ as Vo}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./index-0.0.0-dataease13.js";import"./chart-0.0.0-dataease.js";import"./formatter-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./el-empty-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./el-drawer-0.0.0-dataease.js";import"./el-upload-0.0.0-dataease.js";import"./el-progress-0.0.0-dataease.js";import"./el-tree-select-0.0.0-dataease.js";import"./dv-info-0.0.0-dataease.js";import"./icon_upload_outlined-0.0.0-dataease.js";const Do={class:"geo-title"},Fo={class:"geo-search"},Go={class:"map-tree-container"},Lo=["title","innerHTML"],No={key:1,class:"geo-operate-container"},$o={class:"custom-area-root"},So=["title"],Ro={class:"opt-icon"},Mo={key:0,class:"geo-content-container"},Oo={key:1,class:"geo-content-container"},jo={class:"geo-content-top"},Jo={class:"geo-content-middle"},Uo={class:"geo-area"},Wo={class:"area-label"},qo={class:"area-content"},zo={class:"geo-area"},Io={class:"area-label"},Ho={class:"area-content"},Ko={key:0,class:"area-secondary"},Po={class:"geo-content-bottom"},Qo={class:"area-label"},Yo={key:0},Zo={key:1,class:"sub-area-view"},Xo={class:"sub-area-editor"},et={class:"header"},ot={class:"label"},tt={class:"area-edit-btn"},at=["onClick"],st=["onClick"],nt={class:"dialog-footer"},lt={class:"dialog-footer"},rt=ao({__name:"Geometry",setup(it){const{wsCache:ae}=Se(),{t:n}=Me(),q=_(""),L=_([]),N=_(),$=_(null),ge=_(!1),g=_(null),z=_(!0),he=async t=>{var d;g.value=t,(d=H.value)==null||d.setCurrentKey(null),u==null||u.destroy(),u=null,A.id="";const e=ve(await fe(t.id));g.value.geoJson=JSON.stringify(e);const r=t.pid;if(r){const c=$.value.getNode(r);c&&(g.value.parentName=c.data.name)}z.value=!0},be=t=>{X.confirm(n("system.delete_this_node"),{confirmButtonType:"danger",type:"warning",confirmButtonText:n("common.delete"),cancelButtonText:n("dataset.cancel"),autofocus:!1,showClose:!1}).then(()=>{const e="/geometry/delete/"+t.id;Oe.post({url:e}).then(()=>{var r;((r=g.value)==null?void 0:r.id)===t.id&&(g.value=null),ee.success(n("common.delete_success")),I(!1)})}).catch(()=>{ge.value=!1})},Ce=t=>{var e;(e=$.value)==null||e.filter(t)},se=(t,e)=>(je(e,t),t?e.name.toLocaleLowerCase().includes(t.toLocaleLowerCase()):!0),I=t=>{const e="de-area-tree",r=ae.get(e);if(r&&t){L.value=r;return}uo().then(d=>{const c=d.data;L.value=[c],ae.set(e,L.value)}).catch(d=>{console.error(d)})},ke=t=>{N==null||N.value.edit(t)};I(!0);const S=_([{id:"000",name:n("system.custom_area")}]),T=_(!1),A=J({id:"",name:""}),H=_(),ne=_(),Ae=async()=>{var t;(t=ne.value)==null||t.validate(async e=>{if(e){const r=await po(w);if(r.code){ee.error(r.msg);return}await K(),T.value=!1}})},K=async()=>{await _o().then(t=>{var e;(e=t.data)!=null&&e.length?(S.value[0].children=t.data,A.id&&pe(()=>{var r;(r=H.value)==null||r.setCurrentKey(A.id)})):S.value[0].children=null})},w=J({id:"",name:""}),le=t=>{t?(w.id=t.id,w.name=t.name):(w.id="",w.name=""),T.value=!0},we=t=>{X.confirm(n("system.delete_custom_area_tip"),"",{type:"warning",confirmButtonType:"danger",customClass:"area-delete-dialog",autofocus:!1,confirmButtonText:n("common.delete"),showClose:!1}).then(async()=>{var e;await fo(t.id),await K(),!((e=S.value[0].children)!=null&&e.length)||t.id===A.id?(R.value=!0,u==null||u.destroy(),u=null):R.value=!1}).catch(()=>{})};let B=null;const Ee=()=>{yo().then(t=>{M.value.splice(0,M.value.length,...t.data),B||(B=M.value.reduce((e,r)=>(e[r.id]=r.name,e),{}))})},R=_(!1),P=async(t,e)=>{var r;(r=$.value)==null||r.setCurrentKey(null),!(t.id==="000"||A.id===t.id&&e!==!0)&&(R.value=!1,A.id=t.id,vo(t.id).then(d=>{const c=d.data.reduce((f,h)=>{var G;const k=((G=h.scope)==null?void 0:G.split(","))||[];h.scopeArr=k;const b=[];k.forEach(Q=>{b.push(B==null?void 0:B[Q])});const E={...h,scopeName:b.join(",")};return f.push(E),f},[]);D.value.splice(0,D.value.length,...c),z.value=!1,pe(()=>{Be()})}))},V=_(!1),p=J({id:"",name:"",scope:"",geoAreaId:"",scopeArr:[]}),M=_([]),D=_([]),re=_(),ie=J({name:[{type:"string",required:!0,message:n("common.input_name"),trigger:"change"},{min:1,max:50,message:n("common.input_limit",[1,50]),trigger:"blur"}],scopeArr:[{type:"array",required:!0,message:n("system.please_select_area"),trigger:"change"}]}),ce=t=>{p.geoAreaId=A.id,t?(p.name=t.name,p.scopeArr=t.scopeArr,p.id=t.id,p.scope=t.scope):(p.name="",p.scopeArr=[],p.id="",p.scope=""),V.value=!0},xe=async()=>{var t;(t=re.value)==null||t.validate(async e=>{if(!e)return;p.scope=p.scopeArr.join(",");const r=await go(p);if(r.code){ee.error(r.msg);return}await P({id:A.id},!0),V.value=!1})},Te=async t=>{X.confirm(n("system.delete_custom_sub_area_tip"),"",{type:"warning",confirmButtonType:"danger",customClass:"area-delete-dialog",autofocus:!1,confirmButtonText:n("common.delete"),showClose:!1}).then(async()=>{await ho(t.id),await P({id:A.id},!0)}).catch(()=>{})};K(),Ee();const O=["#1E90FF","#90EE90","#00CED1","#E2BD84","#7A90E0","#3BA272","#2BE7FF","#0A8ADA","#FFD700"],F={map:{type:"mapbox",style:"blank"},geoArea:{type:"geojson"},source:{data:[],joinBy:{sourceField:"name",geoField:"name"}},viewLevel:{adcode:"all",level:"world"},autoFit:!0,chinaBorder:!1,style:{stroke:"grey",opacity:1,lineWidth:.6,lineOpacity:1},label:!1,state:{active:{stroke:"green",lineWidth:1}},legend:!1,tooltip:!1,customFetchGeoData:()=>null};let u=null;const Be=wo(async()=>{var d;if(!F.source.joinBy.geoData){const c=ve(await fe("156"));F.source.joinBy.geoData=c}const t=F.source.joinBy.geoData.features.reduce((c,f)=>(f.properties.adcode&&(c["156"+f.properties.adcode]=f),c),{}),e=[];(d=D.value)==null||d.forEach(c=>{var h;const f=[];if((h=c.scopeArr)==null||h.forEach(k=>{const b=t[k];b&&f.push(b)}),f.length){const b=Ao({type:"FeatureCollection",features:f});e.push({name:c.name,x:b.geometry.coordinates[0],y:b.geometry.coordinates[1]})}});const r=new Co({name:"areaTextLayer",source:{data:e,parser:{type:"json",x:"x",y:"y"}},field:"name",style:{fill:"black",fontSize:20,opacity:1,fontWeight:"bold",textAnchor:"center",textAllowOverlap:!0}});if(u){const c=u.getLayerByName("areaTextLayer");c&&u.removeLayer(c),u.addLayer(r),u.update({})}else F.color={field:["name","adcode"],value:c=>{var h;let f="white";return(h=D.value)==null||h.forEach((k,b)=>{var E;(E=k.scopeArr)!=null&&E.includes("156"+c.adcode)&&(f=O[b%O.length])}),f},scale:{type:"quantize",unknown:"white"}},u=new ko("map-container",F),u.on("loaded",()=>{u.addLayer(r)})},500);return so(()=>{u==null||u.destroy()}),(t,e)=>{const r=Je,d=Ue,c=We,f=Eo,h=to,k=Xe,b=eo,E=oo,G=Re,Q=xo,Ve=Ze,Y=Qe,De=Ye,Fe=To,Ge=Bo,Z=Ke,de=Pe,j=qe,me=He,Le=ze,Ne=Ie;return v(),C(W,null,[o(Ge,{class:"geometry-container"},{default:a(()=>[o(Q,{class:"geonetry-aside"},{default:a(()=>[s("div",Do,[s("span",null,m(l(n)("online_map.geometry")),1)]),s("div",Fo,[o(c,{class:"m16 w100",modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=i=>q.value=i),clearable:"",placeholder:l(n)("commons.search"),onChange:Ce},{prefix:a(()=>[o(d,null,{default:a(()=>[o(r,{name:"icon_search-outline_outlined"},{default:a(()=>[o(l(mo),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"])]),s("div",Go,[o(G,{class:"menu-tree"},{default:a(()=>[o(h,{menu:"",ref_key:"areaTreeRef",ref:$,"node-key":"id",data:L.value,onNodeClick:he,"highlight-current":!0,"expand-on-click-node":!1,"default-expand-all":!1,"filter-node-method":se},{default:a(({node:i,data:y})=>[s("span",{class:no(["custom-tree-node",{"is-disabled":i.disabled||y.root}])},[s("span",{class:"geo-name-span",title:y.name,innerHTML:y.colorName&&q.value?y.colorName:y.name},null,8,Lo),y.id==="000"?(v(),C("span",{key:0,class:"add-icon-span",onClick:e[1]||(e[1]=U($e=>ke(),["stop"]))},[o(d,null,{default:a(()=>[o(r,{name:"icon_add_outlined"},{default:a(()=>[o(l(te),{class:"svg-icon"})]),_:1})]),_:1})])):oe("",!0),y.custom?(v(),C("span",No,[o(f,{class:"box-item",effect:"dark",content:l(n)("common.delete"),placement:"top"},{default:a(()=>[o(d,{onClick:U($e=>be(y),["stop"]),class:"hover-icon"},{default:a(()=>[o(r,{name:"icon_delete-trash_outlined"},{default:a(()=>[o(l(_e),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])):oe("",!0)],2)]),_:1},8,["data"]),o(h,{menu:"",ref_key:"customAreaTreeRef",ref:H,"node-key":"id",data:S.value,"highlight-current":!0,"expand-on-click-node":!1,"default-expand-all":!1,"filter-node-method":se,onNodeClick:P},{default:a(({data:i})=>[s("span",$o,[s("span",{class:"label",title:i.name},m(i.name),9,So),i.id==="000"?(v(),C("span",{key:0,class:"opt-icon",onClick:e[2]||(e[2]=U(y=>le(),["stop"]))},[o(d,null,{default:a(()=>[o(r,{name:"icon_add_outlined"},{default:a(()=>[o(l(te))]),_:1})]),_:1})])):(v(),ue(E,{key:1,placement:"bottom-end","popper-class":"area-opt-popper"},{dropdown:a(()=>[o(b,null,{default:a(()=>[o(k,{onClick:y=>le(i)},{default:a(()=>[x(m(l(n)("chart.rename")),1)]),_:2},1032,["onClick"]),o(k,{onClick:U(y=>we(i),["stop"])},{default:a(()=>[x(m(l(n)("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[s("span",Ro,[o(d,null,{default:a(()=>[o(r,{name:"icon_more_outlined"},{default:a(()=>[o(l(io))]),_:1})]),_:1})])]),_:2},1024))])]),_:1},8,["data"])]),_:1})])]),_:1}),o(Fe,{class:"geometry-main"},{default:a(()=>[z.value?(v(),C(W,{key:0},[g.value?(v(),C("div",Oo,[s("div",jo,[s("span",null,m(g.value.name),1)]),s("div",Jo,[s("div",Uo,[s("div",Wo,[s("span",null,m(l(n)("system.region_code")),1)]),s("div",qo,[s("span",null,m(g.value.id),1)])]),s("div",zo,[s("div",Io,[s("span",null,m(l(n)("system.superior_region")),1)]),s("div",Ho,[s("span",null,m(g.value.parentName||"-"),1),g.value.pid?(v(),C("span",Ko,m("("+g.value.pid+")"),1)):oe("",!0)])])]),s("div",Po,[s("div",Qo,[s("span",null,m(l(n)("system.coordinate_file")),1)]),o(G,{class:"area-content-geo"},{default:a(()=>[s("span",null,m(g.value.geoJson),1)]),_:1})])])):(v(),C("div",Mo,[o(ye,{"img-type":"noneWhite",description:l(n)("system.on_the_left")},null,8,["description"])]))],64)):(v(),C(W,{key:1},[R.value?(v(),C("div",Yo,[o(ye,{"img-type":"noneWhite",description:l(n)("system.on_the_left")},null,8,["description"])])):(v(),C("div",Zo,[e[14]||(e[14]=s("div",{id:"map-container",class:"map-container"},null,-1)),s("div",Xo,[o(Ve),s("span",et,[s("span",ot,[s("span",null,m(l(n)("system.custom_area")),1),s("span",null,"("+m(l(n)("system.custom_area_tip"))+")",1)]),s("span",{class:"add-btn",onClick:e[3]||(e[3]=i=>ce())},[o(d,null,{default:a(()=>[o(r,{name:"icon_add_outlined"},{default:a(()=>[o(l(te))]),_:1})]),_:1}),s("span",null,m(l(n)("system.add_area")),1)])]),o(De,{data:D.value,stripe:"",style:{width:"100%"},height:300},{default:a(()=>[o(Y,{prop:"name",label:l(n)("system.area_name")},{default:a(({row:i,$index:y})=>[s("span",{class:"area-color-symbol",style:lo({backgroundColor:O[y%O.length]})},null,4),s("span",null,m(i.name),1)]),_:1},8,["label"]),o(Y,{prop:"scopeName",label:l(n)("system.area_scope")},null,8,["label"]),o(Y,{fixed:"right",label:l(n)("system.operation"),"min-width":"120"},{default:a(({row:i})=>[s("div",tt,[s("span",{onClick:y=>ce(i)},[o(d,null,{default:a(()=>[o(r,{name:"icon_edit_outlined"},{default:a(()=>[o(l(co))]),_:1})]),_:1})],8,at),s("span",{onClick:y=>Te(i)},[o(d,null,{default:a(()=>[o(r,{name:"icon_delete-trash_outlined"},{default:a(()=>[o(l(_e))]),_:1})]),_:1})],8,st)])]),_:1},8,["label"])]),_:1},8,["data"])])]))],64))]),_:1})]),_:1}),o(bo,{ref_key:"editor",ref:N,onSaved:e[4]||(e[4]=i=>I(!1))},null,512),o(me,{modelValue:T.value,"onUpdate:modelValue":e[8]||(e[8]=i=>T.value=i),class:"create-dialog",title:`${w.id?l(n)("common.edit"):l(n)("common.add")} ${l(n)("system.custom_area")}`,width:"500","destroy-on-close":""},{footer:a(()=>[s("div",nt,[o(j,{onClick:e[6]||(e[6]=i=>T.value=!1)},{default:a(()=>[x(m(l(n)("common.cancel")),1)]),_:1}),o(j,{type:"primary",onClick:e[7]||(e[7]=i=>Ae())},{default:a(()=>[x(m(l(n)("common.sure")),1)]),_:1})])]),default:a(()=>[o(de,{ref_key:"areaFormRef",ref:ne,model:w,"label-position":"top","label-width":"auto",rules:ie},{default:a(()=>[o(Z,{"label-position":"top",required:"",prop:"name"},{default:a(()=>[o(c,{modelValue:w.name,"onUpdate:modelValue":e[5]||(e[5]=i=>w.name=i),minlenegth:1,maxlength:50},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),o(me,{modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=i=>V.value=i),title:`${p.id?l(n)("common.edit"):l(n)("common.add")} ${l(n)("system.custom_area")}`,width:"500","destroy-on-close":""},{footer:a(()=>[s("div",lt,[o(j,{onClick:e[11]||(e[11]=i=>V.value=!1)},{default:a(()=>[x(m(l(n)("common.cancel")),1)]),_:1}),o(j,{type:"primary",onClick:e[12]||(e[12]=i=>xe())},{default:a(()=>[x(m(l(n)("common.sure")),1)]),_:1})])]),default:a(()=>[o(de,{ref_key:"subAreaFormRef",ref:re,model:p,"label-position":"top","label-width":"auto",rules:ie},{default:a(()=>[o(Z,{label:l(n)("system.area_name"),"label-position":"top",prop:"name"},{default:a(()=>[o(c,{modelValue:p.name,"onUpdate:modelValue":e[9]||(e[9]=i=>p.name=i),minlenegth:1,maxlength:50},null,8,["modelValue"])]),_:1},8,["label"]),o(Z,{label:l(n)("system.sub_area_tip"),"label-position":"top",prop:"scopeArr"},{default:a(()=>[o(Ne,{modelValue:p.scopeArr,"onUpdate:modelValue":e[10]||(e[10]=i=>p.scopeArr=i),multiple:"",style:{width:"100%"},filterable:""},{default:a(()=>[(v(!0),C(W,null,ro(M.value,i=>(v(),ue(Le,{key:i.id,value:i.id,label:i.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}});const pa=Vo(rt,[["__scopeId","data-v-ad52f6ca"]]);export{pa as default};

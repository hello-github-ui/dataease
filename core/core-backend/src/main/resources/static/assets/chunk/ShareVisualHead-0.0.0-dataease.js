import{p as Z,b as We,an as Ze}from"./index-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Fe}from"./el-popover-0.0.0-dataease.js";import{E as Ye}from"./el-divider-0.0.0-dataease.js";import{E as Je}from"./el-date-picker-0.0.0-dataease.js";import{o as Ke,x as T,D as I,n as he,y as Qe,j as Xe,G as et}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as tt}from"./el-checkbox-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{E as ot}from"./el-switch-0.0.0-dataease.js";import{d as at,r as m,Z as st,w as nt,G as F,aa as lt,f,L as v,k as s,i as l,g as z,a0 as h,Y as it,T as ve,j as c,a5 as q,a6 as w,M as u,U as Y,aw as rt,ab as J,n as A,W as ct}from"./vue-0.0.0-dataease.js";import{u as dt,i as ut}from"./share-0.0.0-dataease.js";import{i as pt}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as ft}from"./icon_close_outlined-0.0.0-dataease.js";import{i as mt}from"./icon_done_outlined-0.0.0-dataease.js";import{d as _t}from"./de-copy-0.0.0-dataease.js";import{i as ht}from"./icon_refresh_outlined-0.0.0-dataease.js";import{a as vt,s as kt,S as wt}from"./ShareTicket-0.0.0-dataease.js";import{u as yt}from"./index-0.0.0-dataease18.js";import gt from"./CustomLinkPwd-0.0.0-dataease.js";import bt from"./TicketDialog-0.0.0-dataease.js";import{E as xt}from"./index-0.0.0-dataease3.js";import{_ as It}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./dayjs.min-0.0.0-dataease.js";import"./arrays-0.0.0-dataease.js";import"./index-0.0.0-dataease17.js";import"./index-0.0.0-dataease4.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./el-table-column-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./dv-info-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./icon_add_outlined-0.0.0-dataease.js";import"./GridTable-0.0.0-dataease.js";import"./el-pagination-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./EmptyBackground-0.0.0-dataease.js";import"./el-empty-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./TicketEdit-0.0.0-dataease.js";import"./el-drawer-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import"./el-form-item-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import"./el-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";const Ct={key:0,class:"share-container"},Et={class:"share-title share-padding"},Vt={class:"open-share flex-align-center share-padding"},St={key:0,class:"custom-link-line share-padding"},qt={class:"share-input-suffix"},Pt={key:1,class:"exp-container share-padding"},Tt={class:"checkbox-span"},Rt={class:"inline-share-item-picker"},Dt={key:1,class:"exp-error"},Ut={key:2,class:"pwd-container share-padding"},Mt={class:"checkbox-span"},$t={key:0,class:"auto-pwd-container"},zt={key:1,class:"inline-share-item"},At={class:"share-input-suffix"},Bt={key:4,class:"share-foot share-padding"},Lt={key:1,class:"share-container"},Ht={class:"share-title share-padding"},Nt={class:"open-share flex-align-center share-padding"},jt={key:0},Gt=at({__name:"ShareVisualHead",props:{resourceId:Z.string.def(""),resourceType:Z.string.def(""),weight:Z.number.def(0)},setup(ke,{expose:we}){const K=dt(),Q=We(),{toClipboard:X}=yt(),{t:o}=Ke(),g=ke,E=m(!1),R=m(null),B=m(),L=m(),ee=m(null),S=m(!1),y=m(!1),p=m(!1),te=m(""),D=m(!1),b=m(!1),C=m(null),P=m(!1),oe=m(""),ae=m(),H=m(),n=st({detailInfo:{id:"",uuid:"",pwd:"",exp:0,autoPwd:!0}});nt(()=>g.resourceId,()=>{E.value=!1});const se=async()=>{if(!p.value){E.value=!1;return}if(V.value&&!j())return;if(await O()){b.value=!1,E.value=!1;return}},ye=e=>{var t,a;!E.value||e.target.closest('[class*="share-popover"]')||e.target.closest('[class*="ed-overlay-dialog"]')||(a=(t=e.target.classList)==null?void 0:t.toString())!=null&&a.includes("edit-uuid-icon")||se()},ge=()=>{E.value||(P.value=!1,E.value=!0)},be=F(()=>`${o("work_branch.open_link_hint")}${g.resourceType==="dashboard"?o("work_branch.dashboard"):o("work_branch.big_data_screen")}`),ne=F(()=>K.getShareDisable),V=F(()=>K.getSharePeRequire),xe=async()=>{if(p.value)try{if(G("link-uuid-error-msg")){I.warning(o("work_branch.error_link_hint"));return}if(y.value&&!n.detailInfo.autoPwd&&G("link-pwd-error-msg")){I.warning(o("work_branch.error_password_hint"));return}if(V.value&&!j())return;ie();let e=te.value;y.value&&(e+=`,${n.detailInfo.pwd}`),await X(e),I.success(o("common.copy_success"))}catch{I.warning(o("common.copy_unsupported"))}else I.warning(o("common.copy_unsupported"));se()},Ie=e=>e.getTime()<new Date().getTime(),Ce=()=>{ee.value=Ze.service({target:".share-dialog-container"})},Ee=()=>{var e;(e=ee.value)==null||e.close()},le=()=>{U(j)},U=e=>{Ce();const a=`/share/detail/${g.resourceId}`;T.get({url:a}).then(r=>{var d;n.detailInfo={...r.data},(d=r.data)!=null&&d.uuid&&(oe.value=r.data.uuid),Ve()}).finally(()=>{Ee(),e&&e()})},Ve=()=>{n.detailInfo.id&&n.detailInfo.uuid?(p.value=!0,ie(),y.value=!!n.detailInfo.pwd,S.value=!!n.detailInfo.exp):(p.value=!1,y.value=!1,S.value=!1)},Se=()=>{const t=`/share/switcher/${g.resourceId}`;T.post({url:t}).then(()=>{U(null)})},ie=()=>{te.value=re()+n.detailInfo.uuid},re=()=>{let e="/";return Q.baseUrl?e=Q.baseUrl+"#":e=window.location.origin+window.location.pathname+"#",(e.includes("oidcbi/")||e.includes("casbi/"))&&(e=e.replace("oidcbi/",""),e=e.replace("casbi/","")),e+vt},qe=e=>{let t=0;if(e){const a=new Date;a.setTime(a.getTime()+3600*1e3),t=a.getTime(),n.detailInfo.exp=t}pe(),ce(t)},ce=e=>{if(S.value&&e<new Date().getTime()){D.value=!0;return}D.value=!1;const t=g.resourceId,a="/share/editExp",r={resourceId:t,exp:e};T.post({url:a,data:r}).then(()=>{U(null)})},Pe=e=>{let t="";e&&(t=ue()),fe(),N(t,!0)},de=()=>{const e=ue();N(e,!0)},N=(e,t)=>{const a=g.resourceId,r="/share/editPwd",d={resourceId:a,pwd:e,autoPwd:t};T.post({url:r,data:d}).then(()=>{U(null)})},ue=()=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+";let a="";const r="!@#$%^&*()_+";let d=!1;for(let i=0;i<10;i++)i===0?a+=t.charAt(Math.floor(Math.random()*t.length)):!d&&i<10-2?(a+=r.charAt(Math.floor(Math.random()*r.length)),d=!0):a+=t.charAt(Math.floor(Math.random()*t.length));return a=a.split("").sort(()=>.5-Math.random()).join(""),a},j=()=>{if(p.value&&V.value){const e=pe(),t=fe();return e&&t}return!0},pe=()=>!V.value||S.value?(M(null,B),!0):(M(o("common.required"),B),!1),fe=()=>!V.value||y.value?(M(null,L),!0):(M(o("common.required"),L),!1),M=(e,t,a)=>{if(!t.value)return;a=a||"checkbox-span-require";const r=`.${a}`,d=t.value.$el;if(e){d.style.color="red",d.children[0].children[1].style.borderColor="red";const i=d.children[1].children[0].querySelector(r);if(i)i.innerText=e;else{const _=document.createElement("span");_.className=a,_.innerText=e,d.children[1].children[0].appendChild(_)}}else{d.style=null,d.children[0].children[1].style.borderColor=null;const i=d.children[1].children[0].querySelector(r);i&&d.children[1].children[0].removeChild(i)}},$=(e,t,a)=>{a=a||"link-pwd-error-msg";const r=`.${a}`,d=t||R;if(!d.value)return;const i=d.value.input;if(e){i.style.color="red",i.style.borderColor="red",i.parentElement.style["box-shadow"]="0 0 0 1px red inset";const _=i.parentElement.querySelector(r);if(_)_.innerText=e;else{const x=document.createElement("div");x.className=a,x.innerText=e,i.parentElement.appendChild(x)}}else{i.style=null,i.style.borderColor=null;const _=i.parentElement.querySelector(r);_&&(i.parentElement.style=null,i.parentElement.removeChild(_))}},G=e=>{var t;return(t=document.getElementsByClassName(e))==null?void 0:t.length},Te=e=>{e?($(null,R),de()):(n.detailInfo.pwd="",A(()=>{R.value.input.focus()}))},Re=async()=>{if(p.value&&y.value){if(!n.detailInfo.autoPwd&&G("link-pwd-error-msg")){I.warning(o("work_branch.error_password_hint"));return}try{await X(n.detailInfo.pwd),I.success(o("common.copy_success"))}catch{I.warning(o("common.copy_unsupported"))}}else I.warning(o("common.copy_unsupported"))},De=()=>{b.value=!0,A(()=>{C!=null&&C.value&&C.value.input.focus()})},O=async()=>{const e=n.detailInfo.uuid,t="link-uuid-error-msg";if(!e)return $(o("commons.cannot_be_null"),C,t),!1;const r=/^[a-zA-Z0-9]{8,16}$/.test(e);if(!r)$(o("work_branch.uuid_checker"),C,t);else{const d=await Ue(e);return $(d,C,t),!d}return r},Ue=async e=>{const t="/share/editUuid",a={resourceId:g.resourceId,uuid:e};return(await T.post({url:t,data:a})).data},me=async()=>{const e=await O();b.value=!e},Me=e=>{e.stopPropagation(),n.detailInfo.uuid=oe.value,me()},$e=()=>{P.value=!0,A(()=>{H.value.open()})},ze=()=>{H.value.close(),A(()=>{P.value=!1})},Ae=e=>{n.detailInfo.ticketRequire=e},Be=()=>{le()},Le=()=>{ae.value.open(n.detailInfo.pwd)},He=e=>{n.detailInfo.pwd=e,N(e,!1)};return we({execute:Be}),(e,t)=>{const a=he,r=Qe,d=ot,i=he,_=Xe,x=xt,_e=et,W=tt,Ne=Je,je=Ye,Ge=Fe,Oe=lt("click-outside");return f(),v(it,null,[s(Ge,{visible:E.value,title:"",width:"480",placement:"bottom-end","show-arrow":!1,"popper-class":"share-popover",onShow:le},{reference:l(()=>[g.weight>=7?ve((f(),z(r,{key:0,secondary:"",onClick:ge},{icon:l(()=>[s(a,{name:"icon_share-label_outlined"},{default:l(()=>[s(c(ut),{class:"svg-icon"})]),_:1})]),default:l(()=>[q(" "+w(c(o)("visualization.share")),1)]),_:1})),[[Oe,ye]]):h("",!0)]),default:l(()=>[ne.value?(f(),v("div",Lt,[u("div",Ht,w(c(o)("work_branch.public_link_share")),1),u("div",Nt,[u("span",null,w(c(o)("work_branch.cannot_share_link")),1)])])):(f(),v("div",Ct,[u("div",Et,w(c(o)("work_branch.public_link_share")),1),u("div",Vt,[s(d,{size:"small",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=k=>p.value=k),onChange:Se},null,8,["modelValue"]),q(" "+w(be.value),1)]),p.value?(f(),v("div",St,[s(_e,{ref_key:"linkUuidRef",ref:C,placeholder:"",class:Y(b.value?"":"link-input-readlonly"),modelValue:n.detailInfo.uuid,"onUpdate:modelValue":t[1]||(t[1]=k=>n.detailInfo.uuid=k),readonly:!b.value,onBlur:O},rt({suffix:l(()=>[u("div",qt,[t[7]||(t[7]=u("span",{class:"suffix-split"},null,-1)),b.value?h("",!0):(f(),v("div",{key:0,class:"input-suffix-btn edit-uuid-icon",onClick:J(De,["stop"])},[s(x,{class:"item",effect:"dark",content:c(o)("commons.edit")+c(o)("chart.indicator_suffix"),placement:"top"},{default:l(()=>[s(_,{class:"edit-uuid-icon",style:{cursor:"pointer"}},{default:l(()=>[s(i,{class:"edit-uuid-icon"},{default:l(()=>[s(c(pt),{class:"svg-icon edit-uuid-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])),b.value?(f(),v("div",{key:1,class:"input-suffix-btn",onClick:J(Me,["stop"])},[s(x,{class:"item",effect:"dark",content:c(o)("commons.cancel"),placement:"top"},{default:l(()=>[s(_,{style:{cursor:"pointer"}},{default:l(()=>[s(i,null,{default:l(()=>[s(c(ft),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])):h("",!0),b.value?(f(),v("div",{key:2,class:"input-suffix-btn done-finish",onClick:J(me,["stop"])},[s(x,{class:"item",effect:"dark",content:c(o)("commons.save"),placement:"top"},{default:l(()=>[s(_,{style:{cursor:"pointer"}},{default:l(()=>[s(i,null,{default:l(()=>[s(c(mt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])):h("",!0)])]),_:2},[b.value?void 0:{name:"prefix",fn:l(()=>[q(w(re()),1)]),key:"0"}]),1032,["class","modelValue","readonly"])])):h("",!0),p.value?(f(),v("div",Pt,[s(W,{ref_key:"expCheckbox",ref:B,disabled:!p.value,modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=k=>S.value=k),onChange:qe},{default:l(()=>[u("div",Tt,[u("span",null,w(c(o)("visualization.over_time")),1),u("span",{class:Y(["pe-require",{"pe-tips-hidden":!V.value}])},t[8]||(t[8]=[u("span",null,"*",-1)]),2)])]),_:1},8,["disabled","modelValue"]),u("div",Rt,[n.detailInfo.exp?(f(),z(Ne,{key:0,clearable:!1,class:"share-exp-picker",modelValue:n.detailInfo.exp,"onUpdate:modelValue":t[3]||(t[3]=k=>n.detailInfo.exp=k),type:"datetime",teleported:!1,placeholder:"",shortcuts:c(kt),onChange:ce,"disabled-date":Ie,"value-format":"x"},null,8,["modelValue","shortcuts"])):h("",!0),D.value?(f(),v("span",Dt,w(c(o)("work_branch.share_time_limit")),1)):h("",!0)])])):h("",!0),p.value?(f(),v("div",Ut,[s(W,{ref_key:"pwdCheckbox",ref:L,disabled:!p.value,modelValue:y.value,"onUpdate:modelValue":t[4]||(t[4]=k=>y.value=k),onChange:Pe},{default:l(()=>[u("div",Mt,[u("span",null,w(c(o)("visualization.passwd_protect")),1),u("span",{class:Y(["pe-require",{"pe-tips-hidden":!V.value}])},t[9]||(t[9]=[u("span",null,"*",-1)]),2)])]),_:1},8,["disabled","modelValue"]),y.value?(f(),v("div",$t,[ve(s(W,{disabled:!p.value,modelValue:n.detailInfo.autoPwd,"onUpdate:modelValue":t[5]||(t[5]=k=>n.detailInfo.autoPwd=k),onChange:Te,label:c(o)("visualization.auto_pwd")},null,8,["disabled","modelValue","label"]),[[ct,!1]])])):h("",!0),y.value?(f(),v("div",zt,[s(_e,{ref_key:"pwdRef",ref:R,style:{flex:"1"},class:"link-input-readlonly",modelValue:n.detailInfo.pwd,"onUpdate:modelValue":t[6]||(t[6]=k=>n.detailInfo.pwd=k),readonly:n.detailInfo.autoPwd},{suffix:l(()=>[u("div",At,[t[10]||(t[10]=u("span",{class:"suffix-split"},null,-1)),u("div",{class:"input-suffix-btn",onClick:Re},[s(x,{class:"item",effect:"dark",content:c(o)("commons.copy"),placement:"top"},{default:l(()=>[s(_,{style:{cursor:"pointer"}},{default:l(()=>[s(i,null,{default:l(()=>[s(c(_t),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])]),u("div",{class:"input-suffix-btn",onClick:de},[s(x,{class:"item",effect:"dark",content:c(o)("commons.reset"),placement:"top"},{default:l(()=>[s(_,{style:{cursor:"pointer"}},{default:l(()=>[s(i,null,{default:l(()=>[s(c(ht),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])])]),_:1},8,["modelValue","readonly"]),s(r,{secondary:"",onClick:Le},{default:l(()=>[q(w(c(o)("user.change_password")),1)]),_:1})])):h("",!0)])):h("",!0),p.value?(f(),z(je,{key:3,class:"share-divider"})):h("",!0),p.value?(f(),v("div",Bt,[s(r,{secondary:"",onClick:$e},{default:l(()=>[q(w(c(o)("work_branch.ticket_setting")),1)]),_:1}),s(r,{disabled:!p.value||D.value,type:"primary",onClick:xe},{default:l(()=>[q(w(y.value?c(o)("visualization.copy_link_passwd"):c(o)("visualization.copy_link")),1)]),_:1},8,["disabled"])])):h("",!0)]))]),_:1},8,["visible"]),s(gt,{ref_key:"customPwdRef",ref:ae,onPwdChange:He},null,512),P.value?(f(),z(bt,{key:0,ref_key:"ticketDialogRef",ref:H},{default:l(()=>[!ne.value&&p.value&&P.value?(f(),v("div",jt,[s(wt,{uuid:n.detailInfo.uuid,"resource-id":g.resourceId,"ticket-require":n.detailInfo.ticketRequire,onRequireChange:Ae,onClose:ze},null,8,["uuid","resource-id","ticket-require"])])):h("",!0)]),_:1},512)):h("",!0)],64)}}});const Wo=It(Gt,[["__scopeId","data-v-cdc94242"]]);export{Wo as default};

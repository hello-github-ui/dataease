import{n as We,o as c,c as M,a as x,Z as B,$ as ha,d as Ee,t as yt,M as st,ab as $t,_,a4 as Ae,a2 as N,u as e,r as I,a0 as m,k as w,l as Kt,b as Bt,e as ia,w as Nt,ah as Ha,Y as F,a1 as Yt,z as rt,h as va,ak as za,W as ot,a3 as Oe,S as an,X as mt,p as kn,ad as xo,aW as So,T as ko,R as Io}from"./@vue-0.0.0-dataease.js";import{b as pa,a as hn,t as Mo,g as Fa,d as Ta,e as La,f as In,s as ma,h as Vo}from"./style-0.0.0-dataease.js";import{e as te}from"./eventBus-0.0.0-dataease.js";import Do from"./Component-0.0.0-dataease16.js";import{d as Ho,V as Fo}from"./Component-0.0.0-dataease15.js";import Lo from"./Attr-0.0.0-dataease19.js";import{d as ut}from"./dvMain-0.0.0-dataease.js";import{s as lt,d as Mn}from"./pinia-0.0.0-dataease.js";import{h as Tt,L as $a,d as Wt,e as ta,z as Vn,I as nn,J as on,G as ln,f as Ao,p as ga,g as ea,x as Eo,a5 as Po,y as Bo,Q as Dn,R as Hn,o as Fn,A as Oo,w as zo,v as To,r as $o}from"./element-plus-secondary-0.0.0-dataease.js";import{i as Go}from"./icon_replace_outlined-0.0.0-dataease.js";import{g as aa,c as Ne,m as ja,a as Aa,t as Sa}from"./translate-0.0.0-dataease.js";import{A as na,j as Ut,h as At,L as mn,B as Ln,i as fa,l as Ga,t as Ro,u as qo,M as Zo,N as Wo,r as en}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{s as oa}from"./snapshot-0.0.0-dataease.js";import{e as ca,f as Xa,d as An,c as Ra,a as sn,l as No,h as ka,i as Uo}from"./DeShortcutKey-0.0.0-dataease.js";import{i as rn,a as En}from"./imgUtils-0.0.0-dataease.js";import{i as jo}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as Xo}from"./icon_add_outlined-0.0.0-dataease.js";import{i as Yo}from"./chart-list-0.0.0-dataease.js";import{i as Ko}from"./icon_more_outlined-0.0.0-dataease.js";import{i as da}from"./icon_download_outlined-0.0.0-dataease.js";import{u as ke,e as Pn,a as Jo}from"./index-0.0.0-dataease.js";import{E as Bn}from"./util-0.0.0-dataease2.js";import{_ as Ge}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import{y as On}from"./@element-plus-0.0.0-dataease.js";import{d as Qo}from"./vuedraggable-0.0.0-dataease.js";import{e as zn,f as gn,a as ua,s as el}from"./index-0.0.0-dataease12.js";import"./web-storage-cache-0.0.0-dataease.js";import{r as De,t as tl,u as al,l as Ya,p as Ka,v as gt,h as Tn,w as yn,x as _n,y as nl,d as Cn,g as ol,z as ll,A as wn,B as il,k as sl,C as rl}from"./canvasUtils-0.0.0-dataease.js";import{B as Ea,_ as ul}from"./Component.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{a as _a,r as $n}from"./watermark-0.0.0-dataease2.js";import{$ as Ja}from"./jquery-0.0.0-dataease.js";import{_ as Ot}from"./lodash-0.0.0-dataease.js";import{g as qa}from"./util-0.0.0-dataease.js";import{t as cl}from"./html-to-image-0.0.0-dataease.js";import Qa from"./ChartComponentS2-0.0.0-dataease.js";import{E as Gn}from"./EmptyBackground-0.0.0-dataease.js";import{J as bn}from"./lodash-es-0.0.0-dataease.js";import{L as dl,a as vl}from"./LinkageSet-0.0.0-dataease.js";import{b as un}from"./canvasStyle-0.0.0-dataease.js";import{m as pl,d as tn}from"./mathjs-0.0.0-dataease.js";import{c as fl,i as hl}from"./dataVisualization-0.0.0-dataease2.js";import{_ as ml}from"./Attr.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import gl from"./Component-0.0.0-dataease14.js";import{_ as yl}from"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import _l from"./Component-0.0.0-dataease11.js";import Cl from"./Attr-0.0.0-dataease13.js";import wl from"./Attr-0.0.0-dataease.js";import bl from"./Component-0.0.0-dataease3.js";import{_ as xl}from"./Attr.vue_vue_type_style_index_0_lang-0.0.0-dataease2.js";import{e as Rn}from"./element-resize-detector-0.0.0-dataease.js";import Sl from"./Attr-0.0.0-dataease7.js";import kl from"./Component-0.0.0-dataease5.js";import Il from"./Attr-0.0.0-dataease5.js";import Ml from"./Component-0.0.0-dataease4.js";import{_ as Vl}from"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease2.js";import Dl from"./Component-0.0.0-dataease12.js";import{_ as Hl}from"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease3.js";import{C as Fl}from"./CommonAttr-0.0.0-dataease.js";import{_ as Ll}from"./Component.vue_vue_type_script_setup_true_lang-0.0.0-dataease2.js";import Al from"./Attr-0.0.0-dataease8.js";import El from"./Component-0.0.0-dataease9.js";import{_ as Pl}from"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease4.js";import{_ as Bl}from"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease5.js";import Ol from"./Component-0.0.0-dataease8.js";import{_ as zl}from"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease6.js";import Tl from"./Component-0.0.0-dataease6.js";import{_ as $l}from"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease7.js";import Gl from"./Component-0.0.0-dataease13.js";import Rl from"./Attr-0.0.0-dataease16.js";import{_ as ql}from"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease8.js";import Zl from"./Component-0.0.0-dataease10.js";import Wl from"./Attr-0.0.0-dataease12.js";import{useAppStoreWithOut as Nl}from"./app-0.0.0-dataease.js";import Ul from"./Component-0.0.0-dataease2.js";import{i as jl}from"./icon_left_outlined-0.0.0-dataease.js";import{i as Xl}from"./ModelUtil-0.0.0-dataease.js";const Va=ut(),{componentData:xn,curComponentIndex:Sn,canvasStyleData:Pa}=lt(Va),Ba={width:["left","width","fontSize","activeFontSize","letterSpacing"],height:["top","height"]};function Ac(a){return Zn(a)}function Ec(a){return Zn(a)}function qn(a,n){a.forEach(r=>{if(Object.keys(r.style).forEach(i=>{Ba.width.includes(i)?r.style[i]&&(r.style[i]=ya(Oa(r.style[i],Pa.value.scale),n)):Ba.height.includes(i)&&(r.style[i]=ya(Oa(r.style[i],Pa.value.scaleHeight),n))}),["Group"].includes(r.component)?pa(r):["DeTabs"].includes(r.component)&&r.propValue.forEach(i=>{qn(i.componentData,n)}),["Group","DeTabs"].includes(r.component))try{We(()=>pa(r))}catch(i){console.error("group adaptor error:"+i)}})}function Zn(a){const n=na(xn.value);qn(n,a),Va.setComponentData(n),Va.setCurComponent({component:xn.value[Sn.value],index:Sn.value}),Va.setCanvasStyle({...Pa.value,scaleWidth:a,scaleHeight:a,scale:a})}function Yl(a,n,r,i,g){a.forEach(v=>{Object.keys(v.style).forEach(d=>{d==="fontSize"&&v.style[d]===""||(Ba.width.includes(d)?v.style[d]=ya(Oa(v.style[d],n.scale||g),r):Ba.height.includes(d)&&(v.style[d]=ya(Oa(v.style[d],n.scaleHeight||g),i)))})}),n.scale=r,n.scaleWidth=r,n.scaleHeight=i}const Kl=["width","height","fontSize"];function Jl(a,n=Pa.value.scale){Object.keys(a.style).forEach(r=>{if(Kl.includes(r)){if(r==="fontSize"&&a.style[r]==="")return;a.style[r]=ya(a.style[r],n)}})}function ya(a,n){return pl(a,tn(parseFloat(n),100))}function Oa(a=0,n){return a||(a=0),tn(a,tn(parseFloat(n),100))}const Ql={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function ei(a,n){return c(),M("svg",Ql,n[0]||(n[0]=[x("path",{d:"M0 2C0 0.895431 0.895431 0 2 0H14C15.1046 0 16 0.895431 16 2V14C16 15.1046 15.1046 16 14 16H2C0.895431 16 0 15.1046 0 14V2Z"},null,-1),x("path",{d:"M11.5881 4.90381L12.3966 5.71231C12.4291 5.74481 12.4549 5.78339 12.4725 5.82586C12.4901 5.86833 12.4992 5.91384 12.4992 5.95981C12.4992 6.00577 12.4901 6.05129 12.4725 6.09375C12.4549 6.13622 12.4291 6.17481 12.3966 6.20731L7.17813 11.4258C7.14563 11.4583 7.10705 11.4841 7.06458 11.5017C7.02212 11.5193 6.9766 11.5283 6.93063 11.5283C6.88467 11.5283 6.83915 11.5193 6.79669 11.5017C6.75422 11.4841 6.71564 11.4583 6.68313 11.4258L3.70213 8.44481C3.66963 8.41231 3.64385 8.37372 3.62625 8.33126C3.60866 8.28879 3.59961 8.24327 3.59961 8.19731C3.59961 8.15134 3.60866 8.10583 3.62625 8.06336C3.64385 8.0209 3.66963 7.98231 3.70213 7.94981L4.51063 7.14181C4.54314 7.1093 4.58172 7.08352 4.62419 7.06593C4.66665 7.04834 4.71217 7.03928 4.75813 7.03928C4.8041 7.03928 4.84962 7.04834 4.89208 7.06593C4.93455 7.08352 4.97313 7.1093 5.00563 7.14181L6.93063 9.06631L11.0936 4.90331C11.1261 4.8708 11.1647 4.84502 11.2072 4.82743C11.2497 4.80984 11.2952 4.80078 11.3411 4.80078C11.3871 4.80078 11.4326 4.80984 11.4751 4.82743C11.5175 4.84502 11.5556 4.8713 11.5881 4.90381Z",fill:"white"},null,-1)]))}const ti={render:ei},ai={width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ni(a,n){return c(),M("svg",ai,n[0]||(n[0]=[x("path",{d:"M3.79167 4.66602V4.37435C3.79167 2.60102 5.22842 1.16602 7 1.16602C8.77158 1.16602 10.2083 2.60102 10.2083 4.37435V4.66602H11.6667C11.9887 4.66602 12.25 4.92852 12.25 5.24935V12.2493C12.25 12.5702 11.9887 12.8327 11.6667 12.8327H2.33333C2.01075 12.8327 1.75 12.5702 1.75 12.2493V5.24935C1.75 4.92852 2.01075 4.66602 2.33333 4.66602H3.79167ZM9.04167 4.37435C9.04167 3.2456 8.12758 2.33268 7 2.33268C6.73186 2.33261 6.46634 2.38536 6.2186 2.48794C5.97086 2.59052 5.74575 2.7409 5.55615 2.9305C5.36655 3.1201 5.21617 3.34521 5.11359 3.59295C5.01101 3.84069 4.95826 4.10621 4.95833 4.37435V4.66602H9.04167V4.37435Z",fill:"#A6A6A6"},null,-1)]))}const oi={render:ni},li={lt:ii,t:ci,rt:si,r:di,rb:ri,b:vi,lb:ui,l:pi};function ii(a,n,r,i,g){const{symmetricPoint:v}=g;let d=aa(n,v),l=Ne(n,d,-a.rotate),s=Ne(v,d,-a.rotate),o=s.x-l.x,C=s.y-l.y;if(i){o/C>r?(l.x+=Math.abs(o-C*r),o=C*r):(l.y+=Math.abs(C-o/r),C=o/r);const u=Ne(l,d,a.rotate);d=aa(u,v),l=Ne(u,d,-a.rotate),s=Ne(v,d,-a.rotate),o=s.x-l.x,C=s.y-l.y}o>0&&C>0&&(a.width=Math.round(o),a.height=Math.round(C),a.left=Math.round(l.x),a.top=Math.round(l.y))}function si(a,n,r,i,g){const{symmetricPoint:v}=g;let d=aa(n,v),l=Ne(n,d,-a.rotate),s=Ne(v,d,-a.rotate),o=l.x-s.x,C=s.y-l.y;if(i){o/C>r?(l.x-=Math.abs(o-C*r),o=C*r):(l.y+=Math.abs(C-o/r),C=o/r);const u=Ne(l,d,a.rotate);d=aa(u,v),l=Ne(u,d,-a.rotate),s=Ne(v,d,-a.rotate),o=l.x-s.x,C=s.y-l.y}o>0&&C>0&&(a.width=Math.round(o),a.height=Math.round(C),a.left=Math.round(s.x),a.top=Math.round(l.y))}function ri(a,n,r,i,g){const{symmetricPoint:v}=g;let d=aa(n,v),l=Ne(v,d,-a.rotate),s=Ne(n,d,-a.rotate),o=s.x-l.x,C=s.y-l.y;if(i){o/C>r?(s.x-=Math.abs(o-C*r),o=C*r):(s.y-=Math.abs(C-o/r),C=o/r);const u=Ne(s,d,a.rotate);d=aa(u,v),l=Ne(v,d,-a.rotate),s=Ne(u,d,-a.rotate),o=s.x-l.x,C=s.y-l.y}o>0&&C>0&&(a.width=Math.round(o),a.height=Math.round(C),a.left=Math.round(l.x),a.top=Math.round(l.y))}function ui(a,n,r,i,g){const{symmetricPoint:v}=g;let d=aa(n,v),l=Ne(v,d,-a.rotate),s=Ne(n,d,-a.rotate),o=l.x-s.x,C=s.y-l.y;if(i){o/C>r?(s.x+=Math.abs(o-C*r),o=C*r):(s.y-=Math.abs(C-o/r),C=o/r);const u=Ne(s,d,a.rotate);d=aa(u,v),l=Ne(v,d,-a.rotate),s=Ne(u,d,-a.rotate),o=l.x-s.x,C=s.y-l.y}o>0&&C>0&&(a.width=Math.round(o),a.height=Math.round(C),a.left=Math.round(s.x),a.top=Math.round(l.y))}function ci(a,n,r,i,g){const{symmetricPoint:v,curPoint:d}=g,l=Ne(n,d,-a.rotate),s=Ne({x:d.x,y:l.y},d,a.rotate),o=Math.sqrt((s.x-v.x)**2+(s.y-v.y)**2),C={x:s.x-(s.x-v.x)/2,y:s.y+(v.y-s.y)/2};let u=a.width;i&&(u=o*r),a.width=u,a.height=Math.round(o),a.top=Math.round(C.y-o/2),a.left=Math.round(C.x-a.width/2)}function di(a,n,r,i,g){const{symmetricPoint:v,curPoint:d}=g,l=Ne(n,d,-a.rotate),s=Ne({x:l.x,y:d.y},d,a.rotate),o=Math.sqrt((s.x-v.x)**2+(s.y-v.y)**2),C={x:s.x-(s.x-v.x)/2,y:s.y+(v.y-s.y)/2};let u=a.height;i&&(u=o/r),a.height=u,a.width=Math.round(o),a.top=Math.round(C.y-a.height/2),a.left=Math.round(C.x-o/2)}function vi(a,n,r,i,g){const{symmetricPoint:v,curPoint:d}=g,l=Ne(n,d,-a.rotate),s=Ne({x:d.x,y:l.y},d,a.rotate),o=Math.sqrt((s.x-v.x)**2+(s.y-v.y)**2),C={x:s.x-(s.x-v.x)/2,y:s.y+(v.y-s.y)/2};let u=a.width;i&&(u=o*r),a.width=u,a.height=Math.round(o),a.top=Math.round(C.y-o/2),a.left=Math.round(C.x-a.width/2)}function pi(a,n,r,i,g){const{symmetricPoint:v,curPoint:d}=g,l=Ne(n,d,-a.rotate),s=Ne({x:l.x,y:d.y},d,a.rotate),o=Math.sqrt((s.x-v.x)**2+(s.y-v.y)**2),C={x:s.x-(s.x-v.x)/2,y:s.y+(v.y-s.y)/2};let u=a.height;i&&(u=o/r),a.height=u,a.width=Math.round(o),a.top=Math.round(C.y-a.height/2),a.left=Math.round(C.x-o/2)}function fi(a,n,r,i,g,v){li[a](n,r,i,g,v)}function hi(a,n,r){["b"].includes(a)?(n.left=Math.round(r.x-n.width/2),n.top=r.y):["t"].includes(a)?(n.left=Math.round(r.x-n.width/2),n.top=r.y-n.height):["l"].includes(a)?(n.left=r.x-n.width,n.top=Math.round(r.y-n.height/2)):["r"].includes(a)?(n.left=r.x,n.top=Math.round(r.y-n.height/2)):["lt"].includes(a)?(n.left=r.x-n.width,n.top=r.y-n.height):["lb"].includes(a)?(n.left=r.x-n.width,n.top=r.y):["rt"].includes(a)?(n.left=r.x,n.top=r.y-n.height):["rb"].includes(a)&&(n.left=r.x,n.top=r.y)}const mi={t:"1688563367121",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4587","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"200",height:"200"};function gi(a,n){return c(),M("svg",mi,n[0]||(n[0]=[x("path",{d:"M470.624 553.376a32 32 0 0 1 2.656 42.24l-2.656 3.008L269.28 800l145.984 0.032a32 32 0 0 1 31.776 28.256l0.224 3.744a32 32 0 0 1-28.288 31.776l-3.712 0.224H192l-2.4-0.096-4.032-0.544-3.552-0.96-3.552-1.408-3.136-1.664-3.072-2.144-2.88-2.56a32.32 32.32 0 0 1-3.104-3.584l-2.272-3.52-1.728-3.648-1.12-3.36-0.96-4.8L160 832V607.872a32 32 0 0 1 63.776-3.712l0.224 3.712-0.032 146.848 201.408-201.344a32 32 0 0 1 45.248 0zM608.736 160H832l2.4 0.096 4.032 0.544 3.552 0.96 3.552 1.408 3.136 1.664 3.072 2.144 2.88 2.56c1.152 1.12 2.176 2.336 3.104 3.584l2.272 3.52 1.728 3.648 1.12 3.36 0.96 4.8L864 192v224.128a32 32 0 0 1-63.776 3.712l-0.224-3.712v-146.88L598.624 470.624a32 32 0 0 1-47.904-42.24l2.656-3.008L754.688 224h-145.92a32 32 0 0 1-31.808-28.256l-0.224-3.744a32 32 0 0 1 28.288-31.776l3.712-0.224z","p-id":"4588"},null,-1)]))}const yi={render:gi},_i={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function Ci(a,n){return c(),M("svg",_i,n[0]||(n[0]=[x("path",{d:"M3.33333 1.99935V13.9993H12.6667V1.99935H3.33333ZM2.66667 0.666016H13.3333C13.7015 0.666016 14 0.978706 14 1.36443V14.6343C14 15.02 13.7015 15.3327 13.3333 15.3327H2.66667C2.29848 15.3327 2 15.02 2 14.6343V1.36443C2 0.978706 2.29848 0.666016 2.66667 0.666016ZM5 4.66602H7.66667C7.85076 4.66602 8 4.81525 8 4.99935V5.66602C8 5.85011 7.85076 5.99935 7.66667 5.99935H5C4.81591 5.99935 4.66667 5.85011 4.66667 5.66602V4.99935C4.66667 4.81525 4.81591 4.66602 5 4.66602ZM5 7.33268H11C11.1841 7.33268 11.3333 7.48192 11.3333 7.66602V8.33268C11.3333 8.51678 11.1841 8.66602 11 8.66602H5C4.81591 8.66602 4.66667 8.51678 4.66667 8.33268V7.66602C4.66667 7.48192 4.81591 7.33268 5 7.33268ZM5 9.99935H11C11.1841 9.99935 11.3333 10.1486 11.3333 10.3327V10.9993C11.3333 11.1834 11.1841 11.3327 11 11.3327H5C4.81591 11.3327 4.66667 11.1834 4.66667 10.9993V10.3327C4.66667 10.1486 4.81591 9.99935 5 9.99935Z"},null,-1)]))}const wi={render:Ci},bi={t:"1689603006162",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4590","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"200",height:"200"};function xi(a,n){return c(),M("svg",bi,n[0]||(n[0]=[x("path",{d:"M611.754667 710.613333a38.144 38.144 0 0 1 0 53.930667l-123.818667 123.818667c-95.530667 95.530667-256.341333 95.530667-351.872 0-95.488-95.488-95.488-256.341333 0-351.829334l123.818667-123.818666a38.144 38.144 0 1 1 53.973333 53.930666L190.037333 590.506667c-70.528 73.685333-74.069333 177.28-3.626666 247.637333 70.4 70.4 170.453333 72.234667 247.594666-3.669333l123.818667-123.818667a38.144 38.144 0 0 1 53.930667 0z m-199.509334-397.226666a38.144 38.144 0 0 1 0-53.930667l123.818667-123.818667c95.488-95.530667 256.341333-95.530667 351.872 0 95.488 95.488 95.488 256.341333 0 351.829334l-123.818667 123.818666a38.144 38.144 0 1 1-53.930666-53.930666l123.776-123.818667c70.528-73.685333 74.069333-177.28 3.669333-247.637333-70.357333-70.4-170.453333-72.234667-247.594667 3.669333l-123.861333 123.818667a38.144 38.144 0 0 1-53.930667 0z m232.362667 512.426666a32.682667 32.682667 0 0 1 65.408 0v65.450667a32.682667 32.682667 0 1 1-65.408 0v-65.408z m208.042667 27.434667a33.621333 33.621333 0 0 1-47.445334-0.554667l-45.482666-46.421333a33.28 33.28 0 0 1 47.36-46.890667l45.909333 45.994667a33.621333 33.621333 0 0 1-0.341333 47.872z m-55.466667-176.384c0-20.053333 16.298667-36.309333 36.352-36.309333H891.733333a36.352 36.352 0 0 1 0 72.661333h-58.154666a36.352 36.352 0 0 1-36.309334-36.352zM317.013333 130.773333a32.682667 32.682667 0 1 1 65.408 0v65.408a32.682667 32.682667 0 0 1-65.408 0V130.773333z m-142.677333 37.973334A33.621333 33.621333 0 0 1 221.866667 169.386667l45.482666 46.421333a33.28 33.28 0 0 1-47.36 46.848L173.994667 216.704a33.621333 33.621333 0 0 1 0.341333-47.914667zM98.986667 345.173333c0-20.053333 16.256-36.352 36.352-36.352h58.112a36.352 36.352 0 0 1 0 72.704H135.338667a36.352 36.352 0 0 1-36.352-36.352z","p-id":"4591"},null,-1)]))}const Wn={render:xi},Si={t:"1574649229600",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3752","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"200",height:"200"};function ki(a,n){return c(),M("svg",Si,[x("defs",null,[(c(),B(ha("style"),{type:"text/css"}))]),n[0]||(n[0]=x("path",{d:"M942 191.9C939.8 128.9 748.1 78 512 78S84.2 128.9 82 191.9V831c0 63.5 192.5 115 430 115s430-51.5 430-115V191.9z m-56.7 393.8c-4.6 3.3-11.6 7.4-21.9 12.2-21.3 9.8-50.5 19.1-84.4 26.8-74 16.8-168.8 26-267 26s-193-9.2-267-26c-33.9-7.7-63.1-16.9-84.4-26.8-10.3-4.8-17.3-8.9-21.9-12.2 0.1-0.1 0.2-0.1 0.3-0.2h-7v-123c72.2 36.4 215.3 61.1 380 61.1s307.8-24.8 380-61.1v122.9h-7l0.3 0.3z m0-177c-4.6 3.3-11.6 7.4-21.9 12.2-21.3 9.8-50.5 19.1-84.4 26.8-74 16.8-168.8 26-267 26s-193-9.2-267-26c-33.9-7.7-63.1-16.9-84.4-26.8-10.3-4.8-17.3-8.9-21.9-12.2 0.1-0.1 0.2-0.1 0.3-0.2h-7V246.9c72.2 36.4 215.3 61.1 380 61.1s307.8-24.8 380-61.1v161.6h-7c0.1 0 0.2 0.1 0.3 0.2zM160.7 180.8C182 171 211.2 161.7 245 154c74-16.8 168.8-26 267-26s193 9.2 267 26c33.9 7.7 63.1 16.9 84.4 26.8 10.3 4.8 17.3 8.9 21.9 12.2-4.6 3.3-11.6 7.4-21.9 12.2C842 215 812.8 224.3 779 232c-74 16.8-168.8 26-267 26s-193-9.2-267-26c-33.9-7.7-63.1-16.9-84.4-26.8-10.3-4.8-17.3-8.9-21.9-12.2 4.7-3.3 11.7-7.4 22-12.2zM885.3 831c-4.6 3.3-11.6 7.4-21.9 12.2C842 853 812.8 862.3 779 870c-74 16.8-168.8 26-267 26s-193-9.2-267-26c-33.9-7.7-63.1-16.9-84.4-26.8-10.3-4.8-17.3-8.9-21.9-12.2 0.1-0.1 0.2-0.1 0.3-0.2h-7V639.5c72.2 36.4 215.3 61.1 380 61.1s307.8-24.8 380-61.1v191.3h-7c0.1 0.1 0.2 0.1 0.3 0.2z","p-id":"3753"},null,-1))])}const Ii={render:ki},Mi=Ee({__name:"FieldsList",props:{fields:{type:Array,default:()=>[]},element:{type:Object,default:null}},setup(a){const n=a,{fields:r,element:i}=yt(n),g=d=>{ke().emitter.emit("fieldSelect-"+i.value.id,d)},v=d=>{d.preventDefault()};return(d,l)=>{const s=Tt;return c(),M("div",{onMousedown:v,class:"field-main"},[(c(!0),M(st,null,$t(e(r),o=>(c(),B(s,{key:o.id,title:o.name,size:"mini",class:"field-area",onClick:C=>g(o)},{default:_(()=>[Ae(N(o.name),1)]),_:2},1032,["title","onClick"]))),128))],32)}}});const Vi=Ge(Mi,[["__scopeId","data-v-92f30714"]]),Di=["title"],Hi={class:"item-span"},Fi={class:"dialog-footer"},Li=Ee({__name:"CustomTabsSort",setup(a,{expose:n}){const r=oa(),i=I(null),g=I([]),v=I(!1),d=u=>{l(u),v.value=!0},l=u=>{i.value=u,g.value=na(i.value.propValue)},s=()=>{v.value=!1},o=()=>{i.value.propValue=na(g.value),r.recordSnapshotCache("tab-sort-save"),te.emit("onTabSortChange-"+i.value.id),s()},{t:C}=Ut();return n({sortInit:d}),(u,U)=>{const H=At,O=Wt,k=$a;return c(),B(k,{ref:"enlargeDialog","destroy-on-close":"","append-to-body":!0,title:e(C)("visualization.custom_sort"),modelValue:v.value,"onUpdate:modelValue":U[0]||(U[0]=b=>v.value=b),width:"30vw",top:"10vh"},{footer:_(()=>[x("div",Fi,[m(e(Tt),{onClick:s},{default:_(()=>U[1]||(U[1]=[Ae("取消")])),_:1}),m(e(Tt),{type:"primary",onClick:o},{default:_(()=>U[2]||(U[2]=[Ae("确认")])),_:1})])]),default:_(()=>[x("div",null,[m(e(Qo),{list:g.value,animation:"300",class:"drag-list"},{item:_(({element:b})=>[(c(),M("span",{key:b.name,class:"item-dimension",title:b.title},[m(O,{size:"20px"},{default:_(()=>[m(H,{name:"drag"},{default:_(()=>[m(e(Ho),{class:"svg-icon"})]),_:1})]),_:1}),x("span",Hi,N(b.title),1)],8,Di))]),_:1},8,["list"])])]),_:1},8,["title","modelValue"])}}});const Ai=Ge(Li,[["__scopeId","data-v-f357899e"]]),Ei=ut(),{curComponentIndex:Ia,curComponent:Pi}=lt(Ei),Bi=Mn("layer",{actions:{upComponent(a){const n=ca(a);if(n){const{index:r,componentData:i}=n;r<i.length-1&&(mn(i,r,r+1),Ia.value=r+1)}},downComponent(a){const n=ca(a);if(n){const{index:r,componentData:i}=n;r>0&&(mn(i,r,r-1),Ia.value=r-1)}},topComponent(a){const n=ca(a);if(n){const{index:r,componentData:i,targetComponent:g}=n;r<i.length-1&&(i.splice(r,1),i.push(g),Ia.value=i.length-1)}},bottomComponent(a){const n=ca(a);if(n){const{index:r,componentData:i,targetComponent:g}=n;r>0&&(i.splice(r,1),i.unshift(g),Ia.value=0)}},hideComponentWithComponent(a){const n=Xa(a);n&&(n.isShow=!1)},hideComponent(a){const n=Xa(a);n&&(n.isShow=!1)},showComponent(a){var r;const n=Xa(a);n&&(n.isShow=!0,n.component=="Group"?n.propValue.forEach(i=>{var g;((g=i.innerType)==null?void 0:g.indexOf("table"))!==-1&&setTimeout(()=>{ke().emitter.emit("renderChart-"+i.id)},400)}):((r=n==null?void 0:n.innerType)==null?void 0:r.indexOf("table"))!==-1&&setTimeout(()=>{ke().emitter.emit("renderChart-"+Pi.value.id)},400))}}}),Nn=()=>Bi(Pn),Oi=["title"],zi=["title"],Ti={key:5,class:"bar-checkbox-area"},$i=["title"],Gi={key:7,class:"bar-checkbox-area"},Ri={class:"flex-align-center",style:{position:"relative",width:"100%",padding:"5px 32px 5px 16px","line-height":"24px"}},qi=Ee({__name:"ComponentEditBar",props:{element:{type:Object,required:!0},active:{type:Boolean,required:!1,default:!1},index:{required:!0,type:[Number,String],default:0},showPosition:{required:!1,type:String,default:"canvas"},canvasId:{type:String,default:"canvas-main"}},emits:["userViewEnlargeOpen","datasetParamsInit","closePreview","showViewDetails","amRemoveItem","linkJumpSetOpen","linkageSetOpen"],setup(a,{expose:n,emit:r}){Nn();const i=ut(),g=oa(),v=An(),d=I(null),l=w(()=>Ln(Se.value.weight,Se.value.ext)),s=r,{t:o}=Ut(),{emitter:C}=ke(),u={canvas:["datasetParams","enlarge","hidden","details","setting","copy","delete","download","unLinkage","linkageSetting","linkJumpSetting"],preview:["enlarge","details","download","unLinkage","previewDownload","datasetParams"],multiplexing:["multiplexing"],batchOpt:["batchOpt"],linkage:["linkage"]},U={UserView:["datasetParams","enlarge","hidden","details","setting","copy","download","previewDownload","delete","multiplexing","batchOpt","linkage","unLinkage","linkageSetting","linkJumpSetting"],default:["setting","delete","copy","multiplexing","batchOpt","hidden"]},H=R=>u[Y.value]&&u[Y.value].includes(R)&&(U[b.value.component]?U[b.value.component]:U.default).includes(R),O=w(()=>!["batchOpt","multiplexing"].includes(Y.value)),k=a,{element:b,index:oe,showPosition:Y,canvasId:G}=yt(k),{batchOptStatus:ve,pcMatrixCount:le,curComponent:Q,componentData:K,canvasViewInfo:ge,mobileInPc:ee,dvInfo:Se,isPopWindow:ne,hiddenListStatus:Re}=lt(i),re=Kt({systemOS:"Mac",maxImageSize:15e6,boardSetVisible:!1,linkJumpSetVisible:!1,linkJumpSetViewId:null,curFields:[],multiplexingCheckModel:!1,curMultiplexingComponents:{},barWidth:24,componentType:null,linkageActiveStatus:!1,editFilter:["view","custom","custom-button"],timer:null,viewXArray:[],batchOptCheckModel:!1}),$=w(()=>Re.value&&De(G.value)),j=()=>{d.value.sortInit(b.value)},ae=()=>{i.setCurComponent({component:b.value,index:oe.value})},Ye=()=>{C.emit(`addQueryCriteria${b.value.id}`)},qe=()=>{C.emit(`editQueryCriteria${b.value.id}`)},tt=w(()=>{if(Y.value==="canvas"){const R=b.value.x-1,X=le.value.x-(b.value.x+b.value.sizeX-1);return R===0&&X===0||X<0?$.value?"bar-main-left-inner":"bar-main-right-inner":X===0?"bar-main-left-outer":"bar-main-right"}else return Y.value==="preview"?"bar-main-right-inner":Y.value==="canvasDataV"?"bar-main-right":"bar-main-preview-right-inner"}),$e=w(()=>tt.value.indexOf("right")>=0?"right":"left"),Te=R=>{const X="el-icon-loading",be="de-message-loading de-message-export";ga({message:va("p",null,["后台导出中,可前往",va(Tt,{text:!0,size:"small",class:"btn-text",onClick:()=>{R()}},o("data_export.export_center")),"查看进度，进行下载"]),iconClass:X,icon:va(On),showClose:!0,customClass:be})},y=()=>{ke().emitter.emit("data-export-center",{activeName:"IN_PROGRESS"})},W=()=>{const R=i.getViewInstanceInfo(b.value.id);if(!R)return;const X=i.getViewDetails(b.value.id);zn(R,X)},D=()=>{const R=i.getViewDataDetails(b.value.id),X=i.getLastViewRequestInfo(b.value.id),Pe={...i.getViewDetails(b.value.id),chartExtRequest:X,data:R,busiFlag:Se.value.type};Bn(Pe,()=>{Te(y)})},q=()=>{ke().emitter.emit("componentImageDownload-"+b.value.id)},L=()=>{te.emit("removeMatrixItem-"+G.value,oe.value),i.setCurComponent({component:null,index:null}),g.recordSnapshotCache("deleteComponent")},E=()=>{s("datasetParamsInit")},J=()=>{v.copy(),v.paste(!1)},ie=(R,X)=>{R.preventDefault(),R.stopPropagation(),s("userViewEnlargeOpen",X)},ye=()=>{Q.value&&(Q.value.dashboardHidden=!0,te.emit("removeMatrixItemPosition-"+G.value,Q.value),i.setHiddenListStatus(!0),g.recordSnapshotCache("hide"),i.setLastHiddenComponent(Q.value.id))},ze=()=>{re.multiplexingCheckModel=!re.multiplexingCheckModel,we(re.multiplexingCheckModel)},we=R=>{R?i.addCurMultiplexingComponent({component:b.value,componentId:b.value.id}):i.removeCurMultiplexingComponentWithId(b.value.id)},Ke=()=>{Y.value==="batchOpt"&&(re.batchOptCheckModel=!re.batchOptCheckModel,pt(re.batchOptCheckModel))},pt=R=>{R?i.addCurBatchComponent(b.value):i.removeCurBatchComponentWithId(b.value.id)},dt=R=>{let X=!1;return R.linkageFilters&&R.linkageFilters.length>0&&R.linkageFilters.forEach(be=>{b.value.id===be.sourceViewId&&(X=!0)}),X},vt=w(()=>{let R=0;return K.value.forEach(X=>{X.component==="UserView"&&X.innerType!="VQuery"?dt(X)&&R++:X.component==="Group"?X.propValue.forEach(be=>{dt(be)&&R++}):X.component==="DeTabs"&&X.propValue.forEach(be=>{be.componentData.forEach(Pe=>{dt(Pe)&&R++})})}),R}),at=()=>{i.clearViewLinkage(b.value.id),ke().emitter.emit("clearPanelLinkage",{viewId:b.value.id})},ct=R=>{R.stopPropagation(),R.preventDefault()},Et=w(()=>{var R;return["canvasDataV","canvas"].includes(Y.value)&&((R=Q.value)==null?void 0:R.innerType)==="rich-text"&&Q.value.editing&&re.curFields.length>0}),A=()=>{if(b.value.component==="UserView"){const R=ge.value[b.value.id];R&&(re.curFields=[],R.type==="rich-text"&&R.curFields&&(re.curFields=R.curFields))}},T=w(()=>{var R;return((R=ge.value[b.value.id])==null?void 0:R.dataFrom)!=="template"&&!ne.value}),Ie=w(()=>{var R,X;return((X=(R=ge.value[b.value.id])==null?void 0:R.calParams)==null?void 0:X.length)>0}),He=I(),Me=()=>{He.value.handleClose()};return Bt(()=>{b.value.component==="UserView"&&te.on("initCurFields-"+b.value.id,A),A()}),ia(()=>{b.value.component==="UserView"&&te.off("initCurFields-"+b.value.id,A)}),n({multiplexingCheckOut:ze,batchOptCheckOut:Ke}),Nt(()=>ve.value,()=>{re.batchOptCheckModel=!1}),(R,X)=>{const be=Ha("Sort"),Pe=Wt,_e=At,Ce=Vn,ue=At,f=nn,ce=Ha("ArrowRight"),se=on,Ue=ln,Je=Ao;return!e(ee)&&!e(fa)()?(c(),M("div",{key:0,class:rt(["bar-main",[tt.value,{"bar-main-background":O.value}]]),onMousedown:ct},[e(b).component==="DeTabs"&&e(Y)==="canvas"?(c(),B(e(ta),{key:0,effect:"dark",placement:"top",content:e(o)("visualization.sort")},{default:_(()=>[m(Pe,{class:"bar-base-icon",onClick:j},{default:_(()=>[m(be)]),_:1})]),_:1},8,["content"])):F("",!0),e(b).component==="VQuery"&&e(Y)==="canvas"?(c(),M(st,{key:1},[x("span",{title:e(o)("visualization.add_query_filter")},[m(Pe,{class:"bar-base-icon",onClick:Ye},{default:_(()=>[m(_e,{name:"icon_add_outlined"},{default:_(()=>[m(e(Xo),{class:"svg-icon"})]),_:1})]),_:1})],8,Oi),x("span",{title:e(o)("visualization.edit_query_filter")},[m(Pe,{class:"bar-base-icon",onClick:qe},{default:_(()=>[m(_e,{name:"icon_edit_outlined"},{default:_(()=>[m(e(jo),{class:"svg-icon"})]),_:1})]),_:1})],8,zi)],64)):F("",!0),e(b).innerType!=="rich-text"&&H("enlarge")?(c(),B(e(ta),{key:2,effect:"dark",placement:"top",content:e(o)("visualization.enlarge")},{default:_(()=>[x("span",null,[m(Pe,{class:"bar-base-icon",onClick:X[0]||(X[0]=Be=>ie(Be,"enlarge"))},{default:_(()=>[m(_e,{name:"dv-bar-enlarge"},{default:_(()=>[m(e(yi),{class:"svg-icon"})]),_:1})]),_:1})])]),_:1},8,["content"])):F("",!0),!["picture-group","rich-text"].includes(e(b).innerType)&&H("details")?(c(),B(e(ta),{key:3,effect:"dark",placement:$e.value,content:e(o)("visualization.show_data_info")},{default:_(()=>[x("span",null,[m(Pe,{class:"bar-base-icon",onClick:X[1]||(X[1]=Be=>ie(Be,"details"))},{default:_(()=>[m(_e,{name:"dv-details"},{default:_(()=>[m(e(wi),{class:"svg-icon"})]),_:1})]),_:1})])]),_:1},8,["placement","content"])):F("",!0),H("datasetParams")&&Ie.value?(c(),B(e(ta),{key:4,effect:"dark",placement:"top",content:e(o)("visualization.input_calc_data")},{default:_(()=>[x("span",null,[m(Pe,{class:"bar-base-icon",onClick:E},{default:_(()=>[m(_e,{name:"icon_params_setting"},{default:_(()=>[m(e(Yo),{class:"svg-icon"})]),_:1})]),_:1})])]),_:1},8,["content"])):F("",!0),H("multiplexing")?(c(),M("div",Ti,[m(Ce,{onClick:X[2]||(X[2]=Yt(()=>{},["stop"])),style:{height:"26px",padding:"5px"},modelValue:re.multiplexingCheckModel,"onUpdate:modelValue":X[3]||(X[3]=Be=>re.multiplexingCheckModel=Be),onChange:we},null,8,["modelValue"])])):F("",!0),H("unLinkage")&&vt.value?(c(),M("span",{key:6,title:e(o)("visualization.cancel_linkage")},[m(Pe,{class:"bar-base-icon",onClick:at},{default:_(()=>[m(_e,{name:"dv-bar-unLinkage"},{default:_(()=>[m(e(Wn),{class:"svg-icon"})]),_:1})]),_:1})],8,$i)):F("",!0),H("batchOpt")?(c(),M("div",Gi,[m(Ce,{modelValue:re.batchOptCheckModel,"onUpdate:modelValue":X[4]||(X[4]=Be=>re.batchOptCheckModel=Be),onChange:pt},null,8,["modelValue"])])):F("",!0),H("setting")?(c(),B(Ue,{key:8,trigger:"click",placement:"right-start",ref_key:"curDropdown",ref:He},{dropdown:_(()=>[m(se,null,{default:_(()=>[H("copy")?(c(),B(f,{key:0,onClick:J},{default:_(()=>[Ae(N(e(o)("visualization.copy")),1)]),_:1})):F("",!0),e(b).innerType!=="rich-text"&&H("enlarge")?(c(),M(st,{key:1},[m(f,{divided:e(Y)==="canvas",onClick:X[5]||(X[5]=Be=>ie(Be,"enlarge"))},{default:_(()=>[Ae(N(e(o)("visualization.enlarge")),1)]),_:1},8,["divided"]),!["picture-group","rich-text"].includes(e(b).innerType)&&H("details")?(c(),B(f,{key:0,onClick:X[6]||(X[6]=Be=>ie(Be,"details"))},{default:_(()=>[Ae(N(e(o)("visualization.show_data_info")),1)]),_:1})):F("",!0),!["picture-group","rich-text"].includes(e(b).innerType)&&H("download")&&T.value&&(l.value[0]||l.value[1])?(c(),B(f,{key:1,style:{padding:"0"},onClick:X[7]||(X[7]=Yt(()=>{},["prevent"]))},{default:_(()=>[m(Ue,{style:{width:"100%"},trigger:"hover",placement:"right-start"},{dropdown:_(()=>[m(se,null,{default:_(()=>[l.value[1]?(c(),B(f,{key:0,onClick:D},{default:_(()=>X[8]||(X[8]=[Ae("Excel ")])),_:1})):F("",!0),l.value[1]&&e(b).innerType==="table-pivot"?(c(),B(f,{key:1,onClick:W},{default:_(()=>[x("span",null,N(e(o)("visualization.excel_with_format")),1)]),_:1})):F("",!0),l.value[0]?(c(),B(f,{key:2,onClick:q},{default:_(()=>[Ae(N(e(o)("visualization.image")),1)]),_:1})):F("",!0)]),_:1})]),default:_(()=>[x("div",Ri,[Ae(N(e(o)("visualization.export_as"))+" ",1),m(Pe,{size:"16px",style:{position:"absolute",right:"8px","margin-right":"0"}},{default:_(()=>[m(ce)]),_:1})])]),_:1})]),_:1})):F("",!0)],64)):F("",!0),H("hidden")&&e(De)(e(G))?(c(),B(f,{key:2,onClick:ye},{default:_(()=>[Ae(N(e(o)("visualization.hidden")),1)]),_:1})):F("",!0),m(e(Ga),{chart:e(b),jsname:"L2NvbXBvbmVudC90aHJlc2hvbGQtd2FybmluZy9FZGl0QmFySGFuZGxlcg==",onCloseItem:Me},null,8,["chart"]),H("delete")?(c(),B(f,{key:3,divided:"",onClick:L},{default:_(()=>[Ae(N(e(o)("visualization.delete")),1)]),_:1})):F("",!0)]),_:1})]),default:_(()=>[m(Pe,{class:"bar-base-icon"},{default:_(()=>[m(e(ta),{content:e(o)("visualization.more"),effect:"dark",placement:"bottom"},{default:_(()=>[m(ue,{name:"icon_more_outlined"},{default:_(()=>[m(e(Ko),{class:"svg-icon"})]),_:1})]),_:1},8,["content"])]),_:1})]),_:1},512)):F("",!0),!["picture-group","rich-text"].includes(e(b).innerType)&&H("previewDownload")&&T.value&&(l.value[0]||l.value[1])?(c(),B(Ue,{key:9,trigger:"click",placement:"right-start"},{dropdown:_(()=>[m(se,{style:{width:"118px"}},{default:_(()=>[l.value[1]?(c(),B(f,{key:0,onClick:D},{default:_(()=>X[9]||(X[9]=[Ae("Excel ")])),_:1})):F("",!0),l.value[1]&&e(b).innerType==="table-pivot"?(c(),B(f,{key:1,onClick:W},{default:_(()=>[x("span",null,N(e(o)("visualization.excel_with_format")),1)]),_:1})):F("",!0),l.value[0]?(c(),B(f,{key:2,onClick:q},{default:_(()=>[Ae(N(e(o)("visualization.image")),1)]),_:1})):F("",!0)]),_:1})]),default:_(()=>[m(Pe,{onClick:ae,class:"bar-base-icon"},{default:_(()=>[m(e(ta),{content:e(o)("chart.export"),effect:"dark",placement:"bottom"},{default:_(()=>[m(ue,{name:"dv-preview-download"},{default:_(()=>[m(e(da),{class:"svg-icon"})]),_:1})]),_:1},8,["content"])]),_:1})]),_:1})):F("",!0),Et.value?(c(),B(Je,{key:10,width:"200",trigger:"click",onMousedown:ct},{reference:_(()=>[m(Pe,{class:"bar-base-icon"},{default:_(()=>[m(_e,{name:"database"},{default:_(()=>[m(e(Ii),{class:"svg-icon"})]),_:1})]),_:1})]),default:_(()=>[m(Vi,{fields:re.curFields,element:e(b)},null,8,["fields","element"])]),_:1})):F("",!0),m(Ai,{ref_key:"customTabsSortRef",ref:d},null,512)],34)):F("",!0)}}});const Un=Ge(qi,[["__scopeId","data-v-2f9fc3ae"]]),Zi=Ee({__name:"ComposeShow",props:{element:{required:!0,type:Object},elementIndex:{required:!1},showBorder:{required:!1,type:Boolean,default:!0}},setup(a){const n=Ra(),{areaData:r}=lt(n),i=a,g=w(()=>r.value.components.includes(i.element)),v=d=>{if(d.buttons===2)return;const l=r.value.components.findIndex(s=>s===i.element);l!=-1&&i.element.component!=="GroupArea"&&(r.value.components.splice(l,1),d.stopPropagation())};return(d,l)=>g.value?(c(),M("div",{key:0,class:rt(["compose-shadow",{"shadow-border":i.showBorder}]),onMousedown:v},null,34)):F("",!0)}});const Wi=Ge(Zi,[["__scopeId","data-v-0d4e81fa"]]),Ni={t:"1738739001616",class:"icon",viewBox:"0 0 1175 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"8488","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"229.4921875",height:"200"};function Ui(a,n){return c(),M("svg",Ni,n[0]||(n[0]=[x("path",{d:"M587.83008 276.574053a235.132032 235.132032 0 0 1 235.132033 235.132032 249.533869 249.533869 0 0 1-1.469576 25.864523l170.470724 170.764639A1046.631458 1046.631458 0 0 0 1175.660161 511.706085c-161.065442-220.43628-365.336395-352.698048-587.830081-352.698048a562.553387 562.553387 0 0 0-129.616532 15.577497l103.752009 103.458094a249.533869 249.533869 0 0 1 25.864523-1.469575zM76.123995 83.177956L255.706085 262.760046A987.554535 987.554535 0 0 0 0 511.706085c161.065442 220.730195 365.336395 352.698048 587.83008 352.698048a575.485649 575.485649 0 0 0 223.375431-46.144661l205.740528 205.740528L1099.536165 940.528129l-940.528128-940.528129zM352.698048 511.706085a231.311137 231.311137 0 0 1 32.918485-119.035591l88.174512 88.174512a113.745121 113.745121 0 0 0-4.408726 29.391504 117.566016 117.566016 0 0 0 117.566016 117.566016 111.98163 111.98163 0 0 0 29.391504-4.408726l45.850747 45.850746L705.396096 712.743972a235.132032 235.132032 0 0 1-352.698048-202.507462z","p-id":"8489"},null,-1)]))}const ji={render:Ui},Xi=["id"],Yi=["title"],Ki=["id"],Ji=["onMousedown"],Qi=Ee({__name:"Shape",props:{element:{required:!0,type:Object,default(){return{component:null,propValue:null,request:null,linkage:null,type:null,events:null,style:null,id:null}}},defaultStyle:{required:!0,type:Object,default(){return{}}},baseCellInfo:{required:!0,type:Object,default(){return{baseWidth:0,baseHeight:0,curGap:0}}},index:{required:!0,type:[Number,String],default:0},isTabMoveCheck:{type:Boolean,default:!0},canvasId:{type:String,default:"canvas-main"},scale:{type:Number,required:!1,default:1},canvasActive:{type:Boolean,required:!1,default:!0}},emits:["userViewEnlargeOpen","datasetParamsInit","onStartResize","onStartMove","onDragging","onResizing","onMouseUp","linkJumpSetOpen","linkageSetOpen"],setup(a,{emit:n}){const{t:r}=Ut(),i=ut(),g=oa(),v=sn(),d=Ra(),l=I(null),s=I(null),o=I(null),C=I(null),u=I(!1),U=w(()=>"enlarge-inner-shape-"+y.value.id),{curComponent:H,dvInfo:O,editMode:k,batchOptStatus:b,curBatchOptComponents:oe,linkageSettingStatus:Y,curLinkageView:G,tabCollisionActiveId:ve,tabMoveInActiveId:le,tabMoveOutComponentId:Q,mobileInPc:K,mainScrollTop:ge,hiddenListStatus:ee}=lt(i),{editorMap:Se,areaData:ne,isCtrlOrCmdDown:Re}=lt(d),re=n,$=w(()=>k.value==="edit"),j=Kt({seriesIdMap:{id:""},ignoreTabMoveComponent:["de-button","de-reset-button","DeTabs","GroupArea"],parentWidthTabOffset:40,canvasChangeTips:"none",tabMoveInYOffset:70,tabMoveInXOffset:40,collisionGap:10}),ae=S=>{S.preventDefault(),S.stopPropagation(),y.value&&(y.value.dashboardHidden=!0,te.emit("removeMatrixItemPosition-"+E.value,y.value),g.recordSnapshotCache("hide"),i.setLastHiddenComponent(y.value.id))},Ye=w(()=>ee.value&&De(E.value)),qe=I(!0),tt=w(()=>y.value.isLock&&$.value),$e=w(()=>{let S;return nt.value?S="batchOpt":$.value?S=O.value.type==="dashboard"?"canvas":"canvasDataV":S="preview",S}),Te=a,{element:y,defaultStyle:W,baseCellInfo:D,index:q,isTabMoveCheck:L,canvasId:E,scale:J,canvasActive:ie}=yt(Te),ye=tl(y.value,"pTabGroup"),ze=al(y.value),we=I("shape-id-"+y.value.id),Ke=["lt","t","rt","r","rb","b","lb","l"],pt=["lt","rt","rb","lb"],dt=["r","l"],vt={lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315},at=I({}),ct=w(()=>K.value&&y.value.canvasId==="canvas-main"),Et=(S,z)=>{z==="syncPcDesign"&&(S.preventDefault(),S.stopPropagation()),ke().emitter.emit("onMobileStatusChange",{type:z,value:y.value.id})},A=[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],T=w(()=>{var S;return((S=H.value)==null?void 0:S.component)==="GroupArea"}),Ie=w(()=>{var S;return((S=H.value)==null?void 0:S.id)===y.value.id}),He=w(()=>{const S=["flow-map","map","bubble-map","table-info","table-normal","table-pivot","symbolic-map","heat-map","t-heatmap","circle-packing"];return y.value.isPlugin||S.includes(y.value.innerType)}),Me=w(()=>O.value.type==="dashboard"),R=()=>y.value.component==="line-shape"?dt:Ke,X=()=>Ie.value&&!y.value.isLock&&$.value,be=S=>{re("userViewEnlargeOpen",S)},Pe=S=>{re("datasetParamsInit",S)},_e=S=>{let{width:z,height:Z}=W.value;const{sizeX:Le,sizeY:Fe}=y.value;Me.value&&!y.value.isPlayer?(z=Le*D.value.baseWidth-2*D.value.curGap,Z=Fe*D.value.baseHeight-2*D.value.curGap):(z=z-2*D.value.curGap,Z=Z-2*D.value.curGap);const Xe=/t/.test(S),he=/b/.test(S),Qe=/l/.test(S),ht=/r/.test(S);let it=0,et=0;return S.length===2?(it=Qe?0:z,et=Xe?0:Z):((Xe||he)&&(it=z/2,et=Xe?0:Z),(Qe||ht)&&(it=Qe?0:z,et=Math.floor(Z/2))),{marginLeft:"-4px",marginTop:"-4px",left:`${it}px`,top:`${et}px`,cursor:at.value[S]}},Ce=()=>{const S=ja(H.value.style.rotate),z={};let Z=-1;return Ke.forEach(Le=>{const Fe=ja(vt[Le]+S),Xe=A.length;for(;;){Z=(Z+1)%Xe;const he=A[Z];if(Fe<23||Fe>=338){z[Le]="nw-resize";return}if(he.start<=Fe&&Fe<he.end){z[Le]=he.cursor+"-resize";return}}}),z},ue=S=>{ie.value&&(i.setCurComponent({component:y.value,index:q.value}),Ue(S))},f=S=>{S&&!S.isLock&&S.isShow&&S.canvasId==="canvas-main"&&!["GroupArea"].includes(S.component)&&ne.value.components.push(S)},ce=()=>{y.value.canvasId!=="canvas-main"&&i.setCurComponent({component:y.value,index:q.value})},se=S=>{if(ie.value){if(Be(S),Re.value&&!ne.value.components.includes(y)){f(y.value),H.value&&H.value.id!==y.value.id&&f(H.value),S.stopPropagation();return}if(i.setCurComponent({component:y.value,index:q.value}),He.value){i.setInEditorStatus(!0),i.setClickComponentStatus(!0),S.stopPropagation();return}Ue(S)}},Ue=S=>{if(y.value.editing){S.stopPropagation();return}if(Me.value&&re("onStartMove",S),We(()=>te.emit("componentClick")),i.setInEditorStatus(!0),i.setClickComponentStatus(!0),S.stopPropagation(),y.value.isLock||!$.value)return;at.value=Ce();const z={...W.value},Z=S.clientY,Le=S.clientX,Fe=S.offsetY,Xe=S.offsetX,he=Number(z.top),Qe=Number(z.left);let ht=!1,it=!0;const et=l.value.offsetWidth,St=s.value.offsetWidth,kt=s.value.offsetHeight;let It=Ya(E.value)?document.getElementById("shape-id-"+E.value.split("--")[0]):null;const Mt=document.getElementById(we.value),qt=Jt=>{ht=!0;const Ft=Jt.clientX,Pt=Jt.clientY,Zt=Pt-Z+he,jt=Ft-Le+Qe;if(z.top=Zt,z.left=jt,!ye&&ze&&!De(E.value)&&!Ka(E.value)&&!T.value&&(Zt<-30||jt<-30||jt+St-et>30)){qe.value=!1,i.setMousePointShadowMap({mouseX:!gt()&&It?It.offsetLeft+Mt.offsetLeft+Xe:Ft,mouseY:!gt()&&It?It.offsetTop+Mt.offsetTop+Fe+100:Pt+ge.value,width:St,height:kt});const la=y.value.canvasId.split("--")[0];i.setTabMoveOutComponentId(la)}else i.setTabMoveOutComponentId(null),qe.value=!0;ft(),Me.value&&(it||!le.value&&!ve.value)&&(y.value.dragging=!0,re("onDragging",S)),["DeTabs","Group"].includes(y.value.component)&&pa(y.value),(Ka(E.value)||Ya(E.value))&&hn(y.value,{width:l.value.offsetWidth,height:l.value.offsetHeight}),it&&(it=!1),i.setShapeStyle(z,ne.value.components,"move"),T.value||We(()=>{te.emit("move",{isDownward:Pt-Z>0,isRightward:Ft-Le>0})})},bt=()=>{Me.value&&re("onMouseUp"),y.value.dragging=!1,ht&&g.recordSnapshotCacheWithPositionChange("shape-handleMouseDownOnShape-up"),te.emit("unMove"),document.removeEventListener("mousemove",qt),document.removeEventListener("mouseup",bt),le.value&&(te.emit("onTabMoveIn-"+le.value,y.value),i.setTabMoveInActiveId(null),i.setTabCollisionActiveId(null)),Q.value&&(te.emit("onTabMoveOut-"+Q.value,na(y.value)),i.setTabMoveOutComponentId(null)),Ca()};document.addEventListener("mousemove",qt),document.addEventListener("mouseup",bt)},Je=S=>{ie.value&&O.value.type==="dataV"&&(S.stopPropagation(),S.preventDefault(),v.hideContextMenu())},Be=S=>{if(nt.value){C.value.batchOptCheckOut(),S.stopPropagation(),S.preventDefault();return}},Dt=(S,z)=>{if(!ie.value)return;Me.value&&re("onStartResize",z),i.setInEditorStatus(!0),i.setClickComponentStatus(!0),z.stopPropagation(),z.preventDefault();const Z={...W.value},Le=Z.width/Z.height,Fe={x:Z.left+Z.width/2,y:Z.top+Z.height/2},Xe=Se.value[E.value].getBoundingClientRect(),he=z.target.getBoundingClientRect(),Qe={x:Math.round(he.left-Xe.left+z.target.offsetWidth/2+de("x",S)/2),y:Math.round(he.top-Xe.top+z.target.offsetHeight/2+de("y",S)/2)},ht={x:Fe.x-(Qe.x-Fe.x)-de("x",S)/4,y:Fe.y-(Qe.y-Fe.y)-de("y",S)/4};let it=!1,et=!0;const St=_t(),kt=H.value.aspectRatio,It={};ne.value.components.length>0&&ne.value.components.forEach(bt=>{It[bt.id]={topRadio:(bt.style.top-Z.top)/Z.height,leftRadio:(bt.style.left-Z.left)/Z.width,widthRadio:bt.style.width/Z.width,heightRadio:bt.style.height/Z.height}});const Mt=bt=>{if(et){et=!1;return}it=!0;const Jt={x:bt.clientX-Math.round(Xe.left)+de("x",S),y:bt.clientY-Math.round(Xe.top)+de("y",S)};if(fi(S,Z,Jt,Le,St,{center:Fe,curPoint:Qe,symmetricPoint:ht}),Ze(Z,S),H.value.maintainRadio){const Ft=Z.height-W.value.height,Pt=Z.width-W.value.width,Zt=Ft*kt;pt.includes(S)||Math.abs(Pt)>Math.abs(Zt)?Z.height=W.value.width/kt:Z.width=W.value.height*kt}hi(S,Z,ht),i.setShapeStyle(Z,ne.value.components,"resize",It),Me.value&&re("onResizing",bt),y.value.resizing=!0,(["Group"].includes(y.value.component)||["DeTabs"].includes(y.value.component)&&!y.value.resizeInnerKeep)&&pa(y.value),(Ka(E.value)||Ya(E.value))&&hn(y.value,{width:l.value.offsetWidth,height:l.value.offsetHeight})},qt=()=>{["DeTabs"].includes(y.value.component)&&y.value.resizeInnerKeep&&Mo(y.value),Me.value&&re("onMouseUp"),y.value.resizing=!1,document.removeEventListener("mousemove",Mt),document.removeEventListener("mouseup",qt),it&&g.recordSnapshotCacheWithPositionChange("shape-handleMouseDownOnPoint-up"),Ca()};document.addEventListener("mousemove",Mt),document.addEventListener("mouseup",qt)},Ze=(S,z)=>{Me.value||(z.indexOf("r")>-1&&(S.left=S.left+1),z.indexOf("b")>-1&&(S.top=S.top+1),z.indexOf("l")>-1&&(S.width=S.width+1),z.indexOf("t")>-1&&(S.height=S.height+1))},de=(S,z)=>{const Z=D.value.curGap;return S==="x"?z.indexOf("r")>-1?Z:-1*Z:z.indexOf("b")>-1?Z:-1*Z},_t=()=>{if(y.value.component!="Group")return!1;const S=[0,90,180,360];for(const z of y.value.propValue)if(!S.includes(ja(parseInt(z.style.rotate))))return!0;return!1},zt=w(()=>{const{backgroundImageEnable:S,backgroundType:z,innerImage:Z}=y.value.commonBackground;return S&&z==="innerImage"&&typeof Z=="string"}),Gt=w(()=>zt.value?y.value.commonBackground.innerImage.replace("board/","").replace(".svg",""):null);w(()=>{const S=W.value.width,z=W.value.height,Z=y.value.multiDimensional.x,Le=y.value.multiDimensional.y,Fe=Z*Math.PI/180,Xe=Le*Math.PI/180,he=Math.abs(S*Math.cos(Xe))+Math.abs(z*Math.sin(Fe)),Qe=Math.abs(z*Math.cos(Fe))+Math.abs(S*Math.sin(Xe)),ht=(he-S)/2,it=(Qe-z)/2;return{paddingX:`${ht}px`,paddingY:`${it}px`}});const Xt=w(()=>{if(y.value.commonBackground&&y.value.component!=="GroupArea"){const{backdropFilterEnable:S,backdropFilter:z,backgroundColorSelect:Z,backgroundColor:Le,backgroundImageEnable:Fe,backgroundType:Xe,outerImage:he,innerPadding:Qe,borderRadius:ht}=y.value.commonBackground;let et={padding:(["Group"].includes(y.value.component)?0:Qe)*J.value+"px",borderRadius:ht+"px"},St="";return Z&&Le&&(St=Le),Fe&&Xe==="outerImage"&&typeof he=="string"?et.background=`url(${rn(he)}) no-repeat ${St}`:et["background-color"]=St,y.value.component!=="UserView"&&(et.overflow="hidden"),S&&(et["backdrop-filter"]="blur("+z+"px)"),et}return{}}),Ct=w(()=>(Ie.value||nt.value)&&["canvas","canvasDataV","batchOpt"].includes($e.value)||Y.value),Rt=w(()=>Y.value&&y.value.id===G.value.id),xt=()=>{re("linkJumpSetOpen")},pe=()=>{re("linkageSetOpen")},fe=()=>{s.value.setAttribute("tab-is-check",`${L.value}`),s.value.setAttribute("component-type",`${y.value.component}`),s.value.setAttribute("component-id",`${y.value.id}`)},ft=async()=>{const S=document.querySelector("#"+we.value),z=S.offsetWidth,Z=S.offsetHeight,Le=S.offsetLeft,Fe=S.offsetTop;if(ze&&L.value&&!j.ignoreTabMoveComponent.includes(y.value.component)){const Xe=Array.from(l.value.childNodes);for(const he of Xe)if(he.className!==void 0&&typeof he.className=="string"&&he.className.split(" ").includes("shape")&&he.getAttribute("component-id")!==we.value&&he.getAttribute("tab-is-check")!==null&&he.getAttribute("tab-is-check")!=="false"&&he.getAttribute("component-type")==="DeTabs"){const Qe=he.getAttribute("component-id"),ht=he.offsetWidth,it=he.offsetHeight,et=he.offsetLeft,St=he.offsetTop,kt=St+j.tabMoveInYOffset,It=et+j.collisionGap-z,Mt=ht+2*z-j.collisionGap,qt=it+Z-j.tabMoveInYOffset,bt=kt<=Fe&&It<=Le,Jt=kt+qt>=Fe+Z&&It<=Le,Ft=kt<=Fe&&It+Mt>=Le+z,Pt=kt+qt>=Fe+Z&&It+Mt>=Le+z;bt&&Jt&&Ft&&Pt?i.setTabCollisionActiveId(Qe):ve.value===Qe&&i.setTabCollisionActiveId(null);const Zt=St+j.tabMoveInYOffset,jt=et+j.collisionGap*10-z,la=ht+2*z-j.collisionGap*20,sa=it+Z-2*j.tabMoveInYOffset,wa=Zt<=Fe&&jt<=Le,Na=Zt+sa>=Fe+Z&&jt<=Le,Qt=Zt<=Fe&&jt+la>=Le+z,Ua=Zt+sa>=Fe+Z&&jt+la>=Le+z;wa&&Na&&Qt&&Ua?i.setTabMoveInActiveId(Qe):le.value===Qe&&i.setTabMoveInActiveId(null)}}},wt=w(()=>{var S;if(y.value.multiDimensional&&((S=y.value.multiDimensional)!=null&&S.enable)){const z=W.value.width,Z=W.value.height,Le=y.value.multiDimensional.x,Fe=y.value.multiDimensional.y,Xe=Le*Math.PI/180,he=Fe*Math.PI/180,Qe=Math.abs(z*Math.cos(he))+Math.abs(Z*Math.sin(Xe)),ht=Math.abs(Z*Math.cos(Xe))+Math.abs(z*Math.sin(he)),it=(Qe-z)/2;return{padding:`${(ht-Z)/2}px ${it}px`,transform:`rotateX(${y.value.multiDimensional.x}deg) rotateY(${y.value.multiDimensional.y}deg) rotateZ(${y.value.multiDimensional.z}deg)`}}else return{}}),nt=w(()=>b.value&&Me.value),je=w(()=>Ie.value&&!!ve.value),Ht=()=>{u.value=!0,ke().emitter.emit("l7-prepare-picture",y.value.id),setTimeout(()=>{_a(U.value,"canvas-main",J.value),En("img",o.value,"图表",()=>{$n(U.value),u.value=!1,ke().emitter.emit("l7-unprepare-picture",y.value.id)})},200)},Ca=()=>{y.value.canvasId.includes("Group")&&d.updateGroupBorder(y.value.canvasId)};return Bt(()=>{var z;l.value=document.querySelector("#editor-"+E.value),H.value&&(at.value=Ce()),te.on("runAnimation",()=>{y.value==H.value}),te.on("stopAnimation",()=>{}),fe();const S="componentImageDownload-"+y.value.id;(z=ke().emitter.all.get(S))!=null&&z.length||ke().emitter.on(S,()=>{Ht()})}),(S,z)=>{var Xe;const Z=Wt,Le=ta,Fe=za("loading");return ot((c(),M("div",{class:rt(["shape",{"shape-group-area":T.value}]),ref_key:"shapeInnerRef",ref:s,id:we.value,"element-loading-text":"导出中...","element-loading-background":"rgba(255, 255, 255, 1)",onDblclick:ce},[ct.value?(c(),M("div",{key:0,title:e(r)("visualization.sync_pc_design"),class:"refresh-from-pc",onClick:z[0]||(z[0]=he=>Et(he,"syncPcDesign"))},[m(Z,null,{default:_(()=>[m(At,{name:"icon_replace_outlined"},{default:_(()=>[m(e(Go),{class:"svg-icon"})]),_:1})]),_:1})],8,Yi)):F("",!0),ct.value?(c(),M("div",{key:1,class:"del-from-mobile",onClick:z[1]||(z[1]=he=>Et(he,"delFromMobile"))},[m(Z,null,{default:_(()=>[m(At,{name:"mobile-checkbox"},{default:_(()=>[m(e(ti),{class:"svg-icon"})]),_:1})]),_:1})])):F("",!0),Ye.value?(c(),M("div",{key:2,class:"del-from-mobile",onMousedown:Yt(ae,["stop"])},[m(Le,{content:S.$t("visualization.hidden"),placement:"bottom"},{default:_(()=>[m(Z,{onClick:z[3]||(z[3]=Yt(()=>{},["stop"]))},{default:_(()=>[m(At,{onClick:z[2]||(z[2]=Yt(()=>{},["stop"])),name:"dvHidden"},{default:_(()=>[m(e(ji),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])],32)):F("",!0),ot(x("div",{class:rt(["shape-outer",{active:Ie.value,"shape-lock":tt.value,"shape-edit":$.value&&!He.value,"linkage-setting":Rt.value,"drag-on-tab-collision":je.value,"shape-selected":(Xe=e(oe))==null?void 0:Xe.includes(e(y).id)}])},[m(Un,{ref_key:"componentEditBarRef",ref:C,class:rt(["edit-bar",{"edit-bar-active":Ct.value}]),index:e(q),element:e(y),"show-position":$e.value,"canvas-id":e(E),onUserViewEnlargeOpen:be,onDatasetParamsInit:Pe,onLinkJumpSetOpen:xt,onLinkageSetOpen:pe},null,8,["class","index","element","show-position","canvas-id"]),x("div",{class:"shape-inner",ref_key:"componentInnerRef",ref:o,id:U.value,style:Oe(Xt.value),onClick:Je,onMousedown:se},[tt.value?(c(),B(At,{key:0,name:"dv-lock"},{default:_(()=>[m(e(oi),{class:"svg-icon iconfont icon-suo"})]),_:1})):F("",!0),x("div",{class:"component-slot",style:Oe(wt.value)},[an(S.$slots,"default",{},void 0,!0)],4),zt.value?(c(),B(Ea,{key:1,style:Oe({color:e(y).commonBackground.innerImageColor,pointerEvents:"none"}),name:Gt.value},null,8,["style","name"])):F("",!0)],44,Ki),(c(!0),M(st,null,$t(X()?R():[],he=>(c(),M("div",{key:he,class:"shape-point",style:Oe(_e(he)),onMousedown:Qe=>Dt(he,Qe)},null,44,Ji))),128)),ot(x("div",{class:"shape-shadow",onMousedown:Be},null,544),[[mt,nt.value&&e(y).component!=="DeTabs"]]),He.value?(c(),M(st,{key:0},[ot(x("div",{class:"de-drag-area de-drag-top",onMousedown:ue},null,544),[[mt,!e(y).editing]]),ot(x("div",{class:"de-drag-area de-drag-right",onMousedown:ue},null,544),[[mt,!e(y).editing&&e(y).component!=="DeTabs"]]),ot(x("div",{class:"de-drag-area de-drag-bottom",onMousedown:ue},null,544),[[mt,!e(y).editing&&e(y).component!=="DeTabs"]]),ot(x("div",{class:"de-drag-area de-drag-left",onMousedown:ue},null,544),[[mt,!e(y).editing&&e(y).component!=="DeTabs"]])],64)):F("",!0)],2),[[mt,qe.value]]),m(Wi,{element:e(y)},null,8,["element"])],42,Xi)),[[Fe,u.value]])}}});const es=Ge(Qi,[["__scopeId","data-v-e074c784"]]),ts=Ee({__name:"ContextMenuDetails",props:{activePosition:{type:String,default:"canvas"}},emits:["close","rename"],setup(a,{emit:n}){const r=ut(),i=An(),g=No(),v=oa(),d=Nn(),l=Ra(),{areaData:s}=lt(l),{curComponent:o,componentData:C}=lt(r),u=n,{emitter:U}=ke(),H=a,{activePosition:O}=yt(H),{t:k}=Ut(),b=w(()=>C.value.filter(L=>L.category==="hidden").length),oe=()=>{o.value&&!D.value?g.lock():s.value.components.length&&s.value.components.forEach(L=>{g.lock(L)}),v.recordSnapshotCache("lock"),ve("lock")},Y=()=>{o.value&&!D.value?g.unlock():s.value.components.length&&s.value.components.forEach(L=>{g.unlock(L)}),ve("unlock")},G=()=>{r.setClickComponentStatus(!0),O.value==="aside"&&u("close")},ve=L=>{const E={opt:L};O.value==="aside"&&u("close",E)},le=()=>{if(o.value){const L=ca();i.cut(L.componentData)}else s.value.components.length&&i.cut();ve("cut")},Q=()=>{i.copy(),ve("copy")},K=()=>{o.value&&!D.value?d.hideComponentWithComponent():s.value.components.length&&s.value.components.forEach(L=>{d.hideComponentWithComponent(L.id)}),v.recordSnapshotCache("hide"),ve("hide")},ge=()=>{o.value&&!D.value?d.showComponent():s.value.components.length&&s.value.components.forEach(L=>{d.showComponent(L.id)}),v.recordSnapshotCache("show"),ve("show")},ee=w(()=>{var L,E;return((L=o==null?void 0:o.value)==null?void 0:L.canvasId)==="canvas-main"&&(o==null?void 0:o.value.category)==="base"&&((E=o.value)==null?void 0:E.component)==="VQuery"&&b.value===0}),Se=L=>{o.value&&(v.recordSnapshotCache("categoryChange"),o.value.category=L,L==="hidden"&&r.canvasStateChange({key:"curPointArea",value:"hidden"}))},ne=()=>{u("rename"),ve("rename")},Re=()=>{i.paste(!0),v.recordSnapshotCache("renderChart"),ve("paste")},re=()=>{var L;if(o.value&&!D.value){const E=ca();r.deleteComponentById((L=o.value)==null?void 0:L.id,E.componentData)}else s.value.components.length&&s.value.components.forEach(E=>{r.deleteComponentById(E.id)});te.emit("hideArea-canvas-main"),v.recordSnapshotCache("deleteComponent"),ve("deleteComponent")},$=()=>{o.value&&!D.value?d.upComponent(o.value.id):s.value.components.length&&(ka(s.value.components),s.value.components.forEach(L=>{d.upComponent(L.id)})),v.recordSnapshotCache("upComponent"),ve("upComponent")},j=()=>{o.value&&!D.value?d.downComponent(o.value.id):s.value.components.length&&(ka(s.value.components,"top"),s.value.components.forEach(L=>{d.downComponent(L.id)})),v.recordSnapshotCache("downComponent"),ve("downComponent")},ae=()=>{o.value&&!D.value?d.topComponent(o.value.id):s.value.components.length&&(ka(s.value.components,"top"),s.value.components.forEach(L=>{d.topComponent(L.id)})),v.recordSnapshotCache("topComponent"),ve("topComponent")},Ye=()=>{o.value&&!D.value?d.bottomComponent(o.value.id):s.value.components.length&&(ka(s.value.components),s.value.components.forEach(L=>{d.bottomComponent(L.id)})),v.recordSnapshotCache("bottomComponent"),ve("bottomComponent")},qe=()=>{te.emit("tabSort")},tt=()=>{l.compose(),v.recordSnapshotCache("componentCompose"),ve("componentCompose")},$e=()=>{l.decompose(),v.recordSnapshotCache("decompose"),ve("decompose")},Te=L=>{l.alignment(L),v.recordSnapshotCache("decompose")},y=L=>{L.preventDefault(),L.stopPropagation()},W=w(()=>!(!o||o.isLock||o.component!="Group"||o.category==="hidden")),D=w(()=>{var L;return((L=o.value)==null?void 0:L.component)==="GroupArea"}),q=()=>{U.emit(`editQueryCriteria${o.value.id}`)};return(L,E)=>{const J=Ha("ArrowRight"),ie=Wt,ye=nn,ze=on,we=ln;return c(),M("div",{class:"context-menu-base context-menu-details",onMousedown:y},[x("ul",{onMouseup:G},[e(s).components.length?(c(),M(st,{key:0},[x("li",{onMousedown:y,onClick:tt},N(e(k)("visualization.view_group")),33),m(we,{style:{width:"100%"},trigger:"hover",effect:"dark",placement:"right-start",teleported:!1,"popper-class":"context-menu-details"},{dropdown:_(()=>[m(ze,null,{default:_(()=>[m(ye,{style:{width:"118px"},onClick:E[0]||(E[0]=Ke=>Te("left"))},{default:_(()=>[Ae(N(e(k)("visualization.left_justifying")),1)]),_:1}),m(ye,{style:{width:"118px"},onClick:E[1]||(E[1]=Ke=>Te("right"))},{default:_(()=>[Ae(N(e(k)("visualization.right_justifying")),1)]),_:1}),m(ye,{onClick:E[2]||(E[2]=Ke=>Te("top"))},{default:_(()=>[Ae(N(e(k)("visualization.top_justifying")),1)]),_:1}),m(ye,{onClick:E[3]||(E[3]=Ke=>Te("bottom"))},{default:_(()=>[Ae(N(e(k)("visualization.bottom_justifying")),1)]),_:1}),m(ye,{onClick:E[4]||(E[4]=Ke=>Te("transverse"))},{default:_(()=>[Ae(N(e(k)("visualization.horizontally_centered")),1)]),_:1}),m(ye,{onClick:E[5]||(E[5]=Ke=>Te("direction"))},{default:_(()=>[Ae(N(e(k)("visualization.vertically_centered")),1)]),_:1})]),_:1})]),default:_(()=>[x("li",null,[x("div",null,[x("span",null,N(e(k)("visualization.alignment")),1),m(ie,null,{default:_(()=>[m(J)]),_:1})])])]),_:1}),m(e(ea),{class:"custom-divider"}),x("li",{onClick:Q},N(e(k)("visualization.copy")),1),x("li",{onClick:Re},N(e(k)("visualization.paste")),1),x("li",{onClick:le},N(e(k)("visualization.cut")),1),m(e(ea),{class:"custom-divider"}),x("li",{onClick:re},N(e(k)("visualization.delete")),1)],64)):F("",!0),ot(x("li",{onClick:E[6]||(E[6]=Ke=>$e())},N(e(k)("visualization.cancel_group")),513),[[mt,!(!e(o)||e(o).isLock||e(o).component!="Group")]]),ot(m(e(ea),{class:"custom-divider"},null,512),[[mt,W.value]]),e(o)?(c(),M(st,{key:1},[!e(o).isLock&&e(o).category==="hidden"?(c(),M(st,{key:0},[x("li",{onClick:E[7]||(E[7]=Ke=>Se("base"))},N(e(k)("visualization.move_to_screen_show")),1),x("li",{onClick:q},N(e(k)("visualization.edit")),1),e(O)==="aside"?(c(),M("li",{key:0,onClick:ne},N(e(k)("visualization.rename")),1)):F("",!0),x("li",{onClick:Q},N(e(k)("visualization.copy")),1),x("li",{onClick:Re},N(e(k)("visualization.paste")),1),m(e(ea),{class:"custom-divider"}),x("li",{onClick:re},N(e(k)("visualization.delete")),1)],64)):F("",!0),!e(o).isLock&&e(o).category!=="hidden"?(c(),M(st,{key:1},[e(o).component==="VQuery"?(c(),M("li",{key:0,onClick:q},N(e(k)("visualization.edit")),1)):F("",!0),x("li",{onClick:$},N(e(k)("visualization.up_component")),1),x("li",{onClick:j},N(e(k)("visualization.down_component")),1),x("li",{onClick:ae},N(e(k)("visualization.top_component")),1),x("li",{onClick:Ye},N(e(k)("visualization.bottom_component")),1),e(o).component==="DeTabs"?(c(),M("li",{key:1,onClick:qe},N(e(k)("visualization.sort")),1)):F("",!0),m(e(Ga),{chart:e(o),"is-screen":"",jsname:"L2NvbXBvbmVudC90aHJlc2hvbGQtd2FybmluZy9FZGl0QmFySGFuZGxlcg=="},null,8,["chart"]),ot(x("li",{onClick:E[8]||(E[8]=Ke=>Se("hidden"))},N(e(k)("visualization.move_to_pop_area")),513),[[mt,ee.value]]),m(e(ea),{class:"custom-divider"}),ot(x("li",{onClick:K},N(e(k)("visualization.hidden")),513),[[mt,e(o).isShow]]),ot(x("li",{onClick:ge},N(e(k)("visualization.cancel_hidden")),513),[[mt,!e(o).isShow||D.value]]),x("li",{onClick:oe},N(e(k)("visualization.lock")),1),e(o).isLock||D.value?(c(),M("li",{key:2,onClick:Y},N(e(k)("visualization.unlock")),1)):F("",!0),m(e(ea),{class:"custom-divider"}),e(O)==="aside"?(c(),M("li",{key:3,onClick:ne},N(e(k)("visualization.rename")),1)):F("",!0),x("li",{onClick:Q},N(e(k)("visualization.copy")),1),x("li",{onClick:Re},N(e(k)("visualization.paste")),1),x("li",{onClick:le},N(e(k)("visualization.cut")),1),m(e(ea),{class:"custom-divider"}),x("li",{onClick:re},N(e(k)("visualization.delete")),1)],64)):F("",!0),e(o).isLock?(c(),M("li",{key:2,onClick:Y},N(e(k)("visualization.unlock")),1)):F("",!0)],64)):!e(o)&&!e(s).components.length?(c(),M("li",{key:2,onClick:Re},N(e(k)("visualization.paste")),1)):F("",!0)],32)],32)}}});const as=Ee({__name:"ContextMenu",props:{showPosition:{default:"canvasCore"}},setup(a){const n=a,r=sn(),{menuTop:i,menuLeft:g,menuShow:v,position:d}=lt(r),l=w(()=>v.value&&n.showPosition===d.value);return(s,o)=>ot((c(),B(ts,{class:"contextmenu",style:Oe({top:e(i)+"px",left:e(g)+"px"})},null,8,["style"])),[[mt,l.value]])}});const ns=Ge(as,[["__scopeId","data-v-59dffd60"]]),os={class:"mark-line",id:"canvas-mark-line"},ls=Ee({__name:"MarkLine",setup(a){const n=I(["xt","xc","xb","yl","yc","yr"]),r=I(3),i=I({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),g=ut(),{curComponent:v,componentData:d}=lt(g);let l;const s=()=>{Object.keys(i.value).forEach(H=>{i.value[H]=!1})},o=(H,O)=>{const k=l.proxy.$refs,b=d.value,oe=Fa(v.value.style),Y=oe.width/2,G=oe.height/2;s(),b.forEach(ve=>{try{if(ve===v.value)return;const le=Fa(ve.style),{top:Q,left:K,bottom:ge,right:ee}=le,Se=le.width/2,ne=le.height/2,Re={top:[{isNearly:U(oe.top,Q),lineNode:k.xt[0],line:"xt",dragShift:Q,lineShift:Q},{isNearly:U(oe.bottom,Q),lineNode:k.xt[0],line:"xt",dragShift:Q-oe.height,lineShift:Q},{isNearly:U(oe.top+G,Q+ne),lineNode:k.xc[0],line:"xc",dragShift:Q+ne-G,lineShift:Q+ne},{isNearly:U(oe.top,ge),lineNode:k.xb[0],line:"xb",dragShift:ge,lineShift:ge},{isNearly:U(oe.bottom,ge),lineNode:k.xb[0],line:"xb",dragShift:ge-oe.height,lineShift:ge}],left:[{isNearly:U(oe.left,K),lineNode:k.yl[0],line:"yl",dragShift:K,lineShift:K},{isNearly:U(oe.right,K),lineNode:k.yl[0],line:"yl",dragShift:K-oe.width,lineShift:K},{isNearly:U(oe.left+Y,K+Se),lineNode:k.yc[0],line:"yc",dragShift:K+Se-Y,lineShift:K+Se},{isNearly:U(oe.left,ee),lineNode:k.yr[0],line:"yr",dragShift:ee,lineShift:ee},{isNearly:U(oe.right,ee),lineNode:k.yr[0],line:"yr",dragShift:ee-oe.width,lineShift:ee}]},re=[],{rotate:$}=v.value.style;Re&&Object.keys(Re).forEach(j=>{Re[j]&&Re[j].forEach(ae=>{ae.isNearly&&(g.setShapeSingleStyle({key:j,value:$!=0?C(j,ae,oe):ae.dragShift}),ae.lineNode&&(ae.lineNode.style[j]=`${ae.lineShift}px`),re.push(ae.line))})}),re.length&&u(re,H,O)}catch{console.warn("markLine disabled")}})},C=(H,O,k)=>{const{width:b,height:oe}=v.value.style;return H=="top"?Math.round(O.dragShift-(oe-k.height)/2):Math.round(O.dragShift-(b-k.width)/2)},u=(H,O,k)=>{k?H.includes("yr")?i.value.yr=!0:H.includes("yc")?i.value.yc=!0:H.includes("yl")&&(i.value.yl=!0):H.includes("yl")?i.value.yl=!0:H.includes("yc")?i.value.yc=!0:H.includes("yr")&&(i.value.yr=!0),O?H.includes("xb")?i.value.xb=!0:H.includes("xc")?i.value.xc=!0:H.includes("xt")&&(i.value.xt=!0):H.includes("xt")?i.value.xt=!0:H.includes("xc")?i.value.xc=!0:H.includes("xb")&&(i.value.xb=!0)},U=(H,O)=>Math.abs(H-O)<=r.value;return Bt(()=>{l=kn(),te.on("move",({isDownward:H,isRightward:O})=>{o(H,O)}),te.on("unMove",()=>{s()})}),(H,O)=>(c(),M("div",os,[(c(!0),M(st,null,$t(n.value,k=>ot((c(),M("div",{key:k,ref_for:!0,ref:k,class:rt(["line",k.includes("x")?"xLine":"yLine"])},null,2)),[[mt,i.value[k]||!1]])),128))]))}});const is=Ge(ls,[["__scopeId","data-v-66dae583"]]),ss=Ee({__name:"Area",props:{start:{type:Object,default(){return{x:null,y:null}}},width:{type:Number,default:0},height:{type:Number,default:0}},setup(a){const n=a,{start:r,width:i,height:g}=yt(n);return(v,d)=>{var l,s;return c(),M("div",{style:Oe({left:((l=e(r))==null?void 0:l.x)+"px",top:((s=e(r))==null?void 0:s.y)+"px",width:e(i)+"px",height:e(g)+"px"}),class:"area"},null,4)}}});const rs=Ge(ss,[["__scopeId","data-v-c34a0dac"]]),us=Ee({__name:"DragShadow",props:{baseWidth:{required:!0,type:Number},baseHeight:{required:!0,type:Number},curGap:{required:!0,type:Number},element:{required:!0,type:Object,default(){return{component:null,propValue:null,request:null,linkage:null,type:null,events:null,style:null,id:null}}}},setup(a){const n=a,{element:r,baseWidth:i,baseHeight:g,curGap:v}=yt(n),d=w(()=>{const{x:l,y:s,sizeX:o,sizeY:C}=r.value;return{padding:v.value+"px",width:o*i.value+"px",height:C*g.value+"px",left:(l-1)*i.value+"px",top:(s-1)*g.value-3+"px"}});return(l,s)=>(c(),M("div",{class:"shadow-main",style:Oe(d.value)},s[0]||(s[0]=[x("div",{class:"shadow-background"},null,-1)]),4))}});const cs=Ge(us,[["__scopeId","data-v-a6eacde1"]]),ds={class:"header-title"},vs={class:"export-button"},ps=["element-loading-text"],fs={style:{flex:"1"}},hs=Ee({__name:"UserViewEnlarge",setup(a,{expose:n}){const r=I(!1),i=ut(),g=I(!1),v=Ro(),d=qo();let l=I(null);const s=I(null),o=I(null),{t:C}=Ut(),u=I(null),U=I(null),H=I(null),{dvInfo:O,editMode:k,isIframe:b,canvasStyleData:oe}=lt(i),Y=I(!1),G=I(),ve=I("left"),le=I(!1),Q={render:"antv",type:"table-info",customAttr:{basicStyle:{tableColumnMode:"dialog",tablePageMode:"pull"},tableHeader:{tableHeaderBgColor:"#F8F8F9",tableHeaderFontColor:"#7C7E81"},tableCell:{tableItemBgColor:"#FFFFFF",tableFontColor:"#7C7E81",enableTableCrossBG:!1,mergeCells:!1},tooltip:{show:!1}},senior:{scrollCfg:{open:!1}},showPosition:"dialog"},K=Kt({scale:.5,componentSourceType:null,dataFrom:null}),ge={senior:{scrollCfg:{open:!1}},showPosition:"dialog"},ee=w(()=>Ln(O.value.weight,O.value.ext)),Se=w(()=>{const D=oe.value&&u.value==="enlarge"?Ta(oe.value,"canvas-main"):{};if(r.value){const q=ne.value.split(" * ");return D.width=q[0]+"px!important",D.height=q[1]+"px!important",D}else return D}),ne=I("1280 * 720"),Re=[{label:"Windows(16:9)",options:[{value:"1920 * 1080",label:"1920 * 1080"},{value:"1600 * 900",label:"1600 * 900"},{value:"1280 * 720",label:"1280 * 720"}]},{label:"MacOS(16:10)",options:[{value:"2560 * 1600",label:"2560 * 1600"},{value:"1920 * 1200",label:"1920 * 1200"},{value:"1680 * 1050",label:"1680 * 1050"}]}],re=(D,q,L,E,J={scale:.5})=>{var ie;K.scale=J.scale,G.value=q.type,le.value=!1,u.value=E,g.value=!0,K.componentSourceType=q.type,K.dataFrom=q.dataFrom,l.value=na(q),l.value.customStyle.text.show=!1,s.value=na(L),E==="details"&&((ie=l.value.type)!=null&&ie.includes("table")?bn(l.value,ge):(bn(l.value,Q),l.value.xAxis.forEach(ye=>ye.hide=!1),l.value.yAxis.forEach(ye=>ye.hide=!1)),$()),We(()=>{W()})},$=()=>{We(()=>{var q,L;const D=i.getViewDataDetails(l.value.id);D?G.value.includes("chart-mix")?((q=U.value)==null||q.renderChartFromDialog(l.value,D.left),(L=H.value)==null||L.renderChartFromDialog(l.value,D.right)):U.value.renderChartFromDialog(l.value,D):le.value=!0})},j=D=>{We(()=>{var L,E;const q=i.getViewDataDetails(l.value.id);D==="left"?(L=U.value)==null||L.renderChartFromDialog(l.value,q.left):D==="right"&&((E=H.value)==null||E.renderChartFromDialog(l.value,q.right))})},ae=()=>{y()},Ye=(D="view")=>{const q=i.getViewDataDetails(l.value.id),L=i.getViewDetails(l.value.id);if(!q){ga.error(C("chart.field_is_empty_export_error"));return}const E=i.getLastViewRequestInfo(l.value.id),J={...L,chartExtRequest:E,data:q,type:G.value,downloadType:D,busiFlag:O.value.type};Y.value=!0,Bn(J,()=>{$e(tt)}),Y.value=!1},qe=async()=>{var L,E,J,ie,ye,ze,we,Ke,pt,dt,vt,at,ct,Et,A,T,Ie,He,Me,R;console.log("最上面的 viewInfo.value: ",l.value);const D=i.getViewInstanceInfo(l.value.id);if(!D){console.error("未获取到S2实例，无法导出带格式Excel");return}const q=i.getViewDetails(l.value.id);if(l.value.type==="table-pivot")zn(D,q);else if(l.value.type==="table-info"){let X=function(pe){pe==null||pe.forEach(fe=>{!fe.children||fe.children.length===0?de.push(String(fe.key)):X(fe.children)})};const be=l.value,Pe=D.dataSet.getDisplayDataSet()||[],_e=await gn(be,100),Ce=((L=_e.data)==null?void 0:L.tableRow)||[],ue=((J=(E=be.customAttr)==null?void 0:E.basicStyle)==null?void 0:J.tablePageSize)||20,f=Ce.slice(ue),ce=[...Pe,...f];let se=null;D&&((ye=(ie=D.options)==null?void 0:ie.dataCfg)!=null&&ye.fields)&&(se=D.options.dataCfg.fields,console.log("S2 options.dataCfg.fields captured for field definitions (column order/names)."));const Ue=((ze=_e.data)==null?void 0:ze.fields)||((we=_e.data)==null?void 0:we.sourceFields)||[],Je=se?(se.values||se.columns||se.rows||[]).map(pe=>Ue.find(ft=>ft.dataeaseName===pe||ft.key===pe)||{key:pe,name:pe,dataeaseName:pe}):Ue,Be={..._e.data||{},tableRow:ce,fields:Je},Dt=(pt=(Ke=be.customAttr)==null?void 0:Ke.tableHeader)==null?void 0:pt.headerGroupConfig,Ze=Dt==null?void 0:Dt.columns;if(!Ze||Ze.length===0){console.log("No valid headerGroupConfig.columns found, treating as a plain table export."),ua(l,Be,be.title||"明细表");return}console.log("Valid headerGroupConfig.columns found, proceeding with multi-header export logic.");const de=[];if(X(Ze),de.length===0&&Ze.length>0&&(console.warn("collectLeafKeysRecursive did not populate leafKeys, attempting direct map from configColumns."),Ze.forEach(pe=>de.push(String(pe.key)))),de.length===0){console.error("Failed to derive leafKeys. Check table header configuration or data structure."),ua(l,Be,be.title||"明细表");return}let _t=[];const zt=be.customAttr,Gt=(dt=zt==null?void 0:zt.tableCell)==null?void 0:dt.mergeCells,Xt=be.xAxis||[];if(Gt&&Xt.length>0){const pe=new Set(Xt.filter(fe=>fe.groupType==="d").map(fe=>fe.dataeaseName));de.forEach(fe=>{pe.has(fe)&&_t.push(fe)}),_t.length===0&&de.length>0&&_t.push(de[0])}else if(de.length>0){let pe=function(nt){nt==null||nt.forEach(je=>{je.children&&je.children.length>0&&(fe.push(String(je.key)),pe(je.children))})};const fe=[];pe(Ze);let wt=[...new Set(fe)].length;wt===0&&de.length>0&&(wt=1),_t=de.slice(0,Math.min(wt,de.length))}const Ct=_t,Rt={};Ct.forEach(pe=>{const fe=de.indexOf(pe);fe!==-1&&(Rt[pe]=fe)});const xt={};if(D&&Ct.length>=2){const pe=Ct[0],fe=Ct[1],ft=D.dataSet.getDisplayDataSet();ft&&pe&&fe&&(console.log("S2 getDisplayDataSet():",ft.slice(0,5)),ft.forEach(wt=>{const nt=wt[pe],je=wt[fe];if(nt&&je!==void 0&&je!==null){xt[nt]||(xt[nt]=[]);const Ht=xt[nt];(Ht.length===0||Ht[Ht.length-1]!==je)&&(Ht.includes(je)||Ht.push(je))}}))}console.log("UserViewEnlarge.vue -> expectedDateOrderInShop:",xt),console.log("UserViewEnlarge.vue -> REVISED leafKeys: ",de),console.log("UserViewEnlarge.vue -> REVISED actualDataFieldKeysForGrouping: ",Ct),console.log("UserViewEnlarge.vue -> REVISED actualGroupKeyToLeafIndexMap: ",Rt),ua(l,Be,be.title||"明细表",de,Ct,Rt,xt)}else if(["table-normal","table-summary","table-total"].includes(l.value.type)){let X=function(pe){pe==null||pe.forEach(fe=>{!fe.children||fe.children.length===0?de.push(String(fe.key)):X(fe.children)})};console.log("[汇总表导出] 开始导出，viewInfo:",l.value);const be=l.value,Pe=D.dataSet.getDisplayDataSet()||[];console.log("[汇总表导出] S2首页顺序数据:",Pe.slice(0,5),"... 共",Pe.length,"条");const _e=await gn(be,100),Ce=((vt=_e.data)==null?void 0:vt.tableRow)||[];console.log("[汇总表导出] 全量API数据:",Ce.slice(0,5),"... 共",Ce.length,"条");const ue=((ct=(at=be.customAttr)==null?void 0:at.basicStyle)==null?void 0:ct.tablePageSize)||20,f=Ce.slice(ue),ce=[...Pe,...f];let se=null;D&&((A=(Et=D.options)==null?void 0:Et.dataCfg)!=null&&A.fields)&&(se=D.options.dataCfg.fields,console.log("[汇总表导出] S2 options.dataCfg.fields:",se));const Ue=((T=_e.data)==null?void 0:T.fields)||((Ie=_e.data)==null?void 0:Ie.sourceFields)||[],Je=se?(se.values||se.columns||se.rows||[]).map(pe=>Ue.find(ft=>ft.dataeaseName===pe||ft.key===pe)||{key:pe,name:pe,dataeaseName:pe}):Ue,Be={..._e.data||{},tableRow:ce,fields:Je},Dt=(Me=(He=be.customAttr)==null?void 0:He.tableHeader)==null?void 0:Me.headerGroupConfig,Ze=Dt==null?void 0:Dt.columns;if(!Ze||Ze.length===0){console.log("[汇总表导出] 未找到多级表头结构，按普通表导出"),ua(l,Be,be.title||"汇总表");return}console.log("[汇总表导出] 多级表头结构:",Ze);const de=[];if(X(Ze),de.length===0&&Ze.length>0&&(console.warn("[汇总表导出] collectLeafKeysRecursive未获取到叶子key，尝试直接取columns"),Ze.forEach(pe=>de.push(String(pe.key)))),de.length===0){console.error("[汇总表导出] 叶子key为空，无法导出"),ua(l,Be,be.title||"汇总表");return}let _t=[];const zt=be.customAttr,Gt=(R=zt==null?void 0:zt.tableCell)==null?void 0:R.mergeCells,Xt=be.xAxis||[];if(Gt&&Xt.length>0){const pe=new Set(Xt.filter(fe=>fe.groupType==="d").map(fe=>fe.dataeaseName));de.forEach(fe=>{pe.has(fe)&&_t.push(fe)}),_t.length===0&&de.length>0&&_t.push(de[0])}else if(de.length>0){let pe=function(nt){nt==null||nt.forEach(je=>{je.children&&je.children.length>0&&(fe.push(String(je.key)),pe(je.children))})};const fe=[];pe(Ze);let wt=[...new Set(fe)].length;wt===0&&de.length>0&&(wt=1),_t=de.slice(0,Math.min(wt,de.length))}const Ct=_t,Rt={};Ct.forEach(pe=>{const fe=de.indexOf(pe);fe!==-1&&(Rt[pe]=fe)});const xt={};if(D&&Ct.length>=2){const pe=Ct[0],fe=Ct[1],ft=D.dataSet.getDisplayDataSet();ft&&pe&&fe&&(console.log("[汇总表导出] S2 getDisplayDataSet():",ft.slice(0,5)),ft.forEach(wt=>{const nt=wt[pe],je=wt[fe];if(nt&&je!==void 0&&je!==null){xt[nt]||(xt[nt]=[]);const Ht=xt[nt];(Ht.length===0||Ht[Ht.length-1]!==je)&&(Ht.includes(je)||Ht.push(je))}}))}console.log("[汇总表导出] leafKeys:",de),console.log("[汇总表导出] actualDataFieldKeysForGrouping:",Ct),console.log("[汇总表导出] actualGroupKeyToLeafIndexMap:",Rt),console.log("[汇总表导出] expectedDateOrderInShop:",xt),ua(l,Be,be.title||"汇总表",de,Ct,Rt,xt)}},tt=()=>{ke().emitter.emit("data-export-center",{activeName:"IN_PROGRESS"})},$e=D=>{const q="el-icon-loading",L="de-message-loading de-message-export";ga({message:va("p",null,[C("data_fill.exporting"),va(Tt,{text:!0,size:"small",class:"btn-text",onClick:()=>{D()}},C("data_export.export_center")),C("data_fill.progress_to_download")]),iconClass:q,icon:va(On),showClose:!0,customClass:L})},Te=["bubble-map","flow-map","heat-map","map","symbolic-map"],y=()=>{var q;r.value=!Te.includes(l.value.type),ke().emitter.emit("renderChart-"+l.value.id),ke().emitter.emit("l7-prepare-picture",l.value.id);const D=(q=l.value.type)!=null&&q.includes("table")||el({type:l.value.type})?2e3:500;setTimeout(()=>{W(),cl(o.value).then(L=>{r.value=!1;const E=document.createElement("a");E.setAttribute("download",l.value.title),E.href=L,E.click(),ke().emitter.emit("l7-unprepare-picture",l.value.id),ke().emitter.emit("renderChart-"+l.value.id),W()}).catch(L=>{r.value=!1,W(),ke().emitter.emit("l7-unprepare-picture",l.value.id),ke().emitter.emit("renderChart-"+l.value.id),console.error("oops, something went wrong!",L)})},D)},W=()=>{_a("enlarge-inner-content","canvas-main",K.scale)};return n({dialogInit:re}),(D,q)=>{var dt;const L=Eo,E=Po,J=Bo,ie=Wt,ye=ea,ze=Dn,we=Hn,Ke=$a,pt=za("loading");return c(),B(Ke,{ref:"enlargeDialog",title:(dt=e(l))==null?void 0:dt.title,"append-to-body":!0,modelValue:g.value,"onUpdate:modelValue":q[4]||(q[4]=vt=>g.value=vt),width:"70vw",trigger:"click",class:"userViewEnlarge-class"},xo({default:_(()=>{var vt;return[g.value?ot((c(),M("div",{key:0,"element-loading-text":e(C)("visualization.export_loading"),"element-loading-background":"rgba(122, 122, 122, 1)",class:"enlarge-outer"},[ot((c(),M("div",{id:"enlarge-inner-content",class:rt(["enlarge-inner",{"enlarge-inner-with-header":u.value==="details"&&G.value.includes("chart-mix")}]),ref_key:"viewContainer",ref:o,style:Oe(Se.value)},[u.value==="enlarge"?(c(),B(Wa,{key:0,class:"enlarge-wrapper","opt-type":u.value,"view-info":e(l),config:s.value,"dv-info":e(O),"font-family":(vt=e(oe))==null?void 0:vt.fontFamily,"show-position":"viewDialog"},null,8,["opt-type","view-info","config","dv-info","font-family"])):F("",!0),u.value==="details"&&!G.value.includes("chart-mix")?(c(),M(st,{key:1},[le.value?F("",!0):(c(),B(Qa,{key:0,view:e(l),"show-position":"viewDialog",ref_key:"chartComponentDetails",ref:U},null,8,["view"])),le.value?(c(),B(Gn,{key:1,description:e(C)("visualization.no_details"),"img-type":"noneWhite"},null,8,["description"])):F("",!0)],64)):u.value==="details"&&G.value.includes("chart-mix")?(c(),M(st,{key:2},[m(we,{class:"tab-header",modelValue:ve.value,"onUpdate:modelValue":q[3]||(q[3]=at=>ve.value=at),onTabChange:j},{default:_(()=>[m(ze,{label:e(C)("chart.drag_block_value_axis_left"),name:"left"},null,8,["label"]),m(ze,{label:e(C)("chart.drag_block_value_axis_right"),name:"right"},null,8,["label"])]),_:1},8,["modelValue"]),x("div",fs,[ve.value==="left"?(c(),B(Qa,{key:0,view:e(l),"show-position":"viewDialog",ref_key:"chartComponentDetails",ref:U},null,8,["view"])):ve.value==="right"?(c(),B(Qa,{key:1,view:e(l),"show-position":"viewDialog",ref_key:"chartComponentDetails2",ref:H},null,8,["view"])):F("",!0)])],64)):F("",!0)],6)),[[pt,e(v).loadingMap[e(d).currentPath]]])],8,ps)),[[pt,r.value]]):F("",!0)]}),_:2},[e(b)?void 0:{name:"header",fn:_(()=>{var vt;return[x("div",ds,[x("div",null,N((vt=e(l))==null?void 0:vt.title),1),x("div",vs,[u.value==="enlarge"&&ee.value[0]?(c(),B(J,{key:0,modelValue:ne.value,"onUpdate:modelValue":q[0]||(q[0]=at=>ne.value=at),class:"pixel-select",size:"small"},{default:_(()=>[(c(),M(st,null,$t(Re,at=>m(E,{key:at.label,label:at.label},{default:_(()=>[(c(!0),M(st,null,$t(at.options,ct=>(c(),B(L,{key:ct.value,label:ct.label,value:ct.value},null,8,["label","value"]))),128))]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])):F("",!0),u.value==="enlarge"&&ee.value[0]?(c(),B(e(Tt),{key:1,class:"m-button",link:"",size:"middle",onClick:ae},{default:_(()=>[m(ie,{color:"#1F2329",size:"16",style:{"margin-right":"3px"}},{default:_(()=>[m(e(da))]),_:1}),Ae(" "+N(e(C)("chart.export_img")),1)]),_:1})):F("",!0),u.value==="details"&&ee.value[1]?(c(),B(e(Tt),{key:2,class:"m-button",link:"",size:"middle",loading:Y.value,disabled:e(v).loadingMap[e(d).currentPath]>0||K.dataFrom==="template",onClick:q[1]||(q[1]=at=>Ye("view"))},{default:_(()=>[m(ie,{color:"#1F2329",size:"16",style:{"margin-right":"3px"}},{default:_(()=>[m(e(da))]),_:1}),Ae(" "+N(e(C)("chart.export_excel")),1)]),_:1},8,["loading","disabled"])):F("",!0),u.value==="details"&&ee.value[2]?(c(),B(e(Tt),{key:3,class:"m-button",link:"",size:"middle",loading:Y.value,onClick:q[2]||(q[2]=at=>Ye("dataset")),disabled:e(v).loadingMap[e(d).currentPath]>0||K.dataFrom==="template"},{default:_(()=>[m(ie,{color:"#1F2329",size:"16",style:{"margin-right":"3px"}},{default:_(()=>[m(e(da))]),_:1}),Ae(" "+N(e(C)("chart.export_raw_details")),1)]),_:1},8,["loading","disabled"])):F("",!0),u.value==="details"&&(e(l).type==="table-pivot"||e(l).type==="table-info"||e(l).type==="table-normal")?(c(),B(e(Tt),{key:4,class:"m-button",link:"",size:"middle",loading:Y.value,onClick:qe},{default:_(()=>[m(ie,{color:"#1F2329",size:"16",style:{"margin-right":"3px"}},{default:_(()=>[m(e(da))]),_:1}),Ae(" "+N(e(C)("chart.export_excel_formatter")),1)]),_:1},8,["loading"])):F("",!0),ee.value[0]||ee.value[1]||ee.value[2]?(c(),B(ye,{key:5,class:"close-divider",direction:"vertical"})):F("",!0)])])]}),key:"0"}]),1032,["title","modelValue"])}}});const cn=Ge(hs,[["__scopeId","data-v-86f5c195"]]),ms=Ee({__name:"CanvasOptBar",props:{canvasStyleData:{type:Object,required:!0},componentData:{type:Object,required:!0},canvasId:{type:String,required:!1,default:"canvas-main"}},setup(a){const n=ut(),r=a,i=l=>{l.preventDefault(),l.stopPropagation()},g=()=>{n.clearPanelLinkageInfo(),ke().emitter.emit("clearPanelLinkage",{viewId:"all"})},v=w(()=>n.dvInfo.type==="dataV"&&n.editMode==="preview"&&!fa()),d=w(()=>{if(De(r.canvasId)){let l=0;return r.componentData.forEach(s=>{s.component==="UserView"?s.linkageFilters&&s.linkageFilters.length>0&&l++:s.component==="Group"?s.propValue.forEach(o=>{o.linkageFilters&&o.linkageFilters.length>0&&l++}):s.component==="DeTabs"&&s.propValue.forEach(o=>{o.componentData.forEach(C=>{C.linkageFilters&&C.linkageFilters.length>0&&l++})})}),l}else return!1});return(l,s)=>{const o=At,C=Wt,u=Tt;return d.value&&(!e(n).mobileInPc||e(fa)())?(c(),M("div",{key:0,class:rt(["bar-main-right",{"bar-main-edit-right":v.value}]),onMousedown:i},[m(u,{size:"mini",type:"warning",onClick:g},{default:_(()=>[m(C,{class:"bar-base-icon"},{default:_(()=>[m(o,{name:"dv-bar-unLinkage"},{default:_(()=>[m(e(Wn),{class:"svg-icon"})]),_:1})]),_:1}),Ae(N(l.$t("visualization.remove_all_linkage")),1)]),_:1})],34)):F("",!0)}}});const dn=Ge(ms,[["__scopeId","data-v-9f562be0"]]),gs={class:"point-shadow-content"},ys=Ee({__name:"PointShadow",props:{canvasId:{type:String,required:!0}},setup(a){const n=ut(),{mousePointShadowMap:r,canvasStyleData:i}=lt(n),g=w(()=>({fontSize:16*i.value.scale/100+"px",width:r.value.width+"px",height:r.value.height+"px"})),v=w(()=>({left:r.value.mouseX-r.value.width/2+"px",top:r.value.mouseY-r.value.height/2-60+"px",width:r.value.width+"px",height:r.value.height+"px"}));return(d,l)=>(c(),M("div",{class:"point-shadow",id:"point-shadow-main",style:Oe(v.value)},[x("div",gs,[l[1]||(l[1]=x("div",{id:"point-shadow-component",class:"point-shadow-component"},null,-1)),x("div",{class:"point-shadow-tips",style:Oe(g.value)},l[0]||(l[0]=[x("div",{style:{width:"100%","text-align":"center"}},"组件将被移出Tab",-1)]),4)])],4))}});const _s=Ge(ys,[["__scopeId","data-v-10509a23"]]),Cs={width:"136",height:"96",viewBox:"0 0 136 96",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ws(a,n){return c(),M("svg",Cs,n[0]||(n[0]=[So('<g filter="url(#filter0_d_4811_19625)"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.3 9H125.7C126.97 9 128 9.77277 128 10.726V82.274C128 83.2272 126.97 84 125.7 84H15.3C14.0297 84 13 83.2272 13 82.274V10.726C13 9.77277 14.0297 9 15.3 9Z" fill="white" fill-opacity="0.8" shape-rendering="crispEdges"></path></g><g filter="url(#filter1_d_4811_19625)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.3 4H120.7C121.97 4 123 4.77277 123 5.72603V77.274C123 78.2272 121.97 79 120.7 79H10.3C9.02974 79 8 78.2272 8 77.274V5.72603C8 4.77277 9.02974 4 10.3 4Z" fill="white"></path></g><rect x="97" y="20" width="22" height="55" rx="1" fill="#F5F6F7"></rect><path fill-rule="evenodd" clip-rule="evenodd" d="M12 72.9821V74C12 74.5523 12.4477 75 13 75H14.0125V74H13L13 72.9821H12ZM12 70.9464H13V68.9107H12V70.9464ZM12 66.875H13V64.8393H12V66.875ZM12 62.8036H13V60.7679H12V62.8036ZM12 58.7321H13V56.6964H12V58.7321ZM12 54.6607H13V52.625H12V54.6607ZM12 50.5893H13V48.5536H12V50.5893ZM12 46.5179H13V44.4821H12V46.5179ZM12 42.4464H13V40.4107H12V42.4464ZM12 38.375H13V36.3393H12V38.375ZM12 34.3036H13V32.2679H12V34.3036ZM12 30.2321H13V28.1964H12V30.2321ZM12 26.0893H13V24.0536H12V26.0893ZM12 22.0179H13V21L14.0125 21V20H13C12.4477 20 12 20.4477 12 21V22.0179ZM16.0375 20V21H18.0625V20H16.0375ZM20.0875 20V21H22.1125V20H20.0875ZM24.1375 20V21H26.1625V20H24.1375ZM28.1875 20V21H30.2125V20H28.1875ZM32.2375 20V21H34.2625V20H32.2375ZM36.2875 20V21H38.3125V20H36.2875ZM40.3375 20V21H42.3625V20H40.3375ZM44.3875 20V21H46.4125V20H44.3875ZM48.4375 20V21H50.4625V20H48.4375ZM52.4875 20V21H54.5125V20H52.4875ZM56.5375 20V21H58.5625V20H56.5375ZM60.5875 20V21H62.6125V20H60.5875ZM64.6375 20V21H66.6625V20H64.6375ZM68.6875 20V21H70.7125V20H68.6875ZM72.7375 20V21H74.7625V20H72.7375ZM76.7875 20V21H78.8125V20H76.7875ZM80.8375 20V21H82.8625V20H80.8375ZM84.8875 20V21H86.9125V20H84.8875ZM88.9375 20V21H90.9625V20H88.9375ZM92.9875 20V21H94V22.0179H95V21C95 20.4477 94.5523 20 94 20H92.9875ZM95 24.0536H94V26.0893H95V24.0536ZM95 28.1964H94V30.2321H95V28.1964ZM95 32.2679H94V34.3036H95V32.2679ZM95 36.3393H94V38.375H95V36.3393ZM95 40.4107H94V42.4464H95V40.4107ZM95 44.4821H94V46.5179H95V44.4821ZM95 48.5536H94V50.5893H95V48.5536ZM95 52.625H94V54.6607H95V52.625ZM95 56.6964H94V58.7321H95V56.6964ZM95 60.7679H94V62.8036H95V60.7679ZM95 64.8393H94V66.875H95V64.8393ZM95 68.9107H94V70.9464H95V68.9107ZM95 72.9821H94V74H92.9875V75H94C94.5523 75 95 74.5523 95 74V72.9821ZM90.9625 75V74H88.9375V75H90.9625ZM86.9125 75V74H84.8875V75H86.9125ZM82.8625 75V74H80.8375V75H82.8625ZM78.8125 75V74H76.7875V75H78.8125ZM74.7625 75V74H72.7375V75H74.7625ZM70.7125 75V74H68.6875V75H70.7125ZM66.6625 75V74H64.6375V75H66.6625ZM62.6125 75V74H60.5875V75H62.6125ZM58.5625 75V74H56.5375V75H58.5625ZM54.5125 75V74H52.4875V75H54.5125ZM50.4625 75V74H48.4375V75H50.4625ZM46.4125 75V74H44.3875V75H46.4125ZM42.3625 75V74H40.3375V75H42.3625ZM38.3125 75V74H36.2875V75H38.3125ZM34.2625 75V74H32.2375V75H34.2625ZM30.2125 75V74H28.1875V75H30.2125ZM26.1625 75V74H24.1375V75H26.1625ZM22.1125 75V74H20.0875V75H22.1125ZM18.0625 75V74H16.0375V75H18.0625Z" fill="#DEE0E3"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M31.3027 13.5121L30.4999 14.3149L29.697 13.5121C29.6522 13.4673 29.5797 13.4673 29.535 13.5121L29.4613 13.5857C29.4165 13.6305 29.4165 13.703 29.4613 13.7478L30.382 14.6685C30.4471 14.7336 30.5526 14.7336 30.6177 14.6685L31.5384 13.7478C31.5832 13.703 31.5832 13.6305 31.5384 13.5857L31.4648 13.5121C31.42 13.4673 31.3475 13.4673 31.3027 13.5121Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9 4H122C122.552 4 123 4.97005 123 6.16667V17C122.5 17 122.552 17 122 17H9C8.44772 17 8 17 8 17V6.16667C8 4.97005 8.44772 4 9 4Z" fill="#050E21"></path><g filter="url(#filter2_d_4811_19625)"><rect x="43" y="17" width="44" height="50" fill="white"></rect></g><rect x="45" y="19" width="18.7234" height="13.6296" rx="0.5" fill="#F5F6F7"></rect><path d="M51.0836 27.3737C51.0836 27.6253 50.8797 27.8293 50.628 27.8293C50.3764 27.8293 50.1724 27.6253 50.1724 27.3737V23.8396H49.5044C49.2496 23.8396 49.043 23.633 49.043 23.3781V23.3584C49.043 23.1076 49.2548 22.9142 49.4986 22.8553C49.6483 22.8143 49.7809 22.7469 49.8965 22.6532C50.0162 22.5536 50.1168 22.4247 50.1981 22.2665C50.2368 22.1911 50.2693 22.107 50.2954 22.0143C50.3482 21.8265 50.5062 21.6777 50.7013 21.6777C50.9125 21.6777 51.0836 21.8489 51.0836 22.0601V27.3737Z" fill="#3370FF"></path><path d="M52.7996 24.0417C52.5598 24.0417 52.3608 23.85 52.3782 23.6109C52.3921 23.4205 52.4188 23.239 52.4583 23.0662C52.5268 22.7616 52.6295 22.4979 52.7664 22.2753C52.9033 22.0468 53.0744 21.8711 53.2797 21.748C53.4894 21.6191 53.729 21.5547 53.9985 21.5547C54.2038 21.5547 54.3985 21.5986 54.5824 21.6865C54.7707 21.7744 54.9354 21.9003 55.0766 22.0644C55.2177 22.2284 55.329 22.4306 55.4103 22.6708C55.4958 22.911 55.5386 23.1805 55.5386 23.4793C55.5386 23.7898 55.5022 24.0563 55.4295 24.279C55.3568 24.5016 55.2605 24.7008 55.1407 24.8766C55.021 25.0465 54.8841 25.2017 54.73 25.3423C54.5803 25.4829 54.4284 25.6235 54.2744 25.7641C54.1204 25.8989 53.9707 26.0454 53.8252 26.2035C53.6798 26.3617 53.5514 26.5463 53.4402 26.7572H55.0643C55.3404 26.7572 55.5643 26.9811 55.5643 27.2572V27.3293C55.5643 27.6055 55.3404 27.8293 55.0643 27.8293H52.2658C52.2658 27.472 52.3022 27.1614 52.3749 26.8978C52.4519 26.6342 52.5546 26.3998 52.6829 26.1948C52.8113 25.9838 52.961 25.7905 53.1321 25.6148C53.3076 25.439 53.4915 25.2603 53.684 25.0787C53.7824 24.9849 53.8872 24.8912 53.9985 24.7975C54.1097 24.6979 54.2102 24.5895 54.3001 24.4723C54.3942 24.3551 54.4712 24.2233 54.5311 24.0768C54.5953 23.9304 54.6274 23.7634 54.6274 23.5759C54.6274 23.2771 54.5632 23.0457 54.4348 22.8817C54.3108 22.7118 54.1503 22.6268 53.9536 22.6268C53.8209 22.6268 53.7076 22.6708 53.6134 22.7586C53.5236 22.8407 53.4509 22.952 53.3953 23.0926C53.3396 23.2273 53.299 23.3797 53.2733 23.5496C53.2711 23.5667 53.269 23.5839 53.267 23.601C53.2387 23.8433 53.0435 24.0417 52.7996 24.0417Z" fill="#3370FF"></path><path d="M57.6919 24.4798C57.6919 24.3122 57.8396 24.1823 58.0064 24.1647C58.1176 24.153 58.2203 24.1208 58.3144 24.0681C58.4128 24.0095 58.4919 23.9275 58.5518 23.822C58.616 23.7165 58.6481 23.5759 58.6481 23.4002C58.6481 23.1365 58.5839 22.9344 58.4556 22.7938C58.3272 22.6532 58.1796 22.5829 58.0128 22.5829C57.7818 22.5829 57.6064 22.6883 57.4866 22.8993C57.4281 23.0031 57.3849 23.1212 57.3572 23.2536C57.3086 23.4853 57.1262 23.6814 56.8895 23.6814C56.6506 23.6814 56.4555 23.4836 56.4878 23.2469C56.5083 23.0967 56.5374 22.9544 56.5753 22.8202C56.6523 22.5565 56.7571 22.331 56.8898 22.1435C57.0267 21.956 57.1892 21.8125 57.3775 21.7129C57.5657 21.6074 57.7753 21.5547 58.0064 21.5547C58.1861 21.5547 58.3657 21.5928 58.5454 21.6689C58.7251 21.7392 58.8855 21.8476 59.0267 21.9941C59.1722 22.1406 59.2898 22.3192 59.3797 22.5302C59.4695 22.7411 59.5144 22.9842 59.5144 23.2596C59.5144 23.5584 59.4609 23.822 59.354 24.0505C59.2513 24.279 59.0952 24.4342 58.8855 24.5162V24.5338C59.1337 24.61 59.3283 24.774 59.4695 25.026C59.6107 25.2779 59.6813 25.5796 59.6813 25.9311C59.6813 26.2533 59.6342 26.5404 59.5401 26.7923C59.4502 27.0443 59.3283 27.2552 59.1743 27.4251C59.0203 27.595 58.8427 27.7239 58.6417 27.8118C58.4406 27.8996 58.231 27.9436 58.0128 27.9436C57.7604 27.9436 57.5294 27.8938 57.3197 27.7942C57.1144 27.6946 56.939 27.551 56.7935 27.3636C56.6481 27.1702 56.5347 26.9359 56.4534 26.6605C56.4093 26.5028 56.3785 26.3317 56.3611 26.1471C56.3383 25.9065 56.5388 25.7114 56.7805 25.7114C57.0199 25.7114 57.2107 25.9038 57.2582 26.1383C57.2614 26.1543 57.2648 26.1702 57.2684 26.186C57.3026 26.3324 57.3518 26.4613 57.416 26.5726C57.4802 26.6781 57.5593 26.7631 57.6534 26.8275C57.7518 26.8919 57.8673 26.9242 58 26.9242C58.2053 26.9242 58.3786 26.8392 58.5197 26.6693C58.6609 26.4936 58.7315 26.2563 58.7315 25.9575C58.7315 25.7231 58.6973 25.5444 58.6288 25.4214C58.5647 25.2984 58.4812 25.2105 58.3786 25.1578C58.2759 25.0992 58.1625 25.067 58.0385 25.0611C57.8477 25.0424 57.6919 24.8881 57.6919 24.6964V24.4798Z" fill="#3370FF"></path><path d="M59.1813 29.0078H49.543C49.2668 29.0078 49.043 29.2317 49.043 29.5078V29.7057C49.043 29.9819 49.2668 30.2057 49.543 30.2057H59.1813C59.4574 30.2057 59.6813 29.9819 59.6813 29.7057V29.5078C59.6813 29.2317 59.4574 29.0078 59.1813 29.0078Z" fill="#00D6B9"></path><rect x="66.2773" y="19" width="18.7234" height="13.6296" rx="0.5" fill="#F5F6F7"></rect><path d="M75.4301 24.6753C75.5122 24.4583 75.8143 24.465 75.8866 24.6855C76.1381 25.4531 76.5204 26.6799 76.5115 27.0164C76.4981 27.517 76.0819 27.9119 75.5818 27.8985C75.0817 27.8851 74.6871 27.4685 74.7005 26.968C74.7095 26.6317 75.1451 25.4287 75.4301 24.6753Z" fill="#00D6B9"></path><path d="M71.3832 26.453C71.3832 24.1007 73.2883 22.1937 75.6385 22.1937C77.9886 22.1937 79.8938 24.1007 79.8938 26.453C79.8938 27.6187 79.4265 28.6746 78.6678 29.4442C78.5646 29.5489 78.5546 29.7166 78.6526 29.8262L79.0073 30.2229C79.1053 30.3324 79.274 30.3422 79.3784 30.2389C80.3528 29.2743 80.9576 27.934 80.9576 26.453C80.9576 23.5126 78.5762 21.1289 75.6385 21.1289C72.7008 21.1289 70.3193 23.5126 70.3193 26.453C70.3193 27.9213 70.9138 29.2513 71.8735 30.2139C71.9773 30.318 72.146 30.3093 72.2447 30.2004L72.602 29.806C72.7007 29.6971 72.6918 29.5293 72.5894 29.424C71.8424 28.6562 71.3832 27.6086 71.3832 26.453Z" fill="#3370FF"></path><rect x="45" y="35.1855" width="18.7234" height="13.6296" rx="0.5" fill="#F5F6F7"></rect><path d="M48.6172 37.957C48.6172 37.6809 48.841 37.457 49.1172 37.457H59.4647C59.7408 37.457 59.9647 37.6809 59.9647 37.957V39.7286H48.6172V37.957Z" fill="#3370FF"></path><path d="M52.0214 40.2969H48.6172V42.0006H52.0214V40.2969Z" fill="#ADC6FF"></path><path d="M55.9931 40.2969H52.5888V42.0006H55.9931V40.2969Z" fill="#ADC6FF"></path><path d="M59.9647 40.2969H56.5604V42.0006H59.9647V40.2969Z" fill="#ADC6FF"></path><path d="M52.0214 44.8401H48.6172V46.2598C48.6172 46.4167 48.7442 46.5438 48.9009 46.5438H52.0214V44.8401Z" fill="#ADC6FF"></path><path d="M55.9931 44.8401H52.5888V46.5438H55.9931V44.8401Z" fill="#ADC6FF"></path><path d="M59.9647 44.8401H56.5604V46.5438H59.681C59.8377 46.5438 59.9647 46.4167 59.9647 46.2598V44.8401Z" fill="#ADC6FF"></path><path d="M52.0214 42.5685H48.6172V44.2722H52.0214V42.5685Z" fill="#ADC6FF"></path><path d="M55.9931 42.5685H52.5888V44.2722H55.9931V42.5685Z" fill="#ADC6FF"></path><path d="M59.9647 42.5685H56.5604V44.2722H59.9647V42.5685Z" fill="#ADC6FF"></path><path d="M66.2773 36.007C66.2773 35.5533 66.6504 35.1855 67.1107 35.1855H84.1674C84.6277 35.1855 85.0007 35.5533 85.0007 36.007V47.9937C85.0007 48.4474 84.6277 48.8152 84.1674 48.8152H67.1107C66.6504 48.8152 66.2773 48.4474 66.2773 47.9937V36.007Z" fill="#F5F6F7"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M84.1674 35.5141H67.1107C66.8345 35.5141 66.6107 35.7348 66.6107 36.007V47.9937C66.6107 48.2659 66.8345 48.4866 67.1107 48.4866H84.1674C84.4436 48.4866 84.6674 48.2659 84.6674 47.9937V36.007C84.6674 35.7348 84.4436 35.5141 84.1674 35.5141ZM67.1107 35.1855C66.6504 35.1855 66.2773 35.5533 66.2773 36.007V47.9937C66.2773 48.4474 66.6504 48.8152 67.1107 48.8152H84.1674C84.6277 48.8152 85.0007 48.4474 85.0007 47.9937V36.007C85.0007 35.5533 84.6277 35.1855 84.1674 35.1855H67.1107Z" fill="#3370FF"></path><path d="M70.1772 37.457C70.0206 37.457 69.8936 37.5842 69.8936 37.741V39.7286H81.2411V37.741C81.2411 37.5842 81.1141 37.457 80.9574 37.457H70.1772Z" fill="#3370FF"></path><path d="M69.8936 40.2965H72.1631V46.5435H70.1772C70.0206 46.5435 69.8936 46.4163 69.8936 46.2595V40.2965Z" fill="#3370FF"></path><path d="M81.2411 40.2969H72.7305V42.0006H81.2411V40.2969Z" fill="#ADC6FF"></path><path d="M81.2411 44.8401H72.7305V46.5438H80.9574C81.1141 46.5438 81.2411 46.4167 81.2411 46.2598V44.8401Z" fill="#ADC6FF"></path><path d="M81.2411 42.5685H72.7305V44.2722H81.2411V42.5685Z" fill="#ADC6FF"></path><rect x="45" y="51.3711" width="18.7234" height="13.6296" rx="0.5" fill="#F5F6F7"></rect><g clip-path="url(#clip0_4811_19625)"><path d="M53.8698 55.0398C53.7832 54.9532 53.6416 54.9573 53.5603 55.0489L53.2654 55.3809C53.1252 55.5387 52.9247 55.7643 52.6831 56.0361C52.2 56.5795 51.5529 57.3071 50.897 58.0434C49.5784 59.5238 48.2414 61.0202 48.1081 61.1536C47.9835 61.2784 47.9835 61.4806 48.1081 61.6054C48.2328 61.7301 48.4348 61.7301 48.5595 61.6054C48.7099 61.4548 50.068 59.9342 51.3734 58.4686C52.0296 57.732 52.6768 57.0043 53.16 56.4608C53.3988 56.1921 53.5975 55.9685 53.7375 55.8109L56.4011 58.477C56.4715 58.5475 56.5812 58.5597 56.6653 58.5064L61.3517 55.5377L61.3537 55.5362C61.4981 55.4351 61.5332 55.2359 61.4321 55.0914C61.3316 54.9476 61.1342 54.9121 60.99 55.0112L56.6002 57.7728L53.8698 55.0398Z" fill="#3370FF"></path><path d="M48.3338 57.8652C48.1575 57.8652 48.0146 58.0083 48.0146 58.1847C48.0146 58.3611 48.1575 58.5041 48.3338 58.5041H53.0087L54.9251 60.7648C54.9604 60.8064 55.0103 60.8329 55.0646 60.8387L61.0612 61.4833C61.2357 61.5046 61.3946 61.3805 61.4164 61.2058C61.4383 61.0307 61.3142 60.871 61.1393 60.8492L55.3045 60.2249L53.368 57.9404C53.3276 57.8927 53.2682 57.8652 53.2057 57.8652H48.3338Z" fill="#00D6B9"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M47.3404 52.6484V63.0831L62.0213 63.0831L62.0213 63.722H46.7021V52.6484H47.3404Z" fill="#DEE0E3"></path></g><rect x="66.2773" y="51.3711" width="18.7234" height="13.6296" rx="0.5" fill="#F5F6F7"></rect><g clip-path="url(#clip1_4811_19625)"><path d="M75.6521 56.2206L73.7532 57.4359C73.7053 57.4705 73.6362 57.4705 73.5817 57.4425L71.1894 56.1594C71.1282 56.1248 71.0458 56.1315 70.9979 56.1794C70.9979 56.1794 69.2559 57.9563 69.2559 57.9976V62.6588H82.6601V55.2051L75.6947 56.2007L75.6521 56.2206Z" fill="#ADC6FF"></path><path d="M82.829 55.2142C82.8043 55.0395 82.6428 54.9179 82.4682 54.9426L75.6027 55.9151L75.4979 55.9643L73.6552 57.1435L71.3425 55.9031C71.1759 55.811 70.935 55.8147 70.7723 55.9775L70.7718 55.9781L70.4978 56.2563C70.3337 56.4229 70.1145 56.6456 69.8938 56.8698C69.7988 56.9664 69.7033 57.0625 69.6079 57.1587C69.4466 57.3212 69.2853 57.4837 69.126 57.6481C69.0028 57.7752 69.0087 57.9783 69.1373 58.0999C69.265 58.2205 69.4659 58.2159 69.5888 58.0905C69.6332 58.0454 69.6775 58.0002 69.7219 57.9551L69.736 57.9407C69.9058 57.768 70.1279 57.5424 70.3485 57.3182C70.5692 57.094 70.7884 56.8714 70.9524 56.7048L71.1368 56.5176L73.4328 57.7491L73.4363 57.7509C73.5721 57.8205 73.7681 57.837 73.9307 57.7255L75.7937 56.5333L82.5577 55.5752C82.7322 55.5505 82.8537 55.3889 82.829 55.2142Z" fill="#3370FF"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M68.6168 52.6484V63.0831L83.2977 63.0831L83.2977 63.722H67.9785V52.6484H68.6168Z" fill="#DEE0E3"></path></g><rect x="43" y="5" width="11" height="11" rx="1" fill="white" fill-opacity="0.15"></rect><g clip-path="url(#clip2_4811_19625)"><path d="M48.374 14.123C50.1378 14.123 51.5968 12.8184 51.8388 11.1216C51.8778 10.8482 51.6502 10.623 51.374 10.623C50.374 10.623 49.374 10.623 48.374 10.623C48.374 9.46271 48.374 8.46265 48.374 7.62288C48.374 7.34673 48.1489 7.1193 47.8755 7.15828C46.1786 7.40026 44.874 8.8593 44.874 10.623C44.874 12.556 46.441 14.123 48.374 14.123Z" fill="#3370FF"></path><path d="M49.4592 9.87377C49.2741 9.87377 49.124 9.72371 49.124 9.53859V7.12221C49.124 6.98916 49.2392 6.88454 49.3703 6.90746C50.7554 7.14971 51.8481 8.24239 52.0903 9.62754C52.1132 9.7586 52.0086 9.87377 51.8756 9.87377H49.4592Z" fill="#00D6B9"></path></g><g filter="url(#filter3_d_4811_19625)"><path fill-rule="evenodd" clip-rule="evenodd" d="M90.0006 47.3536L94.1487 45.8794L83 39.75L86.2502 52.0504L88.6842 48.3821L91.5982 52.112L92.9147 51.0835L90.0006 47.3536Z" fill="#363B3E"></path></g><g filter="url(#filter4_d_4811_19625)"><path fill-rule="evenodd" clip-rule="evenodd" d="M96.5823 46.0764L91.6432 47.8317L94.3187 51.2563L91.4263 53.5161L88.7508 50.0915L85.8527 54.4592L81.4375 37.75L96.5823 46.0764ZM88.6846 48.3826L91.5987 52.1124L92.9151 51.0839L90.001 47.3541L94.1491 45.8798L83.0004 39.7504L86.2506 52.0508L88.6846 48.3826Z" fill="white" fill-opacity="0.8"></path></g><defs><filter id="filter0_d_4811_19625" x="5" y="5" width="131" height="91" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dy="4"></feOffset><feGaussianBlur stdDeviation="4"></feGaussianBlur><feComposite in2="hardAlpha" operator="out"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0.121569 0 0 0 0 0.137255 0 0 0 0 0.160784 0 0 0 0.1 0"></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_4811_19625"></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_4811_19625" result="shape"></feBlend></filter><filter id="filter1_d_4811_19625" x="0" y="0" width="131" height="91" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dy="4"></feOffset><feGaussianBlur stdDeviation="4"></feGaussianBlur><feComposite in2="hardAlpha" operator="out"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0.121569 0 0 0 0 0.137255 0 0 0 0 0.160784 0 0 0 0.1 0"></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_4811_19625"></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_4811_19625" result="shape"></feBlend></filter><filter id="filter2_d_4811_19625" x="35" y="13" width="60" height="66" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dy="4"></feOffset><feGaussianBlur stdDeviation="4"></feGaussianBlur><feComposite in2="hardAlpha" operator="out"></feComposite><feColorMatrix type="matrix" values="0 0 0 0 0.121569 0 0 0 0 0.137255 0 0 0 0 0.160784 0 0 0 0.1 0"></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_4811_19625"></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_4811_19625" result="shape"></feBlend></filter><filter id="filter3_d_4811_19625" x="80" y="37.75" width="17.1484" height="18.3613" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dy="1"></feOffset><feGaussianBlur stdDeviation="1.5"></feGaussianBlur><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_4811_19625"></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_4811_19625" result="shape"></feBlend></filter><filter id="filter4_d_4811_19625" x="78.4375" y="35.75" width="21.1445" height="22.709" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix><feOffset dy="1"></feOffset><feGaussianBlur stdDeviation="1.5"></feGaussianBlur><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"></feColorMatrix><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_4811_19625"></feBlend><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_4811_19625" result="shape"></feBlend></filter><clipPath id="clip0_4811_19625"><rect width="17.0213" height="11.9259" fill="white" transform="translate(45.8516 52.2227)"></rect></clipPath><clipPath id="clip1_4811_19625"><rect width="17.0213" height="11.9259" fill="white" transform="translate(67.1279 52.2227)"></rect></clipPath><clipPath id="clip2_4811_19625"><rect width="9" height="9" fill="white" transform="translate(44 6)"></rect></clipPath></defs>',42)]))}const bs={render:ws},xs={class:"drag-info-main"},Ss={key:1,class:"mobile-in-pc-tips"},ks=Ee({__name:"DragInfo",setup(a){const{t:n}=Ut(),r=ut(),{dvInfo:i,mobileInPc:g}=lt(r),v=n("visualization.resource_create_tips")+(i.value.type==="dashboard"?n("work_branch.dashboard"):n("work_branch.big_data_screen"));return(d,l)=>{const s=At,o=Fn;return c(),M("div",xs,[e(g)?(c(),M("div",Ss,"请从右侧添加可视化组件")):(c(),M(st,{key:0},[m(o,{style:{"justify-content":"center"}},{default:_(()=>[m(s,{name:"dv-drag-tips"},{default:_(()=>[m(e(bs),{class:"svg-icon",style:{width:"125px",height:"125px"}})]),_:1})]),_:1}),m(o,{class:"tips-info"},{default:_(()=>[Ae(N(v))]),_:1})],64))])}}});const Is=Ge(ks,[["__scopeId","data-v-36f38edf"]]),Ms={style:{width:"100%",height:"100%"}},Vs={key:0,class:"pop-content"},Ds=Ee({__name:"Component",props:{dvInfo:{type:Object,required:!0},canvasStyleData:{type:Object,required:!0},popComponentData:{type:Array,required:!0},canvasViewInfo:{type:Object,required:!0},canvasId:{type:String,required:!1,default:"canvas-main"},scale:{type:Number,required:!1,default:1},showPosition:{type:String,required:!1,default:"preview"},canvasState:{type:Object,required:!0}},setup(a){const n=ut(),r=oa(),i=I(!1),{t:g}=Ut(),v=a,{canvasStyleData:d,popComponentData:l,canvasViewInfo:s,scale:o,canvasState:C}=yt(v),{curComponent:u}=lt(n),U=w(()=>({fontSize:30*v.scale+"px",height:d.value.height*v.scale*.15+"px"})),H=w(()=>v.showPosition==="preview"?v.scale:v.scale*100),O=le=>{var Q;return((Q=u.value)==null?void 0:Q.id)===le.id&&v.showPosition==="popEdit"},k=le=>{i.value=!0,le.preventDefault(),le.dataTransfer.dropEffect="copy"},b=le=>{i.value=!1},oe=le=>{if(i.value=!1,!l.value||l.value.length===0){le.preventDefault(),le.stopPropagation();const Q=le.dataTransfer.getData("id");if(Q){const K=Tn(Q);K.component==="VQuery"?(K.style.top=0,K.style.left=0,K.id=qa(),K.category="hidden",K.commonBackground.backgroundColor="rgba(41, 41, 41, 1)",Jl(K),n.addComponent({component:K,index:void 0}),un(K),r.recordSnapshotCache("renderChart",K.id)):ga.error("及支持添加查询组件")}}},Y=()=>{i.value=!1},G=w(()=>({width:"100%",height:"100%"})),ve=w(()=>{if(C.value.curPointArea==="hidden"){let le=0;return l.value.forEach(Q=>{le=0+Q.propValue.length}),{height:le<8?"15%":le*45*o.value/4+"px"}}else return{height:"0px!important",overflow:"hidden",border:"0!important"}});return Bt(()=>{te.on("handleDragEnd-canvas-main",Y)}),ia(()=>{te.off("handleDragEnd-canvas-main",Y)}),(le,Q)=>(c(),M("div",{class:rt(["pop-area",{"preview-pop":a.showPosition==="preview"}]),style:Oe(ve.value),onMousedown:Q[0]||(Q[0]=Yt(()=>{},["stop"])),onMousedup:Q[1]||(Q[1]=Yt(()=>{},["stop"]))},[x("div",Ms,[e(l)&&e(l).length>0?(c(),M("div",Vs,[(c(!0),M(st,null,$t(e(l),(K,ge)=>(c(),B(Wa,{id:"component-pop-"+K.id,"view-info":e(s)[K.id],key:ge,config:K,index:ge,"dv-info":a.dvInfo,"pop-active":O(K),"show-position":a.showPosition,style:Oe(G.value),scale:H.value},null,8,["id","view-info","config","index","dv-info","pop-active","show-position","style","scale"]))),128))])):a.showPosition==="popEdit"?(c(),M("div",{key:1,class:rt(["pop-area-main",{"pop-area-active":i.value}]),style:Oe(U.value),onDrop:oe,onDragover:k,onDragleave:b},[x("span",null,N(e(g)("visualization.pop_area_tips")),1)],38)):F("",!0)])],38))}});const Za=Ge(Ds,[["__scopeId","data-v-50069d36"]]),Pc=Object.freeze(Object.defineProperty({__proto__:null,default:Za},Symbol.toStringTag,{value:"Module"})),Hs={class:"m-label"},Fs=Ee({__name:"DatasetParamsComponent",emits:["finish"],setup(a,{expose:n,emit:r}){Ut();const i=I(!1),g=I(),v=I(!1),d=ut(),{canvasViewInfo:l}=lt(d),s=Kt({viewId:null}),o=I([]),C=()=>{g.value.clearValidate(),v.value=!1},u=I(null),U=I({}),H=Y=>{if(Y){s.viewId=Y.id;const G=l.value[s.viewId];o.value=na(G.calParams),v.value=!0}},O=()=>{if(k.value){ga.error("请输入正确参数");return}l.value[s.viewId].calParams=o.value,ke().emitter.emit("calcData-"+s.viewId,l.value[s.viewId]),C()},k=w(()=>!o.value||o.value&&o.value.filter(Y=>Y.value===null||Y.value===void 0).length>0),b=()=>v.value,oe=Y=>{Y.preventDefault(),Y.stopPropagation()};return n({optInit:H,statesCheck:b,resetForm:C}),(Y,G)=>{const ve=Oo,le=zo,Q=To,K=Tt,ge=$a,ee=za("loading");return ot((c(),B(ge,{title:"计算参数输入",modelValue:v.value,"onUpdate:modelValue":G[3]||(G[3]=Se=>v.value=Se),width:"400px","before-close":C,onClick:oe},{footer:_(()=>[m(K,{secondary:"",onClick:G[1]||(G[1]=Se=>C())},{default:_(()=>G[5]||(G[5]=[Ae("取消")])),_:1}),m(K,{type:"primary",onClick:G[2]||(G[2]=Se=>O())},{default:_(()=>G[6]||(G[6]=[Ae("确认")])),_:1})]),default:_(()=>[v.value?(c(),B(Q,{key:0,"label-position":"top",ref_key:"subject",ref:g,model:u.value,rules:U.value,onSubmit:G[0]||(G[0]=Yt(()=>{},["prevent"]))},{default:_(()=>[(c(!0),M(st,null,$t(o.value,Se=>(c(),B(le,{key:Se,class:"form-item",prop:"value_"+Se.name},{label:_(()=>[x("label",Hs,[Ae(" 计算字段["+N(Se.name)+"] ",1),G[4]||(G[4]=x("span",{style:{color:"red"}},"*",-1))])]),default:_(()=>[m(ve,{style:{width:"100%"},modelValue:Se.value,"onUpdate:modelValue":ne=>Se.value=ne,placeholder:"请输入一个数字","controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"]))),128))]),_:1},8,["model","rules"])):F("",!0)]),_:1},8,["modelValue"])),[[ee,i.value]])}}});const jn=Ge(Fs,[["__scopeId","data-v-f96791dd"]]),Ls={class:"grid",width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg"},As=["width","height"],Es=["d"],Ps=["width","height"],Bs=["width","height"],Os=["d"],zs=["width","height"],Ts=["width","height"],$s=["d"],Ma=2,Gs=Ee({__name:"DeGrid",props:{matrixStyle:{type:Object},themes:{type:String,default:"dark"}},setup(a){const n=a,r=w(()=>"M "+v.value+" 0 L 0 0 0 "+d.value),i=w(()=>"M "+l.value+" 0 L 0 0 0 "+s.value),g=w(()=>"M "+o.value+" 0 L 0 0 0 "+C.value),v=w(()=>n.matrixStyle.width*2*Ma),d=w(()=>n.matrixStyle.height*2*Ma),l=w(()=>n.matrixStyle.width*Ma),s=w(()=>n.matrixStyle.height*Ma),o=w(()=>n.matrixStyle.width),C=w(()=>n.matrixStyle.height);return(u,U)=>(c(),M("svg",Ls,[x("defs",null,[x("pattern",{id:"smallGrid",width:o.value,height:C.value,patternUnits:"userSpaceOnUse"},[x("path",{d:g.value,fill:"none",stroke:"rgba(207, 207, 207, 0.4)","stroke-width":"0.8"},null,8,Es)],8,As),x("pattern",{id:"middleGrid",width:l.value,height:s.value,patternUnits:"userSpaceOnUse"},[x("rect",{width:l.value,height:s.value,fill:"url(#smallGrid)"},null,8,Bs),x("path",{d:i.value,fill:"none",stroke:"rgba(207, 207, 207, 0.4)","stroke-width":"1"},null,8,Os)],8,Ps),x("pattern",{id:"grid",width:v.value,height:d.value,patternUnits:"userSpaceOnUse"},[x("rect",{width:v.value,height:d.value,fill:"url(#middleGrid)"},null,8,Ts),x("path",{d:r.value,fill:"none",stroke:"rgba(207, 207, 207, 0.4)","stroke-width":"1.2"},null,8,$s)],8,zs)]),U[0]||(U[0]=x("rect",{width:"100%",height:"100%",fill:"url(#grid)"},null,-1))]))}});const Rs=Ge(Gs,[["__scopeId","data-v-717584fd"]]),qs={class:"grid",width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg"},Zs=["width","height"],Ws=["width","height"],Ns=["d"],Us=["width","height"],js=["width","height"],Xs=["d"],Ys=Ee({__name:"DeGridScreen",props:{matrixStyle:{type:Object},themes:{type:String,default:"dark"}},setup(a){const n=a,r=w(()=>"M "+i.value+" 0 L 0 0 0 "+g.value),i=w(()=>n.matrixStyle.width*5),g=w(()=>n.matrixStyle.height*5),v=w(()=>"M "+d.value+" 0 L 0 0 0 "+l.value),d=w(()=>n.matrixStyle.width),l=w(()=>n.matrixStyle.height);return(s,o)=>(c(),M("svg",qs,[x("defs",null,[x("pattern",{id:"grid",width:i.value,height:g.value,patternUnits:"userSpaceOnUse"},[x("rect",{width:i.value,height:g.value,fill:"url(#middleGrid)"},null,8,Ws),x("path",{d:r.value,fill:"none",stroke:"rgba(207, 207, 207, 0.4)","stroke-width":"0.7"},null,8,Ns)],8,Zs),x("pattern",{id:"middleGrid",width:d.value,height:l.value,patternUnits:"userSpaceOnUse"},[x("rect",{width:d.value,height:l.value,fill:"url(#smallGrid)"},null,8,js),x("path",{d:v.value,fill:"none",stroke:"rgba(207, 207, 207, 0.4)","stroke-width":"0.3"},null,8,Xs)],8,Us)]),o[0]||(o[0]=x("rect",{width:"100%",height:"100%",fill:"url(#grid)"},null,-1))]))}});const Ks=Ge(Ys,[["__scopeId","data-v-bddb34a2"]]);const Js={},Qs={class:"areaShadow"};function er(a,n){return c(),M("div",Qs)}const tr=Ge(Js,[["render",er],["__scopeId","data-v-eb1440ff"]]),ar=["id"],nr=Ee({__name:"CanvasCore",props:{themes:{type:String,default:"dark"},isEdit:{type:Boolean,default:!0},canvasStyleData:{type:Object,required:!0},componentData:{type:Array,required:!0},popComponentData:{type:Array,required:!1,default:()=>[]},canvasViewInfo:{type:Object,required:!0},canvasId:{type:String,default:"canvas-main"},dvModel:{type:String,default:"dv"},baseWidth:{required:!1,type:Number,default:100},baseHeight:{required:!1,type:Number,default:50},baseMarginLeft:{required:!1,type:Number,default:20},baseMarginTop:{required:!1,type:Number,default:20},draggable:{required:!1,default:!0,type:Boolean},dragStart:{required:!1,type:Function,default(){return{}}},dragging:{required:!1,type:Function,default(){return{}}},dragEnd:{required:!1,type:Function,default(){return{}}},resizable:{required:!1,type:Boolean,default:!0},resizeStart:{required:!1,type:Function,default(){return{}}},resizing:{required:!1,type:Function,default(){return{}}},resizeEnd:{required:!1,type:Function,default(){return{}}},scale:{type:Number,required:!1,default:1},canvasActive:{type:Boolean,required:!1,default:!0},fontFamily:{type:String,required:!1,default:"inherit"}},emits:["scrollCanvasAdjust"],setup(a,{expose:n,emit:r}){const i=oa(),g=ut(),v=Ra(),d=sn(),{curComponent:l,dvInfo:s,editMode:o,tabMoveOutComponentId:C,canvasState:u,mainScrollTop:U}=lt(g),{editorMap:H,areaData:O,isCtrlOrCmdDown:k}=lt(v),b=a,{baseWidth:oe,baseHeight:Y,baseMarginLeft:G,baseMarginTop:ve,draggable:le,dragStart:Q,dragging:K,dragEnd:ge,resizable:ee,resizeStart:Se,resizing:ne,resizeEnd:Re,isEdit:re,canvasId:$,canvasStyleData:j,componentData:ae,canvasViewInfo:Ye,themes:qe}=yt(b),tt=De($.value),$e=I(0),Te=I(0),y=I({x:0,y:0}),W=I(0),D=I(0),q=I(!1),L=["width","height","top","left","rotate","backgroundColor","borderWidth","borderStyle","borderColor"],E=["width","height","top","left","rotate"],J=["width","height","top","left","rotate","borderActive","borderWidth","borderRadius","borderStyle","borderColor"],ie=I(null),ye=I(null),ze=I(null),we=I(null),Ke=I("editor-"+$.value);Nt(()=>s.value,()=>{dt()},{deep:!0}),Nt(()=>j.value,()=>{We(()=>{dt()})},{deep:!0}),Nt(()=>O.value.components.length,(t,p)=>{wo()});const pt=()=>{setTimeout(()=>{dt()})},dt=(t="editor-canvas-main")=>{try{s.value.watermarkInfo&&s.value.watermarkInfo.settingContent&&De($.value)&&_a(t,$.value,A.value)}catch{console.warn("Watermarks are not supported!")}},vt=w(()=>({width:oe.value,height:Y.value})),at=w(()=>s.value.type==="dashboard"&&ae.value.length===0&&$.value==="canvas-main"),ct=w(()=>{var t;return((t=l.value)==null?void 0:t.id)||""}),{emitter:Et}=ke(),A=w(()=>R.value?j.value.scale*1.2/100:j.value.scale/100),T=w(()=>R.value?g.canvasStyleData.scale*1.2/100:g.canvasStyleData.scale/100),Ie=w(()=>$.value==="canvas-main"&&l.value&&l.value.canvasId!=="canvas-main"&&C.value),He=w(()=>{var t,p,h,V;return R.value&&((p=(t=j.value)==null?void 0:t.dashboard)==null?void 0:p.gap)==="yes"?(V=(h=j.value)==null?void 0:h.dashboard)==null?void 0:V.gapSize:0}),Me=w(()=>({baseWidth:oe.value,baseHeight:sa.value?oe.value*1.6:Y.value,curGap:He.value})),R=w(()=>s.value.type==="dashboard"),X=w(()=>yn($.value)),be=I(!1),Pe=I(!1),_e=I(0),Ce=I(0),ue=I(0),f=I(null),ce=I(null),se=I([]),Ue=I([]);let Je,Be=!1,Dt=100;const Ze=I(0);let de=0,_t=I(null);const zt=t=>{if(R.value||o.value==="preview"||t.buttons===2)return;!l.value||Zo(l.value.component),Gt();const p=H.value[$.value].getBoundingClientRect();$e.value=p.x,Te.value=p.y;const h=t.clientX,V=t.clientY;y.value.x=h-$e.value,y.value.y=V-Te.value,q.value=!0;const P=Ve=>{W.value=Math.abs(Ve.clientX-h),D.value=Math.abs(Ve.clientY-V),Ve.clientX<h&&(y.value.x=Ve.clientX-$e.value),Ve.clientY<V&&(y.value.y=Ve.clientY-Te.value)},xe=Ve=>{if(document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",xe),Ve.clientX==h&&Ve.clientY==V){Gt();return}Xt()};document.addEventListener("mousemove",P),document.addEventListener("mouseup",xe)},Gt=()=>{q.value=!1,W.value=0,D.value=0,v.setAreaData({style:{left:0,top:0,width:0,height:0},components:[]})},Xt=()=>{const t=Ct();if(t.length<=1){Gt();return}let p=1/0,h=1/0,V=-1/0,P=-1/0;t.forEach(Ve=>{let me={left:0,top:0,right:0,bottom:0};Ve.component=="Group"?Ve.propValue.forEach(Vt=>{const Lt=Wo(`#shape-id-${Vt.id}`).getBoundingClientRect();me.left=Lt.left-$e.value,me.top=Lt.top-Te.value,me.right=Lt.right-$e.value,me.bottom=Lt.bottom-Te.value,me.left<h&&(h=me.left),me.top<p&&(p=me.top),me.right>V&&(V=me.right),me.bottom>P&&(P=me.bottom)}):me=Fa(Ve.style),me.left<h&&(h=me.left),me.top<p&&(p=me.top),me.right>V&&(V=me.right),me.bottom>P&&(P=me.bottom)}),y.value.x=h,y.value.y=p,W.value=V-h,D.value=P-p;const xe={left:h,top:p,width:W.value,height:D.value};v.setAreaData({style:xe,components:t}),t.length>0&&(g.setCurComponent({component:null,index:null}),q.value=!1)},Ct=()=>{const t=[],{x:p,y:h}=y.value;return ae.value.forEach(V=>{if(V.isLock||!V.isShow)return;const P=Fa(V.style);p<=P.left&&h<=P.top&&P.left+P.width<=p+W.value&&P.top+P.height<=h+D.value&&t.push(V)}),t},Rt=t=>{if(R.value||o.value==="preview")return;t.stopPropagation(),t.preventDefault();const p=t.clientX,h=t.clientY,V=ce.value.getBoundingClientRect(),P=V.left,xe=V.top,Ve=p-P;let me=h-xe;if(!l.value||l.value&&!l.value.editing){l.value&&["VQuery"].includes(l.value.component)&&(l==null?void 0:l.value.category)==="base"&&(me=me*T.value+l.value.style.top*(1-T.value)),d.showContextMenu({top:me,left:Ve,position:"canvasCore"});const Vt=document.getElementById("close-button");Vt&&Vt.click()}},xt=t=>La(t,t.borderActive?E:J),pe=t=>La(t,L),fe=t=>In(t,{dvModel:s.value.type,cellWidth:_e.value,cellHeight:Ce.value,curGap:He.value,showPosition:"edit"}),ft=(t,p)=>{t.component==="VText"&&g.setShapeStyle({top:null,left:null,width:null,height:wt(t,p),rotate:null})},wt=(t,p)=>{let{lineHeight:h,fontSize:V,height:P}=t.style;h===""&&(h=1.5);const xe=(p.split("<br>").length-1)*h*(V||j.value.fontSize);return P>xe?P:xe},nt=w(()=>yn($.value)?{width:"100%",height:"100%"}:R.value?{width:"100%",height:Ze.value*Ce.value+"px"}:{...Ta(j.value,$.value),width:Aa(j.value.width)+"px",height:Aa(j.value.height)+"px"});function je(t,p){Be?Je=t:(function(h){Be=!0,setTimeout(function(){h(),setTimeout(function(){Be=!1,Je!=null&&je(Je,p)},Dt)},p)}(t),Je=void 0)}function Ht(t){if(t.clientY+50>=window.innerHeight){let p=Ja(document.body);p.scrollTop(p.scrollTop()+20)}else if(t.clientY<=150){let p=Ja(document.body);p.scrollTop(p.scrollTop()-20)}}function Ca(){de=ue.value;let t=36;for(let p=0;p<t;p++){let h=[];for(let V=0;V<ue.value;V++)h.push({el:!1});se.value.push(h)}}function S(t){const p=t.sizeX;let h=1,V=-1,P=se.value;if(!(p<=0)){if(ae.value.forEach(xe=>{const Ve=xe.y+xe.sizeY-2;V<Ve&&(V=Ve)}),V<0)return 1;{const xe=P[V];for(let Ve=0,me=p-1;me<xe.length;Ve++,me++){let Vt=0;for(let Lt=0;Lt<p;Lt++)xe[Ve+Lt].el||Vt++;if(Vt===p){h=Ve+1;break}}return h}}}function z(t){let p=se.value;if(!(t.x<=0||t.y<=0))for(let h=t.x-1;h<t.x-1+t.sizeX;h++)for(let V=t.y-1;V<t.y-1+t.sizeY;V++)try{p[V][h]&&(p[V][h].el=t)}catch(P){console.warn("addItemToPositionBox-warn:",P)}}function Z(t){let p=se.value;t+=2;for(let h=0;h<t;h++)if(p[h]==null){let V=[];for(let P=0;P<de;P++)V.push({el:!1});p.push(V)}Ze.value=t,Ja(ce.value).css("height",(Ze.value+2)*Ce.value+"px")}function Le(t){let p=se.value;if(!(t.x<=0||t.y<=0))for(let h=t.x-1;h<t.x-1+t.sizeX;h++)for(let V=t.y-1;V<t.y-1+t.sizeY;V++)try{p[V][h]&&(p[V][h].el=!1)}catch(P){console.warn(P)}}function Fe(){let t=ce.value.offsetWidth,p=Math.round(t/_e.value);ue.value=p,de=ue.value}function Xe(t,p){Le(t);let h=Pt(t);Ot.forEach(h,function(P){let xe=Mt(P);xe>0&&Ft(P,xe)}),t.sizeX=p.sizeX,t.sizeY=p.sizeY,t.sizeX+t.x-1>de&&(t.sizeX=de-t.x+1),t.sizeY+t.y>Ze.value&&Z(t.y+t.sizeY),It(t),z(t),kt(t);let V=Mt(t);V>0&&Ft(t,V)}function he(t,p){p=p||{},p.x=p.x||t.x,p.y=p.y||t.y,t.x<1&&(t.x=1),t.sizeX>de&&(t.sizeX=de),t.sizeX<1&&(t.sizeX=1),t.x+t.sizeX-1>de&&(t.x=de-t.sizeX+1,t.x<1&&(t.x=1)),t.y<1&&(t.y=1),t.sizeY<1&&(t.sizeY=1),t.y+t.sizeY>Ze.value-1&&Z(t.y+t.sizeY-1)}function Qe(t,p){Le(t);let h=Pt(t);Ot.forEach(h,function(P){let xe=Mt(P);xe>0&&Ft(P,xe)}),t.x=p.x,t.y=p.y,he(t,p),It(t),z(t),kt(t);let V=Mt(t);V>0&&Ft(t,V)}function ht(t){t&&(ae.value.forEach((p,h)=>{t===p.id&&et(h)}),De($.value)||We(()=>{Qt()}))}function it(t){if(t&&_n(t,$.value)){if(gt()){Le(t);let h=Pt(t);Ot.forEach(h,function(V){let P=Mt(V);P>0&&Ft(V,P)})}let p=[];t.innerType==="VQuery"&&(t.propValue||[]).forEach(h=>{p=[...h.checkedFields,...p]}),p.length&&Array.from(new Set(p)).forEach(h=>{Et.emit(`query-data-${h}`)}),i.recordSnapshotCache("removeItem")}}function et(t){let p=ae.value[t];p&&_n(p,$.value)&&(it(p),g.removeLinkageInfo(p.id),De($.value)?g.deleteComponentById(p.id):ae.value.splice(t,1))}function St(t,p){p<0&&(p=ae.value.length),t._dragId=p,he(t,{x:t.x,y:t.y}),It(t),z(t);let h=Mt(t);h>0&&Ft(t,h)}function kt(t){let p=_e.value*t.sizeX-G.value,h=Ce.value*t.sizeY-ve.value,V=_e.value*(t.x-1)+G.value,P=Ce.value*(t.y-1)+ve.value,xe={x1:V,x2:V+p,y1:P,y2:P+h,c1:V+p/2,c2:P+h/2,el:t},Ve=Ot.findIndex(Ue.value,function(me){return me.el._dragId==t._dragId});Ve!=-1&&Ue.value.splice(Ve,1,xe)}function It(t){let p=Pt(t);Ot.forEach(p,function(h){if(h._dragId==t._dragId)return;let V=t.y+t.sizeY-h.y;V>0&&qt(h,V)})}function Mt(t){let p=0;for(let h=t.y-2;h>=0;h--){for(let V=t.x-1;V<t.x-1+t.sizeX;V++)if(se.value[h][V]&&se.value[h][V].el)return p;p++}return p}function qt(t,p){Le(t);let h=Pt(t);Ot.forEach(h,function(P){if(P._dragId==t._dragId)return;let xe=Jt(t,P,p);xe>0&&qt(P,xe)});let V={y:t.y+p};bt(t,V),he(t,V),z(t),kt(t)}function bt(t,p){p=p||{};let h=p.x||t.x,V=p.y||t.y;t.x=h,t.y=V,t.y+t.sizeY>Ze.value&&(Ze.value=t.y+t.sizeY)}function Jt(t,p,h){let V=[];for(let xe=p.x-1;xe<p.x-1+p.sizeX;xe++){let Ve=0;for(let me=t.y-1+t.sizeY;me<p.y-1;me++)se.value[me][xe]&&se.value[me][xe].el==!1&&Ve++;V.push(Ve)}let P=Math.max.apply(Math,V);return h=h-P,h>0?h:0}function Ft(t,p){Le(t);let h=Pt(t);bt(t,{y:t.y-p}),z(t),kt(t),Ot.forEach(h,function(V){let P=Mt(V);P>0&&Ft(V,P)})}function Pt(t){let p={};for(let h=t.x-1;h<t.x-1+t.sizeX;h++)for(let V=t.y-1;V<se.value.length;V++){let P=se.value[V][h];if(P&&P.el){p[P.el._dragId]=P.el;break}}return Ot.sortBy(Ot.values(p),"y")}const Zt=(t,p,h)=>{g.setCurComponent({component:p,index:h}),g.setClickComponentStatus(!0),g.setInEditorStatus(!0)},jt=(t,p,h)=>{Zt(t,p,h),la(t)},la=t=>{Ot.isEmpty(f.value)||(f.value.cloneItem&&f.value.cloneItem.remove(),f.value.resizeItem&&(delete f.value.resizeItem.isPlayer,Re.value(t,f.value.resizeItem,f.value.resizeItem._dragId)),f.value.moveItem&&(ge==null||ge.value(null,t,f.value.moveItem,f.value.moveItem._dragId),f.value.moveItem.show=!0,delete f.value.moveItem.isPlayer),f.value={})},sa=w(()=>{var t;return gt()&&((t=j.value)==null?void 0:t.dashboardAdaptor)==="withWidth"}),wa=()=>{_e.value=Math.floor((oe.value+G.value)*1e3)/1e3,sa.value?Ce.value=_e.value*1.6:Ce.value=Math.floor((Y.value+ve.value)*1e3)/1e3},Na=()=>{De($.value)&&dt(),wa(),Fe()},Qt=()=>{wa(),se.value=[],Ue.value=[],Je=void 0,Be=!1,Dt=200,Ze.value=0,de=0,Fe(),Ca(),gt()&&nl(ae.value);let t=0,p=setInterval(function(){if(t>=ae.value.length)clearInterval(p),We(()=>{Pe.value=!0});else{let h=ae.value[t];St(h,t),t++}},1);be.value=!0},Ua=t=>{let p=setInterval(()=>{Pe.value&&(clearInterval(p),t())},100)},eo=()=>{Ce.value=Ce.value+.001,We(function(){Ce.value=Ce.value-.001})},to=()=>ae.value.length===0?1:ae.value.filter(t=>t.y).map(t=>t.y+t.sizeY).reduce((t,p)=>Math.max(t,p),0),ba=t=>{t.y=t.y===void 0?to():t.y,ma(t,oe.value,Y.value),eo(),We(()=>{St(t,ae.value.length-1)})},ao=(t,p,h)=>{ma(p,_e.value,Ce.value),ee.value&&(Se.value(t,p,h),f.value||(f.value={}),f.value.resizeItem=p,f.value.resizeItemIndex=h,f.value.moveItem=p,f.value.moveItemIndex=h,f.value.originX=0,f.value.originY=0,f.value.startX=0,f.value.startY=0,f.value.oldX=p.x,f.value.oldY=p.y,f.value.oldSizeX=p.sizex,f.value.oldSizeY=p.sizey)},no=(t,p,h)=>{ma(p,_e.value,Ce.value),f.value||(f.value={}),Q.value.call(null,t,p,h),f.value.moveItem=p,f.value.moveItemIndex=h,f.value.originX=0,f.value.originY=0,f.value.startX=0,f.value.startY=0,f.value.oldX=p.x,f.value.oldY=p.y,f.value.oldSizeX=p.sizex,f.value.oldSizeY=p.sizey},vn=(t,p)=>{const h=f.value;let V=Ot.get(h,"moveItem");if(Ht(t),!le.value)return;K.value(t,V,V._dragId),V.isPlayer=!0;let P=h.oldX,xe=h.oldY,Ve=Math.floor(p.style.left/_e.value+1),me=Math.floor(p.style.top/Ce.value+1);Ve=Ve>0?Ve:1,me=me>0?me:1,je(function(Vt,Lt,ra,xa){return function(){(Vt!=Lt||xa!=ra)&&(Qe(V,{x:Vt,y:ra}),h.oldX=Vt,h.oldY=ra)}}(Ve,P,me,xe),10)},oo=(t,p)=>{const{width:h,height:V}=p.style,P=f.value;let xe=Ot.get(P,"resizeItem");ne.value(t,xe,xe._dragId),xe.isPlayer=!0;let Ve=h%_e.value>_e.value/4*3?Math.floor(h/_e.value+1):Math.floor(h/_e.value),me=V%Ce.value>Ce.value/4*3?Math.floor(V/Ce.value+1):Math.floor(V/Ce.value),Vt=Math.floor((p.style.left+5)/_e.value+1),Lt=Math.floor((p.style.top+5)/Ce.value+1);Vt=Vt>0?Vt:1,Lt=Lt>0?Lt:1,je(function(ra,xa){return function(){Xe(xe,{sizeX:Ve,sizeY:me}),P.oldSizeX=Ve,P.oldSizeY=me,Qe(xe,{x:ra,y:xa}),P.oldX=ra,P.oldY=xa}}(Vt,Lt),10)},lo=t=>{Ot.isEmpty(f.value)||(f.value.cloneItem&&f.value.cloneItem.remove(),f.value.resizeItem&&(delete f.value.resizeItem.isPlayer,Re.value(t,f.value.resizeItem,f.value.resizeItem._dragId)),f.value.moveItem&&(ge==null||ge.value(null,t,f.value.moveItem,f.value.moveItem._dragId),f.value.moveItem.show=!0,delete f.value.moveItem.isPlayer),f.value={})},pn=t=>{const p=Tn(t);p.x=300/_e.value,p.isShow=!1,p.id=qa(),g.addComponent({component:p,index:void 0}),s.value.type==="dashboard"&&un(p),ba(p),f.value||(f.value={}),f.value.moveItem=p,f.value.moveItemIndex=ae.value.length-1,f.value.oldX=1,f.value.oldY=1},fn=t=>{f.value&&f.value.moveItem&&!f.value.moveItem.isShow&&(et(ae.value.length-1),la(t))},io=t=>{!f.value||!f.value.moveItem||(f.value.moveItem.style.left=t.pageX,f.value.moveItem.style.top=t.pageY+U.value,vn(t,f.value.moveItem))},so=()=>f.value.moveItem,ro=(t,p)=>{ie.value.dialogInit(j.value,Ye.value[p.id],p,t,{scale:T.value})},uo=t=>{var p;(p=ye.value)==null||p.optInit(t)},co=()=>{_t.value=setInterval(()=>{i.snapshotCatchToStore()},1e3)},vo=t=>{Cn(()=>{ze.value.dialogInit(t)})},po=t=>{Cn(()=>{we.value.dialogInit(t)})},fo=w(()=>De($.value)),ho=w(()=>De($.value)),mo=w(()=>!!j.value.dashboard.showGrid&&De($.value)&&gt()),go=w(()=>!!j.value.dashboard.showGrid&&De($.value)&&!gt()),yo=()=>{g.setBatchOptStatus(!0),O.value.components.forEach(t=>{g.addCurBatchComponent(t)})},_o=t=>t.isShow&&(t.component!=="GroupArea"||t.component==="GroupArea"&&!k.value),Co=w(()=>ae.value.length>0&&ae.value[ae.value.length-1].component==="GroupArea"&&k.value),wo=async()=>{let t;const p=g.componentData.filter(h=>h.component==="GroupArea");p&&p.length>0&&(t=p[0]),O.value.components.length===0&&g.setBatchOptStatus(!1),O.value.components.length>1?(yo(),v.calcComposeArea(),p.length===0&&(t=ol("GroupArea","GroupArea"),g.addComponent({component:t,index:void 0})),t.style.left=O.value.style.left,t.style.top=O.value.style.top,t.style.width=O.value.style.width,t.style.height=O.value.style.height,g.setClickComponentStatus(!0),g.setCurComponent({component:t,index:g.componentData.length-1})):t&&p.forEach(h=>{g.deleteComponentById(h.id)})},bo=w(()=>{var t;return((t=j.value)==null?void 0:t.popupAvailable)&&De($.value)});return Bt(()=>{De($.value)&&(co(),dt(),g.setEditMode("edit")),v.getEditor($.value),te.on("handleDragStartMoveIn-"+$.value,pn),te.on("handleDragEnd-"+$.value,fn),te.on("hideArea-"+$.value,Gt),te.on("removeMatrixItem-"+$.value,et),te.on("removeMatrixItemPosition-"+$.value,it),te.on("removeMatrixItemById-"+$.value,ht),te.on("addDashboardItem-"+$.value,ba),te.on("snapshotChange-"+$.value,Qt),te.on("doCanvasInit-"+$.value,Qt)}),ia(()=>{_t.value&&(clearInterval(_t.value),_t.value=null),te.off("handleDragStartMoveIn-"+$.value,pn),te.off("handleDragEnd-"+$.value,fn),te.off("hideArea-"+$.value,Gt),te.off("removeMatrixItem-"+$.value,et),te.off("removeMatrixItemPosition-"+$.value,it),te.off("removeMatrixItemById-"+$.value,ht),te.off("addDashboardItem-"+$.value,ba),te.off("snapshotChange-"+$.value,Qt),te.off("doCanvasInit"+$.value,Qt)}),n({canvasSizeInit:Na,canvasInit:Qt,afterInitOk:Ua,addItemBox:ba,handleDragOver:io,getMoveItem:so,handleMouseUp:jt,handleMouseDown:zt,findPositionX:S,watermarkUpdate:pt}),(t,p)=>(c(),M("div",{id:Ke.value,ref_key:"container",ref:ce,class:rt(["editor",{edit:e(re),"dashboard-editor":R.value,"group-canvas":X.value}]),style:Oe(nt.value),onContextmenu:Rt},[an(t.$slots,"canvasDragTips",{},void 0,!0),at.value?(c(),B(Is,{key:0})):F("",!0),e(s).type==="dataV"?(c(),B(dn,{key:1,"canvas-style-data":e(j),"component-data":e(ae),"canvas-id":e($)},null,8,["canvas-style-data","component-data","canvas-id"])):F("",!0),bo.value?(c(),B(Za,{key:2,"dv-info":e(s),"canvas-id":e($),"canvas-style-data":e(j),canvasViewInfo:e(Ye),"pop-component-data":a.popComponentData,scale:T.value,"canvas-state":e(u),"show-position":"popEdit"},null,8,["dv-info","canvas-id","canvas-style-data","canvasViewInfo","pop-component-data","scale","canvas-state"])):F("",!0),mo.value?(c(),B(Rs,{key:3,"matrix-style":vt.value,themes:e(qe)},null,8,["matrix-style","themes"])):F("",!0),go.value?(c(),B(Ks,{key:4,"matrix-style":vt.value,themes:e(qe)},null,8,["matrix-style","themes"])):F("",!0),f.value&&f.value.moveItem&&e(o)!=="preview"?(c(),B(cs,{key:5,"base-height":sa.value?e(oe)*1.6:e(Y),"base-width":e(oe),"cur-gap":He.value,element:f.value.moveItem},null,8,["base-height","base-width","cur-gap","element"])):F("",!0),Ie.value?(c(),B(_s,{key:6,"canvas-id":e($)},null,8,["canvas-id"])):F("",!0),Co.value?(c(),B(tr,{key:7,style:Oe(fe(e(ae)[e(ae).length-1]))},null,8,["style"])):F("",!0),(c(!0),M(st,null,$t(e(ae),(h,V)=>ot((c(),B(es,{"canvas-id":e($),scale:A.value,key:h.id,"default-style":h.style,style:Oe(fe(h)),element:h,index:V,class:rt({lock:h.isLock&&e(o)==="edit"}),"base-cell-info":Me.value,"canvas-active":a.canvasActive,"is-tab-move-check":e(tt),onOnStartResize:P=>ao(P,h,V),onOnStartMove:P=>no(P,h,V),onOnMouseUp:p[0]||(p[0]=P=>lo(P)),onOnDragging:P=>vn(P,h),onOnResizing:P=>oo(P,h),onUserViewEnlargeOpen:P=>ro(P,h),onDatasetParamsInit:P=>uo(h),onLinkJumpSetOpen:P=>vo(h),onLinkageSetOpen:P=>po(h)},{default:_(()=>[h.component==="UserView"||h.isPlugin?(c(),B(ha(e(Da)(h.component)),{key:0,class:"component",id:"component"+h.id,active:h.id===ct.value,"dv-type":e(s).type,scale:T.value,style:Oe(xt(h.style)),"prop-value":h.propValue,"is-edit":!0,view:e(Ye)[h.id],element:h,request:h.request,onInput:ft,"dv-info":e(s),"canvas-active":a.canvasActive,"show-position":"canvas","font-family":a.fontFamily},null,40,["id","active","dv-type","scale","style","prop-value","view","element","request","dv-info","canvas-active","font-family"])):h.component.includes("Svg")?(c(),B(ha(e(Da)(h.component)),{key:1,id:"component"+h.id,scale:T.value,class:"component","is-edit":!0,style:Oe(pe(h.style)),"prop-value":h.propValue,element:h,request:h.request,"canvas-style-data":e(j),"canvas-view-info":e(Ye),"dv-info":e(s),active:h.id===ct.value,"canvas-active":a.canvasActive,"show-position":"edit","font-family":a.fontFamily},null,8,["id","scale","style","prop-value","element","request","canvas-style-data","canvas-view-info","dv-info","active","canvas-active","font-family"])):(c(),B(ha(e(Da)(h.component)),{key:2,id:"component"+h.id,scale:T.value,class:"component","is-edit":!0,style:Oe(xt(h.style)),"prop-value":h.propValue,element:h,request:h.request,"canvas-style-data":e(j),"canvas-view-info":e(Ye),"dv-info":e(s),active:h.id===ct.value,"canvas-active":a.canvasActive,"show-position":"edit","font-family":a.fontFamily},null,8,["id","scale","style","prop-value","element","request","canvas-style-data","canvas-view-info","dv-info","active","canvas-active","font-family"]))]),_:2},1032,["canvas-id","scale","default-style","style","element","index","class","base-cell-info","canvas-active","is-tab-move-check","onOnStartResize","onOnStartMove","onOnDragging","onOnResizing","onUserViewEnlargeOpen","onDatasetParamsInit","onLinkJumpSetOpen","onLinkageSetOpen"])),[[mt,_o(h)]])),128)),fo.value?(c(),B(ns,{key:8,"show-position":"canvasCore"})):F("",!0),ho.value?(c(),B(is,{key:9})):F("",!0),ot(m(rs,{start:y.value,width:W.value,height:D.value},null,8,["start","width","height"]),[[mt,q.value]]),m(cn,{ref_key:"userViewEnlargeRef",ref:ie},null,512),m(dl,{ref_key:"linkJumpRef",ref:ze},null,512),m(vl,{ref_key:"linkageRef",ref:we},null,512),m(jn,{ref_key:"customDatasetParamsRef",ref:ye},null,512)],46,ar))}});const Xn=Ge(nr,[["__scopeId","data-v-d845fefc"]]),or={class:"group"},lr=Ee({__name:"GroupPreview",props:{propValue:{type:Array,default:()=>[]},element:{type:Object,default(){return{propValue:null}}},showPosition:{type:String,required:!1,default:"canvas"},dvInfo:{type:Object,required:!0},searchCount:{type:Number,required:!1,default:0},scale:{type:Number,required:!1,default:1},canvasViewInfo:{type:Object,required:!0},fontFamily:{type:String,required:!1,default:"inherit"}},setup(a){const n=ut(),r=I(null),i=a,{propValue:g,dvInfo:v,searchCount:d,scale:l,canvasViewInfo:s}=yt(i),o=u=>({width:Sa(u.groupStyle.width),height:Sa(u.groupStyle.height),top:Sa(u.groupStyle.top),left:Sa(u.groupStyle.left)}),C=(u,U)=>{r.value.dialogInit(n.canvasStyleData,s.value[U.id],U,u,{scale:l.value})};return(u,U)=>(c(),M("div",or,[x("div",null,[(c(!0),M(st,null,$t(e(g),(H,O)=>(c(),B(Wa,{id:"component"+H.id,"view-info":e(s)[H.id],key:O,config:H,index:O,"dv-info":e(v),"canvas-view-info":e(s),style:Oe(o(H)),"show-position":a.showPosition,"search-count":e(d),scale:e(l),"font-family":a.fontFamily,onUserViewEnlargeOpen:k=>C(k,H)},null,8,["id","view-info","config","index","dv-info","canvas-view-info","style","show-position","search-count","scale","font-family","onUserViewEnlargeOpen"]))),128))]),m(cn,{ref_key:"userViewEnlargeRef",ref:r},null,512)]))}});const ir=Ge(lr,[["__scopeId","data-v-6881a0f1"]]),sr=Ee({__name:"CanvasGroup",props:{canvasStyleData:{type:Object,required:!0},componentData:{type:Array,required:!0},canvasViewInfo:{type:Object,required:!0},dvInfo:{type:Object,required:!0},element:{type:Object,default(){return{propValue:[]}}},isEdit:{type:Boolean,default:!1},showPosition:{type:String,required:!1,default:"canvas"},canvasId:{type:String,required:!0},searchCount:{type:Number,required:!1,default:0},scale:{type:Number,required:!1,default:1},fontFamily:{type:String,required:!1,default:"inherit"}},setup(a){const n=a,{element:r,isEdit:i,showPosition:g,canvasStyleData:v,canvasViewInfo:d,dvInfo:l,componentData:s}=yt(n);return(o,C)=>e(i)?(c(),B(Xn,{key:0,class:"canvas-area-shadow",ref:"canvasGroup","component-data":e(s),"canvas-style-data":e(v),"canvas-view-info":e(d),"canvas-id":a.canvasId,"canvas-active":e(r).canvasActive,"font-family":a.fontFamily},null,8,["component-data","canvas-style-data","canvas-view-info","canvas-id","canvas-active","font-family"])):(c(),B(ir,{key:1,ref:"dashboardPreview","dv-info":e(l),element:e(r),"search-count":a.searchCount,"prop-value":e(r).propValue,"show-position":e(g),scale:a.scale*100,"canvas-view-info":e(d),"font-family":a.fontFamily},null,8,["dv-info","element","search-count","prop-value","show-position","scale","canvas-view-info","font-family"]))}}),rr=Ee({__name:"Component",props:{propValue:{type:Array,default:()=>[]},element:{type:Object,required:!0,default(){return{propValue:null}}},showPosition:{type:String,required:!1,default:"canvas"},dvInfo:{type:Object,required:!0},searchCount:{type:Number,required:!1,default:0},isEdit:{type:Boolean,required:!1,default:!1},scale:{type:Number,required:!1,default:1},active:{type:Boolean,default:!1},canvasViewInfo:{type:Object,required:!0},fontFamily:{type:String,required:!1,default:"inherit"}},setup(a){const n=ut(),{canvasStyleData:r,curComponent:i}=lt(n),g=na(fl),v=a,{propValue:d,dvInfo:l,element:s,scale:o,canvasViewInfo:C,searchCount:u}=yt(v),U=w(()=>{const O=g;return O.scale=r.value.scale,O.width=s.value.style.width*100/O.scale,O.height=s.value.style.height*100/O.scale,O}),H=()=>{s.value.canvasActive=!0};return Nt(()=>v.active,()=>{We(()=>{!v.active&&(!i.value||i.value&&!i.value.canvasId.includes(s.value.id))&&(s.value.canvasActive=!1)})},{deep:!0}),Bt(()=>{We(()=>{pa(s.value)})}),(O,k)=>(c(),M("div",{class:rt(["group",{"canvas-active-custom":e(s).canvasActive}]),onDblclick:H},[m(sr,{"component-data":e(d),"dv-info":e(l),"show-position":a.showPosition,"canvas-id":"Group-"+e(s).id,"canvas-style-data":U.value,"canvas-view-info":e(C),"is-edit":a.isEdit,element:e(s),scale:e(o),"search-count":e(u),"font-family":a.fontFamily},null,8,["component-data","dv-info","show-position","canvas-id","canvas-style-data","canvas-view-info","is-edit","element","scale","search-count","font-family"])],34))}});const Yn=Ge(rr,[["__scopeId","data-v-460ef1c6"]]),Bc=Object.freeze(Object.defineProperty({__proto__:null,default:Yn},Symbol.toStringTag,{value:"Module"})),ur=["id"],cr=["id"],dr=Ee({__name:"DeCanvas",props:{canvasStyleData:{type:Object,required:!0},componentData:{type:Array,required:!0},canvasViewInfo:{type:Object,required:!0},canvasId:{type:String,required:!1,default:"canvas-main"},canvasActive:{type:Boolean,default:!0},outerScale:{type:Number,required:!1,default:1},fontFamily:{type:String,required:!1,default:"inherit"},canvasPosition:{type:String,required:!1,default:"main"}},setup(a,{expose:n}){const r=a,{canvasStyleData:i,componentData:g,canvasViewInfo:v,canvasId:d,canvasActive:l,canvasPosition:s}=yt(r),o=I("de-canvas-"+d.value),C=ut(),u=oa(),{pcMatrixCount:U,curOriginThemes:H,mobileInPc:O}=lt(C),k=I(null),b=I(null),oe=I(!1),Y=I(100),G=I(100),ve=I(100),le=Kt({screenWidth:1920,screenHeight:1080,curScrollTop:0}),Q=I(0),K=I(0),ge=I(!1),ee=I(0),Se=I(0),ne=I(null),Re=I("edit-"+d.value),re=w(()=>i.value&&De(d.value)?{...Ta(i.value)}:{}),$=J=>{const{componentName:ie,innerType:ye,staticMap:ze}=J;if(ie){const we=hl(ie,ye,H,ze);ma(we,Q.value,K.value),we.id=qa(),we.y=void 0,we.x=ne.value.findPositionX(we),C.addComponent({component:we,index:void 0}),un(we),We(()=>{ne.value.addItemBox(we),We(()=>{L(we.y)})}),u.recordSnapshotCacheWithPositionChange("renderChart",we.id)}},j=J=>{if(De(d.value)){J.preventDefault(),J.stopPropagation();const ie=ne.value.getMoveItem();ie.isShow=!0,ma(ie,Q.value,K.value),ne.value.handleMouseUp(J,ie,g.value.length-1),u.recordSnapshotCacheWithPositionChange("renderChart",ie.id)}},ae=J=>{De(d.value)&&(J.preventDefault(),J.dataTransfer.dropEffect="copy",ne.value.handleDragOver(J))},Ye=J=>{De(d.value)&&(J.stopPropagation(),C.setClickComponentStatus(!1),C.setInEditorStatus(!0),C.setCurComponent({component:null,index:null}))},qe=()=>{ne.value.canvasInit()},tt=(J=!0)=>{(l.value||s.value==="tab")&&(ge.value=!0,setTimeout(function(){k.value&&(y(),We(()=>{ne.value.canvasInit(),ne.value.afterInitOk(function(){ge.value=!1})})),C.setDataPrepareState(!0),De(d.value)&&J&&u.recordSnapshotCache("renderChart")},500))},$e=()=>{We(()=>{k.value&&(y(),We(()=>{ne.value.canvasSizeInit(),Te()}))})},Te=()=>{We(()=>{if(k.value){let J=k.value.clientWidth,ie=k.value.clientHeight;if(Y.value=Math.floor(J*100/i.value.width),G.value=Math.floor(ie*100/i.value.height),ve.value=Math.min(Y.value,G.value),gt()&&De(d.value)){const ye=O.value?4:1;C.setCanvasStyleScale(ve.value*ye)}}})},y=()=>{le.screenWidth=k.value.clientWidth-4,le.screenHeight=k.value.clientHeight,Q.value=le.screenWidth/U.value.x,K.value=le.screenHeight/U.value.y,ee.value=0,Se.value=0,oe.value=!0,De(d.value)&&C.setBashMatrixInfo({baseWidth:Q.value,baseHeight:K.value,baseMarginLeft:ee.value,baseMarginTop:Se.value})},W=J=>{ne.value.addItemBox(J)},D=J=>{setTimeout(()=>{J.canvasId=d.value,C.addComponent({component:J,index:void 0,isFromGroup:!0}),W(J),tt()},500)};Bt(()=>{window.addEventListener("resize",$e),Rn().listenTo(document.getElementById(o.value),()=>{$e()}),tt(),De(d.value)&&(te.on("handleNew",$),te.on("event-canvas-size-init",$e)),te.on("moveOutFromTab-"+d.value,D),te.on("matrix-canvasInit",tt)}),ia(()=>{De(d.value)&&(te.off("handleNew",$),te.off("event-canvas-size-init",$e)),te.off("moveOutFromTab-"+d.value,D),te.off("matrix-canvasInit",tt)});const q=()=>({baseWidth:Q.value,baseHeight:K.value}),L=(J=1)=>{setTimeout(()=>{var ie;b.value.scrollTo({top:(J-1)*K.value,behavior:"smooth"}),(ie=ne.value)==null||ie.watermarkUpdate()})},E=()=>{De(d.value)&&(C.mainScrollTop=b.value.scrollTop)};return Nt(()=>l.value,()=>{l.value&&$e()}),n({addItemBox:W,canvasInit:tt,canvasInitImmediately:qe,getBaseMatrixSize:q}),(J,ie)=>{const ye=dn;return c(),M("div",{ref_key:"canvasOut",ref:k,id:Re.value,class:rt(["content",{"render-active":ge.value}])},[m(ye,{"canvas-style-data":e(i),"component-data":e(g),"canvas-id":e(d)},null,8,["canvas-style-data","component-data","canvas-id"]),x("div",{id:o.value,ref_key:"canvasInner",ref:b,class:rt(["db-canvas",{"db-canvas-dashboard":!e(gt)()}]),style:Oe(re.value),onDrop:j,onDragover:ae,onMousedown:Ye,onScroll:E},[oe.value?(c(),B(Xn,{key:0,ref_key:"cyGridster",ref:ne,"component-data":e(g),"canvas-style-data":e(i),"canvas-view-info":e(v),"canvas-id":e(d),"base-margin-left":ee.value,"base-margin-top":Se.value,"base-width":Q.value,"base-height":K.value,"font-family":a.fontFamily,onScrollCanvasAdjust:L},null,8,["component-data","canvas-style-data","canvas-view-info","canvas-id","base-margin-left","base-margin-top","base-width","base-height","font-family"])):F("",!0)],46,cr)],10,ur)}}});const Kn=Ge(dr,[["__scopeId","data-v-f7395e19"]]),Oc=Object.freeze(Object.defineProperty({__proto__:null,default:Kn},Symbol.toStringTag,{value:"Module"})),vr=Ee({__name:"DeCustomTab",props:{hideTitle:Boolean,fontColor:String,activeColor:String,borderColor:String,borderActiveColor:String,styleType:{type:String,default:"",validator:a=>["","radioGroup"].includes(a)}},setup(a){const n=a,r=w(()=>[{"--de-font-color":n.fontColor},{"--de-active-color":n.activeColor},{"--de-border-color":n.borderColor},{"--de-border-active-color":n.borderActiveColor}]),i=w(()=>n.styleType?[n.styleType,n.fontColor&&"fontColor",n.activeColor&&"activeColor"]:[n.fontColor&&"fontColor",n.activeColor&&"activeColor",g.value?"noBorder":n.borderColor&&"borderColor",n.borderActiveColor&&"borderActiveColor",n.hideTitle&&"no-header"]),g=w(()=>n.borderColor==="none");return(v,d)=>{const l=Hn;return c(),B(l,ko({class:["de-tabs",...i.value],style:r.value},v.$attrs),{default:_(()=>[an(v.$slots,"default")]),_:3},16,["class","style"])}}});const pr={key:0},fr={class:"el-dropdown-link"},hr={class:"dialog-footer"},mr=Ee({__name:"Component",props:{canvasStyleData:{type:Object,required:!0},canvasViewInfo:{type:Object,required:!0},dvInfo:{type:Object,required:!0},element:{type:Object,default(){return{propValue:[]}}},isEdit:{type:Boolean,default:!1},showPosition:{type:String,required:!1,default:"canvas"},scale:{type:Number,required:!1,default:1},searchCount:{type:Number,required:!1,default:0},fontFamily:{type:String,required:!1,default:"inherit"}},setup(a){const n=ut(),r=oa(),{tabMoveInActiveId:i,bashMatrixInfo:g,editMode:v,mobileInPc:d}=lt(n),l=I(null);let s=null;const{t:o}=Ut(),C=a,{element:u,isEdit:U,showPosition:H,canvasStyleData:O,canvasViewInfo:k,dvInfo:b,scale:oe,searchCount:Y}=yt(C),G=w(()=>u.value.titleBackground.active.innerImage.replace("board/","").replace(".svg","")),ve=w(()=>u.value.titleBackground.inActive.innerImage.replace("board/","").replace(".svg","")),le=A=>{var Me;const{backgroundImageEnable:T,backgroundType:Ie,innerImage:He}=u.value.titleBackground.inActive;return ne.value!==A&&!u.value.titleBackground.multiply&&((Me=u.value.titleBackground)==null?void 0:Me.enable)&&T&&Ie==="innerImage"&&typeof He=="string"},Q=A=>{var Me;const{backgroundImageEnable:T,backgroundType:Ie,innerImage:He}=u.value.titleBackground.active;return(ne.value===A||u.value.titleBackground.multiply)&&((Me=u.value.titleBackground)==null?void 0:Me.enable)&&T&&Ie==="innerImage"&&typeof He=="string"},K=()=>{ee.hoverFlag=!0},ge=()=>{ee.hoverFlag=!1},ee=Kt({activeTabName:"",curItem:{},textarea:"",dialogVisible:!1,tabShow:!0,hoverFlag:!1}),Se=I(!1),ne=I(null),Re=I("none");let re;const $=w(()=>{var A,T;return u.value&&u.value.style&&((A=u.value.style)==null?void 0:A.showTabTitle)===!1?!1:(T=u.value.style)==null?void 0:T.showTabTitle}),j=w(()=>v.value==="edit"&&U.value&&!d.value),ae=gt()?"light":"dark",Ye=()=>{setTimeout(()=>{if(u.value.propValue.length>1){const A=document.getElementById("tab-"+u.value.propValue[u.value.propValue.length-1].name);Se.value=A.parentNode.clientWidth>l.value.clientWidth-100}else Se.value=!1})},qe=(A,T)=>({command:A,param:T}),tt=w(()=>b.value.type==="dashboard"&&O.value.dashboard.gap==="yes"?O.value.dashboard.gapSize:0);function $e(){ee.curItem.title=ee.textarea,ee.dialogVisible=!1,r.recordSnapshotCache("sureCurTitle")}function Te(){const T={name:qa(),title:o("visualization.new_tab"),componentData:[],closable:!0};u.value.propValue.push(T),ne.value=T.name,r.recordSnapshotCache("addTab")}function y(A){ee.curItem=A;let T=u.value.propValue.length;for(;T--;)if(u.value.propValue[T].name===A.name){u.value.propValue.splice(T,1);const Ie=(T-1+u.value.propValue.length)%u.value.propValue.length;ne.value=u.value.propValue[Ie].name,ee.tabShow=!1,We(()=>{ee.tabShow=!0})}}function W(A){Te();const T=u.value.propValue[u.value.propValue.length-1],Ie={},He=u.value.id+"--"+T.name;T.componentData=Uo(He,A.componentData,Ie),n.updateCopyCanvasView(Ie)}function D(A){ee.activeTabName=A.name,ee.curItem=A,ee.textarea=A.title,ee.dialogVisible=!0}function q(A){switch(A.command){case"editTitle":D(A.param);break;case"deleteCur":y(A.param),r.recordSnapshotCache("deleteCur");break;case"copyCur":W(A.param),r.recordSnapshotCache("copyCur");break}}const L=()=>{b.value.id&&sl(b.value.id).then(A=>{n.setNowPanelTrackInfo(A.data)})},E=A=>{u.value.propValue.forEach((T,Ie)=>{if(ne.value===T.name)if(gt()){const He=ll(A.id);if(He>-1){te.emit("removeMatrixItem-canvas-main",He),n.setCurComponent({component:null,index:null}),A.canvasId=u.value.id+"--"+T.name;const Me=re.refs["tabCanvas_"+Ie][0];if(Me){const R=Me.getBaseMatrixSize();wn(A,R),A.x=1,A.y=200,A.style.left=0,A.style.top=0,T.componentData.push(A),Me.addItemBox(A),We(()=>{Me.canvasInitImmediately()})}}}else{const He=il(A.id);n.deleteComponent(He),n.setCurComponent({component:null,index:null}),A.canvasId=u.value.id+"--"+T.name,Vo(A,u.value),T.componentData.push(A)}}),L()},J=A=>{gt()&&wn(A,g.value,!0),te.emit("removeMatrixItemById-"+A.canvasId,A.id),n.setCurComponent({component:null,index:null}),gt()?te.emit("moveOutFromTab-canvas-main",A):ie(A),L()},ie=A=>{const{left:T,top:Ie}=u.value.style;A.style.left=A.style.left+T,A.style.top=A.style.top+Ie,A.canvasId="canvas-main",n.addComponent({component:A,index:void 0,isFromGroup:!0})},ye=w(()=>i.value&&i.value===u.value.id),ze=w(()=>Se.value?"tab-head-left":"tab-head-"+u.value.style.headHorizontalPosition),we=A=>{if(A){const{backdropFilterEnable:T,backdropFilter:Ie,backgroundColorSelect:He,backgroundColor:Me,backgroundImageEnable:R,backgroundType:X,outerImage:be,innerPadding:Pe,borderRadius:_e}=A;let Ce={padding:Pe*oe.value+"px",borderRadius:_e+"px"},ue="";return He&&Me&&(ue=Me),R&&X==="outerImage"&&typeof be=="string"?Ce.background=`url(${rn(be)}) no-repeat ${ue}`:Ce["background-color"]=ue,T&&(Ce["backdrop-filter"]="blur("+Ie+"px)"),Ce}return{}},Ke=A=>{var Ie,He;let T={};return ne.value===A?(T={textDecoration:u.value.style.textDecoration,fontStyle:u.value.style.fontStyle,fontWeight:u.value.style.fontWeight,fontSize:(u.value.style.activeFontSize||18)+"px",lineHeight:(u.value.style.activeFontSize||18)+"px"},(Ie=u.value.titleBackground)!=null&&Ie.enable&&(T={...T,...we(u.value.titleBackground.active)})):(T={textDecoration:u.value.style.textDecoration,fontStyle:u.value.style.fontStyle,fontWeight:u.value.style.fontWeight,fontSize:(u.value.style.fontSize||16)+"px",lineHeight:(u.value.style.fontSize||16)+"px"},(He=u.value.titleBackground)!=null&&He.enable&&(T={...T,...we(u.value.titleBackground.multiply?u.value.titleBackground.active:u.value.titleBackground.inActive)})),T},pt=w(()=>u.value&&u.value.style&&u.value.style.headFontColor&&typeof u.value.style.headFontColor=="string"?u.value.style.headFontColor:"none"),dt=w(()=>u.value&&u.value.style&&u.value.style.headFontActiveColor&&typeof u.value.style.headFontActiveColor=="string"?u.value.style.headFontActiveColor:"none"),vt=w(()=>u.value&&u.value.style&&u.value.style.headBorderActiveColor&&typeof u.value.style.headBorderActiveColor=="string"?u.value.style.headBorderActiveColor:"none"),at=w(()=>!!ee.textarea&&!!ee.textarea.trim());Nt(()=>u.value,()=>{Ye()},{deep:!0});const ct=()=>{ee.tabShow=!1,We(()=>{ee.tabShow=!0})};Nt(()=>j.value,()=>{Et()});const Et=()=>{var A;if(s&&clearInterval(s),s=null,!j.value&&(A=u.value.carousel)!=null&&A.enable){const T=(u.value.carousel.time||5)*1e3;let Ie=1;s=setInterval(()=>{if(!ee.hoverFlag){const He=Ie%u.value.propValue.length;Ie++,We(()=>{ne.value=u.value.propValue[He].name})}},T)}};return Bt(()=>{u.value.propValue.length>0&&(ne.value=u.value.propValue[0].name),Ye(),["canvas","canvasDataV","edit"].includes(H.value)&&!d.value&&(te.on("onTabMoveIn-"+u.value.id,E),te.on("onTabMoveOut-"+u.value.id,J),te.on("onTabSortChange-"+u.value.id,ct)),re=kn(),Et(),We(()=>{pa(u.value)})}),ia(()=>{["canvas","canvasDataV","edit"].includes(H.value)&&!d.value&&(te.off("onTabMoveIn-"+u.value.id,E),te.off("onTabMoveOut-"+u.value.id,J),te.off("onTabSortChange-"+u.value.id,ct))}),Io(()=>{s&&(clearInterval(s),s=null)}),(A,T)=>{const Ie=Ha("ArrowDown"),He=Wt,Me=nn,R=on,X=ln,be=Dn,Pe=$o,_e=Tt,Ce=$a;return ee.tabShow?(c(),M("div",{key:0,style:{width:"100%",height:"100%"},class:rt([[ze.value,`ed-tabs-${e(ae)}`,{"title-hidde-tab":!$.value},{"title-show-tab":$.value}],"custom-tabs-head"]),ref_key:"tabComponentRef",ref:l},[m(vr,{modelValue:ne.value,"onUpdate:modelValue":T[1]||(T[1]=ue=>ne.value=ue),onTabAdd:Te,addable:j.value,"font-color":pt.value,"active-color":dt.value,"border-color":Re.value,"border-active-color":vt.value,"hide-title":!$.value},{default:_(()=>[(c(!0),M(st,null,$t(e(u).propValue,ue=>(c(),B(be,{key:ue.name,class:"el-tab-pane-custom",lazy:j.value,label:ue.title,name:ue.name},{label:_(()=>[x("div",{class:"custom-tab-title",onMousedown:T[0]||(T[0]=Yt(()=>{},["stop"]))},[x("span",{class:"title-inner",style:Oe(Ke(ue.name))},[Ae(N(ue.title)+" ",1),ot(m(Ea,{style:Oe({color:e(u).titleBackground.active.innerImageColor,pointerEvents:"none"}),name:G.value},null,8,["style","name"]),[[mt,Q(ue.name)]]),ot(m(Ea,{style:Oe({color:e(u).titleBackground.inActive.innerImageColor,pointerEvents:"none"}),name:ve.value},null,8,["style","name"]),[[mt,le(ue.name)]]),j.value?(c(),M("span",pr,[m(X,{"popper-class":"custom-de-tab-dropdown",effect:e(ae),trigger:"click",onCommand:q},{dropdown:_(()=>[m(R,{style:Oe({"font-family":a.fontFamily})},{default:_(()=>[m(Me,{command:qe("editTitle",ue)},{default:_(()=>[Ae(N(e(o)("visualization.edit_title")),1)]),_:2},1032,["command"]),m(Me,{command:qe("copyCur",ue)},{default:_(()=>[Ae(N(e(o)("visualization.copy")),1)]),_:2},1032,["command"]),e(u).propValue.length>1?(c(),B(Me,{key:0,command:qe("deleteCur",ue)},{default:_(()=>[Ae(N(e(o)("visualization.delete")),1)]),_:2},1032,["command"])):F("",!0)]),_:2},1032,["style"])]),default:_(()=>[x("span",fr,[e(U)?(c(),B(He,{key:0},{default:_(()=>[m(Ie)]),_:1})):F("",!0)])]),_:2},1032,["effect"])])):F("",!0)],4)],32)]),_:2},1032,["lazy","label","name"]))),128)),(c(!0),M(st,null,$t(e(u).propValue,(ue,f)=>(c(),M("div",{class:rt(["tab-content-custom",{"switch-hidden":ne.value!==ue.name}]),key:ue.name+"-content",onMouseenter:K,onMouseleave:ge},[e(U)&&!e(d)?(c(),B(Kn,{key:0,ref_for:!0,ref:"tabCanvas_"+f,"component-data":ue.componentData,"canvas-style-data":e(O),"canvas-view-info":e(k),"canvas-id":e(u).id+"--"+ue.name,class:rt(ye.value?"canvas-move-in":""),"canvas-position":"tab","canvas-active":ne.value===ue.name,"font-family":a.fontFamily},null,8,["component-data","canvas-style-data","canvas-view-info","canvas-id","class","canvas-active","font-family"])):(c(),B(cu,{key:1,ref_for:!0,ref:"dashboardPreview","dv-info":e(b),"cur-gap":tt.value,"component-data":ue.componentData,"canvas-style-data":{},"canvas-view-info":e(k),"canvas-id":e(u).id+"--"+ue.name,"preview-active":ne.value===ue.name,"show-position":e(H),"outer-scale":e(oe),"font-family":a.fontFamily,"outer-search-count":e(Y)},null,8,["dv-info","cur-gap","component-data","canvas-view-info","canvas-id","preview-active","show-position","outer-scale","font-family","outer-search-count"]))],34))),128))]),_:1},8,["modelValue","addable","font-color","active-color","border-color","border-active-color","hide-title"]),m(Ce,{title:"编辑标题","append-to-body":!0,modelValue:ee.dialogVisible,"onUpdate:modelValue":T[4]||(T[4]=ue=>ee.dialogVisible=ue),width:"30%","show-close":!1,"close-on-click-modal":!1,center:""},{footer:_(()=>[x("span",hr,[m(_e,{onClick:T[3]||(T[3]=ue=>ee.dialogVisible=!1)},{default:_(()=>T[5]||(T[5]=[Ae("取消")])),_:1}),m(_e,{disabled:!at.value,type:"primary",onClick:$e},{default:_(()=>T[6]||(T[6]=[Ae("确认")])),_:1},8,["disabled"])])]),default:_(()=>[m(Pe,{modelValue:ee.textarea,"onUpdate:modelValue":T[2]||(T[2]=ue=>ee.textarea=ue),maxlength:"50",placeholder:A.$t("dataset.input_content")},null,8,["modelValue","placeholder"])]),_:1},8,["modelValue"])],2)):F("",!0)}}});const Jn=Ge(mr,[["__scopeId","data-v-80538cf1"]]),zc=Object.freeze(Object.defineProperty({__proto__:null,default:Jn},Symbol.toStringTag,{value:"Module"})),gr={class:"svg-triangle-container"},yr={version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg"},_r=["points","stroke","fill","stroke-width"],Cr=Ee({__name:"Component",props:{propValue:{type:String,required:!0,default:""},element:{type:Object,default(){return{propValue:null}}}},setup(a){const n=a,{element:r}=yt(n),i=I("");Nt(()=>r.value.style.width,()=>{v()}),Nt(()=>r.value.style.height,()=>{v()}),Bt(()=>{v()});const g=w(()=>r.value.style.borderActive?r.value.style.borderWidth:0),v=()=>{const{width:l,height:s}=r.value.style;d(l,s)},d=(l,s)=>{const C=[[.5,.05],[1,.95],[0,.95]].map(u=>l*u[0]+" "+s*u[1]);i.value=C.toString()};return(l,s)=>(c(),M("div",gr,[(c(),M("svg",yr,[x("polygon",{ref:"star",points:i.value,stroke:e(r).style.borderColor,fill:e(r).style.backgroundColor,"stroke-width":g.value},null,8,_r)]))]))}});const wr=Ge(Cr,[["__scopeId","data-v-187d9b06"]]),br={class:"attr-list de-collapse-style"},xr=Ee({__name:"Attr",setup(a){const n=ut(),{curComponent:r}=lt(n);return(i,g)=>(c(),M("div",br,[m(Fl,{element:e(r)},null,8,["element"])]))}}),Sr={key:0,class:"main-frame"},kr=["id","src"],Ir={key:1,class:"frame-mask edit-mask"},Mr={style:{opacity:"1"}},Vr={style:{"font-weight":"bold",color:"lawngreen"}},Dr={key:2,class:"frame-mask preview-top-mask"},Hr={key:3,class:"frame-mask preview-right-mask"},Fr={key:4,class:"frame-mask preview-left-mask"},Lr={key:5,class:"frame-mask"},Ar={key:1,class:"info-class"},Er=Ee({__name:"ComponentFrame",props:{propValue:{type:String,require:!0},element:{type:Object},isEdit:{type:Boolean,require:!1,default:!0},active:{type:Boolean,require:!1,default:!1},screenShot:{type:Boolean,default:!1}},setup(a){const n=ut();lt(n);const{t:r}=Ut(),i=a,{propValue:g,element:v,isEdit:d,active:l,screenShot:s}=yt(i),o=Kt({pOption:{},frameShow:!0}),C=()=>{o.frameShow=!1,We(()=>{o.frameShow=!0})};return Bt(()=>{ke({name:"frameLinksChange-"+v.value.id,callback:function(){C()}})}),(u,U)=>{const H=Fn;return c(),B(H,{class:"main-frame"},{default:_(()=>[e(v).frameLinks.src?(c(),M("div",Sr,[o.frameShow?(c(),M("iframe",{key:0,id:"iframe-"+e(v).id,src:e(v).frameLinks.src,scrolling:"auto",frameborder:"0",class:"main-frame main-de-iframe"},null,8,kr)):F("",!0),e(d)?(c(),M("div",Ir,[x("span",Mr,[x("span",Vr,N(e(r)("visualization.edit_web_tips")),1)])])):F("",!0),e(d)?(c(),M("div",Dr)):F("",!0),e(d)?(c(),M("div",Hr)):F("",!0),e(d)?(c(),M("div",Fr)):F("",!0),e(s)?(c(),M("div",Lr)):F("",!0)])):(c(),M("div",Ar,[x("span",null,N(e(r)("visualization.link_add_tips_pre")),1)]))]),_:1})}}});const Pr=Ge(Er,[["__scopeId","data-v-959d3565"]]),Qn={VText:Do,VQuery:Fo,VTextAttr:Lo,Group:Yn,GroupAttr:ml,UserView:gl,UserViewAttr:yl,Picture:_l,PictureAttr:Cl,CanvasBoard:ul,CanvasBoardAttr:wl,CanvasIcon:bl,CanvasIconAttr:xl,DeTabs:Jn,DeTabsAttr:Sl,DeGraphical:kl,DeGraphicalAttr:Il,CircleShape:Ml,CircleShapeAttr:Vl,RectShape:Dl,RectShapeAttr:Hl,SvgTriangle:wr,SvgTriangleAttr:xr,DeTimeClock:Ll,DeTimeClockAttr:Al,GroupArea:El,GroupAreaAttr:Pl,DeFrame:Pr,DeFrameAttr:Bl,DeVideo:Ol,DeVideoAttr:zl,DeStreamMedia:Tl,DeStreamMediaAttr:$l,ScrollText:Gl,ScrollTextAttr:Rl,PopArea:Za,PopAreaAttr:ql,PictureGroup:Zl,PictureGroupAttr:Wl};function Da(a){return Qn[a]}function Tc(a){const n=a.component==="UserView"&&a.innerType==="picture-group"?"PictureGroupAttr":a.component+"Attr";return Qn[n]}const Br=Mn("viewSelectorStore",{state:()=>({enable:!1,viewIdList:[]}),getters:{getEnable(){return this.enable},getViewIdList(){return this.viewIdList}},actions:{setEnable(a){this.enable=a},remove(a){let n=this.viewIdList.length;if(n){if(!a){this.viewIdList=[];return}for(;n--;)this.viewIdList[n]===a&&this.viewIdList.splice(n,1)}},add(a){this.viewIdList.includes(a)||this.viewIdList.push(a)},clear(){this.enable=!1,this.viewIdList=[]}}}),Or=()=>Br(Pn),zr={class:"bar-main"},Tr=Ee({__name:"ComponentSelector",props:{resourceId:{type:String,required:!1}},setup(a){const n=Or(),r=I(!1),i=a;Bt(()=>{r.value=n.getViewIdList.includes(i.resourceId)});const g=v=>{v?n.add(i.resourceId):n.remove(i.resourceId)};return(v,d)=>{const l=Vn;return c(),M("div",zr,[m(l,{modelValue:r.value,"onUpdate:modelValue":d[0]||(d[0]=s=>r.value=s),onChange:g},null,8,["modelValue"])])}}});const $r=Ge(Tr,[["__scopeId","data-v-a80ff16a"]]),Gr=["id"],Rr=Ee({__name:"ComponentWrapper",props:{active:{type:Boolean,default:!1},popActive:{type:Boolean,default:!1},canvasStyleData:{type:Object,required:!0},canvasViewInfo:{type:Object,required:!0},dvInfo:{type:Object,required:!0},config:{type:Object,required:!0,default(){return{component:null,propValue:null,request:null,linkage:null,type:null,events:null,style:null,id:null,animations:null}}},viewInfo:{type:Object,required:!1},index:{required:!0,type:[Number,String],default:0},showPosition:{required:!1,type:String,default:"preview"},canvasId:{type:String,default:"canvas-main"},searchCount:{type:Number,required:!1,default:0},scale:{type:Number,required:!1,default:100},isSelector:{type:Boolean,default:!1},suffixId:{type:String,required:!1,default:"common"},fontFamily:{type:String,required:!1,default:"inherit"},optType:{type:String,required:!1}},emits:["userViewEnlargeOpen","datasetParamsInit","onPointClick"],setup(a,{emit:n}){Nl();const r=I(null),i=I(null),g=ut(),v=I(!1);Jo("localStorage");const d=["width","height","top","left","rotate"],l=["width","height","top","left","rotate","borderActive","borderWidth","borderRadius","borderStyle","borderColor"],s=a,{config:o,showPosition:C,index:u,canvasStyleData:U,canvasViewInfo:H,dvInfo:O,searchCount:k,scale:b,suffixId:oe}=yt(s),Y=I(null),G=n,ve="wrapper-outer-id-"+o.value.id,le=w(()=>"enlarge-inner-content-"+o.value.id),Q=()=>{ke().emitter.emit("l7-prepare-picture",o.value.id),v.value=!0,setTimeout(()=>{const y=r.value;_a(le.value,"canvas-main",b.value/100),En("img",y,"图表",()=>{$n(le.value),v.value=!1,ke().emitter.emit("l7-unprepare-picture",o.value.id)})},1e3)},K=y=>{C.value.includes("multiplexing")&&(i.value.multiplexingCheckOut(),y.stopPropagation(),y.preventDefault()),(C.value.includes("popEdit")||g.mobileInPc)&&ge()};Bt(()=>{var W;const y="componentImageDownload-"+o.value.id;(W=ke().emitter.all.get(y))!=null&&W.length||ke().emitter.on(y,()=>{Q()})});const ge=y=>{te.emit("componentClick"),g.setInEditorStatus(!0),g.setClickComponentStatus(!0),g.setCurComponent({component:o.value,index:u.value})},ee=y=>o.value.component.includes("Svg")?La(y,["top","left","width","height","rotate","backgroundColor","borderWidth","borderStyle","borderColor"]):La(y,y.borderActive?d:l),Se=()=>{te.emit("v-hover",o.value.id)},ne=w(()=>{if(o.value.commonBackground){const{backdropFilterEnable:y,backdropFilter:W,backgroundColorSelect:D,backgroundColor:q,backgroundImageEnable:L,backgroundType:E,outerImage:J,innerPadding:ie,borderRadius:ye}=o.value.commonBackground;let ze={padding:ie*$e.value+"px",borderRadius:ye+"px"},we="";return D&&q&&(we=q),L&&E==="outerImage"&&typeof J=="string"?ze.background=`url(${rn(J)}) no-repeat ${we}`:ze["background-color"]=we,o.value.component!=="UserView"&&(ze.overflow="hidden"),y&&(ze["backdrop-filter"]="blur("+W+"px)"),ze}return{}}),Re=w(()=>{const{backgroundImageEnable:y,backgroundType:W,innerImage:D}=o.value.commonBackground;return y&&W==="innerImage"&&typeof D=="string"}),re=w(()=>Re.value?o.value.commonBackground.innerImage.replace("board/","").replace(".svg",""):null),$=w(()=>{var y;if(o.value.multiDimensional&&((y=o.value.multiDimensional)!=null&&y.enable)){const W=o.value.style.width,D=o.value.style.height,q=o.value.multiDimensional.x,L=o.value.multiDimensional.y,E=q*Math.PI/180,J=L*Math.PI/180,ie=Math.abs(W*Math.cos(J))+Math.abs(D*Math.sin(E)),ye=Math.abs(D*Math.cos(E))+Math.abs(W*Math.sin(J)),ze=(ie-W)/2;return{padding:`${(ye-D)/2}px ${ze}px`,transform:`rotateX(${o.value.multiDimensional.x}deg) rotateY(${o.value.multiDimensional.y}deg) rotateZ(${o.value.multiDimensional.z}deg)`}}else return{}}),j=y=>{G("onPointClick",y)},ae=w(()=>C.value.includes("preview")&&(["Picture","CanvasIcon","CircleShape","SvgTriangle","RectShape","ScrollText"].includes(o.value.component)||["indicator","rich-text"].includes(o.value.innerType))&&o.value.events&&o.value.events.checked&&(gt()||!gt()&&!fa())),Ye=y=>{if(ae.value&&C.value!=="canvas-multiplexing"){if(o.value.events.type==="showHidden")We(()=>{g.popAreaActiveSwitch()});else if(o.value.events.type==="jump"){const W=o.value.events.jump.value,D=o.value.events.jump.type;try{D==="newPop"?(console.info("DataEase Component Jump newPop value:"+window.originOpen),window.originOpen?(console.info("DataEase Component originOpen newPop"),window.originOpen(W,"_blank","width=800,height=600,left=200,top=100,toolbar=no,scrollbars=yes,resizable=yes,location=no")):window.open(W,"_blank","width=800,height=600,left=200,top=100,toolbar=no,scrollbars=yes,resizable=yes,location=no")):D==="_blank"?(console.info("DataEase Component Jump _blank value:"+window.originOpen),window.originOpen?(console.info("DataEase Component originOpen _blank"),window.originOpen(W,"_blank")):window.open(W,"_blank")):tt(window.open(W,D))}catch{console.warn("url 格式错误:"+W)}}else o.value.events.type==="refreshDataV"?ke().emitter.emit("componentRefresh"):o.value.events.type==="fullScreen"?ke().emitter.emit("canvasFullscreen"):o.value.events.type==="download"&&ke().emitter.emit("canvasDownload");y.preventDefault(),y.stopPropagation()}},qe=I(null),tt=y=>{if(qe!=null&&qe.value){const W={methodName:"initOpenHandler",args:y};qe.value.invokeMethod(W)}},$e=w(()=>b.value/100),Te=w(()=>s.popActive||g.mobileInPc&&s.active);return(y,W)=>{var q,L,E,J,ie;const D=za("loading");return ot((c(),M("div",{class:rt(["wrapper-outer",e(C)+"-"+e(o).component]),id:ve,onMousedown:K,onMouseenter:Se,"element-loading-text":"导出中...","element-loading-background":"rgba(255, 255, 255, 1)"},[!e(C).includes("canvas")&&!s.isSelector?(c(),B(Un,{key:0,class:rt(["wrapper-edit-bar",{"wrapper-edit-bar-active":a.active}]),ref_key:"componentEditBarRef",ref:i,"canvas-id":a.canvasId,index:e(u),element:e(o),"show-position":e(C),onUserViewEnlargeOpen:W[0]||(W[0]=ye=>G("userViewEnlargeOpen",ye)),onDatasetParamsInit:W[1]||(W[1]=()=>G("datasetParamsInit"))},null,8,["canvas-id","index","element","show-position","class"])):F("",!0),s.isSelector&&e(o).component==="UserView"&&((q=e(o).propValue)==null?void 0:q.innerType)!=="rich-text"?(c(),B($r,{key:1,"resource-id":e(o).id},null,8,["resource-id"])):F("",!0),x("div",{class:"wrapper-inner",ref_key:"componentWrapperInnerRef",ref:r,id:le.value,style:Oe(ne.value)},[x("div",{class:rt(["wrapper-inner-adaptor",{"pop-wrapper-inner":Te.value,"event-active":ae.value}]),style:Oe($.value),onMousedown:Ye},[(c(),B(ha(e(Da)(e(o).component)),{view:a.viewInfo,ref_key:"component",ref:Y,class:"component","canvas-style-data":e(U),"opt-type":a.optType,"dv-info":e(O),"dv-type":e(O).type,"canvas-view-info":e(H),style:Oe(ee((L=e(o))==null?void 0:L.style)),"prop-value":(E=e(o))==null?void 0:E.propValue,element:e(o),request:(J=e(o))==null?void 0:J.request,linkage:(ie=e(o))==null?void 0:ie.linkage,"show-position":e(C),"search-count":e(k),scale:$e.value,disabled:!0,"is-edit":!1,"suffix-id":e(oe),"font-family":a.fontFamily,onOnPointClick:j},null,40,["view","canvas-style-data","opt-type","dv-info","dv-type","canvas-view-info","style","prop-value","element","request","linkage","show-position","search-count","scale","suffix-id","font-family"]))],38),Re.value?(c(),B(Ea,{key:0,style:Oe({color:e(o).commonBackground.innerImageColor,pointerEvents:"none"}),name:re.value},null,8,["style","name"])):F("",!0)],12,Gr),m(e(Ga),{ref_key:"openHandler",ref:qe,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)],34)),[[D,v.value]])}}});const Wa=Ge(Rr,[["__scopeId","data-v-dfe9d997"]]),qr=Ee({__name:"DeFullscreen",props:{themes:{type:String,default:"light"},componentType:{type:String,default:"button"},showPosition:{required:!1,type:String,default:"preview"}},setup(a,{expose:n}){const r=ut(),i=a;yt(i);const g=()=>{const l=!!document.fullscreenElement;r.setFullscreenFlag(l),i.showPosition==="edit"&&r.setEditMode(l?"preview":"edit"),i.showPosition==="dvEdit"&&ke().emitter.emit("canvasScrollRestore")},v=()=>{const l=document.querySelector("body");document.fullscreenElement?document.exitFullscreen():l==null||l.requestFullscreen()},d=l=>{l.key==="Escape"&&document.fullscreenElement&&document.exitFullscreen()};return Bt(()=>{document.addEventListener("fullscreenchange",g),document.addEventListener("keydown",d)}),ia(()=>{document.removeEventListener("fullscreenchange",g),document.removeEventListener("keydown",d)}),n({toggleFullscreen:v}),(l,s)=>(c(),M("span"))}}),Zr={width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"};function Wr(a,n){return c(),M("svg",Zr,n[0]||(n[0]=[x("path",{d:"M2.85738 4.85729L9.98911 11.989L2.85738 19.1207C2.66212 19.316 2.66212 19.6326 2.85738 19.8279L3.56449 20.535C3.75975 20.7302 4.07634 20.7302 4.2716 20.535L12.1104 12.6961C12.501 12.3056 12.501 11.6724 12.1104 11.2819L4.2716 3.44308C4.07634 3.24782 3.75975 3.24782 3.56449 3.44308L2.85738 4.15018C2.66212 4.34545 2.66212 4.66203 2.85738 4.85729Z"},null,-1),x("path",{d:"M11.7431 4.85729L18.8749 11.989L11.7431 19.1207C11.5479 19.316 11.5479 19.6326 11.7431 19.8279L12.4502 20.535C12.6455 20.7302 12.9621 20.7302 13.1573 20.535L20.9962 12.6961C21.3867 12.3056 21.3867 11.6724 20.9962 11.2819L13.1573 3.44308C12.9621 3.24782 12.6455 3.24782 12.4502 3.44308L11.7431 4.15018C11.5479 4.34545 11.5479 4.66203 11.7431 4.85729Z"},null,-1)]))}const Nr={render:Wr},Ur={width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"};function jr(a,n){return c(),M("svg",Ur,n[0]||(n[0]=[x("path",{d:"M12.2496 19.1355L5.11783 12.0038L12.2496 4.87206C12.4448 4.6768 12.4448 4.36022 12.2496 4.16495L11.5424 3.45785C11.3472 3.26259 11.0306 3.26259 10.8353 3.45785L2.99651 11.2967C2.60598 11.6872 2.60598 12.3204 2.99651 12.7109L10.8353 20.5497C11.0306 20.745 11.3472 20.745 11.5424 20.5497L12.2496 19.8426C12.4448 19.6474 12.4448 19.3308 12.2496 19.1355Z"},null,-1),x("path",{d:"M21.1497 19.1355L14.018 12.0038L21.1497 4.87206C21.345 4.6768 21.345 4.36022 21.1497 4.16495L20.4426 3.45785C20.2473 3.26259 19.9307 3.26259 19.7355 3.45785L11.8967 11.2967C11.5061 11.6872 11.5061 12.3204 11.8967 12.7109L19.7355 20.5497C19.9307 20.745 20.2473 20.745 20.4426 20.5497L21.1497 19.8426C21.345 19.6474 21.345 19.3308 21.1497 19.1355Z"},null,-1)]))}const Xr={render:jr},Yr={width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"};function Kr(a,n){return c(),M("svg",Yr,n[0]||(n[0]=[x("path",{d:"M9.00839 13.9974C9.28453 13.9974 9.53453 14.1093 9.71549 14.2903C9.89646 14.4712 10.0084 14.7212 10.0084 14.9974V20.1572C10.0084 20.4333 9.78453 20.6572 9.50839 20.6572H8.50839C8.23224 20.6572 8.00839 20.4333 8.00839 20.1572V17.4974L4.09289 21.4116C3.89762 21.6069 3.58104 21.6069 3.38578 21.4116L2.67867 20.7045C2.48341 20.5092 2.48341 20.1927 2.67867 19.9974L6.68001 15.9974H3.83559C3.55945 15.9974 3.33559 15.7735 3.33559 15.4974V14.4974C3.33559 14.2212 3.55945 13.9974 3.83559 13.9974H9.00839ZM19.919 2.58865C20.1142 2.39338 20.4308 2.39338 20.6261 2.58865L21.3332 3.29575C21.5284 3.49102 21.5284 3.8076 21.3332 4.00286L17.3318 8.00286H20.1763C20.4524 8.00286 20.6763 8.22672 20.6763 8.50286V9.50286C20.6763 9.779 20.4524 10.0029 20.1763 10.0029H15.0035C14.7273 10.0029 14.4773 9.89093 14.2964 9.70997C14.1154 9.529 14.0035 9.279 14.0035 9.00286V3.84309C14.0035 3.56695 14.2273 3.34309 14.5035 3.34309H15.5035C15.7796 3.34309 16.0035 3.56695 16.0035 3.84309V6.50281L19.919 2.58865Z"},null,-1)]))}const Jr={render:Kr},Qr={width:"20",height:"20",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"};function eu(a,n){return c(),M("svg",Qr,n[0]||(n[0]=[x("path",{d:"M7.1518 11.5968C7.31452 11.4341 7.57834 11.4341 7.74106 11.5968L8.33031 12.186C8.49303 12.3487 8.49303 12.6126 8.33031 12.7753L4.99587 16.1086H7.36621C7.59633 16.1086 7.78288 16.2952 7.78288 16.5253V17.3586C7.78288 17.5887 7.59633 17.7753 7.36621 17.7753H3.05555C2.82544 17.7753 2.6171 17.682 2.4663 17.5312C2.3155 17.3804 2.22222 17.1721 2.22222 16.9419V12.6421C2.22222 12.412 2.40877 12.2255 2.63889 12.2255H3.47222C3.70234 12.2255 3.88889 12.412 3.88889 12.6421V14.8586L7.1518 11.5968ZM16.9367 2.22217C17.1668 2.22217 17.3751 2.31544 17.5259 2.46625C17.6767 2.61705 17.77 2.82538 17.77 3.0555V7.35531C17.77 7.58543 17.5835 7.77198 17.3533 7.77198H16.52C16.2899 7.77198 16.1033 7.58543 16.1033 7.35531V5.13888L12.8404 8.40068C12.6777 8.5634 12.4139 8.5634 12.2512 8.40068L11.6619 7.81142C11.4992 7.6487 11.4992 7.38489 11.6619 7.22217L14.9964 3.88883H12.626C12.3959 3.88883 12.2094 3.70229 12.2094 3.47217V2.63883C12.2094 2.40872 12.3959 2.22217 12.626 2.22217H16.9367Z"},null,-1)]))}const tu={render:eu},au={class:"bar-first"},nu={class:"bar-content"},ou={class:"link-icon-active"},lu={class:"link-icon-active"},iu={id:"fullscreenElement",class:"link-icon-active",style:{"padding-right":"4px"}},su=Ee({__name:"LinkOptBar",props:{canvasStyleData:{type:Object,required:!0}},setup(a){var H;const n=ut(),r=a,{canvasStyleData:i}=yt(r),{fullscreenFlag:g}=lt(n),{t:v}=Ut(),d=Kt({fullscreenElement:null,barActive:!1,fullWidth:((H=en.currentRoute.value.query)==null?void 0:H.fromLink)==="true"?126:94}),l=w(()=>{var k,b;let O="link-bar-main-light";return((b=(k=i.value)==null?void 0:k.dashboard)==null?void 0:b.themeColor)==="dark"&&(O="link-bar-main-dark"),O}),s=w(()=>{var O;return((O=en.currentRoute.value.query)==null?void 0:O.fromLink)==="true"}),o=()=>{d.barActive=!d.barActive},C=()=>{document.fullscreenElement?document.exitFullscreen().catch(O=>{console.error("Exit fullscreen failed:",O)}):ke().emitter.emit("canvasFullscreen")},u=()=>{const O=localStorage.getItem("beforeJumpUrl");localStorage.removeItem("beforeJumpUrl"),window.location.href=O,window.location.reload()},U=()=>{ke().emitter.emit("canvasDownload","pdf")};return(O,k)=>{const b=ta;return c(),M("div",{id:"fullscreenElement",ref:"widget-div",class:rt(["link-bar-main bar-light",[{"link-bar-main-active":d.barActive},l.value]]),style:Oe({"--fullWidth":d.fullWidth+"px","--fullContent":28-d.fullWidth+"px","--firstHoveMove":32-d.fullWidth+"px"})},[x("div",au,[m(b,{content:d.barActive?e(v)("visualization.fold"):e(v)("visualization.expand")},{default:_(()=>[m(e(Wt),{style:{width:"16px",height:"16px"},onClick:o},{default:_(()=>[d.barActive?(c(),B(At,{key:0,name:"icon_down_right_outlined"},{default:_(()=>[m(e(Nr))]),_:1})):(c(),B(At,{key:1,name:"icon_up_left_outlined"},{default:_(()=>[m(e(Xr))]),_:1}))]),_:1})]),_:1},8,["content"])]),x("div",nu,[k[0]||(k[0]=x("div",{class:"bar-diver"},null,-1)),ot(x("div",ou,[m(b,{content:e(v)("visualization.back_parent")},{default:_(()=>[m(e(Wt),{style:{width:"16px",height:"16px"},onClick:u},{default:_(()=>[m(At,{name:"icon_left_outlined"},{default:_(()=>[m(e(jl),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])],512),[[mt,s.value]]),x("div",lu,[m(b,{content:e(v)("visualization.export_pdf")},{default:_(()=>[m(e(Wt),{style:{width:"16px",height:"16px"},onClick:U},{default:_(()=>[m(At,{name:"icon_download_outlined"},{default:_(()=>[m(e(da),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])]),x("div",iu,[m(b,{content:e(g)?e(v)("visualization.ext_fullscreen"):e(v)("visualization.fullscreen")},{default:_(()=>[m(e(Wt),{style:{width:"16px",height:"16px"},onClick:C},{default:_(()=>[e(g)?(c(),B(At,{key:0,name:"icon_minify_outlined"},{default:_(()=>[m(e(Jr),{class:"svg-icon"})]),_:1})):(c(),B(At,{key:1,name:"icon_magnify_outlined"},{default:_(()=>[m(e(tu),{class:"svg-icon"})]),_:1}))]),_:1})]),_:1},8,["content"])])])],6)}}});const ru=Ge(su,[["__scopeId","data-v-d23024e1"]]),uu=Ee({__name:"DePreview",props:{canvasStyleData:{type:Object,required:!0},componentData:{type:Object,required:!0},canvasViewInfo:{type:Object,required:!0},dvInfo:{type:Object,required:!0},canvasId:{type:String,required:!1,default:"canvas-main"},showPosition:{required:!1,type:String,default:"preview"},previewActive:{type:Boolean,default:!0},downloadStatus:{type:Boolean,default:!1},userId:{type:String,require:!1},outerScale:{type:Number,required:!1,default:1},outerSearchCount:{type:Number,required:!1,default:0},isSelector:{type:Boolean,default:!1},showPopBar:{type:Boolean,default:!1},fontFamily:{type:String,required:!1,default:"inherit"}},emits:["onResetLayout"],setup(a,{expose:n,emit:r}){const i=ut(),{pcMatrixCount:g,curComponent:v,mobileInPc:d,canvasState:l,inMobile:s}=lt(i),o=I(null),C=I(null),u=r,U=I(null),H=I(!1),O=Xl(),k=a,{canvasStyleData:b,componentData:oe,dvInfo:Y,canvasId:G,canvasViewInfo:ve,showPosition:le,previewActive:Q,downloadStatus:K,outerScale:ge,outerSearchCount:ee,showPopBar:Se,fontFamily:ne}=yt(k),Re="preview-"+G.value,re=I(100),$=I(100),j=I(100),ae=I(null),Ye=I(10),qe=I(10),tt=I(null),$e=I(0),Te=I(null),y=I(!1),W=w(()=>Y.value.type==="dashboard"),D=Kt({initState:!0}),q=w(()=>ee.value+$e.value),L=w(()=>{var f;return((f=b.value)==null?void 0:f.screenAdaptor)!=="full"}),E=w(()=>{var f;return gt()&&((f=b.value)==null?void 0:f.dashboardAdaptor)==="withWidth"}),J=w(()=>{var f;return!!((f=en.currentRoute.value.query)!=null&&f.report)}),ie=w(()=>oe.value.filter(f=>f.category&&f.category==="hidden"&&(!(f!=null&&f.dashboardHidden)||(f==null?void 0:f.dashboardHidden)&&fa()))),ye=w(()=>oe.value.filter(f=>(f==null?void 0:f.category)!=="hidden"&&f.component!=="GroupArea"&&(!(f!=null&&f.dashboardHidden)||(f==null?void 0:f.dashboardHidden)&&fa()))),ze=w(()=>{var ce,se,Ue,Je,Be,Dt,Ze,de;let f={};return De(G.value)&&!gt()&&(f.overflowY="hidden !important"),b.value&&b.value.width&&De(G.value)&&(f=Ta(b.value),((ce=b.value)==null?void 0:ce.screenAdaptor)==="keep"?(f.height=((se=b.value)==null?void 0:se.height)+"px",f.width=((Ue=b.value)==null?void 0:Ue.width)+"px",f.margin="auto"):(f.height=W.value?K.value?we():"100%":!((Je=b.value)!=null&&Je.screenAdaptor)||((Be=b.value)==null?void 0:Be.screenAdaptor)==="widthFirst"?Aa((Dt=b.value)==null?void 0:Dt.height,j.value)+"px":"100%",f.width=!W.value&&((Ze=b.value)==null?void 0:Ze.screenAdaptor)==="heightFirst"?Aa((de=b.value)==null?void 0:de.width,$.value)+"px":"100%")),f}),we=()=>{var se;if(!((se=ae.value)!=null&&se.childNodes))return We(()=>{ze.value.height=we()}),"100%";const f=ae.value.childNodes;let ce=0;return f.forEach(Ue=>{const Je=(Ue.offsetHeight||0)+(Ue.offsetTop||0);Je>ce&&(ce=Je)}),`${ce}px!important`};Nt(()=>Q.value,()=>{Q.value&&pt()}),ke({name:"tabCanvasChange-"+G.value,callback:function(){pt()}}),ke({name:"componentRefresh",callback:function(){De(G.value)&&ct()}}),ke({name:"canvasFullscreen",callback:function(){De(G.value)&&U.value.toggleFullscreen()}});const Ke=()=>{K.value||We(()=>{var f,ce,se;if(ae.value){let Ue=ae.value.clientWidth,Je=ae.value.clientHeight;if(re.value=Ue*100/b.value.width,E.value?$.value=re.value*.7:$.value=Je*100/b.value.height,j.value=gt()&&!E.value?Math.floor(Math.min(re.value,$.value)):re.value,W.value)Ye.value=Ue/g.value.x,E.value?qe.value=Ye.value*1.6:qe.value=Je/g.value.y,j.value=De(G.value)?j.value*1.2:ge.value*100;else{const Be=L.value?j.value:$.value;Yl(ye.value,b.value,j.value||ge.value*100,Be||ge.value*100,ge.value*100),j.value=De(G.value)?j.value:ge.value*100}y.value=!0,u("onResetLayout"),H.value=!1,((f=ae.value)==null?void 0:f.clientHeight)-((se=(ce=ae.value)==null?void 0:ce.parentNode)==null?void 0:se.clientHeight)>0&&(H.value=!0)}})},pt=()=>{J.value||Ke()},dt=f=>In(f,{dvModel:Y.value.type,cellWidth:Ye.value,cellHeight:qe.value,curGap:vt.value}),vt=w(()=>{var f,ce,se;return W.value&&((f=i.canvasStyleData.dashboard)==null?void 0:f.gap)==="yes"?(se=(ce=i.canvasStyleData)==null?void 0:ce.dashboard)==null?void 0:se.gapSize:0}),at=()=>{if(b.value.refreshViewEnable&&le.value==="preview"){$e.value=0,Te.value&&clearInterval(Te.value);let f=3e5;b.value.refreshTime&&b.value.refreshTime>0&&(b.value.refreshUnit==="second"?f=b.value.refreshTime*1e3:f=b.value.refreshTime*6e4),Te.value=setInterval(()=>{ct()},f)}},ct=()=>{$e.value++,De(G.value)&&rl(Y.value.id,Y.value.type)},Et=(f="preview-canvas-main")=>{Y.value.watermarkInfo&&De(G.value)&&!K.value&&_a(f,G.value,j.value/100)},A=f=>{const ce=f.data;console.info("Received Message: "+JSON.stringify(ce)),(ce==null?void 0:ce.targetSourceId)===Y.value.id+""&&De(G.value)&&(ce.type==="attachParams"?Ie(ce):ce.type==="webParams"&&T(ce))},T=f=>{const ce=f.params;i.addWebParamsFilter(ce,ye.value)},Ie=f=>{const ce=f.params;D.initState=!1,i.addOuterParamsFilter(ce,ye.value,"outer"),D.initState=!0};Bt(()=>{at(),Ke(),window.addEventListener("resize",pt),Rn().listenTo(document.getElementById(Re),()=>{pt(),Et()}),window.addEventListener("message",A)}),ia(()=>{i.canvasStateChange({key:"curPointArea",value:"base"}),clearInterval(Te.value),window.removeEventListener("message",A)});const He=(f,ce)=>{tt.value.dialogInit(b.value,ve.value[ce.id],ce,f,{scale:j.value/100})},Me=()=>{le.value!=="viewDialog"&&(i.setCurComponent({component:null,index:null}),(!v.value||v.value&&v.value.category!=="hidden")&&i.canvasStateChange({key:"curPointArea",value:"base"}))},R=f=>{try{if(console.info("de_inner_params send"),window["dataease-embedded-host"]&&(o!=null&&o.value)){const ce={methodName:"embeddedInteractive",args:{eventName:"de_inner_params",args:f}};o.value.invokeMethod(ce)}else{console.info("de_inner_params send to host");const ce={type:"dataease-embedded-interactive",eventName:"de_inner_params",args:f};window.parent.postMessage(ce,"*")}}catch{console.warn("de_inner_params send error")}},X=w(()=>{var f;return((f=b.value)==null?void 0:f.popupAvailable)&&De(G.value)}),be=w(()=>X.value&&ie.value&&ie.value.length>0&&!s.value&&b.value.popupButtonAvailable),Pe=f=>{var ce;(ce=C.value)==null||ce.optInit(f)},_e=w(()=>Y.value.type==="dataV"&&G.value==="canvas-main"),Ce=w(()=>!!(b.value.suspensionButtonAvailable&&!s.value&&!d.value&&Se.value&&!O)),ue=()=>{};return n({restore:pt}),(f,ce)=>(c(),M(st,null,[D.initState?(c(),M("div",{key:0,id:Re,class:rt(["canvas-container",{"de-download-custom":e(K),"datav-preview":_e.value}]),style:Oe(ze.value),ref_key:"previewCanvas",ref:ae,onMousedown:Me},[be.value?(c(),B(Ul,{key:0,"is-fixed":H.value},null,8,["is-fixed"])):F("",!0),X.value?(c(),B(Za,{key:1,"dv-info":e(Y),"canvas-id":e(G),"canvas-style-data":e(b),canvasViewInfo:e(ve),"pop-component-data":ie.value,scale:j.value,"canvas-state":e(l),"show-position":"preview"},null,8,["dv-info","canvas-id","canvas-style-data","canvasViewInfo","pop-component-data","scale","canvas-state"])):F("",!0),m(dn,{"canvas-id":e(G),"canvas-style-data":e(b),"component-data":ye.value},null,8,["canvas-id","canvas-style-data","component-data"]),y.value?(c(!0),M(st,{key:2},$t(ye.value,(se,Ue)=>ot((c(),B(Wa,{active:se.id===(e(v)||{}).id,"canvas-id":e(G),"canvas-style-data":e(b),"dv-info":e(Y),"canvas-view-info":e(ve),"view-info":e(ve)[se.id],key:Ue,config:se,style:Oe(dt(se)),"show-position":e(le),"search-count":q.value,scale:e(d)&&e(gt)()?100:j.value,"is-selector":k.isSelector,"font-family":e(b).fontFamily||e(ne),onUserViewEnlargeOpen:Je=>He(Je,se),onDatasetParamsInit:Je=>Pe(se),onOnPointClick:R},null,8,["active","canvas-id","canvas-style-data","dv-info","canvas-view-info","view-info","config","style","show-position","search-count","scale","is-selector","font-family","onUserViewEnlargeOpen","onDatasetParamsInit"])),[[mt,se.isShow]])),128)):F("",!0),m(cn,{ref_key:"userViewEnlargeRef",ref:tt},null,512)],38)):F("",!0),D.initState?F("",!0):(c(),B(Gn,{key:1,description:"参数不能为空","img-type":"noneWhite"})),m(qr,{ref_key:"fullScreeRef",ref:U},null,512),m(jn,{ref_key:"customDatasetParamsRef",ref:C},null,512),m(e(Ga),{ref_key:"openHandler",ref:o,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512),Ce.value?(c(),B(ru,{key:2,ref:"link-opt-bar",terminal:"pc","canvas-style-data":e(b),onLinkExportPdf:ue},null,8,["canvas-style-data"])):F("",!0)],64))}});const cu=Ge(uu,[["__scopeId","data-v-b776c6ab"]]);export{Wi as C,Kn as D,qr as _,Ac as a,ts as b,Ec as c,oi as d,Ai as e,Jl as f,Xn as g,Tc as h,ji as i,Wa as j,cu as k,Nn as l,cn as m,Pc as n,Bc as o,Oc as p,zc as q};

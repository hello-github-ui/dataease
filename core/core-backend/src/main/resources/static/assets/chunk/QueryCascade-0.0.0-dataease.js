import"./index-0.0.0-dataease.js";import{E as x}from"./el-dialog-0.0.0-dataease.js";import{o as ee,D as ae,n as te,j as se,y as oe}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as le,a as de}from"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{d as ne,s as q,r as N,f as m,g as j,i as l,M as u,a5 as b,a6 as p,j as i,k as s,L as g,Y as V,a9 as E,T as ie,W as ce,ab as $}from"./vue-0.0.0-dataease.js";import{i as re}from"./icon_info_colorful-0.0.0-dataease.js";import{i as U}from"./icon_add_outlined-0.0.0-dataease.js";import{i as S}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{j as ue}from"./join-join-0.0.0-dataease.js";import{g as _e}from"./util-0.0.0-dataease.js";import{N as pe}from"./dataset-0.0.0-dataease.js";import{d as L}from"./lodash-0.0.0-dataease.js";import{_ as fe}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./index-0.0.0-dataease16.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";const ve={class:"title"},me={style:{"margin-left":"8px"},class:"tip"},he={class:"content"},ye={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Ie={class:"cascade-item"},be={class:"label"},ge={class:"item-name"},Ce={class:"item-field"},ke={class:"label"},qe={class:"item-name"},Ve={class:"cascade-icon"},Ee={class:"item-field"},we={class:"dialog-footer"},Be=ne({__name:"QueryCascade",emits:["saveCascade"],setup(je,{expose:O,emit:Q}){const{t:o}=ee();let T=q({});const F=Q,C=N(!1),w=()=>{C.value=!1},_=N([]),D=q({}),B=q([]),J=()=>{w()},P=()=>{const{isError:t,arr:e}=R();if(t){ae.error(o("v_query.cannot_be_empty"));return}F("saveCascade",e),w()},R=()=>{let t=!1;const e=L(_.value);return e.forEach(d=>{d.forEach(a=>{!a.placeholder&&!a.fieldId&&(t=!0),a.datasetId||(t=!0),a.selectValue=[]})}),{arr:e,isError:t}},W=(t,e)=>{_.value=L(e),B.value=Object.values(t).map(a=>({label:a.name,deType:a.deType,value:`${a.datasetId}--${a.queryId}--${a.fieldId}`}));let d={};Object.values(t).forEach(a=>{d[`${a.datasetId}--${a.queryId}--${a.fieldId}`]=a.deType}),T.value=d,pe(B.value.map(a=>a.value.split("--")[0])).then(a=>{D.value=a}).finally(()=>{C.value=!0})},M=q([]),Y=(t,e,d)=>{let a="",f=[],h="",y=[];for(let c in _.value[e]){if(c>d){_.value[e][c].datasetId&&!h&&(h=_.value[e][c].datasetId);continue}_.value[e][c].datasetId&&(a=_.value[e][c].datasetId),c===d&&(a=(_.value[e][d-1]||{}).datasetId)}_.value.forEach(c=>{let v=[],I=[];for(let n in c){if(f[f.length-1]===v||h===c[n].datasetId){h===c[n].datasetId&&y.push(I),y[y.length-1]===I&&I.push(c[n].datasetId);continue}c[n].datasetId&&v.push(c[n].datasetId),a===c[n].datasetId&&f.push(v)}}),t&&(M.value=[...new Set([...f.flat(),...y.flat()])].filter(c=>!!c))},z=t=>{t.push({datasetId:"",fieldId:"",placeholder:t.length?"":o("v_query.the_first_level"),id:_e()})},A=()=>{_.value.forEach(t=>{t.forEach((e,d)=>{d&&(e.placeholder=""),e&&t[d-1]&&e.datasetId&&e.datasetId.split("--")[0]===t[d-1].datasetId.split("--")[0]&&(e.placeholder=o("v_query.configure_cascaded_fields"),e.fieldId="")})})},G=(t,e)=>{e.splice(t,1),e[0].fieldId="",e[0].placeholder=o("v_query.the_first_level"),A()},H=t=>{_.value.splice(t,1)},K=()=>{const t=[];z(t),_.value.push(t)},X=[o("visualization.number1"),o("visualization.number2"),o("visualization.number3"),o("visualization.number4"),o("visualization.number5")];return O({init:W}),(t,e)=>{const d=te,a=se,f=oe,h=le,y=de,c=x;return m(),j(c,{class:"query-condition-cascade",modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=v=>C.value=v),width:"900px",onClick:e[1]||(e[1]=$(()=>{},["stop"])),"before-close":w,onMousedown:e[2]||(e[2]=$(()=>{},["stop"])),onMousedup:e[3]||(e[3]=$(()=>{},["stop"]))},{title:l(()=>[u("div",ve,[b(p(i(o)("v_query.condition_cascade_configuration")),1),u("span",me,p(i(o)("v_query.not_reverse_cascade")),1)])]),footer:l(()=>[u("div",we,[s(f,{onClick:J},{default:l(()=>[b(p(i(o)("chart.cancel")),1)]),_:1}),s(f,{onClick:P,type:"primary"},{default:l(()=>[b(p(i(o)("chart.confirm")),1)]),_:1})])]),default:l(()=>[u("div",he,[s(a,{style:{"font-size":"16px"}},{default:l(()=>[s(d,{name:"icon_info_colorful"},{default:l(()=>[s(i(re),{class:"svg-icon"})]),_:1})]),_:1}),b(" "+p(i(o)("v_query.must_be_met")),1),e[4]||(e[4]=u("br",null,null,-1)),b(" "+p(i(o)("v_query.select_data_set")),1),e[5]||(e[5]=u("br",null,null,-1))]),s(f,{text:"",onClick:K},{icon:l(()=>[s(d,{name:"icon_add_outlined"},{default:l(()=>[s(i(U),{class:"svg-icon"})]),_:1})]),default:l(()=>[b(" "+p(i(o)("v_query.add_cascade_configuration")),1)]),_:1}),(m(!0),g(V,null,E(_.value,(v,I)=>(m(),g("div",{class:"cascade-content",key:I},[u("div",ye,[s(f,{disabled:v.length===2,text:"",onClick:n=>z(v)},{icon:l(()=>[s(d,{name:"icon_add_outlined"},{default:l(()=>[s(i(U),{class:"svg-icon"})]),_:1})]),default:l(()=>[b(" "+p(i(o)("v_query.add_cascade_condition")),1)]),_:2},1032,["disabled","onClick"]),s(f,{onClick:n=>H(I),class:"cascade-delete-block",text:""},{icon:l(()=>[s(d,{name:"icon_delete-trash_outlined"},{default:l(()=>[s(i(S),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"])]),u("div",Ie,[u("div",be,p(i(o)("v_query.query_condition_level")),1),u("div",ge,p(i(o)("v_query.select_query_condition")),1),e[6]||(e[6]=u("div",{class:"cascade-icon"},null,-1)),u("div",Ce,p(i(o)("v_query.select_cascaded_field")),1)]),(m(!0),g(V,null,E(v,(n,k)=>(m(),g("div",{class:"cascade-item",key:n.id},[u("div",ke,p(i(o)("v_query.level_1",{msg:X[k]})),1),u("div",qe,[s(y,{onVisibleChange:r=>Y(r,I,k),modelValue:n.datasetId,"onUpdate:modelValue":r=>n.datasetId=r,onChange:A,style:{width:"300px"}},{default:l(()=>[(m(!0),g(V,null,E(B.value,r=>(m(),j(h,{key:r.value,label:r.label,value:r.value,disabled:M.value.includes(r.value)&&v.map(Z=>Z.datasetId).includes(r.value)||!!n.datasetId&&i(T)[n.datasetId]!==r.deType},null,8,["label","value","disabled"]))),128))]),_:2},1032,["onVisibleChange","modelValue","onUpdate:modelValue"])]),u("div",Ve,[s(a,null,{default:l(()=>[s(d,{name:"join-join"},{default:l(()=>[s(i(ue),{class:"svg-icon"})]),_:1})]),_:1})]),u("div",Ee,[s(y,{placeholder:n.placeholder,disabled:!!n.placeholder,modelValue:n.fieldId,"onUpdate:modelValue":r=>n.fieldId=r,style:{width:"300px"}},{default:l(()=>[(m(!0),g(V,null,E(D.value[n.datasetId.split("--")[0]],r=>(m(),j(h,{key:r.id,label:r.name,value:r.id},null,8,["label","value"]))),128))]),_:2},1032,["placeholder","disabled","modelValue","onUpdate:modelValue"])]),ie(s(f,{onClick:r=>G(k,v),class:"cascade-delete",text:""},{icon:l(()=>[s(d,{name:"icon_delete-trash_outlined"},{default:l(()=>[s(i(S),{class:"svg-icon"})]),_:1})]),_:2},1032,["onClick"]),[[ce,k!==0]])]))),128))]))),128))]),_:1},8,["modelValue"])}}});const aa=fe(Be,[["__scopeId","data-v-fb3742d3"]]);export{aa as default};

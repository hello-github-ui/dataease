import{e as Ti,E as jC}from"./eventemitter3-0.0.0-dataease.js";import{i as _z,m as xz,t as Cz,a as Ez,d as Sz,p as Az,b as Tz,c as bz,e as wz,f as Rz,g as Mz,h as Iz,u as Lz,j as Oz,k as Pz,l as Fz,n as Bz,o as Dz,q as Nz,r as kz,s as Uz,v as zz}from"./lodash-0.0.0-dataease.js";import{r as Hz,V as $z,T as Wz,U as Vz,P as ue}from"./@mapbox-0.0.0-dataease.js";import{P as Gz}from"./pbf-0.0.0-dataease.js";import{S as Xz}from"./supercluster-0.0.0-dataease.js";import{_ as E,a as V,b as X,c as $n}from"./@babel-0.0.0-dataease.js";import{c as jc,i as mg,m as df,t as vl,f as o1,a as on,b as ri,n as yc,s as s1,d as yg,e as By,g as Io,h as Yz,j as xv,k as gi,l as vb,o as jz,p as qh,q as pb,r as B0,u as Dd,v as Cv,w as Zz,x as qz,y as Kz,z as yo,A as _o,B as D0,C as Qz,D as Jz,E as gb,F as tH,G as eH,H as N0,I as rH,J as iH,K as l1,L as nH,M as Nf,N as aH,O as $u,P as oH,Q as _i,R as Pr,S as Fr,T as _c}from"./gl-matrix-0.0.0-dataease.js";import{_ as B,a as qt,b as S,c as xi,d as da,e as lt,f as _t,g as Ut,h as kf}from"./tslib-0.0.0-dataease.js";import{f as sH}from"./topojson-client-0.0.0-dataease.js";import{A as lH,g as uH}from"./@amap-0.0.0-dataease.js";import{W as mb}from"./viewport-mercator-project-0.0.0-dataease.js";import{b as cH,f as hH,l as fH,d as Ev,r as dH,a as vH,c as RP,g as MP,p as pH,u as gH}from"./@turf-0.0.0-dataease.js";import{o as u1,l as mH,p as yH,a as _H,s as xH,t as CH,q as EH,b as SH,c as AH,d as TH}from"./d3-scale-0.0.0-dataease.js";import{e as yb}from"./d3-array-0.0.0-dataease.js";import{c as bH,r as c1}from"./d3-color-0.0.0-dataease.js";import{e as No}from"./earcut-0.0.0-dataease.js";import{r as wH}from"./regl-0.0.0-dataease.js";import{g as _b,r as xb,i as RH}from"./lodash-es-0.0.0-dataease.js";import{m as Kh}from"./mapbox-gl-0.0.0-dataease.js";import{c as MH}from"./d3-dsv-0.0.0-dataease.js";import{g as IH}from"./geojson-vt-0.0.0-dataease.js";import{H as xh}from"./hammerjs-0.0.0-dataease.js";import{e as LH}from"./element-resize-detector-0.0.0-dataease.js";import{h as OH}from"./d3-hexbin-0.0.0-dataease.js";import{d as IP}from"./detect-browser-0.0.0-dataease.js";import{d as PH}from"./d3-ease-0.0.0-dataease.js";import{i as Cb,a as FH}from"./d3-interpolate-0.0.0-dataease.js";import{t as BH}from"./d3-timer-0.0.0-dataease.js";import{f as DH,a as NH}from"./fecha-0.0.0-dataease.js";import{b as kH}from"./size-sensor-0.0.0-dataease.js";import{e as UH,l as zH,a as HH,b as $H,p as WH,c as VH,q as GH}from"./d3-regression-0.0.0-dataease.js";import{i as XH,h as ZC,p as YH,d as Eb,a as jH}from"./d3-hierarchy-0.0.0-dataease.js";import{n as LP,a as Sb,z as ZH,c as qH,s as KH,b as QH,d as Ab}from"./fmin-0.0.0-dataease.js";import{p as JH}from"./pdfast-0.0.0-dataease.js";const k0=Object.freeze(Object.defineProperty({__proto__:null,get Base(){return wa},get Circle(){return eat},get Ellipse(){return rat},get Image(){return iat},get Line(){return nat},get Marker(){return pat},get Path(){return YE},get Polygon(){return Eat},get Polyline(){return Sat},get Rect(){return bat},get Text(){return wat}},Symbol.toStringTag,{value:"Module"})),U0=Object.freeze(Object.defineProperty({__proto__:null,get Base(){return Jn},get Circle(){return zPt},get Dom(){return HPt},get Ellipse(){return $Pt},get Image(){return WPt},get Line(){return VPt},get Marker(){return GPt},get Path(){return XPt},get Polygon(){return YPt},get Polyline(){return jPt},get Rect(){return qPt},get Text(){return tFt}},Symbol.toStringTag,{value:"Module"}));var Qh,Dy,OP,h1;function t$(){Qh=document.createElement("table"),Dy=document.createElement("tr"),OP=/^\s*<(\w+|!)[^>]*>/,h1={tr:document.createElement("tbody"),tbody:Qh,thead:Qh,tfoot:Qh,td:Dy,th:Dy,"*":document.createElement("div")}}function Lo(r){Qh||t$();var t=OP.test(r)&&RegExp.$1;(!t||!(t in h1))&&(t="*");var e=h1[t];r=typeof r=="string"?r.replace(/(^\s*)|(\s*$)/g,""):r,e.innerHTML=""+r;var i=e.childNodes[0];return i&&e.contains(i)&&e.removeChild(i),i}const qC="l7plot-legend l7plot-legend__category",KC="l7plot-legend__title",QC="l7plot-legend__category-list",PP="l7plot-legend__list-item",FP="l7plot-legend__category-marker",BP="l7plot-legend__category-value",e$=`<div class="${qC}">
  <div class="${KC}"></div>
  <ul class="${QC}"></ul>
</div>`,Tb=`<li class="${PP}" data-index={index}>
  <span class="${FP}" style="background:{color}"></span>
  <span class="${BP}">{value}</span>
</li>`;function Nd(r,t){return!r||!t?r:r.replace(/\\?\{([^{}]+)\}/g,function(e,i){return e.charAt(0)==="\\"?e.slice(1):t[i]===void 0?"":t[i]})}var DP={},NP={},bb=r=>NP[r],xn=(r,t)=>{NP[r]=t},r$=r=>DP[r],Zc=(r,t)=>{DP[r]=t},Hp={REGISTERED_PROTOCOLS:{}},i$=Object.defineProperty,n$=Object.defineProperties,a$=Object.getOwnPropertyDescriptors,wb=Object.getOwnPropertySymbols,o$=Object.prototype.hasOwnProperty,s$=Object.prototype.propertyIsEnumerable,Rb=(r,t,e)=>t in r?i$(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,JC=(r,t)=>{for(var e in t||(t={}))o$.call(t,e)&&Rb(r,e,t[e]);if(wb)for(var e of wb(t))s$.call(t,e)&&Rb(r,e,t[e]);return r},tE=(r,t)=>n$(r,a$(t)),eE=r=>Hp.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))],l$=class extends Error{constructor(r,t,e,i){super(`AJAXError: ${t} (${r}): ${e}`),this.status=r,this.statusText=t,this.url=e,this.body=i}};function kP(r,t){const e=new XMLHttpRequest,i=Array.isArray(r.url)?r.url[0]:r.url;e.open(r.method||"GET",i,!0),r.type==="arrayBuffer"&&(e.responseType="arraybuffer");for(const n in r.headers)r.headers.hasOwnProperty(n)&&e.setRequestHeader(n,r.headers[n]);return r.type==="json"&&(e.responseType="text",e.setRequestHeader("Accept","application/json")),e.withCredentials=r.credentials==="include",e.onerror=()=>{t(new Error(e.statusText))},e.onload=()=>{if((e.status>=200&&e.status<300||e.status===0)&&e.response!==null){let n=e.response;if(r.type==="json")try{n=JSON.parse(e.response)}catch(a){return t(a)}t(null,n,e.getResponseHeader("Cache-Control"),e.getResponseHeader("Expires"),e)}else{const n=new Blob([e.response],{type:e.getResponseHeader("Content-Type")});t(new l$(e.status,e.statusText,i.toString(),n))}},e.cancel=e.abort,e.send(r.body),e}function u$(r){return new Promise((t,e)=>{kP(r,(i,n,a,o,s)=>{i?e({err:i,data:null,xhr:s}):t({err:null,data:n,cacheControl:a,expires:o,xhr:s})})})}function rE(r,t){return kP(r,t)}var c$=(r,t)=>(eE(r.url)||rE)(tE(JC({},r),{type:"json"}),t),iE=(r,t)=>(eE(r.url)||rE)(tE(JC({},r),{type:"arrayBuffer"}),t),h$=(r,t)=>rE(tE(JC({},r),{method:"GET"}),t),Mb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function UP(r,t){const e=new window.Image,i=window.URL||window.webkitURL;e.crossOrigin="anonymous",e.onload=()=>{t(null,e),i.revokeObjectURL(e.src),e.onload=null,window.requestAnimationFrame(()=>{e.src=Mb})},e.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(r)],{type:"image/png"});e.src=r.byteLength?i.createObjectURL(n):Mb}function zP(r,t){const e=new Blob([new Uint8Array(r)],{type:"image/png"});createImageBitmap(e).then(i=>{t(null,i)}).catch(i=>{t(new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}var f1=(r,t,e)=>{const i=(n,a)=>{if(n)t(n);else if(a){const o=typeof createImageBitmap=="function",s=e?e(a):a;o?zP(s,t):UP(s,t)}};return r.type==="json"?c$(r,i):iE(r,i)},f$=(r,t)=>{typeof createImageBitmap=="function"?zP(r,t):UP(r,t)},z0=(r=>(r.CENTER="center",r.TOP="top",r["TOP-LEFT"]="top-left",r["TOP-RIGHT"]="top-right",r.BOTTOM="bottom",r["BOTTOM-LEFT"]="bottom-left",r["BOTTOM-RIGHT"]="bottom-right",r.LEFT="left",r.RIGHT="right",r))(z0||{}),_g={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function HP(r,t,e){const i=r.classList;for(const n in _g)_g.hasOwnProperty(n)&&i.remove(`l7-${e}-anchor-${n}`);i.add(`l7-${e}-anchor-${t}`)}function Le(r){const t=bH(r),e=[0,0,0,0];return t!=null&&(e[0]=t.r/255,e[1]=t.g/255,e[2]=t.b/255,e[3]=t.opacity),e}function Ml(r){const t=r&&r[0],e=r&&r[1],i=r&&r[2];return t+e*256+i*65536-1}function xc(r){return[r+1&255,r+1>>8&255,r+1>>8>>8&255]}function $P(r){let t=window.document.createElement("canvas"),e=t.getContext("2d");t.width=256,t.height=1;let i=null;const n=e.createLinearGradient(0,0,256,1),a=r.positions[0],o=r.positions[r.positions.length-1];for(let s=0;s<r.colors.length;++s){const l=(r.positions[s]-a)/(o-a);n.addColorStop(l,r.colors[s])}return e.fillStyle=n,e.fillRect(0,0,256,1),i=new Uint8ClampedArray(e.getImageData(0,0,256,1).data),t=null,e=null,{data:i,width:256,height:1}}function d$(r,t){let e=window.document.createElement("canvas"),i=e.getContext("2d");e.width=256,e.height=1;const n=i.createLinearGradient(0,0,256,1),a=t[1]-t[0];for(let l=0;l<r.colors.length;++l){const u=Math.max((r.positions[l]-t[0])/a,0);n.addColorStop(u,r.colors[l])}i.fillStyle=n,i.fillRect(0,0,256,1);const o=i.getImageData(0,0,256,1).data,s=nE(i,o);return e=null,i=null,s}function v$(r){let t=window.document.createElement("canvas"),e=t.getContext("2d");t.width=256,t.height=1;const i=e.createImageData(256,1);return i.data.fill(0),r.positions.forEach((n,a)=>{const o=Le(r.colors[a]);i.data[n*4+0]=o[0]*255,i.data[n*4+1]=o[1]*255,i.data[n*4+2]=o[2]*255,i.data[n*4+3]=o[3]*255}),t=null,e=null,i}function p$(r){let t=window.document.createElement("canvas"),e=t.getContext("2d");e.globalAlpha=1,t.width=256,t.height=1;const i=256/r.colors.length;for(let o=0;o<r.colors.length;o++)e.beginPath(),e.lineWidth=2,e.strokeStyle=r.colors[o],e.moveTo(o*i,0),e.lineTo((o+1)*i,0),e.stroke();const n=e.getImageData(0,0,256,1).data,a=nE(e,n);return t=null,e=null,a}function g$(r,t){let e=window.document.createElement("canvas"),i=e.getContext("2d");i.globalAlpha=1,e.width=256,e.height=1;const n=t[1]-t[0];r.positions.length-r.colors.length!==1&&console.warn("positions 的数字个数应当比 colors 的样式多一个,poisitions 的首尾值一般为数据的最大最新值");for(let s=0;s<r.colors.length;s++)i.beginPath(),i.lineWidth=2,i.strokeStyle=r.colors[s],i.moveTo((r.positions[s]-t[0])/n*255,0),i.lineTo((r.positions[s+1]-t[0])/n*255,0),i.stroke();const a=i.getImageData(0,0,256,1).data,o=nE(i,a);return e=null,i=null,o}function nE(r,t){const e=r.createImageData(256,1);for(let i=0;i<e.data.length;i+=4)e.data[i+0]=t[i+0],e.data[i+1]=t[i+1],e.data[i+2]=t[i+2],e.data[i+3]=t[i+3];return e}function aE(r){switch(r==null?void 0:r.type){case"cat":return[0,255];default:return[0,1]}}var tr={isNil:_z,merge:xz,throttle:Cz,isString:Ez,debounce:Sz,pull:Az,isTypedArray:Tz,isPlainObject:bz,isNumber:wz,isBoolean:Rz,isEqual:Mz,cloneDeep:Iz,uniq:Lz,clamp:Oz,upperFirst:Pz,get:Fz,mergeWith:Bz,isFunction:Dz,isObject:Nz,isUndefined:kz,camelCase:Uz,uniqueId:zz};function m$(r){let t=r;return typeof r=="string"&&(t=window.document.getElementById(r)),t}function WP(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function VP(r){return WP(r).split(/\s+/)}function y$(r){var t;const e=(t=document==null?void 0:document.documentElement)==null?void 0:t.style;if(!e)return r[0];for(const i in r)if(r[i]&&r[i]in e)return r[i];return r[0]}function Me(r,t,e){const i=window.document.createElement(r);return t&&(i.className=t||""),e&&e.appendChild(i),i}function sn(r){const t=r.parentNode;t&&t.removeChild(r)}function Oo(r,t){if(r.classList!==void 0){const e=VP(t);for(let i=0,n=e.length;i<n;i++)r.classList.add(e[i])}else if(!_$(r,t)){const e=oE(r);GP(r,(e?e+" ":"")+t)}}function Cc(r,t){r.classList!==void 0?VP(t).forEach(i=>{r.classList.remove(i)}):GP(r,WP((" "+oE(r)+" ").replace(" "+t+" "," ")))}function _$(r,t){if(r.classList!==void 0)return r.classList.contains(t);const e=oE(r);return e.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(e)}function GP(r,t){r instanceof HTMLElement?r.className=t:r.className.baseVal=t}function oE(r){return r instanceof SVGElement&&(r=r.correspondingElement),r.className.baseVal===void 0?r.className:r.className.baseVal}var x$=y$(["transform","WebkitTransform"]);function XP(r,t){r.style[x$]=t}function C$(){var r;const t=window.document.querySelector('meta[name="viewport"]');if(!t)return 1;const i=((r=t.content)==null?void 0:r.split(",")).find(n=>{const[a]=n.split("=");return a==="initial-scale"});return i?i.split("=")[1]*1:1}var Li=C$()<1?1:window.devicePixelRatio;function sE(r,t){r.setAttribute("style",`${r.style.cssText}${t}`)}function E$(r){return Object.entries(r).map(([t,e])=>`${t}: ${e}`).join(";")}function S$(r,t){return{left:r.left-t.left,top:r.top-t.top,right:t.left+t.width-r.left-r.width,bottom:t.top+t.height-r.top-r.height}}function kd(r){r.innerHTML=""}function A$(r){r.setAttribute("draggable","false")}function pl(r,t){if(typeof t=="string"){const e=document.createElement("div");for(e.innerHTML=t;e.firstChild;)r.append(e.firstChild)}else Array.isArray(t)?r.append(...t):r.append(t)}function T$(r,t){var e;const i=Array.isArray(t)?t:[t];let n=r;for(;n instanceof Element&&n!==window.document.body;){if(i.find(a=>n==null?void 0:n.matches(a)))return n;n=(e=n==null?void 0:n.parentElement)!=null?e:null}}function b$(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}var xg=navigator==null?void 0:navigator.userAgent;xg.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);xg.indexOf("Android")>-1||xg.indexOf("Adr")>-1;function w$(){const r=xg,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let e=!0;for(const i of t)if(r.indexOf(i)>0){e=!1;break}return e}function R$(r,t){r.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}function Ny(r){return typeof r=="number"}function mr(r){return r-Math.fround(r)}var Ib=2*Math.PI*6378137/2;function M$(r,t){const[e,i,n,a]=t;return r.lng>e&&r.lng<=n&&r.lat>i&&r.lat<=a}function I$(r){const t=[1/0,1/0,-1/0,-1/0];return r.forEach(e=>{const{coordinates:i}=e;YP(t,i)}),t}function YP(r,t){return Array.isArray(t[0])?t.forEach(e=>{YP(r,e)}):(r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])),r}function $p(r,t=!0,e={enable:!0,decimal:1}){r=P$(r,t);const i=r[0],n=r[1];let a=i*Ib/180,o=Math.log(Math.tan((90+n)*Math.PI/360))/(Math.PI/180);return o=o*Ib/180,e.enable&&(a=Number(a.toFixed(e.decimal)),o=Number(o.toFixed(e.decimal))),r.length===3?[a,o,r[2]]:[a,o]}function L$(r){if(r==null)throw new Error("lng is required");return(r>180||r<-180)&&(r=r%360,r>180&&(r=-360+r),r<-180&&(r=360+r),r===0&&(r=0)),r}function O$(r){if(r==null)throw new Error("lat is required");return(r>90||r<-90)&&(r=r%180,r>90&&(r=-180+r),r<-90&&(r=180+r),r===0&&(r=0)),r}function P$(r,t){if(t===!1)return r;const e=L$(r[0]);let i=O$(r[1]);return i>85&&(i=85),i<-85&&(i=-85),r.length===3?[e,i,r[2]]:[e,i]}function Pn(r){const t=85.0511287798,e=Math.max(Math.min(t,r[1]),-t),i=256<<20;let n=Math.PI/180,a=r[0]*n,o=e*n;o=Math.log(Math.tan(Math.PI/4+o/2));const s=.5/Math.PI,l=.5,u=-.5/Math.PI;return n=.5,a=i*(s*a+l),o=i*(u*o+n),[Math.floor(a),Math.floor(o)]}function ky(r,t){const e=85.0511287798,i=Math.PI/180,n=6378137;return t=Math.max(Math.min(e,t),-e),r*=i,t*=i,t=Math.log(Math.tan(Math.PI/4+t/2)),[r*n,t*n]}function F$(r,t,e){const i=Ev(t[1]-r[1]),n=Ev(t[0]-r[0]),a=Ev(r[1]),o=Ev(t[1]),s=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(n/2),2)*Math.cos(a)*Math.cos(o);return dH(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function lE(r,t){const e=Math.abs(r[1][1]-r[0][1])*t,i=Math.abs(r[1][0]-r[0][0])*t;return[[r[0][0]-i,r[0][1]-e],[r[1][0]+i,r[1][1]+e]]}function jP(r,t){return r[0][0]<=t[0][0]&&r[0][1]<=t[0][1]&&r[1][0]>=t[1][0]&&r[1][1]>=t[1][1]}function Cg(r){return[[r[0],r[1]],[r[2],r[3]]]}function B$(r){const t=D$(r,[0,0]);return[r[0]/t,r[1]/t]}function D$(r,t){return Math.sqrt(Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2))}function Hl(r){if(Ny(r[0]))return r;if(Ny(r[0][0]))throw new Error("当前数据不支持标注");if(Ny(r[0][0][0])){const t=r;let e=0,i=0,n=0;return t.forEach(a=>{a.forEach(o=>{e+=o[0],i+=o[1],n++})}),[e/n,i/n,0]}else throw new Error("当前数据不支持标注")}function N$(r){let t=r[0],e=r[1],i=r[0],n=r[1],a=0,o=0,s=0;for(let l=0;l<r.length;l+=2){const u=r[l],c=r[l+1];u&&c&&(t=Math.max(u,t),e=Math.max(c,e),i=Math.min(u,i),n=Math.min(c,n),a+=u,o+=c,s++)}return{center:[a/s,o/s],radius:Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))/2}}function k$(r){return cH(hH([fH(r)]))}function U$(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const t=Math.random()*16|0;return(r==="x"?t:t&3|8).toString(16)})}var z$=class{constructor(r=50,t){this.limit=r,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}clear(){this.order.forEach(r=>{this.delete(r)}),this.cache={},this.order=[]}get(r){const t=this.cache[r];return t&&(this.deleteOrder(r),this.appendOrder(r)),t}set(r,t){this.cache[r]?(this.delete(r),this.cache[r]=t,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=t,this.appendOrder(r))}delete(r){const t=this.cache[r];t&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(t,r))}deleteCache(r){delete this.cache[r]}deleteOrder(r){const t=this.order.findIndex(e=>e===r);t>=0&&this.order.splice(t,1)}appendOrder(r){this.order.push(r)}defaultDestroy(r,t){return null}};function H$(r){if(r.length===0)throw new Error("max requires at least one data point");let t=r[0];for(let e=1;e<r.length;e++)r[e]>t&&(t=r[e]);return t*1}function $$(r){if(r.length===0)throw new Error("min requires at least one data point");let t=r[0];for(let e=1;e<r.length;e++)r[e]<t&&(t=r[e]);return t*1}function ZP(r){if(r.length===0)return 0;let t=r[0]*1;for(let e=1;e<r.length;e++)t+=r[e]*1;return t}function W$(r){if(r.length===0)throw new Error("mean requires at least one data point");return ZP(r)/r.length}function V$(r){if(r.length===0)throw new Error("mean requires at least one data point");if(r.length<3)return r[0];r.sort();let t=r[0],e=NaN,i=0,n=1;for(let a=1;a<r.length+1;a++)r[a]!==t?(n>i&&(i=n,e=t),n=1,t=r[a]):n++;return e*1}var qP={min:$$,max:H$,mean:W$,sum:ZP,mode:V$};function KP(r,t){return r.map(e=>e[t])}var vf=(r=>(r.Realtime="realtime",r.Overlap="overlap",r.Replace="replace",r))(vf||{}),Rn=(r=>(r.Loading="Loading",r.Loaded="Loaded",r.Failure="Failure",r.Cancelled="Cancelled",r))(Rn||{}),QP=0,Lb=1,H0=2;function G$(r){r.forEach(t=>{t.isCurrent&&(t.isVisible=t.isLoaded)})}function X$(r){r.forEach(t=>{t.properties.state=QP}),r.forEach(t=>{t.isCurrent&&!JP(t)&&uE(t)}),r.forEach(t=>{t.isVisible=!!(t.properties.state&H0)})}function Y$(r){r.forEach(e=>{e.properties.state=QP}),r.forEach(e=>{e.isCurrent&&JP(e)}),r.slice().sort((e,i)=>e.z-i.z).forEach(e=>{e.isVisible=!!(e.properties.state&H0),e.children.length&&(e.isVisible||e.properties.state&Lb)?e.children.forEach(i=>{i.properties.state=Lb}):e.isCurrent&&uE(e)})}function JP(r){for(;r;){if(r.isLoaded)return r.properties.state|=H0,!0;r=r.parent}return!1}function uE(r){r.children.forEach(t=>{t.isLoaded?t.properties.state|=H0:uE(t)})}var tF=[-1/0,-1/0,1/0,1/0],j$=.2,Z$=5,q$={[vf.Realtime]:G$,[vf.Overlap]:X$,[vf.Replace]:Y$},K$=()=>{};function d1(r,t,e){const i=Math.floor((r+180)/360*Math.pow(2,e)),n=Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e));return[i,n]}function Ob(r,t,e){const i=r/Math.pow(2,e)*360-180,n=Math.PI-2*Math.PI*t/Math.pow(2,e),a=180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n)));return[i,a]}var eF=(r,t,e)=>{const[i,n]=Ob(r,t,e),[a,o]=Ob(r+1,t+1,e);return[i,o,a,n]};function Q$({zoom:r,latLonBounds:t,maxZoom:e=1/0,minZoom:i=0,zoomOffset:n=0,extent:a=tF}){let o=Math.ceil(r)+n;if(Number.isFinite(i)&&o<i)return[];Number.isFinite(e)&&o>e&&(o=e);const[s,l,u,c]=t,h=[Math.max(s,a[0]),Math.max(l,a[1]),Math.min(u,a[2]),Math.min(c,a[3])],f=[],[d,v]=d1(h[0],h[1],o),[p,g]=d1(h[2],h[3],o);for(let x=d;x<=p;x++)for(let C=g;C<=v;C++)f.push({x,y:C,z:o});const m=(p+d)/2,y=(v+g)/2,_=(x,C)=>Math.abs(x-m)+Math.abs(C-y);return f.sort((x,C)=>_(x.x,x.y)-_(C.x,C.y)),f}var J$=(r,t,e,i=!0)=>{const n=Math.pow(2,e),a=n-1,o=n;let s=r;const l=t;return i&&(s<0?s=s+o:s>a&&(s=s%o)),{warpX:s,warpY:l}},tW=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),eW=class extends Ti.EventEmitter{constructor(r){super(),this.tileSize=256,this.isVisible=!1,this.isCurrent=!1,this.isVisibleChange=!1,this.loadedLayers=0,this.isLayerLoaded=!1,this.isLoad=!1,this.isChildLoad=!1,this.parent=null,this.children=[],this.data=null,this.properties={},this.loadDataId=0;const{x:t,y:e,z:i,tileSize:n,warp:a=!0}=r;this.x=t,this.y=e,this.z=i,this.warp=a||!0,this.tileSize=n}get isLoading(){return this.loadStatus===Rn.Loading}get isLoaded(){return this.loadStatus===Rn.Loaded}get isFailure(){return this.loadStatus===Rn.Failure}setTileLayerLoaded(){this.isLayerLoaded=!0}get isCancelled(){return this.loadStatus===Rn.Cancelled}get isDone(){return[Rn.Loaded,Rn.Cancelled,Rn.Failure].includes(this.loadStatus)}get bounds(){return eF(this.x,this.y,this.z)}get bboxPolygon(){const[r,t,e,i]=this.bounds,n=[(e-r)/2,(i-t)/2];return vH(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:n,meta:`
      ${this.key}
      `}})}get key(){return`${this.x}_${this.y}_${this.z}`}layerLoad(){this.loadedLayers++,this.emit("layerLoaded")}loadData(r){return tW(this,arguments,function*({getData:t,onLoad:e,onError:i}){this.loadDataId++;const n=this.loadDataId;this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Rn.Loading;let a=null,o;try{const{x:s,y:l,z:u,bounds:c,tileSize:h,warp:f}=this,{warpX:d,warpY:v}=J$(s,l,u,f),{signal:p}=this.abortController;a=yield t({x:d,y:v,z:u,bounds:c,tileSize:h,signal:p,warp:f},this)}catch(s){o=s}if(n===this.loadDataId&&!(this.isCancelled&&!a)){if(o||!a){this.loadStatus=Rn.Failure,i(o,this);return}this.loadStatus=Rn.Loaded,this.data=a,e(this)}})}reloadData(r){this.isLoading&&this.abortLoad(),this.loadData(r)}abortLoad(){this.isLoaded||this.isCancelled||(this.loadStatus=Rn.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}},rW=(r,t)=>{const e=Cg(r),i=lE(e,t),n=360*3-180,a=85.0511287798065;return[Math.max(i[0][0],-n),Math.max(i[0][1],-a),Math.min(i[1][0],n),Math.min(i[1][1],a)]},iW=(r,t)=>{const e=Cg(r),i=Cg(t);return jP(e,i)},nW=Object.defineProperty,aW=Object.defineProperties,oW=Object.getOwnPropertyDescriptors,Pb=Object.getOwnPropertySymbols,sW=Object.prototype.hasOwnProperty,lW=Object.prototype.propertyIsEnumerable,Fb=(r,t,e)=>t in r?nW(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Bb=(r,t)=>{for(var e in t||(t={}))sW.call(t,e)&&Fb(r,e,t[e]);if(Pb)for(var e of Pb(t))lW.call(t,e)&&Fb(r,e,t[e]);return r},uW=(r,t)=>aW(r,oW(t)),{throttle:cW}=tr,hW=class extends jC{constructor(r){super(),this.currentTiles=[],this.cacheTiles=new Map,this.throttleUpdate=cW((t,e)=>{this.update(t,e)},16),this.onTileLoad=t=>{this.emit("tile-loaded",t),this.updateTileVisible(),this.loadFinished()},this.onTileError=(t,e)=>{this.emit("tile-error",{error:t,tile:e}),this.updateTileVisible(),this.loadFinished()},this.onTileUnload=t=>{this.emit("tile-unload",t),this.loadFinished()},this.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:tF,getTileData:K$,warp:!0,updateStrategy:vf.Replace},this.updateOptions(r)}get isLoaded(){return this.currentTiles.every(r=>r.isDone)}get tiles(){return Array.from(this.cacheTiles.values()).sort((t,e)=>t.z-e.z)}updateOptions(r){const t=r.minZoom===void 0?this.options.minZoom:Math.ceil(r.minZoom),e=r.maxZoom===void 0?this.options.maxZoom:Math.floor(r.maxZoom);this.options=uW(Bb(Bb({},this.options),r),{minZoom:t,maxZoom:e})}update(r,t){const e=Math.max(0,Math.ceil(r));if(this.lastViewStates&&this.lastViewStates.zoom===e&&iW(this.lastViewStates.latLonBoundsBuffer,t))return;const i=rW(t,j$);this.lastViewStates={zoom:e,latLonBounds:t,latLonBoundsBuffer:i},this.currentZoom=e;let n=!1;const a=this.getTileIndices(e,i).filter(o=>this.options.warp||o.x>=0&&o.x<Math.pow(2,e));this.emit("tiles-load-start"),this.currentTiles=a.map(({x:o,y:s,z:l})=>{let u=this.getTile(o,s,l);return u?(((u==null?void 0:u.isFailure)||(u==null?void 0:u.isCancelled))&&u.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),u):(u=this.createTile(o,s,l),n=!0,u)}),n&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}reloadAll(){for(const[r,t]of this.cacheTiles){if(!this.currentTiles.includes(t)){this.cacheTiles.delete(r),this.onTileUnload(t);return}this.onTileUnload(t),t.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}reloadTileById(r,t,e){const i=this.cacheTiles.get(`${t},${e},${r}`);i&&(this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}reloadTileByLnglat(r,t,e){const i=this.getTileByLngLat(r,t,e);i&&this.reloadTileById(i.z,i.x,i.y)}reloadTileByExtent(r,t){this.getTileIndices(t,r).forEach(i=>{this.reloadTileById(i.z,i.x,i.y)})}pruneRequests(){const r=[];for(const t of this.cacheTiles.values())t.isLoading&&!t.isCurrent&&!t.isVisible&&r.push(t);for(;r.length>0;)r.shift().abortLoad()}getTileByLngLat(r,t,e){const{zoomOffset:i}=this.options,n=Math.ceil(e)+i,a=d1(r,t,n);return this.tiles.filter(s=>s.key===`${a[0]}_${a[1]}_${n}`)[0]}getTileExtent(r,t){return this.getTileIndices(t,r)}getTileByZXY(r,t,e){return this.tiles.filter(n=>n.key===`${t}_${e}_${r}`)[0]}clear(){for(const r of this.cacheTiles.values())r.isLoading?r.abortLoad():this.onTileUnload(r);this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}destroy(){this.clear(),this.removeAllListeners()}updateTileVisible(){const r=this.options.updateStrategy,t=new Map;for(const n of this.cacheTiles.values())t.set(n.key,n.isVisible),n.isCurrent=!1,n.isVisible=!1;for(const n of this.currentTiles)n.isCurrent=!0,n.isVisible=!0;const e=Array.from(this.cacheTiles.values());typeof r=="function"?r(e):q$[r](e);let i=!1;Array.from(this.cacheTiles.values()).forEach(n=>{n.isVisible!==t.get(n.key)?(n.isVisibleChange=!0,i=!0):n.isVisibleChange=!1}),i&&this.emit("tile-update")}getTileIndices(r,t){const{tileSize:e,extent:i,zoomOffset:n}=this.options,a=Math.floor(this.options.maxZoom),o=Math.ceil(this.options.minZoom);return Q$({maxZoom:a,minZoom:o,zoomOffset:n,tileSize:e,zoom:r,latLonBounds:t,extent:i})}getTileId(r,t,e){return`${r},${t},${e}`}loadFinished(){const r=!this.currentTiles.some(t=>!t.isDone);return r&&this.emit("tiles-load-finished"),r}getTile(r,t,e){const i=this.getTileId(r,t,e);return this.cacheTiles.get(i)}createTile(r,t,e){const i=this.getTileId(r,t,e),n=new eW({x:r,y:t,z:e,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(i,n),n.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),n}resizeCacheTiles(){const r=Z$*this.currentTiles.length;if(this.cacheTiles.size>r){for(const[e,i]of this.cacheTiles)if(!i.isVisible&&!this.currentTiles.includes(i)&&(this.cacheTiles.delete(e),this.onTileUnload(i)),this.cacheTiles.size<=r)break}this.rebuildTileTree()}rebuildTileTree(){for(const r of this.cacheTiles.values())r.parent=null,r.children.length=0;for(const r of this.cacheTiles.values()){const t=this.getNearestAncestor(r.x,r.y,r.z);r.parent=t,t!=null&&t.children&&t.children.push(r)}}getNearestAncestor(r,t,e){for(;e>this.options.minZoom;){r=Math.floor(r/2),t=Math.floor(t/2),e=e-1;const i=this.getTile(r,t,e);if(i)return i}return null}};function rF(r){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(r);if(e){const i=e[1].charCodeAt(0),n=e[2].charCodeAt(0);let a;for(a=i;a<=n;++a)t.push(r.replace(e[0],String.fromCharCode(a)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(r),e){const i=parseInt(e[2],10);for(let n=parseInt(e[1],10);n<=i;n++)t.push(r.replace(e[0],n.toString()));return t}return t.push(r),t}function ec(r,t){if(!r||!r.length)throw new Error("url is not allowed to be empty");const{x:e,y:i,z:n}=t,a=rF(r),o=Math.abs(e+i)%a.length;return(eE(a[o])?`${a[o]}/{z}/{x}/{y}`:a[o]).replace(/\{x\}/g,e.toString()).replace(/\{y\}/g,i.toString()).replace(/\{z\}/g,n.toString()).replace(/\{bbox\}/g,eF(e,i,n).join(",")).replace(/\{-y\}/g,(Math.pow(2,n)-i-1).toString())}function fW(r,t){const{x:e,y:i,z:n,layer:a,version:o="1.0.0",style:s="default",format:l,service:u="WMTS",tileMatrixset:c}=t,h=rF(r),f=Math.abs(e+i)%h.length;return`${h[f]}&SERVICE=${u}&REQUEST=GetTile&VERSION=${o}&LAYER=${a}&STYLE=${s}&TILEMATRIXSET=${c}&FORMAT=${l}&TILECOL=${e}&TILEROW=${i}&TILEMATRIX=${n}`}function Ch(r,t){return r??t}function dW(r,t){return r.map(e=>e[t]*1)}function iF(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":!1}function v1(r){const t=Object.isFrozen(r)?tr.cloneDeep(r):r;return Hz(t,!0),t}function qc(r,t){return r||[[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]}var vW=Object.defineProperty,pW=Object.defineProperties,gW=Object.getOwnPropertyDescriptors,Db=Object.getOwnPropertySymbols,mW=Object.prototype.hasOwnProperty,yW=Object.prototype.propertyIsEnumerable,Nb=(r,t,e)=>t in r?vW(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,kb=(r,t)=>{for(var e in t||(t={}))mW.call(t,e)&&Nb(r,e,t[e]);if(Db)for(var e of Db(t))yW.call(t,e)&&Nb(r,e,t[e]);return r},Ub=(r,t)=>pW(r,gW(t));function nF(r,t){const{x:e,y:i,x1:n,y1:a,coordinates:o,geometry:s}=t,l=[];if(!Array.isArray(r))return{dataArray:[]};if(s)return r.filter(u=>u[s]&&u[s].type&&u[s].coordinates&&u[s].coordinates.length>0).forEach((u,c)=>{const h=v1(u[s]);RP(h,f=>{const d=MP(f),v=Ub(kb({},u),{_id:c,coordinates:d});l.push(v)})}),{dataArray:l};for(let u=0;u<r.length;u++){const c=r[u];let h=[];if(o){let d="Polygon";Array.isArray(o[0])||(d="Point"),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(d="LineString"),h=v1({type:d,coordinates:c[o]}).coordinates}else if(e&&i&&n&&a){const d=[parseFloat(c[e]),parseFloat(c[i])],v=[parseFloat(c[n]),parseFloat(c[a])];h=[d,v]}else e&&i&&(h=[parseFloat(c[e]),parseFloat(c[i])]);const f=Ub(kb({},c),{_id:u,coordinates:h});l.push(f)}return{dataArray:l}}function _W(r,t){const e=MH(r);return nF(e,t)}var xW=Object.defineProperty,CW=Object.defineProperties,EW=Object.getOwnPropertyDescriptors,zb=Object.getOwnPropertySymbols,SW=Object.prototype.hasOwnProperty,AW=Object.prototype.propertyIsEnumerable,Hb=(r,t,e)=>t in r?xW(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,TW=(r,t)=>{for(var e in t||(t={}))SW.call(t,e)&&Hb(r,e,t[e]);if(zb)for(var e of zb(t))AW.call(t,e)&&Hb(r,e,t[e]);return r},bW=(r,t)=>CW(r,EW(t));function wW(r){const t=r.toString();let e=5381,i=t.length;for(;i;)e=e*33^t.charCodeAt(--i);return e>>>0}function RW(r,t){return t===void 0?null:isNaN(r.properties[t]*1)?r.properties&&r.properties[t]?wW(r.properties[t]+"")%1000019:null:r.properties[t]*1}function MW(r,t){const e=[],i={};return r.features?(r.features=r.features.filter(n=>{const a=n.geometry;return n!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),r=v1(r),r.features.length===0?{dataArray:[],featureKeys:i}:(RP(r,(n,a)=>{let o=RW(n,t==null?void 0:t.featureId);o===null&&(o=a);const s=o,l=MP(n),u=bW(TW({},n.properties),{coordinates:l,_id:s});e.push(u)}),{dataArray:e,featureKeys:i})):(r.features=[],{dataArray:[]})}var Jh=class{constructor(t,e,i,n){this.vectorLayerCache={},this.x=e,this.y=i,this.z=n,this.vectorTile=t}getTileData(t){return!t||!this.vectorTile.layers[t]?[]:this.vectorLayerCache[t]?this.vectorLayerCache[t]:this.vectorTile.layers[t].features}getFeatureById(){throw new Error("Method not implemented.")}},IW=Object.defineProperty,LW=Object.defineProperties,OW=Object.getOwnPropertyDescriptors,$b=Object.getOwnPropertySymbols,PW=Object.prototype.hasOwnProperty,FW=Object.prototype.propertyIsEnumerable,Wb=(r,t,e)=>t in r?IW(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Eg=(r,t)=>{for(var e in t||(t={}))PW.call(t,e)&&Wb(r,e,t[e]);if($b)for(var e of $b(t))FW.call(t,e)&&Wb(r,e,t[e]);return r},BW=(r,t)=>LW(r,OW(t)),DW=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),NW={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function kW(r){let t=0;for(let e=0,i=r.length,n=i-1,a,o;e<i;n=e++)a=r[e],o=r[n],t+=(o.x-a.x)*(a.y+o.y);return t}function UW(r){const t=r.length;if(t<=1)return[r];const e=[];let i,n;for(let a=0;a<t;a++){const o=kW(r[a]);o!==0&&(n===void 0&&(n=o<0),n===o<0?(i&&e.push(i),i=[r[a]]):i.push(r[a]))}return i&&e.push(i),e}var zW=["Unknown","Point","LineString","Polygon"];function HW(r,t,e,i,n){let a=n.geometry;const o=n.type,s=n.tags,l=n.id,u=r*Math.pow(2,i),c=r*t,h=r*e;let f=zW[o],d,v;function p(m){for(let y=0;y<m.length;y++){const _=m[y];if(_[3])break;const x=180-(_[1]+h)*360/u,C=(_[0]+c)*360/u-180,A=360/Math.PI*Math.atan(Math.exp(x*Math.PI/180))-90;m[y]=[C,A,0,1]}}switch(o){case 1:const m=[];for(d=0;d<a.length;d++)m[d]=a[d][0];a=m,p(a);break;case 2:for(d=0;d<a.length;d++)p(a[d]);break;case 3:for(a=UW(a),d=0;d<a.length;d++)for(v=0;v<a[d].length;v++)p(a[d][v]);break}return a.length===1?a=a[0]:f="Multi"+f,{type:"Feature",geometry:{type:f,coordinates:a},properties:s,id:l,tileOrigin:[0,0],coord:""}}var $W=(r,t,e,i)=>DW(void 0,null,function*(){return new Promise(n=>{const a=t.getTile(r.z,r.x,r.y),s={layers:{defaultLayer:{features:a?a.features.map(u=>HW(i,e.x,e.y,e.z,u)):[]}}},l=new Jh(s,r.x,r.y,r.z);n(l)})});function WW(r){const t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return r===void 0||typeof r.geojsonvtOptions>"u"?t:Eg(Eg({},t),r.geojsonvtOptions)}function VW(r,t){const e=WW(t),i=e.extent||4096,n=IH(r,e),a=(s,l)=>$W(l,n,s,i),o=BW(Eg(Eg({},NW),t),{getTileData:a});return{data:r,dataArray:[],tilesetOptions:o,isTile:!0}}var GW=Object.defineProperty,XW=Object.defineProperties,YW=Object.getOwnPropertyDescriptors,Vb=Object.getOwnPropertySymbols,jW=Object.prototype.hasOwnProperty,ZW=Object.prototype.propertyIsEnumerable,Gb=(r,t,e)=>t in r?GW(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Xb=(r,t)=>{for(var e in t||(t={}))jW.call(t,e)&&Gb(r,e,t[e]);if(Vb)for(var e of Vb(t))ZW.call(t,e)&&Gb(r,e,t[e]);return r},Yb=(r,t)=>XW(r,YW(t));function aF(r,t){const{extent:e=[121.168,30.2828,121.384,30.4219],coordinates:i,requestParameters:n={}}=t,a=new Promise(l=>{r instanceof HTMLImageElement||b$(r)?l([r]):qW(r,n,u=>{l(u)})}),o=qc(i,e);return{originData:r,images:a,_id:1,dataArray:[{_id:0,coordinates:o}]}}function qW(r,t,e){const i=[];if(typeof r=="string")f1(Yb(Xb({},t),{url:r}),(n,a)=>{a&&(i.push(a),e(i))});else{const n=r.length;let a=0;r.forEach(o=>{f1(Yb(Xb({},t),{url:o}),(s,l)=>{a++,l&&i.push(l),a===n&&e(i)})})}return aF}var KW=Object.defineProperty,QW=Object.defineProperties,JW=Object.getOwnPropertyDescriptors,jb=Object.getOwnPropertySymbols,tV=Object.prototype.hasOwnProperty,eV=Object.prototype.propertyIsEnumerable,Zb=(r,t,e)=>t in r?KW(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,oF=(r,t)=>{for(var e in t||(t={}))tV.call(t,e)&&Zb(r,e,t[e]);if(jb)for(var e of jb(t))eV.call(t,e)&&Zb(r,e,t[e]);return r},sF=(r,t)=>QW(r,JW(t)),rV=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),iV=(r,t,e,i)=>rV(void 0,null,function*(){const n={x:t.x,y:t.y,z:t.z},a=ec(r,n);return new Promise(o=>{i?i(n,(s,l)=>{if(s||!l){const u={layers:{defaultLayer:{features:[]}}},c=new Jh(u,t.x,t.y,t.z);o(c)}else{const u={layers:{defaultLayer:{features:l.features}}},c=new Jh(u,t.x,t.y,t.z);o(c)}}):h$(sF(oF({},e),{url:a}),(s,l)=>{if(s||!l){const u={layers:{defaultLayer:{features:[]}}},c=new Jh(u,t.x,t.y,t.z);o(c)}else{const c={layers:{defaultLayer:{features:JSON.parse(l)}}},h=new Jh(c,t.x,t.y,t.z);o(h)}})})});function nV(r,t){const e=(n,a)=>iV(r,a,t==null?void 0:t.requestParameters,t.getCustomData),i=sF(oF({},t),{getTileData:e});return{dataArray:[],tilesetOptions:i,isTile:!0}}var aV=Object.defineProperty,oV=Object.defineProperties,sV=Object.getOwnPropertyDescriptors,qb=Object.getOwnPropertySymbols,lV=Object.prototype.hasOwnProperty,uV=Object.prototype.propertyIsEnumerable,Kb=(r,t,e)=>t in r?aV(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Qb=(r,t)=>{for(var e in t||(t={}))lV.call(t,e)&&Kb(r,e,t[e]);if(qb)for(var e of qb(t))uV.call(t,e)&&Kb(r,e,t[e]);return r},cV=(r,t)=>oV(r,sV(t)),Jb=class{constructor(r,t,e,i){this.vectorLayerCache={},this.x=t,this.y=e,this.z=i,this.vectorTile=new $z(new Gz(r))}getTileData(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];const t=this.vectorTile.layers[r];if(Array.isArray(t.features))return this.vectorLayerCache[r]=t.features,t.features;const e=[];for(let i=0;i<t.length;i++){const a=t.feature(i).toGeoJSON(this.x,this.y,this.z);e.push(cV(Qb({},a),{properties:Qb({id:a.id},a.properties)}))}return this.vectorLayerCache[r]=e,e}getFeatureById(){throw new Error("Method not implemented.")}},hV=Object.defineProperty,fV=Object.defineProperties,dV=Object.getOwnPropertyDescriptors,t2=Object.getOwnPropertySymbols,vV=Object.prototype.hasOwnProperty,pV=Object.prototype.propertyIsEnumerable,e2=(r,t,e)=>t in r?hV(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,p1=(r,t)=>{for(var e in t||(t={}))vV.call(t,e)&&e2(r,e,t[e]);if(t2)for(var e of t2(t))pV.call(t,e)&&e2(r,e,t[e]);return r},lF=(r,t)=>fV(r,dV(t)),gV=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),mV={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},yV=(r,t,e,i,n)=>gV(void 0,null,function*(){const a=ec(r,t);return new Promise(o=>{if(n)n({x:e.x,y:e.y,z:e.z},(s,l)=>{if(s||!l)o(void 0);else{const u=new Jb(l,e.x,e.y,e.z);o(u)}});else{const s=iE(lF(p1({},i),{url:a}),(l,u)=>{if(l||!u)o(void 0);else{const c=new Jb(u,e.x,e.y,e.z);o(c)}});e.xhrCancel=()=>s.cancel()}})});function _V(r,t){const e=Array.isArray(r)?r[0]:r,i=(a,o)=>yV(e,a,o,t==null?void 0:t.requestParameters,t==null?void 0:t.getCustomData),n=lF(p1(p1({},mV),t),{getTileData:i});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}function xV(r,t,e){switch(r){case"+":return t+e;case"-":return t-e;case"*":return t*e;case"/":return t/e;case"%":return t%e;case"^":return Math.pow(t,e);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return e===-1?Math.atan(t):Math.atan2(t,e);case"min":return Math.min(t,e);case"max":return Math.max(t,e);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}function pf(r,t){const{width:e,height:i}=t[0],n=t.map(l=>l.rasterData),a=e*i,o=[],s=JSON.stringify(r);for(let l=0;l<a;l++){const u=JSON.parse(s),c=uF(u,n,l);if(typeof c=="number")o.push(c);else{const h=g1(u);o.push(h)}}return o}function uF(r,t,e){if(r.length===2&&r[0]==="band"&&typeof r[1]=="number")try{return t[r[1]][e]}catch{return console.warn("Raster Data err!"),0}r.map((i,n)=>{if(Array.isArray(i)&&i.length>0)switch(i[0]){case"band":try{r[n]=t[i[1]][e]}catch{console.warn("Raster Data err!"),r[n]=0}break;default:uF(i,t,e)}})}function CV(r){const[t,e=-1,i=-1]=r;return t===void 0?(console.warn("Express err!"),["+",0,0]):[t.replace(/\s+/g,""),e,i]}function g1(r){const t=CV(r),e=t[0];let i=t[1],n=t[2];return Array.isArray(i)&&(i=g1(r[1])),Array.isArray(n)&&(n=g1(r[2])),xV(e,i,n)}var EV={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:SV}};function SV(r,t){const e=r[0].rasterData,i=r[1].rasterData,n=r[2].rasterData,a=[],[o,s]=(t==null?void 0:t.countCut)||[2,98],l=(t==null?void 0:t.RMinMax)||rc(e,o,s),u=(t==null?void 0:t.GMinMax)||rc(i,o,s),c=(t==null?void 0:t.BMinMax)||rc(n,o,s);for(let h=0;h<e.length;h++)a.push(Math.max(0,e[h]-l[0])),a.push(Math.max(0,i[h]-u[0])),a.push(Math.max(0,n[h]-c[0]));return{rasterData:a,rMinMax:l,gMinMax:u,bMinMax:c}}function rc(r,t,e){const i=r.slice().sort((s,l)=>s-l),n=i.length,a=i[Math.ceil(n*t/100)],o=i[Math.ceil(n*e/100)];return[a,o]}var AV=Object.defineProperty,TV=Object.defineProperties,bV=Object.getOwnPropertyDescriptors,r2=Object.getOwnPropertySymbols,wV=Object.prototype.hasOwnProperty,RV=Object.prototype.propertyIsEnumerable,i2=(r,t,e)=>t in r?AV(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,MV=(r,t)=>{for(var e in t||(t={}))wV.call(t,e)&&i2(r,e,t[e]);if(r2)for(var e of r2(t))RV.call(t,e)&&i2(r,e,t[e]);return r},IV=(r,t)=>TV(r,bV(t)),cF=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())});function cE(r,t,e){return cF(this,null,function*(){if(r.length===0)return{rasterData:[0],width:1,heigh:1};const i=yield Promise.all(r.map(({data:l,bands:u=[0]})=>t(l,u))),n=[];i.forEach(l=>{Array.isArray(l)?n.push(...l):n.push(l)});const{width:a,height:o}=n[0];let s;switch(typeof e){case"function":s=e(n);break;case"object":Array.isArray(e)?s={rasterData:pf(e,n)}:s=LV(e,n);break;default:s={rasterData:n[0].rasterData}}return IV(MV({},s),{width:a,height:o})})}function LV(r,t){const e=EV[r.type];if(e.type==="function")return e.method(t,r==null?void 0:r.options);if(e.type==="operation")return r.type==="rgb"?OV(e.expression,t):{rasterData:pf(e.expression,t)}}function OV(r,t){r.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),r.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),r.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");const e=pf(r.r||["band",0],t),i=pf(r.g||["band",0],t),n=pf(r.b||["band",0],t);return[e,i,n]}function m1(r,t,e,i){return cF(this,null,function*(){const n=yield cE(r,t,e);i(null,{data:n})})}function PV(r,t){const{extent:e=[121.168,30.2828,121.384,30.4219],coordinates:i,width:n,height:a,min:o,max:s,format:l,operation:u}=t;let c,h,f;if(l===void 0||iF(r))c=Array.from(r),h=n,f=a;else{const p=Array.isArray(r)?r:[r];c=cE(p,l,u)}const d=qc(i,e);return{_id:1,dataArray:[{_id:1,data:c,width:h,height:f,min:o,max:s,coordinates:d}]}}let Ud=function(r){return r.Normal="normal",r.PostProcessing="post-processing",r}({}),b=function(r){return r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.MAX_EXT=32776]="MAX_EXT",r[r.MIN_EXT=32775]="MIN_EXT",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.CULL_FACE=2884]="CULL_FACE",r[r.BLEND=3042]="BLEND",r[r.DITHER=3024]="DITHER",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.RED=6403]="RED",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.TEXTURE1=33985]="TEXTURE1",r[r.TEXTURE2=33986]="TEXTURE2",r[r.TEXTURE3=33987]="TEXTURE3",r[r.TEXTURE4=33988]="TEXTURE4",r[r.TEXTURE5=33989]="TEXTURE5",r[r.TEXTURE6=33990]="TEXTURE6",r[r.TEXTURE7=33991]="TEXTURE7",r[r.TEXTURE8=33992]="TEXTURE8",r[r.TEXTURE9=33993]="TEXTURE9",r[r.TEXTURE10=33994]="TEXTURE10",r[r.TEXTURE11=33995]="TEXTURE11",r[r.TEXTURE12=33996]="TEXTURE12",r[r.TEXTURE13=33997]="TEXTURE13",r[r.TEXTURE14=33998]="TEXTURE14",r[r.TEXTURE15=33999]="TEXTURE15",r[r.TEXTURE16=34e3]="TEXTURE16",r[r.TEXTURE17=34001]="TEXTURE17",r[r.TEXTURE18=34002]="TEXTURE18",r[r.TEXTURE19=34003]="TEXTURE19",r[r.TEXTURE20=34004]="TEXTURE20",r[r.TEXTURE21=34005]="TEXTURE21",r[r.TEXTURE22=34006]="TEXTURE22",r[r.TEXTURE23=34007]="TEXTURE23",r[r.TEXTURE24=34008]="TEXTURE24",r[r.TEXTURE25=34009]="TEXTURE25",r[r.TEXTURE26=34010]="TEXTURE26",r[r.TEXTURE27=34011]="TEXTURE27",r[r.TEXTURE28=34012]="TEXTURE28",r[r.TEXTURE29=34013]="TEXTURE29",r[r.TEXTURE30=34014]="TEXTURE30",r[r.TEXTURE31=34015]="TEXTURE31",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r}({});const FV=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{camelCase:BV,isNil:DV,upperFirst:NV}=tr;class Wo{constructor(){E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"config",void 0),E(this,"quad",FV),E(this,"enabled",!0),E(this,"renderToScreen",!1),E(this,"model",void 0),E(this,"name",void 0),E(this,"optionsToUpdate",{})}getName(){return this.name}setName(t){this.name=t}getType(){return Ud.PostProcessing}init(t,e){this.config=e,this.rendererService=t.getContainer().rendererService,this.shaderModuleService=t.getContainer().shaderModuleService;const{createAttribute:i,createBuffer:n,createModel:a}=this.rendererService,{vs:o,fs:s,uniforms:l}=this.setupShaders();this.model=a({vs:o,fs:s,attributes:{a_Position:i({buffer:n({data:[-4,-4,4,-4,0,4],type:b.FLOAT}),size:2})},uniforms:V(V({u_Texture:null},l),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}render(t,e){const i=t.multiPassRenderer.getPostProcessor(),{useFramebuffer:n,getViewportSize:a,clear:o}=this.rendererService,{width:s,height:l}=a();n(this.renderToScreen?null:i.getWriteFBO(),()=>{o({framebuffer:i.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});const u=V({u_BloomFinal:0,u_Texture:i.getReadFBO(),u_ViewportSize:[s,l]},this.convertOptionsToUniforms(this.optionsToUpdate));e&&(u.u_BloomFinal=1,u.u_Texture2=e),this.model.draw({uniforms:u})})}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}setRenderToScreen(t){this.renderToScreen=t}updateOptions(t){this.optionsToUpdate=V(V({},this.optionsToUpdate),t)}setupShaders(){throw new Error("Method not implemented.")}convertOptionsToUniforms(t){const e={};return Object.keys(t).forEach(i=>{DV(t[i])||(e[`u_${NV(BV(i))}`]=t[i])}),e}}function kV(r){let t=0;switch(r){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16;break}return t}const hF=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function n2(r,t=!1){const e={};return r=r.replace(hF,(i,n,a)=>{const o=a.split(":"),s=o[0].trim();let l="";switch(o.length>1&&(l=o[1].trim()),n){case"bool":l=l==="true";break;case"float":case"int":l=Number(l);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":l?l=l.replace("[","").replace("]","").split(",").reduce((u,c)=>(u.push(Number(c.trim())),u),[]):l=new Array(kV(n)).fill(0);break}return e[s]=l,`${t?"uniform ":""}${n} ${s};
`}),{content:r,uniforms:e}}function Uy(r){let{content:t,uniforms:e}=n2(r,!0);return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,(i,n,a)=>{a=a.trim().replace(/^.*$/gm,l=>`uniform ${l}`);const{content:o,uniforms:s}=n2(a);return Object.assign(e,s),`${n}{
${o}
};`}),{content:t,uniforms:e}}function a2(r){const t={};return r.replace(hF,(e,i,n)=>{const a=n.trim();return t[a]?"":(t[a]=!0,`uniform ${i} ${a};
`)})}const el={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"};let Ec=function(r){return r.TOPRIGHT="topright",r.TOPLEFT="topleft",r.BOTTOMRIGHT="bottomright",r.BOTTOMLEFT="bottomleft",r.TOPCENTER="topcenter",r.BOTTOMCENTER="bottomcenter",r.LEFTCENTER="leftcenter",r.RIGHTCENTER="rightcenter",r.LEFTTOP="lefttop",r.RIGHTTOP="righttop",r.LEFTBOTTOM="leftbottom",r.RIGHTBOTTOM="rightbottom",r}({}),Sc=function(r){return r[r.LNGLAT=1]="LNGLAT",r[r.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",r[r.VECTOR_TILE=3]="VECTOR_TILE",r[r.IDENTITY=4]="IDENTITY",r[r.METER_OFFSET=5]="METER_OFFSET",r}({});const Tu={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter"};var Ar={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"};let Oi=function(r){return r.Hover="hover",r.Click="click",r.Select="select",r.Active="active",r.Drag="drag",r}({}),ss=function(r){return r.normal="normal",r.additive="additive",r.subtractive="subtractive",r.min="min",r.max="max",r.none="none",r}({}),yl=function(r){return r.MULTIPLE="MULTIPLE",r.SINGLE="SINGLE",r}({}),$0=function(r){return r.AND="and",r.OR="or",r}({}),Vr=function(r){return r.INIT="init",r.UPDATE="update",r}({}),Se=function(r){return r.LINEAR="linear",r.SEQUENTIAL="sequential",r.POWER="power",r.LOG="log",r.IDENTITY="identity",r.TIME="time",r.QUANTILE="quantile",r.QUANTIZE="quantize",r.THRESHOLD="threshold",r.CAT="cat",r.DIVERGING="diverging",r.CUSTOM="threshold",r}({}),bu=function(r){return r.CONSTANT="constant",r.VARIABLE="variable",r}({}),vt=function(r){return r[r.Attribute=0]="Attribute",r[r.InstancedAttribute=1]="InstancedAttribute",r[r.Uniform=2]="Uniform",r}({});const y1=["mapload","mapchange","mapAfterFrameChange"],Eh=30;function UV({characterSet:r,getFontWidth:t,fontHeight:e,buffer:i,maxCanvasWidth:n,mapping:a={},xOffset:o=0,yOffset:s=0}){let l=0,u=o;Array.from(r).forEach((h,f)=>{if(!a[h]){const d=t(h,f);u+Eh>n&&(u=0,l++),a[h]={x:u,y:s+l*Eh,width:Eh,height:Eh,advance:d},u+=Eh}});const c=e+i*2;return{mapping:a,xOffset:u,yOffset:s+l*c,canvasHeight:fF(s+(l+1)*c)}}function zV(r,t,e){let i=0,n=0,a=0,o=[];const s={};for(const u of r)if(!s[u.id]){const{size:c}=u;i+c+t>e&&(o2(s,o,n),i=0,n=a+n+t,a=0,o=[]),o.push({icon:u,xOffset:i}),i=i+c+t,a=Math.max(a,c)}o.length>0&&o2(s,o,n);const l=fF(a+n+t);return{mapping:s,canvasHeight:l}}function o2(r,t,e){for(const i of t){const{icon:n,xOffset:a}=i;r[n.id]=V(V({},n),{},{x:a,y:e,image:n.image,width:n.width,height:n.height})}}function fF(r){return Math.pow(2,Math.ceil(Math.log2(r)))}const HV=qV(),$V="sans-serif",WV="normal",VV=24,GV=3,XV=.25,YV=8,s2=1024,jV=1,l2=1,ZV=3;function qV(){const r=[];for(let t=32;t<128;t++)r.push(String.fromCharCode(t));return r}function u2(r,t,e,i){r.font=`${i} ${e}px ${t}`,r.fillStyle="black",r.textBaseline="middle"}function c2(r,t){for(let e=0;e<r.length;e++)t.data[4*e+3]=r[e]}class KV extends Ti.EventEmitter{constructor(...t){super(...t),E(this,"fontAtlas",void 0),E(this,"iconFontMap",void 0),E(this,"iconFontGlyphs",{}),E(this,"fontOptions",void 0),E(this,"key",void 0),E(this,"cache",new z$(ZV))}get scale(){return l2}get canvas(){const t=this.cache.get(this.key);return t&&t.data}get mapping(){const t=this.cache.get(this.key);return t&&t.mapping||{}}getCanvasByKey(t){const e=this.cache.get(t);return e&&e.data}getMappingByKey(t){const e=this.cache.get(t);return e&&e.mapping||{}}init(){this.cache.clear(),this.fontOptions={fontFamily:$V,fontWeight:WV,characterSet:HV,fontSize:VV,buffer:GV,sdf:!0,cutoff:XV,radius:YV,iconfont:!1},this.key="",this.iconFontMap=new Map}addIconGlyphs(t){t.forEach(e=>{this.iconFontGlyphs[e.name]=e.unicode})}addIconFont(t,e){this.iconFontMap.set(t,e)}getIconFontKey(t){return this.iconFontMap.get(t)||t}getGlyph(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}setFontOptions(t){this.fontOptions=V(V({},this.fontOptions),t),this.key=this.getKey();const e=this.getNewChars(this.key,this.fontOptions.characterSet),i=this.cache.get(this.key);if(i&&e.length===0)return;const n=this.generateFontAtlas(this.key,e,i);this.fontAtlas=n,this.cache.set(this.key,n)}addFontFace(t,e){const i=document.createElement("style");i.type="text/css",i.innerText=`
        @font-face{
            font-family: '${t}';
            src: url('${e}') format('woff2'),
            url('${e}') format('woff'),
            url('${e}') format('truetype');
        }`,i.onload=()=>{if(document.fonts)try{document.fonts.load(`24px ${t}`,"L7text"),document.fonts.ready.then(()=>{this.emit("fontloaded",{fontFamily:t})})}catch(n){console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(n)}},document.getElementsByTagName("head")[0].appendChild(i)}destroy(){this.cache.clear(),this.iconFontMap.clear()}generateFontAtlas(t,e,i){const{fontFamily:n,fontWeight:a,fontSize:o,buffer:s,sdf:l,radius:u,cutoff:c,iconfont:h}=this.fontOptions;let f=i&&i.data;f||(f=window.document.createElement("canvas"),f.width=s2);const d=f.getContext("2d",{willReadFrequently:!0});u2(d,n,o,a);const{mapping:v,canvasHeight:p,xOffset:g,yOffset:m}=UV(V({getFontWidth:_=>d.measureText(_).width,fontHeight:o*l2,buffer:s,characterSet:e,maxCanvasWidth:s2},i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset})),y=d.getImageData(0,0,f.width,f.height);if(f.height=p,d.putImageData(y,0,0),u2(d,n,o,a),l){const _=new Wz(o,s,u,c,n,a),x=d.getImageData(0,0,_.size,_.size);for(const C of e){if(h){const A=String.fromCharCode(parseInt(C.replace("&#x","").replace(";",""),16)),T=_.draw(A);c2(T,x)}else c2(_.draw(C),x);d.putImageData(x,v[C].x,v[C].y)}}else for(const _ of e)d.fillText(_,v[_].x,v[_].y+o*jV);return{xOffset:g,yOffset:m,mapping:v,data:f,width:f.width,height:f.height}}getKey(){const{fontFamily:t,fontWeight:e}=this.fontOptions;return`${t}_${e}`}getNewChars(t,e){const i=this.cache.get(t);if(!i)return e;const n=[],a=i.mapping,o=new Set(Object.keys(a));return new Set(e).forEach(l=>{o.has(l)||n.push(l)}),n}}const QV=3,h2=1024,Sh=64;class JV extends Ti.EventEmitter{constructor(...t){super(...t),E(this,"canvasHeight",128),E(this,"texture",void 0),E(this,"canvas",void 0),E(this,"iconData",void 0),E(this,"iconMap",void 0),E(this,"ctx",void 0),E(this,"loadingImageCount",0)}isLoading(){return this.loadingImageCount===0}init(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}addImage(t,e){var i=this;return X(function*(){let n=new Image;i.loadingImageCount++,i.hasImage(t)?console.warn("Image Id already exists"):i.iconData.push({id:t,size:Sh}),i.updateIconMap(),n=yield i.loadImage(e);const a=i.iconData.find(o=>o.id===t);a&&(a.image=n,a.width=n.width,a.height=n.height),i.update()})()}addImageMini(t,e,i){const n=i.getSceneConfig().canvas;let a=n.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:Sh}),this.updateIconMap(),this.loadImageMini(e,n).then(o=>{a=o;const s=this.iconData.find(l=>l.id===t);s&&(s.image=a,s.width=a.width,s.height=a.height),this.update()})}getTexture(){return this.texture}getIconMap(){return this.iconMap}getCanvas(){return this.canvas}hasImage(t){return this.iconMap.hasOwnProperty(t)}removeImage(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(e=>e.id!==t),delete this.iconMap[t],this.update())}destroy(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}loadImage(t){return new Promise((e,i)=>{if(t instanceof HTMLImageElement){e(t);return}const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{e(n)},n.onerror=()=>{i(new Error("Could not load image at "+t))},n.src=t instanceof File?URL.createObjectURL(t):t})}update(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}updateIconAtlas(){this.canvas.width=h2,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(t=>{const{x:e,y:i,image:n,width:a=64,height:o=64}=this.iconMap[t],l=Math.max(a,o)/Sh,u=o/l,c=a/l;n&&this.ctx.drawImage(n,e+(Sh-c)/2,i+(Sh-u)/2,c,u)})}updateIconMap(){const{mapping:t,canvasHeight:e}=zV(this.iconData,QV,h2);this.iconMap=t,this.canvasHeight=e}loadImageMini(t,e){return new Promise((i,n)=>{const a=e.createImage();a.crossOrigin="anonymous",a.onload=()=>{i(a)},a.onerror=()=>{n(new Error("Could not load image at "+t))},a.src=t})}}class tG{constructor(){E(this,"viewport",void 0),E(this,"overridedViewProjectionMatrix",void 0),E(this,"viewMatrixInverse",void 0),E(this,"cameraPosition",void 0)}init(){}update(t){this.viewport=t,this.viewMatrixInverse=jc(),mg(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}getProjectionMatrix(){return this.viewport.getProjectionMatrix()}getModelMatrix(){return this.viewport.getModelMatrix()}getViewMatrix(){return this.viewport.getViewMatrix()}getViewMatrixUncentered(){return this.viewport.getViewMatrixUncentered()}getViewProjectionMatrixUncentered(){return this.viewport.getViewProjectionMatrixUncentered()}getViewProjectionMatrix(){return this.overridedViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}getZoom(){return this.viewport.getZoom()}getZoomScale(){return this.viewport.getZoomScale()}getCenter(){const[t,e]=this.viewport.getCenter();return[t,e]}getFocalDistance(){return this.viewport.getFocalDistance()}getCameraPosition(){return this.cameraPosition}projectFlat(t,e){return this.viewport.projectFlat(t,e)}setViewProjectionMatrix(t){this.overridedViewProjectionMatrix=t}}const eG={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"};class rG{constructor(){E(this,"container",void 0),E(this,"controlCorners",void 0),E(this,"controlContainer",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"controls",[]),E(this,"unAddControls",[])}init(t,e){this.container=t.container,this.scene=e,this.mapsService=e.mapService,this.initControlPos()}addControl(t,e){e.mapService.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}getControlByName(t){return this.controls.find(e=>e.controlOption.name===t)}removeControl(t){const e=this.controls.indexOf(t);return e>-1&&this.controls.splice(e,1),t.remove(),this}addControls(){this.unAddControls.forEach(t=>{t.addTo(this.scene),this.controls.push(t)}),this.unAddControls=[]}destroy(){for(const t of this.controls)t.remove();this.controls=[],this.clearControlPos()}initControlPos(){const t=this.controlCorners={},e="l7-",i=this.controlContainer=Me("div",e+"control-container",this.container);function n(o=[]){const s=o.map(l=>e+l).join(" ");t[o.filter(l=>!["row","column"].includes(l)).join("")]=Me("div",s,i)}function a(o){return[...o.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),eG[o]]}Object.values(Ec).forEach(o=>{n(a(o))}),this.checkCornerOverlap()}clearControlPos(){for(const t in this.controlCorners)this.controlCorners[t]&&sn(this.controlCorners[t]);this.controlContainer&&sn(this.controlContainer)}checkCornerOverlap(){const t=window.MutationObserver;if(t)for(const e of Object.keys(this.controlCorners)){const i=e.match(/^(top|bottom)(left|right)$/);if(i){const[,n,a]=i,o=this.controlCorners[`${n}${a}`];new t(([{target:l}])=>{o&&(o.style[n]=l.clientHeight+"px")}).observe(this.controlCorners[`${a}${n}`],{childList:!0,attributes:!0})}}}}class iG{constructor(){E(this,"container",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"markers",[]),E(this,"markerLayers",[]),E(this,"unAddMarkers",[]),E(this,"unAddMarkerLayers",[])}addMarkerLayer(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}removeMarkerLayer(t){t.destroy(),this.markerLayers.indexOf(t);const e=this.markerLayers.indexOf(t);e>-1&&this.markerLayers.splice(e,1)}addMarker(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}addMarkers(){this.unAddMarkers.forEach(t=>{t.addTo(this.scene),this.markers.push(t)}),this.unAddMarkers=[]}addMarkerLayers(){this.unAddMarkerLayers.forEach(t=>{this.markerLayers.push(t),t.addTo(this.scene)}),this.unAddMarkers=[]}removeMarker(t){t.remove(),this.markers.indexOf(t);const e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}removeAllMarkers(){this.destroy()}init(t){this.scene=t,this.mapsService=t.mapService}destroy(){this.markers.forEach(t=>{t.remove()}),this.markers=[],this.markerLayers.forEach(t=>{t.destroy()}),this.markerLayers=[]}removeMakerLayerMarker(t){t.destroy()}}class nG{constructor(){E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"popups",[]),E(this,"unAddPopups",[])}get isMarkerReady(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}removePopup(t){t!=null&&t.isOpen()&&t.remove();const e=this.popups.indexOf(t);e>-1&&this.popups.splice(e,1);const i=this.unAddPopups.indexOf(t);i>-1&&this.unAddPopups.splice(i,1)}destroy(){this.popups.forEach(t=>t.remove())}addPopup(t){t&&t.getOptions().autoClose&&[...this.popups,...this.unAddPopups].forEach(e=>{e.getOptions().autoClose&&this.removePopup(e)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",()=>{this.removePopup(t)})}initPopup(){this.unAddPopups.length&&this.unAddPopups.forEach(t=>{this.addPopup(t),this.unAddPopups=[]})}init(t){this.scene=t,this.mapsService=t.mapService}}const aG={MapToken:"您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定 高德地图申请地址 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox地图申请地址 https://docs.mapbox.com/help/glossary/access-token/",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},{merge:oG}=tr,sG={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},lG={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:$0.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0};class uG{constructor(){E(this,"sceneConfigCache",{}),E(this,"layerConfigCache",{}),E(this,"layerAttributeConfigCache",{})}getSceneConfig(t){return this.sceneConfigCache[t]}getSceneWarninfo(t){return aG[t]}setSceneConfig(t,e){this.sceneConfigCache[t]=V(V({},sG),e)}getLayerConfig(t){return this.layerConfigCache[t]}setLayerConfig(t,e,i){this.layerConfigCache[e]=V({},oG({},this.sceneConfigCache[t],lG,i))}getAttributeConfig(t){return this.layerAttributeConfigCache[t]}setAttributeConfig(t,e){this.layerAttributeConfigCache[t]=V(V({},this.layerAttributeConfigCache[t]),e)}clean(){this.sceneConfigCache={},this.layerConfigCache={}}}const zy=Math.PI/180,cG=512,f2=4003e4;function d2({latitude:r=0,zoom:t=0,scale:e,highPrecision:i=!1,flipY:n=!1}){e=e!==void 0?e:Math.pow(2,t);const a={},o=cG*e,s=Math.cos(r*zy),l=o/360,u=l/s,c=o/f2/s;if(a.pixelsPerMeter=[c,-c,c],a.metersPerPixel=[1/c,-1/c,1/c],a.pixelsPerDegree=[l,-u,c],a.degreesPerPixel=[1/l,-1/u,1/c],i){const h=zy*Math.tan(r*zy)/s,f=l*h/2,d=o/f2*h,v=d/u*c;a.pixelsPerDegree2=[0,-f,d],a.pixelsPerMeter2=[v,0,v],n&&(a.pixelsPerDegree2[1]=-a.pixelsPerDegree2[1],a.pixelsPerMeter2[1]=-a.pixelsPerMeter2[1])}return n&&(a.pixelsPerMeter[1]=-a.pixelsPerMeter[1],a.metersPerPixel[1]=-a.metersPerPixel[1],a.pixelsPerDegree[1]=-a.pixelsPerDegree[1],a.degreesPerPixel[1]=-a.degreesPerPixel[1]),a}const hG=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];class fG{constructor(t){E(this,"needRefresh",!0),E(this,"coordinateSystem",void 0),E(this,"viewportCenter",void 0),E(this,"viewportCenterProjection",void 0),E(this,"pixelsPerDegree",void 0),E(this,"pixelsPerDegree2",void 0),E(this,"pixelsPerMeter",void 0),this.cameraService=t}refresh(t){const e=this.cameraService.getZoom(),i=t||this.cameraService.getCenter(),{pixelsPerMeter:n,pixelsPerDegree:a}=d2({latitude:i[1],zoom:e});this.viewportCenter=i,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=n,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Sc.LNGLAT?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Sc.LNGLAT_OFFSET&&this.calculateLnglatOffset(i,e),this.needRefresh=!1}getCoordinateSystem(){return this.coordinateSystem}setCoordinateSystem(t){this.coordinateSystem=t}getViewportCenter(){return this.viewportCenter}getViewportCenterProjection(){return this.viewportCenterProjection}getPixelsPerDegree(){return this.pixelsPerDegree}getPixelsPerDegree2(){return this.pixelsPerDegree2}getPixelsPerMeter(){return this.pixelsPerMeter}calculateLnglatOffset(t,e,i,n){const{pixelsPerMeter:a,pixelsPerDegree:o,pixelsPerDegree2:s}=d2({latitude:t[1],zoom:e,scale:i,flipY:n,highPrecision:!0});let l=this.cameraService.getViewMatrix();const u=this.cameraService.getProjectionMatrix();let c=df([],u,l);const h=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,e));this.viewportCenterProjection=vl([],[h[0],h[1],0,1],c),l=this.cameraService.getViewMatrixUncentered()||l,c=df([],u,l),c=df([],c,hG),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=a,this.pixelsPerDegree=o,this.pixelsPerDegree2=s}}class dG extends Ti.EventEmitter{constructor(...t){super(...t),E(this,"renderMap",new Map),E(this,"enable",!1),E(this,"renderEnable",!1),E(this,"cacheLogs",{})}setEnable(t){this.enable=!!t}log(t,e){if(!this.enable)return;const i=t.split(".");let n=null;i.forEach((a,o)=>{n!==null?(n[a]||(n[a]={}),o!==i.length-1&&(n=n[a])):(this.cacheLogs[a]||(this.cacheLogs[a]={}),o!==i.length-1&&(n=this.cacheLogs[a])),o===i.length-1&&(n[a]=V(V({time:Date.now()},n[a]),e))})}getLog(t){switch(typeof t){case"string":return this.cacheLogs[t];case"object":return t.map(e=>this.cacheLogs[e]).filter(e=>e!==void 0);case"undefined":return this.cacheLogs}}removeLog(t){delete this.cacheLogs[t]}generateRenderUid(){return this.renderEnable?U$():""}renderDebug(t){this.renderEnable=t}renderStart(t){if(!this.renderEnable||!this.enable)return;const e=this.renderMap.get(t)||{};this.renderMap.set(t,V(V({},e),{},{renderUid:t,renderStart:Date.now()}))}renderEnd(t){if(!this.renderEnable||!this.enable)return;const e=this.renderMap.get(t);if(e){const i=e.renderStart,n=Date.now();this.emit("renderEnd",V(V({},e),{},{renderEnd:n,renderDuration:n-i})),this.renderMap.delete(t)}}destroy(){this.cacheLogs=null,this.renderMap.clear()}}const vG={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"};class pG extends jC{get mapService(){return this.container.mapService}constructor(t){super(),E(this,"indragging",!1),E(this,"hammertime",void 0),E(this,"lastClickTime",0),E(this,"lastClickXY",[-1,-1]),E(this,"clickTimer",void 0),E(this,"$containter",void 0),E(this,"onDrag",e=>{const i=this.interactionEvent(e);i.type=vG[i.type],i.type==="dragging"?this.indragging=!0:this.indragging=!1,this.emit(Oi.Drag,i)}),E(this,"onHammer",e=>{e.srcEvent.stopPropagation();const i=this.interactionEvent(e);this.emit(Oi.Hover,i)}),E(this,"onTouch",e=>{const i=e.touches[0];this.onHover({clientX:i.clientX,clientY:i.clientY,type:"touchstart"})}),E(this,"onTouchEnd",e=>{if(e.changedTouches.length>0){const i=e.changedTouches[0];this.onHover({clientX:i.clientX,clientY:i.clientY,type:"touchend"})}}),E(this,"onTouchMove",e=>{const i=e.changedTouches[0];this.onHover({clientX:i.clientX,clientY:i.clientY,type:"touchmove"})}),E(this,"onHover",e=>{const{clientX:i,clientY:n}=e;let a=i,o=n;const s=e.type,l=this.mapService.getMapContainer();if(l){const{top:c,left:h}=l.getBoundingClientRect();a=a-h-l.clientLeft,o=o-c-l.clientTop}const u=this.mapService.containerToLngLat([a,o]);if(s==="click"){this.isDoubleTap(a,o,u);return}if(s==="touch"){this.isDoubleTap(a,o,u);return}s!=="click"&&s!=="dblclick"&&this.emit(Oi.Hover,{x:a,y:o,lngLat:u,type:s,target:e})}),this.container=t}init(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}destroy(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Oi.Hover)}triggerHover({x:t,y:e}){this.emit(Oi.Hover,{x:t,y:e})}triggerSelect(t){this.emit(Oi.Select,{featureId:t})}triggerActive(t){this.emit(Oi.Active,{featureId:t})}addEventListenerOnMap(){const t=this.mapService.getMapContainer();if(t){const e=new xh.Manager(t);e.add(new xh.Tap({event:"dblclick",taps:2})),e.add(new xh.Tap({event:"click"})),e.add(new xh.Pan({threshold:0,pointers:0})),e.add(new xh.Press({})),e.on("dblclick click",this.onHammer),e.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("touchstart",this.onTouch),t.addEventListener("touchend",this.onTouchEnd),t.addEventListener("mousemove",this.onHover),t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=e}}removeEventListenerOnMap(){const t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("touchstart",this.onTouch),t.removeEventListener("touchend",this.onTouchEnd),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}interactionEvent(t){const{type:e,pointerType:i}=t;let n,a;i==="touch"?(a=Math.floor(t.pointers[0].clientY),n=Math.floor(t.pointers[0].clientX)):(a=Math.floor(t.srcEvent.y),n=Math.floor(t.srcEvent.x));const o=this.mapService.getMapContainer();if(o){const{top:l,left:u}=o.getBoundingClientRect();n-=u,a-=l}const s=this.mapService.containerToLngLat([n,a]);return{x:n,y:a,lngLat:s,type:e,target:t.srcEvent}}isDoubleTap(t,e,i){const n=new Date().getTime();let a="click";n-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-e)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),a="dblclick",this.emit(Oi.Hover,{x:t,y:e,lngLat:i,type:a})):(this.lastClickTime=n,this.lastClickXY=[t,e],this.clickTimer=setTimeout(()=>{a="click",this.emit(Oi.Hover,{x:t,y:e,lngLat:i,type:a})},400))}}let gG=0;function mG(r){let t=r;if(typeof r=="string"&&(t=document.getElementById(r)),t){const e=document.createElement("div");return e.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,e.id=`l7-scene-${gG++}`,e.classList.add("l7-scene"),t.appendChild(e),e}return null}function yG(r){var t;let e=!0;if((r==null||(t=r.target)===null||t===void 0?void 0:t.target)instanceof HTMLElement){var i;let a=r==null||(i=r.target)===null||i===void 0?void 0:i.target;for(;a;){var n;const o=Array.from(a.classList);if(o.includes("l7-marker")||o.includes("l7-popup")){e=!1;break}a=(n=a)===null||n===void 0?void 0:n.parentElement}}return e}let $l=function(r){return r[r.SAMPLED=0]="SAMPLED",r[r.RENDER_TARGET=1]="RENDER_TARGET",r}({});class _G{constructor(t){var e=this;E(this,"pickedColors",void 0),E(this,"pickedTileLayers",[]),E(this,"pickingFBO",void 0),E(this,"width",0),E(this,"height",0),E(this,"alreadyInPicking",!1),E(this,"pickBufferScale",1),E(this,"pickFromPickingFBO",function(){var i=X(function*(n,{x:a,y:o,lngLat:s,type:l,target:u}){var c;let h=!1;const{readPixels:f,readPixelsAsync:d,getViewportSize:v,queryVerdorInfo:p}=e.rendererService,{width:g,height:m}=v(),{enableHighlight:y,enableSelect:_}=n.getLayerConfig(),x=a*Li,C=o*Li;if(x>g-1*Li||x<0||C>m-1*Li||C<0)return!1;let A;if(p()==="WebGPU"?A=yield d({x:Math.floor(x/e.pickBufferScale),y:Math.floor((m-(o+1)*Li)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}):A=f({x:Math.floor(x/e.pickBufferScale),y:Math.floor((m-(o+1)*Li)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}),e.pickedColors=A,A[0]!==0||A[1]!==0||A[2]!==0){const w=Ml(A),M=n.layerPickService.getFeatureById(w);w!==n.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");const O={x:a,y:o,type:l,lngLat:s,featureId:w,feature:M,target:u};M&&(h=!0,n.setCurrentPickId(w),e.triggerHoverOnLayer(n,O))}else{const w={x:a,y:o,lngLat:s,type:n.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:u,feature:null};e.triggerHoverOnLayer(n,V(V({},w),{},{type:"unpick"})),e.triggerHoverOnLayer(n,w),n.setCurrentPickId(null)}if(y&&n.layerPickService.highlightPickedFeature(A),_&&l==="click"&&((c=A)===null||c===void 0?void 0:c.toString())!==[0,0,0,0].toString()){const w=Ml(A);n.getCurrentSelectedId()===null||w!==n.getCurrentSelectedId()?(n.layerPickService.selectFeature(A),n.setCurrentSelectedId(w)):(n.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),n.setCurrentSelectedId(null))}return h});return function(n,a){return i.apply(this,arguments)}}()),this.container=t}get mapService(){return this.container.mapService}get rendererService(){return this.container.rendererService}get configService(){return this.container.globalConfigService}get interactionService(){return this.container.interactionService}get layerService(){return this.container.layerService}init(t){const{createTexture2D:e,createFramebuffer:i,getViewportSize:n}=this.rendererService;let{width:a,height:o}=n();this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,a=Math.round(a/this.pickBufferScale),o=Math.round(o/this.pickBufferScale);const s=e({width:a,height:o,usage:$l.RENDER_TARGET,label:"Picking Texture"});this.pickingFBO=i({color:s,depth:!0,width:a,height:o}),this.interactionService.on(Oi.Hover,this.pickingAllLayer.bind(this))}boxPickLayer(t,e,i){var n=this;return X(function*(){const{useFramebufferAsync:a,clear:o}=n.rendererService;n.resizePickingFBO(),t.hooks.beforePickingEncode.call(),yield a(n.pickingFBO,X(function*(){o({framebuffer:n.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.renderModels({ispick:!0})})),t.hooks.afterPickingEncode.call();const s=yield n.pickBox(t,e);i(s)})()}pickBox(t,e){var i=this;return X(function*(){const[n,a,o,s]=e.map(m=>{const y=m<0?0:m;return Math.floor(y*Li/i.pickBufferScale)}),{readPixelsAsync:l,getViewportSize:u}=i.rendererService,{width:c,height:h}=u();if(n>(c-1)*Li/i.pickBufferScale||o<0||a>(h-1)*Li/i.pickBufferScale||s<0)return[];const f=Math.min(c/i.pickBufferScale,o)-n,d=Math.min(h/i.pickBufferScale,s)-a,v=yield l({x:n,y:Math.floor(h/i.pickBufferScale-(s+1)),width:f,height:d,data:new Uint8Array(f*d*4),framebuffer:i.pickingFBO}),p=[],g={};for(let m=0;m<v.length/4;m=m+1){const y=v.slice(m*4,m*4+4),_=Ml(y);if(_!==-1&&!g[_]){const x=t.layerPickService.getFeatureById(_);p.push(V(V({},x),{},{pickedFeatureIdx:_})),g[_]=!0}}return p})()}handleCursor(t,e){const{cursor:i="",cursorEnabled:n}=t.getLayerConfig();if(n){const o=this.mapService.getType()==="amap"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),s=o==null?void 0:o.style.getPropertyValue("cursor");e==="unmousemove"&&s!==""?o==null||o.style.setProperty("cursor",""):e==="mousemove"&&(o==null||o.style.setProperty("cursor",i))}}destroy(){this.pickingFBO.destroy(),this.pickingFBO=null}pickingAllLayer(t){var e=this;return X(function*(){!e.layerService.needPick(t.type)||!e.isPickingAllLayer()||(e.alreadyInPicking=!0,yield e.pickingLayers(t),e.layerService.renderLayers(),e.alreadyInPicking=!1)})()}isPickingAllLayer(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}resizePickingFBO(){const{getViewportSize:t}=this.rendererService,{width:e,height:i}=t();(this.width!==e||this.height!==i)&&(this.pickingFBO.resize({width:Math.round(e/this.pickBufferScale),height:Math.round(i/this.pickBufferScale)}),this.width=e,this.height=i)}pickingLayers(t){var e=this;return X(function*(){const{clear:i,useFramebufferAsync:n}=e.rendererService;e.resizePickingFBO();const a=e.layerService.getRenderList();for(const o of a.filter(s=>s.needPick(t.type)).reverse()){yield n(e.pickingFBO,X(function*(){i({framebuffer:e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.layerPickService.pickRender(t)}));const s=yield e.pickFromPickingFBO(o,t);if(e.layerService.pickedLayerId=s?+o.id:-1,s&&!o.getLayerConfig().enablePropagation)break}})()}triggerHoverOnLayer(t,e){yG(e)&&(this.handleCursor(t,e.type),t.emit(e.type,e))}}class xG{constructor(t=!0){E(this,"autoStart",void 0),E(this,"startTime",0),E(this,"oldTime",0),E(this,"running",!1),E(this,"elapsedTime",0),this.autoStart=t}start(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=(typeof performance>"u"?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}const{throttle:v2}=tr;class CG extends Ti.EventEmitter{get renderService(){return this.container.rendererService}get mapService(){return this.container.mapService}get debugService(){return this.container.debugService}constructor(t){super(),E(this,"pickedLayerId",-1),E(this,"clock",new xG),E(this,"alreadyInRendering",!1),E(this,"layers",[]),E(this,"layerList",[]),E(this,"layerRenderID",void 0),E(this,"sceneInited",!1),E(this,"animateInstanceCount",0),E(this,"shaderPicking",!0),E(this,"enableRender",!0),E(this,"reRender",v2(()=>{this.renderLayers()},32)),E(this,"throttleRenderLayers",v2(()=>{this.renderLayers()},16)),this.container=t}needPick(t){return this.updateLayerRenderList(),this.layerList.some(e=>e.needPick(t))}add(t){this.layers.push(t),this.sceneInited&&t.init().then(()=>{this.renderLayers()})}addMask(t){this.sceneInited&&t.init().then(()=>{this.renderLayers()})}initLayers(){var t=this;return X(function*(){t.sceneInited=!0,t.layers.forEach(function(){var e=X(function*(i){i.startInit||(yield i.init(),t.updateLayerRenderList())});return function(i){return e.apply(this,arguments)}}())})()}getSceneInited(){return this.sceneInited}getRenderList(){return this.layerList}getLayers(){return this.layers}getLayer(t){return this.layers.find(e=>e.id===t)}getLayerByName(t){return this.layers.find(e=>e.name===t)}remove(t,e){var i=this;return X(function*(){e?e.layerChildren=e.layerChildren.filter(n=>n!==t):i.layers=i.layers.filter(n=>n!==t),t.destroy(),i.reRender(),i.emit("layerChange",i.layers)})()}removeAllLayers(){var t=this;return X(function*(){t.destroy(),t.reRender()})()}setEnableRender(t){this.enableRender=t}renderLayers(){var t=this;return X(function*(){if(t.alreadyInRendering||!t.enableRender)return;t.updateLayerRenderList();const e=t.debugService.generateRenderUid();t.debugService.renderStart(e),t.alreadyInRendering=!0,t.clear();for(const i of t.layerList)i.prerender();t.renderService.beginFrame();for(const i of t.layerList){const{enableMask:n}=i.getLayerConfig();i.masks.filter(a=>a.inited).length>0&&n&&t.renderMask(i.masks),i.getLayerConfig().enableMultiPassRenderer?yield i.renderMultiPass():i.render()}t.renderService.endFrame(),t.debugService.renderEnd(e),t.alreadyInRendering=!1})()}renderMask(t){let e=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});const i=t.length>1?yl.MULTIPLE:yl.SINGLE;for(const n of t)n.render({isStencil:!0,stencilType:i,stencilIndex:e++})}beforeRenderData(t){var e=this;return X(function*(){(yield t.hooks.beforeRenderData.promise())&&e.renderLayers()})()}renderTileLayerMask(t){let e=0;const{enableMask:i=!0}=t.getLayerConfig();let n=t.tileMask?1:0;const a=t.masks.filter(s=>s.inited);n=n+(i?a.length:1);const o=n>1?yl.MULTIPLE:yl.SINGLE;if((t.tileMask||a.length&&i)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),a.length&&i)for(const s of a)s.render({isStencil:!0,stencilType:o,stencilIndex:e++});t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:o,stencilIndex:e++,stencilOperation:$0.OR})}renderTileLayer(t){var e=this;return X(function*(){e.renderTileLayerMask(t),t.getLayerConfig().enableMultiPassRenderer?yield t.renderMultiPass():yield t.render()})()}updateLayerRenderList(){this.layerList=[],this.layers.filter(t=>t.inited).filter(t=>t.isVisible()).sort((t,e)=>t.zIndex-e.zIndex).forEach(t=>{this.layerList.push(t)})}destroy(){this.layers.forEach(t=>{t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}startAnimate(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}stopAnimate(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}getOESTextureFloat(){return this.renderService.extensionObject.OES_texture_float}enableShaderPick(){this.shaderPicking=!0}disableShaderPick(){this.shaderPicking=!1}getShaderPickStat(){return this.shaderPicking}clear(){const t=Le(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}runRender(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}stopRender(){window.cancelAnimationFrame(this.layerRenderID)}}const{isNil:EG}=tr;class SG{constructor(t){E(this,"name",void 0),E(this,"type",void 0),E(this,"scale",void 0),E(this,"descriptor",void 0),E(this,"featureBufferLayout",[]),E(this,"needRescale",!1),E(this,"needRemapping",!1),E(this,"needRegenerateVertices",!1),E(this,"featureRange",{startIndex:0,endIndex:1/0}),E(this,"vertexAttribute",void 0),E(this,"defaultCallback",e=>{if(e.length===0){var i;return((i=this.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return e.map((n,a)=>{var o;return((o=this.scale)===null||o===void 0?void 0:o.scalers[a].func)(n)})}),this.setProps(t)}setProps(t){Object.assign(this,t)}mapping(t){var e;if((e=this.scale)!==null&&e!==void 0&&e.callback){var i;const n=(i=this.scale)===null||i===void 0?void 0:i.callback(...t);if(!EG(n))return[n]}return this.defaultCallback(t)}resetDescriptor(){this.descriptor&&(this.descriptor.buffer.data=[])}}const AG=["buffer","update","name"],TG=["buffer","update","name"],bG={[b.FLOAT]:4,[b.UNSIGNED_BYTE]:1,[b.UNSIGNED_SHORT]:2};class wG{constructor(t){E(this,"attributesAndIndices",void 0),E(this,"attributes",[]),E(this,"triangulation",void 0),E(this,"featureLayout",{sizePerElement:0,elements:[]}),this.rendererService=t}registerStyleAttribute(t){let e=this.getLayerStyleAttribute(t.name||"");return e?e.setProps(t):(e=new SG(t),this.attributes.push(e)),e}unRegisterStyleAttribute(t){const e=this.attributes.findIndex(i=>i.name===t);e>-1&&this.attributes.splice(e,1)}updateScaleAttribute(t){this.attributes.forEach(e=>{var i;const n=e.name,a=(i=e.scale)===null||i===void 0?void 0:i.field;(t[n]||a&&t[a])&&(e.needRescale=!0,e.needRemapping=!0,e.needRegenerateVertices=!0)})}updateStyleAttribute(t,e,i){let n=this.getLayerStyleAttribute(t);n||(n=this.registerStyleAttribute(V(V({},e),{},{name:t})));const{scale:a}=e;a&&n&&(n.scale=a,n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0,i&&i.featureRange&&(n.featureRange=i.featureRange))}getLayerStyleAttributes(){return this.attributes}getLayerStyleAttribute(t){return this.attributes.find(e=>e.name===t)}getLayerAttributeScale(t){var e;const i=this.getLayerStyleAttribute(t),n=i==null||(e=i.scale)===null||e===void 0?void 0:e.scalers;return n&&n[0]?n[0].func:null}updateAttributeByFeatureRange(t,e,i=0,n,a){const o=this.attributes.find(s=>s.name===t);if(o&&o.descriptor){const{descriptor:s}=o,{update:l,buffer:u,size:c=0}=s,h=bG[u.type||b.FLOAT];if(l){const{elements:f,sizePerElement:d}=this.featureLayout,v=f.slice(i,n);if(!v.length)return;const{offset:p}=v[0],g=p*c*h,m=v.map(({featureIdx:y,vertices:_,normals:x},C)=>{const A=_.length/d,T=[];for(let w=0;w<A;w++){const M=x?x.slice(w*3,w*3+3):[];T.push(...l(e[y],y,_.slice(w*d,w*d+d),C,M))}return T}).flat();o.vertexAttribute.updateBuffer({data:m,offset:g}),a==null||a.emit(`legend:${t}`,a.getLegend(t))}}}createAttributesAndIndices(t,e,i,n){this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);const a=this.attributes.map(p=>(p.resetDescriptor(),p.descriptor));let o=0,s=0;const l=[];let u=3;t.forEach((p,g)=>{const{indices:m,vertices:y,normals:_,size:x,indexes:C,count:A}=this.triangulation(p,i);typeof A=="number"&&(s+=A),m.forEach(w=>{l.push(w+o)}),u=x;const T=y.length/x;this.featureLayout.sizePerElement=u,this.featureLayout.elements.push({featureIdx:g,vertices:y,normals:_,offset:o}),o+=T;for(let w=0;w<T;w++){const M=(_==null?void 0:_.slice(w*3,w*3+3))||[],O=y.slice(w*x,w*x+x);let P=0;C&&C[w]!==void 0&&(P=C[w]),a.forEach((D,z)=>{D&&D.update&&D.buffer.data.push(...D.update(p,g,O,w,M,P))})}});const{createAttribute:c,createBuffer:h,createElements:f}=this.rendererService,d={};a.forEach((p,g)=>{if(p){const{buffer:m,update:y,name:_}=p,x=$n(p,AG),C=c(V({buffer:h(m)},x));d[p.name||""]=C,this.attributes[g].vertexAttribute=C}});const v=f({data:l,type:b.UNSIGNED_INT,count:l.length});return this.attributesAndIndices={attributes:d,elements:v,count:s},Object.values(this.attributes).filter(p=>p.scale).forEach(p=>{const g=p.name;n==null||n.emit(`legend:${g}`,n.getLegend(g))}),this.attributesAndIndices}createAttributes(t,e){this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);const i=this.attributes.map(u=>(u.resetDescriptor(),u.descriptor));let n=0,a=3;t.forEach((u,c)=>{const{indices:h,vertices:f,normals:d,size:v,indexes:p}=this.triangulation(u);h.forEach(m=>{}),a=v;const g=f.length/v;this.featureLayout.sizePerElement=a,this.featureLayout.elements.push({featureIdx:c,vertices:f,normals:d,offset:n}),n+=g;for(let m=0;m<g;m++){const y=(d==null?void 0:d.slice(m*3,m*3+3))||[],_=f.slice(m*v,m*v+v);let x=0;p&&p[m]!==void 0&&(x=p[m]),i.forEach((C,A)=>{C&&C.update&&C.buffer.data.push(...C.update(u,c,_,m,y,x))})}});const{createAttribute:o,createBuffer:s}=this.rendererService,l={};return i.forEach((u,c)=>{if(u){const{buffer:h,update:f,name:d}=u,v=$n(u,TG),p=o(V({buffer:s(h)},v));l[u.name||""]=p,this.attributes[c].vertexAttribute=p}}),{attributes:l}}clearAllAttributes(){var t;this.attributes.forEach(e=>{e.vertexAttribute&&e.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}function dF(r,t,e,i){function n(a){return a instanceof e?a:new e(function(o){o(a)})}return new(e||(e=Promise))(function(a,o){function s(c){try{u(i.next(c))}catch(h){o(h)}}function l(c){try{u(i.throw(c))}catch(h){o(h)}}function u(c){c.done?a(c.value):n(c.value).then(s,l)}u((i=i.apply(r,t||[])).next())})}function vF(r,t){var e={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},i,n,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(c){return l([u,c])}}function l(u){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,n&&(a=u[0]&2?n.return:u[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,u[1])).done)return a;switch(n=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,n=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(a=e.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){e=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){e.label=u[1];break}if(u[0]===6&&e.label<a[1]){e.label=a[1],a=u;break}if(a&&e.label<a[2]){e.label=a[2],e.ops.push(u);break}a[2]&&e.ops.pop(),e.trys.pop();continue}u=t.call(r,e)}catch(c){u=[6,c],n=0}finally{i=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function hE(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),n,a=[],o;try{for(;(t===void 0||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return a}function fE(r,t,e){if(e||arguments.length===2)for(var i=0,n=t.length,a;i<n;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return r.concat(a||Array.prototype.slice.call(t))}function pF(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var _1={exports:{}},Sg={exports:{}},Uf={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e;function e(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1===0}r.exports=t.default})(Uf,Uf.exports);var Wi={},x1={exports:{}},C1={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var i=[],n=arguments.length;n--;)i[n]=arguments[n];var a=i.pop();return e.call(this,i,a)}},r.exports=t.default})(C1,C1.exports);var $s={};Object.defineProperty($s,"__esModule",{value:!0});$s.fallback=gF;$s.wrap=mF;var RG=$s.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,MG=$s.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,IG=$s.hasNextTick=typeof process=="object"&&typeof process.nextTick=="function";function gF(r){setTimeout(r,0)}function mF(r){return function(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];return r(function(){return t.apply(void 0,e)})}}var tf;RG?tf=queueMicrotask:MG?tf=setImmediate:IG?tf=process.nextTick:tf=gF;$s.default=mF(tf);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var e=C1.exports,i=s(e),n=$s,a=s(n),o=Wi;function s(h){return h&&h.__esModule?h:{default:h}}function l(h){return(0,o.isAsync)(h)?function(){for(var f=[],d=arguments.length;d--;)f[d]=arguments[d];var v=f.pop(),p=h.apply(this,f);return u(p,v)}:(0,i.default)(function(f,d){var v;try{v=h.apply(this,f)}catch(p){return d(p)}if(v&&typeof v.then=="function")return u(v,d);d(null,v)})}function u(h,f){return h.then(function(d){c(f,null,d)},function(d){c(f,d&&d.message?d:new Error(d))})}function c(h,f,d){try{h(f,d)}catch(v){(0,a.default)(function(p){throw p},v)}}r.exports=t.default})(x1,x1.exports);Object.defineProperty(Wi,"__esModule",{value:!0});Wi.isAsyncIterable=Wi.isAsyncGenerator=Wi.isAsync=void 0;var LG=x1.exports,OG=PG(LG);function PG(r){return r&&r.__esModule?r:{default:r}}function yF(r){return r[Symbol.toStringTag]==="AsyncFunction"}function FG(r){return r[Symbol.toStringTag]==="AsyncGenerator"}function BG(r){return typeof r[Symbol.asyncIterator]=="function"}function DG(r){if(typeof r!="function")throw new Error("expected a function");return yF(r)?(0,OG.default)(r):r}Wi.default=DG;Wi.isAsync=yF;Wi.isAsyncGenerator=FG;Wi.isAsyncIterable=BG;var Wl={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e;function e(i,n){if(n===void 0&&(n=i.length),!n)throw new Error("arity is undefined");function a(){for(var o=this,s=[],l=arguments.length;l--;)s[l]=arguments[l];return typeof s[n-1]=="function"?i.apply(this,s):new Promise(function(u,c){s[n-1]=function(h){for(var f=[],d=arguments.length-1;d-- >0;)f[d]=arguments[d+1];if(h)return c(h);u(f.length>1?f:f[0])},i.apply(o,s)})}return a}r.exports=t.default})(Wl,Wl.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e=Uf.exports,i=l(e),n=Wi,a=l(n),o=Wl.exports,s=l(o);function l(u){return u&&u.__esModule?u:{default:u}}t.default=(0,s.default)(function(u,c,h){var f=(0,i.default)(c)?[]:{};u(c,function(d,v,p){(0,a.default)(d)(function(g){for(var m,y=[],_=arguments.length-1;_-- >0;)y[_]=arguments[_+1];y.length<2&&(m=y,y=m[0]),f[v]=y,p(g)})},function(d){return h(d,f)})},3),r.exports=t.default})(Sg,Sg.exports);var E1={exports:{}},Ag={exports:{}},S1={exports:{}},zf={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e;function e(i){function n(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(i!==null){var s=i;i=null,s.apply(this,a)}}return Object.assign(n,i),n}r.exports=t.default})(zf,zf.exports);var A1={exports:{}},T1={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},r.exports=t.default})(T1,T1.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var e=Uf.exports,i=o(e),n=T1.exports,a=o(n);function o(h){return h&&h.__esModule?h:{default:h}}function s(h){var f=-1,d=h.length;return function(){return++f<d?{value:h[f],key:f}:null}}function l(h){var f=-1;return function(){var v=h.next();return v.done?null:(f++,{value:v.value,key:f})}}function u(h){var f=h?Object.keys(h):[],d=-1,v=f.length;return function p(){var g=f[++d];return g==="__proto__"?p():d<v?{value:h[g],key:g}:null}}function c(h){if((0,i.default)(h))return s(h);var f=(0,a.default)(h);return f?l(f):u(h)}r.exports=t.default})(A1,A1.exports);var Hf={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e;function e(i){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];if(i===null)throw new Error("Callback was already called.");var o=i;i=null,o.apply(this,n)}}r.exports=t.default})(Hf,Hf.exports);var b1={exports:{}},$f={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e={};t.default=e,r.exports=t.default})($f,$f.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var e=$f.exports,i=n(e);function n(o){return o&&o.__esModule?o:{default:o}}function a(o,s,l,u){var c=!1,h=!1,f=!1,d=0,v=0;function p(){d>=s||f||c||(f=!0,o.next().then(function(y){var _=y.value,x=y.done;if(!(h||c)){if(f=!1,x){c=!0,d<=0&&u(null);return}d++,l(_,v,g),v++,p()}}).catch(m))}function g(y,_){if(d-=1,!h){if(y)return m(y);if(y===!1){c=!0,h=!0;return}if(_===i.default||c&&d<=0)return c=!0,u(null);p()}}function m(y){h||(f=!1,c=!0,u(y))}p()}r.exports=t.default})(b1,b1.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e=zf.exports,i=d(e),n=A1.exports,a=d(n),o=Hf.exports,s=d(o),l=Wi,u=b1.exports,c=d(u),h=$f.exports,f=d(h);function d(v){return v&&v.__esModule?v:{default:v}}t.default=function(v){return function(p,g,m){if(m=(0,i.default)(m),v<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!p)return m(null);if((0,l.isAsyncGenerator)(p))return(0,c.default)(p,v,g,m);if((0,l.isAsyncIterable)(p))return(0,c.default)(p[Symbol.asyncIterator](),v,g,m);var y=(0,a.default)(p),_=!1,x=!1,C=0,A=!1;function T(M,O){if(!x)if(C-=1,M)_=!0,m(M);else if(M===!1)_=!0,x=!0;else{if(O===f.default||_&&C<=0)return _=!0,m(null);A||w()}}function w(){for(A=!0;C<v&&!_;){var M=y();if(M===null){_=!0,C<=0&&m(null);return}C+=1,g(M.value,M.key,(0,s.default)(T))}A=!1}w()}},r.exports=t.default})(S1,S1.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e=S1.exports,i=l(e),n=Wi,a=l(n),o=Wl.exports,s=l(o);function l(c){return c&&c.__esModule?c:{default:c}}function u(c,h,f,d){return(0,i.default)(h)(c,(0,a.default)(f),d)}t.default=(0,s.default)(u,4),r.exports=t.default})(Ag,Ag.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e=Ag.exports,i=o(e),n=Wl.exports,a=o(n);function o(l){return l&&l.__esModule?l:{default:l}}function s(l,u,c){return(0,i.default)(l,1,u,c)}t.default=(0,a.default)(s,3),r.exports=t.default})(E1,E1.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var e=Sg.exports,i=o(e),n=E1.exports,a=o(n);function o(l){return l&&l.__esModule?l:{default:l}}function s(l,u){return(0,i.default)(a.default,l,u)}r.exports=t.default})(_1,_1.exports);var W0=pF(_1.exports),Pa=function(){function r(){this.args=[],this.tasks=[]}return r.prototype.call=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];return this.args=e,W0(this.tasks)},r.prototype.tap=function(t,e){var i=this;this.tasks.push(function(n){e.apply(void 0,fE([],hE(i.args),!1)),n(null,t)})},r}(),p2={exports:{}},w1={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e=Uf.exports,i=g(e),n=$f.exports,a=g(n),o=Ag.exports,s=g(o),l=zf.exports,u=g(l),c=Hf.exports,h=g(c),f=Wi,d=g(f),v=Wl.exports,p=g(v);function g(x){return x&&x.__esModule?x:{default:x}}function m(x,C,A){A=(0,u.default)(A);var T=0,w=0,M=x.length,O=!1;M===0&&A(null);function P(D,z){D===!1&&(O=!0),O!==!0&&(D?A(D):(++w===M||z===a.default)&&A(null))}for(;T<M;T++)C(x[T],T,(0,h.default)(P))}function y(x,C,A){return(0,s.default)(x,1/0,C,A)}function _(x,C,A){var T=(0,i.default)(x)?m:y;return T(x,(0,d.default)(C),A)}t.default=(0,p.default)(_,3),r.exports=t.default})(w1,w1.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var e=w1.exports,i=o(e),n=Sg.exports,a=o(n);function o(l){return l&&l.__esModule?l:{default:l}}function s(l,u){return(0,a.default)(i.default,l,u)}r.exports=t.default})(p2,p2.exports);var R1={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e=zf.exports,i=c(e),n=Hf.exports,a=c(n),o=Wi,s=c(o),l=Wl.exports,u=c(l);function c(f){return f&&f.__esModule?f:{default:f}}function h(f,d){if(d=(0,i.default)(d),!Array.isArray(f))return d(new Error("First argument to waterfall must be an array of functions"));if(!f.length)return d();var v=0;function p(m){var y=(0,s.default)(f[v++]);y.apply(void 0,m.concat([(0,a.default)(g)]))}function g(m){for(var y=[],_=arguments.length-1;_-- >0;)y[_]=arguments[_+1];if(m!==!1){if(m||v===f.length)return d.apply(void 0,[m].concat(y));p(y)}}p([])}t.default=(0,u.default)(h),r.exports=t.default})(R1,R1.exports);var NG=pF(R1.exports),g2=function(){function r(){this.tasks=[]}return r.prototype.call=function(){return W0(this.tasks)},r.prototype.tap=function(t,e){this.tasks.push(function(i){var n=e();i(n,t)})},r}(),kG=function(){function r(){this.args=[],this.tasks=[]}return r.prototype.promise=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];return this.args=e,W0(this.tasks)},r.prototype.tapPromise=function(t,e){var i=this;this.tasks.push(function(n){return dF(i,void 0,void 0,function(){return vF(this,function(a){switch(a.label){case 0:return[4,e.apply(void 0,fE([],hE(this.args),!1))];case 1:return a.sent(),n(null,t),[2]}})})})},r}(),UG=function(){function r(){this.args=[],this.tasks=[]}return r.prototype.promise=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];return this.args=e,W0(this.tasks)},r.prototype.tapPromise=function(t,e){var i=this;this.tasks.push(function(n){return dF(i,void 0,void 0,function(){var a;return vF(this,function(o){switch(o.label){case 0:return[4,e.apply(void 0,fE([],hE(this.args),!1))];case 1:return a=o.sent(),n(a,t),[2]}})})})},r}(),zG=function(){function r(){this.tasks=[]}return r.prototype.promise=function(){return NG(this.tasks)},r.prototype.tapPromise=function(t,e){this.tasks.length===0?this.tasks.push(function(i){e().then(function(n){i(null,n)})}):this.tasks.push(function(i,n){e(i).then(function(a){n(null,a)})})},r}();let HG=class extends Ti.EventEmitter{get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get controlService(){return this.container.controlService}get configService(){return this.container.globalConfigService}get map(){return this.container.mapService}get coordinateSystemService(){return this.container.coordinateSystemService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get cameraService(){return this.container.cameraService}get interactionService(){return this.container.interactionService}get pickingService(){return this.container.pickingService}get shaderModuleService(){return this.container.shaderModuleService}get markerService(){return this.container.markerService}get popupService(){return this.container.popupService}constructor(t){super(),E(this,"destroyed",!1),E(this,"loaded",!1),E(this,"id",void 0),E(this,"inited",!1),E(this,"rendering",!1),E(this,"$container",void 0),E(this,"canvas",void 0),E(this,"markerContainer",void 0),E(this,"resizeDetector",void 0),E(this,"hooks",void 0),E(this,"handleWindowResized",()=>{this.emit("resize"),this.$container&&(this.initContainer(),this.coordinateSystemService.needRefresh=!0,this.render())}),E(this,"handleMapCameraChanged",e=>{this.cameraService.update(e),this.render()}),this.container=t,this.hooks={init:new kG},this.id=t.id}init(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",()=>this.render()),this.fontService.init(),this.hooks.init.tapPromise("initMap",X(function*(){e.debugService.log("map.mapInitStart",{type:e.map.version}),yield new Promise(i=>{e.map.onCameraChanged(n=>{e.cameraService.init(),e.cameraService.update(n),i()}),e.map.init()}),e.map.onCameraChanged(e.handleMapCameraChanged),e.map.addMarkerContainer(),e.markerService.addMarkers(),e.markerService.addMarkerLayers(),e.popupService.initPopup(),e.interactionService.init(),e.interactionService.on(Oi.Drag,e.addSceneEvent.bind(e))})),this.hooks.init.tapPromise("initRenderer",X(function*(){var i;const n=((i=e.map)===null||i===void 0?void 0:i.getOverlayContainer())||void 0;if(n?e.$container=n:e.$container=mG(e.configService.getSceneConfig(e.id).id||""),e.$container){const{canvas:o}=t;if(e.canvas=o||Me("canvas","",e.$container),e.setCanvas(),yield e.rendererService.init(e.canvas,e.configService.getSceneConfig(e.id),t.gl),e.registerContextLost(),e.initContainer(),e.resizeDetector=LH({strategy:"scroll"}),e.resizeDetector.listenTo(e.$container,e.handleWindowResized),window.matchMedia){var a;(a=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||a===void 0||a.addListener(e.handleWindowResized.bind("screen"))}}else console.error("容器 id 不存在");e.pickingService.init(e.id)})),this.render()}registerContextLost(){const t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",()=>this.emit("webglcontextlost"))}addLayer(t){this.layerService.sceneService=this,this.layerService.add(t)}addMask(t){this.layerService.sceneService=this,this.layerService.addMask(t)}render(){var t=this;return X(function*(){t.rendering||t.destroyed||(t.rendering=!0,t.inited?(yield t.layerService.initLayers(),yield t.layerService.renderLayers()):(yield t.hooks.init.promise(),t.destroyed&&t.destroy(),yield t.layerService.initLayers(),t.layerService.renderLayers(),t.controlService.addControls(),t.loaded=!0,t.emit("loaded"),t.inited=!0),t.rendering=!1)})()}addFontFace(t,e){this.fontService.addFontFace(t,e)}getSceneContainer(){return this.$container}exportPng(t){var e=this;return X(function*(){var i;const n=(i=e.$container)===null||i===void 0?void 0:i.getElementsByTagName("canvas")[0];return yield e.render(),t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png")})()}getSceneConfig(){return this.configService.getSceneConfig(this.id)}getPointSizeRange(){return this.rendererService.getPointSizeRange()}addMarkerContainer(){const t=this.$container.parentElement;t!==null&&(this.markerContainer=Me("div","l7-marker-container",t))}getMarkerContainer(){return this.markerContainer}destroy(){var t;if(!this.inited){this.destroyed=!0;return}this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(()=>{var e;(e=this.$container)===null||e===void 0||e.removeChild(this.canvas),this.canvas=null,this.rendererService.destroy()}),(t=this.$container)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.$container),this.emit("destroy")}initContainer(){var t,e;const i=Li,n=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,a=((e=this.$container)===null||e===void 0?void 0:e.clientHeight)||300,o=this.canvas;o&&(o.width=n*i,o.height=a*i),this.rendererService.viewport({x:0,y:0,width:i*n,height:i*a})}setCanvas(){var t,e;const i=Li,n=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,a=((e=this.$container)===null||e===void 0?void 0:e.clientHeight)||300,o=this.canvas;o.width=n*i,o.height=a*i,o.style.width="100%",o.style.height="100%"}addSceneEvent(t){this.emit(t.type,t)}};const{uniq:$G}=tr,m2="#define PI 3.14159265359",WG=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,VG=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,GG=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}


vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  return weight;
}
`,XG=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  float activeType = v_PickingResult.a;
  if(activeType > 0.0) {
    vec4 highLightColor =  activeType > 1.5 ? u_SelectColor : u_HighlightColor;
    highLightColor = highLightColor * COLOR_SCALE;
    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));
    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  }
  else {
    return color;
  }

  
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // 过滤多余的 shader 计算
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // 过滤多余的 shader 计算
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,YG=`layout(location = ATTRIBUTE_LOCATION_PICKING_COLOR) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// 判断当前点是否已经被 select 选中
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  if(u_PickingStage == PICKING_HIGHLIGHT) {
    if(isVertexPicked(pickingColor)) {
       v_PickingResult = vec4(pickingColor.rgb * COLOR_SCALE,HIGHLIGHT);
       return;
    }
    if(isVertexSelected(pickingColor)) {
     v_PickingResult = vec4(u_CurrentSelectedId.rgb * COLOR_SCALE,SELECT);
      return;
    }

  } else {
      v_PickingResult= vec4(pickingColor.rgb * COLOR_SCALE,NORMAL);
      return;
  }

  // // v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && (isVertexPicked(pickingColor) || isVertexPicked(u_CurrentSelectedId)));

  // // Stores the picking color so that the fragment shader can render it during picking
  // v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,y2=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_activeMix;
};`,jG=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,_2=`#define TILE_SIZE (512.0)
#define PI (3.1415926536)
#define WORLD_SCALE (TILE_SIZE / (PI * 2.0))
#define EARTH_CIRCUMFERENCE (40.03e6)

#define COORDINATE_SYSTEM_LNGLAT (1.0) // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET (2.0) // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE (3.0)
#define COORDINATE_SYSTEM_IDENTITY (4.0)
#define COORDINATE_SYSTEM_METER_OFFSET (5.0)

#pragma include "scene_uniforms"

const vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(radians(x) + PI, PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5)));
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}

// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1.0, 1.0);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (
    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&
      u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01 ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}

vec4 project_position(vec4 position, vec2 position64xyLow) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(
      vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w)
    );
  }
  if (
    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&
    u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01
  ) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  return position;
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_XY_LOW);
}

vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

// 适配纹理贴图的等像素大小
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance;
  }

  return pixel * 2.0 * u_FocalDistance;
}

// 在不论什么底图下需要统一处理的时候使用
float project_float_pixel(float pixel) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1
    return pixel * pow(2.0, 19.0 - u_Zoom) * u_FocalDistance;
  }

  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
    return meter;
  } else {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;

}

float project_pixel(float pixel) {
  return pixel * u_FocalDistance;
}

vec2 project_pixel(vec2 pixel) {
  return pixel * -1.0 * u_FocalDistance;
}

vec3 project_pixel(vec3 pixel) {
  return pixel * -1.0 * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}

bool isEqual(float a, float b) {
  return a < b + 0.001 && a > b - 0.001;
}

`,ZG=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,x2=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  float u_FocalDistance;
};
`,qG=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,C2=/precision\s+(high|low|medium)p\s+float/,E2=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,KG=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,QG=/void\s+main\s*\([^)]*\)\s*\{\n?/;class JG{constructor(){E(this,"moduleCache",{}),E(this,"rawContentCache",{})}registerBuiltinModules(){this.destroy(),this.registerModule("common",{vs:m2,fs:m2}),this.registerModule("decode",{vs:VG,fs:""}),this.registerModule("scene_uniforms",{vs:x2,fs:x2}),this.registerModule("picking_uniforms",{vs:y2,fs:y2}),this.registerModule("projection",{vs:_2,fs:_2}),this.registerModule("project",{vs:jG,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:qG}),this.registerModule("lighting",{vs:GG,fs:""}),this.registerModule("light",{vs:WG,fs:""}),this.registerModule("picking",{vs:YG,fs:XG}),this.registerModule("rotation_2d",{vs:ZG,fs:""})}registerModule(t,e){e.vs=e.vs.replace(/\r\n/g,`
`),e.fs=e.fs.replace(/\r\n/g,`
`);const{vs:i,fs:n,uniforms:a,defines:o,inject:s}=e,{content:l,uniforms:u}=Uy(i),{content:c,uniforms:h}=Uy(n);this.rawContentCache[t]={fs:c,defines:o,inject:s,uniforms:V(V(V({},u),h),a),vs:l}}getModule(t){let e=this.rawContentCache[t].vs,i=this.rawContentCache[t].fs;const{defines:n={},inject:a={}}=this.rawContentCache[t];let o={};a["vs:#decl"]&&(e=a["vs:#decl"]+e,o=Uy(a["vs:#decl"]).uniforms),a["vs:#main-start"]&&(e=e.replace(QG,p=>p+a["vs:#main-start"])),a["fs:#decl"]&&(i=a["fs:#decl"]+i),e=tX(n)+e;const{content:l,includeList:u}=this.processModule(e,[],"vs"),{content:c,includeList:h}=this.processModule(i,[],"fs"),f=$G(u.concat(h).concat(t)).reduce((p,g)=>V(V({},p),this.rawContentCache[g].uniforms),V({},o)),d=(C2.test(c)?"":E2)+l,v=(C2.test(c)?"":E2)+c;return this.moduleCache[t]={vs:d.trim(),fs:v.trim(),uniforms:f},this.moduleCache[t]}destroy(){this.moduleCache={},this.rawContentCache={}}processModule(t,e,i){return{content:t.replace(KG,(a,o)=>{const l=o.split(" ")[0].replace(/"/g,"");if(e.indexOf(l)>-1)return"";const u=this.rawContentCache[l][i];e.push(l);const{content:c}=this.processModule(u,e,i);return c}),includeList:e}}}function tX(r){return Object.keys(r).reduce((e,i)=>e+`#define ${i.toUpperCase()} ${r[i]}
`,`
`)}class dE{constructor(){E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"cameraService",void 0),E(this,"mapService",void 0),E(this,"interactionService",void 0),E(this,"layerService",void 0),E(this,"config",void 0)}getName(){return""}getType(){return Ud.Normal}init(t,e){this.config=e,this.rendererService=t.getContainer().rendererService,this.cameraService=t.getContainer().cameraService,this.mapService=t.getContainer().mapService,this.interactionService=t.getContainer().interactionService,this.layerService=t.getContainer().layerService,this.shaderModuleService=t.getContainer().shaderModuleService}render(t){}}class eX extends dE{getName(){return"clear"}init(t,e){super.init(t,e)}render(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}class rX{constructor(t){E(this,"passes",[]),E(this,"layer",void 0),E(this,"renderFlag",void 0),E(this,"width",0),E(this,"height",0),this.postProcessor=t}setLayer(t){this.layer=t}setRenderFlag(t){this.renderFlag=t}getRenderFlag(){return this.renderFlag}getPostProcessor(){return this.postProcessor}render(){var t=this;return X(function*(){for(const e of t.passes)yield e.render(t.layer);yield t.postProcessor.render(t.layer)})()}resize(t,e){(this.width!==t||this.height!==e)&&(this.postProcessor.resize(t,e),this.width=t,this.height=e)}add(t,e){t.getType()===Ud.PostProcessing?this.postProcessor.add(t,this.layer,e):(t.init(this.layer,e),this.passes.push(t))}insert(t,e,i){t.init(this.layer,e),this.passes.splice(i,0,t)}destroy(){this.passes.length=0}}class iX extends dE{constructor(...t){var e;super(...t),e=this,E(this,"pickingFBO",void 0),E(this,"layer",void 0),E(this,"width",0),E(this,"height",0),E(this,"alreadyInRendering",!1),E(this,"pickFromPickingFBO",({x:i,y:n,lngLat:a,type:o})=>{if(!this.layer.isVisible()||!this.layer.needPick(o))return;const{getViewportSize:s,readPixelsAsync:l,useFramebuffer:u}=this.rendererService,{width:c,height:h}=s(),{enableHighlight:f,enableSelect:d}=this.layer.getLayerConfig(),v=i*Li,p=n*Li;if(v>c||v<0||p>h||p<0)return;let g;u(this.pickingFBO,X(function*(){var m;if(g=yield l({x:Math.round(v),y:Math.round(h-(n+1)*Li),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:e.pickingFBO}),g[0]!==0||g[1]!==0||g[2]!==0){const y=Ml(g),_=e.layer.getSource().getFeatureById(y),x={x:i,y:n,type:o,lngLat:a,featureId:y,feature:_};_&&(e.layer.setCurrentPickId(y),e.triggerHoverOnLayer(x))}else{const y={x:i,y:n,lngLat:a,type:e.layer.getCurrentPickId()===null?"un"+o:"mouseout",featureId:null,feature:null};e.triggerHoverOnLayer(V(V({},y),{},{type:"unpick"})),e.triggerHoverOnLayer(y),e.layer.setCurrentPickId(null)}f&&e.highlightPickedFeature(g),d&&o==="click"&&((m=g)===null||m===void 0?void 0:m.toString())!==[0,0,0,0].toString()&&e.selectFeature(g)}))})}getType(){return Ud.Normal}getName(){return"pixelPicking"}init(t,e){super.init(t,e),this.layer=t;const{createTexture2D:i,createFramebuffer:n,getViewportSize:a}=this.rendererService,{width:o,height:s}=a(),l=i({width:o,height:s,wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE,label:"Picking Texture"});this.pickingFBO=n({color:l}),this.interactionService.on(Oi.Hover,this.pickFromPickingFBO),this.interactionService.on(Oi.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Oi.Active,this.highlightFeatureHandle.bind(this))}render(t){if(this.alreadyInRendering)return;const{getViewportSize:e,useFramebuffer:i,clear:n}=this.rendererService,{width:a,height:o}=e();this.alreadyInRendering=!0,(this.width!==a||this.height!==o)&&(this.pickingFBO.resize({width:a,height:o}),this.width=a,this.height=o),i(this.pickingFBO,()=>{n({framebuffer:this.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});const s=this.layer.multiPassRenderer.getRenderFlag();this.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),this.layer.multiPassRenderer.setRenderFlag(s),this.alreadyInRendering=!1})}triggerHoverOnLayer(t){this.layer.emit(t.type,t)}highlightPickedFeature(t){const[e,i,n]=t;this.layer.hooks.beforeHighlight.call([e,i,n]),this.layerService.renderLayers()}selectFeature(t){const[e,i,n]=t;this.layer.hooks.beforeSelect.call([e,i,n]),this.layerService.renderLayers()}selectFeatureHandle({featureId:t}){const e=xc(t);this.selectFeature(new Uint8Array(e))}highlightFeatureHandle({featureId:t}){const e=xc(t);this.highlightPickedFeature(new Uint8Array(e))}}class nX{constructor(t){E(this,"passes",[]),E(this,"readFBO",void 0),E(this,"writeFBO",void 0),this.rendererService=t,this.init()}getReadFBO(){return this.readFBO}getWriteFBO(){return this.writeFBO}getCurrentFBOTex(){const{getViewportSize:t,createTexture2D:e}=this.rendererService,{width:i,height:n}=t();return e({x:0,y:0,width:i,height:n,copy:!0})}getReadFBOTex(){var t=this;const{useFramebuffer:e}=this.rendererService;return new Promise(i=>{e(this.readFBO,X(function*(){i(t.getCurrentFBOTex())}))})}renderBloomPass(t,e){var i=this;return X(function*(){const n=yield i.getReadFBOTex();let a=0;for(;a<4;)yield e.render(t,n),i.swap(),a++})()}render(t){var e=this;return X(function*(){for(let i=0;i<e.passes.length;i++){const n=e.passes[i];n.setRenderToScreen(e.isLastEnabledPass(i)),n.getName()==="bloom"?yield e.renderBloomPass(t,n):(yield n.render(t),i!==e.passes.length-1&&e.swap())}})()}resize(t,e){this.readFBO.resize({width:t,height:e}),this.writeFBO.resize({width:t,height:e})}add(t,e,i){t.init(e,i),this.passes.push(t)}insert(t,e,i,n){t.init(i,n),this.passes.splice(e,0,t)}getPostProcessingPassByName(t){return this.passes.find(e=>e.getName()===t)}init(){const{createFramebuffer:t,createTexture2D:e}=this.rendererService;this.readFBO=t({color:e({width:1,height:1,wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE,usage:$l.RENDER_TARGET})}),this.writeFBO=t({color:e({width:1,height:1,wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE,usage:$l.RENDER_TARGET})})}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].isEnabled())return!1;return!0}swap(){const t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}class aX extends dE{getType(){return Ud.Normal}getName(){return"render"}init(t,e){super.init(t,e)}render(t){const{useFramebuffer:e,clear:i}=this.rendererService,n=t.multiPassRenderer.getPostProcessor().getReadFBO();e(n,()=>{i({color:[0,0,0,0],depth:1,stencil:0,framebuffer:n}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(a=>{a.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}const oX=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,sX=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:Hy}=tr;class lX extends Wo{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:sX,fs:oX});const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("blur-pass"),{width:n,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:V(V({},i),{},{u_ViewportSize:[n,a]})}}convertOptionsToUniforms(t){const e={};return Hy(t.bloomRadius)||(e.u_radius=t.bloomRadius),Hy(t.bloomIntensity)||(e.u_intensity=t.bloomIntensity),Hy(t.bloomBaseRadio)||(e.u_baseRadio=t.bloomBaseRadio),e}}const uX=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,cX=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:hX}=tr;class fX extends Wo{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:cX,fs:uX});const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("blur-pass"),{width:n,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:V(V({},i),{},{u_ViewportSize:[n,a]})}}convertOptionsToUniforms(t){const e={};return hX(t.blurRadius)||(e.u_BlurDir=[t.blurRadius,0]),e}}const dX=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,vX=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:pX}=tr;class gX extends Wo{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:vX,fs:dX});const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("blur-pass"),{width:n,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:V(V({},i),{},{u_ViewportSize:[n,a]})}}convertOptionsToUniforms(t){const e={};return pX(t.blurRadius)||(e.u_BlurDir=[0,t.blurRadius]),e}}const mX=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,yX=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class _X extends Wo{setupShaders(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:yX,fs:mX});const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("colorhalftone-pass"),{width:n,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:V(V({},i),{},{u_ViewportSize:[n,a]})}}}const xX=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,CX=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class EX extends Wo{setupShaders(){return this.shaderModuleService.registerModule("copy-pass",{vs:CX,fs:xX}),this.shaderModuleService.getModule("copy-pass")}}const SX=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,AX=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class TX extends Wo{setupShaders(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:AX,fs:SX});const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("hexagonalpixelate-pass"),{width:n,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:V(V({},i),{},{u_ViewportSize:[n,a]})}}}const bX=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,wX=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class RX extends Wo{setupShaders(){this.shaderModuleService.registerModule("ink-pass",{vs:wX,fs:bX});const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("ink-pass"),{width:n,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:V(V({},i),{},{u_ViewportSize:[n,a]})}}}const MX=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,IX=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class LX extends Wo{setupShaders(){return this.shaderModuleService.registerModule("noise-pass",{vs:IX,fs:MX}),this.shaderModuleService.getModule("noise-pass")}}const OX=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,PX=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`;class FX extends Wo{setupShaders(){return this.shaderModuleService.registerModule("sepia-pass",{vs:OX,fs:PX}),this.shaderModuleService.getModule("sepia-pass")}}const _F=new uG;let BX=0;function DX(){const r=new JG,t=new dG,e=new tG,i=new fG(e),n=new KV,a=new JV,o=new iG,s=new nG,l=new rG,u={id:`${BX++}`,globalConfigService:_F,shaderModuleService:r,debugService:t,cameraService:e,coordinateSystemService:i,fontService:n,iconService:a,markerService:o,popupService:s,controlService:l,customRenderService:{}},c=new CG(u);u.layerService=c;const h=new HG(u);u.sceneService=h;const f=new pG(u);u.interactionService=f;const d=new _G(u);u.pickingService=d;const v={clear:new eX,pixelPicking:new iX,render:new aX};u.normalPassFactory=g=>v[g];const p={copy:new EX,bloom:new lX,blurH:new fX,blurV:new gX,noise:new LX,sepia:new FX,colorHalftone:new _X,hexagonalPixelate:new TX,ink:new RX};return u.postProcessingPass=p,u.postProcessingPassFactory=g=>p[g],u}function gf(r){const t=V({},r);return t.postProcessor=new nX(t.rendererService),t.multiPassRenderer=new rX(t.postProcessor),t.styleAttributeService=new wG(t.rendererService),t}const Sv=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];let $r=function(r){return r.IMAGE="image",r.CUSTOMIMAGE="customImage",r.ARRAYBUFFER="arraybuffer",r.RGB="rgb",r.TERRAINRGB="terrainRGB",r.CUSTOMRGB="customRGB",r.CUSTOMARRAYBUFFER="customArrayBuffer",r.CUSTOMTERRAINRGB="customTerrainRGB",r}({});var xF=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),NX=(r,t,e,i)=>xF(void 0,null,function*(){return new Promise((n,a)=>{t({x:r.x,y:r.y,z:r.z},(o,s)=>{if(o||s.length===0){a(o);return}s&&m1([{data:s,bands:[0]}],e,i,(l,u)=>{l?a(l):u&&n(u)})})})}),kX=(r,t)=>xF(void 0,null,function*(){return new Promise((e,i)=>{t({x:r.x,y:r.y,z:r.z},(n,a)=>{if(n||!a){i(n);return}a instanceof ArrayBuffer?f$(a,(o,s)=>{o&&i(o),e(s)}):a instanceof HTMLImageElement?e(a):i(n)})})});function UX(r,t){return Array.isArray(r)?typeof r[0]=="string"?r.map(e=>ec(e,t)):r.map(e=>({url:ec(e.url,t),bands:e.bands||[0]})):ec(r,t)}function zX(r){return typeof r=="string"?[{url:r,bands:[0]}]:typeof r[0]=="string"?r.map(t=>({url:t,bands:[0]})):r}function S2(r,t){r.xhrCancel=()=>{t.map(e=>{e.abort()})}}var HX=Object.defineProperty,$X=Object.defineProperties,WX=Object.getOwnPropertyDescriptors,A2=Object.getOwnPropertySymbols,VX=Object.prototype.hasOwnProperty,GX=Object.prototype.propertyIsEnumerable,T2=(r,t,e)=>t in r?HX(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,b2=(r,t)=>{for(var e in t||(t={}))VX.call(t,e)&&T2(r,e,t[e]);if(A2)for(var e of A2(t))GX.call(t,e)&&T2(r,e,t[e]);return r},w2=(r,t)=>$X(r,WX(t)),CF=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),XX=(r,t,e,i,n)=>CF(void 0,null,function*(){const a=zX(t.url);if(a.length>1){const{rasterFiles:o,xhrList:s,errList:l}=yield YX(a,t);if(S2(r,s),l.length>0){e(l,null);return}m1(o,i,n,e)}else{const o=iE(t,(s,l)=>{if(s)e(s);else if(l){const u=[{data:l,bands:a[0].bands}];m1(u,i,n,e)}});S2(r,[o])}});function YX(r,t){return CF(this,null,function*(){const e=[],i=[],n=[];for(let a=0;a<r.length;a++){const o=r[a],s=w2(b2({},t),{url:o.url}),l=o.bands,{err:u,data:c,xhr:h}=yield u$(w2(b2({},s),{type:"arrayBuffer"}));u&&n.push(u),i.push(h),e.push({data:c,bands:l})}return{rasterFiles:e,xhrList:i,errList:n}})}var jX=Object.defineProperty,ZX=Object.defineProperties,qX=Object.getOwnPropertyDescriptors,R2=Object.getOwnPropertySymbols,KX=Object.prototype.hasOwnProperty,QX=Object.prototype.propertyIsEnumerable,M2=(r,t,e)=>t in r?jX(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Wp=(r,t)=>{for(var e in t||(t={}))KX.call(t,e)&&M2(r,e,t[e]);if(R2)for(var e of R2(t))QX.call(t,e)&&M2(r,e,t[e]);return r},EF=(r,t)=>ZX(r,qX(t)),SF=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),JX=(r,t,e,i)=>SF(void 0,null,function*(){const{format:n=AF,operation:a,requestParameters:o={}}=i,s=EF(Wp({},o),{url:UX(r,t)});return new Promise((l,u)=>{XX(e,s,(c,h)=>{c?u(c):h&&l(h)},n,a)})}),I2=(r,t,e,i)=>SF(void 0,null,function*(){let n;const a=Array.isArray(r)?r[0]:r;return i.wmtsOptions?n=((i==null?void 0:i.getURLFromTemplate)||fW)(a,Wp(Wp({},t),i.wmtsOptions)):n=((i==null?void 0:i.getURLFromTemplate)||ec)(a,t),new Promise((o,s)=>{var l;const u=f1(EF(Wp({},i==null?void 0:i.requestParameters),{url:n,type:((l=i==null?void 0:i.requestParameters)==null?void 0:l.type)||"arrayBuffer"}),(c,h)=>{c?s(c):h&&o(h)},i.transformResponse);e.xhrCancel=()=>u.cancel()})}),AF=()=>({rasterData:new Uint8Array([0]),width:1,height:1}),tY=Object.defineProperty,eY=Object.defineProperties,rY=Object.getOwnPropertyDescriptors,L2=Object.getOwnPropertySymbols,iY=Object.prototype.hasOwnProperty,nY=Object.prototype.propertyIsEnumerable,O2=(r,t,e)=>t in r?tY(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,P2=(r,t)=>{for(var e in t||(t={}))iY.call(t,e)&&O2(r,e,t[e]);if(L2)for(var e of L2(t))nY.call(t,e)&&O2(r,e,t[e]);return r},aY=(r,t)=>eY(r,rY(t)),oY={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};$r.ARRAYBUFFER,$r.RGB;function sY(r){return!!(Array.isArray(r)&&r.length===0||!Array.isArray(r)&&typeof r!="string")}function lY(r,t={}){if(sY(r))throw new Error("tile server url is error");const{extent:e=[1/0,1/0,-1/0,-1/0],coordinates:i}=t;let n=(t==null?void 0:t.dataType)||$r.IMAGE;n===$r.RGB&&(n=$r.ARRAYBUFFER);const a=(l,u)=>{switch(n){case $r.IMAGE:return I2(r,l,u,t);case $r.CUSTOMIMAGE:case $r.CUSTOMTERRAINRGB:return kX(u,t==null?void 0:t.getCustomData);case $r.ARRAYBUFFER:return JX(r,l,u,t);case $r.CUSTOMARRAYBUFFER:case $r.CUSTOMRGB:return NX(u,t==null?void 0:t.getCustomData,(t==null?void 0:t.format)||AF,t==null?void 0:t.operation);default:return I2(r,l,u,t)}},o=aY(P2(P2({},oY),t),{getTileData:a}),s=qc(i,e);return{data:r,dataArray:[{_id:1,coordinates:s}],tilesetOptions:o,isTile:!0}}var uY=Object.defineProperty,cY=Object.defineProperties,hY=Object.getOwnPropertyDescriptors,Tg=Object.getOwnPropertySymbols,TF=Object.prototype.hasOwnProperty,bF=Object.prototype.propertyIsEnumerable,F2=(r,t,e)=>t in r?uY(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,fY=(r,t)=>{for(var e in t||(t={}))TF.call(t,e)&&F2(r,e,t[e]);if(Tg)for(var e of Tg(t))bF.call(t,e)&&F2(r,e,t[e]);return r},dY=(r,t)=>cY(r,hY(t)),vY=(r,t)=>{var e={};for(var i in r)TF.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&Tg)for(var i of Tg(r))t.indexOf(i)<0&&bF.call(r,i)&&(e[i]=r[i]);return e};function pY(r,t){const e=t,{extent:i=[121.168,30.2828,121.384,30.4219],coordinates:n,width:a,height:o}=e,s=vY(e,["extent","coordinates","width","height"]);r.length<2&&console.warn("RGB解析需要2个波段的数据");const[l,u]=s.bands||[0,1],c=[r[l],r[u]],h=[];for(let v=0;v<c[0].length;v++)h.push((c[1][v]-c[0][v])/(c[1][v]+c[0][v]));const f=qc(n,i);return{_id:1,dataArray:[dY(fY({_id:1,data:h,width:a,height:o},s),{coordinates:f})]}}var gY=Object.defineProperty,mY=Object.defineProperties,yY=Object.getOwnPropertyDescriptors,bg=Object.getOwnPropertySymbols,wF=Object.prototype.hasOwnProperty,RF=Object.prototype.propertyIsEnumerable,B2=(r,t,e)=>t in r?gY(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,_Y=(r,t)=>{for(var e in t||(t={}))wF.call(t,e)&&B2(r,e,t[e]);if(bg)for(var e of bg(t))RF.call(t,e)&&B2(r,e,t[e]);return r},xY=(r,t)=>mY(r,yY(t)),CY=(r,t)=>{var e={};for(var i in r)wF.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&bg)for(var i of bg(r))t.indexOf(i)<0&&RF.call(r,i)&&(e[i]=r[i]);return e};function EY(r,t){const e=t,{extent:i,coordinates:n,width:a,height:o}=e,s=CY(e,["extent","coordinates","width","height"]);r.length<3&&console.warn("RGB解析需要三个波段的数据");const[l,u,c]=s.bands||[0,1,2],h=[r[l],r[u],r[c]],f=[],[d,v]=(s==null?void 0:s.countCut)||[2,98],p=(s==null?void 0:s.RMinMax)||rc(h[0],d,v),g=(s==null?void 0:s.GMinMax)||rc(h[1],d,v),m=(s==null?void 0:s.BMinMax)||rc(h[2],d,v);for(let x=0;x<h[0].length;x++)f.push(Math.max(0,h[0][x]-p[0])),f.push(Math.max(0,h[1][x]-g[0])),f.push(Math.max(0,h[2][x]-m[0]));const y=qc(n,i);return{_id:1,dataArray:[xY(_Y({_id:1,data:f,width:a,height:o,rMinMax:p,gMinMax:g,bMinMax:m},s),{coordinates:y})]}}var SY=Object.defineProperty,AY=Object.defineProperties,TY=Object.getOwnPropertyDescriptors,wg=Object.getOwnPropertySymbols,MF=Object.prototype.hasOwnProperty,IF=Object.prototype.propertyIsEnumerable,D2=(r,t,e)=>t in r?SY(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,bY=(r,t)=>{for(var e in t||(t={}))MF.call(t,e)&&D2(r,e,t[e]);if(wg)for(var e of wg(t))IF.call(t,e)&&D2(r,e,t[e]);return r},wY=(r,t)=>AY(r,TY(t)),RY=(r,t)=>{var e={};for(var i in r)MF.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&wg)for(var i of wg(r))t.indexOf(i)<0&&IF.call(r,i)&&(e[i]=r[i]);return e};function MY(r,t){const e=t,{extent:i,coordinates:n,min:a,max:o,width:s,height:l,format:u,operation:c}=e,h=RY(e,["extent","coordinates","min","max","width","height","format","operation"]);let f;if(u===void 0||iF(r))f=Array.from(r);else{const p=Array.isArray(r)?r:[r];f=cE(p,u,c)}const d=qc(n,i);return{_id:1,dataArray:[wY(bY({_id:1,data:f,width:s,height:l},h),{min:a,max:o,coordinates:d})]}}var IY=Object.defineProperty,LY=Object.defineProperties,OY=Object.getOwnPropertyDescriptors,N2=Object.getOwnPropertySymbols,PY=Object.prototype.hasOwnProperty,FY=Object.prototype.propertyIsEnumerable,k2=(r,t,e)=>t in r?IY(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,U2=(r,t)=>{for(var e in t||(t={}))PY.call(t,e)&&k2(r,e,t[e]);if(N2)for(var e of N2(t))FY.call(t,e)&&k2(r,e,t[e]);return r},BY=(r,t)=>LY(r,OY(t)),DY=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),NY={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},kY=r=>DY(void 0,null,function*(){return new Promise(t=>{const[e,i,n,a]=r.bounds,o={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,x:(e+n)/2,y:(i+a)/2},geometry:{type:"LineString",coordinates:[[n,a],[n,i],[e,i],[e,i]]}}]}}};t(o)})});function UY(r,t){const e=n=>kY(n),i=BY(U2(U2({},NY),t),{getTileData:e});return{data:r,dataArray:[],tilesetOptions:i,isTile:!0}}var zY=Object.defineProperty,z2=Object.getOwnPropertySymbols,HY=Object.prototype.hasOwnProperty,$Y=Object.prototype.propertyIsEnumerable,H2=(r,t,e)=>t in r?zY(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,LF=(r,t)=>{for(var e in t||(t={}))HY.call(t,e)&&H2(r,e,t[e]);if(z2)for(var e of z2(t))$Y.call(t,e)&&H2(r,e,t[e]);return r};function OF(r,t){const{radius:e=40,maxZoom:i=18,minZoom:n=0,zoom:a=2}=t;if(r.pointIndex){const l=r.pointIndex.getClusters(r.extent,Math.floor(a));return r.dataArray=WY(l),r}const o=new Xz({radius:e,minZoom:n,maxZoom:i}),s={type:"FeatureCollection",features:[]};return s.features=r.dataArray.map(l=>({type:"Feature",geometry:{type:"Point",coordinates:l.coordinates},properties:LF({},l)})),o.load(s.features),o}function WY(r){return r.map((t,e)=>LF({coordinates:t.geometry.coordinates,_id:e+1},t.properties))}function VY(r){if(r.length===0)throw new Error("max requires at least one data point");let t=r[0];for(let e=1;e<r.length;e++)r[e]>t&&(t=r[e]);return t}function GY(r){if(r.length===0)throw new Error("min requires at least one data point");let t=r[0];for(let e=1;e<r.length;e++)r[e]<t&&(t=r[e]);return t}function PF(r){if(r.length===0)return 0;let t=r[0],e=0,i;for(let n=1;n<r.length;n++)i=t+r[n]*1,Math.abs(t)>=Math.abs(r[n])?e+=t-i+r[n]:e+=r[n]-i+t,t=i;return t+e*1}function XY(r){if(r.length===0)throw new Error("mean requires at least one data point");return PF(r)/r.length}var YY={min:GY,max:VY,mean:XY,sum:PF},jY=Object.defineProperty,$2=Object.getOwnPropertySymbols,ZY=Object.prototype.hasOwnProperty,qY=Object.prototype.propertyIsEnumerable,W2=(r,t,e)=>t in r?jY(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Ah=(r,t)=>{for(var e in t||(t={}))ZY.call(t,e)&&W2(r,e,t[e]);if($2)for(var e of $2(t))qY.call(t,e)&&W2(r,e,t[e]);return r},V2=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),{cloneDeep:KY,isFunction:G2,isString:QY,mergeWith:JY}=tr;function tj(r,t){if(Array.isArray(t))return t}var ej=class extends Ti.EventEmitter{constructor(r,t){super(),this.type="source",this.isTile=!1,this.inited=!1,this.hooks={init:new Pa},this.parser={type:"geojson"},this.transforms=[],this.cluster=!1,this.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},this.invalidExtent=!1,this.dataArrayChanged=!1,this.cfg={autoRender:!0},this.originData=r,this.initCfg(t),this.init().then(()=>{this.inited=!0,this.emit("update",{type:"inited"})})}getSourceCfg(){return this.cfg}getClusters(r){return this.clusterIndex.getClusters(this.caculClusterExtent(2),r)}getClustersLeaves(r){return this.clusterIndex.getLeaves(r,1/0)}getParserType(){return this.parser.type}updateClusterData(r){const{method:t="sum",field:e}=this.clusterOptions;let i=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(r));this.clusterOptions.zoom=r,i.forEach(n=>{n.id||(n.properties.point_count=1)}),(e||G2(t))&&(i=i.map(n=>{const a=n.id;if(a){const s=this.clusterIndex.getLeaves(a,1/0).map(u=>u.properties);let l;if(QY(t)&&e){const u=dW(s,e);l=YY[t](u)}G2(t)&&(l=t(s)),n.properties.stat=l}else n.properties.point_count=1;return n})),this.data=bb("geojson")({type:"FeatureCollection",features:i}),this.executeTrans()}getFeatureById(r){const{type:t="geojson",geometry:e}=this.parser;if(t==="geojson"&&!this.cluster){const i=r<this.originData.features.length?this.originData.features[r]:"null",n=KY(i);if(n!=null&&n.properties&&(this.transforms.length!==0||this.dataArrayChanged)){const a=this.data.dataArray.find(o=>o._id===r);n.properties=a}return n}else return t==="json"&&e?this.data.dataArray.find(i=>i._id===r):r<this.data.dataArray.length?this.data.dataArray[r]:"null"}updateFeaturePropertiesById(r,t){this.data.dataArray=this.data.dataArray.map(e=>e._id===r?Ah(Ah({},e),t):e),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}getFeatureId(r,t){const e=this.data.dataArray.find(i=>i[r]===t);return e==null?void 0:e._id}setData(r,t){this.originData=r,this.dataArrayChanged=!1,this.initCfg(t),this.init().then(()=>{this.emit("update",{type:"update"})})}reloadAllTile(){var r;(r=this.tileset)==null||r.reloadAll()}reloadTilebyId(r,t,e){var i;(i=this.tileset)==null||i.reloadTileById(r,t,e)}reloadTileByLnglat(r,t,e){var i;(i=this.tileset)==null||i.reloadTileByLnglat(r,t,e)}getTileExtent(r,t){var e;return(e=this.tileset)==null?void 0:e.getTileExtent(r,t)}getTileByZXY(r,t,e){var i;return(i=this.tileset)==null?void 0:i.getTileByZXY(r,t,e)}reloadTileByExtent(r,t){var e;(e=this.tileset)==null||e.reloadTileByExtent(r,t)}destroy(){var r;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(r=this.tileset)==null||r.destroy()}processData(){return V2(this,null,function*(){return new Promise((r,t)=>{try{this.excuteParser(),this.initCluster(),this.executeTrans(),r({})}catch(e){t(e)}})})}initCfg(r){this.cfg=JY(this.cfg,r,tj);const t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=Ah(Ah({},this.clusterOptions),t.clusterOptions)))}init(){return V2(this,null,function*(){this.inited=!1,yield this.processData(),this.inited=!0})}excuteParser(){const r=this.parser,t=r.type||"geojson",e=bb(t);this.data=e(this.originData,r),this.tileset=this.initTileset(),!r.cancelExtent&&(this.extent=I$(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}setCenter(r){this.center=[(r[0]+r[2])/2,(r[1]+r[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}initTileset(){const{tilesetOptions:r}=this.data;return r?(this.isTile=!0,this.tileset?(this.tileset.updateOptions(r),this.tileset):new hW(Ah({},r))):void 0}executeTrans(){this.transforms.forEach(t=>{const{type:e}=t,i=r$(e)(this.data,t);Object.assign(this.data,i)})}initCluster(){if(!this.cluster)return;const r=this.clusterOptions||{};this.clusterIndex=OF(this.data,r)}caculClusterExtent(r){let t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=lE(Cg(this.extent),r)),t[0].concat(t[1])}};function rj(r,t){const{callback:e}=t;return e&&(r.dataArray=r.dataArray.filter(e)),r}var vE=6378e3;function ij(r,t){const e=r.dataArray,{size:i=10}=t,n=i/(2*Math.PI*vE)*(256<<20)/2,{gridHash:a,gridOffset:o}=nj(e,i),s=lj(a,o,t);return{yOffset:n,xOffset:n,radius:n,type:"grid",dataArray:s}}function nj(r,t){let e=1/0,i=-1/0,n;for(const l of r)n=l.coordinates[1],Number.isFinite(n)&&(e=n<e?n:e,i=n>i?n:i);const a=(e+i)/2,o=aj(t,a);if(o.xOffset<=0||o.yOffset<=0)return{gridHash:{},gridOffset:o};const s={};for(const l of r){const u=l.coordinates[1],c=l.coordinates[0];if(Number.isFinite(u)&&Number.isFinite(c)){const h=Math.floor((u+90)/o.yOffset),f=Math.floor((c+180)/o.xOffset),d=`${h}-${f}`;s[d]=s[d]||{count:0,points:[]},s[d].count+=1,s[d].points.push(l)}}return{gridHash:s,gridOffset:o}}function aj(r,t){const e=oj(r),i=sj(t,r);return{yOffset:e,xOffset:i}}function oj(r){return r/vE*(180/Math.PI)}function sj(r,t){return t/vE*(180/Math.PI)/Math.cos(r*Math.PI/180)}function lj(r,t,e){return Object.keys(r).reduce((i,n,a)=>{const o=n.split("-"),s=parseInt(o[0],10),l=parseInt(o[1],10),u={};if(e.field&&e.method){const c=KP(r[n].points,e.field);u[e.method]=qP[e.method](c)}return Object.assign(u,{_id:a,coordinates:Pn([-180+t.xOffset*(l+.5),-90+t.yOffset*(s+.5)]),rawData:r[n].points,count:r[n].count}),i.push(u),i},[])}var uj=Object.defineProperty,cj=Object.defineProperties,hj=Object.getOwnPropertyDescriptors,X2=Object.getOwnPropertySymbols,fj=Object.prototype.hasOwnProperty,dj=Object.prototype.propertyIsEnumerable,Y2=(r,t,e)=>t in r?uj(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,vj=(r,t)=>{for(var e in t||(t={}))fj.call(t,e)&&Y2(r,e,t[e]);if(X2)for(var e of X2(t))dj.call(t,e)&&Y2(r,e,t[e]);return r},pj=(r,t)=>cj(r,hj(t)),gj=6378e3;function mj(r,t){const e=r.dataArray,{size:i=10,method:n="sum"}=t,a=i/(2*Math.PI*gj)*(256<<20)/2,o=e.map(c=>{const[h,f]=Pn(c.coordinates);return pj(vj({},c),{coordinates:[h,f]})});return{dataArray:OH().radius(a).x(c=>c.coordinates[0]).y(c=>c.coordinates[1])(o).map((c,h)=>{if(t.field&&n){const f=KP(c,t.field);c[n]=qP[n](f)}return{[t.method]:c[n],count:c.length,rawData:c,coordinates:[c.x,c.y],_id:h}}),radius:a,xOffset:a,yOffset:a,type:"hexagon"}}var yj=Object.defineProperty,j2=Object.getOwnPropertySymbols,_j=Object.prototype.hasOwnProperty,xj=Object.prototype.propertyIsEnumerable,Z2=(r,t,e)=>t in r?yj(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,q2=(r,t)=>{for(var e in t||(t={}))_j.call(t,e)&&Z2(r,e,t[e]);if(j2)for(var e of j2(t))xj.call(t,e)&&Z2(r,e,t[e]);return r};function Cj(r,t){const{sourceField:e,targetField:i,data:n}=t,a={};return n.forEach(o=>{a[o[e]]=o}),r.dataArray=r.dataArray.map(o=>{const s=o[i];return q2(q2({},o),a[s])}),r}function Ej(r,t){const{callback:e}=t;return e&&(r.dataArray=r.dataArray.map(e)),r}xn("rasterTile",lY);xn("mvt",_V);xn("geojsonvt",VW);xn("testTile",UY);xn("geojson",MW);xn("jsonTile",nV);xn("image",aF);xn("csv",_W);xn("json",nF);xn("raster",PV);xn("rasterRgb",MY);xn("rgb",EY);xn("ndi",pY);Zc("cluster",OF);Zc("filter",rj);Zc("join",Cj);Zc("map",Ej);Zc("grid",ij);Zc("hexagon",mj);var V0=ej;let K2=class extends Ti.EventEmitter{getMarkerLayerContainerSize(){}constructor(t){super(),E(this,"markerOption",void 0),E(this,"popup",void 0),E(this,"mapsService",void 0),E(this,"lngLat",void 0),E(this,"scene",void 0),E(this,"added",!1),E(this,"preLngLat",{lng:0,lat:0}),E(this,"onMarkerDragStart",e=>{const i=this.mapsService.getContainer();if(!i)return;this.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});const{left:n,top:a}=i.getClientRects()[0],{x:o,y:s}=e;this.preLngLat=this.mapsService.containerToLngLat([o-n,s-a]),this.mapsService.on("mousemove",this.onMarkerDragMove),document.addEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragstart",this.lngLat)}),E(this,"onMarkerDragMove",e=>{const i=e.lngLat||e.lnglat,{lng:n,lat:a}=this.preLngLat,{lng:o,lat:s}=i,l={lng:this.lngLat.lng+o-n,lat:this.lngLat.lat+s-a};this.setLnglat(l),this.preLngLat=i,this.emit("dragging",l)}),E(this,"onMarkerDragEnd",()=>{this.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragend",this.lngLat)}),E(this,"eventHandle",e=>{this.polyfillEvent(e),this.emit(e.type,{target:e,data:this.markerOption.extData,lngLat:this.lngLat})}),E(this,"touchStartTime",void 0),this.markerOption=V(V({},this.getDefault()),t),R$(["update","onMove","onMapClick","updatePositionWhenZoom"],this),this.init()}getDefault(){return{element:void 0,anchor:z0.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1,overflowHide:!0}}addTo(t){this.scene=t,this.mapsService=t.mapService;const{element:e}=this.markerOption;return this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.mapsService.on("camerachange",this.update),this.update(),this.updateDraggable(),this.added=!0,this.emit("added"),this}remove(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();const{element:t}=this.markerOption;return t&&sn(t),this.popup&&this.popup.remove(),this}setLnglat(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}getLnglat(){return this.lngLat}getElement(){return this.markerOption.element}setElement(t){if(!this.added)return this.once("added",()=>{this.setElement(t)}),this;const{element:e}=this.markerOption;return e&&sn(e),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.updateDraggable(),this.update(),this}openPopup(){if(!this.added)return this.once("added",()=>{this.openPopup()}),this;const t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}closePopup(){this.added||this.once("added",()=>{this.closePopup()});const t=this.popup;return t&&t.remove(),this}setPopup(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}togglePopup(){const t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}getPopup(){return this.popup}getOffset(){return this.markerOption.offsets}setDraggable(t){this.markerOption.draggable=t,this.updateDraggable()}getDraggable(){return this.markerOption.draggable}getExtData(){return this.markerOption.extData}setExtData(t){this.markerOption.extData=t}update(){if(!this.mapsService)return;const{element:t,anchor:e}=this.markerOption;this.updatePosition(),XP(t,`${_g[e]}`)}updatePositionWhenZoom(t){if(!this.mapsService)return;const{element:e,offsets:i}=this.markerOption,{lng:n,lat:a}=this.lngLat;if(e){e.style.display="block",e.style.whiteSpace="nowrap";const{containerHeight:o,containerWidth:s,bounds:l}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!l)return;const u=t.map,c=t.center,h=t.zoom,f=u.DE(this.lngLat,h,c);if(f.x=Math.round(f.x+i[0]),f.y=Math.round(f.y-i[1]),Math.abs(l[0][0])>180||Math.abs(l[1][0])>180){if(f.x>s){const d=this.mapsService.lngLatToContainer([n-360,a]);f.x=d.x}if(f.x<0){const d=this.mapsService.lngLatToContainer([n+360,a]);f.x=d.x}}(f.x>s||f.x<0||f.y>o||f.y<0)&&(e.style.display="none"),e.style.left=f.x+"px",e.style.top=f.y+"px",e.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)"}}onMapClick(t){const{element:e}=this.markerOption;this.popup&&e&&this.togglePopup()}getCurrentContainerSize(){const t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}updateDraggable(){const{element:t}=this.markerOption;t==null||t.removeEventListener("mousedown",this.onMarkerDragStart),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.markerOption.draggable&&(t==null||t.addEventListener("mousedown",this.onMarkerDragStart))}updatePosition(){if(!this.mapsService)return;const{element:t,offsets:e}=this.markerOption,{lng:i,lat:n}=this.lngLat,a=this.mapsService.lngLatToContainer([i,n]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";const{containerHeight:o,containerWidth:s,bounds:l}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!l)return;if(Math.abs(l[0][0])>180||Math.abs(l[1][0])>180){if(a.x>s){const u=this.mapsService.lngLatToContainer([i-360,n]);a.x=u.x}if(a.x<0){const u=this.mapsService.lngLatToContainer([i+360,n]);a.x=u.x}}this.markerOption.overflowHide&&(a.x>s||a.x<0||a.y>o||a.y<0)&&(t.style.display="none"),t.style.left=a.x+e[0]+"px",t.style.top=a.y-e[1]+"px"}}init(){let{element:t}=this.markerOption;const{color:e,anchor:i}=this.markerOption;if(!t){t=Me("div"),this.markerOption.element=t;const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height","48px"),n.setAttributeNS(null,"width","48px"),n.setAttributeNS(null,"viewBox","0 0 1024 1024");const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",e),n.appendChild(a),t.appendChild(n)}Oo(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(n=>{var a,o;const s=((a=this.markerOption)===null||a===void 0?void 0:a.style)&&((o=this.markerOption)===null||o===void 0?void 0:o.style[n]);t&&(t.style[n]=s)}),HP(t,i,"marker")}registerMarkerEvent(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}unRegisterMarkerEvent(){const t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}polyfillEvent(t){!this.mapsService||this.mapsService.getType()!=="amap"||w$()||(t.type==="touchstart"&&(this.touchStartTime=Date.now()),t.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat}))}addDragHandler(t){return null}onUp(t){throw new Error("Method not implemented.")}};window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(r){try{let u=function(){s||(s=!0,a())},c=function(){try{o.documentElement.doScroll("left")}catch{return void setTimeout(c,50)}u()};var e=(e=document.getElementsByTagName("script"))[e.length-1],t=e.getAttribute("data-injectcss"),e=e.getAttribute("data-disable-injectsvg");if(!e){var i,n,a,o,s,l=function(h,f){f.parentNode.insertBefore(h,f)};if(t&&!r.__iconfont__svg__cssinject__){r.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(h){console&&console.log(h)}}i=function(){var h,f=document.createElement("div");f.innerHTML=r._iconfont_svg_string_3580659,(f=f.getElementsByTagName("svg")[0])&&(f.setAttribute("aria-hidden","true"),f.style.position="absolute",f.style.width=0,f.style.height=0,f.style.overflow="hidden",f=f,(h=document.body).firstChild?l(f,h.firstChild):h.appendChild(f))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(i,0):(n=function(){document.removeEventListener("DOMContentLoaded",n,!1),i()},document.addEventListener("DOMContentLoaded",n,!1)):document.attachEvent&&(a=i,o=r.document,s=!1,c(),o.onreadystatechange=function(){o.readyState=="complete"&&(o.onreadystatechange=null,u())})}}catch{}}(window);class ko extends jC{constructor(t){super(),E(this,"controlOption",void 0),E(this,"container",void 0),E(this,"isShow",void 0),E(this,"sceneContainer",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"renderService",void 0),E(this,"layerService",void 0),E(this,"controlService",void 0),E(this,"configService",void 0),ko.controlCount++,this.controlOption=V(V({},this.getDefault(t)),t||{})}getOptions(){return this.controlOption}setOptions(t){const e=this.getDefault(t);Object.entries(t).forEach(([i,n])=>{n===void 0&&(t[i]=e[i])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=V(V({},this.controlOption),t)}addTo(t){this.mapsService=t.mapService,this.renderService=t.rendererService,this.layerService=t.layerService,this.controlService=t.controlService,this.configService=t.globalConfigService,this.scene=t.sceneService,this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),Oo(this.container,"l7-control");const{className:e,style:i}=this.controlOption;return e&&this.setClassName(e),i&&this.setStyle(i),this.insertContainer(),this.emit("add",this),this}remove(){if(!this.mapsService)return this;sn(this.container),this.onRemove(),this.emit("remove",this)}onAdd(){return Me("div")}onRemove(){}show(){const t=this.container;Cc(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}hide(){const t=this.container;Oo(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}getDefault(t){return{position:Ec.TOPRIGHT,name:`${ko.controlCount}`}}getContainer(){return this.container}getIsShow(){return this.isShow}_refocusOnMap(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){const e=this.mapsService.getContainer();e!==null&&e.focus()}}setPosition(t=Ec.TOPLEFT){const e=this.controlService;return e&&e.removeControl(this),this.controlOption.position=t,e&&e.addControl(this,this.sceneContainer),this}setClassName(t){const e=this.container,{className:i}=this.controlOption;i&&Cc(e,i),t&&Oo(e,t)}setStyle(t){const e=this.container;t?e.setAttribute("style",t):e.removeAttribute("style")}insertContainer(){const t=this.controlOption.position,e=this.container;if(t instanceof Element)t.appendChild(e);else{const i=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?i.insertBefore(e,i.firstChild):i.appendChild(e)}}checkUpdateOption(t,e){return e.some(i=>i in t)}}E(ko,"controlCount",0);class Sj extends ko{constructor(...t){super(...t),E(this,"isDisable",!1),E(this,"button",void 0),E(this,"buttonText",void 0),E(this,"buttonIcon",void 0)}setIsDisable(t){if(this.isDisable=t,t){var e;(e=this.button)===null||e===void 0||e.setAttribute("disabled","true")}else{var i;(i=this.button)===null||i===void 0||i.removeAttribute("disabled")}}createButton(t=""){return Me("button",`l7-button-control ${t}`)}onAdd(){this.button=this.createButton(),this.isDisable=!1;const{title:t,btnText:e,btnIcon:i}=this.controlOption;return this.setBtnTitle(t),this.setBtnText(e),this.setBtnIcon(i),this.button}onRemove(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}setOptions(t){const{title:e,btnText:i,btnIcon:n}=t;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(e),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(n),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(i),super.setOptions(t)}setBtnTitle(t){var e;(e=this.button)===null||e===void 0||e.setAttribute("title",t??"")}setBtnIcon(t){if(this.buttonIcon&&sn(this.buttonIcon),t){var e;const a=(e=this.button)===null||e===void 0?void 0:e.firstChild;if(a){var i;(i=this.button)===null||i===void 0||i.insertBefore(t,a)}else{var n;(n=this.button)===null||n===void 0||n.appendChild(t)}this.buttonIcon=t}}setBtnText(t){if(this.button)if(Cc(this.button,"l7-button-control--row"),Cc(this.button,"l7-button-control--column"),t){let i=this.buttonText;if(!i){var e;i=Me("div","l7-button-control__text"),(e=this.button)===null||e===void 0||e.appendChild(i),this.buttonText=i}i.innerText=t,Oo(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(sn(this.buttonText),this.buttonText=void 0)}}class Rg extends Ti.EventEmitter{get buttonRect(){return this.button.getBoundingClientRect()}constructor(t,e){super(),E(this,"popperDOM",void 0),E(this,"contentDOM",void 0),E(this,"button",void 0),E(this,"option",void 0),E(this,"isShow",!1),E(this,"content",void 0),E(this,"timeout",null),E(this,"show",()=>this.isShow||!this.contentDOM.innerHTML?this:(this.resetPopperPosition(),Cc(this.popperDOM,"l7-popper-hide"),this.isShow=!0,this.option.unique&&Rg.conflictPopperList.forEach(i=>{i!==this&&i.isShow&&i.hide()}),this.emit("show"),window.addEventListener("pointerdown",this.onPopperUnClick),this)),E(this,"hide",()=>this.isShow?(Oo(this.popperDOM,"l7-popper-hide"),this.isShow=!1,this.emit("hide"),window.removeEventListener("pointerdown",this.onPopperUnClick),this):this),E(this,"setHideTimeout",()=>{this.timeout||(this.timeout=window.setTimeout(()=>{this.isShow&&(this.hide(),this.timeout=null)},300))}),E(this,"clearHideTimeout",()=>{this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null)}),E(this,"onBtnClick",()=>{this.isShow?this.hide():this.show()}),E(this,"onPopperUnClick",i=>{T$(i.target,[".l7-button-control",".l7-popper-content"])||this.hide()}),E(this,"onBtnMouseLeave",()=>{this.setHideTimeout()}),E(this,"onBtnMouseMove",()=>{this.clearHideTimeout(),!this.isShow&&this.show()}),this.button=t,this.option=e,this.init(),e.unique&&Rg.conflictPopperList.push(this)}getPopperDOM(){return this.popperDOM}getIsShow(){return this.isShow}getContent(){return this.content}setContent(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(kd(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}init(){const{trigger:t}=this.option;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}destroy(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),sn(this.popperDOM)}resetPopperPosition(){const t={},{container:e,offset:i=[0,0],placement:n}=this.option,[a,o]=i,s=this.button.getBoundingClientRect(),l=e.getBoundingClientRect(),{left:u,right:c,top:h,bottom:f}=S$(s,l);let d=!1,v=!1;/^(left|right)/.test(n)?(n.includes("left")?t.right=`${s.width+c}px`:n.includes("right")&&(t.left=`${s.width+u}px`),n.includes("start")?t.top=`${h}px`:n.includes("end")?t.bottom=`${f}px`:(t.top=`${h+s.height/2}px`,v=!0,t.transform=`translate(${a}px, calc(${o}px - 50%))`)):/^(top|bottom)/.test(n)&&(n.includes("top")?t.bottom=`${s.height+f}px`:n.includes("bottom")&&(t.top=`${s.height+h}px`),n.includes("start")?t.left=`${u}px`:n.includes("end")?t.right=`${c}px`:(t.left=`${u+s.width/2}px`,d=!0,t.transform=`translate(calc(${a}px - 50%), ${o}px)`)),t.transform=`translate(calc(${a}px - ${d?"50%":"0%"}), calc(${o}px - ${v?"50%":"0%"})`;const p=n.split("-");p.length&&Oo(this.popperDOM,p.map(g=>`l7-popper-${g}`).join(" ")),sE(this.popperDOM,E$(t))}createPopper(){const{container:t,className:e="",content:i}=this.option,n=Me("div",`l7-popper l7-popper-hide ${e}`),a=Me("div","l7-popper-content"),o=Me("div","l7-popper-arrow");return n.appendChild(a),n.appendChild(o),t.appendChild(n),this.popperDOM=n,this.contentDOM=a,i&&this.setContent(i),n}}E(Rg,"conflictPopperList",[]);const Mg=r=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");const e=document.createElementNS("http://www.w3.org/2000/svg","use");return e.setAttributeNS("http://www.w3.org/1999/xlink","href",`#${r}`),t.appendChild(e),t};class azt extends Sj{constructor(...t){var e;super(...t),e=this,E(this,"onClick",X(function*(){const{onExport:i}=e.controlOption;i==null||i(yield e.getImage())})),E(this,"mergeImage",X(function*(...i){var n,a;const{imageType:o}=e.controlOption,{width:s=0,height:l=0}=(n=(a=e.mapsService.getContainer())===null||a===void 0?void 0:a.getBoundingClientRect())!==null&&n!==void 0?n:{},u=document.createElement("canvas");u.width=s,u.height=l;const c=u.getContext("2d");return(yield Promise.all(i.map(f=>new Promise(d=>{const v=new Image;v.onload=()=>{d(v)},v.src=f})))).forEach(f=>{c==null||c.drawImage(f,0,0,s,l)}),u.toDataURL(`image/${o}`)}))}onAdd(){const t=super.onAdd();return t.addEventListener("click",this.onClick),t}getDefault(t){return V(V({},super.getDefault(t)),{},{title:"导出图片",btnIcon:Mg("l7-icon-export-picture"),imageType:"png"})}getImage(){var t=this;return X(function*(){const e=yield t.mapsService.exportMap("png"),i=yield t.scene.exportPng("png");return t.mergeImage(...[e,i].filter(n=>n))})()}}const Q2=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Po=(()=>{if(typeof document>"u")return!1;const r=Q2[0],t={};for(const e of Q2)if((e==null?void 0:e[1])in document){for(const[n,a]of e.entries())t[r[n]]=a;return t}return!1})(),J2={change:Po.fullscreenchange,error:Po.fullscreenerror};let Mn={request(r=document.documentElement,t){return new Promise((e,i)=>{const n=()=>{Mn.off("change",n),e()};Mn.on("change",n);const a=r[Po.requestFullscreen](t);a instanceof Promise&&a.then(n).catch(i)})},exit(){return new Promise((r,t)=>{if(!Mn.isFullscreen){r();return}const e=()=>{Mn.off("change",e),r()};Mn.on("change",e);const i=document[Po.exitFullscreen]();i instanceof Promise&&i.then(e).catch(t)})},toggle(r,t){return Mn.isFullscreen?Mn.exit():Mn.request(r,t)},onchange(r){Mn.on("change",r)},onerror(r){Mn.on("error",r)},on(r,t){const e=J2[r];e&&document.addEventListener(e,t,!1)},off(r,t){const e=J2[r];e&&document.removeEventListener(e,t,!1)},raw:Po};Object.defineProperties(Mn,{isFullscreen:{get:()=>!!document[Po.fullscreenElement]},element:{enumerable:!0,get:()=>{var r;return(r=document[Po.fullscreenElement])!==null&&r!==void 0?r:void 0}},isEnabled:{enumerable:!0,get:()=>!!document[Po.fullscreenEnabled]}});Po||(Mn={isEnabled:!1});class Aj extends ko{getDefault(){return{position:Ec.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}onAdd(){const t=Me("div","l7-control-logo");return this.setLogoContent(t),t}onRemove(){return null}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["img","href"])&&(kd(this.container),this.setLogoContent(this.container))}setLogoContent(t){const{href:e,img:i}=this.controlOption,n=Me("img");if(n.setAttribute("src",i),n.setAttribute("aria-label","AntV logo"),A$(n),e){const a=Me("a","l7-control-logo-link");a.target="_blank",a.href=e,a.rel="noopener nofollow",a.setAttribute("rel","noopener nofollow"),a.appendChild(n),t.appendChild(a)}else t.appendChild(n)}}let Tj=class extends ko{constructor(...t){super(...t),E(this,"mScale",void 0),E(this,"iScale",void 0),E(this,"update",()=>{const e=this.mapsService,{maxWidth:i}=this.controlOption,n=e.getSize()[1]/2,a=e.containerToLngLat([0,n]),o=e.containerToLngLat([i,n]),s=F$([a.lng,a.lat],[o.lng,o.lat]);this.updateScales(s)})}getDefault(t){return V(V({},super.getDefault(t)),{},{name:"scale",position:Ec.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}onAdd(){const e=Me("div","l7-control-scale");this.resetScaleLines(e);const{updateWhenIdle:i}=this.controlOption;return this.mapsService.on(i?"moveend":"mapmove",this.update),this.mapsService.on(i?"zoomend":"zoomchange",this.update),e}onRemove(){const{updateWhenIdle:t}=this.controlOption;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}updateScales(t){const{metric:e,imperial:i}=this.controlOption;e&&t&&this.updateMetric(t),i&&t&&this.updateImperial(t)}resetScaleLines(t){kd(t);const{metric:e,imperial:i,maxWidth:n,lockWidth:a}=this.controlOption;a&&sE(t,`width: ${n}px`),e&&(this.mScale=Me("div","l7-control-scale-line",t)),i&&(this.iScale=Me("div","l7-control-scale-line",t)),this.update()}updateScale(t,e,i){const{maxWidth:n}=this.controlOption;t.style.width=Math.round(n*i)+"px",t.innerHTML=e}getRoundNum(t){const e=Math.pow(10,(Math.floor(t)+"").length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}updateMetric(t){const e=this.getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this.updateScale(this.mScale,i,e/t)}updateImperial(t){const e=t*3.2808399;let i,n,a;e>5280?(i=e/5280,n=this.getRoundNum(i),this.updateScale(this.iScale,n+" mi",n/i)):(a=this.getRoundNum(e),this.updateScale(this.iScale,a+" ft",a/e))}};class bj{constructor(){E(this,"mapService",void 0),E(this,"fontService",void 0)}apply(t,{styleAttributeService:e,mapService:i,fontService:n}){var a=this;this.mapService=i,this.fontService=n,t.hooks.init.tapPromise("DataMappingPlugin",X(function*(){t.log(Ar.MappingStart,Vr.INIT),a.generateMaping(t,{styleAttributeService:e}),t.log(Ar.MappingEnd,Vr.INIT)})),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var o=X(function*(s){if(!s)return s;t.dataState.dataMappingNeedUpdate=!1,t.log(Ar.MappingStart,Vr.UPDATE);const l=a.generateMaping(t,{styleAttributeService:e});return t.log(Ar.MappingEnd,Vr.UPDATE),l});return function(s){return o.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",()=>{const o=t.getSource();if(t.layerModelNeedUpdate||!o||!o.inited)return;const s=e.getLayerStyleAttributes()||[],l=e.getLayerStyleAttribute("filter"),{dataArray:u}=o.data;if(Array.isArray(u)&&u.length===0)return;const c=s.filter(f=>f.needRemapping);let h=u;if(l!=null&&l.needRemapping&&l!==null&&l!==void 0&&l.scale&&(h=u.filter(f=>this.applyAttributeMapping(l,f)[0])),c.length){const f=this.mapping(t,c,h,t.getEncodedData());t.setEncodedData(f)}})}generateMaping(t,{styleAttributeService:e}){const i=e.getLayerStyleAttributes()||[],n=e.getLayerStyleAttribute("filter"),{dataArray:a}=t.getSource().data;let o=a;n!=null&&n.scale&&(o=a.filter(l=>this.applyAttributeMapping(n,l)[0])),o=t.processData(o);const s=this.mapping(t,i,o,void 0);return t.setEncodedData(s),t.emit("dataUpdate",null),!0}mapping(t,e,i,n){const a=e.filter(s=>s.scale!==void 0).filter(s=>s.name!=="filter"),o=i.map((s,l)=>{const u=n?n[l]:{},c=V({id:s._id,coordinates:s.coordinates},u);return a.forEach(h=>{let f=this.applyAttributeMapping(h,s);(h.name==="color"||h.name==="stroke")&&(f=f.map(d=>Le(d))),c[h.name]=Array.isArray(f)&&f.length===1?f[0]:f,h.name==="shape"&&(c.shape=this.fontService.getIconFontKey(c[h.name]))}),c});return e.forEach(s=>{s.needRemapping=!1}),this.adjustData2SimpleCoordinates(o),o}adjustData2SimpleCoordinates(t){t.length>0&&this.mapService.version==="SIMPLE"&&t.map(e=>{e.simpleCoordinate||(e.coordinates=this.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)})}unProjectCoordinates(t){if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){const e=[];return t.map(i=>{const n=[];i.map(a=>{n.push(this.mapService.simpleMapCoord.unproject(a))}),e.push(n)}),e}else{const e=[];return t.map(i=>{e.push(this.mapService.simpleMapCoord.unproject(i))}),e}}applyAttributeMapping(t,e){var i;if(!t.scale)return[];const n=(t==null||(i=t.scale)===null||i===void 0?void 0:i.scalers)||[],a=[];return n.forEach(({field:s})=>{var l;(e.hasOwnProperty(s)||((l=t.scale)===null||l===void 0?void 0:l.type)==="variable")&&a.push(e[s])}),t.mapping?t.mapping(a):[]}getArrowPoints(t,e){const i=[e[0]-t[0],e[1]-t[1]],n=B$(i);return[t[0]+n[0]*1e-4,t[1]+n[1]*1e-4]}}class wj{constructor(){E(this,"mapService",void 0)}apply(t){var e=this;this.mapService=t.getContainer().mapService,t.hooks.init.tapPromise("DataSourcePlugin",X(function*(){t.log(Ar.SourceInitStart,Vr.INIT);let i=t.getSource();if(!i){const{data:n,options:a}=t.sourceOption||t.defaultSourceConfig;i=new V0(n,a),t.setSource(i)}i.inited?(e.updateClusterData(t),t.log(Ar.SourceInitEnd,Vr.INIT)):yield new Promise(n=>{i.on("update",a=>{a.type==="inited"&&(e.updateClusterData(t),t.log(Ar.SourceInitEnd,Vr.INIT)),n(null)})})})),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",X(function*(){const i=e.updateClusterData(t),n=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,i||n}))}updateClusterData(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;const e=t.getSource(),i=e.cluster,{zoom:n=0}=e.clusterOptions,a=this.mapService.getZoom()-1,o=t.dataState.dataSourceNeedUpdate;return i&&o&&e.updateClusterData(Math.floor(a)),i&&Math.abs(t.clusterZoom-a)>=1?(n!==Math.floor(a)&&e.updateClusterData(Math.floor(a)),t.clusterZoom=a,!0):!1}}function Rj(r,t,e,i,n){var a=r*r,o=a*r;return((1-3*r+3*a-o)*t+(4-6*a+3*o)*e+(1+3*r+3*a-3*o)*i+o*n)/6}function Mj(r){var t=r.length-1;return function(e){var i=e<=0?e=0:e>=1?(e=1,t-1):Math.floor(e*t),n=r[i],a=r[i+1],o=i>0?r[i-1]:2*n-a,s=i<t-1?r[i+2]:2*a-n;return Rj((e-i/t)*t,o,n,a,s)}}function FF(r){return function(){return r}}function Ij(r,t){return function(e){return r+e*t}}function Lj(r,t,e){return r=Math.pow(r,e),t=Math.pow(t,e)-r,e=1/e,function(i){return Math.pow(r+i*t,e)}}function Oj(r){return(r=+r)==1?BF:function(t,e){return e-t?Lj(t,e,r):FF(isNaN(t)?e:t)}}function BF(r,t){var e=t-r;return e?Ij(r,e):FF(isNaN(r)?t:r)}(function r(t){var e=Oj(t);function i(n,a){var o=e((n=c1(n)).r,(a=c1(a)).r),s=e(n.g,a.g),l=e(n.b,a.b),u=BF(n.opacity,a.opacity);return function(c){return n.r=o(c),n.g=s(c),n.b=l(c),n.opacity=u(c),n+""}}return i.gamma=r,i})(1);function Pj(r){return function(t){var e=t.length,i=new Array(e),n=new Array(e),a=new Array(e),o,s;for(o=0;o<e;++o)s=c1(t[o]),i[o]=s.r||0,n[o]=s.g||0,a[o]=s.b||0;return i=r(i),n=r(n),a=r(a),s.opacity=1,function(l){return s.r=i(l),s.g=n(l),s.b=a(l),s+""}}}var Fj=Pj(Mj);function DF(r){let t,e=[];function i(n){return n??t}return i.invert=i,i.domain=i.range=n=>n?(e=n,n):e,i.unknown=n=>n?(t=n,n):t,i.copy=()=>DF().unknown(t),i}const{isNil:$y,isString:Bj,uniq:Dj}=tr,Nj=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,kj={[Se.LINEAR]:mH,[Se.POWER]:yH,[Se.LOG]:_H,[Se.IDENTITY]:DF,[Se.SEQUENTIAL]:xH,[Se.TIME]:CH,[Se.QUANTILE]:EH,[Se.QUANTIZE]:SH,[Se.THRESHOLD]:AH,[Se.CAT]:u1,[Se.DIVERGING]:TH};class Uj{constructor(){E(this,"scaleOptions",{})}apply(t,{styleAttributeService:e}){var i=this;t.hooks.init.tapPromise("FeatureScalePlugin",X(function*(){var n;t.log(Ar.ScaleInitStart,Vr.INIT),i.scaleOptions=t.getScaleOptions();const a=e.getLayerStyleAttributes(),o=(n=t.getSource())===null||n===void 0?void 0:n.data.dataArray;Array.isArray(o)&&o.length===0||(i.caculateScalesForAttributes(a||[],o),t.log(Ar.ScaleInitEnd,Vr.INIT))})),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var n=X(function*(a){if(!a)return a;t.log(Ar.ScaleInitStart,Vr.UPDATE),i.scaleOptions=t.getScaleOptions();const o=e.getLayerStyleAttributes(),s=t.getSource().data.dataArray;return Array.isArray(s)&&s.length===0||(i.caculateScalesForAttributes(o||[],s),t.log(Ar.ScaleInitEnd,Vr.UPDATE),t.layerModelNeedUpdate=!0),!0});return function(a){return n.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",()=>{if(t.layerModelNeedUpdate)return;this.scaleOptions=t.getScaleOptions();const n=e.getLayerStyleAttributes(),a=t.getSource().data.dataArray;if(!(Array.isArray(a)&&a.length===0)&&n){const o=n.filter(s=>s.needRescale);o.length&&this.caculateScalesForAttributes(o,a)}})}isNumber(t){return!isNaN(parseFloat(t))&&isFinite(t)}caculateScalesForAttributes(t,e){t.forEach(i=>{if(i.scale){const n=i.scale,a=i.scale.field;n.names=this.parseFields($y(a)?[]:a);const o=[];n.names.forEach(s=>{var l;o.push(this.createScale(s,i.name,(l=i.scale)===null||l===void 0?void 0:l.values,e))}),o.some(s=>s.type===bu.VARIABLE)?(n.type=bu.VARIABLE,o.forEach(s=>{if(!n.callback&&n.values!=="text"){var l;switch((l=s.option)===null||l===void 0?void 0:l.type){case Se.LOG:case Se.LINEAR:case Se.POWER:if(n.values&&n.values.length>2){const c=s.scale.ticks(n.values.length);s.scale.domain(c)}n.values?s.scale.range(n.values):s.scale.range(s.option.domain);break;case Se.QUANTILE:case Se.QUANTIZE:case Se.THRESHOLD:s.scale.range(n.values);break;case Se.IDENTITY:break;case Se.CAT:n.values?s.scale.range(n.values):s.scale.range(s.option.domain);break;case Se.DIVERGING:case Se.SEQUENTIAL:s.scale.interpolator(Fj(n.values));break}}if(n.values==="text"){var u;s.scale.range((u=s.option)===null||u===void 0?void 0:u.domain)}})):(n.type=bu.CONSTANT,n.defaultValues=o.map((s,l)=>s.scale(n.names[l]))),n.scalers=o.map(s=>({field:s.field,func:s.scale,option:s.option})),i.needRescale=!1}})}parseFields(t){return Array.isArray(t)?t:Bj(t)?t.split("*"):[t]}createScale(t,e,i,n){var a,o;const s=this.scaleOptions[e]&&((a=this.scaleOptions[e])===null||a===void 0?void 0:a.field)===t?this.scaleOptions[e]:this.scaleOptions[t],l={field:t,scale:void 0,type:bu.VARIABLE,option:s};if(!n||!n.length)return s&&s.type?l.scale=this.createDefaultScale(s):(l.scale=u1([t]),l.type=bu.CONSTANT),l;const u=(o=n.find(c=>!$y(c[t])))===null||o===void 0?void 0:o[t];if(this.isNumber(t)||$y(u)&&!s)l.scale=u1([t]),l.type=bu.CONSTANT;else{let c=s&&s.type||this.getDefaultType(u);i==="text"&&(c=Se.CAT),i===void 0&&(c=Se.IDENTITY);const h=this.createScaleConfig(c,t,s,n);l.scale=this.createDefaultScale(h),l.option=h}return l}getDefaultType(t){let e=Se.LINEAR;return typeof t=="string"&&(e=Nj.test(t)?Se.TIME:Se.CAT),e}createScaleConfig(t,e,i,n){const a=V(V({},i),{},{type:t});if(a!=null&&a.domain)return a;let o=[];if(t===Se.QUANTILE){const s=new Map;n==null||n.forEach(l=>{s.set(l._id,l[e])}),o=Array.from(s.values())}else o=(n==null?void 0:n.map(s=>s[e]))||[];if(t===Se.CAT||t===Se.IDENTITY)a.domain=Dj(o);else if(t===Se.QUANTILE)a.domain=o;else if(t===Se.DIVERGING){const s=yb(o),l=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(s[0]+s[1])/2;a.domain=[s[0],l,s[1]]}else a.domain=yb(o);return a}createDefaultScale({type:t,domain:e,unknown:i,clamp:n,nice:a}){const o=kj[t]();return e&&o.domain&&o.domain(e),i&&o.unknown(i),n!==void 0&&o.clamp&&o.clamp(n),a!==void 0&&o.nice&&o.nice(a),o}}class zj{apply(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",()=>{t.animateStatus&&t.models.forEach(i=>{i.addUniforms(V({},t.layerModel.getAnimateUniforms()))})})}}let Hj=class{apply(t){t.hooks.afterInit.tap("LayerMaskPlugin",()=>{const{maskLayers:e,enableMask:i}=t.getLayerConfig();!t.tileLayer&&e&&e.length>0&&t.updateLayerConfig({mask:i})})}};class $j{build(t){return X(function*(){t.prepareBuildModel(),yield t.buildModels()})()}initLayerModel(t){var e=this;return X(function*(){yield e.build(t),t.styleNeedUpdate=!1})()}prepareLayerModel(t){var e=this;return X(function*(){yield e.build(t),t.styleNeedUpdate=!1})()}apply(t){var e=this;t.hooks.init.tapPromise("LayerModelPlugin",X(function*(){if(t.getSource().isTile){t.prepareBuildModel();return}t.log(Ar.BuildModelStart,Vr.INIT),yield e.initLayerModel(t),t.log(Ar.BuildModelEnd,Vr.INIT)})),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=X(function*(n){return!n||t.getSource().isTile?!1:(t.log(Ar.BuildModelStart,Vr.UPDATE),yield e.prepareLayerModel(t),t.log(Ar.BuildModelEnd,Vr.UPDATE),!0)});return function(n){return i.apply(this,arguments)}}())}}class Wj{apply(t){t.hooks.afterInit.tap("LayerStylePlugin",()=>{const{autoFit:e,fitBoundsOptions:i}=t.getLayerConfig();e&&t.fitBounds(i),t.styleNeedUpdate=!1})}}const Vj=["type"],tw={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Gj={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Xj={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Yj={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function jj(r){const t={u_DirectionalLights:new Array(3).fill(V({},Xj)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(V({},Yj)),u_NumOfSpotLights:0};return(!r||!r.length)&&(r=[Gj]),r.forEach(e=>{let{type:i="directional"}=e,n=$n(e,Vj);const a=tw[i].lights,o=tw[i].num,s=t[o];t[a][s]=V(V({},t[a][s]),n),t[o]++}),t}class Zj{apply(t){t.hooks.beforeRender.tap("LightingPlugin",()=>{const{enableLighting:e}=t.getLayerConfig();e&&t.models.forEach(i=>i.addUniforms(V({},jj())))})}}function NF(r){return r.map(t=>(typeof t=="string"&&(t=[t,{}]),t))}function kF(r,t,e,i){const n=r.multiPassRenderer;return n.add(i("render")),NF(t).forEach(a=>{const[o,s]=a;n.add(e(o),s)}),n.add(e("copy")),n}class qj{constructor(){E(this,"enabled",void 0)}apply(t,{rendererService:e,postProcessingPassFactory:i,normalPassFactory:n}){t.hooks.init.tapPromise("MultiPassRendererPlugin",()=>{const{enableMultiPassRenderer:a,passes:o=[]}=t.getLayerConfig();this.enabled=!!a&&t.getLayerConfig().enableMultiPassRenderer!==!1,this.enabled&&(t.multiPassRenderer=kF(t,o,i,n),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",()=>{if(this.enabled){const{width:a,height:o}=e.getViewportSize();t.multiPassRenderer.resize(a,o)}})}}const ps={POSITION:0,POSITION_64LOW:1,COLOR:2,PICKING_COLOR:3,STROKE:4,OPACITY:5,OFFSETS:6,ROTATION:7,MAX:8};function Kj(r){switch(r){case"rotation":return{name:"Rotation",type:vt.Attribute,descriptor:{name:"a_Rotation",shaderLocation:ps.ROTATION,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{rotation:e=0}=t;return Array.isArray(e)?[e[0]]:[e]}}};case"stroke":return{name:"stroke",type:vt.Attribute,descriptor:{name:"a_Stroke",shaderLocation:ps.STROKE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:4,update:t=>{const{stroke:e=[1,1,1,1]}=t;return e}}};case"opacity":return{name:"opacity",type:vt.Attribute,descriptor:{name:"a_Opacity",shaderLocation:ps.OPACITY,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{opacity:e=1}=t;return[e]}}};case"offsets":return{name:"offsets",type:vt.Attribute,descriptor:{name:"a_Offsets",shaderLocation:ps.OFFSETS,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:2,update:t=>{const{offsets:e}=t;return e}}};default:return}}const{isNumber:Qj}=tr,wu={NONE:0,ENCODE:1,HIGHLIGHT:2};class Jj{constructor(){E(this,"pickingUniformMap",void 0)}pickOption2Array(){const t=[];return this.pickingUniformMap.forEach(e=>{Qj(e)?t.push(e):t.push(...e)}),t}updatePickOption(t,e){Object.keys(t).forEach(o=>{this.pickingUniformMap.set(o,t[o])});const i=e.getLayerConfig().pickingBuffer||0,n=Number(e.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",i),this.pickingUniformMap.set("u_shaderPick",n),e.getPickingUniformBuffer().subData({offset:0,data:this.pickOption2Array()})}apply(t,{styleAttributeService:e}){this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_activeMix",0]]),t.hooks.init.tapPromise("PixelPickingPlugin",()=>{const{enablePicking:i}=t.getLayerConfig();e.registerStyleAttribute({name:"pickingColor",type:vt.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:ps.PICKING_COLOR,buffer:{data:[],type:b.FLOAT},size:3,update:n=>{const{id:a}=n;return i?xc(a):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:i}=t.getLayerConfig();i&&t.isVisible()&&(this.updatePickOption({u_PickingStage:wu.ENCODE},t),t.models.forEach(n=>n.addUniforms({u_PickingStage:wu.ENCODE})))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:i}=t.getLayerConfig();i&&t.isVisible()&&(this.updatePickOption({u_PickingStage:wu.HIGHLIGHT},t),t.models.forEach(n=>n.addUniforms({u_PickingStage:wu.HIGHLIGHT})))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",i=>{const{highlightColor:n,activeMix:a=0}=t.getLayerConfig(),o=typeof n=="string"?Le(n):n||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Ml(new Uint8Array(i))});const s={u_PickingStage:wu.HIGHLIGHT,u_PickingColor:i,u_HighlightColor:o.map(l=>l*255),u_activeMix:a};this.updatePickOption(s,t),t.models.forEach(l=>l.addUniforms(s))}),t.hooks.beforeSelect.tap("PixelPickingPlugin",i=>{const{selectColor:n,selectMix:a=0}=t.getLayerConfig(),o=typeof n=="string"?Le(n):n||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Ml(new Uint8Array(i))});const s={u_PickingStage:wu.HIGHLIGHT,u_PickingColor:i,u_HighlightColor:o.map(l=>l*255),u_activeMix:a,u_CurrentSelectedId:i,u_SelectColor:o.map(l=>l*255)};this.updatePickOption(s,t),t.models.forEach(l=>l.addUniforms(s))})}}const tZ=["mvt","geojsonvt","testTile"];function eZ(r){const t=r.getSource();return tZ.includes(t.parser.type)}class rZ{apply(t,{styleAttributeService:e}){t.hooks.init.tapPromise("RegisterStyleAttributePlugin",()=>{eZ(t)||this.registerBuiltinAttributes(e,t)})}registerBuiltinAttributes(t,e){if(e.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t)}registerPositionAttribute(t){t.registerStyleAttribute({name:"position",type:vt.Attribute,descriptor:{name:"a_Position",shaderLocation:ps.POSITION,buffer:{data:[],type:b.FLOAT},size:3,update:(e,i,n)=>n.length===2?[n[0],n[1],0]:[n[0],n[1],n[2]]}})}registerColorAttribute(t){t.registerStyleAttribute({name:"color",type:vt.Attribute,descriptor:{name:"a_Color",shaderLocation:ps.COLOR,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:4,update:e=>{const{color:i}=e;return!i||!i.length?[1,1,1,1]:i}}})}}class iZ{constructor(){E(this,"cameraService",void 0),E(this,"coordinateSystemService",void 0),E(this,"rendererService",void 0),E(this,"mapService",void 0),E(this,"layerService",void 0)}apply(t,{rendererService:e,mapService:i,layerService:n,coordinateSystemService:a,cameraService:o}){this.rendererService=e,this.mapService=i,this.layerService=n,this.coordinateSystemService=a,this.cameraService=o;let s;this.rendererService.uniformBuffers[0]||(s=this.rendererService.createBuffer({data:new Float32Array(16*4+4*7),isUBO:!0,label:"renderUniformBuffer"}),this.rendererService.uniformBuffers[0]=s),t.hooks.beforeRender.tap("ShaderUniformPlugin",()=>{const l=t.getLayerConfig().tileOrigin;this.coordinateSystemService.refresh(l);const{width:u,height:c}=this.rendererService.getViewportSize(),{data:h,uniforms:f}=this.generateUBO(u,c);this.layerService.alreadyInRendering&&this.rendererService.uniformBuffers[0]&&this.rendererService.uniformBuffers[0].subData({offset:0,data:h}),this.rendererService.queryVerdorInfo()==="WebGL1"&&t.models.forEach(v=>{v.addUniforms(V(V({},f),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}generateUBO(t,e){const i=this.cameraService.getProjectionMatrix(),n=this.cameraService.getViewMatrix(),a=this.cameraService.getViewProjectionMatrix(),o=this.cameraService.getModelMatrix(),s=this.coordinateSystemService.getViewportCenterProjection(),l=this.coordinateSystemService.getPixelsPerDegree(),u=this.cameraService.getZoom(),c=this.coordinateSystemService.getPixelsPerDegree2(),h=this.cameraService.getZoomScale(),f=this.coordinateSystemService.getPixelsPerMeter(),d=this.coordinateSystemService.getCoordinateSystem(),v=this.cameraService.getCameraPosition(),p=window.devicePixelRatio,g=this.coordinateSystemService.getViewportCenter(),m=[t,e],y=this.cameraService.getFocalDistance();return{data:[...n,...i,...a,...o,...s,...l,u,...c,h,...f,d,...v,p,...g,...m,y,0,0,0],uniforms:{[el.ProjectionMatrix]:i,[el.ViewMatrix]:n,[el.ViewProjectionMatrix]:a,[el.Zoom]:u,[el.ZoomScale]:h,[el.FocalDistance]:y,[el.CameraPosition]:v,[Tu.CoordinateSystem]:d,[Tu.ViewportCenter]:g,[Tu.ViewportCenterProjection]:s,[Tu.PixelsPerDegree]:l,[Tu.PixelsPerDegree2]:c,[Tu.PixelsPerMeter]:f,u_ViewportSize:m,u_ModelMatrix:o,u_DevicePixelRatio:p}}}}class nZ{apply(t){t.hooks.beforeRender.tap("UpdateModelPlugin",()=>{t.layerModel&&t.layerModel.needUpdate().then(e=>{e&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",()=>{t.layerModelNeedUpdate=!1})}}class aZ{apply(t,{styleAttributeService:e}){t.hooks.init.tapPromise("UpdateStyleAttributePlugin",()=>{this.initStyleAttribute(t,{styleAttributeService:e})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",()=>{t.layerModelNeedUpdate||t.inited&&this.updateStyleAttribute(t,{styleAttributeService:e})})}updateStyleAttribute(t,{styleAttributeService:e}){const i=e.getLayerStyleAttributes()||[],n=e.getLayerStyleAttribute("filter");if(n&&n.needRegenerateVertices){t.layerModelNeedUpdate=!0,i.forEach(a=>a.needRegenerateVertices=!1);return}i.filter(a=>a.needRegenerateVertices).forEach(a=>{e.updateAttributeByFeatureRange(a.name,t.getEncodedData(),a.featureRange.startIndex,a.featureRange.endIndex,t),a.needRegenerateVertices=!1})}initStyleAttribute(t,{styleAttributeService:e}){(e.getLayerStyleAttributes()||[]).filter(n=>n.needRegenerateVertices).forEach(n=>{e.updateAttributeByFeatureRange(n.name,t.getEncodedData(),n.featureRange.startIndex,n.featureRange.endIndex),n.needRegenerateVertices=!1})}}function oZ(){return[new wj,new rZ,new Uj,new bj,new Wj,new Hj,new aZ,new nZ,new qj,new iZ,new zj,new Zj,new Jj,new $j]}const UF={[ss.additive]:{enable:!0,func:{srcRGB:b.ONE,dstRGB:b.ONE,srcAlpha:1,dstAlpha:1}},[ss.none]:{enable:!1},[ss.normal]:{enable:!0,func:{srcRGB:b.SRC_ALPHA,dstRGB:b.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}},[ss.subtractive]:{enable:!0,func:{srcRGB:b.ONE,dstRGB:b.ONE,srcAlpha:b.ZERO,dstAlpha:b.ONE_MINUS_SRC_COLOR},equation:{rgb:b.FUNC_SUBTRACT,alpha:b.FUNC_SUBTRACT}},[ss.max]:{enable:!0,func:{srcRGB:b.ONE,dstRGB:b.ONE},equation:{rgb:b.MAX_EXT}},[ss.min]:{enable:!0,func:{srcRGB:b.ONE,dstRGB:b.ONE},equation:{rgb:b.MIN_EXT}}};class sZ{constructor(t){E(this,"layer",void 0),this.layer=t}pickRender(t){const i=this.layer.getContainer().layerService,n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(t);n.hooks.beforePickingEncode.call(),i.renderTileLayerMask(n),n.renderModels({ispick:!0}),n.hooks.afterPickingEncode.call()}pick(t,e){var i=this;return X(function*(){const a=i.layer.getContainer().pickingService;return t.type==="RasterLayer"?i.pickRasterLayer(t,e):(i.pickRender(e),a.pickFromPickingFBO(t,e))})()}pickRasterLayer(t,e,i){const n=this.layer.getContainer(),a=n.pickingService,o=n.mapService,s=this.layer.getSource().extent,l=M$(e.lngLat,s),u={x:e.x,y:e.y,type:e.type,lngLat:e.lngLat,target:e,rasterValue:null},c=i||t;if(l){const h=this.readRasterValue(t,s,o,e.x,e.y);return u.rasterValue=h,a.triggerHoverOnLayer(c,u),!0}else return u.type=e.type==="mousemove"?"mouseout":"un"+e.type,a.triggerHoverOnLayer(c,V(V({},u),{},{type:"unpick"})),a.triggerHoverOnLayer(c,u),!1}readRasterValue(t,e,i,n,a){const o=t.getSource().data.dataArray[0],[s=0,l=0,u=10,c=-10]=e,h=i.lngLatToContainer([s,l]),f=i.lngLatToContainer([u,c]),d=f.x-h.x,v=h.y-f.y,p=[(n-h.x)/d,(a-f.y)/v],g=o.width||1,m=o.height||1,y=Math.floor(p[0]*g),_=Math.floor(p[1]*m),x=Math.max(0,_-1)*g+y;return o.data[x]}selectFeature(t){const e=this.layer,[i,n,a]=t;e.hooks.beforeSelect.call([i,n,a])}highlightPickedFeature(t){const[e,i,n]=t;this.layer.hooks.beforeHighlight.call([e,i,n])}getFeatureById(t){return this.layer.getSource().getFeatureById(t)}}class lZ{constructor(t){E(this,"layer",void 0),E(this,"rendererService",void 0),E(this,"colorTexture",void 0),E(this,"key",void 0),this.layer=t;const e=this.layer.getContainer();this.rendererService=e.rendererService}getColorTexture(t,e){const i=this.getTextureKey(t,e);return this.key===i?this.colorTexture:(this.createColorTexture(t,e),this.key=i,this.colorTexture)}createColorTexture(t,e){const{createTexture2D:i}=this.rendererService,n=this.getColorRampBar(t,e),a=i({data:new Uint8Array(n.data),width:n.width,height:n.height,flipY:!1,unorm:!0});return this.colorTexture=a,a}setColorTexture(t,e,i){this.key=this.getTextureKey(e,i),this.colorTexture=t}destroy(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}getColorRampBar(t,e){switch(t.type){case"cat":return v$(t);case"quantize":return p$(t);case"custom":return g$(t,e);case"linear":return d$(t,e);default:return $P(t)}}getTextureKey(t,e){var i;return`${t.colors.join("_")}_${t==null||(i=t.positions)===null||i===void 0?void 0:i.join("_")}_${t.type}_${e==null?void 0:e.join("_")}`}}const uZ=["passes"],cZ=["moduleName","vertexShader","fragmentShader","defines","inject","triangulation","styleOption","pickingEnabled"],{isEqual:Wy,isFunction:ew,isNumber:rw,isObject:Hr,isPlainObject:hZ,isUndefined:fZ}=tr;let iw=0;class uu extends Ti.EventEmitter{get shaderModuleService(){return this.container.shaderModuleService}get cameraService(){return this.container.cameraService}get coordinateService(){return this.container.coordinateSystemService}get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get pickingService(){return this.container.pickingService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get interactionService(){return this.container.interactionService}get mapService(){var t;return(t=this.container)===null||t===void 0?void 0:t.mapService}get normalPassFactory(){return this.container.normalPassFactory}constructor(t={}){super(),E(this,"id",`${iw++}`),E(this,"name",`${iw}`),E(this,"parent",void 0),E(this,"coordCenter",void 0),E(this,"type",void 0),E(this,"visible",!0),E(this,"zIndex",0),E(this,"minZoom",void 0),E(this,"maxZoom",void 0),E(this,"inited",!1),E(this,"layerModelNeedUpdate",!1),E(this,"pickedFeatureID",null),E(this,"selectedFeatureID",null),E(this,"styleNeedUpdate",!1),E(this,"rendering",void 0),E(this,"forceRender",!1),E(this,"clusterZoom",0),E(this,"layerType",void 0),E(this,"triangulation",void 0),E(this,"layerPickService",void 0),E(this,"textureService",void 0),E(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),E(this,"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),E(this,"hooks",{init:new UG,afterInit:new g2,beforeRender:new g2,beforeRenderData:new zG,afterRender:new Pa,beforePickingEncode:new Pa,afterPickingEncode:new Pa,beforeHighlight:new Pa(["pickedColor"]),afterHighlight:new Pa,beforeSelect:new Pa(["pickedColor"]),afterSelect:new Pa,beforeDestroy:new Pa,afterDestroy:new Pa}),E(this,"models",[]),E(this,"multiPassRenderer",void 0),E(this,"plugins",void 0),E(this,"startInit",!1),E(this,"sourceOption",void 0),E(this,"layerModel",void 0),E(this,"shapeOption",void 0),E(this,"tileLayer",void 0),E(this,"layerChildren",[]),E(this,"masks",[]),E(this,"configService",_F),E(this,"styleAttributeService",void 0),E(this,"layerSource",void 0),E(this,"postProcessingPassFactory",void 0),E(this,"animateOptions",{enable:!1}),E(this,"container",void 0),E(this,"encodedData",void 0),E(this,"currentPickId",null),E(this,"rawConfig",void 0),E(this,"needUpdateConfig",void 0),E(this,"encodeStyleAttribute",{}),E(this,"enableShaderEncodeStyles",[]),E(this,"enableDataEncodeStyles",[]),E(this,"pendingStyleAttributes",[]),E(this,"scaleOptions",{}),E(this,"animateStartTime",void 0),E(this,"animateStatus",!1),E(this,"isDestroyed",!1),E(this,"uniformBuffers",[]),E(this,"encodeDataLength",0),E(this,"sourceEvent",()=>{this.dataState.dataSourceNeedUpdate=!0;const e=this.getLayerConfig();e&&e.autoFit&&this.fitBounds(e.fitBoundsOptions),this.layerSource.getSourceCfg().autoRender&&setTimeout(()=>{this.reRender()},10)}),this.name=t.name||this.id,this.zIndex=t.zIndex||0,this.rawConfig=t,this.masks=t.maskLayers||[]}addMask(t){this.masks.push(t),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}removeMask(t){const e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1),this.updateLayerConfig({maskLayers:this.masks})}disableMask(){this.updateLayerConfig({enableMask:!1})}enableMask(){this.updateLayerConfig({enableMask:!0})}addMaskLayer(t){this.masks.push(t)}removeMaskLayer(t){const e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1),t.destroy()}getAttribute(t){return this.styleAttributeService.getLayerStyleAttribute(t)}getLayerConfig(){return this.configService.getLayerConfig(this.id)}updateLayerConfig(t){if(Object.keys(t).map(e=>{e in this.rawConfig&&(this.rawConfig[e]=t[e])}),!this.startInit)this.needUpdateConfig=V(V({},this.needUpdateConfig),t);else{const e=this.container.id;this.configService.setLayerConfig(e,this.id,V(V(V({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}setContainer(t){this.container=t}getContainer(){return this.container}addPlugin(t){return this.plugins.push(t),this}init(){var t=this;return X(function*(){const e=t.container.id;t.startInit=!0,t.configService.setLayerConfig(e,t.id,t.rawConfig),t.layerType=t.rawConfig.layerType;const{enableMultiPassRenderer:i,passes:n}=t.getLayerConfig();i&&n!==null&&n!==void 0&&n.length&&n.length>0&&t.mapService.on("mapAfterFrameChange",()=>{t.renderLayers()}),t.postProcessingPassFactory=t.container.postProcessingPassFactory,t.styleAttributeService=t.container.styleAttributeService,i&&(t.multiPassRenderer=t.container.multiPassRenderer,t.multiPassRenderer.setLayer(t)),t.pendingStyleAttributes.forEach(({attributeName:a,attributeField:o,attributeValues:s,updateOptions:l})=>{t.styleAttributeService.updateStyleAttribute(a,{scale:V({field:o},t.splitValuesAndCallbackInAttribute(s,o?void 0:t.getLayerConfig()[a]))},l)}),t.pendingStyleAttributes=[],t.plugins=oZ();for(const a of t.plugins)a.apply(t,t.container);t.layerPickService=new sZ(t),t.textureService=new lZ(t),t.log(Ar.LayerInitStart),yield t.hooks.init.promise(),t.log(Ar.LayerInitEnd),t.inited=!0,t.emit("inited",{target:t,type:"inited"}),t.emit("add",{target:t,type:"add"}),t.hooks.afterInit.call()})()}log(t,e="init"){var i;if(this.tileLayer||this.isTileLayer)return;const n=`${this.id}.${e}.${t}`,a={id:this.id,type:this.type};(i=this.debugService)===null||i===void 0||i.log(n,a)}updateModelData(t){t.attributes&&t.elements?this.models.map(e=>{e.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}setLayerPickService(t){this.layerPickService=t}prepareBuildModel(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});const{animateOption:t}=this.getLayerConfig();t!=null&&t.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}color(t,e,i){return this.updateStyleAttribute("color",t,e,i),this}texture(t,e,i){return this.updateStyleAttribute("texture",t,e,i),this}rotate(t,e,i){return this.updateStyleAttribute("rotate",t,e,i),this}size(t,e,i){return this.updateStyleAttribute("size",t,e,i),this}filter(t,e,i){const n=this.updateStyleAttribute("filter",t,e,i);return this.dataState.dataSourceNeedUpdate=n&&this.inited,this}shape(t,e,i){this.shapeOption={field:t,values:e};const n=this.updateStyleAttribute("shape",t,e,i);return this.dataState.dataSourceNeedUpdate=n&&this.inited,this}label(t,e,i){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:e,updateOptions:i}),this}animate(t){let e={};return Hr(t)?(e.enable=!0,e=V(V({},e),t)):e.enable=t,this.updateLayerConfig({animateOption:e}),this}source(t,e){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:e},this.clusterZoom=0,this)}setData(t,e){return this.inited?(this.dataUpdatelog(),this.layerSource.setData(t,e)):this.on("inited",()=>{this.dataUpdatelog(),this.layerSource.setData(t,e)}),this}dataUpdatelog(){this.log(Ar.SourceInitStart,Vr.UPDATE),this.layerSource.once("update",()=>{this.log(Ar.SourceInitEnd,Vr.UPDATE)})}style(t){const{passes:e}=t,i=$n(t,uZ);e&&NF(e).forEach(a=>{const o=this.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(a[0]);o&&o.updateOptions(a[1])}),i.borderColor&&(i.stroke=i.borderColor),i.borderWidth&&(i.strokeWidth=i.borderWidth);const n=i;return Object.keys(i).forEach(a=>{const o=i[a];Array.isArray(o)&&o.length===2&&!rw(o[0])&&!rw(o[1])&&(n[a]={field:o[0],value:o[1]})}),this.encodeStyle(n),this.updateLayerConfig(n),this}encodeStyle(t){Object.keys(t).forEach(e=>{[...this.enableShaderEncodeStyles,...this.enableDataEncodeStyles].includes(e)&&hZ(t[e])&&(t[e].field||t[e].value)&&!Wy(this.encodeStyleAttribute[e],t[e])?(this.encodeStyleAttribute[e]=t[e],this.updateStyleAttribute(e,t[e].field,t[e].value),this.inited&&(this.dataState.dataMappingNeedUpdate=!0)):this.encodeStyleAttribute[e]&&(delete this.encodeStyleAttribute[e],this.dataState.dataSourceNeedUpdate=!0)})}scale(t,e){const i=V({},this.scaleOptions);if(Hr(t)?this.scaleOptions=V(V({},this.scaleOptions),t):this.scaleOptions[t]=e,this.styleAttributeService&&!Wy(i,this.scaleOptions)){const n=Hr(t)?t:{[t]:e};this.styleAttributeService.updateScaleAttribute(n)}return this}renderLayers(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}prerender(){}render(t={}){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(t),this))}renderMultiPass(){var t=this;return X(function*(){t.encodeDataLength<=0&&!t.forceRender||(t.multiPassRenderer&&t.multiPassRenderer.getRenderFlag()?yield t.multiPassRenderer.render():t.renderModels())})()}active(t){const e={};return e.enableHighlight=Hr(t)?!0:t,Hr(t)?(e.enableHighlight=!0,t.color&&(e.highlightColor=t.color),t.mix&&(e.activeMix=t.mix)):e.enableHighlight=!!t,this.updateLayerConfig(e),this}setActive(t,e){if(Hr(t)){const{x:i=0,y:n=0}=t;this.updateLayerConfig({highlightColor:Hr(e)?e.color:this.getLayerConfig().highlightColor,activeMix:Hr(e)?e.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:n})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:Hr(e)?e.color:this.getLayerConfig().highlightColor,activeMix:Hr(e)?e.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(xc(t)).then(()=>{setTimeout(()=>{this.reRender()},1)})}select(t){const e={};return e.enableSelect=Hr(t)?!0:t,Hr(t)?(e.enableSelect=!0,t.color&&(e.selectColor=t.color),t.mix&&(e.selectMix=t.mix)):e.enableSelect=!!t,this.updateLayerConfig(e),this}setSelect(t,e){if(Hr(t)){const{x:i=0,y:n=0}=t;this.updateLayerConfig({selectColor:Hr(e)?e.color:this.getLayerConfig().selectColor,selectMix:Hr(e)?e.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:n})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:Hr(e)?e.color:this.getLayerConfig().selectColor,selectMix:Hr(e)?e.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(xc(t)).then(()=>{setTimeout(()=>{this.reRender()},1)})}setBlend(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}show(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}hide(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}setIndex(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}setCurrentPickId(t){this.currentPickId=t}getCurrentPickId(){return this.currentPickId}setCurrentSelectedId(t){this.selectedFeatureID=t}getCurrentSelectedId(){return this.selectedFeatureID}isVisible(){const t=this.mapService.getZoom(),{visible:e,minZoom:i=-1/0,maxZoom:n=1/0}=this.getLayerConfig();return!!e&&t>=i&&t<n}setMultiPass(t,e){if(this.updateLayerConfig({enableMultiPassRenderer:t}),e&&this.updateLayerConfig({passes:e}),t){const{passes:i=[]}=this.getLayerConfig();this.multiPassRenderer=kF(this,i,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);const{width:n,height:a}=this.rendererService.getViewportSize();this.multiPassRenderer.resize(n,a)}return this}setMinZoom(t){return this.updateLayerConfig({minZoom:t}),this}getMinZoom(){const{minZoom:t}=this.getLayerConfig();return t}getMaxZoom(){const{maxZoom:t}=this.getLayerConfig();return t}get(t){return this.getLayerConfig()[t]}setMaxZoom(t){return this.updateLayerConfig({maxZoom:t}),this}setAutoFit(t){return this.updateLayerConfig({autoFit:t}),this}fitBounds(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;const i=this.getSource().extent;return i.some(a=>Math.abs(a)===1/0)?this:(this.mapService.fitBounds([[i[0],i[1]],[i[2],i[3]]],t),this)}destroy(t=!0){var e,i,n,a,o;if(this.isDestroyed)return;(e=this.layerModel)===null||e===void 0||e.uniformBuffers.forEach(l=>{l.destroy()}),this.layerChildren.map(l=>l.destroy(!1)),this.layerChildren=[];const{maskfence:s}=this.getLayerConfig();s&&(this.masks.map(l=>l.destroy(!1)),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(i=this.multiPassRenderer)===null||i===void 0||i.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(n=this.layerModel)===null||n===void 0||n.clearModels(t),(a=this.tileLayer)===null||a===void 0||a.destroy(),this.models=[],(o=this.debugService)===null||o===void 0||o.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}clear(){this.styleAttributeService.clearAllAttributes()}clearModels(){var t;this.models.forEach(e=>e.destroy()),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}isDirty(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(t=>t.needRescale||t.needRemapping||t.needRegenerateVertices).length}setSource(t){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){const e=this.mapService.getZoom();this.layerSource.updateClusterData(e)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",({type:e})=>{if(this.coordCenter===void 0){const i=this.layerSource.center;this.coordCenter=i}if(e==="update"){if(this.tileLayer){this.tileLayer.reload();return}this.sourceEvent()}})}getSource(){return this.layerSource}getScaleOptions(){return this.scaleOptions}setEncodedData(t){this.encodedData=t,this.encodeDataLength=t.length}getEncodedData(){return this.encodedData}getScale(t){return this.styleAttributeService.getLayerAttributeScale(t)}getLegend(t){var e,i,n;const a=this.styleAttributeService.getLayerStyleAttribute(t);return{type:(i=((a==null||(e=a.scale)===null||e===void 0?void 0:e.scalers)||[])[0])===null||i===void 0||(i=i.option)===null||i===void 0?void 0:i.type,field:a==null||(n=a.scale)===null||n===void 0?void 0:n.field,items:this.getLegendItems(t)}}getLegendItems(t){const e=this.styleAttributeService.getLayerAttributeScale(t);return e?e.invertExtent?e.range().map(n=>({value:e.invertExtent(n),[t]:n})):e.ticks?e.ticks().map(n=>({value:n,[t]:e(n)})):e!=null&&e.domain?e.domain().filter(n=>!fZ(n)).map(n=>({value:n,[t]:e(n)})):[]:[]}pick({x:t,y:e}){this.interactionService.triggerHover({x:t,y:e})}boxSelect(t,e){this.pickingService.boxPickLayer(this,t,e)}buildLayerModel(t){var e=this;return X(function*(){const{moduleName:i,vertexShader:n,fragmentShader:a,defines:o,inject:s,triangulation:l,styleOption:u,pickingEnabled:c=!0}=t,h=$n(t,cZ);e.shaderModuleService.registerModule(i,{vs:n,fs:a,defines:o,inject:s});const{vs:f,fs:d,uniforms:v}=e.shaderModuleService.getModule(i),{createModel:p}=e.rendererService;return new Promise(g=>{const{attributes:m,elements:y,count:_}=e.styleAttributeService.createAttributesAndIndices(e.encodedData,l,u,e),x=[...e.layerModel.uniformBuffers,...e.rendererService.uniformBuffers];c&&x.push(e.getPickingUniformBuffer());const C=V({attributes:m,uniforms:v,fs:d,vs:f,elements:y,blend:UF[ss.normal],uniformBuffers:x,textures:e.layerModel.textures},h);_&&(C.count=_);const A=p(C);g(A)})})()}createAttributes(t){const{triangulation:e}=t,{attributes:i}=this.styleAttributeService.createAttributes(this.encodedData,e);return i}getTime(){return this.layerService.clock.getDelta()}setAnimateStartTime(){this.animateStartTime=this.layerService.clock.getElapsedTime()}stopAnimate(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}getLayerAnimateTime(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}needPick(t){const{enableHighlight:e=!0,enableSelect:i=!0}=this.getLayerConfig();let n=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&i&&(n=!0),t==="mousemove"&&(e||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(n=!0),this.isVisible()&&n}buildModels(){return X(function*(){throw new Error("Method not implemented.")})()}rebuildModels(){var t=this;return X(function*(){yield t.buildModels()})()}renderMulPass(t){return X(function*(){yield t.render()})()}renderModels(t={}){return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(e=>{e.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t),textures:this.layerModel.textures},(t==null?void 0:t.ispick)||!1)}),this.hooks.afterRender.call(),this)}updateStyleAttribute(t,e,i,n){const a=this.configService.getAttributeConfig(this.id)||{};return Wy(a[t],{field:e,values:i})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(t)!==-1&&this.configService.setAttributeConfig(this.id,{[t]:{field:e,values:i}}),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:V({field:e},this.splitValuesAndCallbackInAttribute(i,this.getLayerConfig()[e]))},n):this.pendingStyleAttributes.push({attributeName:t,attributeField:e,attributeValues:i,updateOptions:n}),!0)}getLayerAttributeConfig(){return this.configService.getAttributeConfig(this.id)}getShaderPickStat(){return this.layerService.getShaderPickStat()}setEarthTime(t){console.warn("empty fn")}processData(t){return t}getModelType(){throw new Error("Method not implemented.")}getDefaultConfig(){return{}}initLayerModels(){var t=this;return X(function*(){t.models.forEach(i=>i.destroy()),t.models=[],t.uniformBuffers.forEach(i=>{i.destroy()}),t.uniformBuffers=[];const e=t.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0,label:"pickingUniforms"});t.uniformBuffers.push(e),t.models=yield t.layerModel.initModels()})()}getPickingUniformBuffer(){return this.uniformBuffers[0]}reRender(){this.inited&&this.layerService.reRender()}splitValuesAndCallbackInAttribute(t){return{values:ew(t)?void 0:t,callback:ew(t)?t:void 0}}}function dZ(r,t){return{enable:r,mask:255,func:{cmp:b.EQUAL,ref:t?1:0,mask:1}}}function nw(r){return r.maskOperation===$0.OR?{enable:!0,mask:255,func:{cmp:b.ALWAYS,ref:1,mask:255},opFront:{fail:b.KEEP,zfail:b.REPLACE,zpass:b.REPLACE}}:{enable:!0,mask:255,func:{cmp:r.stencilType===yl.SINGLE||r.stencilIndex===0?b.ALWAYS:b.LESS,ref:r.stencilType===yl.SINGLE?1:r.stencilIndex===0?2:1,mask:255},opFront:{fail:b.KEEP,zfail:b.REPLACE,zpass:b.REPLACE}}}const vZ={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},Av={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function aw(r){return Math.max(Math.ceil(r/4)*4,4)}function zF(r,t,e,i=!0){const n=e===3;if(i){r=r.slice();const o=[];for(let s=0;s<r.length;s+=e){o[0]=r[s],o[1]=r[s+1],n&&(o[2]=r[s+2]);const l=$p(o,!0,{enable:!1,decimal:1});r[s]=l[0],r[s+1]=l[1],n&&(r[s+2]=l[2])}}return No(r,t,e)}const HF="ATTRIBUTE_LOCATION_";class we{get attributeLocation(){return V({},ps)}constructor(t){E(this,"triangulation",void 0),E(this,"uniformBuffers",[]),E(this,"textures",[]),E(this,"createTexture2D",void 0),E(this,"preStyleAttribute",{}),E(this,"encodeStyleAttribute",{}),E(this,"layer",void 0),E(this,"dataTexture",void 0),E(this,"DATA_TEXTURE_WIDTH",void 0),E(this,"dataTextureTest",void 0),E(this,"configService",void 0),E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"iconService",void 0),E(this,"fontService",void 0),E(this,"styleAttributeService",void 0),E(this,"mapService",void 0),E(this,"cameraService",void 0),E(this,"layerService",void 0),E(this,"pickingService",void 0),E(this,"attributeUnifoms",void 0),E(this,"commonUnifoms",void 0),this.layer=t,this.configService=t.getContainer().globalConfigService,this.rendererService=t.getContainer().rendererService,this.pickingService=t.getContainer().pickingService,this.shaderModuleService=t.getContainer().shaderModuleService,this.styleAttributeService=t.getContainer().styleAttributeService,this.mapService=t.getContainer().mapService,this.iconService=t.getContainer().iconService,this.fontService=t.getContainer().fontService,this.cameraService=t.getContainer().cameraService,this.layerService=t.getContainer().layerService,this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();const{createTexture2D:e}=this.rendererService;this.createTexture2D=e}getBlend(){const{blend:t="normal"}=this.layer.getLayerConfig();return UF[ss[t]]}getStencil(t){const{mask:e=!1,maskInside:i=!0,enableMask:n,maskOperation:a=$0.AND}=this.layer.getLayerConfig();if(this.layer.type==="MaskLayer")return nw({isStencil:!0,stencilType:yl.SINGLE});if(t.isStencil)return nw(V(V({},t),{},{maskOperation:a}));const o=e||n&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return dZ(o,i)}getDefaultStyle(){return{}}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();const i=V(V({},e.uniformsOption),t.uniformsOption);return Object.keys(i).forEach(n=>{typeof i[n]=="boolean"&&(i[n]=i[n]?1:0)}),!this.rendererService.hasOwnProperty("device")&&this.textures&&this.textures.length===1&&(i.u_texture=this.textures[0]),i}getAnimateUniforms(){return{}}needUpdate(){return X(function*(){return!1})()}buildModels(){return X(function*(){throw new Error("Method not implemented.")})()}initModels(){return X(function*(){throw new Error("Method not implemented.")})()}clearModels(t=!0){}getAttribute(){throw new Error("Method not implemented.")}prerender(){}render(t){throw new Error("Method not implemented.")}registerBuiltinAttributes(){throw new Error("Method not implemented.")}animateOption2Array(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}startModelAnimate(){const{animateOption:t}=this.layer.getLayerConfig();t.enable&&this.layer.setAnimateStartTime()}getInject(){return pZ(this.layer.enableShaderEncodeStyles,this.layer.encodeStyleAttribute)}getDefines(){const t=Object.keys(this.attributeLocation).reduce((e,i)=>{const n=HF+i;return e[n]=this.attributeLocation[i],e},{});return V({},t)}getStyleAttribute(){const t={};return this.layer.enableShaderEncodeStyles.forEach(e=>{if(!this.layer.encodeStyleAttribute[e]){const i=this.layer.getLayerConfig()[e];let n=typeof i>"u"?vZ[e]:i;e==="stroke"&&(n=Le(n)),t["u_"+e]=n}}),t}registerStyleAttribute(){Object.keys(this.layer.encodeStyleAttribute).forEach(t=>{const e=Kj(t);e&&this.styleAttributeService.registerStyleAttribute(e)})}registerPosition64LowAttribute(t=!0){this.styleAttributeService.registerStyleAttribute({name:"position64Low",type:vt.Attribute,descriptor:{name:"a_Position64Low",shaderLocation:this.attributeLocation.POSITION_64LOW,buffer:{data:[],type:b.FLOAT},size:2,update:(e,i,n)=>t?[mr(n[0]),mr(n[1])]:[0,0]}})}updateEncodeAttribute(t,e){this.encodeStyleAttribute[t]=e}initUniformsBuffer(){const t=this.getUniformsBufferInfo(this.getStyleAttribute()),e=this.getCommonUniformsInfo();t.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(aw(t.uniformsLength)).fill(0),isUBO:!0,label:"layerModelAttributeUnifoms"}),this.uniformBuffers.push(this.attributeUnifoms)),e.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(aw(e.uniformsLength)).fill(0),isUBO:!0,label:"layerModelCommonUnifoms"}),this.uniformBuffers.push(this.commonUnifoms))}getUniformsBufferInfo(t){let e=0;const i=[];return Object.values(t).forEach(n=>{Array.isArray(n)?(i.push(...n),e+=n.length):typeof n=="number"?(i.push(n),e+=1):typeof n=="boolean"&&(i.push(Number(n)),e+=1)}),{uniformsOption:t,uniformsLength:e,uniformsArray:i}}getCommonUniformsInfo(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}updateStyleUnifoms(){var t,e;const{uniformsArray:i}=this.getUniformsBufferInfo(this.getStyleAttribute()),{uniformsArray:n}=this.getCommonUniformsInfo();(t=this.attributeUnifoms)===null||t===void 0||t.subData({offset:0,data:new Uint8Array(new Float32Array(i).buffer)}),(e=this.commonUnifoms)===null||e===void 0||e.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)})}}function pZ(r,t){const e=[];let i="";r.forEach(o=>{const s=o.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase(),l=HF+s;t[o]?i+=`#define USE_ATTRIBUTE_${s} 0.0 
`:e.push(`  ${Av[o]} u_${o};`),i+=`
#ifdef USE_ATTRIBUTE_${s}
layout(location = ${l}) in ${Av[o]} a_${o.charAt(0).toUpperCase()+o.slice(1)};
#endif 
`});const n=e.length?`
layout(std140) uniform AttributeUniforms {
  ${e.join(`
`)}
};
`:"";i+=n;let a="";return r.forEach(o=>{const s=o.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase();a+=`
  #ifdef USE_ATTRIBUTE_${s}
    ${Av[o]} ${o} = a_${o.charAt(0).toUpperCase()+o.slice(1)};
  #else
    ${Av[o]} ${o} = u_${o};
  #endif
  `}),{"vs:#decl":i,"fs:#decl":n,"vs:#main-start":a}}let ow=function(r){return r.VERTICAL="vertical",r.HORIZONTAL="horizontal",r}({}),gZ=function(r){return r.NORMAL="normal",r.REPLACE="replace",r}({}),pE=function(r){return r[r.pixel=0]="pixel",r[r.meter=1]="meter",r}({});const $F=100;function sw(r){return r/180*Math.acos(-1)}function WF(r){const t=sw(r[0])+Math.PI/2,e=sw(r[1]),i=$F+Math.random()*.4,n=i*Math.cos(e)*Math.cos(t),a=i*Math.cos(e)*Math.sin(t),o=i*Math.sin(e);return[a,o,n]}const lw=on();on();const wn=on(),Th=on(),Tv=on();function uw(r,t,e,i,n){ri(r,e,i),yc(r,r),t=o1(-r[1],r[0]);const a=o1(-e[1],e[0]);return[n/yg(t,a),t]}function bh(r,t){return Yz(r,-t[1],t[0])}function bv(r,t,e){return Io(r,t,e),yc(r,r),r}function cw(r,t){return r[0]===t[0]&&r[1]===t[1]}class mZ{constructor(t={}){E(this,"complex",void 0),E(this,"join",void 0),E(this,"cap",void 0),E(this,"miterLimit",void 0),E(this,"thickness",void 0),E(this,"normal",void 0),E(this,"lastFlip",-1),E(this,"miter",o1(0,0)),E(this,"started",!1),E(this,"dash",!1),E(this,"totalDistance",0),E(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}simpleExtrude(t){const e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const i=t.length;let n=e.startIndex;for(let a=1;a<i;a++){const o=t[a-1],s=t[a],l=a<t.length-1?t[a+1]:null,u=this.simpleSegment(e,n,o,s,l);n+=u}if(this.dash)for(let a=0;a<e.positions.length/6;a++)e.positions[a*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}extrude(t){const e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const i=t.length;let n=e.startIndex;for(let a=1;a<i;a++){const o=t[a-1],s=t[a],l=a<t.length-1?t[a+1]:null,u=this.segment(e,n,o,s,l);n+=u}if(this.dash)for(let a=0;a<e.positions.length/6;a++)e.positions[a*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}simpleSegment(t,e,i,n,a){let o=0;const s=t.indices,l=t.positions,u=t.normals,c=Pn([n[0],n[1]]),h=Pn([i[0],i[1]]);bv(wn,c,h);let f=0;if(this.dash&&(f=this.lineSegmentDistance(c,h),this.totalDistance+=f),this.normal||(this.normal=on(),bh(this.normal,wn)),this.started||(this.started=!0,this.extrusions(l,u,i,this.normal,this.thickness,this.totalDistance-f)),s.push(e+0,e+1,e+2),!a)bh(this.normal,wn),this.extrusions(l,u,n,this.normal,this.thickness,this.totalDistance),s.push(...this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3]),o+=2;else{const d=Pn([a[0],a[1]]);cw(c,d)&&ri(d,c,yc(d,s1(d,c,h))),bv(Th,d,c);const[v,p]=uw(Tv,on(),wn,Th,this.thickness);let g=yg(Tv,this.normal)<0?-1:1;this.extrusions(l,u,n,p,v,this.totalDistance),s.push(...this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3]),g=-1,By(this.normal,p),o+=2,this.lastFlip=g}return o}segment(t,e,i,n,a){let o=0;const s=t.indices,l=t.positions,u=t.normals,c=this.cap==="square",h=this.join==="bevel",f=Pn([n[0],n[1]]),d=Pn([i[0],i[1]]);bv(wn,f,d);let v=0;if(this.dash&&(v=this.lineSegmentDistance(f,d),this.totalDistance+=v),this.normal||(this.normal=on(),bh(this.normal,wn)),!this.started)if(this.started=!0,c){const p=on(),g=on();ri(p,this.normal,wn),ri(g,this.normal,wn),u.push(g[0],g[1],0),u.push(p[0],p[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance-v,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance-v,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,u,i,this.normal,this.thickness,this.totalDistance-v);if(s.push(e+0,e+1,e+2),a){const p=Pn([a[0],a[1]]);cw(f,p)&&ri(p,f,yc(p,s1(p,f,d))),bv(Th,p,f);const[g,m]=uw(Tv,on(),wn,Th,this.thickness);let y=yg(Tv,this.normal)<0?-1:1,_=h;!_&&this.join==="miter"&&g>this.miterLimit&&(_=!0),_?(u.push(this.normal[0],this.normal[1],0),u.push(m[0],m[1],0),l.push(n[0],n[1],n[2]|0,this.totalDistance,-this.thickness*y,n[2]|0),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],n[2]|0,this.totalDistance,this.thickness*y,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s.push(...this.lastFlip!==-y?[e,e+2,e+3]:[e+2,e+1,e+3]),s.push(e+2,e+3,e+4),bh(lw,Th),By(this.normal,lw),u.push(this.normal[0],this.normal[1],0),l.push(n[0],n[1],n[2]|0,this.totalDistance,-this.thickness*y,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(l,u,n,m,g,this.totalDistance),s.push(...this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3]),y=-1,By(this.normal,m),o+=2),this.lastFlip=y}else{if(bh(this.normal,wn),c){const p=on(),g=on();Io(g,wn,this.normal),ri(p,wn,this.normal),u.push(g[0],g[1],0),u.push(p[0],p[1],0),l.push(n[0],n[1],n[2]|0,this.totalDistance,this.thickness,n[2]|0),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],n[2]|0,this.totalDistance,this.thickness,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,u,n,this.normal,this.thickness,this.totalDistance);s.push(...this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3]),o+=2}return o}extrusions(t,e,i,n,a,o){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(i[0],i[1],i[2]|0,o,-a,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,o,a,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}lineSegmentDistance(t,e){const i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)}}let wh=function(r){return r.CYLINDER="cylinder",r.SQUARECOLUMN="squareColumn",r.TRIANGLECOLUMN="triangleColumn",r.HEXAGONCOLUMN="hexagonColumn",r.PENTAGONCOLUMN="pentagonColumn",r}({}),Rh=function(r){return r.CIRCLE="circle",r.SQUARE="square",r.TRIANGLE="triangle",r.HEXAGON="hexagon",r.PENTAGON="pentagon",r}({});function zd(r,t=0){const e=Math.PI*2/r,i=[];for(let a=0;a<r;a++)i.push(e*a+t*Math.PI/12);return i.map(a=>{const o=Math.sin(a+Math.PI/4),s=Math.cos(a+Math.PI/4);return[o,s,0]})}function M1(){return zd(30)}function hw(){return zd(4)}function fw(){return zd(3)}function dw(){return zd(6,1)}function vw(){return zd(5)}const ic={[Rh.CIRCLE]:M1,[Rh.HEXAGON]:dw,[Rh.TRIANGLE]:fw,[Rh.SQUARE]:hw,[Rh.PENTAGON]:vw,[wh.CYLINDER]:M1,[wh.HEXAGONCOLUMN]:dw,[wh.TRIANGLECOLUMN]:fw,[wh.SQUARECOLUMN]:hw,[wh.PENTAGONCOLUMN]:vw};function yZ(r){const t=r[0][0],e=r[0][r[0].length-1];t[0]===e[0]&&t[1]===e[1]&&(r[0]=r[0].slice(0,r[0].length-1));const i=r[0].length,n=No.flatten(r),{vertices:a,dimensions:o}=n,s=[],l=[];for(let c=0;c<a.length/o;c++)o===2?s.push(a[c*2],a[c*2+1],1):s.push(a[c*3],a[c*3+1],1);const u=No(n.vertices,n.holes,n.dimensions);l.push(...u);for(let c=0;c<i;c++){const h=n.vertices.slice(c*o,(c+1)*o);let f=n.vertices.slice((c+1)*o,(c+2)*o);f.length===0&&(f=n.vertices.slice(0,o));const d=s.length/3;s.push(h[0],h[1],1,f[0],f[1],1,h[0],h[1],0,f[0],f[1],0),l.push(...[0,2,1,2,3,1].map(v=>v+d))}return{positions:s,index:l}}function _Z(r){const t=No.flatten(r),e=No(t.vertices,t.holes,t.dimensions);return{positions:t.vertices,index:e}}function VF(r,t=!1){const e=r[0][0],i=r[0][r[0].length-1];e[0]===i[0]&&e[1]===i[1]&&(r[0]=r[0].slice(0,r[0].length-1));const n=r[0].length,a=No.flatten(r),{vertices:o,dimensions:s,holes:l}=a,u=[],c=[],h=[];for(let d=0;d<o.length/s;d++)u.push(o[d*s],o[d*s+1],1,-1,-1),h.push(0,0,1);const f=zF(o,l,s,t);c.push(...f);for(let d=0;d<n;d++){const v=a.vertices.slice(d*s,(d+1)*s);let p=a.vertices.slice((d+1)*s,(d+2)*s);p.length===0&&(p=a.vertices.slice(0,s));const g=u.length/5;u.push(v[0],v[1],1,0,0,p[0],p[1],1,.1,0,v[0],v[1],0,0,.8,p[0],p[1],0,.1,.8);const m=xZ([p[0],p[1],1],[v[0],v[1],0],[v[0],v[1],1],t);h.push(...m,...m,...m,...m),c.push(...[1,2,0,3,2,1].map(y=>y+g))}return{positions:u,index:c,normals:h}}function xZ(r,t,e,i=!1){const n=xv(),a=xv(),o=xv();i&&(r=$p(r),t=$p(t),e=$p(e));const s=gi(...r),l=gi(...t),u=gi(...e);vb(n,u,l),vb(a,s,l),jz(o,n,a);const c=xv();return qh(c,o),c}const wv={};function Il(r){const t=Hl(r.coordinates);return{vertices:[...t,...t,...t,...t],indices:[0,1,2,2,3,0],size:t.length}}function pw(r){const t=Hl(r.coordinates),e=WF(t);return{vertices:[...e,...e,...e,...e],indices:[0,1,2,2,3,0],size:e.length}}function gE(r){const{shape:t}=r,{positions:e,index:i,normals:n}=bZ(t,!1);return{vertices:e,indices:i,normals:n,size:5}}function CZ(r){const t=Hl(r.coordinates);return{vertices:[...t],indices:[0],size:t.length}}function I1(r){const{coordinates:t}=r,e=new mZ({dash:!0,join:"bevel"});let i=t;i[0]&&!Array.isArray(i[0][0])&&(i=[t]),i.forEach(a=>{e.extrude(a)});const n=e.complex;return{vertices:n.positions,indices:n.indices,normals:n.normals,indexes:n.indexes,size:6}}function EZ(r){const{coordinates:t}=r,e=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};const{results:i,totalDistance:n}=SZ(t);return i.map(a=>{e.push(a[0],a[1],a[2],a[3],0,n)}),{vertices:e,indices:[],normals:[],size:6,count:i.length}}function gw(r,t){const e=t[0]-r[0],i=t[1]-r[1];return Math.sqrt(e*e+i*i)}function Vy(r,t){return r.length<3&&r.push(0),t!==void 0&&r.push(t),r}function SZ(r){let t=r;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=r.flat());let e=0;if(t.length<2)return{results:t,totalDistance:0};{const i=[],n=Vy(t[0],e);i.push(n);for(let o=1;o<t.length-1;o++){const s=gw(Pn(t[o-1]),Pn(t[o]));e+=s;const l=Vy(t[o],e);i.push(l),i.push(l)}const a=gw(Pn(t[t.length-2]),Pn(t[t.length-1]));return e+=a,i.push(Vy(t[t.length-1],e)),{results:i,totalDistance:e}}}function Hd(r){const{coordinates:t}=r,e=No.flatten(t),{vertices:i,dimensions:n,holes:a}=e;return{indices:zF(i,a,n),vertices:i,size:n}}function AZ(r){const{indices:t,vertices:e,size:i}=Hd(r);return{indices:t,vertices:TZ(e),size:i+4}}function TZ(r){const t=[],{center:e,radius:i}=N$(r);for(let n=0;n<r.length;n+=2){const a=r[n],o=r[n+1];t.push(a,o,0,...e,i)}return t}function GF(r){const t=r.coordinates,{positions:e,index:i,normals:n}=VF(t,!0);return{vertices:e,indices:i,normals:n,size:5}}function XF(r){const{shape:t}=r,{positions:e,index:i}=wZ(t);return{vertices:e,indices:i,size:3}}function G0(r){const t=r.coordinates;return{vertices:[...t[0],0,0,0,...t[1],0,1,0,...t[2],0,1,1,...t[3],0,0,1],indices:[0,1,2,0,2,3],size:5}}function mE(r,t){const{segmentNumber:e=30}=t,i=r.coordinates,n=[],a=[];for(let o=0;o<e;o++)n.push(o,1,o,i[0][0],i[0][1],i[1][0],i[1][1],o,-1,o,i[0][0],i[0][1],i[1][0],i[1][1]),o!==e-1&&a.push(...[0,1,2,1,3,2].map(s=>o*2+s));return{vertices:n,indices:a,size:7}}function mw(r){const t=r.coordinates;t.length===2&&t.push(0);const e=Rv(-1,1),i=Rv(1,1),n=Rv(-1,-1),a=Rv(1,-1);return{vertices:[...t,...e,...t,...n,...t,...a,...t,...i],indices:[0,1,2,3,0,2],size:5}}function bZ(r,t=!1){if(wv&&wv[r])return wv[r];const e=ic[r]?ic[r]():ic.cylinder(),i=VF([e],t);return wv[r]=i,i}function wZ(r){const t=["cylinder","triangleColumn","hexagonColumn","squareColumn"],e=ic[r]?ic[r]():ic.circle();return t.indexOf(r)===-1?_Z([e]):yZ([e])}function Rv(r,t){const e=(r+1)/2,i=(t+1)/2;return[e,i]}function YF(r,t){return{type:r.type,field:"value",items:r.positions.map((e,i)=>({[t]:i>=r.colors.length?null:r.colors[i],value:e}))}}const RZ=`in vec4 v_color;

#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,MZ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location =  ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;

  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage;

  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  gl_Position = project_common_position_to_clipspace(project_pos);

  setPickingColor(a_PickingColor);
}
`;class IZ extends we{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:e,angle:i}=this.layer.getLayerConfig(),n={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:e||.9,u_angle:i||0};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return X(function*(){return t.buildModels()})()}buildModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:MZ,fragmentShader:RZ,defines:t.getDefines(),triangulation:XF,primitive:b.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:vt.Attribute,descriptor:{shaderLocation:this.attributeLocation.POS,name:"a_Pos",buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:3,update:t=>{const e=t.coordinates;return[e[0],e[1],0]}}})}}const LZ=`in vec4 v_color;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,OZ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"

void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);

  vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度
  vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

  float lightWeight = calc_lighting(project_pos);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  gl_Position = project_common_position_to_clipspace(project_pos);

  setPickingColor(a_PickingColor);
}
`;class PZ extends we{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:e,angle:i}=this.layer.getLayerConfig(),n={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:e||.9,u_angle:i||0};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return X(function*(){return t.buildModels()})()}buildModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:OZ,fragmentShader:LZ,defines:t.getDefines(),triangulation:gE,primitive:b.TRIANGLES,depth:{enable:!0}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:vt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:3,update:(t,e,i,n,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:vt.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:3,update:t=>{const e=t.coordinates;return[e[0],e[1],0]}}})}}function FZ(r,t){const e=[],i=[],n=[],a=r+1,o=t+1,s=r/2,l=t/2;for(let u=0;u<o;u++){const c=u-l;for(let h=0;h<a;h++){const f=h-s;i.push(f/s,-c/l,0),n.push(h/r),n.push(1-u/t)}}for(let u=0;u<t;u++)for(let c=0;c<r;c++){const h=c+a*u,f=c+a*(u+1),d=c+1+a*(u+1),v=c+1+a*u;e.push(h,f,v),e.push(f,d,v)}return{vertices:i,indices:e,uvs:n}}const BZ=`layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;
in float v_intensity;
out vec4 outputColor;

void main(){
   
    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));
    outputColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,DZ=`layout(location = 0) in vec3 a_Position;
layout(location = 10) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

out vec2 v_texCoord;
out float v_intensity;

vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
  float t2 = t * t;
  float one_minus_t = 1.0 - t;
  float one_minus_t2 = one_minus_t * one_minus_t;
  return P0 * one_minus_t2 * one_minus_t +
  P1 * 3.0 * t * one_minus_t2 +
  P2 * 3.0 * t2 * one_minus_t +
  P3 * t2 * t;
}
vec2 toBezier(float t, vec4 p) {
  return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}

#pragma include "projection"
#pragma include "project"

void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点
  vec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点

  vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）
  vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）
  inverseP2 = inverseP2 / inverseP2.w;

  float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
  vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b = vec4(0.5, 0.0, 1.0, 0.5);
  float fh;

  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.0), 1.0);

}
`,NZ=`uniform sampler2D u_texture;        // 热力强度图
uniform sampler2D u_colorTexture;   // 根据强度分布的色带

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};
in vec2 v_texCoord;
out vec4 outputColor;

#pragma include "scene_uniforms"

float getBlurIndusty() {
    float vW = 2.0/ u_ViewportSize.x;
    float vH = 2.0/ u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;
    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));
    outputColor = color;
    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,kZ=`layout(location = 0) in vec3 a_Position;
layout(location = 10) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
void main() {
  v_texCoord = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
  v_texCoord.y = 1.0 - v_texCoord.y;
  #endif

  gl_Position = vec4(a_Position.xy, 0, 1.0);
}
`,UZ=`layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

in vec2 v_extrude;
in float v_weight;
out vec4 outputColor;
#define GAUSS_COEF  0.3989422804014327

void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    outputColor = vec4(val, 1., 1., 1.);
}
`,zZ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_DIR) in vec2 a_Dir;

layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

out vec2 v_extrude;
out float v_weight;

#define GAUSS_COEF (0.3989422804014327)

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 picking_color_placeholder = u_PickingColor;

  v_weight = a_Size;
  float ZERO = 1.0 / 255.0 / 16.0;
  float extrude_x = a_Dir.x * 2.0 - 1.0;
  float extrude_y = a_Dir.y * 2.0 - 1.0;
  vec2 extrude_dir = normalize(vec2(extrude_x, extrude_y));
  float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
  v_extrude = extrude_dir * S;

  vec2 offset = project_pixel(v_extrude * u_radius);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

}
`,{isEqual:HZ}=tr;class yw extends we{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"colorTexture",void 0),E(this,"heatmapFramerBuffer",void 0),E(this,"heatmapTexture",void 0),E(this,"intensityModel",void 0),E(this,"colorModel",void 0),E(this,"shapeType",void 0),E(this,"preRampColors",void 0),E(this,"colorModelUniformBuffer",[]),E(this,"heat3DModelUniformBuffer",[])}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10,DIR:11})}prerender(){const{clear:t,useFramebuffer:e}=this.rendererService;e(this.heatmapFramerBuffer,()=>{t({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.heatmapFramerBuffer}),this.drawIntensityMode()})}render(t){const{rampColors:e}=this.layer.getLayerConfig();HZ(this.preRampColors,e)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawHeatMap(t):this.draw3DHeatMap(t)}getUninforms(){throw new Error("Method not implemented.")}initModels(){var t=this;return X(function*(){var e;const{createFramebuffer:i,getViewportSize:n,createTexture2D:a}=t.rendererService,o=t.styleAttributeService.getLayerStyleAttribute("shape"),s=(o==null||(e=o.scale)===null||e===void 0?void 0:e.field)||"heatmap";t.shapeType=s,t.intensityModel=yield t.buildHeatMapIntensity(),t.colorModel=s==="heatmap"?t.buildHeatmap():t.build3dHeatMap();const{width:l,height:u}=n();return t.heatmapTexture=a({width:Math.floor(l/4),height:Math.floor(u/4),wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE,min:b.LINEAR,mag:b.LINEAR,usage:$l.RENDER_TARGET}),t.heatmapFramerBuffer=i({color:t.heatmapTexture,depth:!0,width:Math.floor(l/4),height:Math.floor(u/4)}),t.updateColorTexture(),[t.intensityModel,t.colorModel]})()}buildModels(){var t=this;return X(function*(){return t.initModels()})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:vt.Attribute,descriptor:{name:"a_Dir",shaderLocation:this.attributeLocation.DIR,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:(t,e,i)=>[i[3],i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e=1}=t;return[e]}}})}buildHeatMapIntensity(){var t=this;return X(function*(){return t.uniformBuffers=[t.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],t.layer.triangulation=mw,yield t.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:zZ,fragmentShader:UZ,triangulation:mw,defines:t.getDefines(),depth:{enable:!1},cull:{enable:!0,face:b.FRONT}})})()}buildHeatmap(){this.shaderModuleService.registerModule("heatmapColor",{vs:kZ,fs:NZ}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("heatmapColor"),{createAttribute:n,createElements:a,createBuffer:o,createModel:s}=this.rendererService;return s({vs:t,fs:e,uniformBuffers:[...this.colorModelUniformBuffer,...this.rendererService.uniformBuffers],attributes:{a_Position:n({shaderLocation:this.attributeLocation.POSITION,buffer:o({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:b.FLOAT}),size:3}),a_Uv:n({shaderLocation:this.attributeLocation.UV,buffer:o({data:[0,1,1,1,0,0,1,0],type:b.FLOAT}),size:2})},uniforms:V({},i),depth:{enable:!1},elements:a({data:[0,2,1,2,3,1],type:b.UNSIGNED_INT,count:6})})}build3dHeatMap(){const{getViewportSize:t}=this.rendererService,{width:e,height:i}=t(),n=FZ(e/4,i/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:DZ,fs:BZ}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(16*2+4).fill(0),isUBO:!0})];const{vs:a,fs:o,uniforms:s}=this.shaderModuleService.getModule("heatmap3dColor"),{createAttribute:l,createElements:u,createBuffer:c,createModel:h}=this.rendererService;return h({vs:a,fs:o,attributes:{a_Position:l({shaderLocation:this.attributeLocation.POSITION,buffer:c({data:n.vertices,type:b.FLOAT}),size:3}),a_Uv:l({shaderLocation:this.attributeLocation.UV,buffer:c({data:n.uvs,type:b.FLOAT}),size:2})},primitive:b.TRIANGLES,uniformBuffers:[...this.heat3DModelUniformBuffer,...this.rendererService.uniformBuffers],uniforms:V({},s),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:b.SRC_ALPHA,srcAlpha:1,dstRGB:b.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:u({data:n.indices,type:b.UNSIGNED_INT,count:n.indices.length})})}drawIntensityMode(){var t;const{intensity:e=10,radius:i=5}=this.layer.getLayerConfig(),n={u_radius:i,u_intensity:e};this.uniformBuffers[0].subData({offset:0,data:[i,e]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:n,blend:{enable:!0,func:{srcRGB:b.ONE,srcAlpha:1,dstRGB:b.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}drawHeatMap(t){var e;const{opacity:i=1}=this.layer.getLayerConfig(),n={u_opacity:i,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},a=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[i]}),(e=this.colorModel)===null||e===void 0||e.draw({uniforms:n,textures:a,blend:this.getBlend(),stencil:this.getStencil(t)})}draw3DHeatMap(t){var e;const{opacity:i=1}=this.layer.getLayerConfig(),n=jc();mg(n,this.cameraService.getViewProjectionMatrixUncentered());const a={u_opacity:i,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:[...n]};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[...a.u_ViewProjectionMatrixUncentered,...a.u_InverseViewProjectionMatrix,i]});const o=[this.heatmapTexture,this.colorTexture];(e=this.colorModel)===null||e===void 0||e.draw({uniforms:a,textures:o,blend:{enable:!0,func:{srcRGB:b.SRC_ALPHA,srcAlpha:1,dstRGB:b.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}updateColorTexture(){const{createTexture2D:t}=this.rendererService;this.texture&&this.texture.destroy();const{rampColors:e}=this.layer.getLayerConfig(),i=$P(e);this.colorTexture=t({data:i.data,usage:$l.SAMPLED,width:i.width,height:i.height,wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE,min:b.NEAREST,mag:b.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=e}}const $Z=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,WZ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;

  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);

  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`;class VZ extends we{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:e,angle:i}=this.layer.getLayerConfig(),n={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:e||.9,u_angle:i||0};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return X(function*(){return t.buildModels()})()}buildModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:WZ,fragmentShader:$Z,defines:t.getDefines(),triangulation:XF,depth:{enable:!1},primitive:b.TRIANGLES})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:vt.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:3,update:t=>{const e=t.coordinates;return[e[0],e[1],0]}}})}}const GZ={heatmap:yw,heatmap3d:yw,grid:IZ,grid3d:PZ,hexagon:VZ},XZ=GZ;class lzt extends uu{constructor(...t){super(...t),E(this,"type","HeatMapLayer")}buildModels(){var t=this;return X(function*(){const e=t.getModelType();t.layerModel=new XZ[e](t),yield t.initLayerModels()})()}prerender(){this.getModelType()==="heatmap"&&this.layerModel&&this.layerModel.prerender()}renderModels(t={}){return this.getModelType()==="heatmap"?(this.layerModel&&this.layerModel.render(t),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(i=>i.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t)})),this.hooks.afterRender.call(),this)}updateModelData(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}getModelType(){var t;const e=this.styleAttributeService.getLayerStyleAttribute("shape"),{shape3d:i}=this.getLayerConfig(),a=this.getSource().data.type,o=(e==null||(t=e.scale)===null||t===void 0?void 0:t.field)||"heatmap";return o==="heatmap"||o==="heatmap3d"?"heatmap":a==="hexagon"?(i==null?void 0:i.indexOf(o))===-1?"hexagon":"grid3d":a==="grid"?(i==null?void 0:i.indexOf(o))===-1?"grid":"grid3d":"heatmap"}getLegend(t){if(this.getModelType()==="heatmap"){if(t!=="color")return{type:void 0,field:void 0,items:[]};const e=this.getLayerConfig().rampColors;return YF(e,t)}else return super.getLegend(t)}}const YZ=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,jZ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;let ZZ=class extends we{constructor(...t){super(...t),E(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){const{opacity:t,brightness:e,contrast:i,saturation:n,gamma:a}=this.layer.getLayerConfig(),o={u_opacity:Ch(t,1),u_brightness:Ch(e,1),u_contrast:Ch(i,1),u_saturation:Ch(n,1),u_gamma:Ch(a,1)};return this.textures=[this.texture],this.getUniformsBufferInfo(o)}initModels(){var t=this;return X(function*(){return yield t.loadTexture(),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}loadTexture(){var t=this;return X(function*(){const{createTexture2D:e}=t.rendererService,n=yield t.layer.getSource().data.images;t.texture=e({data:n[0],width:n[0].width,height:n[0].height,mag:b.LINEAR,min:b.LINEAR})})()}buildModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:jZ,fragmentShader:YZ,defines:t.getDefines(),triangulation:G0,primitive:b.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:vt.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:(t,e,i)=>[i[3],i[4]]}})}};const qZ={image:ZZ},KZ=qZ;class QZ extends uu{constructor(...t){super(...t),E(this,"type","ImageLayer")}buildModels(){var t=this;return X(function*(){const e=t.getModelType();t.layerModel=new KZ[e](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{image:{}}[t]}getModelType(){return"image"}}const JZ=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_lineData;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // 运动速度
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // 当存在贴图时在底色上贴上贴图
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // 贴图在弧线上重复的数量

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // 横向 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,tq=`#define Animate (0.0)
#define LineTexture (1.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1.0 - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);
  if (u_lineDir == 1.0) {
    // 正向
    return mid;
  } else {
    // 逆向
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
  //  return index / (segmentNumber - 1.);
}
vec2 interpolate(vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x, t), bezier3(y, t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return dir_screenspace.xy * sign(offset_direction);
}

void main() {
  //vs中计算渐变色
  if (u_linearColor == 1.0) {
    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex / segmentNumber);
  } else {
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source_world = a_Instance.rg; // 起始点
  vec2 target_world = a_Instance.ba; // 终点

  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  // 计算 dashArray 和 distanceRatio 输出到片元
  float total_Distance = pixelDistance(source_world, target_world) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 source = project_position(vec4(source_world, 0, 1.), a_Instance64Low.xy);
  vec4 target = project_position(vec4(target_world, 0, 1.), a_Instance64Low.zw);

  vec2 currPos = interpolate(source.xy, target.xy, segmentRatio, thetaOffset);
  vec2 nextPos = interpolate(source.xy, target.xy, nextSegmentRatio, thetaOffset);

  vec2 offset = project_pixel(
    getExtrusionOffset((nextPos.xy - currPos.xy) * indexDir, a_Position.y)
  );

  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // 开启贴图模式
    float arcDistrance = length(source - target); // 起始点和终点的距离
    arcDistrance = project_pixel(arcDistrance);

    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变
    float texCount = floor(arcDistrance / pixelLen); // 贴图在弧线上重复的数量
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size); // 定点位置偏移
    v_lineData.a = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值
  }

  gl_Position = project_common_position_to_clipspace(vec4(currPos.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,eq={solid:0,dash:1};class rq extends we{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:b.NEAREST,min:b.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:i="normal",lineType:n="solid",dashArray:a=[10,5],forward:o=!0,lineTexture:s=!1,iconStep:l=100,segmentNumber:u=30}=this.layer.getLayerConfig(),{animateOption:c}=this.layer.getLayerConfig();let h=a;n!=="dash"&&(h=[0,0]),h.length===2&&h.push(0,0);let f=0,d=[0,0,0,0],v=[0,0,0,0];if(t&&e&&(d=Le(t),v=Le(e),f=1),this.rendererService.getDirty()){var p;(p=this.texture)===null||p===void 0||p.bind()}const g={u_animate:this.animateOption2Array(c),u_dash_array:h,u_sourceColor:d,u_targetColor:v,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:u,u_lineDir:o?1:-1,u_icon_step:l,u_line_texture:s?1:0,u_textureBlend:i==="normal"?0:1,u_blur:.9,u_line_type:eq[n||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:f};return this.getUniformsBufferInfo(g)}initModels(){var t=this;return X(function*(){return t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:JZ,vert:tq,type:""}}buildModels(){var t=this;return X(function*(){t.initUniformsBuffer();const{segmentNumber:e=30}=t.layer.getLayerConfig(),{frag:i,vert:n,type:a}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc2d"+a,vertexShader:n,fragmentShader:i,defines:t.getDefines(),inject:t.getInject(),triangulation:mE,depth:{enable:!1},styleOption:{segmentNumber:e}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:vt.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:4,update:(t,e,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:vt.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:4,update:(t,e,i)=>[mr(i[3]),mr(i[4]),mr(i[5]),mr(i[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:vt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:i}=t,{x:n,y:a}=e[i]||{x:0,y:0};return[n,a]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:vt.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{thetaOffset:e=1}=t;return[e]}}})}}const iq=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec4 v_dash_array;
in float v_segmentIndex;
in vec2 v_iconMapUV;
in vec4 v_line_data;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // 贴图在弧线上重复的数量

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,nq=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace.xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 是为了对齐坐标
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // 手动增加一些偏移，减轻面的冲突
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs中计算渐变色
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0), a_Instance64Low.xy).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0), a_Instance64Low.zw).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    float total_Distance = pixelDistance(source, target) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离
    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // 地球模式
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // 线的偏移
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // 计算起始点和终止点的距离
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // 计算飞线各个节点相应的高度
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // 地球点位
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;

    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }


  setPickingColor(a_PickingColor);
}
`,aq={solid:0,dash:1};class _w extends we{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:b.NEAREST,min:b.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:i="normal",lineType:n="solid",dashArray:a=[10,5],lineTexture:o=!1,iconStep:s=100,segmentNumber:l=30,globalArcHeight:u=10}=this.layer.getLayerConfig(),{animateOption:c}=this.layer.getLayerConfig();a.length===2&&a.push(0,0);let h=0,f=[0,0,0,0],d=[0,0,0,0];if(t&&e&&(f=Le(t),d=Le(e),h=1),this.rendererService.getDirty()){var v;(v=this.texture)===null||v===void 0||v.bind()}const p={u_animate:this.animateOption2Array(c),u_dash_array:a,u_sourceColor:f,u_targetColor:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:$F,u_global_height:u,segmentNumber:l,u_line_type:aq[n]||0,u_icon_step:s,u_line_texture:o?1:0,u_textureBlend:i==="normal"?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:h};return this.getUniformsBufferInfo(p)}initModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:iq,vert:nq,type:""}}buildModels(){var t=this;return X(function*(){const{segmentNumber:e=30}=t.layer.getLayerConfig(),{frag:i,vert:n,type:a}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc3d"+a,vertexShader:n,fragmentShader:i,defines:t.getDefines(),inject:t.getInject(),triangulation:mE,styleOption:{segmentNumber:e}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:vt.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:4,update:(t,e,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:vt.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:4,update:(t,e,i)=>[mr(i[3]),mr(i[4]),mr(i[5]),mr(i[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:vt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:i}=t,{x:n,y:a}=e[i]||{x:0,y:0};return[n,a]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:vt.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{thetaOffset:e=1}=t;return[e]}}})}}const xw={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},Fi=1/2;function oq(r,t){const{width:e=2,height:i=1}=t;return{vertices:[0,Fi*r,1*r*e,-(i+Fi)*r,1*r*e,(i-Fi)*r,0,Fi*r,1*r*e,-(i+Fi)*r,1*r*e,(i-Fi)*r],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*r,-2*r,1,-2*r,1.5*r,1,1*r,1.5*r,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function sq(r,t){const{width:e=2,height:i=3}=t;return{vertices:[0,0,1*r*e,1*i,1*r*e,-1*i,0,0,1*r*e,1*i,1*r*e,-1*i],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*r,1,2,1*r,1,-2,1*r,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function lq(r,t){const{width:e=2,height:i=2}=t;return{vertices:[0,i/2,r*e*1,i/2,r*e*1,-i/2,0,-i/2,0,i/2,r*e*1,i/2,r*e*1,-i/2,0,-i/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-r,1,1,0,1,0,-r,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function uq(r,t){const{width:e=2,height:i=3}=t;return{vertices:[0,0,1*e*r,.5*i,2*e*r,0,1*e*r,-.5*i,0,0,1*e*r,.5*i,2*e*r,0,1*e*r,-.5*i],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-r,1,1,0,1,0,-r,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function cq(r,t){const{width:e=2,height:i=3}=t;return{vertices:[0,0,2*r*e,1*i,1.5*r*e,0,2*r*e,-1*i,0,0,2*r*e,1*i,1.5*r*e,0,2*r*e,-1*i],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-r,1,1,0,1,0,-r,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function hq(r,t){const{width:e=2,height:i=2}=t,n=M1(),a=No.flatten([n]),o=No(a.vertices,a.holes,a.dimensions),s=n.map(l=>[l[0]*e*r,l[1]*i]).flat();return{vertices:[...s,...s],dimensions:2,indices:o.map(l=>l+n.length),outLineIndices:o,normals:[...n.map(l=>[l[1]*i,l[0]*e*r,1]).flat(),...new Array(n.length*3).fill(0)]}}function fq(r,t=0,e){const i=typeof e.source=="object"?e.source.type:e.source,n=typeof e.target=="object"?e.target.type:e.target,{width:a=i?xw[i]:0}=typeof e.source=="object"?e.source:{},{width:o=n?xw[n]:0}=typeof e.target=="object"?e.target:{};return{vertices:[0,Fi,1*a,...r,1,Fi,-1*o,...r,1,-Fi,-1*o,...r,0,-Fi,1*a,...r,0,Fi,1*a,...r,1,Fi,-1*o,...r,1,-Fi,-1*o,...r,0,-Fi,1*a,...r],outLineIndices:[0,1,2,0,2,3].map(s=>s+t),indices:[4,5,6,4,6,7].map(s=>s+t),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function Cw(r,t){const e=typeof r=="object"?r.type:r,i=t==="source"?1:-1,n=typeof r=="object"?r:{};switch(e){case"circle":return hq(i,n);case"triangle":return sq(i,n);case"diamond":return uq(i,n);case"rect":return lq(i,n);case"classic":return cq(i,n);case"halfTriangle":return oq(i,n);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function dq(r){const t=r.coordinates.flat(),e=1,i=1;return{vertices:[1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t,1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t],normals:[-e,2*i,1,2*i,-i,1,i,-i,1,i,-i,1,-e,-i,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function vq(r,t){return t?pq(r,t):dq(r)}function pq(r,t){const e=r.coordinates.flat(),{target:i="classic",source:n="circle"}=t,a=Ew(Cw(n,"source"),e,0,0),o=fq(e,a.vertices.length/7,t),s=Ew(Cw(i,"target"),e,1,a.vertices.length/7+o.vertices.length/7);return{vertices:[...a.vertices,...o.vertices,...s.vertices],indices:[...a.outLineIndices,...o.outLineIndices,...s.outLineIndices,...a.indices,...o.indices,...s.indices],normals:[...a.normals,...o.normals,...s.normals],size:7}}function Ew(r,t,e=1,i=0){const n=[],{vertices:a,indices:o,dimensions:s,outLineIndices:l}=r;for(let u=0;u<a.length;u+=s)n.push(e,a[u+1],a[u],...t);return V(V({},r),{},{vertices:n,indices:o.map(u=>u+i),outLineIndices:l.map(u=>u+i)})}const gq=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;


// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,mq=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {
  vec2 data = project_pixel(offsets);

  return vec2(data.x, -data.y);
}

vec2 line_dir(vec2 target, vec2 source) {
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}


void main() {
  // 透明度计算
  vec2 source_world = a_Instance.rg; // 起点
  vec2 target_world = a_Instance.ba; // 终点
  vec2 flowlineDir = line_dir(target_world, source_world);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);

  vec2 position = mix(source_world, target_world, a_Position.x);
  vec2 position64Low = mix(a_Instance64Low.rg, a_Instance64Low.ba, a_Position.x);

  float lengthCommon = length(
    project_position(vec4(target_world, 0, 1)) - project_position(vec4(source_world, 0, 1))
  );
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || 高德
  vec2 limitedOffsetDistances = clamp(
    offsetDistances,
    project_pixel(-lengthCommon * 0.2),
    project_pixel(lengthCommon * 0.2)
  );

  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon * 0.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon * 0.2),
    a_Position.x
  );

  vec2 normalsCommon = u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y));

  float gapCommon = -1. * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
      perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0), position64Low);

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));

  setPickingColor(a_PickingColor);
}
`;class yq extends we{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,NORMAL:12})}getCommonUniformsInfo(){const{gapWidth:t=2,strokeWidth:e=1,strokeOpacity:i=1}=this.layer.getLayerConfig(),n={u_gap_width:t,u_stroke_width:e,u_stroke_opacity:i};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return X(function*(){return[yield t.layer.buildLayerModel({moduleName:"flow_line",vertexShader:mq,fragmentShader:gq,defines:t.getDefines(),inject:t.getInject(),triangulation:vq,styleOption:t.layer.getLayerConfig().symbol,primitive:b.TRIANGLES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0],e[1]]:[e,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:vt.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:4,update:(t,e,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:vt.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:4,update:(t,e,i)=>[mr(i[3]),mr(i[4]),mr(i[5]),mr(i[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:vt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:3,update:(t,e,i,n,a)=>a}})}}const _q=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_dash_array;
in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_line_data;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;

  // 设置弧线的底色
  if(u_linearColor == 1.0) { // 使用渐变颜色
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // 使用 color 方法传入的颜色
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // 实线部分
    } else {
      // 虚线部分
      discard;
    };
  }

  // 设置弧线的动画模式
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // 设置弧线的贴图
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) {
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // 贴图在弧线上重复的数量
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // 设置贴图和底色的叠加模式
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,xq=`#define LineTypeSolid (0.0)
#define LineTypeDash (1.0)
#define Animate (0.0)
#define LineTexture (1.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps(float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.0);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(mix(source, target, segmentRatio), sqrt(max(0.0, vertex_height)));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace.xy * sign(offset_direction);
}
float getAngularDist(vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) * sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1.0 - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate(vec2 source, vec2 target, float angularDist, float t) {
  if (abs(angularDist - PI) < 0.001) {
    return (1.0 - t) * source + t * target;
  }
  float a = sin((1.0 - t) * angularDist) / sin(angularDist);
  float b = sin(t * angularDist) / sin(angularDist);
  vec2 sin_source = sin(source);
  vec2 cos_source = cos(source);
  vec2 sin_target = sin(target);
  vec2 cos_target = cos(target);
  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
  float z = a * sin_source.y + b * sin_target.y;
  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));

}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if (u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    float total_Distance = pixelDistance(source, target) / 2.0 * PI;
    total_Distance = total_Distance * 16.0; // total_Distance*16.0 调整默认的效果
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if (u_animate.x == Animate) {
    v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0), a_Instance64Low.xy);
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0), a_Instance64Low.zw);

  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序
  if (LineTexture == u_line_texture) {
    float d_arcDistrance = length(source - target);
    d_arcDistrance = project_pixel(d_arcDistrance);

    float d_pixelLen = project_pixel(u_icon_step) / 8.0;
    v_line_data.b = floor(d_arcDistrance / d_pixelLen); // 贴图在弧线上重复的数量

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size); // 定点位置偏移，按地图等级缩放后的距离
    v_line_data.a = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,Cq={solid:0,dash:1};class Eq extends we{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:b.NEAREST,min:b.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:i="normal",lineType:n="solid",dashArray:a=[10,5],lineTexture:o=!1,iconStep:s=100,segmentNumber:l=30}=this.layer.getLayerConfig(),{animateOption:u}=this.layer.getLayerConfig();if(a.length===2&&a.push(0,0),this.rendererService.getDirty()){var c;(c=this.texture)===null||c===void 0||c.bind()}let h=0,f=[0,0,0,0],d=[0,0,0,0];t&&e&&(f=Le(t),d=Le(e),h=1);let v=this.layer.getLayerAnimateTime();isNaN(v)&&(v=0);const p={u_animate:this.animateOption2Array(u),u_dash_array:a,u_sourceColor:f,u_targetColor:d,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:l,u_line_type:Cq[n]||0,u_icon_step:s,u_line_texture:o?1:0,u_textureBlend:i==="normal"?0:1,u_time:v,u_linearColor:h};return this.getUniformsBufferInfo(p)}initModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return X(function*(){const{segmentNumber:e=30}=t.layer.getLayerConfig();return[yield t.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:xq,fragmentShader:_q,triangulation:mE,styleOption:{segmentNumber:e},defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:vt.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:4,update:(t,e,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:vt.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:4,update:(t,e,i)=>[mr(i[3]),mr(i[4]),mr(i[5]),mr(i[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:vt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:i}=t,{x:n,y:a}=e[i]||{x:0,y:0};return[n,a]}}})}}const Sq=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;
in vec2 v_iconMapUV;
in vec4 v_texture_data;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // 虚线部分
      discard;
    };
  }
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // 使用渐变颜色
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // 使用 color 方法传入的颜色
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // 当前顶点的距离
    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // 绘制 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // 外侧
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,Aq=`#define Animate (0.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_DISTANCE_INDEX) in vec3 a_DistanceAndIndexAndMiter;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec4 a_Normal_Total_Distance;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;
// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）
out vec2 v_iconMapUV;
out vec4 v_texture_data;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;
  float a_Miter = a_DistanceAndIndexAndMiter.z;
  vec3 a_Normal = a_Normal_Total_Distance.xyz;
  float a_Total_Distance = a_Normal_Total_Distance.w;
  //dash输出
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;

  // cal style mapping - 数据纹理映射部分的计算
  float d_texPixelLen; // 贴图的像素长度，根据地图层级缩放
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * a_Normal;

  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）
  float linePixelSize = project_pixel(a_Size.x) * 2.0; // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2
  float texV = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值

  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // 设置数据集的参数

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height
  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]

  // 兼容 mapbox 在线高度上的效果表现基本一致
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox
    // 保持高度相对不变
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    h *= mapboxZoomScale;
    h += u_raisingHeight * mapboxZoomScale;
    if (u_heightfixed > 0.0) {
      lineHeight *= mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(
    vec4(project_pos.xy + offset, lineHeight + h, 1.0)
  );

  setPickingColor(a_PickingColor);
}
`;class jF extends we{constructor(...t){super(...t),E(this,"textureEventFlag",!1),E(this,"texture",this.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.textures.length===0&&(this.textures=[this.texture]),this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:b.NEAREST,min:b.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128})})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,DISTANCE_INDEX:10,NORMAL:11,UV:12})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:i="normal",lineType:n="solid",dashArray:a=[10,5,0,0],lineTexture:o=!1,iconStep:s=100,vertexHeightScale:l=20,strokeWidth:u=0,raisingHeight:c=0,heightfixed:h=!1,linearDir:f=ow.VERTICAL,blur:d=[1,1,1,0]}=this.layer.getLayerConfig();let v=a;if(n!=="dash"&&(v=[0,0,0,0]),v.length===2&&v.push(0,0),this.rendererService.getDirty()&&this.texture){var p;(p=this.texture)===null||p===void 0||p.bind()}const{animateOption:g}=this.layer.getLayerConfig();let m=0,y=[0,0,0,0],_=[0,0,0,0];t&&e&&(y=Le(t),_=Le(e),m=1);const x={u_animate:this.animateOption2Array(g),u_dash_array:v,u_blur:d,u_sourceColor:y,u_targetColor:_,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:s,u_heightfixed:Number(h),u_vertexScale:l,u_raisingHeight:Number(c),u_strokeWidth:u,u_textureBlend:i===gZ.NORMAL?0:1,u_line_texture:o?1:0,u_linearDir:f===ow.VERTICAL?1:0,u_linearColor:m,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(x)}initModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),t.textureEventFlag||(t.textureEventFlag=!0,t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture)),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return X(function*(){const{depth:e=!1}=t.layer.getLayerConfig(),{frag:i,vert:n,type:a}=t.getShaders();return t.layer.triangulation=I1,[yield t.layer.buildLayerModel({moduleName:"line"+a,vertexShader:n,fragmentShader:i,triangulation:I1,defines:t.getDefines(),inject:t.getInject(),depth:{enable:e}})]})()}getShaders(){return{frag:Sq,vert:Aq,type:""}}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:vt.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:this.attributeLocation.DISTANCE_INDEX,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:3,update:(t,e,i,n,a,o)=>o===void 0?[i[3],10,i[4]]:[i[3],o,i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0],e[1]]:[e,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:vt.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:4,update:(t,e,i,n,a)=>[...a,i[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:vt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:i}=t,{x:n,y:a}=e[i]||{x:0,y:0};return[n,a]}}})}}const Tq=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // 虚线部分
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // 全局透明度
  }
  else{
    outputColor = v_color;
  }
}
`,bq=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash输出
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color;
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况

  float lineHeight = a_SizeDistanceAndTotalDistance.y;
  // 兼容 mapbox 在线高度上的效果表现基本一致
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // 保持高度相对不变
    h *= 2.0 / pow(2.0, 20.0 - u_Zoom);
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  gl_PointSize = 10.0;

}
`;class wq extends we{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,lineType:i="solid",dashArray:n=[10,5,0,0],vertexHeightScale:a=20}=this.layer.getLayerConfig();let o=n;i!=="dash"&&(o=[0,0,0,0]),o.length===2&&o.push(0,0);let s=0,l=[0,0,0,0],u=[0,0,0,0];t&&e&&(l=Le(t),u=Le(e),s=1);const c={u_sourceColor:l,u_targetColor:u,u_dash_array:o,u_vertexScale:a,u_linearColor:s};return this.getUniformsBufferInfo(c)}initModels(){var t=this;return X(function*(){return t.buildModels()})()}getShaders(){return{frag:Tq,vert:bq,type:"lineSimpleNormal"}}buildModels(){var t=this;return X(function*(){t.initUniformsBuffer();const{frag:e,vert:i,type:n}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:n,vertexShader:i,fragmentShader:e,triangulation:EZ,defines:t.getDefines(),inject:t.getInject(),primitive:b.LINES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:vt.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:4,update:(t,e,i)=>{const{size:n=1}=t,a=Array.isArray(n)?[n[0],n[1]]:[n,0];return[a[0],a[1],i[3],i[5]]}}})}}const Rq=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};


in vec2 v_iconMapUV;
in vec4 v_color;
in float v_blur;
in vec4 v_dataset;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // 使用渐变颜色
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // 使用 color 方法传入的颜色
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // 全局透明度
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // 当前顶点的距离
    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值

    // 计算纹理间隔 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // 计算纹理间隔 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: 判断纹理间隔
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }


  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,Mq=`#define Animate 0.0
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;
layout(location = ATTRIBUTE_LOCATION_DISTANCE_MITER_TOTAL) in vec3 a_Distance_Total_Miter;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};

// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out vec4 v_dataset;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  float a_Distance = a_Distance_Total_Miter.x;
  float a_Miter = a_Distance_Total_Miter.y;
  float a_Total_Distance = a_Distance_Total_Miter.z;

  float d_distance_ratio; // 当前点位距离占线总长的比例
  float d_texPixelLen; // 贴图的像素长度，根据地图层级缩放

  v_iconMapUV = a_iconMapUV;
  if (u_heightfixed < 1.0) {
    // 高度随 zoom 调整
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }

  if (u_animate.x == Animate || u_linearColor == 1.0) {
    d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0) / 2.0;
  // 设置数据集的参数
  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例
  v_dataset[1] = a_Distance; // 当前顶点的距离
  v_dataset[2] = d_texPixelLen; // 贴图的像素长度，根据地图层级缩放
  v_dataset[3] = miter; // 线图层贴图部分的 v 坐标值 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  float originSize = a_Size.x; // 固定高度
  if (u_heightfixed < 1.0) {
    originSize = project_float_meter(a_Size.x); // 高度随 zoom 调整
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  // 兼容 mapbox 在线高度上的效果表现基本一致
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox
    // 保持高度相对不变
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    if (u_heightfixed > 0.0) {
      wallHeight *= mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`;class Iq extends we{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:b.NEAREST,min:b.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:12,UV:13,DISTANCE_MITER_TOTAL:15})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:i="normal",heightfixed:n=!1,lineTexture:a=!1,iconStep:o=100,iconStepCount:s=1}=this.layer.getLayerConfig(),{animateOption:l}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var u;(u=this.texture)===null||u===void 0||u.bind()}let c=0,h=[0,0,0,0],f=[0,0,0,0];t&&e&&(h=Le(t),f=Le(e),c=1);const d={u_animate:this.animateOption2Array(l),u_sourceColor:h,u_targetColor:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:o,u_heightfixed:Number(n),u_linearColor:c,u_line_texture:a?1:0,u_textureBlend:i==="normal"?0:1,u_iconStepCount:s,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(d)}initModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return X(function*(){return[yield t.layer.buildLayerModel({moduleName:"lineWall",vertexShader:Mq,fragmentShader:Rq,triangulation:I1,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},blend:t.getBlend()})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0],e[1]]:[e,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:vt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:3,update:(t,e,i,n,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"distanceAndTotalAndMiter",type:vt.Attribute,descriptor:{name:"a_Distance_Total_Miter",shaderLocation:this.attributeLocation.DISTANCE_MITER_TOTAL,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:3,update:(t,e,i)=>[i[3],i[4],i[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:vt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:i}=t,{x:n,y:a}=e[i]||{x:0,y:0};return[n,a]}}})}}const Lq={arc:rq,arc3d:_w,greatcircle:Eq,wall:Iq,line:jF,simple:wq,flowline:yq,earthArc3d:_w},Oq=Lq;class nc extends uu{constructor(...t){super(...t),E(this,"type","LineLayer"),E(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),E(this,"arrowInsertCount",0),E(this,"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}})}buildModels(){var t=this;return X(function*(){const e=t.getModelType();t.layerModel=new Oq[e](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}}[t]}getModelType(){var t;if(this.layerType)return this.layerType;const e=this.styleAttributeService.getLayerStyleAttribute("shape");return(e==null||(t=e.scale)===null||t===void 0?void 0:t.field)||"line"}processData(t){if(this.getModelType()!=="simple")return t;const e=[];return t.map(i=>{if(Array.isArray(i.coordinates)&&Array.isArray(i.coordinates[0])&&Array.isArray(i.coordinates[0][0])){const n=V({},i);i.coordinates.map(a=>{e.push(V(V({},n),{},{coordinates:a}))})}else e.push(i)}),e}}const Pq=`
layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: 片元到中心点的距离 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: 片元的剪切成圆形
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // 当存在 stroke 且 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // 当不存在 stroke 或 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);
  
  if(u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,Fq=`
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0 / a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  vec2 offset = project_pixel(u_offsets);

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Sw(r){const t=r.coordinates;return{vertices:[...t],indices:[0],size:t.length}}class Bq extends we{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const{blend:t,strokeOpacity:e=1,strokeWidth:i=0,stroke:n="#fff"}=this.layer.getLayerConfig(),a={u_stroke_color:Le(n),u_additive:t==="additive"?1:0,u_stroke_opacity:e,u_stroke_width:i};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return X(function*(){return t.buildModels()})()}buildModels(){var t=this;return X(function*(){return t.layer.triangulation=Sw,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:Fq,fragmentShader:Pq,defines:t.getDefines(),inject:t.getInject(),triangulation:Sw,depth:{enable:!1},primitive:b.POINTS})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}})}}const Dq=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // 默认不固定
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // 开启透明度渐变
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,Nq=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // 默认不固定
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// 用于将在顶点着色器中计算好的样式值传递给片元


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) +
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - 数据纹理映射部分的计算
  vec3 size = a_Size * a_Position;

  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移
  if(u_heightfixed < 1.0) { // 圆柱体不固定高度
    //
  } else {// 圆柱体固定高度 （ 处理 mapbox ）
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r 控制圆柱的生长
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // 圆柱光照效果
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // 设置圆柱的底色
  if(u_linearColor == 1.0) { // 使用渐变颜色
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // 使用 color 方法传入的颜色
     v_color = a_Color;
  }
  v_color.a *= u_opacity;


  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度
  //旋转矩阵mx，创建绕x轴旋转矩阵
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//求解旋转角度余弦值
  float xsin = sin(xRadian);//求解旋转角度正弦值
  mat4 mx = mat4(
    1,0,0,0,
    0,xcos,-xsin,0,
    0,xsin,xcos,0,
    0,0,0,1);

  //旋转矩阵my，创建绕y轴旋转矩阵
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//求解旋转角度余弦值
  float ysin = sin(yRadian);//求解旋转角度正弦值
  mat4 my = mat4(
    ycos,0,-ysin,0,
    0,1,0,0,
    ysin,0,ycos,0,
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);


  setPickingColor(a_PickingColor);
}
`,{isNumber:kq}=tr;let Uq=class extends we{constructor(...t){super(...t),E(this,"raiseCount",0),E(this,"raiseRepeat",0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},opacity:e=1,sourceColor:i,targetColor:n,pickLight:a=!1,heightfixed:o=!0,opacityLinear:s={enable:!1,dir:"up"},lightEnable:l=!0}=this.layer.getLayerConfig();let u=0,c=[0,0,0,0],h=[0,0,0,0];if(i&&n&&(c=Le(i),h=Le(n),u=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:v=.01}=t;this.raiseCount+=v,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const f={u_sourceColor:c,u_targetColor:h,u_linearColor:u,u_pickLight:Number(a),u_heightfixed:Number(o),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:kq(e)?e:1,u_opacitylinear:Number(s.enable),u_opacitylinear_dir:s.dir==="up"?1:0,u_lightEnable:Number(l)};return this.getUniformsBufferInfo(f)}initModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return X(function*(){const{animateOption:{repeat:e=1}}=t.layer.getLayerConfig();return t.raiseRepeat=e,[yield t.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:Nq,fragmentShader:Dq,triangulation:gE,depth:{enable:!0},defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:b.FRONT},blend:t.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:3,update:t=>{const{size:e}=t;if(e){let i=[];return Array.isArray(e)&&(i=e.length===2?[e[0],e[0],e[1]]:e),Array.isArray(e)||(i=[e,e,e]),i}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:vt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:3,update:(t,e,i,n,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:vt.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:3,update:t=>{const e=Hl(t.coordinates);return WF([e[0],e[1]])}}})}};const zq=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,Hq=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize 设置拾取大小
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) 是为了兼容地球模式
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}
`;let $q=class extends we{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:e=0,blend:i,blur:n=0}=this.layer.getLayerConfig();this.layer.getLayerConfig();const a={u_additive:i==="additive"?1:0,u_stroke_opacity:t,u_stroke_width:e,u_blur:n};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return X(function*(){return t.layer.triangulation=pw,[yield t.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:Hq,fragmentShader:zq,triangulation:pw,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!0},blend:t.getBlend()})]})()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:vt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:3,update:(t,e,i,n)=>{const[a,o,s]=i,l=gi(0,0,1),u=gi(a,0,s),c=a>=0?pb(l,u):Math.PI*2-pb(l,u),h=Math.PI*2-Math.asin(o/100),f=jc();B0(f,f,c),Dd(f,f,h);const d=gi(1,1,0);Cv(d,d,f),qh(d,d);const v=gi(-1,1,0);Cv(v,v,f),qh(v,v);const p=gi(-1,-1,0);Cv(p,p,f),qh(p,p);const g=gi(1,-1,0);Cv(g,g,f),qh(g,g);const m=[...d,...v,...p,...g],y=n%4*3;return[m[y],m[y+1],m[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:vt.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{shape:e=2}=t;return[this.layer.getLayerConfig().shape2d.indexOf(e)]}}})}};const Wq=`
in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {

  outputColor = v_color;
  // 开启透明度渐变
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,Vq=`#define pi (3.1415926535)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec4 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if (x > 0.0 && z > 0.0) {
    return atan(x / z);
  } else if (x > 0.0 && z <= 0.0) {
    return atan(-z / x) + pi / 2.0;
  } else if (x <= 0.0 && z <= 0.0) {
    return pi + atan(x / z); //atan(x/z) +
  } else {
    return atan(z / -x) + pi * 3.0 / 2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y / r);
}

void main() {
  vec3 size = a_Size * a_Position;

  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移

  if (u_heightfixed < 1.0) {
    // 圆柱体不固定高度
  } else {
    // 圆柱体固定高度 （ 处理 mapbox ）
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      offset *= 4.0 / pow(2.0, 21.0 - u_Zoom);
    }
  }

  vec2 positions = a_Extrude.xy;
  vec2 positions64Low = a_Extrude.zw;
  vec4 project_pos = project_position(vec4(positions, 0.0, 1.0), positions64Low);

  // u_r 控制圆柱的生长
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // 圆柱光照效果
  float lightWeight = 1.0;

  if (u_lightEnable > 0.0) {
    // 取消三元表达式，增强健壮性
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

  // 设置圆柱的底色
  if (u_linearColor == 1.0) {
    // 使用渐变颜色
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a = v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

  if (u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? 1.0 - a_Position.z : a_Position.z;
  }

  gl_Position = project_common_position_to_clipspace(pos);

  setPickingColor(a_PickingColor);
}
`;let ZF=class extends we{constructor(...t){super(...t),E(this,"raiseCount",0),E(this,"raiseRepeat",0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,NORMAL:11})}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},sourceColor:e,targetColor:i,pickLight:n=!1,heightfixed:a=!1,opacityLinear:o={enable:!1,dir:"up"},lightEnable:s=!0}=this.layer.getLayerConfig();let l=0,u=[0,0,0,0],c=[0,0,0,0];if(e&&i&&(u=Le(e),c=Le(i),l=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:d=.01}=t;this.raiseCount+=d,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const h={u_pickLight:Number(n),u_heightfixed:Number(a),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:l,u_sourceColor:u,u_targetColor:c,u_opacitylinear:Number(o.enable),u_opacitylinear_dir:o.dir==="up"?1:0,u_lightEnable:Number(s)};return this.getUniformsBufferInfo(h)}initModels(){var t=this;return X(function*(){return t.buildModels()})()}buildModels(){var t=this;return X(function*(){const{depth:e=!0,animateOption:{repeat:i=1}}=t.layer.getLayerConfig();return t.raiseRepeat=i,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:Vq,fragmentShader:Wq,triangulation:gE,defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:b.FRONT},depth:{enable:e}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:3,update:t=>{const{size:e}=t;if(e){let i=[];return Array.isArray(e)&&(i=e.length===2?[e[0],e[0],e[1]]:e),Array.isArray(e)||(i=[e,e,e]),i}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:vt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:3,update:(t,e,i,n,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:vt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:4,update:t=>{const e=Hl(t.coordinates);return[e[0],e[1],mr(e[0]),mr(e[1])]}}})}};const Gq=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if(u_time!=-1.0){
    //wave相关逻辑
    float d = length(v_data.xy);
    if(d > 0.5) {
      discard;
    }
    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity;//wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity;//wave 
    outputColor = filterColor(outputColor);
  }
   // 作为 mask 模板时需要丢弃透明的像素
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,Xq=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // 透明度计算
   v_stroke = stroke;
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize 设置拾取大小
  *  u_meter2coord 在等面积大小的时候设置单位
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);

  // TODP: /abs(extrude.x) 是为了兼容地球模式
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`;let qF=class extends we{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:e=0,blend:i,blur:n=0,raisingHeight:a=0,heightfixed:o=!1,unit:s="pixel"}=this.layer.getLayerConfig();let l=this.getAnimateUniforms().u_time;isNaN(l)&&(l=-1);const u={u_blur_height_fixed:[n,Number(a),Number(o)],u_stroke_width:e,u_additive:i==="additive"?1:0,u_stroke_opacity:t,u_size_unit:pE[s],u_time:l,u_animate:this.getAnimateUniforms().u_animate};return this.getUniformsBufferInfo(u)}getAnimateUniforms(){const{animateOption:t={enable:!1}}=this.layer.getLayerConfig();return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Il)}initModels(){var t=this;return X(function*(){return t.buildModels()})()}buildModels(){var t=this;return X(function*(){const{frag:e,vert:i,type:n}=t.getShaders();return t.layer.triangulation=Il,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:n,vertexShader:i,fragmentShader:e,defines:t.getDefines(),inject:t.getInject(),triangulation:Il,depth:{enable:!1}})]})()}getShaders(){return{frag:Gq,vert:Xq,type:"pointFill"}}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){const t=this.layer.getLayerConfig().shape2d;this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:vt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:3,update:(e,i,n,a)=>{const o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],s=a%4*3;return[o[s],o[s+1],o[s+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:e=>{const{size:i=5}=e;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:vt.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:e=>{const{shape:i=2}=e;return[t.indexOf(i)]}}})}};const Yq=`in vec2 v_uv;// 本身的 uv 坐标
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,jq=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed;
  float u_raisingHeight;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0) / 2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if (u_size_unit == 1.0) {
    newSize = newSize * u_PixelsPerMeter.z;
  }

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = extrude.xy * newSize + offsets;

  offset = rotate_matrix(offset, rotation);

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`;class Zq extends we{constructor(...t){super(...t),E(this,"meter2coord",1),E(this,"texture",void 0),E(this,"isMeter",!1),E(this,"radian",0),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),this.layerService.throttleRenderLayers();return}this.texture=e({data:this.iconService.getCanvas(),mag:b.LINEAR,min:b.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,UV:11})}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:e=!1,unit:i="pixel"}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var n;(n=this.texture)===null||n===void 0||n.bind()}const a={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(e),u_raisingHeight:Number(t),u_size_unit:pE[i]};return this.getUniformsBufferInfo(a)}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Il)}initModels(){var t=this;return X(function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()})()}buildModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:jq,fragmentShader:Yq,triangulation:Il,depth:{enable:!1},defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:b.FRONT}})]})()}clearModels(){var t;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:vt.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{shape:i}=t,{x:n,y:a}=e[i]||{x:-64,y:-64};return[n,a]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:vt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:3,update:(t,e,i,n)=>{const a=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=n%4*3;return[a[o],a[o+1],a[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}})}}const qq=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main(){
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // 亮度提取
  
  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: 去除边缘部分 mipmap 导致的混合变暗
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if(fragmengTocenter >= 0.5) {
        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
        textureColor.a *= luma;
  }
  
  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
        outputColor= textureColor;
  }else {
        outputColor= step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
      discard;
  }
  outputColor = filterColor(outputColor);
}
`,Kq=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - 数据纹理映射部分的计算
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);

  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if (u_heightfixed < 1.0) {
    // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;class KF extends we{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(()=>{this.layerService.throttleRenderLayers()});return}this.texture=e({data:this.iconService.getCanvas(),mag:b.LINEAR,min:b.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0})})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10})}getUninforms(){if(this.rendererService.getDirty()){var t;(t=this.texture)===null||t===void 0||t.bind()}const e=this.getCommonUniformsInfo(),i=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V({},e.uniformsOption),i.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:e=!1}=this.layer.getLayerConfig(),i={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(t),u_heightfixed:Number(e),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(i)}initModels(){var t=this;return X(function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointImage",vertexShader:Kq,fragmentShader:qq,triangulation:CZ,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},primitive:b.POINTS})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:vt.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{shape:i}=t,{x:n,y:a}=e[i]||{x:-64,y:-64};return[n,a]}}})}}const Qq=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,Jq=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(project_pos);

  gl_PointSize = a_Size * u_size_scale * 2.0 * u_DevicePixelRatio;
}
`;function Aw(r){const t=r.coordinates;return{vertices:[...t],indices:[0],size:t.length}}class QF extends we{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const t={u_size_scale:.5};return this.getUniformsBufferInfo(t)}initModels(){var t=this;return X(function*(){return t.buildModels()})()}buildModels(){var t=this;return X(function*(){return t.layer.triangulation=Aw,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:Jq,fragmentShader:Qq,triangulation:Aw,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},primitive:b.POINTS,pick:!1})]})()}clearModels(){}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}})}}const tK=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,eK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2(
    cos(time), sin(time),
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_Extrude.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (a_Extrude.xy * (newSize));

  offset = project_pixel(offset);

  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`;class rK extends we{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10})}getCommonUniformsInfo(){const{blend:t,speed:e=1,unit:i="pixel"}=this.layer.getLayerConfig(),n={u_additive:t==="additive"?1:0,u_size_unit:pE[i],u_speed:e,u_time:this.layer.getLayerAnimateTime()};return this.getUniformsBufferInfo(n)}getAnimateUniforms(){return{}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Il)}initModels(){var t=this;return X(function*(){return t.buildModels()})()}buildModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:eK,fragmentShader:tK,triangulation:Il,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}})]})()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:vt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:3,update:(t,e,i,n)=>{const a=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=n%4*3;return[a[o],a[o+1],a[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}})}}class iK{constructor(t,e,i){E(this,"boxCells",[]),E(this,"xCellCount",void 0),E(this,"yCellCount",void 0),E(this,"boxKeys",void 0),E(this,"bboxes",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"xScale",void 0),E(this,"yScale",void 0),E(this,"boxUid",void 0);const n=this.boxCells;this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let a=0;a<this.xCellCount*this.yCellCount;a++)n.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0}insert(t,e,i,n,a){this.forEachCell(e,i,n,a,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(a)}query(t,e,i,n,a){return this.queryHitTest(t,e,i,n,!1,a)}hitTest(t,e,i,n,a){return this.queryHitTest(t,e,i,n,!0,a)}insertBoxCell(t,e,i,n,a,o){this.boxCells[a].push(o)}queryHitTest(t,e,i,n,a,o){if(i<0||t>this.width||n<0||e>this.height)return a?!1:[];const s=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n){if(a)return!0;for(let u=0;u<this.boxKeys.length;u++)s.push({key:this.boxKeys[u],x1:this.bboxes[u*4],y1:this.bboxes[u*4+1],x2:this.bboxes[u*4+2],y2:this.bboxes[u*4+3]});return o?s.filter(o):s}const l={hitTest:a,seenUids:{box:{},circle:{}}};return this.forEachCell(t,e,i,n,this.queryCell,s,l,o),a?s.length>0:s}queryCell(t,e,i,n,a,o,s,l){const u=s.seenUids,c=this.boxCells[a];if(c!==null){const h=this.bboxes;for(const f of c)if(!u.box[f]){u.box[f]=!0;const d=f*4;if(t<=h[d+2]&&e<=h[d+3]&&i>=h[d+0]&&n>=h[d+1]&&(!l||l(this.boxKeys[f]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:h[d],y1:h[d+1],x2:h[d+2],y2:h[d+3]})}}}return!1}forEachCell(t,e,i,n,a,o,s,l){const u=this.convertToXCellCoord(t),c=this.convertToYCellCoord(e),h=this.convertToXCellCoord(i),f=this.convertToYCellCoord(n);for(let d=u;d<=h;d++)for(let v=c;v<=f;v++){const p=this.xCellCount*v+d;if(a.call(this,t,e,i,n,p,o,s,l))return}}convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}const nK=iK;class aK{constructor(t,e){E(this,"width",void 0),E(this,"height",void 0),E(this,"grid",void 0),E(this,"viewportPadding",100),E(this,"screenRightBoundary",void 0),E(this,"screenBottomBoundary",void 0),E(this,"gridRightBoundary",void 0),E(this,"gridBottomBoundary",void 0),this.width=t,this.height=e,this.viewportPadding=Math.max(t,e),this.grid=new nK(t+this.viewportPadding,e+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=e+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=e+2*this.viewportPadding}placeCollisionBox(t){const e=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,n=t.x2+t.anchorPointX+this.viewportPadding,a=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(e,i,n,a)||this.grid.hitTest(e,i,n,a)?{box:[]}:{box:[e,i,n,a]}}insertCollisionBox(t,e){const i={featureIndex:e};this.grid.insert(i,t[0],t[1],t[2],t[3])}project(t,e,i){const n=Zz(e,i,0,1),a=qz(),o=Kz(...t);return vl(a,n,o),{x:(a[0]/a[3]+1)/2*this.width+this.viewportPadding,y:(-a[1]/a[3]+1)/2*this.height+this.viewportPadding}}isInsideGrid(t,e,i,n){return i>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary}}function JF(r){let t=.5,e=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(r){case"bottom":case"bottom-right":case"bottom-left":e=1;break;case"top":case"top-right":case"top-left":e=0;break;default:e=.5}return{horizontalAlign:t,verticalAlign:e}}function tB(r,t,e,i,n){if(!n)return;const a=r[i],o=a.glyph;if(o){const s=t[o].advance*a.scale,l=(r[i].x+s)*n;for(let u=e;u<=i;u++)r[u].x-=l}}function eB(r,t,e,i,n,a,o){const s=(t-e)*n,l=(-i*o+.5)*a;for(const u of r)u.x+=s,u.y+=l}function oK(r,t,e,i,n,a,o){let l=0,u=-8,c=0;const h=r.positionedGlyphs,f=a==="right"?1:a==="left"?0:.5,d=h.length;e.forEach(m=>{if(m.split("").forEach(y=>{const _=t[y],x=0;_&&(h.push({glyph:y,x:l,y:u+x,vertical:!1,scale:1,metrics:_}),l+=_.advance+o)}),h.length!==d){const y=l-o;c=Math.max(y,c),tB(h,t,d,h.length-1,f)}l=0,u-=i+5});const{horizontalAlign:v,verticalAlign:p}=JF(n);eB(h,f,v,p,c,i,e.length);const g=u- -8;r.top+=-p*g,r.bottom=r.top-g,r.left+=-v*c,r.right=r.left+c}function sK(r,t,e,i,n,a,o){let l=0,u=-8,c=0;const h=r.positionedGlyphs,f=a==="right"?1:a==="left"?0:.5,d=h.length;e.forEach(m=>{const y=t[m],_=0;if(y&&(h.push({glyph:m,x:y.advance/2,y:u+_,vertical:!1,scale:1,metrics:y}),l+=y.advance+o),h.length!==d){const x=l-o;c=Math.max(x,c),tB(h,t,d,h.length-1,f)}l=0,u-=i+5});const{horizontalAlign:v,verticalAlign:p}=JF(n);eB(h,f,v,p,c,i,e.length);const g=u- -8;r.top+=-p*g,r.bottom=r.top-g,r.left+=-v*c,r.right=r.left+c}function lK(r,t,e,i,n,a,o=[0,0],s){const l=r.split(`
`),u=[],c={positionedGlyphs:u,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:l.length,text:r};return s?sK(c,t,l,e,i,n,a):oK(c,t,l,e,i,n,a),u.length?c:!1}function uK(r,t=[0,0],e){const{positionedGlyphs:i=[]}=r,n=[];for(const a of i){const o=a.metrics,s=4,l=o.advance*a.scale/2,u=e?[a.x+l,a.y]:[0,0],c=e?[0,0]:[a.x+l+t[0],a.y+t[1]],h=(0-s)*a.scale-l+c[0],f=(0-s)*a.scale+c[1],d=h+o.width*a.scale,v=f+o.height*a.scale,p={x:h,y:f},g={x:d,y:f},m={x:h,y:v},y={x:d,y:v};n.push({tl:p,tr:g,bl:m,br:y,tex:o,glyphOffset:u})}return n}const Tw=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec2 v_uv;
in float v_gamma_scale;
in vec4 v_color;
in vec4 v_stroke_color;
in float v_fontScale;

out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // 作为 mask 模板时需要丢弃透明的像素
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,bw=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_TEXT_OFFSETS) in vec2 a_textOffsets;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_tex;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - 数据纹理映射部分的计算

  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // 文本缩放比例
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);

  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,{isEqual:Mh}=tr;function ww(r){const t=this,e=r.id,i=[],n=[];if(!t.glyphInfoMap||!t.glyphInfoMap[e])return{vertices:[],indices:[],size:7};const a=t.glyphInfoMap[e].centroid,o=a.length===2?[a[0],a[1],0]:a;return t.glyphInfoMap[e].glyphQuads.forEach((s,l)=>{i.push(...o,s.tex.x,s.tex.y+s.tex.height,s.tl.x,s.tl.y,...o,s.tex.x+s.tex.width,s.tex.y+s.tex.height,s.tr.x,s.tr.y,...o,s.tex.x+s.tex.width,s.tex.y,s.br.x,s.br.y,...o,s.tex.x,s.tex.y,s.bl.x,s.bl.y),n.push(0+l*4,1+l*4,2+l*4,2+l*4,3+l*4,0+l*4)}),{vertices:i,indices:n,size:7}}class rB extends we{constructor(...t){var e;super(...t),e=this,E(this,"glyphInfo",void 0),E(this,"glyphInfoMap",{}),E(this,"rawEncodeData",void 0),E(this,"texture",void 0),E(this,"currentZoom",-1),E(this,"extent",void 0),E(this,"textureHeight",0),E(this,"textCount",0),E(this,"preTextStyle",{}),E(this,"mapping",X(function*(){e.initGlyph(),e.updateTexture(),yield e.reBuildModel()}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,TEXT_OFFSETS:10,UV:11})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V(V({},t.uniformsOption),e.uniformsOption),{u_sdf_map:this.textures[0]})}getCommonUniformsInfo(){const{stroke:t="#fff",strokeWidth:e=0,halo:i=.5,gamma:n=2,raisingHeight:a=0}=this.layer.getLayerConfig(),o=this.getFontServiceMapping(),s=this.getFontServiceCanvas();o&&Object.keys(o).length!==this.textCount&&s&&(this.updateTexture(),this.textCount=Object.keys(o).length),this.preTextStyle=this.getTextStyle();const l={u_stroke_color:Le(t),u_sdf_map_size:[(s==null?void 0:s.width)||1,(s==null?void 0:s.height)||1],u_raisingHeight:Number(a),u_stroke_width:e,u_gamma_scale:n,u_halo_blur:i};return this.getUniformsBufferInfo(l)}initModels(){var t=this;return X(function*(){return t.bindEvent(),t.extent=t.textExtent(),t.rawEncodeData=t.layer.getEncodedData(),t.preTextStyle=t.getTextStyle(),t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return X(function*(){const{textAllowOverlap:e=!1}=t.layer.getLayerConfig();return t.initGlyph(),t.updateTexture(),e||t.filterGlyphs(),[yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:bw,fragmentShader:Tw,defines:t.getDefines(),inject:t.getInject(),triangulation:ww.bind(t),depth:{enable:!1}})]})()}needUpdate(){var t=this;return X(function*(){const{textAllowOverlap:e=!1,textAnchor:i="center",textOffset:n,padding:a,fontFamily:o,fontWeight:s}=t.getTextStyle();if(!Mh(a,t.preTextStyle.padding)||!Mh(n,t.preTextStyle.textOffset)||!Mh(i,t.preTextStyle.textAnchor)||!Mh(o,t.preTextStyle.fontFamily)||!Mh(s,t.preTextStyle.fontWeight))return yield t.mapping(),!0;if(e)return!1;const l=t.mapService.getZoom(),u=t.mapService.getBounds(),c=jP(t.extent,u);return Math.abs(t.currentZoom-l)>.5||!c||e!==t.preTextStyle.textAllowOverlap?(yield t.reBuildModel(),!0):!1})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.layer.off("remapping",this.mapping)}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:vt.Attribute,descriptor:{shaderLocation:this.attributeLocation.TEXT_OFFSETS,name:"a_textOffsets",buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:2,update:(t,e,i)=>[i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:vt.Attribute,descriptor:{name:"a_tex",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:(t,e,i)=>[i[3],i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e=12}=t;return Array.isArray(e)?[e[0]]:[e]}}})}bindEvent(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}textExtent(){const t=this.mapService.getBounds();return lE(t,.5)}initTextFont(){const{fontWeight:t,fontFamily:e}=this.getTextStyle(),i=this.rawEncodeData,n=[];i.forEach(a=>{let{shape:o=""}=a;o=o.toString();for(const s of o)n.indexOf(s)===-1&&n.push(s)}),this.fontService.setFontOptions({characterSet:n,fontWeight:t,fontFamily:e,iconfont:!1})}initIconFontTex(){const{fontWeight:t,fontFamily:e}=this.getTextStyle(),i=this.rawEncodeData,n=[];i.forEach(a=>{let{shape:o=""}=a;o=`${o}`,n.indexOf(o)===-1&&n.push(o)}),this.fontService.setFontOptions({characterSet:n,fontWeight:t,fontFamily:e,iconfont:!0})}getTextStyle(){const{fontWeight:t="400",fontFamily:e="sans-serif",textAllowOverlap:i=!1,padding:n=[0,0],textAnchor:a="center",textOffset:o=[0,0],opacity:s=1,strokeOpacity:l=1,strokeWidth:u=0,stroke:c="#000"}=this.layer.getLayerConfig();return{fontWeight:t,fontFamily:e,textAllowOverlap:i,padding:n,textAnchor:a,textOffset:o,opacity:s,strokeOpacity:l,strokeWidth:u,stroke:c}}generateGlyphLayout(t){const e=this.getFontServiceMapping(),{spacing:i=2,textAnchor:n="center",textOffset:a}=this.layer.getLayerConfig(),o=this.rawEncodeData;this.glyphInfo=o.map(s=>{const{shape:l="",id:u,size:c=1}=s,h=s.textOffset?s.textOffset:a||[0,0],f=s.textAnchor?s.textAnchor:n||"center",d=lK(l.toString(),e,c,f,"left",i,h,t),v=uK(d,h,!1);return s.shaping=d,s.glyphQuads=v,s.centroid=Hl(s.coordinates),this.glyphInfoMap[u]={shaping:d,glyphQuads:v,centroid:Hl(s.coordinates)},s})}getFontServiceMapping(){const{fontWeight:t="400",fontFamily:e="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getMappingByKey(`${e}_${t}`)}getFontServiceCanvas(){const{fontWeight:t="400",fontFamily:e="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getCanvasByKey(`${e}_${t}`)}filterGlyphs(){const{padding:t=[0,0],textAllowOverlap:e=!1}=this.layer.getLayerConfig();if(e)return;this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();const{width:i,height:n}=this.rendererService.getViewportSize(),a=new aK(i,n);this.glyphInfo.filter(s=>{const{shaping:l,id:u=0}=s,c=s.centroid,f=s.size/16,d=this.mapService.lngLatToContainer(c),{box:v}=a.placeCollisionBox({x1:l.left*f-t[0],x2:l.right*f+t[0],y1:l.top*f-t[1],y2:l.bottom*f+t[1],anchorPointX:d.x,anchorPointY:d.y});return v&&v.length?(a.insertCollisionBox(v,u),!0):!1}).forEach(s=>{this.glyphInfoMap[s.id]=s})}initGlyph(){const{iconfont:t=!1}=this.layer.getLayerConfig();t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}updateTexture(){const{createTexture2D:t}=this.rendererService,e=this.getFontServiceCanvas();this.textureHeight=e.height,this.texture&&this.texture.destroy(),this.texture=t({data:e,mag:b.LINEAR,min:b.LINEAR,width:e.width,height:e.height}),this.textures=[this.texture]}reBuildModel(){var t=this;return X(function*(){t.filterGlyphs();const e=yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:bw,fragmentShader:Tw,triangulation:ww.bind(t),defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}});t.layer.models=[e]})()}}const cK={fillImage:Zq,fill:qF,radar:rK,image:KF,normal:QF,simplePoint:Bq,extrude:ZF,text:rB,earthFill:$q,earthExtrude:Uq},hK=cK;class Wf extends uu{constructor(...t){super(...t),E(this,"type","PointLayer"),E(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),E(this,"enableDataEncodeStyles",["textOffset","textAnchor"]),E(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}})}buildModels(){var t=this;return X(function*(){const e=t.getModelType();t.layerModel&&t.layerModel.clearModels(),t.layerModel=new hK[e](t),yield t.initLayerModels()})()}rebuildModels(){var t=this;return X(function*(){yield t.buildModels()})()}getModelTypeWillEmptyData(){if(this.shapeOption){const{field:t,values:e}=this.shapeOption,{shape2d:i}=this.getLayerConfig(),n=this.iconService.getIconMap();if(t&&(i==null?void 0:i.indexOf(t))!==-1)return"fill";if(e==="text")return"text";if(e&&e instanceof Array){for(const a of e)if(typeof a=="string"&&n.hasOwnProperty(a))return"image"}}return"normal"}getDefaultConfig(){const t=this.getModelType();return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[t]}getModelType(){const t=this.getEncodedData(),{shape2d:e,shape3d:i,billboard:n=!0}=this.getLayerConfig(),a=this.iconService.getIconMap(),o=t.find(s=>s.hasOwnProperty("shape"));if(o){const s=o.shape;return s==="dot"?"normal":s==="simple"?"simplePoint":s==="radar"?"radar":this.layerType==="fillImage"||n===!1?"fillImage":(e==null?void 0:e.indexOf(s))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(i==null?void 0:i.indexOf(s))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":a.hasOwnProperty(s)?"image":"text"}else return this.getModelTypeWillEmptyData()}}function fK(r){return L1.apply(this,arguments)}function L1(){return L1=X(function*(r){if(window.createImageBitmap){const t=yield fetch(r);return yield createImageBitmap(yield t.blob())}else{const t=new window.Image;return new Promise(e=>{t.onload=()=>e(t),t.src=r,t.crossOrigin="Anonymous"})}}),L1.apply(this,arguments)}const dK=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = v_Color;
  
  outputColor = filterColor(outputColor);
}
`,vK=`
layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: 部分机型 GPU 计算精度兼容
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
       outputColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,pK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_uvs = a_uvs;
  // cal style mapping - 数据纹理映射部分的计算
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos, a_Position64Low);

  if (u_heightfixed > 0.0) {
    // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(project_pos);
  v_texture_data = vec2(a_Position.z, lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,gK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  float isSide = a_Position.z;
  float topU = a_uvs[0];
  float topV = 1.0 - a_uvs[1];
  float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);

  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);

  if (u_heightfixed > 0.0) {
    // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

 gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  // Tip: 部分机型 GPU 计算精度兼容
  if (isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,mK=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];

  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  // Tip: 部分机型 GPU 计算精度兼容
  if (isSide < 0.999) {// 是否是边缘
    // side face
    if (u_sidesurface < 1.0) {
      discard;
    }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {
     // top face
    if (u_topsurface < 1.0) {
      discard;
    }
  }
  
  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,yK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if (u_heightfixed > 0.0) {
    // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`;class _K extends we{constructor(...t){super(...t),E(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,UV:11})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{mapTexture:t,heightfixed:e=!1,raisingHeight:i=0,topsurface:n=!0,sidesurface:a=!0,sourceColor:o,targetColor:s}=this.layer.getLayerConfig();let l=0,u=[1,1,1,1],c=[1,1,1,1];o&&s&&(u=Le(o),c=Le(s),l=1);const h={u_sourceColor:u,u_targetColor:c,u_linearColor:l,u_topsurface:Number(n),u_sidesurface:Number(a),u_heightfixed:Number(e),u_raisingHeight:Number(i)};return t&&this.texture&&(h.u_texture=this.texture,this.textures=[this.texture]),this.getUniformsBufferInfo(h)}initModels(){var t=this;return X(function*(){return yield t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return X(function*(){const{frag:e,vert:i,type:n}=t.getShaders();return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:n,vertexShader:i,fragmentShader:e,depth:{enable:!0},defines:t.getDefines(),inject:t.getInject(),triangulation:GF})]})()}getShaders(){const{pickLight:t,mapTexture:e}=this.layer.getLayerConfig();return e?{frag:mK,vert:yK,type:"polygonExtrudeTexture"}:t?{frag:vK,vert:pK,type:"polygonExtrudePickLight"}:{frag:dK,vert:gK,type:"polygonExtrude"}}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.textures=[]}registerBuiltinAttributes(){const t=this.layer.getSource().extent,e=t[2]-t[0],i=t[3]-t[1];this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uvs",type:vt.Attribute,descriptor:{name:"a_uvs",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:3,update:(n,a,o)=>{const s=o[0],l=o[1];return[(s-t[0])/e,(l-t[1])/i,o[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:vt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:3,update:(n,a,o,s,l)=>l}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:n=>{const{size:a=10}=n;return Array.isArray(a)?[a[0]]:[a]}}})}loadTexture(){var t=this;return X(function*(){const{mapTexture:e}=t.layer.getLayerConfig(),{createTexture2D:i}=t.rendererService;if(t.texture=i({height:1,width:1}),e){const n=yield fK(e);t.texture=i({data:n,width:n.width,height:n.height,wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE,min:b.LINEAR,mag:b.LINEAR})}})()}}const xK=`
in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,CK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`;class EK extends we{constructor(...t){super(...t),E(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,EXTRUSION_BASE:11})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const t={};return this.getUniformsBufferInfo(t)}initModels(){var t=this;return X(function*(){return t.buildModels()})()}buildModels(){var t=this;return X(function*(){const{frag:e,vert:i,type:n}=t.getShaders();return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:n,vertexShader:i,fragmentShader:e,defines:t.getDefines(),inject:t.getInject(),triangulation:GF,depth:{enable:!0}})]})()}getShaders(){return{frag:xK,vert:CK,type:"polygonExtrude"}}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"normal",type:vt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:3,update:(t,e,i,n,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:vt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{size:e=10}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrusionBase",type:vt.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:this.attributeLocation.EXTRUSION_BASE,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:1,update:t=>{const{extrusionBase:e=0}=t;return[e]}}})}}const SK=`in vec4 v_color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,AK=`
layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec4 v_color;
in vec3 v_linear;
in vec2 v_pos;
out vec4 outputColor;
#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  outputColor = v_color;
  if (u_opacitylinear > 0.0) {
    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,TK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_LINEAR) in vec3 a_linear;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

out vec4 v_color;
out vec3 v_linear;
out vec2 v_pos;

#pragma include "projection"
#pragma include "picking"

void main() {
  if (u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  project_pos.z += u_raisingHeight;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}
`,bK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - 数据纹理映射部分的计算

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);

  project_pos.z += u_raisingHeight;

  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`;class wK extends we{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,LINEAR:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,opacityLinear:e={enable:!1,dir:"in"}}=this.layer.getLayerConfig(),i={u_raisingHeight:Number(t),u_opacitylinear:Number(e.enable),u_dir:e.dir==="in"?1:0};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return X(function*(){return t.buildModels()})()}buildModels(){var t=this;return X(function*(){const{frag:e,vert:i,triangulation:n,type:a}=t.getModelParams();return t.initUniformsBuffer(),t.layer.triangulation=n,[yield t.layer.buildLayerModel({moduleName:a,vertexShader:i,fragmentShader:e,defines:t.getDefines(),inject:t.getInject(),triangulation:n,primitive:b.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute();const{opacityLinear:t={enable:!1,dir:"in"}}=this.layer.getLayerConfig();t.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:vt.Attribute,descriptor:{name:"a_linear",shaderLocation:this.attributeLocation.LINEAR,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:3,update:(e,i,n)=>[n[3],n[4],n[5]]}})}getModelParams(){const{opacityLinear:t={enable:!1}}=this.layer.getLayerConfig();return t.enable?{frag:AK,vert:TK,type:"polygonLinear",triangulation:AZ}:{frag:SK,vert:bK,type:"polygonFill",triangulation:Hd}}}const RK=`
layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;

vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    
  outputColor = vec4(col, v_opacity);  
}
`,MK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class IK extends we{constructor(...t){super(...t),E(this,"texture1",void 0),E(this,"texture2",void 0),E(this,"texture3",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{watercolor:t="#6D99A8",watercolor2:e="#0F121C"}=this.layer.getLayerConfig(),i={u_watercolor:Le(t),u_watercolor2:Le(e),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};return this.textures=[this.texture1,this.texture2,this.texture3],this.getUniformsBufferInfo(i)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return X(function*(){return t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:MK,fragmentShader:RK,defines:t.getDefines(),inject:t.getInject(),triangulation:Hd,primitive:b.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var t,e,i;(t=this.texture1)===null||t===void 0||t.destroy(),(e=this.texture2)===null||e===void 0||e.destroy(),(i=this.texture3)===null||i===void 0||i.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[e,i,n,a]=t,o=n-e,s=a-i;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:vt.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:2,update:(l,u,c)=>{const[h,f]=c;return[(h-e)/o,(f-i)/s]}}})}loadTexture(){const{createTexture2D:t}=this.rendererService,e={height:0,width:0};this.texture1=t(e),this.texture2=t(e),this.texture3=t(e),i(a=>{this.texture1=n(a[0]),this.texture2=n(a[1]),this.texture3=n(a[2]),this.layerService.reRender()});function i(a){let o=0;const s=[];["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map(u=>{const c=new Image;c.crossOrigin="",c.src=u,s.push(c),c.onload=()=>{o++,o===3&&a(s)}})}function n(a){return t({data:a,width:a.width,height:a.height,wrapS:b.MIRRORED_REPEAT,wrapT:b.MIRRORED_REPEAT,min:b.LINEAR,mag:b.LINEAR})}}}const LK=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;


in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {

  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,OK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class PK extends we{constructor(...t){super(...t),E(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{speed:t=.5}=this.layer.getLayerConfig(),e={u_speed:t,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(e)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return X(function*(){return t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:OK,fragmentShader:LK,triangulation:Hd,defines:t.getDefines(),inject:t.getInject(),primitive:b.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1})]})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[e,i,n,a]=t,o=n-e,s=a-i;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:vt.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.STATIC_DRAW,data:[],type:b.FLOAT},size:2,update:(l,u,c)=>{const[h,f]=c;return[(h-e)/o,(f-i)/s]}}})}loadTexture(){const{waterTexture:t}=this.layer.getLayerConfig(),{createTexture2D:e}=this.rendererService;this.texture=e({height:1,width:1});const i=new Image;i.crossOrigin="",t?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),i.src=t):i.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",i.onload=()=>{this.texture=e({data:i,width:i.width,height:i.height,wrapS:b.MIRRORED_REPEAT,wrapT:b.MIRRORED_REPEAT,min:b.LINEAR,mag:b.LINEAR}),this.layerService.reRender()}}}const FK={fill:wK,line:jF,extrude:_K,text:rB,point_fill:qF,point_image:KF,point_normal:QF,point_extrude:ZF,water:PK,ocean:IK,extrusion:EK},BK=FK;class Ig extends uu{constructor(...t){super(...t),E(this,"type","PolygonLayer"),E(this,"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"])}buildModels(){var t=this;return X(function*(){const e=t.getModelType();t.layerModel=new BK[e](t),yield t.initLayerModels()})()}getModelType(){var t;const e=this.styleAttributeService.getLayerStyleAttribute("shape"),i=e==null||(t=e.scale)===null||t===void 0?void 0:t.field;return i==="fill"||!i?"fill":i==="extrude"?"extrude":i==="extrusion"?"extrusion":i==="water"?"water":i==="ocean"?"ocean":i==="line"?"line":this.getPointModelType()}getPointModelType(){const t=this.getEncodedData(),{shape2d:e,shape3d:i}=this.getLayerConfig(),n=this.iconService.getIconMap(),a=t.find(o=>o.hasOwnProperty("shape"));if(a){const o=a.shape;return o==="dot"?"point_normal":(e==null?void 0:e.indexOf(o))!==-1?"point_fill":(i==null?void 0:i.indexOf(o))!==-1?"point_extrude":n.hasOwnProperty(o)?"point_image":"text"}else return"fill"}}const DK=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
    discard;
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));
    
    outputColor = color;
    outputColor.a = outputColor.a * u_opacity ;
    if (outputColor.a < 0.01)
      discard;
  }
}
`,NK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;let Rw=class extends we{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"colorTexture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,clampLow:e=!0,clampHigh:i=!0,noDataValue:n=-9999999,domain:a,rampColors:o}=this.layer.getLayerConfig(),s=a||aE(o);this.colorTexture=this.layer.textureService.getColorTexture(o,s);const l={u_domain:s,u_opacity:t||1,u_noDataValue:n,u_clampLow:e?1:0,u_clampHigh:(typeof i<"u"?i:e)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};return this.textures=[this.texture,this.colorTexture],this.getUniformsBufferInfo(l)}getRasterData(t){return X(function*(){if(Array.isArray(t.data))return{data:t.data,width:t.width,height:t.height};{const{rasterData:e,width:i,height:n}=yield t.data;return{data:Array.from(e),width:i,height:n}}})()}initModels(){var t=this;return X(function*(){return t.buildModels()})()}buildModels(){var t=this;return X(function*(){t.initUniformsBuffer();const e=t.layer.getSource(),{createTexture2D:i,queryVerdorInfo:n}=t.rendererService,a=e.data.dataArray[0],{data:o,width:s,height:l}=yield t.getRasterData(a);return t.texture=i({data:new Float32Array(o),width:s,height:l,format:n()==="WebGL1"?b.LUMINANCE:b.RED,type:b.FLOAT,alignment:1}),[yield t.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:NK,fragmentShader:DK,defines:t.getDefines(),triangulation:G0,primitive:b.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}clearModels(){var t,e;(t=this.texture)===null||t===void 0||t.destroy(),(e=this.colorTexture)===null||e===void 0||e.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:vt.Attribute,descriptor:{shaderLocation:this.attributeLocation.UV,name:"a_Uv",buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:(t,e,i)=>[i[3],i[4]]}})}};const kK=["data"],UK=["rasterData"],zK=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {

  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;

  if(rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }

  if(outputColor.a < 0.01)
    discard;
 
}`,HK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_rminmax;
  vec2 u_gminmax;
  vec2 u_bminmax;
  float u_opacity;
  float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class $K extends we{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"dataOption",{})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,noDataValue:e=0}=this.layer.getLayerConfig(),{rMinMax:i=[0,255],gMinMax:n=[0,255],bMinMax:a=[0,255]}=this.dataOption,o={u_rminmax:i,u_gminmax:n,u_bminmax:a,u_opacity:t||1,u_noDataValue:e,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(o)}getRasterData(t){var e=this;return X(function*(){if(Array.isArray(t.data)){const{data:o}=t,s=$n(t,kK);return e.dataOption=s,V({data:o},s)}const i=yield t.data,{rasterData:n}=i,a=$n(i,UK);return e.dataOption=a,Array.isArray(n)?V({data:n},a):V({data:Array.from(n)},a)})()}initModels(){var t=this;return X(function*(){t.initUniformsBuffer();const e=t.layer.getSource(),{createTexture2D:i}=t.rendererService,n=e.data.dataArray[0],{data:a,width:o,height:s}=yield t.getRasterData(n);return t.texture=i({data:new Float32Array(a),width:o,height:s,format:b.RGB,type:b.FLOAT}),[yield t.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:HK,fragmentShader:zK,defines:t.getDefines(),triangulation:G0,primitive:b.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}buildModels(){var t=this;return X(function*(){return t.initModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:vt.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:(t,e,i)=>[i[3],i[4]]}})}}const WK=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

layout(std140) uniform commonUniforms {
 vec4 u_unpack;
 vec2 u_domain;
 float u_opacity;
 float u_noDataValue;
 float u_clampLow;
 float u_clampHigh;
};

in vec2 v_texCoord;
out vec4 outputColor;


float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return  texture(SAMPLER_2D(u_colorTexture), coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
     outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    outputColor = getColor(value);
    outputColor.a =  outputColor.a * u_opacity ;
      if(outputColor.a < 0.01)
      discard;
  }
}
`,VK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec4 u_unpack;
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};
out vec2 v_texCoord;
#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class GK extends we{constructor(...t){super(...t),E(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){const{opacity:t,clampLow:e=!0,clampHigh:i=!0,noDataValue:n=-9999999,domain:a,rampColors:o,colorTexture:s,rScaler:l=6553.6,gScaler:u=25.6,bScaler:c=.1,offset:h=1e4}=this.layer.getLayerConfig(),f=a||aE(o);let d=s;s?this.layer.textureService.setColorTexture(s,o,f):d=this.layer.textureService.getColorTexture(o,f);const v={u_unpack:[l,u,c,h],u_domain:f,u_opacity:t||1,u_noDataValue:n,u_clampLow:e,u_clampHigh:typeof i<"u"?i:e,u_texture:this.texture,u_colorTexture:d};return this.textures=[this.texture,d],this.getUniformsBufferInfo(v)}initModels(){var t=this;return X(function*(){t.initUniformsBuffer();const e=t.layer.getSource(),{createTexture2D:i}=t.rendererService,n=yield e.data.images;return t.texture=i({data:n[0],width:n[0].width,height:n[0].height,min:b.LINEAR,mag:b.LINEAR}),[yield t.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:VK,fragmentShader:WK,defines:t.getDefines(),triangulation:G0,primitive:b.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}buildModels(){var t=this;return X(function*(){return t.initModels()})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:vt.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:b.DYNAMIC_DRAW,data:[],type:b.FLOAT},size:2,update:(t,e,i)=>[i[3],i[4]]}})}}const XK={raster:Rw,rasterRgb:$K,raster3d:Rw,rasterTerrainRgb:GK},YK=XK;class yE extends uu{constructor(...t){super(...t),E(this,"type","RasterLayer")}buildModels(){var t=this;return X(function*(){const e=t.getModelType();t.layerModel=new YK[e](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[t]}getModelType(){switch(this.layerSource.getParserType()){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}getLegend(t){if(t!=="color")return{type:void 0,field:void 0,items:[]};const e=this.getLayerConfig().rampColors;return YF(e,t)}}class jK{constructor({rendererService:t,layerService:e,parent:i}){E(this,"tileResource",new Map),E(this,"rendererService",void 0),E(this,"layerService",void 0),E(this,"parent",void 0),E(this,"layerTiles",[]),this.rendererService=t,this.layerService=e,this.parent=i}get tiles(){return this.layerTiles}hasTile(t){return this.layerTiles.some(e=>e.key===t)}addTile(t){this.layerTiles.push(t)}getTile(t){return this.layerTiles.find(e=>e.key===t)}getVisibleTileBylngLat(t){return this.layerTiles.find(e=>e.isLoaded&&e.visible&&e.lnglatInBounds(t))}removeTile(t){const e=this.layerTiles.findIndex(n=>n.key===t),i=this.layerTiles.splice(e,1);i[0]&&i[0].destroy()}updateTileVisible(t){const e=this.getTile(t.key);if(t.isVisible)if(t.parent){const i=this.isChildrenLoaded(t.parent);e==null||e.updateVisible(i)}else e==null||e.updateVisible(!0);else if(t.parent){const i=this.isChildrenLoaded(t.parent);e==null||e.updateVisible(!i)}else e==null||e.updateVisible(!1)}isParentLoaded(t){const e=t.parent;if(!e)return!0;const i=this.getTile(e==null?void 0:e.key);return!!(i!=null&&i.isLoaded)}isChildrenLoaded(t){const e=t==null?void 0:t.children;return e.length===0?!0:e.every(i=>{const n=this.getTile(i==null?void 0:i.key);return n?(n==null?void 0:n.isLoaded)===!0:!0})}render(){var t=this;return X(function*(){const i=t.getRenderLayers().map(function(){var n=X(function*(a){yield t.layerService.renderTileLayer(a)});return function(a){return n.apply(this,arguments)}}());yield Promise.all(i)})()}getRenderLayers(){const t=this.layerTiles.filter(i=>i.visible&&i.isLoaded),e=[];return t.map(i=>e.push(...i.getLayers())),e}getLayers(){const t=this.layerTiles.filter(i=>i.isLoaded),e=[];return t.map(i=>e.push(...i.getLayers())),e}getTiles(){return this.layerTiles}destroy(){this.layerTiles.forEach(t=>t.destroy()),this.tileResource.clear()}}class ZK{getCombineFeature(t){let e=null;const i=t[0];return t.map(n=>{const a=pH(n.coordinates);e===null?e=a:e=gH(e,a)}),i&&(e.properties=V({},i)),e}}const Ih="select",Lh="active";class qK{constructor({layerService:t,tileLayerService:e,parent:i}){E(this,"layerService",void 0),E(this,"tileLayerService",void 0),E(this,"tileSourceService",void 0),E(this,"parent",void 0),E(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=e,this.parent=i,this.tileSourceService=new ZK}pickRender(t){const e=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(e){const i=e.getMainLayer();i==null||i.layerPickService.pickRender(t)}}pick(t,e){var i=this;return X(function*(){const a=i.parent.getContainer().pickingService;if(t.type==="RasterLayer"){const o=i.tileLayerService.getVisibleTileBylngLat(e.lngLat);if(o&&o.getMainLayer()!==void 0){const s=o.getMainLayer();return s.layerPickService.pickRasterLayer(s,e,i.parent)}return!1}return i.pickRender(e),a.pickFromPickingFBO(t,e)})()}selectFeature(t){const[e,i,n]=t,a=this.color2PickId(e,i,n);this.tilePickID.set(Ih,a),this.updateHighLight(e,i,n,Ih)}highlightPickedFeature(t){const[e,i,n]=t,a=this.color2PickId(e,i,n);this.tilePickID.set(Lh,a),this.updateHighLight(e,i,n,Lh)}updateHighLight(t,e,i,n){this.tileLayerService.tiles.map(a=>{const o=a.getMainLayer();switch(n){case Ih:o==null||o.hooks.beforeSelect.call([t,e,i]);break;case Lh:o==null||o.hooks.beforeHighlight.call([t,e,i]);break}})}setPickState(){const t=this.tilePickID.get(Ih),e=this.tilePickID.get(Lh);if(t){const[i,n,a]=this.pickId2Color(t);this.updateHighLight(i,n,a,Ih);return}if(e){const[i,n,a]=this.pickId2Color(e);this.updateHighLight(i,n,a,Lh);return}}color2PickId(t,e,i){return Ml(new Uint8Array([t,e,i]))}pickId2Color(t){return xc(t)}getFeatureById(t){const e=this.tileLayerService.getTiles().filter(n=>n.visible),i=[];return e.forEach(n=>{i.push(...n.getFeatureById(t))}),i}pickRasterLayer(){return!1}}function KK(r){return r==="PolygonLayer"?Ig:r==="LineLayer"?nc:Wf}function QK(r){return["PolygonLayer","LineLayer"].indexOf(r)!==-1}class cu extends Ti.EventEmitter{constructor(t,e){super(),E(this,"x",void 0),E(this,"y",void 0),E(this,"z",void 0),E(this,"key",void 0),E(this,"parent",void 0),E(this,"sourceTile",void 0),E(this,"visible",!0),E(this,"layers",[]),E(this,"isLoaded",!1),E(this,"tileMaskLayers",[]),E(this,"tileMask",void 0),this.parent=e,this.sourceTile=t,this.x=t.x,this.y=t.y,this.z=t.z,this.key=`${this.x}_${this.y}_${this.z}`}getLayers(){return this.layers}styleUpdate(...t){}lnglatInBounds(t){const[e,i,n,a]=this.sourceTile.bounds,{lng:o,lat:s}=t;return o>=e&&o<=n&&s>=i&&s<=a}getLayerOptions(){var t;const e=this.parent.getLayerConfig();return V(V({},e),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:QK(this.parent.type),mask:e.mask||((t=e.maskLayers)===null||t===void 0?void 0:t.length)!==0&&e.enableMask})}getMaskLayer(){const{maskLayers:t}=this.parent.getLayerConfig(),e=[];return t==null||t.forEach(i=>{if(!i.tileLayer)return e.push(i),i;const a=i.tileLayer.getTile(this.sourceTile.key),o=a==null?void 0:a.getLayers()[0];o&&e.push(o)}),e}addTileMask(){var t=this;return X(function*(){const e=new Ig({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[t.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),i=gf(t.parent.container);e.setContainer(i),yield e.init(),t.tileMask=e;const n=t.getMainLayer();return n!==void 0&&(n.tileMask=e),e})()}addMask(t,e){var i=this;return X(function*(){const n=gf(i.parent.container);e.setContainer(n),yield e.init(),t.addMask(e),i.tileMaskLayers.push(e)})()}addLayer(t){var e=this;return X(function*(){t.isTileLayer=!0;const i=gf(e.parent.container);t.setContainer(i),e.layers.push(t),yield t.init()})()}updateVisible(t){this.visible=t,this.updateOptions("visible",t)}updateOptions(t,e){this.layers.forEach(i=>{i.updateLayerConfig({[t]:e})})}getMainLayer(){return this.layers[0]}getFeatures(t){return[]}getFeatureById(t){return[]}destroy(){var t;(t=this.tileMask)===null||t===void 0||t.destroy(),this.layers.forEach(e=>e.destroy())}}class JK extends cu{initTileLayer(){var t=this;return X(function*(){const e=t.getSourceOption(),i=e.data.features[0].properties,n=new nc().source(e.data,e.options).size(1).shape("line").color("red"),a=new Wf({minZoom:t.z-1,maxZoom:t.z+1,textAllowOverlap:!0}).source([i],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(t.key).style({stroke:"#fff",strokeWidth:2});yield t.addLayer(n),yield t.addLayer(a),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:t.transforms}}}}class tQ extends cu{initTileLayer(){var t=this;return X(function*(){const e=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),n=t.getSourceOption(),a=new QZ(V({},i)).source(n.data,n.options);e&&Object.keys(e).forEach(o=>{var s,l;const u=o;a[u]((s=e[u])===null||s===void 0?void 0:s.field,(l=e[u])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const eQ=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,rQ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class iQ extends we{getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),V(V({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,color:e="#000"}=this.layer.getLayerConfig(),i={u_color:Le(e),u_opacity:t||1};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return X(function*(){return t.buildModels()})()}buildModels(){var t=this;return X(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"mask",vertexShader:rQ,fragmentShader:eQ,defines:t.getDefines(),triangulation:Hd,depth:{enable:!1},pick:!1})]})()}clearModels(t=!0){t&&this.layerService.clear()}registerBuiltinAttributes(){return""}}const nQ={fill:iQ},aQ=nQ;class iB extends uu{constructor(...t){super(...t),E(this,"type","MaskLayer")}buildModels(){var t=this;return X(function*(){const e=t.getModelType();t.layerModel=new aQ[e](t),yield t.initLayerModels()})()}getModelType(){return"fill"}}class oQ extends cu{initTileLayer(){var t=this;return X(function*(){const e=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),n=t.getSourceOption(),a=new iB(V({},i)).source(n.data,n.options);e&&Object.keys(e).forEach(o=>{var s,l;const u=o;a[u]((s=e[u])===null||s===void 0?void 0:s.field,(l=e[u])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),t.isLoaded=!0})()}getFeatures(t){return t?this.sourceTile.data.getTileData(t):[]}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:e,featureId:i}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(e)},options:{parser:{type:"geojson",featureId:i},transforms:t.transforms}}}}const sQ=["rasterData"];let lQ=class extends cu{initTileLayer(){var t=this;return X(function*(){const e=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),n=t.getSourceOption(),a=new yE(V({},i)).source(n.data,n.options);e&&Object.keys(e).forEach(o=>{var s,l;const u=o;a[u]((s=e[u])===null||s===void 0?void 0:s.field,(l=e[u])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource(),e=this.sourceTile.data.data,{rasterData:i}=e,n=$n(e,sQ);return{data:i,options:{parser:V({type:"rasterRgb",extent:this.sourceTile.bounds},n),transforms:t.transforms}}}};class uQ extends cu{initTileLayer(){var t=this;return X(function*(){const e=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),n=t.getSourceOption(),a=new yE(V({},i)).source(n.data,n.options);e&&Object.keys(e).forEach(o=>{var s,l;const u=o;a[u]((s=e[u])===null||s===void 0?void 0:s.field,(l=e[u])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const cQ=["rasterData"],hQ={positions:[0,1],colors:["#000","#fff"]};class fQ extends cu{constructor(...t){super(...t),E(this,"colorTexture",void 0)}initTileLayer(){var t=this;return X(function*(){const e=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),n=t.getSourceOption(),{rampColors:a,domain:o}=t.getLayerOptions();t.colorTexture=t.parent.textureService.getColorTexture(a,o);const s=new yE(V(V({},i),{},{colorTexture:t.colorTexture})).source(n.data,n.options);e&&Object.keys(e).forEach(l=>{var u,c;const h=l;s[h]((u=e[h])===null||u===void 0?void 0:u.field,(c=e[h])===null||c===void 0?void 0:c.values)}),yield t.addLayer(s),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource(),e=this.sourceTile.data.data,{rasterData:i}=e,n=$n(e,cQ);return{data:i,options:{parser:V({type:"raster",extent:this.sourceTile.bounds},n),transforms:t.transforms}}}styleUpdate(...t){const{rampColors:e=hQ,domain:i}=t;this.colorTexture=this.parent.textureService.getColorTexture(e,i||aE(e)),this.layers.forEach(n=>n.style({colorTexture:this.colorTexture}))}destroy(){this.layers.forEach(t=>t.destroy())}}class Mv extends cu{initTileLayer(){var t=this;return X(function*(){const e=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),n=KK(t.parent.type),a=t.getSourceOption();if(!a){t.isLoaded=!0,t.emit("loaded");return}const o=new n(V({},i)).source(a.data,a.options);Object.keys(e).forEach(s=>{var l,u;const c=s;o[c]((l=e[c])===null||l===void 0?void 0:l.field,(u=e[c])===null||u===void 0?void 0:u.values)}),yield t.addLayer(o),i.tileMask&&(yield t.addTileMask()),t.setLayerMinMaxZoom(o),t.isLoaded=!0,t.emit("loaded")})()}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:e="defaultLayer",featureId:i="id"}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(e)},options:{parser:{type:"geojson",featureId:i},transforms:t.transforms}}}setLayerMinMaxZoom(t){t.getModelType()==="text"&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}getFeatures(t){return this.sourceTile.data.getTileData(t)}getFeatureById(t){const e=this.getMainLayer();return e?e.getSource().data.dataArray.filter(n=>n._id===t):[]}}function dQ(r){switch(r.type){case"PolygonLayer":return Mv;case"LineLayer":return Mv;case"PointLayer":return Mv;case"TileDebugLayer":return JK;case"MaskLayer":return oQ;case"RasterLayer":const{dataType:e}=r.getSource().parser;switch(e){case $r.RGB:case $r.CUSTOMRGB:return lQ;case $r.ARRAYBUFFER:case $r.CUSTOMARRAYBUFFER:return fQ;case $r.TERRAINRGB:case $r.CUSTOMTERRAINRGB:return uQ;default:return tQ}default:return Mv}}const vQ=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],{debounce:pQ}=tr;class gQ{constructor(t){E(this,"parent",void 0),E(this,"tileLayerService",void 0),E(this,"mapService",void 0),E(this,"layerService",void 0),E(this,"rendererService",void 0),E(this,"pickingService",void 0),E(this,"tilePickService",void 0),E(this,"tilesetManager",void 0),E(this,"initedTileset",!1),E(this,"lastViewStates",void 0),E(this,"mapchange",()=>{var i;if(this.parent.isVisible()===!1)return;const{latLonBounds:n,zoom:a}=this.getCurrentView();this.lastViewStates&&this.lastViewStates.zoom===a&&this.lastViewStates.latLonBounds.toString()===n.toString()||(this.lastViewStates={zoom:a,latLonBounds:n},(i=this.tilesetManager)===null||i===void 0||i.throttleUpdate(a,n))}),E(this,"viewchange",pQ(this.mapchange,24)),this.parent=t;const e=this.parent.getContainer();this.rendererService=e.rendererService,this.layerService=e.layerService,this.mapService=e.mapService,this.pickingService=e.pickingService,this.tileLayerService=new jK({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new qK({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}initTileSetManager(){var t;const e=this.parent.getSource();if(this.tilesetManager=e.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()===!1)return;const{latLonBounds:i,zoom:n}=this.getCurrentView();(t=this.tilesetManager)===null||t===void 0||t.update(n,i)}getCurrentView(){const t=this.mapService.getBounds(),e=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:e,zoom:i}}bindTilesetEvent(){this.tilesetManager.on("tile-loaded",t=>{}),this.tilesetManager.on("tile-unload",t=>{this.tileUnLoad(t)}),this.tilesetManager.on("tile-error",(t,e)=>{this.tileError(t)}),this.tilesetManager.on("tile-update",()=>{this.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}render(){this.tileLayerService.render()}getLayers(){return this.tileLayerService.getLayers()}getTiles(){return this.tileLayerService.getTiles()}getTile(t){return this.tileLayerService.getTile(t)}tileLoaded(t){}tileError(t){console.warn("error:",t)}destroy(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}reload(){var t;this.tilesetManager.clear();const{latLonBounds:e,zoom:i}=this.getCurrentView();(t=this.tilesetManager)===null||t===void 0||t.update(i,e)}tileUnLoad(t){this.tileLayerService.removeTile(t.key)}tileUpdate(){var t=this;return X(function*(){if(!t.tilesetManager)return;const e=t.parent.getMinZoom(),i=t.parent.getMaxZoom(),n=t.tilesetManager.tiles.filter(a=>a.isLoaded).filter(a=>a.isVisibleChange).filter(a=>a.data).filter(a=>a.z>=e&&a.z<i);yield Promise.all(n.map(function(){var a=X(function*(o){if(t.tileLayerService.hasTile(o.key))t.tileLayerService.updateTileVisible(o),t.tilePickService.setPickState(),t.layerService.reRender();else{const s=dQ(t.parent),l=new s(o,t.parent);yield l.initTileLayer(),t.tilePickService.setPickState(),l.getLayers().length!==0&&(t.tileLayerService.addTile(l),t.tileLayerService.updateTileVisible(o),t.layerService.reRender())}});return function(o){return a.apply(this,arguments)}}())),t.tilesetManager.isLoaded&&t.parent.emit("tiles-loaded",t.tilesetManager.currentTiles)})()}setPickState(t){}pickRender(t){this.tilePickService.pickRender(t)}selectFeature(t){this.tilePickService.selectFeature(t)}highlightPickedFeature(t){this.tilePickService.highlightPickedFeature(t)}proxy(t){vQ.forEach(e=>{const i=t[e].bind(t);t[e]=(...n)=>(i(...n),this.getLayers().map(a=>{a[e](...n)}),e==="style"&&this.getTiles().forEach(a=>a.styleUpdate(...n)),t)})}}class mQ extends ko{constructor(...t){super(...t),E(this,"disabled",void 0),E(this,"zoomInButton",void 0),E(this,"zoomOutButton",void 0),E(this,"zoomNumDiv",void 0),E(this,"zoomIn",()=>{!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}),E(this,"zoomOut",()=>{!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}),E(this,"updateDisabled",()=>{const e=this.mapsService;this.zoomInButton.removeAttribute("disabled"),this.zoomOutButton.removeAttribute("disabled"),(this.disabled||e.getZoom()<=e.getMinZoom())&&this.zoomOutButton.setAttribute("disabled","true"),this.controlOption.showZoom&&this.zoomNumDiv&&(this.zoomNumDiv.innerText=String(Math.floor(e.getZoom()))),(this.disabled||e.getZoom()>=e.getMaxZoom())&&this.zoomInButton.setAttribute("disabled","true")})}getDefault(t){return V(V({},super.getDefault(t)),{},{position:Ec.BOTTOMRIGHT,name:"zoom",zoomInText:Mg("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Mg("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}onAdd(){const t=Me("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}onRemove(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}disable(){return this.disabled=!0,this.updateDisabled(),this}enable(){return this.disabled=!1,this.updateDisabled(),this}resetButtonGroup(t){kd(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",t)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}createButton(t,e,i,n,a){const o=Me("button",i,n);return typeof t=="string"?o.innerHTML=t:o.append(t),o.title=e,a&&o.addEventListener("click",a),o}}class yQ extends Ti.EventEmitter{get lngLat(){var t;return(t=this.popupOption.lngLat)!==null&&t!==void 0?t:{lng:0,lat:0}}set lngLat(t){this.popupOption.lngLat=t}constructor(t){super(),E(this,"popupOption",void 0),E(this,"mapsService",void 0),E(this,"sceneService",void 0),E(this,"layerService",void 0),E(this,"scene",void 0),E(this,"closeButton",void 0),E(this,"container",void 0),E(this,"content",void 0),E(this,"contentTitle",void 0),E(this,"contentPanel",void 0),E(this,"tip",void 0),E(this,"isShow",!0),E(this,"onMouseMove",i=>{var n;const a=this.mapsService.getMapContainer(),{left:o=0,top:s=0}=(n=a==null?void 0:a.getBoundingClientRect())!==null&&n!==void 0?n:{};this.setPopupPosition(i.clientX-o,i.clientY-s)}),E(this,"updateLngLatPosition",()=>{if(!this.mapsService||this.popupOption.followCursor)return;const{lng:i,lat:n}=this.lngLat,{x:a,y:o}=this.mapsService.lngLatToContainer([i,n]);this.setPopupPosition(a,o)}),E(this,"updateLngLatPositionWhenZoom",i=>{if(!this.mapsService||this.popupOption.followCursor)return;const n=i.map,a=n.getSize();a.x=a.x/2,a.y=a.y/2;const o=i.center,s=i.zoom,l=n.DE(this.lngLat,s,o);l.x=Math.round(l.x),l.y=Math.round(l.y),this.setPopupPosition(l.x,l.y,!0)}),E(this,"onKeyDown",i=>{i.keyCode===27&&this.remove()}),E(this,"onCloseButtonClick",i=>{i.stopPropagation&&i.stopPropagation(),this.hide()}),E(this,"updatePosition",(i,n=!0)=>{const a=!!this.lngLat,{className:o,style:s,maxWidth:l,anchor:u,stopPropagation:c}=this.popupOption;if(!this.mapsService||!a||!this.content)return;const h=this.mapsService.getMarkerContainer();if(!this.container&&h&&(this.container=Me("div",`l7-popup ${o??""} ${this.isShow?"":"l7-popup-hide"}`,h),s&&this.container.setAttribute("style",s),this.tip=Me("div","l7-popup-tip",this.container),this.container.appendChild(this.content),c&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(f=>{this.container.addEventListener(f,d=>{d.stopPropagation()})}),this.container.style.whiteSpace="nowrap"),n?this.updateLngLatPositionWhenZoom(i):this.updateLngLatPosition(),XP(this.container,`${_g[u]}`),HP(this.container,u,"popup"),l){const{width:f}=this.container.getBoundingClientRect();f>parseFloat(l)&&(this.container.style.width=l)}else this.container.style.removeProperty("width")}),E(this,"updateWhenZoom",i=>{this.updatePosition(i,!0)}),E(this,"update",()=>{this.updatePosition(null,!1)}),this.popupOption=V(V({},this.getDefault(t??{})),t);const{lngLat:e}=this.popupOption;e&&(this.lngLat=e)}getIsShow(){return this.isShow}addTo(t){this.mapsService=t.mapService,this.sceneService=t.sceneService,this.layerService=t.layerService,this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();const{html:e,text:i,title:n}=this.popupOption;return e?this.setHTML(e):i&&this.setText(i),n&&this.setTitle(n),this.emit("open"),this}remove(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&sn(this.content),this.container&&(sn(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}getOptions(){return this.popupOption}setOptions(t){this.show();const{className:e}=this.popupOption;if(this.popupOption=V(V({},this.popupOption),t),this.checkUpdateOption(t,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","lngLat","offsets"])&&(this.container&&(sn(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["className"])){var i;e&&this.container.classList.remove(e??""),this.container.classList.add((i=t.className)!==null&&i!==void 0?i:"")}if(this.checkUpdateOption(t,["style"])){var n;sE(this.container,(n=t.style)!==null&&n!==void 0?n:"")}return this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}open(){return this.addTo(this.scene),this}close(){return this.remove(),this}show(){if(!this.isShow)return this.container&&Cc(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}hide(){if(this.isShow)return this.container&&Oo(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}setHTML(t){return this.popupOption.html=t,this.setDOMContent(t)}setText(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}setTitle(t){this.show(),this.popupOption.title=t,t?(this.contentTitle||(this.contentTitle=Me("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),kd(this.contentTitle),pl(this.contentTitle,t)):this.contentTitle&&(sn(this.contentTitle),this.contentTitle=void 0)}panToPopup(){const{lng:t,lat:e}=this.lngLat;return this.popupOption.autoPan&&this.mapsService.panTo([t,e]),this}setLngLat(t){return this.setLnglat(t)}setLnglat(t){return this.show(),this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(()=>{this.panToPopup()},0),this}getLnglat(){return this.lngLat}setMaxWidth(t){return this.popupOption.maxWidth=t,this.update(),this}isOpen(){return!!this.mapsService}getDefault(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:z0.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}setDOMContent(t){return this.show(),this.createContent(),pl(this.contentPanel,t),this.update(),this}updateCloseOnClick(t){const e=this.mapsService;e&&(e==null||e.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame(()=>{e==null||e.on("click",this.onCloseButtonClick)}))}updateCloseOnEsc(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}updateFollowCursor(t){var e;const i=(e=this.mapsService)===null||e===void 0?void 0:e.getContainer();i&&(i==null||i.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(i==null||i.addEventListener("mousemove",this.onMouseMove)))}createContent(){if(this.content&&sn(this.content),this.contentTitle=void 0,this.content=Me("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){const t=Mg("l7-icon-guanbi");Oo(t,"l7-popup-close-button"),this.content.appendChild(t),this.popupOption.closeButtonOffsets&&(t.style.right=this.popupOption.closeButtonOffsets[0]+"px",t.style.top=this.popupOption.closeButtonOffsets[1]+"px"),t.setAttribute("aria-label","Close popup"),t.addEventListener("click",()=>{this.hide()}),t.addEventListener("pointerup",e=>{e.stopPropagation()}),t.addEventListener("pointerdown",e=>{e.stopPropagation()}),this.closeButton=t}else this.closeButton=void 0;this.contentPanel=Me("div","l7-popup-content__panel",this.content)}setPopupPosition(t,e,i=!1){if(this.container){const{offsets:n}=this.popupOption;this.container.style.left=t+n[0]+"px",this.container.style.top=e-n[1]+"px",i?this.container.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)":this.container.style.transition=""}}checkUpdateOption(t,e){return e.some(i=>i in t)}}const{get:_Q}=tr;class gzt extends yQ{constructor(...t){super(...t),E(this,"layerClickCountByFrame",0),E(this,"layerConfigMap",new WeakMap),E(this,"displayFeatureInfo",void 0),E(this,"onLayerClick",(e,i)=>{requestAnimationFrame(()=>{if(this.popupOption.closeOnClick&&this.layerClickCountByFrame++,this.isShow&&this.isSameFeature(e,i.featureId))this.hide();else{const{title:n,content:a}=this.getLayerInfoFrag(e,i);this.setDOMContent(a),this.setLnglat(i.lngLat),this.setTitle(n),this.setDisplayFeatureInfo({layer:e,featureId:i.featureId}),this.show()}})}),E(this,"onSceneClick",()=>{this.layerClickCountByFrame=0,requestAnimationFrame(()=>{this.layerClickCountByFrame||this.hide()})}),E(this,"onLayerHide",()=>{this.hide(),this.setDisplayFeatureInfo(void 0)}),E(this,"updateCloseOnClick",()=>{})}get layerConfigItems(){var t;const{config:e,items:i}=this.popupOption;return(t=e??i)!==null&&t!==void 0?t:[]}addTo(t){return super.addTo(t),this.bindLayerEvent(),this.hide(),this}remove(){return super.remove(),this.unbindLayerEvent(),this}setOptions(t){this.unbindLayerEvent();const e=V({},t),i=e.trigger||this.popupOption.trigger,n=e.items||this.popupOption.items,a=(n==null?void 0:n.length)===0;e.followCursor=i==="hover"&&!a;const o=this.isShow;return super.setOptions(e),this.bindLayerEvent(),(a||!o)&&this.hide(),this}getDefault(t){const e=t.trigger!=="click";return V(V({},super.getDefault(t)),{},{trigger:"hover",followCursor:e,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}bindLayerEvent(){const{trigger:t,closeOnClick:e}=this.popupOption;this.layerConfigItems.forEach(i=>{var n;const a=this.getLayerByConfig(i);if(!a)return;const o=V({},i);if(t==="hover"){const c=this.onLayerMouseMove.bind(this,a),h=this.onLayerMouseOut.bind(this,a);o.onMouseMove=c,o.onMouseOut=h,a==null||a.on("mousemove",c),a==null||a.on("mouseout",h)}else{var s;const c=this.onLayerClick.bind(this,a);o.onClick=c,a==null||a.on("click",c);const h=(s=this.mapsService)===null||s===void 0?void 0:s.getMapContainer();h&&e&&h.addEventListener("click",this.onSceneClick)}const l=a==null||(n=a.getSource)===null||n===void 0?void 0:n.call(a),u=this.onSourceUpdate.bind(this);l==null||l.on("update",u),o.onSourceUpdate=u,this.layerConfigMap.set(a,o)})}unbindLayerEvent(){this.layerConfigItems.forEach(t=>{var e;const i=this.getLayerByConfig(t),n=i&&this.layerConfigMap.get(i);if(!n)return;const{onMouseMove:a,onMouseOut:o,onClick:s,onSourceUpdate:l}=n;if(a&&i.off("mousemove",a),o&&i.off("mouseout",o),s&&i.off("click",s),l){var u;i==null||(u=i.getSource())===null||u===void 0||u.off("update",l)}const c=(e=this.mapsService)===null||e===void 0?void 0:e.getMapContainer();c&&c.removeEventListener("click",this.onSceneClick)})}onLayerMouseMove(t,e){if(!this.isSameFeature(t,e.featureId)){const{title:i,content:n}=this.getLayerInfoFrag(t,e);this.setDOMContent(n),this.setTitle(i),this.setDisplayFeatureInfo({layer:t,featureId:e.featureId}),this.show()}}onLayerMouseOut(t,e){this.setDisplayFeatureInfo(void 0),this.isShow&&this.hide()}onSourceUpdate(){this.hide(),this.setDisplayFeatureInfo(void 0)}getLayerInfoFrag(t,e){const i=this.layerConfigMap.get(t);let n;const a=document.createDocumentFragment();if(i){let o=e.feature;o.type==="Feature"&&"properties"in o&&"geometry"in o&&(o=o.properties);const{title:s,fields:l,customContent:u}=i;if(s){n=document.createDocumentFragment();const c=s instanceof Function?s(o):s;pl(n,c)}if(u){const c=u instanceof Function?u(o):u;pl(a,c)}else l!=null&&l.length&&(l==null||l.forEach(c=>{var h,f;const{field:d,formatField:v,formatValue:p,getValue:g}=typeof c=="string"?{field:c}:c,m=Me("div","l7-layer-popup__row"),y=g?g(e.feature):_Q(o,d),_=(h=v instanceof Function?v(d,o):v)!==null&&h!==void 0?h:d;let x=(f=p instanceof Function?p(y,o):p)!==null&&f!==void 0?f:y;const C=Me("span","l7-layer-popup__key",m);pl(C,_),pl(C,document.createTextNode("："));const A=Me("span","l7-layer-popup__value",m);Array.isArray(x)&&x.every(T=>!(T instanceof Object))&&(x=x.map(T=>String(T)).join(",")),pl(A,x),a.appendChild(m)}))}return{title:n,content:a}}getLayerByConfig(t){const e=t.layer;if(e instanceof Object)return e;if(typeof e=="string")return this.layerService.getLayer(e)||this.layerService.getLayerByName(e)}isSameFeature(t,e){const i=this.displayFeatureInfo;return i&&t===i.layer&&e===i.featureId}setDisplayFeatureInfo(t){const e=this.displayFeatureInfo;e&&e.layer.off("hide",this.onLayerHide),t&&t.layer.on("hide",this.onLayerHide),this.displayFeatureInfo=t}}function xQ(r,t){var e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(e||i)&&(t||(t=document),!!t)){var n=t.head||t.getElementsByTagName("head")[0];if(!n){n=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(n,a):t.documentElement.appendChild(n)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(t.createTextNode(r)),n.appendChild(o),o}}xQ(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font:
    12px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  box-sizing: border-box;
}
.l7-control-container {
  font:
    12px/1.5 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: flex;
  justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  align-items: flex-end;
}
.l7-control-container .l7-column {
  flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 6px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  align-items: flex-start;
}
.l7-popper.l7-popper-end {
  align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: flex;
  align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: flex;
  flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  flex-direction: column;
  justify-content: center;
  box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: flex;
  flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: flex;
  align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  touch-action: none;
}
.l7-control-swipe_hide {
  display: none;
}
.l7-control-swipe:before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}
.l7-control-swipe.horizontal:before {
  top: 50%;
  right: -5000px;
  bottom: auto;
  left: -5000px;
  width: auto;
  height: 4px;
}
.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}
.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}
.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}
.l7-control-swipe:after,
.l7-control-swipe__button:before,
.l7-control-swipe__button:after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentColor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}
.l7-control-swipe__button:after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}
.l7-control-swipe__button:before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`);class _E{constructor(t){E(this,"configService",void 0),E(this,"config",void 0),this.config=t}setContainer(t,e){this.configService=t.globalConfigService,t.mapConfig=V(V({},this.config),{},{id:e}),t.mapService=new(this.getServiceConstructor())(t)}getServiceConstructor(){throw new Error("Method not implemented.")}}class nB{constructor(t){E(this,"size",1e4),this.size=t||1e4}setSize(t){this.size=t}getSize(){return[this.size,this.size]}mercatorXfromLng(t){return(180+t)/360*this.size}mercatorYfromLat(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}lngFromMercatorX(t){return t/this.size*360-180}latFromMercatorY(t){const e=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}project(t){const e=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[e,i]}unproject(t){const e=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[e,i]}}const CQ=12;class EQ{constructor(t){E(this,"map",void 0),E(this,"simpleMapCoord",new nB),E(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),E(this,"config",void 0),E(this,"configService",void 0),E(this,"coordinateSystemService",void 0),E(this,"eventEmitter",void 0),E(this,"markerContainer",void 0),E(this,"mapContainer",void 0),E(this,"cameraChangedCallback",void 0),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new Ti.EventEmitter}onCameraChanged(t){this.cameraChangedCallback=t}updateView(t){var e;this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom}),this.updateCoordinateSystemService(),(e=this.cameraChangedCallback)===null||e===void 0||e.call(this,this.viewport)}updateCoordinateSystemService(){const{offsetCoordinate:t=!0}=this.config;this.viewport.getZoom()>CQ&&t?this.coordinateSystemService.setCoordinateSystem(Sc.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Sc.LNGLAT)}creatMapContainer(t){let e;return typeof t=="string"?e=document.getElementById(t):e=t,e}getMapStyleValue(t){var e;return(e=this.getMapStyleConfig()[t])!==null&&e!==void 0?e:t}setBgColor(t){this.bgColor=t}getMapContainer(){return this.mapContainer}getMarkerContainer(){return this.markerContainer}getOverlayContainer(){}getCanvasOverlays(){}emit(t,...e){this.eventEmitter.emit(t,...e)}once(t,e){this.eventEmitter.once(t,e)}meterToCoord(t,e){return 1}destroy(){this.eventEmitter.removeAllListeners()}}class xE{constructor(){E(this,"viewport",new mb)}syncWithMapCamera(t){const{center:e,zoom:i,pitch:n,bearing:a,viewportHeight:o,viewportWidth:s}=t,l={width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing};this.viewport=new mb(V(V({},l),{},{width:s,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:i,pitch:n,bearing:a}))}getZoom(){return this.viewport.zoom}getZoomScale(){return Math.pow(2,this.getZoom())}getCenter(){return[this.viewport.longitude,this.viewport.latitude]}getProjectionMatrix(){return this.viewport.projectionMatrix}getModelMatrix(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}getViewMatrix(){return this.viewport.viewMatrix}getViewMatrixUncentered(){return this.viewport.viewMatrixUncentered}getViewProjectionMatrix(){return this.viewport.viewProjectionMatrix}getViewProjectionMatrixUncentered(){return this.viewport.viewProjectionMatrix}getFocalDistance(){return 1}projectFlat(t,e){return this.viewport.projectFlat(t,e)}}let aB=function(r){return r.GAODE="GAODE",r.MAPBOX="MAPBOX",r.DEFAULT="DEFAUlTMAP",r.SIMPLE="SIMPLE",r.GLOBEL="GLOBEL",r}({});function Mw(r={}){const t={top:0,right:0,bottom:0,left:0};if(typeof r=="number")return{top:r,right:r,bottom:r,left:r};if(Array.isArray(r)){if(r.length===4)return{top:r[0],right:r[1],bottom:r[2],left:r[3]};if(r.length===2)return{top:r[0],right:r[1],bottom:r[0],left:r[1]}}return V(V({},t),r)}const SQ={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},AQ=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];function TQ(r,t){var e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(e||i)&&(t||(t=document),!!t)){var n=t.head||t.getElementsByTagName("head")[0];if(!n){n=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(n,a):t.documentElement.appendChild(n)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(t.createTextNode(r)),n.appendChild(o),o}}TQ(`.amap-logo {
  display: none !important;
}
.amap-copyright {
  display: none !important;
}
.amap-overlays {
  z-index: 3 !important;
}
`);const bQ="2.0",Iw="f59bcf249433f8b05caaee19f349b3d7",rl=1,Lw={contextmenu:"rightclick",camerachange:"viewchange"};class wQ extends EQ{constructor(...t){super(...t),E(this,"viewport",new xE),E(this,"version",aB.GAODE),E(this,"handleCameraChanged",()=>{const e=this.getViewState();this.updateView(e)})}getType(){return"amap"}init(){var t=this;return X(function*(){const e=t.config,{id:i,style:n="light",minZoom:a=0,maxZoom:o=24,token:s=Iw,mapInstance:l,plugin:u=[]}=e,c=$n(e,AQ);if(window.AMap||l||(u.push("Map3D"),yield lH.load({key:s,version:bQ,plugins:u})),l)t.map=l,t.mapContainer=t.map.getContainer(),t.map.on("viewchange",t.handleCameraChanged);else{const h=V({mapStyle:t.getMapStyleValue(n),zooms:[a,o],viewMode:"3D"},c);if(h.zoom&&(h.zoom+=rl),s===Iw&&(window._AMapSecurityConfig={securityJsCode:"2653011adeb04230b3a26cc9a780a800"},console.warn(`%c${t.configService.getSceneWarninfo("MapToken")}!`,"color: #873bf4;font-weigh:900;font-size: 16px;")),!i)throw Error("No container id specified");window.forceWebGL=!0,t.mapContainer=t.creatMapContainer(i);const f=new AMap.Map(t.mapContainer,h);t.map=f,f.on("viewchange",t.handleCameraChanged)}t.syncInitViewPort()})()}syncInitViewPort(){const t=this.getViewState();this.updateView(t)}getViewState(){const{center:t,zoom:e}=RQ(this.map);return{center:t,viewportWidth:this.map.getContainer().clientWidth,viewportHeight:this.map.getContainer().clientHeight,bearing:-this.map.getRotation(),pitch:this.map.getPitch(),zoom:e-rl}}creatMapContainer(t){const e=super.creatMapContainer(t),i=document.createElement("div");return i.style.cssText+=`
       position: absolute;
       top: 0;
       height: 100%;
       width: 100%;
     `,i.id=tr.uniqueId("l7_amap_div"),e.appendChild(i),i}getContainer(){return this.map.getContainer()}addMarkerContainer(){if(!this.map)return;const t=this.map.getContainer();if(t!==null){const e=t.getElementsByClassName("amap-maps")[0];e.style.zIndex="auto",this.markerContainer=Me("div","l7-marker-container2",e)}}getMarkerContainer(){return this.markerContainer}getCanvasOverlays(){var t;return(t=this.mapContainer)===null||t===void 0?void 0:t.querySelector(".amap-overlays")}on(t,e){y1.indexOf(t)!==-1?this.eventEmitter.on(t,e):this.map.on(Lw[t]||t,e)}off(t,e){y1.indexOf(t)!==-1?this.eventEmitter.off(t,e):this.map.off(Lw[t]||t,e)}getSize(){const t=this.map.getSize();return[t.getWidth(),t.getHeight()]}getMinZoom(){return this.map.getZooms()[0]-rl}getMaxZoom(){return this.map.getZooms()[1]-rl}getZoom(){return this.map.getZoom()-rl}getCenter(t){if(t!=null&&t.padding){const i=this.getCenter(),n=Mw(t.padding),a=this.lngLatToPixel([i.lng,i.lat]),o=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([a.x-o[0],a.y-o[1]])}const e=this.map.getCenter();return{lng:e.getLng(),lat:e.getLat()}}getPitch(){return this.map.getPitch()}getRotation(){return 360-this.map.getRotation()}getBounds(){const t=this.map.getBounds(),e=t.getNorthEast(),i=t.getSouthWest(),n=this.getCenter(),a=n.lng>e.getLng()||n.lng<i.getLng()?180-e.getLng():e.getLng();return[[n.lng<i.getLng()?i.getLng()-180:i.getLng(),i.getLat()],[a,e.getLat()]]}getMapContainer(){return this.mapContainer}getMapCanvasContainer(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}getMapStyleConfig(){return SQ}getMapStyleValue(t){return this.getMapStyleConfig()[t]||t}getMapStyle(){return this.map.getMapStyle()}setMapStyle(t){this.map.setMapStyle(this.getMapStyleValue(t))}setRotation(t){return this.map.setRotation(t)}zoomIn(){this.map.zoomIn()}zoomOut(){this.map.zoomOut()}panTo(t){this.map.panTo(t)}panBy(t=0,e=0){this.map.panBy(t,e)}fitBounds(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]),!0)}setZoomAndCenter(t,e){this.map.setZoomAndCenter(t+rl,e)}setCenter(t,e){if(e!=null&&e.padding){const i=Mw(e.padding),n=this.lngLatToPixel(t),a=[(i.right-i.left)/2,(i.bottom-i.top)/2],o=this.pixelToLngLat([n.x+a[0],n.y+a[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(t)}setPitch(t){return this.map.setPitch(t)}setZoom(t){return this.map.setZoom(t+rl)}setMaxZoom(t){throw new Error("Method not implemented.")}setMinZoom(t){throw new Error("Method not implemented.")}setMapStatus(t){this.map.setStatus(t)}meterToCoord(t,e){const i=AMap.GeometryUtil.distance(new AMap.LngLat(...t),new AMap.LngLat(...e)),[n,a]=ky(...t),[o,s]=ky(...e);return Math.sqrt(Math.pow(n-o,2)+Math.pow(a-s,2))/i}pixelToLngLat(t){const e=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:e.getLng(),lat:e.getLat()}}lngLatToPixel(t){const e=this.map.lnglatToPixel(t);return{x:e.getX(),y:e.getY()}}containerToLngLat(t){const e=new AMap.Pixel(t[0],t[1]),i=this.map.containerToLngLat(e);return{lng:i==null?void 0:i.getLng(),lat:i==null?void 0:i.getLat()}}lngLatToContainer(t){const e=this.map.lngLatToContainer(t);return{x:e.getX(),y:e.getY()}}lngLatToMercator([t,e],i){const[n,a]=ky(t,e);return{x:n,y:a,z:i}}getModelMatrix(t,e,i,n=[1,1,1]){const a=this.viewport.projectFlat(t),o=jc();return yo(o,o,gi(a[0],a[1],e)),_o(o,o,gi(n[0],n[1],n[2])),Dd(o,o,i[0]),B0(o,o,i[1]),D0(o,o,i[2]),o}exportMap(t){var e;const i=(e=this.getContainer())===null||e===void 0?void 0:e.getElementsByClassName("amap-layer")[0];return t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png")}destroy(){var t;super.destroy(),(t=this.mapContainer)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.mapContainer),delete window.initAMap;const e=document.getElementById("amap-script");e&&document.head.removeChild(e),this.map.destroy()}}function RQ(r){const t=r._view.getOptions(),e=t.center,i=t.zoom;return{center:e,zoom:i}}class CE extends _E{getServiceConstructor(){return wQ}}const MQ={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Ow={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},IQ=12;class oB{constructor(t){E(this,"version","DEFAUlTMAP"),E(this,"map",void 0),E(this,"simpleMapCoord",new nB),E(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),E(this,"config",void 0),E(this,"configService",void 0),E(this,"coordinateSystemService",void 0),E(this,"eventEmitter",void 0),E(this,"markerContainer",void 0),E(this,"cameraChangedCallback",void 0),E(this,"$mapContainer",void 0),E(this,"handleCameraChanged",e=>{const{lat:i,lng:n}=this.map.getCenter();this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:this.map.getBearing(),center:[n,i],viewportHeight:this.map.transform.height,pitch:this.map.getPitch(),viewportWidth:this.map.transform.width,zoom:this.map.getZoom(),cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new Ti.EventEmitter}setBgColor(t){this.bgColor=t}addMarkerContainer(){const t=this.map.getCanvasContainer();this.markerContainer=Me("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}getMarkerContainer(){return this.markerContainer}getOverlayContainer(){}getCanvasOverlays(){}on(t,e){y1.indexOf(t)!==-1?this.eventEmitter.on(t,e):this.map.on(Ow[t]||t,e)}off(t,e){this.map.off(Ow[t]||t,e),this.eventEmitter.off(t,e)}getContainer(){return this.map.getContainer()}getMapCanvasContainer(){return this.map.getCanvasContainer()}getSize(){if(this.version==="SIMPLE")return this.simpleMapCoord.getSize();const t=this.map.transform;return[t.width,t.height]}getType(){return"default"}getZoom(){return this.map.getZoom()}setZoom(t){return this.map.setZoom(t)}getCenter(){return this.map.getCenter()}setCenter(t){this.map.setCenter(t)}getPitch(){return this.map.getPitch()}getRotation(){return this.map.getBearing()}getBounds(){return this.map.getBounds().toArray()}getMinZoom(){return this.map.getMinZoom()}getMaxZoom(){return this.map.getMaxZoom()}setRotation(t){this.map.setBearing(t)}zoomIn(t,e){this.map.zoomIn(t,e)}zoomOut(t,e){this.map.zoomOut(t,e)}setPitch(t){return this.map.setPitch(t)}panTo(t){this.map.panTo(t)}panBy(t=0,e=0){this.map.panBy([t,e])}fitBounds(t,e){this.map.fitBounds(t,e)}setMaxZoom(t){this.map.setMaxZoom(t)}setMinZoom(t){this.map.setMinZoom(t)}setMapStatus(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}setZoomAndCenter(t,e){this.map.flyTo({zoom:t,center:e})}setMapStyle(t){var e;(e=this.map)===null||e===void 0||e.setStyle(this.getMapStyleValue(t))}meterToCoord(t,e){return 1}pixelToLngLat(t){return this.map.unproject(t)}lngLatToPixel(t){return this.map.project(t)}containerToLngLat(t){return this.map.unproject(t)}lngLatToContainer(t){return this.map.project(t)}getMapStyle(){try{var t;const e=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(e)?e==null?void 0:e.replace(/\/\w+$/,"").replace(/sprites/,"styles"):e}catch{return""}}getMapStyleConfig(){return MQ}getMapStyleValue(t){var e;return(e=this.getMapStyleConfig()[t])!==null&&e!==void 0?e:t}destroy(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(t,...e){this.eventEmitter.emit(t,...e)}once(t,...e){this.eventEmitter.once(t,...e)}getMapContainer(){return this.$mapContainer}exportMap(t){var e;const i=(e=this.map)===null||e===void 0?void 0:e.getCanvas();return t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png")}onCameraChanged(t){this.cameraChangedCallback=t}creatMapContainer(t){let e=t;return typeof t=="string"&&(e=document.getElementById(t)),e}updateView(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}updateCoordinateSystemService(){const{offsetCoordinate:t=!0}=this.config;this.viewport.getZoom()>IQ&&t?this.coordinateSystemService.setCoordinateSystem(Sc.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Sc.LNGLAT)}}const Bn={number:function(t,e,i){return t+i*(e-t)}};function Na(r,t,e){return Math.min(e,Math.max(t,r))}function Wu(r,t,e){const i=e-t,n=((r-t)%i+i)%i+t;return n===t?e:n}let LQ=1;function OQ(){return LQ++}function er(r,...t){for(const e of t)for(const i in e)r[i]=e[i];return r}function PQ(r,t){const e={};for(let i=0;i<t.length;i++){const n=t[i];n in r&&(e[n]=r[n])}return e}function EE(r,t,e,i){const n=new Vz(r,t,e,i);return a=>n.solve(a)}const O1=EE(.25,.1,.25,1),Pw={};function FQ(r){Pw[r]||(typeof console<"u"&&console.warn(r),Pw[r]=!0)}function Fw(r){return r*Math.PI/180}const sB=63710088e-1;class ve{constructor(t,e){if(E(this,"lng",void 0),E(this,"lat",void 0),isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ve(Wu(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,n=t.lat*e,a=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return sB*Math.acos(Math.min(a,1))}static convert(t){if(t instanceof ve)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ve(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ve(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const lB=2*Math.PI*sB;function uB(r){return lB*Math.cos(r*Math.PI/180)}function Vp(r){return(180+r)/360}function Gp(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function cB(r,t){return r/uB(t)}function BQ(r){return r*360-180}function P1(r){const t=180-r*360;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}function DQ(r,t){return r*uB(P1(t))}function NQ(r){return 1/Math.cos(r*Math.PI/180)}class Ua{constructor(t,e,i=0){E(this,"x",void 0),E(this,"y",void 0),E(this,"z",void 0),this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=ve.convert(t);return new Ua(Vp(i.lng),Gp(i.lat),cB(e,i.lat))}toLngLat(){return new ve(BQ(this.x),P1(this.y))}toAltitude(){return DQ(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/lB*NQ(P1(this.y))}}class sa{constructor(t,e){E(this,"_ne",void 0),E(this,"_sw",void 0),t&&(e?this.setSouthWest(t).setNorthEast(e):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof ve?new ve(t.lng,t.lat):ve.convert(t),this}setSouthWest(t){return this._sw=t instanceof ve?new ve(t.lng,t.lat):ve.convert(t),this}extend(t){const e=this._sw,i=this._ne;let n,a;if(t instanceof ve)n=t,a=t;else if(t instanceof sa){if(n=t._sw,a=t._ne,!n||!a)return this}else{if(Array.isArray(t))if(t.length===4||t.every(Array.isArray)){const o=t;return this.extend(sa.convert(o))}else{const o=t;return this.extend(ve.convert(o))}else if(t&&("lng"in t||"lon"in t)&&"lat"in t)return this.extend(ve.convert(t));return this}return!e&&!i?(this._sw=new ve(n.lng,n.lat),this._ne=new ve(a.lng,a.lat)):(e.lng=Math.min(n.lng,e.lng),e.lat=Math.min(n.lat,e.lat),i.lng=Math.max(a.lng,i.lng),i.lat=Math.max(a.lat,i.lat)),this}getCenter(){return new ve((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ve(this.getWest(),this.getNorth())}getSouthEast(){return new ve(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:i}=ve.convert(t),n=this._sw.lat<=i&&i<=this._ne.lat;let a=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=e&&e>=this._ne.lng),n&&a}static convert(t){return t instanceof sa?t:new sa(t)}static fromLngLat(t,e=0){const n=360*e/40075017,a=n/Math.cos(Math.PI/180*t.lat);return new sa(new ve(t.lng-a,t.lat-n),new ve(t.lng+a,t.lat+n))}}const kQ="AbortError";function UQ(){return new Error(kQ)}const zQ=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date);let Gy;const Nn={now:zQ,frameAsync(r){return new Promise((t,e)=>{const i=requestAnimationFrame(t);r.signal.addEventListener("abort",()=>{cancelAnimationFrame(i),e(UQ())})})},get prefersReducedMotion(){return window.matchMedia?(Gy==null&&(Gy=window.matchMedia("(prefers-reduced-motion: reduce)")),Gy.matches):!1}};function Bw(r,t,e){e[r]&&e[r].indexOf(t)!==-1||(e[r]=e[r]||[],e[r].push(t))}function Xy(r,t,e){if(e&&e[r]){const i=e[r].indexOf(t);i!==-1&&e[r].splice(i,1)}}let ee=class{constructor(t,e={}){E(this,"type",void 0),er(this,e),this.type=t}};class HQ extends ee{constructor(t,e={}){super("error",e),E(this,"error",void 0),this.error=t}}class $Q{constructor(){E(this,"_listeners",void 0),E(this,"_oneTimeListeners",void 0),E(this,"_eventedParent",void 0),E(this,"_eventedParentData",void 0)}on(t,e){return this._listeners=this._listeners||{},Bw(t,e,this._listeners),this}off(t,e){return Xy(t,e,this._listeners),Xy(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Bw(t,e,this._oneTimeListeners),this):new Promise(i=>this.once(t,i))}fire(t,e){typeof t=="string"&&(t=new ee(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const n=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const s of n)s.call(this,t);const a=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const s of a)Xy(i,s,this._oneTimeListeners),s.call(this,t);const o=this._eventedParent;o&&(er(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),o.fire(t))}else t instanceof HQ&&console.error(t.error);return this}emit(t,e){return this.fire(t,e)}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return t&&(this._eventedParent=t),this._eventedParentData=e,this}}class WQ extends $Q{constructor(t,e){super(),E(this,"transform",void 0),E(this,"handlers",void 0),E(this,"_moving",void 0),E(this,"_zooming",void 0),E(this,"_rotating",void 0),E(this,"_pitching",void 0),E(this,"_padding",void 0),E(this,"_bearingSnap",void 0),E(this,"_easeStart",void 0),E(this,"_easeOptions",void 0),E(this,"_easeId",void 0),E(this,"_onEaseFrame",void 0),E(this,"_onEaseEnd",void 0),E(this,"_easeFrameId",void 0),E(this,"_requestedCameraState",void 0),E(this,"transformCameraUpdate",void 0),E(this,"_renderFrameCallback",()=>{const i=Math.min((Nn.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=e.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new ve(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(t,e,i){return t=ue.convert(t).mult(-1),this.panTo(this.transform.center,er({offset:t},e),i)}panTo(t,e,i){return this.easeTo(er({center:t},e),i)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(t,e,i){return this.easeTo(er({zoom:t},e),i)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(t,e,i){return this.easeTo(er({bearing:t},e),i)}resetNorth(t,e){return this.rotateTo(0,er({duration:1e3},t),e),this}resetNorthPitch(t,e){return this.easeTo(er({bearing:0,pitch:0,duration:1e3},t),e),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(t,e){t=sa.convert(t);const i=e&&e.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),i,e)}_cameraForBoxAndBearing(t,e,i,n){const a={top:0,bottom:0,right:0,left:0};if(n=er({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n),typeof n.padding=="number"){const N=n.padding;n.padding={top:N,bottom:N,right:N,left:N}}n.padding=er(a,n.padding);const o=this.transform,s=o.padding,l=new sa(t,e),u=o.project(l.getNorthWest()),c=o.project(l.getNorthEast()),h=o.project(l.getSouthEast()),f=o.project(l.getSouthWest()),d=Fw(-i),v=u.rotate(d),p=c.rotate(d),g=h.rotate(d),m=f.rotate(d),y=new ue(Math.max(v.x,p.x,m.x,g.x),Math.max(v.y,p.y,m.y,g.y)),_=new ue(Math.min(v.x,p.x,m.x,g.x),Math.min(v.y,p.y,m.y,g.y)),x=y.sub(_),C=(o.width-(s.left+s.right+n.padding.left+n.padding.right))/x.x,A=(o.height-(s.top+s.bottom+n.padding.top+n.padding.bottom))/x.y;if(A<0||C<0){FQ("Map cannot fit within canvas with the given bounds, padding, and/or offset.");return}const T=Math.min(o.scaleZoom(o.scale*Math.min(C,A)),n.maxZoom),w=ue.convert(n.offset),M=(n.padding.left-n.padding.right)/2,O=(n.padding.top-n.padding.bottom)/2,D=new ue(M,O).rotate(Fw(i)),Y=w.add(D).mult(o.scale/o.zoomScale(T));return{center:o.unproject(u.add(h).div(2).sub(Y)),zoom:T,bearing:i}}fitBounds(t,e,i){return this._fitInternal(this.cameraForBounds(t,e),e,i)}fitScreenCoordinates(t,e,i,n,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(ue.convert(t)),this.transform.pointLocation(ue.convert(e)),i,n),n,a)}_fitInternal(t,e,i){return t?(e=er(t,e),delete e.padding,e.linear?this.easeTo(e,i):this.flyTo(e,i)):this}jumpTo(t,e){this.stop();const i=this._getTransformForUpdate();let n=!1,a=!1,o=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(n=!0,i.zoom=+t.zoom),t.center!==void 0&&(i.center=ve.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(a=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(o=!0,i.pitch=+t.pitch),t.padding!=null&&!i.isPaddingEqual(t.padding)&&(i.padding=t.padding),this._applyUpdatedTransform(i),this.fire(new ee("movestart",e)).fire(new ee("move",e)),n&&this.fire(new ee("zoomstart",e)).fire(new ee("zoom",e)).fire(new ee("zoomend",e)),a&&this.fire(new ee("rotatestart",e)).fire(new ee("rotate",e)).fire(new ee("rotateend",e)),o&&this.fire(new ee("pitchstart",e)).fire(new ee("pitch",e)).fire(new ee("pitchend",e)),this.fire(new ee("moveend",e))}calculateCameraOptionsFromTo(t,e,i,n=0){const a=Ua.fromLngLat(t,e),o=Ua.fromLngLat(i,n),s=o.x-a.x,l=o.y-a.y,u=o.z-a.z,c=Math.hypot(s,l,u);if(c===0)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(s,l),f=this.transform.scaleZoom(this.transform.cameraToCenterDistance/c/this.transform.tileSize),d=Math.atan2(s,-l)*180/Math.PI;let v=Math.acos(h/c)*180/Math.PI;return v=u<0?90-v:90+v,{center:o.toLngLat(),zoom:f,pitch:v,bearing:d}}easeTo(t,e){var i;this._stop(!1,t.easeId),t=er({offset:[0,0],duration:500,easing:O1},t),(t.animate===!1||!t.essential&&Nn.prefersReducedMotion)&&(t.duration=0);const n=this._getTransformForUpdate(),a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),l=this.getPadding(),u="bearing"in t?this._normalizeBearing(t.bearing,o):o,c="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:n.padding,f=ue.convert(t.offset);let d=n.centerPoint.add(f);const v=n.pointLocation(d),{center:p,zoom:g}=n.getConstrained(ve.convert(t.center||v),(i=t.zoom)!==null&&i!==void 0?i:a);this._normalizeCenter(p);const m=n.project(v),y=n.project(p).sub(m),_=n.zoomScale(g-a);let x,C;t.around&&(x=ve.convert(t.around),C=n.locationPoint(x));const A={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||g!==a,this._rotating=this._rotating||o!==u,this._pitching=this._pitching||c!==s,this._padding=!n.isPaddingEqual(h),this._easeId=t.easeId,this._prepareEase(e,t.noMoveStart,A),this._ease(T=>{if(this._zooming&&(n.zoom=Bn.number(a,g,T)),this._rotating&&(n.bearing=Bn.number(o,u,T)),this._pitching&&(n.pitch=Bn.number(s,c,T)),this._padding&&(n.interpolatePadding(l,h,T),d=n.centerPoint.add(f)),x)n.setLocationAtPoint(x,C);else{const w=n.zoomScale(n.zoom-a),M=g>a?Math.min(2,_):Math.max(.5,_),O=Math.pow(M,1-T),P=n.unproject(m.add(y.mult(T*O)).mult(w));n.setLocationAtPoint(n.renderWorldCopies?P.wrap():P,d)}this._applyUpdatedTransform(n),this._fireMoveEvents(e)},T=>{this._afterEase(e,T)},t),this}_prepareEase(t,e,i={}){this._moving=!0,!e&&!i.moving&&this.fire(new ee("movestart",t)),this._zooming&&!i.zooming&&this.fire(new ee("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new ee("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new ee("pitchstart",t))}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const e=t.clone(),{center:i,zoom:n,pitch:a,bearing:o,elevation:s}=this.transformCameraUpdate(e);i&&(e.center=i),n!==void 0&&(e.zoom=n),a!==void 0&&(e.pitch=a),o!==void 0&&(e.bearing=o),s!==void 0&&(e.elevation=s),this.transform.apply(e)}_fireMoveEvents(t){this.fire(new ee("move",t)),this._zooming&&this.fire(new ee("zoom",t)),this._rotating&&this.fire(new ee("rotate",t)),this._pitching&&this.fire(new ee("pitch",t))}_afterEase(t,e){if(this._easeId&&e&&this._easeId===e)return;delete this._easeId;const i=this._zooming,n=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new ee("zoomend",t)),n&&this.fire(new ee("rotateend",t)),a&&this.fire(new ee("pitchend",t)),this.fire(new ee("moveend",t))}flyTo(t,e){var i;if(!t.essential&&Nn.prefersReducedMotion){const W=PQ(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(W,e)}this.stop(),t=er({offset:[0,0],speed:1.2,curve:1.42,easing:O1},t);const n=this._getTransformForUpdate(),a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),l=this.getPadding(),u="bearing"in t?this._normalizeBearing(t.bearing,o):o,c="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:n.padding,f=ue.convert(t.offset);let d=n.centerPoint.add(f);const v=n.pointLocation(d),{center:p,zoom:g}=n.getConstrained(ve.convert(t.center||v),(i=t.zoom)!==null&&i!==void 0?i:a);this._normalizeCenter(p);const m=n.zoomScale(g-a),y=n.project(v),_=n.project(p).sub(y);let x=t.curve;const C=Math.max(n.width,n.height),A=C/m,T=_.mag();if("minZoom"in t){const W=Na(Math.min(t.minZoom,a,g),n.minZoom,n.maxZoom),Q=C/n.zoomScale(W-a);x=Math.sqrt(Q/T*2)}const w=x*x;function M(W){const Q=(A*A-C*C+(W?-1:1)*w*w*T*T)/(2*(W?A:C)*w*T);return Math.log(Math.sqrt(Q*Q+1)-Q)}function O(W){return(Math.exp(W)-Math.exp(-W))/2}function P(W){return(Math.exp(W)+Math.exp(-W))/2}function D(W){return O(W)/P(W)}const z=M(!1);let Y=function(W){return P(z)/P(z+x*W)},H=function(W){return C*((P(z)*D(z+x*W)-O(z))/w)/T},N=(M(!0)-z)/x;if(Math.abs(T)<1e-6||!isFinite(N)){if(Math.abs(C-A)<1e-6)return this.easeTo(t,e);const W=A<C?-1:1;N=Math.abs(Math.log(A/C))/x,H=()=>0,Y=Q=>Math.exp(W*x*Q)}if("duration"in t)t.duration=+t.duration;else{const W="screenSpeed"in t?+t.screenSpeed/x:+t.speed;t.duration=1e3*N/W}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=o!==u,this._pitching=c!==s,this._padding=!n.isPaddingEqual(h),this._prepareEase(e,!1),this._ease(W=>{const Q=W*N,q=1/Y(Q);n.zoom=W===1?g:a+n.scaleZoom(q),this._rotating&&(n.bearing=Bn.number(o,u,W)),this._pitching&&(n.pitch=Bn.number(s,c,W)),this._padding&&(n.interpolatePadding(l,h,W),d=n.centerPoint.add(f));const J=W===1?p:n.unproject(y.add(_.mult(H(Q))).mult(q));n.setLocationAtPoint(n.renderWorldCopies?J.wrap():J,d),this._applyUpdatedTransform(n),this._fireMoveEvents(e)},()=>{this._afterEase(e)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const n=this._onEaseEnd;delete this._onEaseEnd,n.call(this,e)}if(!t){var i;(i=this.handlers)===null||i===void 0||i.stop(!1)}return this}_ease(t,e,i){i.animate===!1||i.duration===0?(t(1),e()):(this._easeStart=Nn.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,e){t=Wu(t,-180,180);const i=Math.abs(t-e);return Math.abs(t-360-e)<i&&(t-=360),Math.abs(t+360-e)<i&&(t+=360),t}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.lngRange)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}}class SE{constructor(t=0,e=0,i=0,n=0){if(E(this,"top",void 0),E(this,"bottom",void 0),E(this,"left",void 0),E(this,"right",void 0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=n}interpolate(t,e,i){return e.top!=null&&t.top!=null&&(this.top=Bn.number(t.top,e.top,i)),e.bottom!=null&&t.bottom!=null&&(this.bottom=Bn.number(t.bottom,e.bottom,i)),e.left!=null&&t.left!=null&&(this.left=Bn.number(t.left,e.left,i)),e.right!=null&&t.right!=null&&(this.right=Bn.number(t.right,e.right,i)),this}getCenter(t,e){const i=Na((this.left+t-this.right)/2,0,t),n=Na((this.top+e-this.bottom)/2,0,e);return new ue(i,n)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new SE(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Iv=85.051129;class AE{constructor(t,e,i,n,a){E(this,"tileSize",void 0),E(this,"tileZoom",void 0),E(this,"lngRange",void 0),E(this,"latRange",void 0),E(this,"scale",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"angle",void 0),E(this,"rotationMatrix",void 0),E(this,"pixelsToGLUnits",void 0),E(this,"cameraToCenterDistance",void 0),E(this,"mercatorMatrix",void 0),E(this,"projMatrix",void 0),E(this,"invProjMatrix",void 0),E(this,"alignedProjMatrix",void 0),E(this,"pixelMatrix",void 0),E(this,"pixelMatrix3D",void 0),E(this,"pixelMatrixInverse",void 0),E(this,"glCoordMatrix",void 0),E(this,"labelPlaneMatrix",void 0),E(this,"minElevationForCurrentTile",void 0),E(this,"_fov",void 0),E(this,"_pitch",void 0),E(this,"_zoom",void 0),E(this,"_unmodified",void 0),E(this,"_renderWorldCopies",void 0),E(this,"_minZoom",void 0),E(this,"_maxZoom",void 0),E(this,"_minPitch",void 0),E(this,"_maxPitch",void 0),E(this,"_center",void 0),E(this,"_elevation",void 0),E(this,"_pixelPerMeter",void 0),E(this,"_edgeInsets",void 0),E(this,"_constraining",void 0),E(this,"_posMatrixCache",void 0),E(this,"_alignedPosMatrixCache",void 0),this.tileSize=512,this._renderWorldCopies=a===void 0?!0:!!a,this._minZoom=t||0,this._maxZoom=e||22,this._minPitch=i??0,this._maxPitch=n??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new ve(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new SE,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new AE(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new ue(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const e=-Wu(t,-180,180)*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=Qz(),Jz(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const e=Na(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.tileZoom=Math.max(0,Math.floor(e)),this.scale=this.zoomScale(e),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const e=Na(t.lat,-Iv,Iv);return new ue(Vp(t.lng)*this.worldSize,Gp(e)*this.worldSize)}unproject(t){return new Ua(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){const t=this.pointLocation(this.getCameraPoint()),e=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter;return{lngLat:t,altitude:e+this.elevation}}setLocationAtPoint(t,e){const i=this.pointCoordinate(e),n=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(t),o=new Ua(a.x-(i.x-n.x),a.y-(i.y-n.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}locationCoordinate(t){return Ua.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t){const i=[t.x,t.y,0,1],n=[t.x,t.y,1,1];vl(i,i,this.pixelMatrixInverse),vl(n,n,this.pixelMatrixInverse);const a=i[3],o=n[3],s=i[0]/a,l=n[0]/o,u=i[1]/a,c=n[1]/o,h=i[2]/a,f=n[2]/o,d=h===f?0:(0-h)/(f-h);return new Ua(Bn.number(s,l,d)/this.worldSize,Bn.number(u,c,d)/this.worldSize)}coordinatePoint(t,e=0,i=this.pixelMatrix){const n=[t.x*this.worldSize,t.y*this.worldSize,e,1];return vl(n,n,i),new ue(n[0]/n[3],n[1]/n[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new sa().extend(this.pointLocation(new ue(0,t))).extend(this.pointLocation(new ue(this.width,t))).extend(this.pointLocation(new ue(this.width,this.height))).extend(this.pointLocation(new ue(0,this.height)))}getMaxBounds(){return!this.latRange||this.latRange.length!==2||!this.lngRange||this.lngRange.length!==2?null:new sa([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]])}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-Iv,Iv])}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,e){e=Na(+e,this.minZoom,this.maxZoom);const i={center:new ve(t.lng,t.lat),zoom:e};let n=this.lngRange;if(!this._renderWorldCopies&&n===null){const C=179.9999999999;n=[-C,C]}const a=this.tileSize*this.zoomScale(i.zoom);let o=0,s=a,l=0,u=a,c=0,h=0;const{x:f,y:d}=this.size;if(this.latRange){const C=this.latRange;o=Gp(C[1])*a,s=Gp(C[0])*a,s-o<d&&(c=d/(s-o))}n&&(l=Wu(Vp(n[0])*a,0,a),u=Wu(Vp(n[1])*a,0,a),u<l&&(u+=a),u-l<f&&(h=f/(u-l)));const{x:v,y:p}=this.project.call({worldSize:a},t);let g,m;const y=Math.max(h||0,c||0);if(y){const C=new ue(h?(u+l)/2:v,c?(s+o)/2:p);return i.center=this.unproject.call({worldSize:a},C).wrap(),i.zoom+=this.scaleZoom(y),i}if(this.latRange){const C=d/2;p-C<o&&(m=o+C),p+C>s&&(m=s-C)}if(n){const C=(l+u)/2;let A=v;this._renderWorldCopies&&(A=Wu(v,C-a/2,C+a/2));const T=f/2;A-T<l&&(g=l+T),A+T>u&&(g=u-T)}if(g!==void 0||m!==void 0){var _,x;const C=new ue((_=g)!==null&&_!==void 0?_:v,(x=m)!==null&&x!==void 0?x:p);i.center=this.unproject.call({worldSize:a},C).wrap()}return i}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:e,zoom:i}=this.getConstrained(this.center,this.zoom);this.center=e,this.zoom=i,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this._fov/2,e=this.centerOffset,i=this.point.x,n=this.point.y;this.cameraToCenterDistance=.5/Math.tan(t)*this.height,this._pixelPerMeter=cB(1,this.center.lat)*this.worldSize;let a=gb(new Float64Array(16));_o(a,a,[this.width/2,-this.height/2,1]),yo(a,a,[1,-1,0]),this.labelPlaneMatrix=a,a=gb(new Float64Array(16)),_o(a,a,[1,-1,1]),yo(a,a,[-1,-1,0]),_o(a,a,[2/this.width,2/this.height,1]),this.glCoordMatrix=a;const o=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),s=Math.min(this.elevation,this.minElevationForCurrentTile),l=o-s*this._pixelPerMeter/Math.cos(this._pitch),u=s<0?l:o,c=Math.PI/2+this._pitch,h=this._fov*(.5+e.y/this.height),f=Math.sin(h)*u/Math.sin(Na(Math.PI-c-h,.01,Math.PI-.01)),d=this.getHorizon(),p=2*Math.atan(d/this.cameraToCenterDistance)*(.5+e.y/(d*2)),g=Math.sin(p)*u/Math.sin(Na(Math.PI-c-p,.01,Math.PI-.01)),m=Math.min(f,g),y=(Math.cos(Math.PI/2-this._pitch)*m+u)*1.01,_=this.height/50;a=new Float64Array(16),tH(a,this._fov,this.width/this.height,_,y),a[8]=-e.x*2/this.width,a[9]=e.y*2/this.height,_o(a,a,[1,-1,1]),yo(a,a,[0,0,-this.cameraToCenterDistance]),Dd(a,a,this._pitch),D0(a,a,this.angle),yo(a,a,[-i,-n,0]),this.mercatorMatrix=_o([],a,[this.worldSize,this.worldSize,this.worldSize]),_o(a,a,[1,1,this._pixelPerMeter]),this.pixelMatrix=df(new Float64Array(16),this.labelPlaneMatrix,a),yo(a,a,[0,0,-this.elevation]),this.projMatrix=a,this.invProjMatrix=mg([],a),this.pixelMatrix3D=df(new Float64Array(16),this.labelPlaneMatrix,a);const x=this.width%2/2,C=this.height%2/2,A=Math.cos(this.angle),T=Math.sin(this.angle),w=i-Math.round(i)+A*x+T*C,M=n-Math.round(n)+A*C+T*x,O=new Float64Array(a);if(yo(O,O,[w>.5?w-1:w,M>.5?M-1:M,0]),this.alignedProjMatrix=O,a=mg(new Float64Array(16),this.pixelMatrix),!a)throw new Error("failed to invert matrix");this.pixelMatrixInverse=a,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new ue(0,0)),e=[t.x*this.worldSize,t.y*this.worldSize,0,1];return vl(e,e,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=this._pitch,e=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new ue(0,e))}getCameraQueryGeometry(t){const e=this.getCameraPoint();if(t.length===1)return[t[0],e];{let i=e.x,n=e.y,a=e.x,o=e.y;for(const s of t)i=Math.min(i,s.x),n=Math.min(n,s.y),a=Math.max(a,s.x),o=Math.max(o,s.y);return[new ue(i,n),new ue(a,n),new ue(a,o),new ue(i,o),new ue(i,n)]}}lngLatToCameraDepth(t,e){const i=this.locationCoordinate(t),n=[i.x*this.worldSize,i.y*this.worldSize,e,1];return vl(n,n,this.projMatrix),n[2]/n[3]}}var TE;class Lt{static testProp(t){if(!Lt.docStyle)return t[0];for(let e=0;e<t.length;e++)if(t[e]in Lt.docStyle)return t[e];return t[0]}static create(t,e,i){const n=window.document.createElement(t);return e!==void 0&&(n.className=e),i&&i.appendChild(n),n}static createNS(t,e){return window.document.createElementNS(t,e)}static disableDrag(){Lt.docStyle&&Lt.selectProp&&(Lt.userSelect=Lt.docStyle[Lt.selectProp],Lt.docStyle[Lt.selectProp]="none")}static enableDrag(){Lt.docStyle&&Lt.selectProp&&(Lt.docStyle[Lt.selectProp]=Lt.userSelect)}static setTransform(t,e){t.style[Lt.transformProp]=e}static addEventListener(t,e,i,n={}){"passive"in n?t.addEventListener(e,i,n):t.addEventListener(e,i,n.capture)}static removeEventListener(t,e,i,n={}){"passive"in n?t.removeEventListener(e,i,n):t.removeEventListener(e,i,n.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Lt.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Lt.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Lt.suppressClickInternal,!0)},0)}static getScale(t){const e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}static getPoint(t,e,i){const n=e.boundingClientRect;return new ue((i.clientX-n.left)/e.x-t.clientLeft,(i.clientY-n.top)/e.y-t.clientTop)}static mousePos(t,e){const i=Lt.getScale(t);return Lt.getPoint(t,i,e)}static touchPos(t,e){const i=[],n=Lt.getScale(t);for(let a=0;a<e.length;a++)i.push(Lt.getPoint(t,n,e[a]));return i}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}TE=Lt;E(Lt,"docStyle",typeof window<"u"&&window.document&&window.document.documentElement.style);E(Lt,"userSelect",void 0);E(Lt,"selectProp",TE.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]));E(Lt,"transformProp",TE.testProp(["transform","WebkitTransform"]));class $d{constructor(t){E(this,"_map",void 0),this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(ue.convert(t))}}class VQ{constructor(t,e){E(this,"_map",void 0),E(this,"_tr",void 0),E(this,"_el",void 0),E(this,"_container",void 0),E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_startPos",void 0),E(this,"_lastPos",void 0),E(this,"_box",void 0),E(this,"_clickTolerance",void 0),this._map=t,this._tr=new $d(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&t.button===0&&(Lt.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const n=this._startPos;this._lastPos=i,this._box||(this._box=Lt.create("div","l7-boxzoom",this._container),this._container.classList.add("l7-crosshair"),this._fireEvent("boxzoomstart",t));const a=Math.min(n.x,i.x),o=Math.max(n.x,i.x),s=Math.min(n.y,i.y),l=Math.max(n.y,i.y);Lt.setTransform(this._box,`translate(${a}px,${s}px)`),this._box.style.width=`${o-a}px`,this._box.style.height=`${l-s}px`}mouseupWindow(t,e){if(!this._active||t.button!==0)return;const i=this._startPos,n=e;if(this.reset(),Lt.suppressClick(),i.x===n.x&&i.y===n.y)this._fireEvent("boxzoomcancel",t);else return this._map.fire(new ee("boxzoomend",{originalEvent:t})),{cameraAnimation:a=>a.fitScreenCoordinates(i,n,this._tr.bearing,{linear:!0})}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("l7-crosshair"),this._box&&(Lt.remove(this._box),this._box=null),Lt.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,e){return this._map.fire(new ee(t,{originalEvent:e}))}}class GQ{constructor(t){E(this,"_tr",void 0),E(this,"_enabled",void 0),E(this,"_active",void 0),this._tr=new $d(t),this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class XQ{constructor(t,e){E(this,"_options",void 0),E(this,"_map",void 0),E(this,"_container",void 0),E(this,"_bypassKey",navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey"),E(this,"_enabled",void 0),this._map=t,this._options=e,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("l7-cooperative-gestures"),this._container=Lt.create("div","l7-cooperative-gesture-screen",t);const e=document.createElement("div");e.className="l7-desktop-message",e.textContent="Missing UI string",this._container.appendChild(e);const i=document.createElement("div");i.className="l7-mobile-message",i.textContent="Missing UI string",this._container.appendChild(i),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(Lt.remove(this._container),this._map.getCanvasContainer().classList.remove("l7-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){!this._enabled||!t||(this._container.classList.add("l7-show"),setTimeout(()=>{this._container.classList.remove("l7-show")},100))}}const YQ={panStep:100,bearingStep:15,pitchStep:10};class jQ{constructor(t){E(this,"_tr",void 0),E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_panStep",void 0),E(this,"_bearingStep",void 0),E(this,"_pitchStep",void 0),E(this,"_rotationDisabled",void 0),this._tr=new $d(t);const e=YQ;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,n=0,a=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),a=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),a=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:s=>{const l=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:ZQ,zoom:e?Math.round(l.zoom)+e*(t.shiftKey?2:1):l.zoom,bearing:l.bearing+i*this._bearingStep,pitch:l.pitch+n*this._pitchStep,offset:[-a*this._panStep,-o*this._panStep],center:l.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ZQ(r){return r*(2-r)}class xo extends ee{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i,n={}){super(t,n),E(this,"target",void 0),E(this,"originalEvent",void 0),E(this,"point",void 0),E(this,"lngLat",void 0),E(this,"_defaultPrevented",void 0);const a=Lt.mousePos(e.getCanvasContainer(),i),o=e.unproject(a);this.point=a,this.lngLat=o,this.originalEvent=i,this._defaultPrevented=!1,this.target=e}}class Lv extends ee{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t),E(this,"target",void 0),E(this,"originalEvent",void 0),E(this,"lngLat",void 0),E(this,"point",void 0),E(this,"points",void 0),E(this,"lngLats",void 0),E(this,"_defaultPrevented",void 0);const n=t==="touchend"?i.changedTouches:i.touches,a=Lt.touchPos(e.getCanvasContainer(),n),o=a.map(u=>e.unproject(u)),s=a.reduce((u,c,h,f)=>u.add(c.div(f.length)),new ue(0,0)),l=e.unproject(s);this.target=e,this.points=a,this.point=s,this.lngLats=o,this.lngLat=l,this.originalEvent=i,this._defaultPrevented=!1}}class qQ extends ee{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t),E(this,"target",void 0),E(this,"originalEvent",void 0),E(this,"_defaultPrevented",void 0),this.target=e,this._defaultPrevented=!1,this.originalEvent=i}}class KQ{constructor(t,e){E(this,"_mousedownPos",void 0),E(this,"_clickTolerance",void 0),E(this,"_map",void 0),this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new qQ(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new xo(t.type,this._map,t))}mouseup(t){this._map.fire(new xo(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new xo(t.type,this._map,t))}dblclick(t){return this._firePreventable(new xo(t.type,this._map,t))}mouseover(t){this._map.fire(new xo(t.type,this._map,t))}mouseout(t){this._map.fire(new xo(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Lv(t.type,this._map,t))}touchmove(t){this._map.fire(new Lv(t.type,this._map,t))}touchend(t){this._map.fire(new Lv(t.type,this._map,t))}touchcancel(t){this._map.fire(new Lv(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class QQ{constructor(t){E(this,"_map",void 0),E(this,"_delayContextMenu",void 0),E(this,"_ignoreContextMenu",void 0),E(this,"_contextMenuEvent",void 0),this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new xo(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new xo(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bE{constructor(t){E(this,"contextmenu",void 0),E(this,"mousedown",void 0),E(this,"mousemoveWindow",void 0),E(this,"mouseup",void 0),E(this,"touchstart",void 0),E(this,"touchmoveWindow",void 0),E(this,"touchend",void 0),E(this,"_clickTolerance",void 0),E(this,"_moveFunction",void 0),E(this,"_activateOnStart",void 0),E(this,"_active",void 0),E(this,"_enabled",void 0),E(this,"_moved",void 0),E(this,"_lastPoint",void 0),E(this,"_moveStateManager",void 0),this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const e=this._moveFunction(...t);if(e.bearingDelta||e.pitchDelta||e.around||e.panDelta)return this._active=!0,e}dragStart(t,e){!this.isEnabled()||this._lastPoint||this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=e.length?e[0]:e,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,e){if(!this.isEnabled())return;const i=this._lastPoint;if(!i)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t)){this.reset(t);return}const n=e.length?e[0]:e;if(!(!this._moved&&n.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(i,n)}dragEnd(t){!this.isEnabled()||!this._lastPoint||this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Lt.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const JQ=0,tJ=2,eJ={[JQ]:1,[tJ]:2};function rJ(r,t){const e=eJ[t];return r.buttons===void 0||(r.buttons&e)!==e}class wE{constructor(t){E(this,"_eventButton",void 0),E(this,"_correctEvent",void 0),this._correctEvent=t.checkCorrectEvent}startMove(t){const e=Lt.mouseButton(t);this._eventButton=e}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!rJ(t,this._eventButton)}isValidEndEvent(t){return Lt.mouseButton(t)===this._eventButton}}const RE=0,hB=2,ME=r=>{r.mousedown=r.dragStart,r.mousemoveWindow=r.dragMove,r.mouseup=r.dragEnd,r.contextmenu=t=>{t.preventDefault()}},iJ=({enable:r,clickTolerance:t})=>{const e=new wE({checkCorrectEvent:i=>Lt.mouseButton(i)===RE&&!i.ctrlKey});return new bE({clickTolerance:t,move:(i,n)=>({around:n,panDelta:n.sub(i)}),activateOnStart:!0,moveStateManager:e,enable:r,assignEvents:ME})},nJ=({enable:r,clickTolerance:t,bearingDegreesPerPixelMoved:e=.8})=>{const i=new wE({checkCorrectEvent:n=>Lt.mouseButton(n)===RE&&n.ctrlKey||Lt.mouseButton(n)===hB});return new bE({clickTolerance:t,move:(n,a)=>({bearingDelta:(a.x-n.x)*e}),moveStateManager:i,enable:r,assignEvents:ME})},aJ=({enable:r,clickTolerance:t,pitchDegreesPerPixelMoved:e=-.5})=>{const i=new wE({checkCorrectEvent:n=>Lt.mouseButton(n)===RE&&n.ctrlKey||Lt.mouseButton(n)===hB});return new bE({clickTolerance:t,move:(n,a)=>({pitchDelta:(a.y-n.y)*e}),moveStateManager:i,enable:r,assignEvents:ME})},Dw=4.000244140625,oJ=1/100,sJ=1/450,lJ=2;class uJ{constructor(t,e){E(this,"_map",void 0),E(this,"_tr",void 0),E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_zooming",void 0),E(this,"_aroundCenter",void 0),E(this,"_around",void 0),E(this,"_aroundPoint",void 0),E(this,"_type",void 0),E(this,"_lastValue",void 0),E(this,"_timeout",void 0),E(this,"_finishTimeout",void 0),E(this,"_lastWheelEvent",void 0),E(this,"_lastWheelEventTime",void 0),E(this,"_startZoom",void 0),E(this,"_targetZoom",void 0),E(this,"_delta",void 0),E(this,"_easing",void 0),E(this,"_prevEase",void 0),E(this,"_frameId",void 0),E(this,"_triggerRenderFrame",void 0),E(this,"_defaultZoomRate",void 0),E(this,"_wheelZoomRate",void 0),E(this,"_onTimeout",i=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}),this._map=t,this._tr=new $d(t),this._triggerRenderFrame=e,this._delta=0,this._defaultZoomRate=oJ,this._wheelZoomRate=sJ}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let e=t.deltaMode===WheelEvent.DOM_DELTA_LINE?t.deltaY*40:t.deltaY;const i=Nn.now(),n=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,e!==0&&e%Dw===0?this._type="wheel":e!==0&&Math.abs(e)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e=e/4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=Lt.mousePos(this._map.getCanvasContainer(),t),i=this._tr;e.y>i.transform.height/2-i.transform.getHorizon()?this._around=ve.convert(this._aroundCenter?i.center:i.unproject(e)):this._around=ve.convert(i.center),this._aroundPoint=i.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const s=this._type==="wheel"&&Math.abs(this._delta)>Dw?this._wheelZoomRate:this._defaultZoomRate;let l=lJ/(1+Math.exp(-Math.abs(this._delta*s)));this._delta<0&&l!==0&&(l=1/l);const u=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(u*l))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const e=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,i=this._startZoom,n=this._easing;let a=!1,o;if(this._type==="wheel"&&i&&n){const s=Math.min((Nn.now()-this._lastWheelEventTime)/200,1),l=n(s);o=Bn.number(i,e,l),s<1?this._frameId||(this._frameId=!0):a=!0}else o=e,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:o-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let e=O1;if(this._prevEase){const i=this._prevEase,n=(Nn.now()-i.start)/i.duration,a=i.easing(n+.01)-i.easing(n),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.27*.27-o*o);e=EE(o,s,.25,1)}return this._prevEase={start:Nn.now(),duration:t,easing:e},e}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class cJ{constructor(t,e){E(this,"_clickZoom",void 0),E(this,"_tapZoom",void 0),this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hJ{constructor(t,e,i){E(this,"_el",void 0),E(this,"_mousePan",void 0),E(this,"_touchPan",void 0),E(this,"_inertiaOptions",void 0),this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("l7-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("l7-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fJ{constructor(t,e,i){E(this,"_mouseRotate",void 0),E(this,"_mousePitch",void 0),E(this,"_pitchWithRotate",void 0),this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class dJ{constructor(t,e,i,n){E(this,"_el",void 0),E(this,"_touchZoom",void 0),E(this,"_touchRotate",void 0),E(this,"_tapDragZoom",void 0),E(this,"_rotationDisabled",void 0),E(this,"_enabled",void 0),this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("l7-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("l7-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}function F1(r,t){if(r.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${r.length}, points ${t.length}`);const e={};for(let i=0;i<r.length;i++)e[r[i].identifier]=t[i];return e}function vJ(r){const t=new ue(0,0);for(const e of r)t._add(e);return t.div(r.length)}const fB=500,pJ=500,IE=30;class gJ{constructor(t){E(this,"numTouches",void 0),E(this,"centroid",void 0),E(this,"startTime",void 0),E(this,"aborted",void 0),E(this,"touches",void 0),this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,e,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),!this.aborted&&(this.startTime===void 0&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=vJ(e),this.touches=F1(i,e)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const n=F1(i,e);for(const a in this.touches){const o=this.touches[a],s=n[a];(!s||s.dist(o)>IE)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>pJ)&&(this.aborted=!0),i.length===0){const n=!this.aborted&&this.centroid;if(this.reset(),n)return n}}}class B1{constructor(t){E(this,"singleTap",void 0),E(this,"numTaps",void 0),E(this,"lastTime",void 0),E(this,"lastTap",void 0),E(this,"count",void 0),this.singleTap=new gJ(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const n=this.singleTap.touchend(t,e,i);if(n){const a=t.timeStamp-this.lastTime<fB,o=!this.lastTap||this.lastTap.dist(n)<IE;if((!a||!o)&&this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class mJ{constructor(){E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_swipePoint",void 0),E(this,"_swipeTouch",void 0),E(this,"_tapTime",void 0),E(this,"_tapPoint",void 0),E(this,"_tap",void 0),this._tap=new B1({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,e,i){if(!this._swipePoint)if(!this._tapTime)this._tap.touchstart(t,e,i);else{const n=e[0],a=t.timeStamp-this._tapTime<fB,o=this._tapPoint.dist(n)<IE;!a||!o?this.reset():i.length>0&&(this._swipePoint=n,this._swipeTouch=i[0].identifier)}}touchmove(t,e,i){if(!this._tapTime)this._tap.touchmove(t,e,i);else if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=e[0],a=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:a/128}}}touchend(t,e,i){if(this._tapTime)this._swipePoint&&i.length===0&&this.reset();else{const n=this._tap.touchend(t,e,i);n&&(this._tapTime=t.timeStamp,this._tapPoint=n)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yJ{constructor(t){E(this,"_tr",void 0),E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_zoomIn",void 0),E(this,"_zoomOut",void 0),this._tr=new $d(t),this._zoomIn=new B1({numTouches:1,numTaps:2}),this._zoomOut=new B1({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const n=this._zoomIn.touchend(t,e,i),a=this._zoomOut.touchend(t,e,i),o=this._tr;if(n)return this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:s=>s.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(n)},{originalEvent:t})};if(a)return this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:s=>s.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(a)},{originalEvent:t})}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _J{constructor(t,e){E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_touches",void 0),E(this,"_clickTolerance",void 0),E(this,"_sum",void 0),E(this,"_map",void 0),this._clickTolerance=t.clickTolerance||1,this._map=e,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new ue(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(t,e,i){if(!(!this._active||i.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,e,i)}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,e,i){i.length>0&&(this._active=!0);const n=F1(i,e),a=new ue(0,0),o=new ue(0,0);let s=0;for(const c in n){const h=n[c],f=this._touches[c];f&&(a._add(h),o._add(h.sub(f)),s++,n[c]=h)}if(this._touches=n,s<this.minTouchs()||!o.mag())return;const l=o.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(s),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class LE{constructor(){E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_firstTwoTouches",void 0),E(this,"_vector",void 0),E(this,"_startVector",void 0),E(this,"_aroundCenter",void 0),this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){if(!this._firstTwoTouches)return;t.preventDefault();const[n,a]=this._firstTwoTouches,o=Ov(i,e,n),s=Ov(i,e,a);if(!o||!s)return;const l=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],l,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[n,a]=this._firstTwoTouches,o=Ov(i,e,n),s=Ov(i,e,a);o&&s||(this._active&&Lt.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ov(r,t,e){for(let i=0;i<r.length;i++)if(r[i].identifier===e)return t[i]}const xJ=.1;function Nw(r,t){return Math.log(r/t)/Math.LN2}class CJ extends LE{constructor(...t){super(...t),E(this,"_distance",void 0),E(this,"_startDistance",void 0)}reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),!(!this._active&&Math.abs(Nw(this._distance,this._startDistance))<xJ))return this._active=!0,{zoomDelta:Nw(this._distance,i),pinchAround:e}}}const EJ=25;function kw(r,t){return r.angleWith(t)*180/Math.PI}class SJ extends LE{constructor(...t){super(...t),E(this,"_minDiameter",void 0)}reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e,i){const n=this._vector;if(this._vector=t[0].sub(t[1]),!(!this._active&&this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:kw(this._vector,n),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=Math.PI*this._minDiameter,i=EJ/e*360,n=kw(t,this._startVector);return Math.abs(n)<i}}function Yy(r){return Math.abs(r.y)>Math.abs(r.x)}const AJ=100;class TJ extends LE{constructor(t){super(),E(this,"_valid",void 0),E(this,"_firstMove",void 0),E(this,"_lastPoints",void 0),E(this,"_map",void 0),E(this,"_currentTouchCount",0),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,e,i){super.touchstart(t,e,i),this._currentTouchCount=i.length}_start(t){this._lastPoints=t,Yy(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,i){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const n=t[0].sub(this._lastPoints[0]),a=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(n,a,i.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(n.y+a.y)/2*-.5}):void 0}gestureBeginsVertically(t,e,i){if(this._valid!==void 0)return this._valid;const n=2,a=t.mag()>=n,o=e.mag()>=n;if(!a&&!o)return;if(!a||!o)return this._firstMove===void 0&&(this._firstMove=i),i-this._firstMove<AJ?void 0:!1;const s=t.y>0==e.y>0;return Yy(t)&&Yy(e)&&s}}const X0={linearity:.3,easing:EE(0,0,.3,1)},bJ=er({deceleration:2500,maxSpeed:1400},X0),wJ=er({deceleration:20,maxSpeed:1400},X0),RJ=er({deceleration:1e3,maxSpeed:360},X0),MJ=er({deceleration:1e3,maxSpeed:90},X0);class IJ{constructor(t){E(this,"_map",void 0),E(this,"_inertiaBuffer",void 0),this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Nn.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,e=Nn.now(),i=160;for(;t.length>0&&e-t[0].time>i;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const e={zoom:0,bearing:0,pitch:0,pan:new ue(0,0),pinchAround:void 0,around:void 0};for(const{settings:o}of this._inertiaBuffer)e.zoom+=o.zoomDelta||0,e.bearing+=o.bearingDelta||0,e.pitch+=o.pitchDelta||0,o.panDelta&&e.pan._add(o.panDelta),o.around&&(e.around=o.around),o.pinchAround&&(e.pinchAround=o.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,a={};if(e.pan.mag()){const o=Fv(e.pan.mag(),n,er({},bJ,t||{}));a.offset=e.pan.mult(o.amount/e.pan.mag()),a.center=this._map.transform.center,Pv(a,o)}if(e.zoom){const o=Fv(e.zoom,n,wJ);a.zoom=this._map.transform.zoom+o.amount,Pv(a,o)}if(e.bearing){const o=Fv(e.bearing,n,RJ);a.bearing=this._map.transform.bearing+Na(o.amount,-179,179),Pv(a,o)}if(e.pitch){const o=Fv(e.pitch,n,MJ);a.pitch=this._map.transform.pitch+o.amount,Pv(a,o)}if(a.zoom||a.bearing){const o=e.pinchAround===void 0?e.around:e.pinchAround;a.around=o?this._map.unproject(o):this._map.getCenter()}return this.clear(),er(a,{noMoveStart:!0})}}function Pv(r,t){(!r.duration||r.duration<t.duration)&&(r.duration=t.duration,r.easing=t.easing)}function Fv(r,t,e){const{maxSpeed:i,linearity:n,deceleration:a}=e,o=Na(r*n/(t/1e3),-i,i),s=Math.abs(o)/(a*n);return{easing:e.easing,duration:s*1e3,amount:o*(s/2)}}const Bv=r=>r.zoom||r.drag||r.pitch||r.rotate;class LJ extends ee{constructor(t,e){super(t),E(this,"type","renderFrame"),E(this,"timeStamp",void 0),this.timeStamp=e}}function jy(r){return r.panDelta&&r.panDelta.mag()||r.zoomDelta||r.bearingDelta||r.pitchDelta}class OJ{constructor(t,e){E(this,"_map",void 0),E(this,"_el",void 0),E(this,"_handlers",void 0),E(this,"_eventsInProgress",void 0),E(this,"_frameId",void 0),E(this,"_inertia",void 0),E(this,"_bearingSnap",void 0),E(this,"_handlersById",void 0),E(this,"_updatingCamera",void 0),E(this,"_changes",void 0),E(this,"_zoom",void 0),E(this,"_previousActiveHandlers",void 0),E(this,"_listeners",void 0),E(this,"handleWindowEvent",n=>{this.handleEvent(n,`${n.type}Window`)}),E(this,"handleEvent",(n,a)=>{if(n.type==="blur"){this.stop(!0);return}this._updatingCamera=!0;const o=n.type==="renderFrame"?void 0:n,s={needsRenderFrame:!1},l={},u={},c=n.touches,h=c?this._getMapTouches(c):void 0,f=h?Lt.touchPos(this._map.getCanvasContainer(),h):Lt.mousePos(this._map.getCanvasContainer(),n);for(const{handlerName:p,handler:g,allowed:m}of this._handlers){if(!g.isEnabled())continue;let y;this._blockedByActive(u,m,p)?g.reset():g[a||n.type]&&(y=g[a||n.type](n,f,h),this.mergeHandlerResult(s,l,y,p,o),y&&y.needsRenderFrame&&this._triggerRenderFrame()),(y||g.isActive())&&(u[p]=g)}const d={};for(const p in this._previousActiveHandlers)u[p]||(d[p]=o);this._previousActiveHandlers=u,(Object.keys(d).length||jy(s))&&(this._changes.push([s,l,d]),this._triggerRenderFrame()),(Object.keys(u).length||jy(s))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:v}=s;v&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],v(this._map))}),this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new IJ(t),this._bearingSnap=e.bearingSnap||7,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(e);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[n,a,o]of this._listeners)Lt.addEventListener(n,a,n===document?this.handleWindowEvent:this.handleEvent,o)}destroy(){for(const[t,e,i]of this._listeners)Lt.removeEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new KQ(e,t));const n=e.boxZoom=new VQ(e,t);this._add("boxZoom",n),t.interactive&&t.boxZoom&&n.enable();const a=e.cooperativeGestures=new XQ(e,t.cooperativeGestures);this._add("cooperativeGestures",a),t.cooperativeGestures&&a.enable();const o=new yJ(e),s=new GQ(e);e.doubleClickZoom=new cJ(s,o),this._add("tapZoom",o),this._add("clickZoom",s),t.interactive&&t.doubleClickZoom&&e.doubleClickZoom.enable();const l=new mJ;this._add("tapDragZoom",l);const u=e.touchPitch=new TJ(e);this._add("touchPitch",u),t.interactive&&t.touchPitch&&e.touchPitch.enable(t.touchPitch);const c=nJ(t),h=aJ(t);e.dragRotate=new fJ(t,c,h),this._add("mouseRotate",c,["mousePitch"]),this._add("mousePitch",h,["mouseRotate"]),t.interactive&&t.dragRotate&&e.dragRotate.enable();const f=iJ(t),d=new _J(t,e);e.dragPan=new hJ(i,f,d),this._add("mousePan",f),this._add("touchPan",d,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&e.dragPan.enable(t.dragPan);const v=new SJ,p=new CJ;e.touchZoomRotate=new dJ(i,p,v,l),this._add("touchRotate",v,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&e.touchZoomRotate.enable(t.touchZoomRotate);const g=e.scrollZoom=new uJ(e,()=>this._triggerRenderFrame());this._add("scrollZoom",g,["mousePan"]),t.interactive&&t.scrollZoom&&e.scrollZoom.enable(t.scrollZoom);const m=e.keyboard=new jQ(e);this._add("keyboard",m),t.interactive&&t.keyboard&&e.keyboard.enable(),this._add("blockableMapEvent",new QQ(e))}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bv(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,e,i){for(const n in t)if(n!==i&&(!e||e.indexOf(n)<0))return!0;return!1}_getMapTouches(t){const e=[];for(const i of t){const n=i.target;this._el.contains(n)&&e.push(i)}return e}mergeHandlerResult(t,e,i,n,a){if(!i)return;er(t,i);const o={handlerName:n,originalEvent:i.originalEvent||a};i.zoomDelta!==void 0&&(e.zoom=o),i.panDelta!==void 0&&(e.drag=o),i.pitchDelta!==void 0&&(e.pitch=o),i.bearingDelta!==void 0&&(e.rotate=o)}_applyChanges(){const t={},e={},i={};for(const[n,a,o]of this._changes)n.panDelta&&(t.panDelta=(t.panDelta||new ue(0,0))._add(n.panDelta)),n.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+n.pitchDelta),n.around!==void 0&&(t.around=n.around),n.pinchAround!==void 0&&(t.pinchAround=n.pinchAround),n.noInertia&&(t.noInertia=n.noInertia),er(e,a),er(i,o);this._updateMapTransform(t,e,i),this._changes=[]}_updateMapTransform(t,e,i){const n=this._map,a=n._getTransformForUpdate();if(!jy(t))return this._fireEvents(e,i,!0);const{panDelta:o,zoomDelta:s,bearingDelta:l,pitchDelta:u,pinchAround:c}=t;let{around:h}=t;c!==void 0&&(h=c),n._stop(!0),h=h||n.transform.centerPoint;const f=a.pointLocation(o?h.sub(o):h);l&&(a.bearing+=l),u&&(a.pitch+=u),s&&(a.zoom+=s),a.setLocationAtPoint(f,h),n._applyUpdatedTransform(a),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,i,!0)}_fireEvents(t,e,i){const n=Bv(this._eventsInProgress),a=Bv(t),o={};for(const h in t){const{originalEvent:f}=t[h];this._eventsInProgress[h]||(o[`${h}start`]=f),this._eventsInProgress[h]=t[h]}!n&&a&&this._fireEvent("movestart",a.originalEvent);for(const h in o)this._fireEvent(h,o[h]);a&&this._fireEvent("move",a.originalEvent);for(const h in t){const{originalEvent:f}=t[h];this._fireEvent(h,f)}const s={};let l;for(const h in this._eventsInProgress){const{handlerName:f,originalEvent:d}=this._eventsInProgress[h];this._handlersById[f].isActive()||(delete this._eventsInProgress[h],l=e[f]||d,s[`${h}end`]=l)}for(const h in s)this._fireEvent(h,s[h]);const u=Bv(this._eventsInProgress);if(i&&((n||a)&&!u)){this._updatingCamera=!0;const h=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),f=d=>d!==0&&-this._bearingSnap<d&&d<this._bearingSnap;h&&(h.essential||!Nn.prefersReducedMotion)?(f(h.bearing||this._map.getBearing())&&(h.bearing=0),h.freezeElevation=!0,this._map.easeTo(h,{originalEvent:l})):(this._map.fire(new ee("moveend",{originalEvent:l})),f(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,e){this._map.fire(new ee(t,e?{originalEvent:e}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new LJ("renderFrame",t)),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class PJ{constructor(){E(this,"_queue",void 0),E(this,"_id",void 0),E(this,"_cleared",void 0),E(this,"_currentlyRunning",void 0),this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const n of i)if(n.id===t){n.cancelled=!0;return}}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function FJ(r,t){var e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(e||i)&&(t||(t=document),!!t)){var n=t.head||t.getElementsByTagName("head")[0];if(!n){n=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(n,a):t.documentElement.appendChild(n)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(t.createTextNode(r)),n.appendChild(o),o}}FJ(`.l7-map {
  font:
    12px/20px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:-webkit-full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: grab;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  touch-action: none;
}

.l7-canvas-container.l7-touch-drag-pan.l7-cooperative-gestures,
.l7-canvas-container.l7-touch-drag-pan.l7-cooperative-gestures .l7-canvas {
  touch-action: pan-x pan-y;
}

.l7-cooperative-gesture-screen {
  background: rgba(0 0 0 / 40%);
  position: absolute;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  padding: 1rem;
  font-size: 1.4em;
  line-height: 1.2;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1s ease 1s;
  z-index: 99999;
}

.l7-cooperative-gesture-screen.l7-show {
  opacity: 1;
  transition: opacity 0.05s;
}

.l7-cooperative-gesture-screen .l7-mobile-message {
  display: none;
}

@media (hover: none), (width <= 480px) {
  .l7-cooperative-gesture-screen .l7-desktop-message {
    display: none;
  }

  .l7-cooperative-gesture-screen .l7-mobile-message {
    display: block;
  }
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right {
  position: absolute;
  pointer-events: none;
  z-index: 2;
}
.l7-ctrl-top-left {
  top: 0;
  left: 0;
}
.l7-ctrl-top-right {
  top: 0;
  right: 0;
}
.l7-ctrl-bottom-left {
  bottom: 0;
  left: 0;
}
.l7-ctrl-bottom-right {
  right: 0;
  bottom: 0;
}

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}
.l7-ctrl-top-left .l7-ctrl {
  margin: 10px 0 0 10px;
  float: left;
}
.l7-ctrl-top-right .l7-ctrl {
  margin: 10px 10px 0 0;
  float: right;
}
.l7-ctrl-bottom-left .l7-ctrl {
  margin: 0 0 10px 10px;
  float: left;
}
.l7-ctrl-bottom-right .l7-ctrl {
  margin: 0 10px 10px 0;
  float: right;
}

.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
  cursor: crosshair;
}

.l7-boxzoom {
  position: absolute;
  top: 0;
  left: 0;
  width: 0;
  height: 0;
  background: #fff;
  border: 2px dotted #202020;
  opacity: 0.5;
  z-index: 10;
}
`);const Xp=-2,dB=22,os=0,vB=60,Dv=85,BJ={interactive:!0,bearingSnap:7,scrollZoom:!0,minZoom:Xp,maxZoom:dB,minPitch:os,maxPitch:vB,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,fadeDuration:300,clickTolerance:3,pitchWithRotate:!0};let DJ=class extends WQ{constructor(t){const e=V(V({},BJ),t);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<os)throw new Error(`minPitch must be greater than or equal to ${os}`);if(e.maxPitch!=null&&e.maxPitch>Dv)throw new Error(`maxPitch must be less than or equal to ${Dv}`);const i=new AE(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(super(i,{bearingSnap:e.bearingSnap}),E(this,"_container",void 0),E(this,"_canvasContainer",void 0),E(this,"_interactive",void 0),E(this,"_frameRequest",void 0),E(this,"_loaded",void 0),E(this,"_idleTriggered",!1),E(this,"_fullyLoaded",void 0),E(this,"_trackResize",void 0),E(this,"_resizeObserver",void 0),E(this,"_preserveDrawingBuffer",void 0),E(this,"_failIfMajorPerformanceCaveat",void 0),E(this,"_fadeDuration",void 0),E(this,"_crossSourceCollisions",void 0),E(this,"_crossFadingFactor",1),E(this,"_collectResourceTiming",void 0),E(this,"_renderTaskQueue",new PJ),E(this,"_mapId",OQ()),E(this,"_removed",void 0),E(this,"_clickTolerance",void 0),E(this,"scrollZoom",void 0),E(this,"boxZoom",void 0),E(this,"dragRotate",void 0),E(this,"dragPan",void 0),E(this,"keyboard",void 0),E(this,"doubleClickZoom",void 0),E(this,"touchZoomRotate",void 0),E(this,"touchPitch",void 0),E(this,"cooperativeGestures",void 0),E(this,"_onMapScroll",n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}),this._interactive=e.interactive,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._fadeDuration=e.fadeDuration,this._clickTolerance=e.clickTolerance,typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else if(e.container instanceof HTMLElement)this._container=e.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this.on("move",()=>this._update()).on("moveend",()=>this._update()).on("zoom",()=>this._update()).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){let n=!1;const a=tr.throttle(o=>{this._trackResize&&!this._removed&&this.resize(o)._update()},50);this._resizeObserver=new ResizeObserver(o=>{if(!n){n=!0;return}a(o)}),this._resizeObserver.observe(this._container)}this.handlers=new OJ(this,e),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,er({},e.fitBoundsOptions,{duration:0}))),this.resize()}_getMapId(){return this._mapId}calculateCameraOptionsFromTo(t,e,i,n){return super.calculateCameraOptionsFromTo(t,e,i,n)}resize(t){var e;const i=this._containerDimensions(),n=i[0],a=i[1];this.transform.resize(n,a),(e=this._requestedCameraState)===null||e===void 0||e.resize(n,a);const o=!this._moving;return o&&(this.stop(),this.fire(new ee("movestart",t)).fire(new ee("move",t))),this.fire(new ee("resize",t)),o&&this.fire(new ee("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(t&&sa.convert(t)),this._update()}setMinZoom(t){if(t=t??Xp,t>=Xp&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error(`minZoom must be between ${Xp} and the current maxZoom, inclusive`)}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if(t=t??dB,t>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if(t=t??os,t<os)throw new Error(`minPitch must be greater than or equal to ${os}`);if(t>=os&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error(`minPitch must be between ${os} and the current maxPitch, inclusive`)}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if(t=t??vB,t>Dv)throw new Error(`maxPitch must be less than or equal to ${Dv}`);if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){this.transform.renderWorldCopies=t}project(t){return this.transform.locationPoint(ve.convert(t))}unproject(t){return this.transform.pointLocation(ue.convert(t))}isMoving(){var t;return this._moving||((t=this.handlers)===null||t===void 0?void 0:t.isMoving())}isZooming(){var t;return this._zooming||((t=this.handlers)===null||t===void 0?void 0:t.isZooming())}isRotating(){var t;return this._rotating||((t=this.handlers)===null||t===void 0?void 0:t.isRotating())}on(t,e){return super.on(t,e)}once(t,e){return super.once(t,e)}off(t,e){return super.off(t,e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_setupContainer(){const t=this._container;t.classList.add("l7-map");const e=this._canvasContainer=Lt.create("div","l7-canvas-container",t);this._interactive&&e.classList.add("l7-interactive"),this._container.addEventListener("scroll",this._onMapScroll,!1)}_update(){return this.triggerRepaint(),this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(t){if(this._renderTaskQueue.run(t),!this._removed)return this.fire(new ee("render")),this.isMoving()||this.fire(new ee("idle")),this}remove(){var t;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.handlers.destroy(),delete this.handlers,(t=this._resizeObserver)===null||t===void 0||t.disconnect(),Lt.remove(this._canvasContainer),this._container.classList.remove("l7-map"),this._removed=!0,this.fire(new ee("remove"))}triggerRepaint(){this._frameRequest||(this._frameRequest=new AbortController,Nn.frameAsync(this._frameRequest).then(t=>{this._frameRequest=null,this._render(t)}).catch(()=>{}))}getCameraTargetElevation(){return this.transform.elevation}};const NJ=["id","style","rotation","mapInstance","version","mapSize","interactive"];class kJ extends oB{constructor(...t){super(...t),E(this,"version",aB.DEFAULT),E(this,"viewport",void 0)}lngLatToCoord(t,e={x:0,y:0,z:0}){const{x:i,y:n}=this.lngLatToMercator(t,0);return[i-e.x,n-e.y]}lngLatToMercator(t,e){const{x:i=0,y:n=0,z:a=0}=Ua.fromLngLat(t,e);return{x:i,y:n,z:a}}getModelMatrix(t,e,i,n=[1,1,1],a={x:0,y:0,z:0}){const o=Ua.fromLngLat(t,e),s=o.meterInMercatorCoordinateUnits(),l=jc();return yo(l,l,gi(o.x-a.x,o.y-a.y,o.z||0-a.z)),_o(l,l,gi(s*n[0],-s*n[1],s*n[2])),Dd(l,l,i[0]),B0(l,l,i[1]),D0(l,l,i[2]),l}init(){var t=this;return X(function*(){const e=t.config,{id:i="map",style:n="light",rotation:a=0,mapInstance:o,version:s="DEFAULTMAP",mapSize:l=1e4,interactive:u=!0}=e,c=$n(e,NJ);t.viewport=new xE,t.version=s,t.simpleMapCoord.setSize(l),s==="SIMPLE"&&c.center&&(c.center=t.simpleMapCoord.unproject(c.center)),o?(t.map=o,t.$mapContainer=t.map.getContainer()):(t.$mapContainer=t.creatMapContainer(i),t.map=new DJ(V({container:t.$mapContainer,bearing:a},c))),t.map.on("load",()=>{t.handleCameraChanged()}),u&&t.map.on("move",t.handleCameraChanged),setTimeout(()=>{t.handleCameraChanged()},100),t.handleCameraChanged()})()}creatMapContainer(t){let e=t;typeof t=="string"&&(e=document.getElementById(t));const i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,e.appendChild(i),i}exportMap(t){return""}setMapStyle(t){}getCanvasOverlays(){return this.getContainer()}}let UJ=class extends _E{getServiceConstructor(){return kJ}};const zJ=["id","attributionControl","style","token","rotation","mapInstance"];function HJ(r,t){var e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(e||i)&&(t||(t=document),!!t)){var n=t.head||t.getElementsByTagName("head")[0];if(!n){n=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(n,a):t.documentElement.appendChild(n)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(t.createTextNode(r)),n.appendChild(o),o}}HJ(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`);window.mapboxgl=Kh;let $J=0;const Uw="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg";class WJ extends oB{constructor(...t){super(...t),E(this,"version","MAPBOX"),E(this,"viewport",void 0)}getType(){return"mapbox"}lngLatToCoord(t,e={x:0,y:0,z:0}){const{x:i,y:n}=this.lngLatToMercator(t,0);return[i-e.x,n-e.y]}lngLatToMercator(t,e){const{x:i=0,y:n=0,z:a=0}=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e);return{x:i,y:n,z:a}}getModelMatrix(t,e,i,n=[1,1,1],a={x:0,y:0,z:0}){const o=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),s=o.meterInMercatorCoordinateUnits(),l=jc();return yo(l,l,gi(o.x-a.x,o.y-a.y,o.z||0-a.z)),_o(l,l,gi(s*n[0],-s*n[1],s*n[2])),Dd(l,l,i[0]),B0(l,l,i[1]),D0(l,l,i[2]),l}init(){var t=this;return X(function*(){const e=t.config,{id:i="map",attributionControl:n=!1,style:a="light",token:o=Uw,rotation:s=0,mapInstance:l}=e,u=$n(e,zJ);t.viewport=new xE,!l&&!window.mapboxgl&&console.error(t.configService.getSceneWarninfo("SDK")),o===Uw&&a!=="blank"&&!window.mapboxgl.accessToken&&!l&&console.warn(t.configService.getSceneWarninfo("MapToken")),!l&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=o),l?(t.map=l,t.$mapContainer=t.map.getContainer()):(t.$mapContainer=t.creatMapContainer(i),t.map=new window.mapboxgl.Map(V({container:t.$mapContainer,style:t.getMapStyleValue(a),attributionControl:n,bearing:s},u))),t.map.on("load",()=>{t.handleCameraChanged()}),t.map.on("move",t.handleCameraChanged),t.handleCameraChanged()})()}destroy(){var t;(t=this.$mapContainer)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(t,...e){this.eventEmitter.emit(t,...e)}once(t,...e){this.eventEmitter.once(t,...e)}getMapContainer(){return this.$mapContainer}getCanvasOverlays(){var t;return(t=this.getMapContainer())===null||t===void 0?void 0:t.querySelector(".mapboxgl-canvas-container")}meterToCoord(t,e){const i=new Kh.LngLat(t[0],t[1]),n=new Kh.LngLat(e[0],e[1]),a=i.distanceTo(n),o=Kh.MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),s=Kh.MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),{x:l,y:u}=o,{x:c,y:h}=s;return Math.sqrt(Math.pow(l-c,2)+Math.pow(u-h,2))*4194304*2/a}exportMap(t){const e=this.map.getCanvas();return t==="jpg"?e==null?void 0:e.toDataURL("image/jpeg"):e==null?void 0:e.toDataURL("image/png")}creatMapContainer(t){let e=t;typeof t=="string"&&(e=document.getElementById(t));const i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_mapbox_div"+$J++,e.appendChild(i),i}}function VJ(r,t){var e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(e||i)&&(t||(t=document),!!t)){var n=t.head||t.getElementsByTagName("head")[0];if(!n){n=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(n,a):t.documentElement.appendChild(n)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(t.createTextNode(r)),n.appendChild(o),o}}VJ(`.mapboxgl-ctrl-logo {
  display: none !important;
}
`);class GJ extends _E{getServiceConstructor(){return WJ}}const XJ=CE,YJ=CE,jJ=CE;function kn(r){return r==null}var ZJ=function(r,t,e){return r<t?t:r>e?e:r};const qJ=ZJ;function Vu(r){return typeof r=="number"}var pB={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function n(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function a(l,u,c,h,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var d=new n(c,h||l,f),v=e?e+u:u;return l._events[v]?l._events[v].fn?l._events[v]=[l._events[v],d]:l._events[v].push(d):(l._events[v]=d,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new i:delete l._events[u]}function s(){this._events=new i,this._eventsCount=0}s.prototype.eventNames=function(){var u=[],c,h;if(this._eventsCount===0)return u;for(h in c=this._events)t.call(c,h)&&u.push(e?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},s.prototype.listeners=function(u){var c=e?e+u:u,h=this._events[c];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,d=h.length,v=new Array(d);f<d;f++)v[f]=h[f].fn;return v},s.prototype.listenerCount=function(u){var c=e?e+u:u,h=this._events[c];return h?h.fn?1:h.length:0},s.prototype.emit=function(u,c,h,f,d,v){var p=e?e+u:u;if(!this._events[p])return!1;var g=this._events[p],m=arguments.length,y,_;if(g.fn){switch(g.once&&this.removeListener(u,g.fn,void 0,!0),m){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,h),!0;case 4:return g.fn.call(g.context,c,h,f),!0;case 5:return g.fn.call(g.context,c,h,f,d),!0;case 6:return g.fn.call(g.context,c,h,f,d,v),!0}for(_=1,y=new Array(m-1);_<m;_++)y[_-1]=arguments[_];g.fn.apply(g.context,y)}else{var x=g.length,C;for(_=0;_<x;_++)switch(g[_].once&&this.removeListener(u,g[_].fn,void 0,!0),m){case 1:g[_].fn.call(g[_].context);break;case 2:g[_].fn.call(g[_].context,c);break;case 3:g[_].fn.call(g[_].context,c,h);break;case 4:g[_].fn.call(g[_].context,c,h,f);break;default:if(!y)for(C=1,y=new Array(m-1);C<m;C++)y[C-1]=arguments[C];g[_].fn.apply(g[_].context,y)}}return!0},s.prototype.on=function(u,c,h){return a(this,u,c,h,!1)},s.prototype.once=function(u,c,h){return a(this,u,c,h,!0)},s.prototype.removeListener=function(u,c,h,f){var d=e?e+u:u;if(!this._events[d])return this;if(!c)return o(this,d),this;var v=this._events[d];if(v.fn)v.fn===c&&(!f||v.once)&&(!h||v.context===h)&&o(this,d);else{for(var p=0,g=[],m=v.length;p<m;p++)(v[p].fn!==c||f&&!v[p].once||h&&v[p].context!==h)&&g.push(v[p]);g.length?this._events[d]=g.length===1?g[0]:g:o(this,d)}return this},s.prototype.removeAllListeners=function(u){var c;return u?(c=e?e+u:u,this._events[c]&&o(this,c)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=e,s.EventEmitter=s,r.exports=s})(pB);var KJ=pB.exports;const gB=uH(KJ);var F;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",r[r.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.CULL_FACE=2884]="CULL_FACE",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.BLEND=3042]="BLEND",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.DITHER=3024]="DITHER",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DOUBLE=5130]="DOUBLE",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.ALWAYS=519]="ALWAYS",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.GEQUAL=518]="GEQUAL",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",r[r.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",r[r.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.READ_BUFFER=3074]="READ_BUFFER",r[r.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",r[r.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",r[r.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",r[r.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",r[r.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",r[r.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",r[r.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",r[r.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",r[r.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",r[r.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",r[r.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",r[r.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",r[r.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",r[r.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",r[r.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",r[r.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",r[r.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",r[r.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",r[r.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",r[r.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",r[r.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",r[r.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",r[r.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",r[r.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",r[r.RED=6403]="RED",r[r.RGB8=32849]="RGB8",r[r.RGBA8=32856]="RGBA8",r[r.RGB10_A2=32857]="RGB10_A2",r[r.TEXTURE_3D=32879]="TEXTURE_3D",r[r.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",r[r.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",r[r.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",r[r.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",r[r.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",r[r.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",r[r.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",r[r.SRGB=35904]="SRGB",r[r.SRGB8=35905]="SRGB8",r[r.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",r[r.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",r[r.RGBA32F=34836]="RGBA32F",r[r.RGB32F=34837]="RGB32F",r[r.RGBA16F=34842]="RGBA16F",r[r.RGB16F=34843]="RGB16F",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",r[r.R11F_G11F_B10F=35898]="R11F_G11F_B10F",r[r.RGB9_E5=35901]="RGB9_E5",r[r.RGBA32UI=36208]="RGBA32UI",r[r.RGB32UI=36209]="RGB32UI",r[r.RGBA16UI=36214]="RGBA16UI",r[r.RGB16UI=36215]="RGB16UI",r[r.RGBA8UI=36220]="RGBA8UI",r[r.RGB8UI=36221]="RGB8UI",r[r.RGBA32I=36226]="RGBA32I",r[r.RGB32I=36227]="RGB32I",r[r.RGBA16I=36232]="RGBA16I",r[r.RGB16I=36233]="RGB16I",r[r.RGBA8I=36238]="RGBA8I",r[r.RGB8I=36239]="RGB8I",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.R8=33321]="R8",r[r.RG8=33323]="RG8",r[r.R16F=33325]="R16F",r[r.R32F=33326]="R32F",r[r.RG16F=33327]="RG16F",r[r.RG32F=33328]="RG32F",r[r.R8I=33329]="R8I",r[r.R8UI=33330]="R8UI",r[r.R16I=33331]="R16I",r[r.R16UI=33332]="R16UI",r[r.R32I=33333]="R32I",r[r.R32UI=33334]="R32UI",r[r.RG8I=33335]="RG8I",r[r.RG8UI=33336]="RG8UI",r[r.RG16I=33337]="RG16I",r[r.RG16UI=33338]="RG16UI",r[r.RG32I=33339]="RG32I",r[r.RG32UI=33340]="RG32UI",r[r.R8_SNORM=36756]="R8_SNORM",r[r.RG8_SNORM=36757]="RG8_SNORM",r[r.RGB8_SNORM=36758]="RGB8_SNORM",r[r.RGBA8_SNORM=36759]="RGBA8_SNORM",r[r.RGB10_A2UI=36975]="RGB10_A2UI",r[r.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",r[r.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.HALF_FLOAT=5131]="HALF_FLOAT",r[r.RG=33319]="RG",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",r[r.CURRENT_QUERY=34917]="CURRENT_QUERY",r[r.QUERY_RESULT=34918]="QUERY_RESULT",r[r.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",r[r.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",r[r.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",r[r.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",r[r.DRAW_BUFFER0=34853]="DRAW_BUFFER0",r[r.DRAW_BUFFER1=34854]="DRAW_BUFFER1",r[r.DRAW_BUFFER2=34855]="DRAW_BUFFER2",r[r.DRAW_BUFFER3=34856]="DRAW_BUFFER3",r[r.DRAW_BUFFER4=34857]="DRAW_BUFFER4",r[r.DRAW_BUFFER5=34858]="DRAW_BUFFER5",r[r.DRAW_BUFFER6=34859]="DRAW_BUFFER6",r[r.DRAW_BUFFER7=34860]="DRAW_BUFFER7",r[r.DRAW_BUFFER8=34861]="DRAW_BUFFER8",r[r.DRAW_BUFFER9=34862]="DRAW_BUFFER9",r[r.DRAW_BUFFER10=34863]="DRAW_BUFFER10",r[r.DRAW_BUFFER11=34864]="DRAW_BUFFER11",r[r.DRAW_BUFFER12=34865]="DRAW_BUFFER12",r[r.DRAW_BUFFER13=34866]="DRAW_BUFFER13",r[r.DRAW_BUFFER14=34867]="DRAW_BUFFER14",r[r.DRAW_BUFFER15=34868]="DRAW_BUFFER15",r[r.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",r[r.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",r[r.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",r[r.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",r[r.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",r[r.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",r[r.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",r[r.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",r[r.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",r[r.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",r[r.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",r[r.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",r[r.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",r[r.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",r[r.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",r[r.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",r[r.SAMPLER_3D=35679]="SAMPLER_3D",r[r.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",r[r.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",r[r.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",r[r.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",r[r.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",r[r.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",r[r.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",r[r.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",r[r.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",r[r.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",r[r.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",r[r.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",r[r.MAX_SAMPLES=36183]="MAX_SAMPLES",r[r.SAMPLER_BINDING=35097]="SAMPLER_BINDING",r[r.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",r[r.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",r[r.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",r[r.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",r[r.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",r[r.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",r[r.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",r[r.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",r[r.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",r[r.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",r[r.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",r[r.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",r[r.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",r[r.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",r[r.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",r[r.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",r[r.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",r[r.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",r[r.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",r[r.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",r[r.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",r[r.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",r[r.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",r[r.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",r[r.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",r[r.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",r[r.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",r[r.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",r[r.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",r[r.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",r[r.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",r[r.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",r[r.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",r[r.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",r[r.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",r[r.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",r[r.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",r[r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r[r.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",r[r.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",r[r.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",r[r.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",r[r.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",r[r.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",r[r.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",r[r.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",r[r.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",r[r.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",r[r.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",r[r.UNIFORM_TYPE=35383]="UNIFORM_TYPE",r[r.UNIFORM_SIZE=35384]="UNIFORM_SIZE",r[r.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",r[r.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",r[r.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",r[r.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",r[r.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",r[r.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",r[r.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",r[r.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",r[r.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",r[r.OBJECT_TYPE=37138]="OBJECT_TYPE",r[r.SYNC_CONDITION=37139]="SYNC_CONDITION",r[r.SYNC_STATUS=37140]="SYNC_STATUS",r[r.SYNC_FLAGS=37141]="SYNC_FLAGS",r[r.SYNC_FENCE=37142]="SYNC_FENCE",r[r.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",r[r.UNSIGNALED=37144]="UNSIGNALED",r[r.SIGNALED=37145]="SIGNALED",r[r.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",r[r.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",r[r.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",r[r.WAIT_FAILED=37149]="WAIT_FAILED",r[r.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",r[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX",r[r.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",r[r.STREAM_READ=35041]="STREAM_READ",r[r.STREAM_COPY=35042]="STREAM_COPY",r[r.STATIC_READ=35045]="STATIC_READ",r[r.STATIC_COPY=35046]="STATIC_COPY",r[r.DYNAMIC_READ=35049]="DYNAMIC_READ",r[r.DYNAMIC_COPY=35050]="DYNAMIC_COPY",r[r.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",r[r.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",r[r.INVALID_INDEX=4294967295]="INVALID_INDEX",r[r.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",r[r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",r[r.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",r[r.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",r[r.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",r[r.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",r[r.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",r[r.RGBA32F_EXT=34836]="RGBA32F_EXT",r[r.RGB32F_EXT=34837]="RGB32F_EXT",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",r[r.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",r[r.MIN_EXT=32775]="MIN_EXT",r[r.MAX_EXT=32776]="MAX_EXT",r[r.SRGB_EXT=35904]="SRGB_EXT",r[r.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",r[r.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",r[r.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",r[r.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",r[r.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",r[r.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",r[r.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",r[r.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",r[r.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",r[r.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",r[r.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",r[r.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",r[r.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",r[r.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",r[r.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",r[r.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",r[r.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",r[r.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",r[r.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",r[r.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",r[r.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",r[r.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",r[r.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",r[r.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",r[r.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",r[r.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",r[r.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",r[r.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",r[r.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",r[r.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",r[r.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",r[r.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",r[r.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",r[r.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",r[r.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",r[r.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",r[r.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",r[r.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",r[r.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",r[r.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",r[r.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",r[r.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",r[r.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",r[r.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(F||(F={}));var ne;(function(r){r[r.Buffer=0]="Buffer",r[r.Texture=1]="Texture",r[r.RenderTarget=2]="RenderTarget",r[r.Sampler=3]="Sampler",r[r.Program=4]="Program",r[r.Bindings=5]="Bindings",r[r.InputLayout=6]="InputLayout",r[r.RenderPipeline=7]="RenderPipeline",r[r.ComputePipeline=8]="ComputePipeline",r[r.Readback=9]="Readback",r[r.QueryPool=10]="QueryPool",r[r.RenderBundle=11]="RenderBundle"})(ne||(ne={}));var fe;(function(r){r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS"})(fe||(fe={}));var Vf;(function(r){r[r.CCW=2305]="CCW",r[r.CW=2304]="CW"})(Vf||(Vf={}));var ki;(function(r){r[r.NONE=0]="NONE",r[r.FRONT=1]="FRONT",r[r.BACK=2]="BACK",r[r.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(ki||(ki={}));var Yt;(function(r){r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC=768]="SRC",r[r.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",r[r.DST=774]="DST",r[r.ONE_MINUS_DST=775]="ONE_MINUS_DST",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.CONST=32769]="CONST",r[r.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(Yt||(Yt={}));var Sr;(function(r){r[r.ADD=32774]="ADD",r[r.SUBSTRACT=32778]="SUBSTRACT",r[r.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX"})(Sr||(Sr={}));var Ci;(function(r){r[r.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",r[r.REPEAT=1]="REPEAT",r[r.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(Ci||(Ci={}));var qe;(function(r){r[r.POINT=0]="POINT",r[r.BILINEAR=1]="BILINEAR"})(qe||(qe={}));var gr;(function(r){r[r.NO_MIP=0]="NO_MIP",r[r.NEAREST=1]="NEAREST",r[r.LINEAR=2]="LINEAR"})(gr||(gr={}));var ar;(function(r){r[r.POINTS=0]="POINTS",r[r.TRIANGLES=1]="TRIANGLES",r[r.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",r[r.LINES=3]="LINES",r[r.LINE_STRIP=4]="LINE_STRIP"})(ar||(ar={}));var Ae;(function(r){r[r.MAP_READ=1]="MAP_READ",r[r.MAP_WRITE=2]="MAP_WRITE",r[r.COPY_SRC=4]="COPY_SRC",r[r.COPY_DST=8]="COPY_DST",r[r.INDEX=16]="INDEX",r[r.VERTEX=32]="VERTEX",r[r.UNIFORM=64]="UNIFORM",r[r.STORAGE=128]="STORAGE",r[r.INDIRECT=256]="INDIRECT",r[r.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(Ae||(Ae={}));var va;(function(r){r[r.STATIC=1]="STATIC",r[r.DYNAMIC=2]="DYNAMIC"})(va||(va={}));var Vl;(function(r){r[r.VERTEX=1]="VERTEX",r[r.INSTANCE=2]="INSTANCE"})(Vl||(Vl={}));var zw;(function(r){r.LOADED="loaded"})(zw||(zw={}));var jt;(function(r){r[r.TEXTURE_2D=0]="TEXTURE_2D",r[r.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",r[r.TEXTURE_3D=2]="TEXTURE_3D",r[r.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(jt||(jt={}));var ai;(function(r){r[r.SAMPLED=1]="SAMPLED",r[r.RENDER_TARGET=2]="RENDER_TARGET",r[r.STORAGE=4]="STORAGE"})(ai||(ai={}));var _r;(function(r){r[r.NONE=0]="NONE",r[r.RED=1]="RED",r[r.GREEN=2]="GREEN",r[r.BLUE=4]="BLUE",r[r.ALPHA=8]="ALPHA",r[r.RGB=7]="RGB",r[r.ALL=15]="ALL"})(_r||(_r={}));var je;(function(r){r[r.KEEP=7680]="KEEP",r[r.ZERO=0]="ZERO",r[r.REPLACE=7681]="REPLACE",r[r.INVERT=5386]="INVERT",r[r.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",r[r.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",r[r.INCREMENT_WRAP=34055]="INCREMENT_WRAP",r[r.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(je||(je={}));var Ye;(function(r){r[r.Float=0]="Float",r[r.UnfilterableFloat=1]="UnfilterableFloat",r[r.Uint=2]="Uint",r[r.Sint=3]="Sint",r[r.Depth=4]="Depth"})(Ye||(Ye={}));var ca;(function(r){r[r.LOWER_LEFT=0]="LOWER_LEFT",r[r.UPPER_LEFT=1]="UPPER_LEFT"})(ca||(ca={}));var Ac;(function(r){r[r.NEGATIVE_ONE=0]="NEGATIVE_ONE",r[r.ZERO=1]="ZERO"})(Ac||(Ac={}));var Lg;(function(r){r[r.OcclusionConservative=0]="OcclusionConservative"})(Lg||(Lg={}));var K;(function(r){r[r.U8=1]="U8",r[r.U16=2]="U16",r[r.U32=3]="U32",r[r.S8=4]="S8",r[r.S16=5]="S16",r[r.S32=6]="S32",r[r.F16=7]="F16",r[r.F32=8]="F32",r[r.BC1=65]="BC1",r[r.BC2=66]="BC2",r[r.BC3=67]="BC3",r[r.BC4_UNORM=68]="BC4_UNORM",r[r.BC4_SNORM=69]="BC4_SNORM",r[r.BC5_UNORM=70]="BC5_UNORM",r[r.BC5_SNORM=71]="BC5_SNORM",r[r.U16_PACKED_5551=97]="U16_PACKED_5551",r[r.U16_PACKED_565=98]="U16_PACKED_565",r[r.D24=129]="D24",r[r.D32F=130]="D32F",r[r.D24S8=131]="D24S8",r[r.D32FS8=132]="D32FS8"})(K||(K={}));var pt;(function(r){r[r.R=1]="R",r[r.RG=2]="RG",r[r.RGB=3]="RGB",r[r.RGBA=4]="RGBA",r[r.A=5]="A"})(pt||(pt={}));var ot;(function(r){r[r.None=0]="None",r[r.Normalized=1]="Normalized",r[r.sRGB=2]="sRGB",r[r.Depth=4]="Depth",r[r.Stencil=8]="Stencil",r[r.RenderTarget=16]="RenderTarget",r[r.Luminance=32]="Luminance"})(ot||(ot={}));function Et(r,t,e){return r<<16|t<<8|e}var U;(function(r){r[r.ALPHA=Et(K.U8,pt.A,ot.None)]="ALPHA",r[r.U8_LUMINANCE=Et(K.U8,pt.A,ot.Luminance)]="U8_LUMINANCE",r[r.F16_LUMINANCE=Et(K.F16,pt.A,ot.Luminance)]="F16_LUMINANCE",r[r.F32_LUMINANCE=Et(K.F32,pt.A,ot.Luminance)]="F32_LUMINANCE",r[r.F16_R=Et(K.F16,pt.R,ot.None)]="F16_R",r[r.F16_RG=Et(K.F16,pt.RG,ot.None)]="F16_RG",r[r.F16_RGB=Et(K.F16,pt.RGB,ot.None)]="F16_RGB",r[r.F16_RGBA=Et(K.F16,pt.RGBA,ot.None)]="F16_RGBA",r[r.F32_R=Et(K.F32,pt.R,ot.None)]="F32_R",r[r.F32_RG=Et(K.F32,pt.RG,ot.None)]="F32_RG",r[r.F32_RGB=Et(K.F32,pt.RGB,ot.None)]="F32_RGB",r[r.F32_RGBA=Et(K.F32,pt.RGBA,ot.None)]="F32_RGBA",r[r.U8_R=Et(K.U8,pt.R,ot.None)]="U8_R",r[r.U8_R_NORM=Et(K.U8,pt.R,ot.Normalized)]="U8_R_NORM",r[r.U8_RG=Et(K.U8,pt.RG,ot.None)]="U8_RG",r[r.U8_RG_NORM=Et(K.U8,pt.RG,ot.Normalized)]="U8_RG_NORM",r[r.U8_RGB=Et(K.U8,pt.RGB,ot.None)]="U8_RGB",r[r.U8_RGB_NORM=Et(K.U8,pt.RGB,ot.Normalized)]="U8_RGB_NORM",r[r.U8_RGB_SRGB=Et(K.U8,pt.RGB,ot.sRGB|ot.Normalized)]="U8_RGB_SRGB",r[r.U8_RGBA=Et(K.U8,pt.RGBA,ot.None)]="U8_RGBA",r[r.U8_RGBA_NORM=Et(K.U8,pt.RGBA,ot.Normalized)]="U8_RGBA_NORM",r[r.U8_RGBA_SRGB=Et(K.U8,pt.RGBA,ot.sRGB|ot.Normalized)]="U8_RGBA_SRGB",r[r.U16_R=Et(K.U16,pt.R,ot.None)]="U16_R",r[r.U16_R_NORM=Et(K.U16,pt.R,ot.Normalized)]="U16_R_NORM",r[r.U16_RG_NORM=Et(K.U16,pt.RG,ot.Normalized)]="U16_RG_NORM",r[r.U16_RGBA_NORM=Et(K.U16,pt.RGBA,ot.Normalized)]="U16_RGBA_NORM",r[r.U16_RGBA=Et(K.U16,pt.RGBA,ot.None)]="U16_RGBA",r[r.U16_RGB=Et(K.U16,pt.RGB,ot.None)]="U16_RGB",r[r.U16_RG=Et(K.U16,pt.RG,ot.None)]="U16_RG",r[r.U32_R=Et(K.U32,pt.R,ot.None)]="U32_R",r[r.U32_RG=Et(K.U32,pt.RG,ot.None)]="U32_RG",r[r.U32_RGB=Et(K.U32,pt.RGB,ot.None)]="U32_RGB",r[r.U32_RGBA=Et(K.U32,pt.RGBA,ot.None)]="U32_RGBA",r[r.S8_R=Et(K.S8,pt.R,ot.None)]="S8_R",r[r.S8_R_NORM=Et(K.S8,pt.R,ot.Normalized)]="S8_R_NORM",r[r.S8_RG_NORM=Et(K.S8,pt.RG,ot.Normalized)]="S8_RG_NORM",r[r.S8_RGB_NORM=Et(K.S8,pt.RGB,ot.Normalized)]="S8_RGB_NORM",r[r.S8_RGBA_NORM=Et(K.S8,pt.RGBA,ot.Normalized)]="S8_RGBA_NORM",r[r.S16_R=Et(K.S16,pt.R,ot.None)]="S16_R",r[r.S16_RG=Et(K.S16,pt.RG,ot.None)]="S16_RG",r[r.S16_RG_NORM=Et(K.S16,pt.RG,ot.Normalized)]="S16_RG_NORM",r[r.S16_RGB_NORM=Et(K.S16,pt.RGB,ot.Normalized)]="S16_RGB_NORM",r[r.S16_RGBA=Et(K.S16,pt.RGBA,ot.None)]="S16_RGBA",r[r.S16_RGBA_NORM=Et(K.S16,pt.RGBA,ot.Normalized)]="S16_RGBA_NORM",r[r.S32_R=Et(K.S32,pt.R,ot.None)]="S32_R",r[r.S32_RG=Et(K.S32,pt.RG,ot.None)]="S32_RG",r[r.S32_RGB=Et(K.S32,pt.RGB,ot.None)]="S32_RGB",r[r.S32_RGBA=Et(K.S32,pt.RGBA,ot.None)]="S32_RGBA",r[r.U16_RGBA_5551=Et(K.U16_PACKED_5551,pt.RGBA,ot.Normalized)]="U16_RGBA_5551",r[r.U16_RGB_565=Et(K.U16_PACKED_565,pt.RGB,ot.Normalized)]="U16_RGB_565",r[r.BC1=Et(K.BC1,pt.RGBA,ot.Normalized)]="BC1",r[r.BC1_SRGB=Et(K.BC1,pt.RGBA,ot.Normalized|ot.sRGB)]="BC1_SRGB",r[r.BC2=Et(K.BC2,pt.RGBA,ot.Normalized)]="BC2",r[r.BC2_SRGB=Et(K.BC2,pt.RGBA,ot.Normalized|ot.sRGB)]="BC2_SRGB",r[r.BC3=Et(K.BC3,pt.RGBA,ot.Normalized)]="BC3",r[r.BC3_SRGB=Et(K.BC3,pt.RGBA,ot.Normalized|ot.sRGB)]="BC3_SRGB",r[r.BC4_UNORM=Et(K.BC4_UNORM,pt.R,ot.Normalized)]="BC4_UNORM",r[r.BC4_SNORM=Et(K.BC4_SNORM,pt.R,ot.Normalized)]="BC4_SNORM",r[r.BC5_UNORM=Et(K.BC5_UNORM,pt.RG,ot.Normalized)]="BC5_UNORM",r[r.BC5_SNORM=Et(K.BC5_SNORM,pt.RG,ot.Normalized)]="BC5_SNORM",r[r.D24=Et(K.D24,pt.R,ot.Depth)]="D24",r[r.D24_S8=Et(K.D24S8,pt.RG,ot.Depth|ot.Stencil)]="D24_S8",r[r.D32F=Et(K.D32F,pt.R,ot.Depth)]="D32F",r[r.D32F_S8=Et(K.D32FS8,pt.RG,ot.Depth|ot.Stencil)]="D32F_S8",r[r.U8_RGB_RT=Et(K.U8,pt.RGB,ot.RenderTarget|ot.Normalized)]="U8_RGB_RT",r[r.U8_RGBA_RT=Et(K.U8,pt.RGBA,ot.RenderTarget|ot.Normalized)]="U8_RGBA_RT",r[r.U8_RGBA_RT_SRGB=Et(K.U8,pt.RGBA,ot.RenderTarget|ot.Normalized|ot.sRGB)]="U8_RGBA_RT_SRGB"})(U||(U={}));function OE(r){return r>>>8&255}function ro(r){return r>>>16&255}function Tc(r){return r&255}function mB(r){switch(r){case K.F32:case K.U32:case K.S32:return 4;case K.U16:case K.S16:case K.F16:return 2;case K.U8:case K.S8:return 1;default:throw new Error("whoops")}}function yB(r){return mB(ro(r))}function QJ(r){var t=mB(ro(r)),e=OE(r);return t*e}function _B(r){var t=Tc(r);if(t&ot.Depth)return Ye.Depth;if(t&ot.Normalized)return Ye.Float;var e=ro(r);if(e===K.F16||e===K.F32)return Ye.Float;if(e===K.U8||e===K.U16||e===K.U32)return Ye.Uint;if(e===K.S8||e===K.S16||e===K.S32)return Ye.Sint;throw new Error("whoops")}function Bt(r,t){if(t===void 0&&(t=""),!r)throw new Error("Assert fail: ".concat(t))}function _l(r){if(r!=null)return r;throw new Error("Missing object")}function xB(r,t){return r.r===t.r&&r.g===t.g&&r.b===t.b&&r.a===t.a}function CB(r,t){r.r=t.r,r.g=t.g,r.b=t.b,r.a=t.a}function EB(r){var t=r.r,e=r.g,i=r.b,n=r.a;return{r:t,g:e,b:i,a:n}}function Wd(r,t,e,i){return i===void 0&&(i=1),{r,g:t,b:e,a:i}}var Y0=Wd(0,0,0,0);Wd(0,0,0,1);var JJ=Wd(1,1,1,0);Wd(1,1,1,1);function Og(r){return!!(r&&!(r&r-1))}function Jo(r,t){return r??t}function ttt(r){return r===void 0?null:r}function Pg(r,t){var e=t-1;return r+e&~e}function ett(r,t){for(var e=new Array(r),i=0;i<r;i++)e[i]=t();return e}function rtt(r,t){t===void 0&&(t=1);var e=r.split(`
`);return e.map(function(i,n){return"".concat(itt(""+(t+n),4," "),"  ").concat(i)}).join(`
`)}function itt(r,t,e){for(e===void 0&&(e="0");r.length<t;)r="".concat(e).concat(r);return r}function Hw(r,t){r.blendDstFactor=t.blendDstFactor,r.blendSrcFactor=t.blendSrcFactor,r.blendMode=t.blendMode}function Fg(r,t){return r===void 0&&(r={}),r.compare=t.compare,r.depthFailOp=t.depthFailOp,r.passOp=t.passOp,r.failOp=t.failOp,r.mask=t.mask,r}function SB(r,t){return r===void 0&&(r={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),Hw(r.rgbBlendState,t.rgbBlendState),Hw(r.alphaBlendState,t.alphaBlendState),r.channelWriteMask=t.channelWriteMask,r}function AB(r,t){r.length!==t.length&&(r.length=t.length);for(var e=0;e<t.length;e++)r[e]=SB(r[e],t[e])}function ntt(r,t){t.attachmentsState!==void 0&&AB(r.attachmentsState,t.attachmentsState),r.blendConstant&&t.blendConstant&&CB(r.blendConstant,t.blendConstant),r.depthCompare=Jo(t.depthCompare,r.depthCompare),r.depthWrite=Jo(t.depthWrite,r.depthWrite),r.stencilWrite=Jo(t.stencilWrite,r.stencilWrite),r.stencilFront&&t.stencilFront&&Fg(r.stencilFront,t.stencilFront),r.stencilBack&&t.stencilBack&&Fg(r.stencilBack,t.stencilBack),r.cullMode=Jo(t.cullMode,r.cullMode),r.frontFace=Jo(t.frontFace,r.frontFace),r.polygonOffset=Jo(t.polygonOffset,r.polygonOffset),r.polygonOffsetFactor=Jo(t.polygonOffsetFactor,r.polygonOffsetFactor),r.polygonOffsetUnits=Jo(t.polygonOffsetUnits,r.polygonOffsetUnits)}function bc(r){var t=Object.assign({},r);return t.attachmentsState=[],AB(t.attachmentsState,r.attachmentsState),t.blendConstant=t.blendConstant&&EB(t.blendConstant),t.stencilFront=Fg(void 0,r.stencilFront),t.stencilBack=Fg(void 0,r.stencilBack),t}var $w={blendMode:Sr.ADD,blendSrcFactor:Yt.ONE,blendDstFactor:Yt.ZERO},wc={attachmentsState:[{channelWriteMask:_r.ALL,rgbBlendState:$w,alphaBlendState:$w}],blendConstant:EB(Y0),depthWrite:!0,depthCompare:fe.LEQUAL,stencilWrite:!1,stencilFront:{compare:fe.ALWAYS,passOp:je.KEEP,depthFailOp:je.KEEP,failOp:je.KEEP},stencilBack:{compare:fe.ALWAYS,passOp:je.KEEP,depthFailOp:je.KEEP,failOp:je.KEEP},cullMode:ki.NONE,frontFace:Vf.CCW,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0};function att(r,t){r===void 0&&(r=null),t===void 0&&(t=wc);var e=bc(t);return r!==null&&ntt(e,r),e}att({depthCompare:fe.ALWAYS,depthWrite:!1},wc);var TB={texture:null,sampler:null,formatKind:Ye.Float,dimension:jt.TEXTURE_2D};function gs(r,t,e){if(r.length!==t.length)return!1;for(var i=0;i<r.length;i++)if(!e(r[i],t[i]))return!1;return!0}function Gu(r,t){for(var e=Array(r.length),i=0;i<r.length;i++)e[i]=t(r[i]);return e}function ott(r,t){return r.texture===t.texture&&r.binding===t.binding}function Ww(r,t){return r.buffer===t.buffer&&r.size===t.size&&r.binding===t.binding&&r.offset===t.offset}function stt(r,t){return r===null?t===null:t===null?!1:r.sampler===t.sampler&&r.texture===t.texture&&r.dimension===t.dimension&&r.formatKind===t.formatKind&&r.comparison===t.comparison}function ltt(r,t){return r.samplerBindings=r.samplerBindings||[],r.uniformBufferBindings=r.uniformBufferBindings||[],r.storageBufferBindings=r.storageBufferBindings||[],r.storageTextureBindings=r.storageTextureBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],!(r.samplerBindings.length!==t.samplerBindings.length||!gs(r.samplerBindings,t.samplerBindings,stt)||!gs(r.uniformBufferBindings,t.uniformBufferBindings,Ww)||!gs(r.storageBufferBindings,t.storageBufferBindings,Ww)||!gs(r.storageTextureBindings,t.storageTextureBindings,ott))}function Vw(r,t){return r.blendMode==t.blendMode&&r.blendSrcFactor===t.blendSrcFactor&&r.blendDstFactor===t.blendDstFactor}function utt(r,t){return!(!Vw(r.rgbBlendState,t.rgbBlendState)||!Vw(r.alphaBlendState,t.alphaBlendState)||r.channelWriteMask!==t.channelWriteMask)}function Bg(r,t){return r.compare==t.compare&&r.depthFailOp===t.depthFailOp&&r.failOp===t.failOp&&r.passOp===t.passOp&&r.mask===t.mask}function ctt(r,t){return!gs(r.attachmentsState,t.attachmentsState,utt)||r.blendConstant&&t.blendConstant&&!xB(r.blendConstant,t.blendConstant)||r.stencilFront&&t.stencilFront&&!Bg(r.stencilFront,t.stencilFront)||r.stencilBack&&t.stencilBack&&!Bg(r.stencilBack,t.stencilBack)?!1:r.depthCompare===t.depthCompare&&r.depthWrite===t.depthWrite&&r.stencilWrite===t.stencilWrite&&r.cullMode===t.cullMode&&r.frontFace===t.frontFace&&r.polygonOffset===t.polygonOffset&&r.polygonOffsetFactor===t.polygonOffsetFactor&&r.polygonOffsetUnits===t.polygonOffsetUnits}function bB(r,t){return r.id===t.id}function htt(r,t){return r===t}function ftt(r,t){return!(r.topology!==t.topology||r.inputLayout!==t.inputLayout||r.sampleCount!==t.sampleCount||r.megaStateDescriptor&&t.megaStateDescriptor&&!ctt(r.megaStateDescriptor,t.megaStateDescriptor)||!bB(r.program,t.program)||!gs(r.colorAttachmentFormats,t.colorAttachmentFormats,htt)||r.depthStencilAttachmentFormat!==t.depthStencilAttachmentFormat)}function dtt(r,t){return r.offset===t.offset&&r.shaderLocation===t.shaderLocation&&r.format===t.format&&r.divisor===t.divisor}function vtt(r,t){return kn(r)?kn(t):kn(t)?!1:r.arrayStride===t.arrayStride&&r.stepMode===t.stepMode&&gs(r.attributes,t.attributes,dtt)}function ptt(r,t){return!(r.indexBufferFormat!==t.indexBufferFormat||!gs(r.vertexBufferDescriptors,t.vertexBufferDescriptors,vtt)||!bB(r.program,t.program))}function gtt(r){var t=r.sampler,e=r.texture,i=r.dimension,n=r.formatKind,a=r.comparison;return{sampler:t,texture:e,dimension:i,formatKind:n,comparison:a}}function Gw(r){var t=r.buffer,e=r.size,i=r.binding,n=r.offset;return{binding:i,buffer:t,offset:n,size:e}}function mtt(r){var t=r.binding,e=r.texture;return{binding:t,texture:e}}function ytt(r){var t=r.samplerBindings&&Gu(r.samplerBindings,gtt),e=r.uniformBufferBindings&&Gu(r.uniformBufferBindings,Gw),i=r.storageBufferBindings&&Gu(r.storageBufferBindings,Gw),n=r.storageTextureBindings&&Gu(r.storageTextureBindings,mtt);return{samplerBindings:t,uniformBufferBindings:e,storageBufferBindings:i,storageTextureBindings:n,pipeline:r.pipeline}}function _tt(r){var t=r.inputLayout,e=r.program,i=r.topology,n=r.megaStateDescriptor&&bc(r.megaStateDescriptor),a=r.colorAttachmentFormats.slice(),o=r.depthStencilAttachmentFormat,s=r.sampleCount;return{inputLayout:t,megaStateDescriptor:n,program:e,topology:i,colorAttachmentFormats:a,depthStencilAttachmentFormat:o,sampleCount:s}}function xtt(r){var t=r.shaderLocation,e=r.format,i=r.offset,n=r.divisor;return{shaderLocation:t,format:e,offset:i,divisor:n}}function Ctt(r){if(kn(r))return r;var t=r.arrayStride,e=r.stepMode,i=Gu(r.attributes,xtt);return{arrayStride:t,stepMode:e,attributes:i}}function Ett(r){var t=Gu(r.vertexBufferDescriptors,Ctt),e=r.indexBufferFormat,i=r.program;return{vertexBufferDescriptors:t,indexBufferFormat:e,program:i}}var Kt,Stt=/([^[]*)(\[[0-9]+\])?/;function Att(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};var t=r.match(Stt);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(r));return{name:t[1],length:Number(t[2])||1,isArray:!!t[2]}}function di(){var r=null;return function(t,e,i){var n=r!==i;return n&&(t.uniform1i(e,i),r=i),n}}function Ve(r,t,e,i){var n=null,a=null;return function(o,s,l){var u=t(l,e),c=u.length,h=!1;if(n===null)n=new Float32Array(c),a=c,h=!0;else{Bt(a===c,"Uniform length cannot change.");for(var f=0;f<c;++f)if(u[f]!==n[f]){h=!0;break}}return h&&(i(o,r,s,u),n.set(u)),h}}function ti(r,t,e,i){r[t](e,i)}function vo(r,t,e,i){r[t](e,!1,i)}var Ttt={},btt={},wtt={},Xw=[0];function PE(r,t,e,i){t===1&&typeof r=="boolean"&&(r=r?1:0),Number.isFinite(r)&&(Xw[0]=r,r=Xw);var n=r.length;if(r instanceof e)return r;var a=i[n];a||(a=new e(n),i[n]=a);for(var o=0;o<n;o++)a[o]=r[o];return a}function en(r,t){return PE(r,t,Float32Array,Ttt)}function ts(r,t){return PE(r,t,Int32Array,btt)}function Nv(r,t){return PE(r,t,Uint32Array,wtt)}var Rtt=(Kt={},Kt[F.FLOAT]=Ve.bind(null,"uniform1fv",en,1,ti),Kt[F.FLOAT_VEC2]=Ve.bind(null,"uniform2fv",en,2,ti),Kt[F.FLOAT_VEC3]=Ve.bind(null,"uniform3fv",en,3,ti),Kt[F.FLOAT_VEC4]=Ve.bind(null,"uniform4fv",en,4,ti),Kt[F.INT]=Ve.bind(null,"uniform1iv",ts,1,ti),Kt[F.INT_VEC2]=Ve.bind(null,"uniform2iv",ts,2,ti),Kt[F.INT_VEC3]=Ve.bind(null,"uniform3iv",ts,3,ti),Kt[F.INT_VEC4]=Ve.bind(null,"uniform4iv",ts,4,ti),Kt[F.BOOL]=Ve.bind(null,"uniform1iv",ts,1,ti),Kt[F.BOOL_VEC2]=Ve.bind(null,"uniform2iv",ts,2,ti),Kt[F.BOOL_VEC3]=Ve.bind(null,"uniform3iv",ts,3,ti),Kt[F.BOOL_VEC4]=Ve.bind(null,"uniform4iv",ts,4,ti),Kt[F.FLOAT_MAT2]=Ve.bind(null,"uniformMatrix2fv",en,4,vo),Kt[F.FLOAT_MAT3]=Ve.bind(null,"uniformMatrix3fv",en,9,vo),Kt[F.FLOAT_MAT4]=Ve.bind(null,"uniformMatrix4fv",en,16,vo),Kt[F.UNSIGNED_INT]=Ve.bind(null,"uniform1uiv",Nv,1,ti),Kt[F.UNSIGNED_INT_VEC2]=Ve.bind(null,"uniform2uiv",Nv,2,ti),Kt[F.UNSIGNED_INT_VEC3]=Ve.bind(null,"uniform3uiv",Nv,3,ti),Kt[F.UNSIGNED_INT_VEC4]=Ve.bind(null,"uniform4uiv",Nv,4,ti),Kt[F.FLOAT_MAT2x3]=Ve.bind(null,"uniformMatrix2x3fv",en,6,vo),Kt[F.FLOAT_MAT2x4]=Ve.bind(null,"uniformMatrix2x4fv",en,8,vo),Kt[F.FLOAT_MAT3x2]=Ve.bind(null,"uniformMatrix3x2fv",en,6,vo),Kt[F.FLOAT_MAT3x4]=Ve.bind(null,"uniformMatrix3x4fv",en,12,vo),Kt[F.FLOAT_MAT4x2]=Ve.bind(null,"uniformMatrix4x2fv",en,8,vo),Kt[F.FLOAT_MAT4x3]=Ve.bind(null,"uniformMatrix4x3fv",en,12,vo),Kt[F.SAMPLER_2D]=di,Kt[F.SAMPLER_CUBE]=di,Kt[F.SAMPLER_3D]=di,Kt[F.SAMPLER_2D_SHADOW]=di,Kt[F.SAMPLER_2D_ARRAY]=di,Kt[F.SAMPLER_2D_ARRAY_SHADOW]=di,Kt[F.SAMPLER_CUBE_SHADOW]=di,Kt[F.INT_SAMPLER_2D]=di,Kt[F.INT_SAMPLER_3D]=di,Kt[F.INT_SAMPLER_CUBE]=di,Kt[F.INT_SAMPLER_2D_ARRAY]=di,Kt[F.UNSIGNED_INT_SAMPLER_2D]=di,Kt[F.UNSIGNED_INT_SAMPLER_3D]=di,Kt[F.UNSIGNED_INT_SAMPLER_CUBE]=di,Kt[F.UNSIGNED_INT_SAMPLER_2D_ARRAY]=di,Kt);function Yw(r,t,e){var i=Rtt[e.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(e.type));return i().bind(null,r,t)}var Mtt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function Itt(r){return Object.prototype.toString.call(r)in Mtt}function Oh(r,t){return"#define ".concat(r," ").concat(t)}function Ltt(r){var t={};return r.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(e,i,n){var a=Number(n);return t[i]=isNaN(a)?n:a,""}),t}function Ott(r,t){var e=[];return r.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(i,n,a){var o=Number(n);return e.push({location:isNaN(o)?t[n]:o,name:a}),""}),e}function jw(r){if(r===void 0)return null;var t=/binding\s*=\s*(\d+)/.exec(r);if(t!==null){var e=parseInt(t[1],10);if(!Number.isNaN(e))return e}return null}function Zw(r){var t="",e=r;return[e,t]}function Rc(r,t,e,i,n){var a;i===void 0&&(i=null),n===void 0&&(n=!0);var o=r.glslVersion==="#version 100",s=t==="frag"&&((a=e.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||a===void 0?void 0:a.length)>1,l=e.replace(`\r
`,`
`).split(`
`).map(function(A){return A.replace(/[/][/].*$/,"")}).filter(function(A){var T=!A||/^\s+$/.test(A);return!T}),u="";i!==null&&(u=Object.keys(i).map(function(A){return Oh(A,i[A])}).join(`
`));var c=l.find(function(A){return A.startsWith("precision")})||"precision mediump float;",h=n?l.filter(function(A){return!A.startsWith("precision")}).join(`
`):l.join(`
`),f="";if(r.viewportOrigin===ca.UPPER_LEFT&&(f+="".concat(Oh("VIEWPORT_ORIGIN_TL","1"),`
`)),r.clipSpaceNearZ===Ac.ZERO&&(f+="".concat(Oh("CLIPSPACE_NEAR_ZERO","1"),`
`)),r.explicitBindingLocations){var d=0,v=0,p=0;h=h.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,function(A,T,w,M){var O=w?"".concat(w,", "):"";return"layout(".concat(O,"set = ").concat(d,", binding = ").concat(v++,") uniform ").concat(M)}),d++,v=0,Bt(r.separateSamplerTextures),h=h.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(A,T,w,M,O){var P=jw(w);P===null&&(P=v++);var D=lt(Zw(M),2),z=D[0],Y=D[1];return t==="frag"?`
layout(set = `.concat(d,", binding = ").concat(P*2+0,") uniform texture").concat(z," T_").concat(O,`;
layout(set = `).concat(d,", binding = ").concat(P*2+1,") uniform sampler").concat(Y," S_").concat(O,";").trim():""}),h=h.replace(t==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(A,T){return"layout(location = ".concat(p++,") ").concat(T)}),f+="".concat(Oh("gl_VertexID","gl_VertexIndex"),`
`),f+="".concat(Oh("gl_InstanceID","gl_InstanceIndex"),`
`),c=c.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var g=0;h=h.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(A,T,w,M,O){var P=jw(w);return P===null&&(P=g++),"uniform sampler".concat(M," ").concat(O,"; // BINDING=").concat(P)})}if(h=h.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,function(A,T,w){return"SAMPLER_".concat(T,"(P_").concat(w,")")}),h=h.replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,function(A,T,w){return"PP_SAMPLER_".concat(T,"(P_").concat(w,")")}),h=h.replace(/\bPU_TEXTURE\((.*?)\)/g,function(A,T){return"TEXTURE(P_".concat(T,")")}),r.separateSamplerTextures)h=h.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(A,T,w){var M=lt(Zw(T),2),O=M[0],P=M[1];return"texture".concat(O," T_P_").concat(w,", sampler").concat(P," S_P_").concat(w)}),h=h.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(A,T,w){return"T_".concat(w,", S_").concat(w)}),h=h.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(A,T,w){return"sampler".concat(T,"(T_").concat(w,", S_").concat(w,")")}),h=h.replace(/\bTEXTURE\((.*?)\)/g,function(A,T){return"T_".concat(T)});else{var m=[];h=h.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(A,T,w){return"sampler".concat(T," P_").concat(w)}),h=h.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(A,T,w){return w}),h=h.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(A,T,w){return m.push([w,T]),w}),o&&m.forEach(function(A){var T=lt(A,2),w=T[0],M=T[1];h=h.replace(new RegExp("texture\\(".concat(w),"g"),function(){return"texture".concat(M,"(").concat(w)})}),h=h.replace(/\bTEXTURE\((.*?)\)/g,function(A,T){return T})}var y="".concat(o?"":r.glslVersion,`
`).concat(o&&s?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(o&&t==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(n?c:"",`
`).concat(f||"").concat(u?u+`
`:"",`
`).concat(h,`
`).trim();if(r.explicitBindingLocations&&t==="frag"&&(y=y.replace(/^\b(out)\b/g,function(A,T){return"layout(location = 0) ".concat(T)})),o){if(t==="frag"&&(y=y.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(A,T,w){return"varying ".concat(T," ").concat(w,`;
`)})),t==="vert"&&(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(A,T,w){return"varying ".concat(T," ").concat(w,`;
`)}),y=y.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(A,T,w){return"attribute ".concat(T," ").concat(w,`;
`)})),y=y.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(A,T){return T.trim().replace(/^.*$/gm,function(w){var M=w.trim();return M.startsWith("#")?M:w?"uniform ".concat(M):""})}),t==="frag")if(s){var _=[];y=y.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(A,T){return _.push(T),"vec4 ".concat(T,`;
`)});var x=y.lastIndexOf("}");y=y.substring(0,x)+`
    `.concat(_.map(function(A,T){return"gl_FragData[".concat(T,"] = ").concat(A,`;
    `)}).join(`
`))+y.substring(x)}else{var C;if(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(A,T,w){return C=w,"".concat(T," ").concat(w,`;
`)}),C){var x=y.lastIndexOf("}");y=y.substring(0,x)+`
  gl_FragColor = vec4(`.concat(C,`);
`)+y.substring(x)}}y=y.replace(/^\s*layout\((.*)\)/gm,"")}return y}var qn=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=r.call(this)||this;return a.id=i,a.device=n,a.device.resourceCreationTracker!==null&&a.device.resourceCreationTracker.trackResourceCreated(a),a}return t.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(gB),Ptt=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=ne.Bindings;var s=a.uniformBufferBindings,l=a.samplerBindings;return o.uniformBufferBindings=s||[],o.samplerBindings=l||[],o.bindingLayouts=o.createBindingLayouts(),o}return t.prototype.createBindingLayouts=function(){var e=0,i=0,n=[],a=this.uniformBufferBindings.length,o=this.samplerBindings.length;return n.push({firstUniformBuffer:e,numUniformBuffers:a,firstSampler:i,numSamplers:o}),e+=a,i+=o,{numUniformBuffers:e,numSamplers:i,bindingLayoutTables:n}},t}(qn),Ph;function yt(r){return Ph!==void 0?Ph:typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?(Ph=!0,!0):(Ph=!!(r&&r._version===2),Ph)}function wB(r){var t=ro(r);switch(t){case K.BC1:case K.BC2:case K.BC3:case K.BC4_UNORM:case K.BC4_SNORM:case K.BC5_UNORM:case K.BC5_SNORM:return!0;default:return!1}}function RB(r){var t=Tc(r);if(t&ot.Normalized)return!1;var e=ro(r);return e===K.S8||e===K.S16||e===K.S32||e===K.U8||e===K.U16||e===K.U32}function Ftt(r){switch(r){case va.STATIC:return F.STATIC_DRAW;case va.DYNAMIC:return F.DYNAMIC_DRAW}}function qw(r){if(r&Ae.INDEX)return F.ELEMENT_ARRAY_BUFFER;if(r&Ae.VERTEX)return F.ARRAY_BUFFER;if(r&Ae.UNIFORM)return F.UNIFORM_BUFFER}function Btt(r){switch(r){case ar.TRIANGLES:return F.TRIANGLES;case ar.POINTS:return F.POINTS;case ar.TRIANGLE_STRIP:return F.TRIANGLE_STRIP;case ar.LINES:return F.LINES;case ar.LINE_STRIP:return F.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function Dtt(r){switch(r){case K.U8:return F.UNSIGNED_BYTE;case K.U16:return F.UNSIGNED_SHORT;case K.U32:return F.UNSIGNED_INT;case K.S8:return F.BYTE;case K.S16:return F.SHORT;case K.S32:return F.INT;case K.F16:return F.HALF_FLOAT;case K.F32:return F.FLOAT;default:throw new Error("whoops")}}function Ntt(r){switch(r){case pt.R:return 1;case pt.RG:return 2;case pt.RGB:return 3;case pt.RGBA:return 4;default:return 1}}function ktt(r){var t=ro(r),e=OE(r),i=Tc(r),n=Dtt(t),a=Ntt(e),o=!!(i&ot.Normalized);return{size:a,type:n,normalized:o}}function Utt(r){switch(r){case U.U8_R:return F.UNSIGNED_BYTE;case U.U16_R:return F.UNSIGNED_SHORT;case U.U32_R:return F.UNSIGNED_INT;default:throw new Error("whoops")}}function Fh(r){switch(r){case Ci.CLAMP_TO_EDGE:return F.CLAMP_TO_EDGE;case Ci.REPEAT:return F.REPEAT;case Ci.MIRRORED_REPEAT:return F.MIRRORED_REPEAT;default:throw new Error("whoops")}}function kv(r,t){if(t===gr.LINEAR&&r===qe.BILINEAR)return F.LINEAR_MIPMAP_LINEAR;if(t===gr.LINEAR&&r===qe.POINT)return F.NEAREST_MIPMAP_LINEAR;if(t===gr.NEAREST&&r===qe.BILINEAR)return F.LINEAR_MIPMAP_NEAREST;if(t===gr.NEAREST&&r===qe.POINT)return F.NEAREST_MIPMAP_NEAREST;if(t===gr.NO_MIP&&r===qe.BILINEAR)return F.LINEAR;if(t===gr.NO_MIP&&r===qe.POINT)return F.NEAREST;throw new Error("Unknown texture filter mode")}function ac(r,t){t===void 0&&(t=0);var e=r;return e.gl_buffer_pages[t/e.pageByteSize|0]}function Nu(r){var t=r;return t.gl_texture}function D1(r){var t=r;return t.gl_sampler}function Bh(r,t){r.name=t,r.__SPECTOR_Metadata={name:t}}function Kw(r,t){for(var e=[];;){var i=t.exec(r);if(!i)break;e.push(i)}return e}function es(r){return r.blendMode==Sr.ADD&&r.blendSrcFactor==Yt.ONE&&r.blendDstFactor===Yt.ZERO}function ztt(r){switch(r){case Lg.OcclusionConservative:return F.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function Htt(r){if(r===jt.TEXTURE_2D)return F.TEXTURE_2D;if(r===jt.TEXTURE_2D_ARRAY)return F.TEXTURE_2D_ARRAY;if(r===jt.TEXTURE_CUBE_MAP)return F.TEXTURE_CUBE_MAP;if(r===jt.TEXTURE_3D)return F.TEXTURE_3D;throw new Error("whoops")}function Zy(r,t,e,i){return!(r%e!==0||t%i!==0)}var $tt=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=ne.Buffer;var s=a.viewOrSize,l=a.usage,u=a.hint,c=u===void 0?va.STATIC:u,h=n.uniformBufferMaxPageByteSize,f=n.gl,d=l&Ae.UNIFORM;d||(yt(f)?f.bindVertexArray(null):n.OES_vertex_array_object.bindVertexArrayOES(null));var v=Vu(s)?Pg(s,4):Pg(s.byteLength,4);o.gl_buffer_pages=[];var p;if(d){for(var g=v;g>0;)o.gl_buffer_pages.push(o.createBufferPage(Math.min(g,h),l,c)),g-=h;p=h}else o.gl_buffer_pages.push(o.createBufferPage(v,l,c)),p=v;return o.pageByteSize=p,o.byteSize=v,o.usage=l,o.gl_target=qw(l),Vu(s)||o.setSubData(0,new Uint8Array(s.buffer)),d||(yt(f)?f.bindVertexArray(o.device.currentBoundVAO):n.OES_vertex_array_object.bindVertexArrayOES(o.device.currentBoundVAO)),o}return t.prototype.setSubData=function(e,i,n,a){n===void 0&&(n=0),a===void 0&&(a=i.byteLength-n);for(var o=this.device.gl,s=this.pageByteSize,l=e+a,u=e,c=e%s;u<l;){var h=yt(o)?o.COPY_WRITE_BUFFER:this.gl_target,f=ac(this,u);if(f.ubo)return;o.bindBuffer(h,f),yt(o)?o.bufferSubData(h,c,i,n,Math.min(l-u,s)):o.bufferSubData(h,c,i),u+=s,c=0,n+=s,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){r.prototype.destroy.call(this);for(var e=0;e<this.gl_buffer_pages.length;e++)this.gl_buffer_pages[e].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[e]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(e,i,n){var a=this.device.gl,o=i&Ae.UNIFORM;if(!yt(a)&&o)return{ubo:!0};var s=this.device.ensureResourceExists(a.createBuffer()),l=qw(i),u=Ftt(n);return a.bindBuffer(l,s),a.bufferData(l,e,u),s},t}(qn),Wtt=function(r){B(t,r);function t(e){var i,n,a,o,s=e.id,l=e.device,u=e.descriptor,c,h=r.call(this,{id:s,device:l})||this;h.type=ne.InputLayout;var f=u.vertexBufferDescriptors,d=u.indexBufferFormat,v=u.program;Bt(d===U.U16_R||d===U.U32_R||d===null);var p=d!==null?Utt(d):null,g=d!==null?yB(d):null,m=h.device.gl,y=h.device.ensureResourceExists(yt(m)?m.createVertexArray():l.OES_vertex_array_object.createVertexArrayOES());yt(m)?m.bindVertexArray(y):l.OES_vertex_array_object.bindVertexArrayOES(y),m.bindBuffer(m.ARRAY_BUFFER,ac(h.device.fallbackVertexBuffer));try{for(var _=qt(u.vertexBufferDescriptors),x=_.next();!x.done;x=_.next()){var C=x.value,A=C.stepMode,T=C.attributes;try{for(var w=(a=void 0,qt(T)),M=w.next();!M.done;M=w.next()){var O=M.value,P=O.shaderLocation,D=O.format,z=O.divisor,Y=z===void 0?1:z,H=yt(m)?P:(c=v.attributes[P])===null||c===void 0?void 0:c.location,N=ktt(D);if(O.vertexFormat=N,!kn(H)){RB(D);var W=N.size,Q=N.type,q=N.normalized;m.vertexAttribPointer(H,W,Q,q,0,0),A===Vl.INSTANCE&&(yt(m)?m.vertexAttribDivisor(H,Y):l.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(H,Y)),m.enableVertexAttribArray(H)}}}catch(J){a={error:J}}finally{try{M&&!M.done&&(o=w.return)&&o.call(w)}finally{if(a)throw a.error}}}}catch(J){i={error:J}}finally{try{x&&!x.done&&(n=_.return)&&n.call(_)}finally{if(i)throw i.error}}return yt(m)?m.bindVertexArray(null):l.OES_vertex_array_object.bindVertexArrayOES(null),h.vertexBufferDescriptors=f,h.vao=y,h.indexBufferFormat=d,h.indexBufferType=p,h.indexBufferCompByteSize=g,h.program=v,h}return t.prototype.destroy=function(){r.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(yt(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(qn),N1=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=e.fake,s=r.call(this,{id:i,device:n})||this;s.type=ne.Texture,a=S({dimension:jt.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},a);var l=s.device.gl,u,c,h=s.clampmipLevelCount(a);if(s.immutable=a.usage===ai.RENDER_TARGET,s.pixelStore=a.pixelStore,s.format=a.format,s.dimension=a.dimension,s.formatKind=_B(a.format),s.width=a.width,s.height=a.height,s.depthOrArrayLayers=a.depthOrArrayLayers,s.mipmaps=h>=1,!o){c=s.device.ensureResourceExists(l.createTexture());var f=s.device.translateTextureType(a.format),d=s.device.translateTextureInternalFormat(a.format);if(s.device.setActiveTexture(l.TEXTURE0),s.device.currentTextures[0]=null,s.preprocessImage(),a.dimension===jt.TEXTURE_2D){if(u=F.TEXTURE_2D,l.bindTexture(u,c),s.immutable)if(yt(l))l.texStorage2D(u,h,d,a.width,a.height);else{var v=(d===F.DEPTH_COMPONENT||s.isNPOT(),0);(s.format===U.D32F||s.format===U.D24_S8)&&!yt(l)&&!n.WEBGL_depth_texture||(l.texImage2D(u,v,d,a.width,a.height,0,d,f,null),s.mipmaps&&(s.mipmaps=!1,l.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),l.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),l.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE)))}Bt(a.depthOrArrayLayers===1)}else if(a.dimension===jt.TEXTURE_2D_ARRAY)u=F.TEXTURE_2D_ARRAY,l.bindTexture(u,c),s.immutable&&yt(l)&&l.texStorage3D(u,h,d,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===jt.TEXTURE_3D)u=F.TEXTURE_3D,l.bindTexture(u,c),s.immutable&&yt(l)&&l.texStorage3D(u,h,d,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===jt.TEXTURE_CUBE_MAP)u=F.TEXTURE_CUBE_MAP,l.bindTexture(u,c),s.immutable&&yt(l)&&l.texStorage2D(u,h,d,a.width,a.height),Bt(a.depthOrArrayLayers===6);else throw new Error("whoops")}return s.gl_texture=c,s.gl_target=u,s.mipLevelCount=h,s}return t.prototype.setImageData=function(e,i){i===void 0&&(i=0);var n=this.device.gl;wB(this.format);var a=this.gl_target===F.TEXTURE_3D||this.gl_target===F.TEXTURE_2D_ARRAY,o=this.gl_target===F.TEXTURE_CUBE_MAP,s=Itt(e[0]);this.device.setActiveTexture(n.TEXTURE0),this.device.currentTextures[0]=null;var l=e[0],u,c;s?(u=this.width,c=this.height):(u=l.width,c=l.height,this.width=u,this.height=c),n.bindTexture(this.gl_target,this.gl_texture);var h=this.device.translateTextureFormat(this.format),f=yt(n)?this.device.translateInternalTextureFormat(this.format):h,d=this.device.translateTextureType(this.format);this.preprocessImage();for(var v=0;v<this.depthOrArrayLayers;v++){var p=e[v],g=this.gl_target;o&&(g=F.TEXTURE_CUBE_MAP_POSITIVE_X+v%6),this.immutable?n.texSubImage2D(g,i,0,0,u,c,h,d,p):yt(n)?a?n.texImage3D(g,i,f,u,c,this.depthOrArrayLayers,0,h,d,p):n.texImage2D(g,i,f,u,c,0,h,d,p):s?n.texImage2D(g,i,h,u,c,0,h,d,p):n.texImage2D(g,i,h,h,d,p)}this.mipmaps&&this.generateMipmap(a)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.device.gl.deleteTexture(Nu(this))},t.prototype.clampmipLevelCount=function(e){if(e.dimension===jt.TEXTURE_2D_ARRAY&&e.depthOrArrayLayers>1){var i=ro(e.format);if(i===K.BC1)for(var n=e.width,a=e.height,o=0;o<e.mipLevelCount;o++){if(n<=2||a<=2)return o-1;n=Math.max(n/2|0,1),a=Math.max(a/2|0,1)}}return e.mipLevelCount},t.prototype.preprocessImage=function(){var e=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&e.pixelStorei(F.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&e.pixelStorei(F.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&e.pixelStorei(F.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(e){e===void 0&&(e=!1);var i=this.device.gl;return!yt(i)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(i.bindTexture(this.gl_target,this.gl_texture),e?(i.texParameteri(this.gl_target,F.TEXTURE_BASE_LEVEL,0),i.texParameteri(this.gl_target,F.TEXTURE_MAX_LEVEL,Math.log2(this.width)),i.texParameteri(this.gl_target,F.TEXTURE_MIN_FILTER,F.LINEAR_MIPMAP_LINEAR),i.texParameteri(this.gl_target,F.TEXTURE_MAG_FILTER,F.LINEAR)):i.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.NEAREST_MIPMAP_LINEAR),i.generateMipmap(this.gl_target),i.bindTexture(this.gl_target,null)),this)},t.prototype.isNPOT=function(){var e=this.device.gl;return yt(e)?!1:!Og(this.width)||!Og(this.height)},t}(qn),Vtt=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=ne.RenderTarget,o.gl_renderbuffer=null,o.texture=null;var s=o.device.gl,l=a.format,u=a.width,c=a.height,h=a.sampleCount,f=h===void 0?1:h,d=a.texture,v=!1;if((l===U.D32F||l===U.D24_S8)&&d&&!yt(s)&&!n.WEBGL_depth_texture&&(d.destroy(),o.texture=null,v=!0),!v&&d)o.texture=d;else{o.gl_renderbuffer=o.device.ensureResourceExists(s.createRenderbuffer()),s.bindRenderbuffer(s.RENDERBUFFER,o.gl_renderbuffer);var p=o.device.translateTextureInternalFormat(l,!0);yt(s)&&f>1?s.renderbufferStorageMultisample(F.RENDERBUFFER,f,p,u,c):s.renderbufferStorage(F.RENDERBUFFER,p,u,c)}return o.format=l,o.width=u,o.height=c,o.sampleCount=f,o}return t.prototype.destroy=function(){r.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(qn),Pi;(function(r){r[r.NeedsCompile=0]="NeedsCompile",r[r.Compiling=1]="Compiling",r[r.NeedsBind=2]="NeedsBind",r[r.ReadyToUse=3]="ReadyToUse"})(Pi||(Pi={}));var Gtt=function(r){B(t,r);function t(e,i){var n=e.id,a=e.device,o=e.descriptor,s=r.call(this,{id:n,device:a})||this;s.rawVertexGLSL=i,s.type=ne.Program,s.uniformSetters={},s.attributes=[];var l=s.device.gl;return s.descriptor=o,s.gl_program=s.device.ensureResourceExists(l.createProgram()),s.gl_shader_vert=null,s.gl_shader_frag=null,s.compileState=Pi.NeedsCompile,s.tryCompileProgram(),s}return t.prototype.destroy=function(){r.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){Bt(this.compileState===Pi.NeedsCompile);var e=this.descriptor,i=e.vertex,n=e.fragment,a=this.device.gl;i!=null&&i.glsl&&(n!=null&&n.glsl)&&(this.gl_shader_vert=this.compileShader(i.postprocess?i.postprocess(i.glsl):i.glsl,a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(n.postprocess?n.postprocess(n.glsl):n.glsl,a.FRAGMENT_SHADER),a.attachShader(this.gl_program,this.gl_shader_vert),a.attachShader(this.gl_program,this.gl_shader_frag),a.linkProgram(this.gl_program),this.compileState=Pi.Compiling,yt(a)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var e,i=this.device.gl,n=i.getProgramParameter(this.gl_program,i.ACTIVE_ATTRIBUTES),a=Ltt(this.descriptor.vertex.glsl),o=Ott(this.rawVertexGLSL,a),s=function(c){var h=i.getActiveAttrib(l.gl_program,c),f=h.name,d=h.type,v=h.size,p=i.getAttribLocation(l.gl_program,f),g=(e=o.find(function(m){return m.name===f}))===null||e===void 0?void 0:e.location;p>=0&&!kn(g)&&(l.attributes[g]={name:f,location:p,type:d,size:v})},l=this,u=0;u<n;u++)s(u)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var e=this.device.gl,i=e.getProgramParameter(this.gl_program,e.ACTIVE_UNIFORMS),n=0;n<i;n++){var a=e.getActiveUniform(this.gl_program,n),o=Att(a.name).name,s=e.getUniformLocation(this.gl_program,o);if(this.uniformSetters[o]=Yw(e,s,a),a&&a.size>1)for(var l=0;l<a.size;l++)s=e.getUniformLocation(this.gl_program,"".concat(o,"[").concat(l,"]")),this.uniformSetters["".concat(o,"[").concat(l,"]")]=Yw(e,s,a)}},t.prototype.compileShader=function(e,i){var n=this.device.gl,a=this.device.ensureResourceExists(n.createShader(i));return n.shaderSource(a,e),n.compileShader(a),a},t.prototype.setUniformsLegacy=function(e){e===void 0&&(e={});var i=this.device.gl;if(!yt(i)){var n=!1;for(var a in e){n||(i.useProgram(this.gl_program),n=!0);var o=e[a],s=this.uniformSetters[a];if(s){var l=o;l instanceof N1&&(l=l.textureIndex),s(l)}}}return this},t}(qn),Xtt=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=ne.QueryPool;var s=o.device.gl;if(yt(s)){var l=a.elemCount,u=a.type;o.gl_query=ett(l,function(){return o.device.ensureResourceExists(s.createQuery())}),o.gl_query_type=ztt(u)}return o}return t.prototype.queryResultOcclusion=function(e){var i=this.device.gl;if(yt(i)){var n=this.gl_query[e];return i.getQueryParameter(n,i.QUERY_RESULT_AVAILABLE)?!!i.getQueryParameter(n,i.QUERY_RESULT):null}return null},t.prototype.destroy=function(){r.prototype.destroy.call(this);var e=this.device.gl;if(yt(e))for(var i=0;i<this.gl_query.length;i++)e.deleteQuery(this.gl_query[i])},t}(qn),Ytt=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=r.call(this,{id:i,device:n})||this;return a.type=ne.Readback,a.gl_pbo=null,a.gl_sync=null,a}return t.prototype.clientWaitAsync=function(e,i,n){i===void 0&&(i=0),n===void 0&&(n=10);var a=this.device.gl;return new Promise(function(o,s){function l(){var u=a.clientWaitSync(e,i,0);if(u==a.WAIT_FAILED){s();return}if(u==a.TIMEOUT_EXPIRED){setTimeout(l,qJ(n,0,a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}o()}l()})},t.prototype.getBufferSubDataAsync=function(e,i,n,a,o,s){return xi(this,void 0,void 0,function(){var l;return da(this,function(u){switch(u.label){case 0:return l=this.device.gl,yt(l)?(this.gl_sync=l.fenceSync(l.SYNC_GPU_COMMANDS_COMPLETE,0),l.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return u.sent(),l.bindBuffer(e,i),l.getBufferSubData(e,n,a,o,s),l.bindBuffer(e,null),[2,a];case 2:return[2]}})})},t.prototype.readTexture=function(e,i,n,a,o,s,l,u){return l===void 0&&(l=0),u===void 0&&(u=s.byteLength||0),xi(this,void 0,void 0,function(){var c,h,f,d,v;return da(this,function(p){return c=this.device.gl,h=e,f=this.device.translateTextureFormat(h.format),d=this.device.translateTextureType(h.format),v=QJ(h.format),yt(c)?(this.gl_pbo=this.device.ensureResourceExists(c.createBuffer()),c.bindBuffer(c.PIXEL_PACK_BUFFER,this.gl_pbo),c.bufferData(c.PIXEL_PACK_BUFFER,u,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.bindFramebuffer(F.READ_FRAMEBUFFER,this.device.readbackFramebuffer),c.framebufferTexture2D(F.READ_FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,h.gl_texture,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,this.gl_pbo),c.readPixels(i,n,a,o,f,d,l*v),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(c.PIXEL_PACK_BUFFER,this.gl_pbo,0,s,l,0)]):[2,this.readTextureSync(e,i,n,a,o,s,l,u)]})})},t.prototype.readTextureSync=function(e,i,n,a,o,s,l,u){u===void 0&&(u=s.byteLength||0);var c=this.device.gl,h=e,f=this.device.translateTextureType(h.format);return c.bindFramebuffer(F.FRAMEBUFFER,this.device.readbackFramebuffer),c.framebufferTexture2D(F.FRAMEBUFFER,F.COLOR_ATTACHMENT0,F.TEXTURE_2D,h.gl_texture,0),c.pixelStorei(c.PACK_ALIGNMENT,4),c.readPixels(i,n,a,o,c.RGBA,f,s),s},t.prototype.readBuffer=function(e,i,n,a,o){return xi(this,void 0,void 0,function(){var s;return da(this,function(l){return s=this.device.gl,yt(s)?[2,this.getBufferSubDataAsync(s.ARRAY_BUFFER,ac(e,i),i,n,a,o)]:[2,Promise.reject()]})})},t.prototype.destroy=function(){r.prototype.destroy.call(this),yt(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(qn),jtt=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o,s,l=r.call(this,{id:i,device:n})||this;return l.type=ne.RenderPipeline,l.drawMode=Btt((o=a.topology)!==null&&o!==void 0?o:ar.TRIANGLES),l.program=a.program,l.inputLayout=a.inputLayout,l.megaState=S(S({},bc(wc)),a.megaStateDescriptor),l.colorAttachmentFormats=a.colorAttachmentFormats.slice(),l.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,l.sampleCount=(s=a.sampleCount)!==null&&s!==void 0?s:1,l}return t}(qn),Ztt=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;return o.type=ne.ComputePipeline,o.descriptor=a,o}return t}(qn),qtt=function(){function r(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return r.prototype.trackResourceCreated=function(t){this.creationStacks.set(t,new Error().stack),this.liveObjects.add(t)},r.prototype.trackResourceDestroyed=function(t){this.deletionStacks.has(t)&&console.warn("Object double freed:",t,`

Creation stack: `,this.creationStacks.get(t),`

Deletion stack: `,this.deletionStacks.get(t),`

This stack: `,new Error().stack),this.deletionStacks.set(t,new Error().stack),this.liveObjects.delete(t)},r.prototype.checkForLeaks=function(){var t,e;try{for(var i=qt(this.liveObjects.values()),n=i.next();!n.done;n=i.next()){var a=n.value;console.warn("Object leaked:",a,"Creation stack:",this.creationStacks.get(a))}}catch(o){t={error:o}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},r.prototype.setResourceLeakCheck=function(t,e){e?this.liveObjects.add(t):this.liveObjects.delete(t)},r}(),Ktt=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o,s,l=r.call(this,{id:i,device:n})||this;l.type=ne.Sampler;var u=l.device.gl;if(yt(u)){var c=l.device.ensureResourceExists(u.createSampler());u.samplerParameteri(c,F.TEXTURE_WRAP_S,Fh(a.addressModeU)),u.samplerParameteri(c,F.TEXTURE_WRAP_T,Fh(a.addressModeV)),u.samplerParameteri(c,F.TEXTURE_WRAP_R,Fh((o=a.addressModeW)!==null&&o!==void 0?o:a.addressModeU)),u.samplerParameteri(c,F.TEXTURE_MIN_FILTER,kv(a.minFilter,a.mipmapFilter)),u.samplerParameteri(c,F.TEXTURE_MAG_FILTER,kv(a.magFilter,gr.NO_MIP)),a.lodMinClamp!==void 0&&u.samplerParameterf(c,F.TEXTURE_MIN_LOD,a.lodMinClamp),a.lodMaxClamp!==void 0&&u.samplerParameterf(c,F.TEXTURE_MAX_LOD,a.lodMaxClamp),a.compareFunction!==void 0&&(u.samplerParameteri(c,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE),u.samplerParameteri(c,u.TEXTURE_COMPARE_FUNC,a.compareFunction));var h=(s=a.maxAnisotropy)!==null&&s!==void 0?s:1;h>1&&l.device.EXT_texture_filter_anisotropic!==null&&(Bt(a.minFilter===qe.BILINEAR&&a.magFilter===qe.BILINEAR&&a.mipmapFilter===gr.LINEAR),u.samplerParameterf(c,l.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h)),l.gl_sampler=c}else l.descriptor=a;return l}return t.prototype.setTextureParameters=function(e,i,n){var a,o=this.device.gl,s=this.descriptor;this.isNPOT(i,n)?o.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR):o.texParameteri(e,F.TEXTURE_MIN_FILTER,kv(s.minFilter,s.mipmapFilter)),o.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,Fh(s.addressModeU)),o.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,Fh(s.addressModeV)),o.texParameteri(e,F.TEXTURE_MAG_FILTER,kv(s.magFilter,gr.NO_MIP));var l=(a=s.maxAnisotropy)!==null&&a!==void 0?a:1;l>1&&this.device.EXT_texture_filter_anisotropic!==null&&(Bt(s.minFilter===qe.BILINEAR&&s.magFilter===qe.BILINEAR&&s.mipmapFilter===gr.LINEAR),o.texParameteri(e,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l))},t.prototype.destroy=function(){r.prototype.destroy.call(this),yt(this.device.gl)&&this.device.gl.deleteSampler(D1(this))},t.prototype.isNPOT=function(e,i){return!Og(e)||!Og(i)},t}(qn),Qtt=function(){function r(){}return r.prototype.dispatchWorkgroups=function(t,e,i){},r.prototype.dispatchWorkgroupsIndirect=function(t,e){},r.prototype.setPipeline=function(t){},r.prototype.setBindings=function(t){},r.prototype.pushDebugGroup=function(t){},r.prototype.popDebugGroup=function(){},r.prototype.insertDebugMarker=function(t){},r}(),Jtt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=ne.RenderBundle,e.commands=[],e}return t.prototype.push=function(e){this.commands.push(e)},t.prototype.replay=function(){this.commands.forEach(function(e){return e()})},t}(qn),Qw=65536,tet=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,eet=function(){function r(t,e){e===void 0&&(e={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=bc(wc),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=ca.LOWER_LEFT,this.clipSpaceNearZ=Ac.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=t,this.contextAttributes=_l(t.getContextAttributes()),yt(t)?(this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=t.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=t.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=t.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=t.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=t.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=t.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=t.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=t.getExtension("EXT_color_buffer_half_float"),t.getExtension("EXT_frag_depth"),t.getExtension("OES_element_index_uint"),t.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=t.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=t.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=t.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=t.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=t.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=t.getExtension("KHR_parallel_shader_compile"),yt(t)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new N1({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:jt.TEXTURE_2D,mipLevelCount:1,usage:ai.RENDER_TARGET,format:this.contextAttributes.alpha===!1?U.U8_RGB_RT:U.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=Ye.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(jt.TEXTURE_2D,Ye.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(jt.TEXTURE_2D,Ye.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:Ae.VERTEX,hint:va.STATIC}),yt(t)&&(this.fallbackTexture2DArray=this.createFallbackTexture(jt.TEXTURE_2D_ARRAY,Ye.Float),this.fallbackTexture3D=this.createFallbackTexture(jt.TEXTURE_3D,Ye.Float),this.fallbackTextureCube=this.createFallbackTexture(jt.TEXTURE_CUBE_MAP,Ye.Float)),this.currentMegaState.depthCompare=fe.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=_r.ALL,t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),this.checkLimits(),e.shaderDebug&&(this.shaderDebug=!0),e.trackResources&&(this.resourceCreationTracker=new qtt)}return r.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},r.prototype.createFallbackTexture=function(t,e){var i=t===jt.TEXTURE_CUBE_MAP?6:1,n=e===Ye.Depth?U.D32F:U.U8_RGBA_NORM,a=this.createTexture({dimension:t,format:n,usage:ai.SAMPLED,width:1,height:1,depthOrArrayLayers:i,mipLevelCount:1});return e===Ye.Float&&a.setImageData([new Uint8Array(4*i)]),Nu(a)},r.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},r.prototype.checkLimits=function(){var t=this.gl;if(this.maxVertexAttribs=t.getParameter(F.MAX_VERTEX_ATTRIBS),yt(t)){this.uniformBufferMaxPageByteSize=Math.min(t.getParameter(F.MAX_UNIFORM_BLOCK_SIZE),Qw),this.uniformBufferWordAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var e=t.getInternalformatParameter(t.RENDERBUFFER,t.DEPTH32F_STENCIL8,t.SAMPLES);this.supportedSampleCounts=e?_t([],lt(e),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=Qw;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(i,n){return i-n})},r.prototype.configureSwapChain=function(t,e,i){var n=this.scTexture;n.width=t,n.height=e,this.scPlatformFramebuffer=ttt(i)},r.prototype.getDevice=function(){return this},r.prototype.getCanvas=function(){return this.gl.canvas},r.prototype.getOnscreenTexture=function(){return this.scTexture},r.prototype.beginFrame=function(){},r.prototype.endFrame=function(){},r.prototype.translateTextureInternalFormat=function(t,e){switch(e===void 0&&(e=!1),t){case U.ALPHA:return F.ALPHA;case U.U8_LUMINANCE:case U.F16_LUMINANCE:case U.F32_LUMINANCE:return F.LUMINANCE;case U.F16_R:return F.R16F;case U.F16_RG:return F.RG16F;case U.F16_RGB:return F.RGB16F;case U.F16_RGBA:return F.RGBA16F;case U.F32_R:return F.R32F;case U.F32_RG:return F.RG32F;case U.F32_RGB:return F.RGB32F;case U.F32_RGBA:return yt(this.gl)?F.RGBA32F:e?this.WEBGL_color_buffer_float.RGBA32F_EXT:F.RGBA;case U.U8_R_NORM:return F.R8;case U.U8_RG_NORM:return F.RG8;case U.U8_RGB_NORM:case U.U8_RGB_RT:return F.RGB8;case U.U8_RGB_SRGB:return F.SRGB8;case U.U8_RGBA_NORM:case U.U8_RGBA_RT:return yt(this.gl)?F.RGBA8:e?F.RGBA4:F.RGBA;case U.U8_RGBA:return F.RGBA;case U.U8_RGBA_SRGB:case U.U8_RGBA_RT_SRGB:return F.SRGB8_ALPHA8;case U.U16_R:return F.R16UI;case U.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case U.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case U.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case U.U16_RGBA_5551:return F.RGB5_A1;case U.U16_RGB_565:return F.RGB565;case U.U32_R:return F.R32UI;case U.S8_RGBA_NORM:return F.RGBA8_SNORM;case U.S8_RG_NORM:return F.RG8_SNORM;case U.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case U.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case U.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case U.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case U.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case U.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case U.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case U.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case U.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case U.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case U.D32F_S8:return yt(this.gl)?F.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?F.DEPTH_STENCIL:F.DEPTH_COMPONENT16;case U.D24_S8:return yt(this.gl)?F.DEPTH24_STENCIL8:this.WEBGL_depth_texture?F.DEPTH_STENCIL:F.DEPTH_COMPONENT16;case U.D32F:return yt(this.gl)?F.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?F.DEPTH_COMPONENT:F.DEPTH_COMPONENT16;case U.D24:return yt(this.gl)?F.DEPTH_COMPONENT24:this.WEBGL_depth_texture?F.DEPTH_COMPONENT:F.DEPTH_COMPONENT16;default:throw new Error("whoops")}},r.prototype.translateTextureType=function(t){var e=ro(t);switch(e){case K.U8:return F.UNSIGNED_BYTE;case K.U16:return F.UNSIGNED_SHORT;case K.U32:return F.UNSIGNED_INT;case K.S8:return F.BYTE;case K.F16:return F.HALF_FLOAT;case K.F32:return F.FLOAT;case K.U16_PACKED_5551:return F.UNSIGNED_SHORT_5_5_5_1;case K.D32F:return yt(this.gl)?F.FLOAT:this.WEBGL_depth_texture?F.UNSIGNED_INT:F.UNSIGNED_BYTE;case K.D24:return yt(this.gl)?F.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?F.UNSIGNED_SHORT:F.UNSIGNED_BYTE;case K.D24S8:return yt(this.gl)?F.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?F.UNSIGNED_INT_24_8_WEBGL:F.UNSIGNED_BYTE;case K.D32FS8:return F.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},r.prototype.translateInternalTextureFormat=function(t){switch(t){case U.F32_R:return F.R32F;case U.F32_RG:return F.RG32F;case U.F32_RGB:return F.RGB32F;case U.F32_RGBA:return F.RGBA32F;case U.F16_R:return F.R16F;case U.F16_RG:return F.RG16F;case U.F16_RGB:return F.RGB16F;case U.F16_RGBA:return F.RGBA16F}return this.translateTextureFormat(t)},r.prototype.translateTextureFormat=function(t){if(wB(t)||t===U.F32_LUMINANCE||t===U.U8_LUMINANCE)return this.translateTextureInternalFormat(t);var e=yt(this.gl)||!yt(this.gl)&&!!this.WEBGL_depth_texture;switch(t){case U.D24_S8:case U.D32F_S8:return e?F.DEPTH_STENCIL:F.RGBA;case U.D24:case U.D32F:return e?F.DEPTH_COMPONENT:F.RGBA}var i=RB(t),n=OE(t);switch(n){case pt.A:return F.ALPHA;case pt.R:return i?F.RED_INTEGER:F.RED;case pt.RG:return i?F.RG_INTEGER:F.RG;case pt.RGB:return i?F.RGB_INTEGER:F.RGB;case pt.RGBA:return F.RGBA}},r.prototype.setActiveTexture=function(t){this.currentActiveTexture!==t&&(this.gl.activeTexture(t),this.currentActiveTexture=t)},r.prototype.bindVAO=function(t){this.currentBoundVAO!==t&&(yt(this.gl)?this.gl.bindVertexArray(t):this.OES_vertex_array_object.bindVertexArrayOES(t),this.currentBoundVAO=t)},r.prototype.programCompiled=function(t){Bt(t.compileState!==Pi.NeedsCompile),t.compileState===Pi.Compiling&&(t.compileState=Pi.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(t))},r.prototype.useProgram=function(t){this.currentProgram!==t&&(this.programCompiled(t),this.gl.useProgram(t.gl_program),this.currentProgram=t)},r.prototype.ensureResourceExists=function(t){if(t===null){var e=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(e))}else return t},r.prototype.createBuffer=function(t){return new $tt({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createTexture=function(t){return new N1({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createSampler=function(t){return new Ktt({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createRenderTarget=function(t){return new Vtt({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createRenderTargetFromTexture=function(t){var e=t,i=e.format,n=e.width,a=e.height,o=e.mipLevelCount;return Bt(o===1),this.createRenderTarget({format:i,width:n,height:a,sampleCount:1,texture:t})},r.prototype.createProgram=function(t){var e,i,n,a=(e=t.vertex)===null||e===void 0?void 0:e.glsl;return!((i=t.vertex)===null||i===void 0)&&i.glsl&&(t.vertex.glsl=Rc(this.queryVendorInfo(),"vert",t.vertex.glsl)),!((n=t.fragment)===null||n===void 0)&&n.glsl&&(t.fragment.glsl=Rc(this.queryVendorInfo(),"frag",t.fragment.glsl)),this.createProgramSimple(t,a)},r.prototype.createProgramSimple=function(t,e){var i=new Gtt({id:this.getNextUniqueId(),device:this,descriptor:t},e);return i},r.prototype.createBindings=function(t){return new Ptt({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createInputLayout=function(t){return new Wtt({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createRenderPipeline=function(t){return new jtt({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createComputePass=function(){return new Qtt},r.prototype.createComputePipeline=function(t){return new Ztt({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createReadback=function(){return new Ytt({id:this.getNextUniqueId(),device:this})},r.prototype.createQueryPool=function(t,e){return new Xtt({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:e}})},r.prototype.formatRenderPassDescriptor=function(t){var e,i,n,a,o,s,l=t.colorAttachment;t.depthClearValue=(e=t.depthClearValue)!==null&&e!==void 0?e:"load",t.stencilClearValue=(i=t.stencilClearValue)!==null&&i!==void 0?i:"load";for(var u=0;u<l.length;u++)t.colorAttachmentLevel||(t.colorAttachmentLevel=[]),t.colorAttachmentLevel[u]=(n=t.colorAttachmentLevel[u])!==null&&n!==void 0?n:0,t.colorResolveToLevel||(t.colorResolveToLevel=[]),t.colorResolveToLevel[u]=(a=t.colorResolveToLevel[u])!==null&&a!==void 0?a:0,t.colorClearColor||(t.colorClearColor=[]),t.colorClearColor[u]=(o=t.colorClearColor[u])!==null&&o!==void 0?o:"load",t.colorStore||(t.colorStore=[]),t.colorStore[u]=(s=t.colorStore[u])!==null&&s!==void 0?s:!1},r.prototype.createRenderBundle=function(){return new Jtt({id:this.getNextUniqueId(),device:this})},r.prototype.beginBundle=function(t){this.renderBundle=t},r.prototype.endBundle=function(){this.renderBundle=void 0},r.prototype.executeBundles=function(t){t.forEach(function(e){e.replay()})},r.prototype.createRenderPass=function(t){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=t,this.formatRenderPassDescriptor(t);var e=t.colorAttachment,i=t.colorAttachmentLevel,n=t.colorClearColor,a=t.colorResolveTo,o=t.colorResolveToLevel,s=t.depthStencilAttachment,l=t.depthClearValue,u=t.stencilClearValue,c=t.depthStencilResolveTo,h=a&&a.length===1&&a[0]===this.scTexture;this.setRenderPassParametersBegin(e.length,h);for(var f=0;f<e.length;f++)this.setRenderPassParametersColor(f,e[f],i[f],a[f],o[f],h);this.setRenderPassParametersDepthStencil(s,c,h),this.validateCurrentAttachments();for(var f=0;f<e.length;f++){var d=n[f];d!=="load"&&this.setRenderPassParametersClearColor(f,d.r,d.g,d.b,d.a)}return this.setRenderPassParametersClearDepthStencil(l,u),this},r.prototype.submitPass=function(t){Bt(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},r.prototype.copySubTexture2D=function(t,e,i,n,a,o){var s=this.gl,l=t,u=n;if(Bt(u.mipLevelCount===1),Bt(l.mipLevelCount===1),yt(s))l===this.scTexture?s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,l,0)),s.bindFramebuffer(s.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,u,0),s.blitFramebuffer(a,o,a+u.width,o+u.height,e,i,e+u.width,i+u.height,s.COLOR_BUFFER_BIT,s.LINEAR),s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null);else if(l===this.scTexture){var c=this.createRenderTargetFromTexture(n);this.submitBlitRenderPass(c,l)}},r.prototype.queryLimits=function(){return this},r.prototype.queryTextureFormatSupported=function(t,e,i){switch(t){case U.BC1_SRGB:case U.BC2_SRGB:case U.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?Zy(e,i,4,4):!1;case U.BC1:case U.BC2:case U.BC3:return this.WEBGL_compressed_texture_s3tc!==null?Zy(e,i,4,4):!1;case U.BC4_UNORM:case U.BC4_SNORM:case U.BC5_UNORM:case U.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?Zy(e,i,4,4):!1;case U.U16_R_NORM:case U.U16_RG_NORM:case U.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case U.F32_R:case U.F32_RG:case U.F32_RGB:case U.F32_RGBA:return this.OES_texture_float_linear!==null;case U.F16_R:case U.F16_RG:case U.F16_RGB:case U.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},r.prototype.queryProgramReady=function(t){var e=this.gl;if(t.compileState===Pi.NeedsCompile)throw new Error("whoops");if(t.compileState===Pi.Compiling){var i=void 0;return this.KHR_parallel_shader_compile!==null?i=e.getProgramParameter(t.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):i=!0,i&&this.programCompiled(t),i}return t.compileState===Pi.NeedsBind||t.compileState===Pi.ReadyToUse},r.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},r.prototype.queryVendorInfo=function(){return this},r.prototype.queryRenderPass=function(t){return this.currentRenderPassDescriptor},r.prototype.queryRenderTarget=function(t){var e=t;return e},r.prototype.setResourceName=function(t,e){if(t.name=e,t.type===ne.Buffer)for(var i=t.gl_buffer_pages,n=0;n<i.length;n++)Bh(i[n],"".concat(e," Page ").concat(n));else if(t.type===ne.Texture)Bh(Nu(t),e);else if(t.type===ne.Sampler)Bh(D1(t),e);else if(t.type===ne.RenderTarget){var a=t.gl_renderbuffer;a!==null&&Bh(a,e)}else t.type===ne.InputLayout&&Bh(t.vao,e)},r.prototype.setResourceLeakCheck=function(t,e){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(t,e)},r.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},r.prototype.pushDebugGroup=function(t){},r.prototype.popDebugGroup=function(){},r.prototype.insertDebugMarker=function(t){},r.prototype.programPatched=function(t,e){Bt(this.shaderDebug)},r.prototype.getBufferData=function(t,e,i){i===void 0&&(i=0);var n=this.gl;yt(n)&&(n.bindBuffer(n.COPY_READ_BUFFER,ac(t,i*4)),n.getBufferSubData(n.COPY_READ_BUFFER,i*4,e))},r.prototype.debugGroupStatisticsDrawCall=function(t){t===void 0&&(t=1);for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].drawCallCount+=t},r.prototype.debugGroupStatisticsBufferUpload=function(t){t===void 0&&(t=1);for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].bufferUploadCount+=t},r.prototype.debugGroupStatisticsTextureBind=function(t){t===void 0&&(t=1);for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].textureBindCount+=t},r.prototype.debugGroupStatisticsTriangles=function(t){for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].triangleCount+=t},r.prototype.reportShaderError=function(t,e){var i=this.gl,n=i.getShaderParameter(t,i.COMPILE_STATUS);if(!n){console.error(rtt(e));var a=i.getExtension("WEBGL_debug_shaders");a&&console.error(a.getTranslatedShaderSource(t)),console.error(i.getShaderInfoLog(t))}return n},r.prototype.checkProgramCompilationForErrors=function(t){var e=this.gl,i=t.gl_program;if(!e.getProgramParameter(i,e.LINK_STATUS)){var n=t.descriptor;if(!this.reportShaderError(t.gl_shader_vert,n.vertex.glsl)||!this.reportShaderError(t.gl_shader_frag,n.fragment.glsl))return;console.error(e.getProgramInfoLog(t.gl_program))}},r.prototype.bindFramebufferAttachment=function(t,e,i,n){var a=this.gl;if(kn(i))a.framebufferRenderbuffer(t,e,a.RENDERBUFFER,null);else if(i.type===ne.RenderTarget)i.gl_renderbuffer!==null?a.framebufferRenderbuffer(t,e,a.RENDERBUFFER,i.gl_renderbuffer):i.texture!==null&&a.framebufferTexture2D(t,e,F.TEXTURE_2D,Nu(i.texture),n);else if(i.type===ne.Texture){var o=Nu(i);i.dimension===jt.TEXTURE_2D?a.framebufferTexture2D(t,e,F.TEXTURE_2D,o,n):yt(a)&&(i.dimension,jt.TEXTURE_2D_ARRAY)}},r.prototype.bindFramebufferDepthStencilAttachment=function(t,e){var i=this.gl,n=kn(e)?ot.Depth|ot.Stencil:Tc(e.format),a=!!(n&ot.Depth),o=!!(n&ot.Stencil);if(a&&o){var s=yt(this.gl)||!yt(this.gl)&&!!this.WEBGL_depth_texture;s?this.bindFramebufferAttachment(t,i.DEPTH_STENCIL_ATTACHMENT,e,0):this.bindFramebufferAttachment(t,i.DEPTH_ATTACHMENT,e,0)}else a?(this.bindFramebufferAttachment(t,i.DEPTH_ATTACHMENT,e,0),this.bindFramebufferAttachment(t,i.STENCIL_ATTACHMENT,null,0)):o&&(this.bindFramebufferAttachment(t,i.STENCIL_ATTACHMENT,e,0),this.bindFramebufferAttachment(t,i.DEPTH_ATTACHMENT,null,0))},r.prototype.validateCurrentAttachments=function(){for(var t=-1,e=-1,i=-1,n=0;n<this.currentColorAttachments.length;n++){var a=this.currentColorAttachments[n];a!==null&&(t===-1?(t=a.sampleCount,e=a.width,i=a.height):(Bt(t===a.sampleCount),Bt(e===a.width),Bt(i===a.height)))}this.currentDepthStencilAttachment&&(t===-1?t=this.currentDepthStencilAttachment.sampleCount:(Bt(t===this.currentDepthStencilAttachment.sampleCount),Bt(e===this.currentDepthStencilAttachment.width),Bt(i===this.currentDepthStencilAttachment.height))),this.currentSampleCount=t},r.prototype.setRenderPassParametersBegin=function(t,e){e===void 0&&(e=!1);var i=this.gl;if(e)i.bindFramebuffer(F.FRAMEBUFFER,null);else if(yt(i)?i.bindFramebuffer(F.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||i.bindFramebuffer(F.FRAMEBUFFER,this.renderPassDrawFramebuffer),yt(i)?i.drawBuffers([F.COLOR_ATTACHMENT0,F.COLOR_ATTACHMENT1,F.COLOR_ATTACHMENT2,F.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([F.COLOR_ATTACHMENT0_WEBGL,F.COLOR_ATTACHMENT1_WEBGL,F.COLOR_ATTACHMENT2_WEBGL,F.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=t;n<this.currentColorAttachments.length;n++){var a=yt(i)?F.DRAW_FRAMEBUFFER:F.FRAMEBUFFER,o=yt(i)?F.COLOR_ATTACHMENT0:F.COLOR_ATTACHMENT0_WEBGL;i.framebufferRenderbuffer(a,o+n,F.RENDERBUFFER,null),i.framebufferTexture2D(a,o+n,F.TEXTURE_2D,null,0)}this.currentColorAttachments.length=t},r.prototype.setRenderPassParametersColor=function(t,e,i,n,a,o){o===void 0&&(o=!1);var s=this.gl,l=yt(s);(this.currentColorAttachments[t]!==e||this.currentColorAttachmentLevels[t]!==i)&&(this.currentColorAttachments[t]=e,this.currentColorAttachmentLevels[t]=i,!o&&(l||!l&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(l?F.DRAW_FRAMEBUFFER:F.FRAMEBUFFER,(l?F.COLOR_ATTACHMENT0:F.COLOR_ATTACHMENT0_WEBGL)+t,e,i),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[t]!==n||this.currentColorResolveToLevels[t]!==a)&&(this.currentColorResolveTos[t]=n,this.currentColorResolveToLevels[t]=a,n!==null&&(this.resolveColorAttachmentsChanged=!0))},r.prototype.setRenderPassParametersDepthStencil=function(t,e,i){i===void 0&&(i=!1);var n=this.gl;this.currentDepthStencilAttachment!==t&&(this.currentDepthStencilAttachment=t,!i&&!this.inBlitRenderPass&&this.bindFramebufferDepthStencilAttachment(yt(n)?F.DRAW_FRAMEBUFFER:F.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==e&&(this.currentDepthStencilResolveTo=e,e&&(this.resolveDepthStencilAttachmentsChanged=!0))},r.prototype.setRenderPassParametersClearColor=function(t,e,i,n,a){var o=this.gl;if(this.OES_draw_buffers_indexed!==null){var s=this.currentMegaState.attachmentsState[t];s&&s.channelWriteMask!==_r.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(t,!0,!0,!0,!0),s.channelWriteMask=_r.ALL)}else{var s=this.currentMegaState.attachmentsState[0];s&&s.channelWriteMask!==_r.ALL&&(o.colorMask(!0,!0,!0,!0),s.channelWriteMask=_r.ALL)}this.setScissorRectEnabled(!1),yt(o)?o.clearBufferfv(o.COLOR,t,[e,i,n,a]):(o.clearColor(e,i,n,a),o.clear(o.COLOR_BUFFER_BIT))},r.prototype.setRenderPassParametersClearDepthStencil=function(t,e){t===void 0&&(t="load"),e===void 0&&(e="load");var i=this.gl;t!=="load"&&(Bt(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(i.depthMask(!0),this.currentMegaState.depthWrite=!0),yt(i)?i.clearBufferfv(i.DEPTH,0,[t]):(i.clearDepth(t),i.clear(i.DEPTH_BUFFER_BIT))),e!=="load"&&(Bt(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(i.enable(i.STENCIL_TEST),i.stencilMask(255),this.currentMegaState.stencilWrite=!0),yt(i)?i.clearBufferiv(i.STENCIL,0,[e]):(i.clearStencil(e),i.clear(i.STENCIL_BUFFER_BIT)))},r.prototype.setBindings=function(t){var e=this,i;if(this.renderBundle){this.renderBundle.push(function(){return e.setBindings(t)});return}var n=this.gl,a=t,o=a.uniformBufferBindings,s=a.samplerBindings,l=a.bindingLayouts;Bt(0<l.bindingLayoutTables.length);var u=l.bindingLayoutTables[0];Bt(o.length>=u.numUniformBuffers),Bt(s.length>=u.numSamplers);for(var c=0;c<o.length;c++){var h=o[c];if(h.size!==0){var f=u.firstUniformBuffer+c,d=h.buffer,v=h.offset||0,p=h.size||d.byteSize;if(d!==this.currentUniformBuffers[f]||v!==this.currentUniformBufferByteOffsets[f]||p!==this.currentUniformBufferByteSizes[f]){var g=v%d.pageByteSize,m=d.gl_buffer_pages[v/d.pageByteSize|0];Bt(g+p<=d.pageByteSize),yt(n)&&n.bindBufferRange(n.UNIFORM_BUFFER,f,m,g,p),this.currentUniformBuffers[f]=d,this.currentUniformBufferByteOffsets[f]=v,this.currentUniformBufferByteSizes[f]=p}}}for(var c=0;c<u.numSamplers;c++){var h=s[c],y=u.firstSampler+c,_=h!==null&&h.sampler!==null?D1(h.sampler):null,x=h!==null&&h.texture!==null?Nu(h.texture):null;if(this.currentSamplers[y]!==_&&(yt(n)&&n.bindSampler(y,_),this.currentSamplers[y]=_),this.currentTextures[y]!==x){if(this.setActiveTexture(n.TEXTURE0+y),x!==null){var C=_l(h).texture,A=C.gl_target,T=C.width,w=C.height;h.texture.textureIndex=y,n.bindTexture(A,x),yt(n)||(i=h.sampler)===null||i===void 0||i.setTextureParameters(A,T,w),this.debugGroupStatisticsTextureBind()}else{var M=S(S({},h),TB),O=M.dimension,P=M.formatKind,A=Htt(O);n.bindTexture(A,this.getFallbackTexture(S({gl_target:A,formatKind:P},M)))}this.currentTextures[y]=x}}},r.prototype.setViewport=function(t,e,i,n){var a=this.gl;a.viewport(t,e,i,n)},r.prototype.setScissorRect=function(t,e,i,n){var a=this.gl;this.setScissorRectEnabled(!0),a.scissor(t,e,i,n)},r.prototype.applyAttachmentStateIndexed=function(t,e,i){var n=this.gl,a=this.OES_draw_buffers_indexed;e.channelWriteMask!==i.channelWriteMask&&(a.colorMaskiOES(t,!!(i.channelWriteMask&_r.RED),!!(i.channelWriteMask&_r.GREEN),!!(i.channelWriteMask&_r.BLUE),!!(i.channelWriteMask&_r.ALPHA)),e.channelWriteMask=i.channelWriteMask);var o=e.rgbBlendState.blendMode!==i.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==i.alphaBlendState.blendMode,s=e.rgbBlendState.blendSrcFactor!==i.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==i.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==i.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==i.alphaBlendState.blendDstFactor;(s||o)&&(es(e.rgbBlendState)&&es(e.alphaBlendState)?a.enableiOES(t,n.BLEND):es(i.rgbBlendState)&&es(i.alphaBlendState)&&a.disableiOES(t,n.BLEND)),o&&(a.blendEquationSeparateiOES(t,i.rgbBlendState.blendMode,i.alphaBlendState.blendMode),e.rgbBlendState.blendMode=i.rgbBlendState.blendMode,e.alphaBlendState.blendMode=i.alphaBlendState.blendMode),s&&(a.blendFuncSeparateiOES(t,i.rgbBlendState.blendSrcFactor,i.rgbBlendState.blendDstFactor,i.alphaBlendState.blendSrcFactor,i.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=i.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=i.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=i.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=i.alphaBlendState.blendDstFactor)},r.prototype.applyAttachmentState=function(t,e){var i=this.gl;t.channelWriteMask!==e.channelWriteMask&&(i.colorMask(!!(e.channelWriteMask&_r.RED),!!(e.channelWriteMask&_r.GREEN),!!(e.channelWriteMask&_r.BLUE),!!(e.channelWriteMask&_r.ALPHA)),t.channelWriteMask=e.channelWriteMask);var n=t.rgbBlendState.blendMode!==e.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==e.alphaBlendState.blendMode,a=t.rgbBlendState.blendSrcFactor!==e.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==e.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==e.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==e.alphaBlendState.blendDstFactor;(a||n)&&(es(t.rgbBlendState)&&es(t.alphaBlendState)?i.enable(i.BLEND):es(e.rgbBlendState)&&es(e.alphaBlendState)&&i.disable(i.BLEND)),n&&(i.blendEquationSeparate(e.rgbBlendState.blendMode,e.alphaBlendState.blendMode),t.rgbBlendState.blendMode=e.rgbBlendState.blendMode,t.alphaBlendState.blendMode=e.alphaBlendState.blendMode),a&&(i.blendFuncSeparate(e.rgbBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor,e.alphaBlendState.blendSrcFactor,e.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=e.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=e.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=e.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=e.alphaBlendState.blendDstFactor)},r.prototype.setMegaState=function(t){var e=this.gl,i=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var n=0;n<t.attachmentsState.length;n++)this.applyAttachmentStateIndexed(n,i.attachmentsState[0],t.attachmentsState[0]);else Bt(t.attachmentsState.length===1),this.applyAttachmentState(i.attachmentsState[0],t.attachmentsState[0]);xB(i.blendConstant,t.blendConstant)||(e.blendColor(t.blendConstant.r,t.blendConstant.g,t.blendConstant.b,t.blendConstant.a),CB(i.blendConstant,t.blendConstant)),i.depthCompare!==t.depthCompare&&(e.depthFunc(t.depthCompare),i.depthCompare=t.depthCompare),!!i.depthWrite!=!!t.depthWrite&&(e.depthMask(t.depthWrite),i.depthWrite=t.depthWrite),!!i.stencilWrite!=!!t.stencilWrite&&(e.stencilMask(t.stencilWrite?255:0),i.stencilWrite=t.stencilWrite);var a=!1;if(!Bg(i.stencilFront,t.stencilFront)){a=!0;var o=t.stencilFront,s=o.passOp,l=o.failOp,u=o.depthFailOp,c=o.compare;(i.stencilFront.passOp!==s||i.stencilFront.failOp!==l||i.stencilFront.depthFailOp!==u)&&(e.stencilOpSeparate(e.FRONT,l,u,s),i.stencilFront.passOp=s,i.stencilFront.failOp=l,i.stencilFront.depthFailOp=u),i.stencilFront.compare!==c&&(this.setStencilReference(0),i.stencilFront.compare=c)}if(!Bg(i.stencilBack,t.stencilBack)){a=!0;var h=t.stencilBack,s=h.passOp,l=h.failOp,u=h.depthFailOp,c=h.compare;(i.stencilBack.passOp!==s||i.stencilBack.failOp!==l||i.stencilBack.depthFailOp!==u)&&(e.stencilOpSeparate(e.BACK,l,u,s),i.stencilBack.passOp=s,i.stencilBack.failOp=l,i.stencilBack.depthFailOp=u),i.stencilBack.compare!==c&&(this.setStencilReference(0),i.stencilBack.compare=c)}(i.stencilFront.mask!==t.stencilFront.mask||i.stencilBack.mask!==t.stencilBack.mask)&&(a=!0,i.stencilFront.mask=t.stencilFront.mask,i.stencilBack.mask=t.stencilBack.mask),a&&this.applyStencil(),i.cullMode!==t.cullMode&&(i.cullMode===ki.NONE?e.enable(e.CULL_FACE):t.cullMode===ki.NONE&&e.disable(e.CULL_FACE),t.cullMode===ki.BACK?e.cullFace(e.BACK):t.cullMode===ki.FRONT?e.cullFace(e.FRONT):t.cullMode===ki.FRONT_AND_BACK&&e.cullFace(e.FRONT_AND_BACK),i.cullMode=t.cullMode),i.frontFace!==t.frontFace&&(e.frontFace(t.frontFace),i.frontFace=t.frontFace),i.polygonOffset!==t.polygonOffset&&(t.polygonOffset?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),i.polygonOffset=t.polygonOffset),(i.polygonOffsetFactor!==t.polygonOffsetFactor||i.polygonOffsetUnits!==t.polygonOffsetUnits)&&(e.polygonOffset(t.polygonOffsetFactor,t.polygonOffsetUnits),i.polygonOffsetFactor=t.polygonOffsetFactor,i.polygonOffsetUnits=t.polygonOffsetUnits)},r.prototype.validatePipelineFormats=function(t){for(var e=0;e<this.currentColorAttachments.length;e++)var i=this.currentColorAttachments[e];this.currentDepthStencilAttachment&&Bt(this.currentDepthStencilAttachment.format===t.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&Bt(this.currentSampleCount===t.sampleCount)},r.prototype.setPipeline=function(t){var e=this;if(this.renderBundle){this.renderBundle.push(function(){return e.setPipeline(t)});return}this.currentPipeline=t,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var i=this.currentPipeline.program;if(this.useProgram(i),i.compileState===Pi.NeedsBind){var n=this.gl,a=i.gl_program,o=i.descriptor,s=Kw(o.vertex.glsl,tet);if(yt(n))for(var l=0;l<s.length;l++){var u=lt(s[l],2),c=u[1],h=n.getUniformBlockIndex(a,c);h!==-1&&h!==4294967295&&n.uniformBlockBinding(a,h,l)}for(var f=Kw(o.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),l=0;l<f.length;l++){var d=lt(f[l],3),v=d[1],p=d[2],g=n.getUniformLocation(a,v);n.uniform1i(g,parseInt(p))}i.compileState=Pi.ReadyToUse}},r.prototype.setVertexInput=function(t,e,i){var n,a,o=this,s;if(this.renderBundle){this.renderBundle.push(function(){return o.setVertexInput(t,e,i)});return}if(t!==null){Bt(this.currentPipeline.inputLayout===t);var l=t;this.bindVAO(l.vao);for(var u=this.gl,c=0;c<l.vertexBufferDescriptors.length;c++){var h=l.vertexBufferDescriptors[c],f=h.arrayStride,d=h.attributes;try{for(var v=(n=void 0,qt(d)),p=v.next();!p.done;p=v.next()){var g=p.value,m=g.shaderLocation,y=g.offset,_=yt(u)?m:(s=l.program.attributes[m])===null||s===void 0?void 0:s.location;if(!kn(_)){var x=e[c];if(x===null)continue;var C=g.vertexFormat;u.bindBuffer(u.ARRAY_BUFFER,ac(x.buffer));var A=(x.offset||0)+y;u.vertexAttribPointer(_,C.size,C.type,C.normalized,f,A)}}}catch(w){n={error:w}}finally{try{p&&!p.done&&(a=v.return)&&a.call(v)}finally{if(n)throw n.error}}}if(Bt(i!==null==(l.indexBufferFormat!==null)),i!==null){var T=i.buffer;Bt(T.usage===Ae.INDEX),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,ac(T)),this.currentIndexBufferByteOffset=i.offset||0}else this.currentIndexBufferByteOffset=null}else Bt(this.currentPipeline.inputLayout===null),Bt(i===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},r.prototype.setStencilReference=function(t){this.currentStencilRef!==t&&(this.currentStencilRef=t,this.applyStencil())},r.prototype.draw=function(t,e,i,n){var a,o=this;if(this.renderBundle){this.renderBundle.push(function(){return o.draw(t,e,i,n)});return}var s=this.gl,l=this.currentPipeline;if(e){var u=[l.drawMode,i||0,t,e];yt(s)?s.drawArraysInstanced.apply(s,_t([],lt(u),!1)):(a=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(a,_t([],lt(u),!1))}else s.drawArrays(l.drawMode,i,t);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(e,1))},r.prototype.drawIndexed=function(t,e,i,n,a){var o,s=this;if(this.renderBundle){this.renderBundle.push(function(){return s.drawIndexed(t,e,i,n,a)});return}var l=this.gl,u=this.currentPipeline,c=_l(u.inputLayout),h=_l(this.currentIndexBufferByteOffset)+i*c.indexBufferCompByteSize;if(e){var f=[u.drawMode,t,c.indexBufferType,h,e];yt(l)?l.drawElementsInstanced.apply(l,_t([],lt(f),!1)):(o=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(o,_t([],lt(f),!1))}else l.drawElements(u.drawMode,t,c.indexBufferType,h);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(e,1))},r.prototype.drawIndirect=function(t,e){},r.prototype.drawIndexedIndirect=function(t,e){},r.prototype.beginOcclusionQuery=function(t){var e=this.gl;if(yt(e)){var i=this.currentRenderPassDescriptor.occlusionQueryPool;e.beginQuery(i.gl_query_type,i.gl_query[t])}},r.prototype.endOcclusionQuery=function(){var t=this.gl;if(yt(t)){var e=this.currentRenderPassDescriptor.occlusionQueryPool;t.endQuery(e.gl_query_type)}},r.prototype.pipelineQueryReady=function(t){var e=t;return this.queryProgramReady(e.program)},r.prototype.pipelineForceReady=function(t){},r.prototype.endPass=function(){for(var t=this.gl,e=yt(t),i=this.currentColorResolveTos.length===1&&this.currentColorResolveTos[0]===this.scTexture,n=!1,a=0;a<this.currentColorAttachments.length;a++){var o=this.currentColorAttachments[a];if(o!==null){var s=this.currentColorResolveTos[a],l=!1;s!==null&&(Bt(o.width===s.width&&o.height===s.height),this.setScissorRectEnabled(!1),i||(e&&t.bindFramebuffer(t.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&e&&this.bindFramebufferAttachment(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[a])),l=!0,i||(s===this.scTexture?t.bindFramebuffer(e?F.DRAW_FRAMEBUFFER:F.FRAMEBUFFER,this.scPlatformFramebuffer):(t.bindFramebuffer(e?F.DRAW_FRAMEBUFFER:F.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&t.framebufferTexture2D(e?F.DRAW_FRAMEBUFFER:F.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s.gl_texture,this.currentColorResolveToLevels[a]))),i||(e?(t.blitFramebuffer(0,0,o.width,o.height,0,0,s.width,s.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(o,s)),n=!0),this.currentRenderPassDescriptor.colorStore[a]||!i&&!l&&(t.bindFramebuffer(e?F.READ_FRAMEBUFFER:F.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(e?F.READ_FRAMEBUFFER:F.FRAMEBUFFER,t.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[a])),i||t.bindFramebuffer(e?F.READ_FRAMEBUFFER:F.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var u=this.currentDepthStencilAttachment;if(u){var c=this.currentDepthStencilResolveTo,l=!1;c&&(Bt(u.width===c.width&&u.height===c.height),this.setScissorRectEnabled(!1),i||(t.bindFramebuffer(e?F.READ_FRAMEBUFFER:F.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),t.bindFramebuffer(e?F.DRAW_FRAMEBUFFER:F.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(e?F.READ_FRAMEBUFFER:F.FRAMEBUFFER,u),this.bindFramebufferDepthStencilAttachment(e?F.DRAW_FRAMEBUFFER:F.FRAMEBUFFER,c))),l=!0,i||(e&&t.blitFramebuffer(0,0,u.width,u.height,0,0,c.width,c.height,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(e?F.DRAW_FRAMEBUFFER:F.FRAMEBUFFER,null)),n=!0),!i&&!this.currentRenderPassDescriptor.depthStencilStore&&(l||(t.bindFramebuffer(e?F.READ_FRAMEBUFFER:F.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(e?F.READ_FRAMEBUFFER:F.FRAMEBUFFER,u),l=!0),e&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[t.DEPTH_STENCIL_ATTACHMENT])),!i&&l&&t.bindFramebuffer(e?F.READ_FRAMEBUFFER:F.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}!i&&!n&&t.bindFramebuffer(e?F.DRAW_FRAMEBUFFER:F.FRAMEBUFFER,null)},r.prototype.setScissorRectEnabled=function(t){if(this.currentScissorEnabled!==t){var e=this.gl;t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.currentScissorEnabled=t}},r.prototype.applyStencil=function(){kn(this.currentStencilRef)||(this.gl.stencilFuncSeparate(F.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(F.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},r.prototype.getFallbackTexture=function(t){var e=t.gl_target,i=t.formatKind;if(e===F.TEXTURE_2D)return i===Ye.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(e===F.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(e===F.TEXTURE_3D)return this.fallbackTexture3D;if(e===F.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},r.prototype.submitBlitRenderPass=function(t,e){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:Ae.VERTEX|Ae.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:Vl.VERTEX,attributes:[{format:U.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:ar.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[U.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:bc(wc)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:t.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:t}));var i=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var n=this.createRenderPass({colorAttachment:[t],colorResolveTo:[e],colorClearColor:[JJ]}),a=this.getCanvas(),o=a.width,s=a.height;n.setPipeline(this.blitRenderPipeline),n.setBindings(this.blitBindings),n.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),n.setViewport(0,0,o,s),this.gl.disable(this.gl.BLEND),n.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=i,this.inBlitRenderPass=!1},r}(),ret=function(){function r(t){this.pluginOptions=t}return r.prototype.createSwapChain=function(t){return xi(this,void 0,void 0,function(){var e,i,n,a,o,s,l,u,c,h,f,d,v;return da(this,function(p){return e=this.pluginOptions,i=e.targets,n=e.xrCompatible,a=e.antialias,o=a===void 0?!1:a,s=e.preserveDrawingBuffer,l=s===void 0?!1:s,u=e.premultipliedAlpha,c=u===void 0?!0:u,h=e.shaderDebug,f=e.trackResources,d={antialias:o,preserveDrawingBuffer:l,stencil:!0,premultipliedAlpha:c,xrCompatible:n},this.handleContextEvents(t),i.includes("webgl2")&&(v=t.getContext("webgl2",d)||t.getContext("experimental-webgl2",d)),!v&&i.includes("webgl1")&&(v=t.getContext("webgl",d)||t.getContext("experimental-webgl",d)),[2,new eet(v,{shaderDebug:h,trackResources:f})]})})},r.prototype.handleContextEvents=function(t){var e=this.pluginOptions,i=e.onContextLost,n=e.onContextRestored,a=e.onContextCreationError;a&&t.addEventListener("webglcontextcreationerror",a,!1),i&&t.addEventListener("webglcontextlost",i,!1),n&&t.addEventListener("webglcontextrestored",n,!1)},r}();let Xe;const MB=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&MB.decode();let ef=null;function Yp(){return(ef===null||ef.byteLength===0)&&(ef=new Uint8Array(Xe.memory.buffer)),ef}function Dg(r,t){return r=r>>>0,MB.decode(Yp().subarray(r,r+t))}const Eo=new Array(128).fill(void 0);Eo.push(void 0,null,!0,!1);let mf=Eo.length;function iet(r){mf===Eo.length&&Eo.push(Eo.length+1);const t=mf;return mf=Eo[t],Eo[t]=r,t}function jp(r){return Eo[r]}function net(r){r<132||(Eo[r]=mf,mf=r)}function aet(r){const t=jp(r);return net(r),t}let Mc=0;const Zp=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},oet=typeof Zp.encodeInto=="function"?function(r,t){return Zp.encodeInto(r,t)}:function(r,t){const e=Zp.encode(r);return t.set(e),{read:r.length,written:e.length}};function Ng(r,t,e){if(e===void 0){const s=Zp.encode(r),l=t(s.length,1)>>>0;return Yp().subarray(l,l+s.length).set(s),Mc=s.length,l}let i=r.length,n=t(i,1)>>>0;const a=Yp();let o=0;for(;o<i;o++){const s=r.charCodeAt(o);if(s>127)break;a[n+o]=s}if(o!==i){o!==0&&(r=r.slice(o)),n=e(n,i,i=o+r.length*3,1)>>>0;const s=Yp().subarray(n+o,n+i),l=oet(r,s);o+=l.written}return Mc=o,n}let rf=null;function kg(){return(rf===null||rf.byteLength===0)&&(rf=new Int32Array(Xe.memory.buffer)),rf}function set(r,t,e){let i,n;try{const s=Xe.__wbindgen_add_to_stack_pointer(-16),l=Ng(r,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),u=Mc,c=Ng(t,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),h=Mc;Xe.glsl_compile(s,l,u,c,h,e);var a=kg()[s/4+0],o=kg()[s/4+1];return i=a,n=o,Dg(a,o)}finally{Xe.__wbindgen_add_to_stack_pointer(16),Xe.__wbindgen_free(i,n,1)}}class Gf{static __wrap(t){t=t>>>0;const e=Object.create(Gf.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();Xe.__wbg_wgslcomposer_free(t)}constructor(){const t=Xe.wgslcomposer_new();return Gf.__wrap(t)}load_composable(t){const e=Ng(t,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),i=Mc;Xe.wgslcomposer_load_composable(this.__wbg_ptr,e,i)}wgsl_compile(t){let e,i;try{const o=Xe.__wbindgen_add_to_stack_pointer(-16),s=Ng(t,Xe.__wbindgen_malloc,Xe.__wbindgen_realloc),l=Mc;Xe.wgslcomposer_wgsl_compile(o,this.__wbg_ptr,s,l);var n=kg()[o/4+0],a=kg()[o/4+1];return e=n,i=a,Dg(n,a)}finally{Xe.__wbindgen_add_to_stack_pointer(16),Xe.__wbindgen_free(e,i,1)}}}async function uet(r,t){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,t)}catch(i){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const e=await r.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(r,t);return e instanceof WebAssembly.Instance?{instance:e,module:r}:e}}function cet(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(t,e){const i=Dg(t,e);return iet(i)},r.wbg.__wbindgen_object_drop_ref=function(t){aet(t)},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(t){console.log(jp(t))},r.wbg.__wbg_log_576ca876af0d4a77=function(t,e){console.log(jp(t),jp(e))},r.wbg.__wbindgen_throw=function(t,e){throw new Error(Dg(t,e))},r}function het(r,t){return Xe=r.exports,IB.__wbindgen_wasm_module=t,rf=null,ef=null,Xe}async function IB(r){if(Xe!==void 0)return Xe;const t=cet();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:e,module:i}=await uet(await r,t);return het(e,i)}var vr;(function(r){r[r.COPY_SRC=1]="COPY_SRC",r[r.COPY_DST=2]="COPY_DST",r[r.TEXTURE_BINDING=4]="TEXTURE_BINDING",r[r.STORAGE_BINDING=8]="STORAGE_BINDING",r[r.STORAGE=8]="STORAGE",r[r.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(vr||(vr={}));var k1;(function(r){r[r.READ=1]="READ",r[r.WRITE=2]="WRITE"})(k1||(k1={}));function fet(r){var t=0;return r&ai.SAMPLED&&(t|=vr.TEXTURE_BINDING|vr.COPY_DST|vr.COPY_SRC),r&ai.STORAGE&&(t|=vr.TEXTURE_BINDING|vr.STORAGE_BINDING|vr.COPY_SRC|vr.COPY_DST),r&ai.RENDER_TARGET&&(t|=vr.RENDER_ATTACHMENT|vr.TEXTURE_BINDING|vr.COPY_SRC|vr.COPY_DST),t}function FE(r){if(r===U.U8_R_NORM)return"r8unorm";if(r===U.S8_R_NORM)return"r8snorm";if(r===U.U8_RG_NORM)return"rg8unorm";if(r===U.S8_RG_NORM)return"rg8snorm";if(r===U.U32_R)return"r32uint";if(r===U.S32_R)return"r32sint";if(r===U.F32_R)return"r32float";if(r===U.U16_RG)return"rg16uint";if(r===U.S16_RG)return"rg16sint";if(r===U.F16_RG)return"rg16float";if(r===U.U8_RGBA_RT)return"bgra8unorm";if(r===U.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(r===U.U8_RGBA_NORM)return"rgba8unorm";if(r===U.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(r===U.S8_RGBA_NORM)return"rgba8snorm";if(r===U.U32_RG)return"rg32uint";if(r===U.S32_RG)return"rg32sint";if(r===U.F32_RG)return"rg32float";if(r===U.U16_RGBA)return"rgba16uint";if(r===U.S16_RGBA)return"rgba16sint";if(r===U.F16_RGBA)return"rgba16float";if(r===U.F32_RGBA)return"rgba32float";if(r===U.U32_RGBA)return"rgba32uint";if(r===U.S32_RGBA)return"rgba32sint";if(r===U.D24)return"depth24plus";if(r===U.D24_S8)return"depth24plus-stencil8";if(r===U.D32F)return"depth32float";if(r===U.D32F_S8)return"depth32float-stencil8";if(r===U.BC1)return"bc1-rgba-unorm";if(r===U.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(r===U.BC2)return"bc2-rgba-unorm";if(r===U.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(r===U.BC3)return"bc3-rgba-unorm";if(r===U.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(r===U.BC4_SNORM)return"bc4-r-snorm";if(r===U.BC4_UNORM)return"bc4-r-unorm";if(r===U.BC5_SNORM)return"bc5-rg-snorm";if(r===U.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function det(r){if(r===jt.TEXTURE_2D)return"2d";if(r===jt.TEXTURE_CUBE_MAP)return"2d";if(r===jt.TEXTURE_2D_ARRAY)return"2d";if(r===jt.TEXTURE_3D)return"3d";throw new Error("whoops")}function vet(r){if(r===jt.TEXTURE_2D)return"2d";if(r===jt.TEXTURE_CUBE_MAP)return"cube";if(r===jt.TEXTURE_2D_ARRAY)return"2d-array";if(r===jt.TEXTURE_3D)return"3d";throw new Error("whoops")}function pet(r){var t=0;return r&Ae.INDEX&&(t|=GPUBufferUsage.INDEX),r&Ae.VERTEX&&(t|=GPUBufferUsage.VERTEX),r&Ae.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),r&Ae.STORAGE&&(t|=GPUBufferUsage.STORAGE),r&Ae.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),r&Ae.INDIRECT&&(t|=GPUBufferUsage.INDIRECT),t|=GPUBufferUsage.COPY_DST,t}function qy(r){if(r===Ci.CLAMP_TO_EDGE)return"clamp-to-edge";if(r===Ci.REPEAT)return"repeat";if(r===Ci.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function Jw(r){if(r===qe.BILINEAR)return"linear";if(r===qe.POINT)return"nearest";throw new Error("whoops")}function get(r){if(r===gr.LINEAR)return"linear";if(r===gr.NEAREST)return"nearest";if(r===gr.NO_MIP)return"nearest";throw new Error("whoops")}function Xu(r){var t=r;return t.gpuBuffer}function met(r){var t=r;return t.gpuSampler}function yet(r){var t=r;return t.querySet}function _et(r){if(r===Lg.OcclusionConservative)return"occlusion";throw new Error("whoops")}function xet(r){switch(r){case ar.TRIANGLES:return"triangle-list";case ar.POINTS:return"point-list";case ar.TRIANGLE_STRIP:return"triangle-strip";case ar.LINES:return"line-list";case ar.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function Cet(r){if(r===ki.NONE)return"none";if(r===ki.FRONT)return"front";if(r===ki.BACK)return"back";throw new Error("whoops")}function Eet(r){if(r===Vf.CCW)return"ccw";if(r===Vf.CW)return"cw";throw new Error("whoops")}function Aet(r,t){return{topology:xet(r),cullMode:Cet(t.cullMode),frontFace:Eet(t.frontFace)}}function tR(r){if(r===Yt.ZERO)return"zero";if(r===Yt.ONE)return"one";if(r===Yt.SRC)return"src";if(r===Yt.ONE_MINUS_SRC)return"one-minus-src";if(r===Yt.DST)return"dst";if(r===Yt.ONE_MINUS_DST)return"one-minus-dst";if(r===Yt.SRC_ALPHA)return"src-alpha";if(r===Yt.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(r===Yt.DST_ALPHA)return"dst-alpha";if(r===Yt.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(r===Yt.CONST)return"constant";if(r===Yt.ONE_MINUS_CONSTANT)return"one-minus-constant";if(r===Yt.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function Tet(r){if(r===Sr.ADD)return"add";if(r===Sr.SUBSTRACT)return"subtract";if(r===Sr.REVERSE_SUBSTRACT)return"reverse-subtract";if(r===Sr.MIN)return"min";if(r===Sr.MAX)return"max";throw new Error("whoops")}function eR(r){return{operation:Tet(r.blendMode),srcFactor:tR(r.blendSrcFactor),dstFactor:tR(r.blendDstFactor)}}function rR(r){return r.blendMode===Sr.ADD&&r.blendSrcFactor===Yt.ONE&&r.blendDstFactor===Yt.ZERO}function bet(r){if(!(rR(r.rgbBlendState)&&rR(r.alphaBlendState)))return{color:eR(r.rgbBlendState),alpha:eR(r.alphaBlendState)}}function wet(r,t){return{format:FE(t),blend:bet(r),writeMask:r.channelWriteMask}}function Ret(r,t){return t.attachmentsState.map(function(e,i){return wet(e,r[i])})}function qp(r){if(r===fe.NEVER)return"never";if(r===fe.LESS)return"less";if(r===fe.EQUAL)return"equal";if(r===fe.LEQUAL)return"less-equal";if(r===fe.GREATER)return"greater";if(r===fe.NOTEQUAL)return"not-equal";if(r===fe.GEQUAL)return"greater-equal";if(r===fe.ALWAYS)return"always";throw new Error("whoops")}function Ru(r){if(r===je.KEEP)return"keep";if(r===je.REPLACE)return"replace";if(r===je.ZERO)return"zero";if(r===je.DECREMENT_CLAMP)return"decrement-clamp";if(r===je.DECREMENT_WRAP)return"decrement-wrap";if(r===je.INCREMENT_CLAMP)return"increment-clamp";if(r===je.INCREMENT_WRAP)return"increment-wrap";if(r===je.INVERT)return"invert";throw new Error("whoops")}function Met(r,t){if(!kn(r))return{format:FE(r),depthWriteEnabled:!!t.depthWrite,depthCompare:qp(t.depthCompare),depthBias:t.polygonOffset?t.polygonOffsetUnits:0,depthBiasSlopeScale:t.polygonOffset?t.polygonOffsetFactor:0,stencilFront:{compare:qp(t.stencilFront.compare),passOp:Ru(t.stencilFront.passOp),failOp:Ru(t.stencilFront.failOp),depthFailOp:Ru(t.stencilFront.depthFailOp)},stencilBack:{compare:qp(t.stencilBack.compare),passOp:Ru(t.stencilBack.passOp),failOp:Ru(t.stencilBack.failOp),depthFailOp:Ru(t.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}function Iet(r){if(r!==null){if(r===U.U16_R)return"uint16";if(r===U.U32_R)return"uint32";throw new Error("whoops")}}function Let(r){if(r===Vl.VERTEX)return"vertex";if(r===Vl.INSTANCE)return"instance";throw new Error("whoops")}function Oet(r){if(r===U.U8_R)return"uint8x2";if(r===U.U8_RG)return"uint8x2";if(r===U.U8_RGB)return"uint8x4";if(r===U.U8_RGBA)return"uint8x4";if(r===U.U8_RG_NORM)return"unorm8x2";if(r===U.U8_RGBA_NORM)return"unorm8x4";if(r===U.S8_RGB_NORM)return"snorm8x4";if(r===U.S8_RGBA_NORM)return"snorm8x4";if(r===U.U16_RG_NORM)return"unorm16x2";if(r===U.U16_RGBA_NORM)return"unorm16x4";if(r===U.S16_RG_NORM)return"snorm16x2";if(r===U.S16_RGBA_NORM)return"snorm16x4";if(r===U.S16_RG)return"uint16x2";if(r===U.F16_RG)return"float16x2";if(r===U.F16_RGBA)return"float16x4";if(r===U.F32_R)return"float32";if(r===U.F32_RG)return"float32x2";if(r===U.F32_RGB)return"float32x3";if(r===U.F32_RGBA)return"float32x4";throw"whoops"}function Pet(r){var t=ro(r);switch(t){case K.BC1:case K.BC2:case K.BC3:case K.BC4_SNORM:case K.BC4_UNORM:case K.BC5_SNORM:case K.BC5_UNORM:return!0;default:return!1}}function Fet(r){var t=ro(r);switch(t){case K.BC1:case K.BC2:case K.BC3:case K.BC4_SNORM:case K.BC4_UNORM:case K.BC5_SNORM:case K.BC5_UNORM:return 4;default:return 1}}function iR(r,t,e,i){switch(e===void 0&&(e=!1),r){case U.S8_R:case U.S8_R_NORM:case U.S8_RG_NORM:case U.S8_RGB_NORM:case U.S8_RGBA_NORM:{var n=t instanceof ArrayBuffer?new Int8Array(t):new Int8Array(t);return i&&n.set(new Int8Array(i)),n}case U.U8_R:case U.U8_R_NORM:case U.U8_RG:case U.U8_RG_NORM:case U.U8_RGB:case U.U8_RGB_NORM:case U.U8_RGB_SRGB:case U.U8_RGBA:case U.U8_RGBA_NORM:case U.U8_RGBA_SRGB:{var a=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return i&&a.set(new Uint8Array(i)),a}case U.S16_R:case U.S16_RG:case U.S16_RG_NORM:case U.S16_RGB_NORM:case U.S16_RGBA:case U.S16_RGBA_NORM:{var o=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(e?t/2:t);return i&&o.set(new Int16Array(i)),o}case U.U16_R:case U.U16_RGB:case U.U16_RGBA_5551:case U.U16_RGBA_NORM:case U.U16_RG_NORM:case U.U16_R_NORM:{var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(e?t/2:t);return i&&s.set(new Uint16Array(i)),s}case U.S32_R:{var l=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(e?t/4:t);return i&&l.set(new Int32Array(i)),l}case U.U32_R:case U.U32_RG:{var u=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(e?t/4:t);return i&&u.set(new Uint32Array(i)),u}case U.F32_R:case U.F32_RG:case U.F32_RGB:case U.F32_RGBA:{var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(e?t/4:t);return i&&c.set(new Float32Array(i)),c}}var h=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return i&&h.set(new Uint8Array(i)),h}function Bet(r){var t=(r&32768)>>15,e=(r&31744)>>10,i=r&1023;return e===0?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):e==31?i?NaN:(t?-1:1)*(1/0):(t?-1:1)*Math.pow(2,e-15)*(1+i/Math.pow(2,10))}function LB(r){switch(r){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}}var ba=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=r.call(this)||this;return a.id=i,a.device=n,a}return t.prototype.destroy=function(){},t}(gB),Det=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o,s,l=r.call(this,{id:i,device:n})||this;l.type=ne.Bindings;var u=a.pipeline;Bt(!!u);var c=a.uniformBufferBindings,h=a.storageBufferBindings,f=a.samplerBindings,d=a.storageTextureBindings;l.numUniformBuffers=(c==null?void 0:c.length)||0;var v=[[],[],[],[]],p=0;if(c&&c.length)for(var g=0;g<c.length;g++){var m=a.uniformBufferBindings[g],y=m.binding,_=m.size,x=m.offset,C=m.buffer,A={buffer:Xu(C),offset:x??0,size:_};v[0].push({binding:y??p++,resource:A})}if(f&&f.length){p=0;for(var g=0;g<f.length;g++){var T=S(S({},f[g]),TB),y=a.samplerBindings[g],w=y.texture!==null?y.texture:l.device.getFallbackTexture(T);T.dimension=w.dimension,T.formatKind=_B(w.format);var M=w.gpuTextureView;if(v[1].push({binding:(o=y.textureBinding)!==null&&o!==void 0?o:p++,resource:M}),y.samplerBinding!==-1){var O=y.sampler!==null?y.sampler:l.device.getFallbackSampler(T),P=met(O);v[1].push({binding:(s=y.samplerBinding)!==null&&s!==void 0?s:p++,resource:P})}}}if(h&&h.length){p=0;for(var g=0;g<h.length;g++){var D=a.storageBufferBindings[g],y=D.binding,_=D.size,x=D.offset,C=D.buffer,A={buffer:Xu(C),offset:x??0,size:_};v[2].push({binding:y??p++,resource:A})}}if(d&&d.length){p=0;for(var g=0;g<d.length;g++){var z=a.storageTextureBindings[g],y=z.binding,w=z.texture,M=w.gpuTextureView;v[3].push({binding:y??p++,resource:M})}}var Y=v.findLastIndex(function(H){return!!H.length});return l.gpuBindGroup=v.map(function(H,N){return N<=Y&&l.device.device.createBindGroup({layout:u.getBindGroupLayout(N),entries:H})}),l}return t}(ba),Net=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=ne.Buffer;var s=a.usage,l=a.viewOrSize,u=!!(s&Ae.MAP_READ);o.usage=pet(s),u&&(o.usage=Ae.MAP_READ|Ae.COPY_DST);var c=!Vu(l);if(o.view=Vu(l)?null:l,o.size=Vu(l)?Pg(l,4):Pg(l.byteLength,4),Vu(l))o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:u?c:!1});else{o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!0});var h=l&&l.constructor||Float32Array;new h(o.gpuBuffer.getMappedRange()).set(l),o.gpuBuffer.unmap()}return o}return t.prototype.setSubData=function(e,i,n,a){n===void 0&&(n=0),a===void 0&&(a=0);var o=this.gpuBuffer;a=a||i.byteLength,a=Math.min(a,this.size-e);var s=i.byteOffset+n,l=s+a,u=a+3&-4;if(u!==a){var c=new Uint8Array(i.buffer.slice(s,l));i=new Uint8Array(u),i.set(c),n=0,s=0,l=u,a=u}for(var h=1024*1024*15,f=0;l-(s+f)>h;)this.device.device.queue.writeBuffer(o,e+f,i.buffer,s+f,h),f+=h;this.device.device.queue.writeBuffer(o,e+f,i.buffer,s+f,a-f)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(ba),nR=function(){function r(){this.gpuComputePassEncoder=null}return r.prototype.dispatchWorkgroups=function(t,e,i){this.gpuComputePassEncoder.dispatchWorkgroups(t,e,i)},r.prototype.dispatchWorkgroupsIndirect=function(t,e){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(t.gpuBuffer,e)},r.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},r.prototype.beginComputePass=function(t){Bt(this.gpuComputePassEncoder===null),this.frameCommandEncoder=t,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},r.prototype.setPipeline=function(t){var e=t,i=_l(e.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(i)},r.prototype.setBindings=function(t){var e=this,i=t;i.gpuBindGroup.forEach(function(n,a){n&&e.gpuComputePassEncoder.setBindGroup(a,i.gpuBindGroup[a])})},r.prototype.pushDebugGroup=function(t){this.gpuComputePassEncoder.pushDebugGroup(t)},r.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},r.prototype.insertDebugMarker=function(t){this.gpuComputePassEncoder.insertDebugMarker(t)},r}(),ket=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=ne.ComputePipeline,o.gpuComputePipeline=null,o.descriptor=a;var s=a.program,l=s.computeStage;if(l===null)return o;var u={layout:"auto",compute:S({},l)};return o.gpuComputePipeline=o.device.device.createComputePipeline(u),o.name!==void 0&&(o.gpuComputePipeline.label=o.name),o}return t.prototype.getBindGroupLayout=function(e){return this.gpuComputePipeline.getBindGroupLayout(e)},t}(ba),Uet=function(r){B(t,r);function t(e){var i,n,a,o,s=e.id,l=e.device,u=e.descriptor,c=r.call(this,{id:s,device:l})||this;c.type=ne.InputLayout;var h=[];try{for(var f=qt(u.vertexBufferDescriptors),d=f.next();!d.done;d=f.next()){var v=d.value,p=v.arrayStride,g=v.stepMode,m=v.attributes;h.push({arrayStride:p,stepMode:Let(g),attributes:[]});try{for(var y=(a=void 0,qt(m)),_=y.next();!_.done;_=y.next()){var x=_.value,C=x.shaderLocation,A=x.format,T=x.offset;h[h.length-1].attributes.push({shaderLocation:C,format:Oet(A),offset:T})}}catch(w){a={error:w}}finally{try{_&&!_.done&&(o=y.return)&&o.call(y)}finally{if(a)throw a.error}}}}catch(w){i={error:w}}finally{try{d&&!d.done&&(n=f.return)&&n.call(f)}finally{if(i)throw i.error}}return c.indexFormat=Iet(u.indexBufferFormat),c.buffers=h,c}return t}(ba),aR=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;return o.type=ne.Program,o.vertexStage=null,o.fragmentStage=null,o.computeStage=null,o.descriptor=a,a.vertex&&(o.vertexStage=o.createShaderStage(a.vertex,"vertex")),a.fragment&&(o.fragmentStage=o.createShaderStage(a.fragment,"fragment")),a.compute&&(o.computeStage=o.createShaderStage(a.compute,"compute")),o}return t.prototype.setUniformsLegacy=function(e){},t.prototype.createShaderStage=function(e,i){var n,a,o=e.glsl,s=e.wgsl,l=e.entryPoint,u=e.postprocess,c=!1,h=s;if(!h)try{h=this.device.glsl_compile(o,i,c)}catch(m){throw console.error(m,o),new Error("whoops")}var f=function(m){if(!h.includes(m))return"continue";h=h.replace("var T_".concat(m,": texture_2d<f32>;"),"var T_".concat(m,": texture_depth_2d;")),h=h.replace(new RegExp("textureSample\\(T_".concat(m,"(.*)\\);$"),"gm"),function(y,_){return"vec4<f32>(textureSample(T_".concat(m).concat(_,"), 0.0, 0.0, 0.0);")})};try{for(var d=qt(["u_TextureFramebufferDepth"]),v=d.next();!v.done;v=d.next()){var p=v.value;f(p)}}catch(m){n={error:m}}finally{try{v&&!v.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}u&&(h=u(h));var g=this.device.device.createShaderModule({code:h});return{module:g,entryPoint:l||"main"}},t}(ba),zet=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=ne.QueryPool;var s=a.elemCount,l=a.type;return o.querySet=o.device.device.createQuerySet({type:_et(l),count:s}),o.resolveBuffer=o.device.device.createBuffer({size:s*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),o.cpuBuffer=o.device.device.createBuffer({size:s*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o.results=null,o}return t.prototype.queryResultOcclusion=function(e){return this.results===null?null:this.results[e]!==BigInt(0)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(ba),Het=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=r.call(this,{id:i,device:n})||this;return a.type=ne.Readback,a}return t.prototype.readTexture=function(e,i,n,a,o,s,l,u){return l===void 0&&(l=0),xi(this,void 0,void 0,function(){var c,h,f,d,v,p,g,m;return da(this,function(y){return c=e,h=0,f=LB(c.gpuTextureformat),d=Math.ceil(a/f.width)*f.length,v=Math.ceil(d/256)*256,p=v*o,g=this.device.createBuffer({usage:Ae.STORAGE|Ae.MAP_READ|Ae.COPY_DST,hint:va.STATIC,viewOrSize:p}),m=this.device.device.createCommandEncoder(),m.copyTextureToBuffer({texture:c.gpuTexture,mipLevel:0,origin:{x:i,y:n,z:Math.max(h,0)}},{buffer:g.gpuBuffer,offset:0,bytesPerRow:v},{width:a,height:o,depthOrArrayLayers:1}),this.device.device.queue.submit([m.finish()]),[2,this.readBuffer(g,0,s.byteLength===p?s:null,l,p,c.format,!0,!1,d,v,o)]})})},t.prototype.readTextureSync=function(e,i,n,a,o,s,l,u){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(e,i,n,a,o,s,l,u,c,h,f){var d=this;i===void 0&&(i=0),n===void 0&&(n=null),o===void 0&&(o=0),s===void 0&&(s=U.U8_RGB),l===void 0&&(l=!1),c===void 0&&(c=0),h===void 0&&(h=0),f===void 0&&(f=0);var v=e,p=o||v.size,g=n||v.view,m=g&&g.constructor&&g.constructor.BYTES_PER_ELEMENT||yB(s),y=v;if(!(v.usage&Ae.MAP_READ&&v.usage&Ae.COPY_DST)){var _=this.device.device.createCommandEncoder();y=this.device.createBuffer({usage:Ae.STORAGE|Ae.MAP_READ|Ae.COPY_DST,hint:va.STATIC,viewOrSize:p}),_.copyBufferToBuffer(v.gpuBuffer,i,y.gpuBuffer,0,p),this.device.device.queue.submit([_.finish()])}return new Promise(function(x,C){y.gpuBuffer.mapAsync(k1.READ,i,p).then(function(){var A=y.gpuBuffer.getMappedRange(i,p),T=g;if(l)T===null?T=iR(s,p,!0,A):T=iR(s,T.buffer,void 0,A);else if(T===null)switch(m){case 1:T=new Uint8Array(p),T.set(new Uint8Array(A));break;case 2:T=d.getHalfFloatAsFloatRGBAArrayBuffer(p/2,A);break;case 4:T=new Float32Array(p/4),T.set(new Float32Array(A));break}else switch(m){case 1:T=new Uint8Array(T.buffer),T.set(new Uint8Array(A));break;case 2:T=d.getHalfFloatAsFloatRGBAArrayBuffer(p/2,A,g);break;case 4:var w=g&&g.constructor||Float32Array;T=new w(T.buffer),T.set(new w(A));break}if(c!==h){m===1&&!l&&(c*=2,h*=2);for(var M=new Uint8Array(T.buffer),O=c,P=0,D=1;D<f;++D){P=D*h;for(var z=0;z<c;++z)M[O++]=M[P++]}m!==0&&!l?T=new Float32Array(M.buffer,0,O/4):T=new Uint8Array(M.buffer,0,O)}y.gpuBuffer.unmap(),x(T)},function(A){return C(A)})})},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(e,i,n){n||(n=new Float32Array(e));for(var a=new Uint16Array(i);e--;)n[e]=Bet(a[e]);return n},t}(ba),oR=function(){function r(t){this.device=t,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return r.prototype.getEncoder=function(){var t;return((t=this.renderBundle)===null||t===void 0?void 0:t.renderBundleEncoder)||this.gpuRenderPassEncoder},r.prototype.getTextureView=function(t,e){return Bt(e<t.mipLevelCount),t.mipLevelCount===1?t.gpuTextureView:t.gpuTexture.createView({baseMipLevel:e,mipLevelCount:1})},r.prototype.setRenderPassDescriptor=function(t){var e,i,n,a,o,s;this.descriptor=t,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var l=t.colorAttachment.length;this.gfxColorAttachment.length=l,this.gfxColorResolveTo.length=l;for(var u=0;u<t.colorAttachment.length;u++){var c=t.colorAttachment[u],h=t.colorResolveTo[u];if(c===null&&h!==null&&(c=h,h=null),this.gfxColorAttachment[u]=c,this.gfxColorResolveTo[u]=h,this.gfxColorAttachmentLevel[u]=((e=t.colorAttachmentLevel)===null||e===void 0?void 0:e[u])||0,this.gfxColorResolveToLevel[u]=((i=t.colorResolveToLevel)===null||i===void 0?void 0:i[u])||0,c!==null){this.gpuColorAttachments[u]===void 0&&(this.gpuColorAttachments[u]={});var f=this.gpuColorAttachments[u];f.view=this.getTextureView(c,((n=this.gfxColorAttachmentLevel)===null||n===void 0?void 0:n[u])||0);var d=(o=(a=t.colorClearColor)===null||a===void 0?void 0:a[u])!==null&&o!==void 0?o:"load";d==="load"?f.loadOp="load":(f.loadOp="clear",f.clearValue=d),f.storeOp=!((s=t.colorStore)===null||s===void 0)&&s[u]?"store":"discard",f.resolveTarget=void 0,h!==null&&(c.sampleCount>1?f.resolveTarget=this.getTextureView(h,this.gfxColorResolveToLevel[u]):f.storeOp="store")}else{this.gpuColorAttachments.length=u,this.gfxColorAttachment.length=u,this.gfxColorResolveTo.length=u;break}}if(this.gfxDepthStencilAttachment=t.depthStencilAttachment,this.gfxDepthStencilResolveTo=t.depthStencilResolveTo,t.depthStencilAttachment){var v=t.depthStencilAttachment,f=this.gpuDepthStencilAttachment;f.view=v.gpuTextureView;var p=!!(Tc(v.format)&ot.Depth);p?(t.depthClearValue==="load"?f.depthLoadOp="load":(f.depthLoadOp="clear",f.depthClearValue=t.depthClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?f.depthStoreOp="store":f.depthStoreOp="discard"):(f.depthLoadOp=void 0,f.depthStoreOp=void 0);var g=!!(Tc(v.format)&ot.Stencil);g?(t.stencilClearValue==="load"?f.stencilLoadOp="load":(f.stencilLoadOp="clear",f.stencilClearValue=t.stencilClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?f.stencilStoreOp="store":f.stencilStoreOp="discard"):(f.stencilLoadOp=void 0,f.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=kn(t.occlusionQueryPool)?void 0:yet(t.occlusionQueryPool)},r.prototype.beginRenderPass=function(t,e){Bt(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(e),this.frameCommandEncoder=t,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},r.prototype.flipY=function(t,e){var i=this.device.swapChainHeight;return i-t-e},r.prototype.setViewport=function(t,e,i,n,a,o){a===void 0&&(a=0),o===void 0&&(o=1),this.gpuRenderPassEncoder.setViewport(t,this.flipY(e,n),i,n,a,o)},r.prototype.setScissorRect=function(t,e,i,n){this.gpuRenderPassEncoder.setScissorRect(t,this.flipY(e,n),i,n)},r.prototype.setPipeline=function(t){var e=t,i=_l(e.gpuRenderPipeline);this.getEncoder().setPipeline(i)},r.prototype.setVertexInput=function(t,e,i){if(t!==null){var n=this.getEncoder(),a=t;i!==null&&n.setIndexBuffer(Xu(i.buffer),_l(a.indexFormat),i.offset);for(var o=0;o<e.length;o++){var s=e[o];s!==null&&n.setVertexBuffer(o,Xu(s.buffer),s.offset)}}},r.prototype.setBindings=function(t){var e=t,i=this.getEncoder();e.gpuBindGroup.forEach(function(n,a){n&&i.setBindGroup(a,e.gpuBindGroup[a])})},r.prototype.setStencilReference=function(t){this.gpuRenderPassEncoder.setStencilReference(t)},r.prototype.draw=function(t,e,i,n){this.getEncoder().draw(t,e,i,n)},r.prototype.drawIndexed=function(t,e,i,n,a){this.getEncoder().drawIndexed(t,e,i,n,a)},r.prototype.drawIndirect=function(t,e){this.getEncoder().drawIndirect(Xu(t),e)},r.prototype.drawIndexedIndirect=function(t,e){this.getEncoder().drawIndexedIndirect(Xu(t),e)},r.prototype.beginOcclusionQuery=function(t){this.gpuRenderPassEncoder.beginOcclusionQuery(t)},r.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},r.prototype.pushDebugGroup=function(t){this.gpuRenderPassEncoder.pushDebugGroup(t)},r.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},r.prototype.insertDebugMarker=function(t){this.gpuRenderPassEncoder.insertDebugMarker(t)},r.prototype.beginBundle=function(t){this.renderBundle=t},r.prototype.endBundle=function(){this.renderBundle.finish()},r.prototype.executeBundles=function(t){this.gpuRenderPassEncoder.executeBundles(t.map(function(e){return e.renderBundle}))},r.prototype.finish=function(){var t;(t=this.gpuRenderPassEncoder)===null||t===void 0||t.end(),this.gpuRenderPassEncoder=null;for(var e=0;e<this.gfxColorAttachment.length;e++){var i=this.gfxColorAttachment[e],n=this.gfxColorResolveTo[e];i!==null&&n!==null&&i.sampleCount===1&&this.copyAttachment(n,this.gfxColorAttachmentLevel[e],i,this.gfxColorResolveToLevel[e])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},r.prototype.copyAttachment=function(t,e,i,n){Bt(i.sampleCount===1);var a={texture:i.gpuTexture,mipLevel:n},o={texture:t.gpuTexture,mipLevel:e};Bt(i.width>>>n===t.width>>>e),Bt(i.height>>>n===t.height>>>e),Bt(!!(i.usage&vr.COPY_SRC)),Bt(!!(t.usage&vr.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(a,o,[t.width,t.height,1])},r}(),$et=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;return o.type=ne.RenderPipeline,o.isCreatingAsync=!1,o.gpuRenderPipeline=null,o.descriptor=a,o.device.createRenderPipelineInternal(o,!1),o}return t.prototype.getBindGroupLayout=function(e){return this.gpuRenderPipeline.getBindGroupLayout(e)},t}(ba),Wet=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o,s,l=r.call(this,{id:i,device:n})||this;l.type=ne.Sampler;var u=a.lodMinClamp,c=a.mipmapFilter===gr.NO_MIP?a.lodMinClamp:a.lodMaxClamp,h=(o=a.maxAnisotropy)!==null&&o!==void 0?o:1;return h>1&&Bt(a.minFilter===qe.BILINEAR&&a.magFilter===qe.BILINEAR&&a.mipmapFilter===gr.LINEAR),l.gpuSampler=l.device.device.createSampler({addressModeU:qy(a.addressModeU),addressModeV:qy(a.addressModeV),addressModeW:qy((s=a.addressModeW)!==null&&s!==void 0?s:a.addressModeU),lodMinClamp:u,lodMaxClamp:c,minFilter:Jw(a.minFilter),magFilter:Jw(a.magFilter),mipmapFilter:get(a.mipmapFilter),compare:a.compareFunction!==void 0?qp(a.compareFunction):void 0,maxAnisotropy:h}),l}return t}(ba),Uv=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=e.skipCreate,s=e.sampleCount,l=r.call(this,{id:i,device:n})||this;l.type=ne.Texture,l.flipY=!1;var u=a.format,c=a.dimension,h=a.width,f=a.height,d=a.depthOrArrayLayers,v=a.mipLevelCount,p=a.usage,g=a.pixelStore;return l.flipY=!!(g!=null&&g.unpackFlipY),l.device.createTextureShared({format:u,dimension:c??jt.TEXTURE_2D,width:h,height:f,depthOrArrayLayers:d??1,mipLevelCount:v??1,usage:p,sampleCount:s??1},l,o),l}return t.prototype.textureFromImageBitmapOrCanvas=function(e,i,n){for(var a=i[0].width,o=i[0].height,s={size:{width:a,height:o,depthOrArrayLayers:n},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},l=e.createTexture(s),u=0;u<i.length;u++)e.queue.copyExternalImageToTexture({source:i[u],flipY:this.flipY},{texture:l,origin:[0,0,u]},[a,o]);return[l,a,o]},t.prototype.isImageBitmapOrCanvases=function(e){var i=e[0];return i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof OffscreenCanvas},t.prototype.isVideo=function(e){var i=e[0];return i instanceof HTMLVideoElement},t.prototype.setImageData=function(e,i){var n,a=this,o=this.device.device,s,l,u;if(this.isImageBitmapOrCanvases(e))n=lt(this.textureFromImageBitmapOrCanvas(o,e,this.depthOrArrayLayers),3),s=n[0],l=n[1],u=n[2];else if(this.isVideo(e))s=o.importExternalTexture({source:e[0]});else{var c=LB(this.gpuTextureformat),h=Math.ceil(this.width/c.width)*c.length;e.forEach(function(f){o.queue.writeTexture({texture:a.gpuTexture},f,{bytesPerRow:h},{width:a.width,height:a.height})})}this.width=l,this.height=u,s&&(this.gpuTexture=s),this.gpuTextureView=this.gpuTexture.createView({dimension:vet(this.dimension)})},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(ba),Vet=function(r){B(t,r);function t(e){var i=e.id,n=e.device,a=r.call(this,{id:i,device:n})||this;return a.type=ne.RenderBundle,a.renderBundleEncoder=a.device.device.createRenderBundleEncoder({colorFormats:[a.device.swapChainFormat]}),a}return t.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},t}(ba),Get=function(){function r(t,e,i,n,a,o){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=vr.RENDER_ATTACHMENT|vr.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=ca.UPPER_LEFT,this.clipSpaceNearZ=Ac.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=e,this.canvas=i,this.canvasContext=n,this.glsl_compile=a,this.WGSLComposer=o,this.fallbackTexture2D=this.createFallbackTexture(jt.TEXTURE_2D,Ye.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(jt.TEXTURE_2D,Ye.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(jt.TEXTURE_2D_ARRAY,Ye.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(jt.TEXTURE_3D,Ye.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(jt.TEXTURE_CUBE_MAP,Ye.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:Ci.REPEAT,addressModeV:Ci.REPEAT,minFilter:qe.POINT,magFilter:qe.POINT,mipmapFilter:gr.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:Ci.REPEAT,addressModeV:Ci.REPEAT,minFilter:qe.POINT,magFilter:qe.POINT,mipmapFilter:gr.NEAREST,compareFunction:fe.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(s){console.error(s.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return r.prototype.destroy=function(){},r.prototype.configureSwapChain=function(t,e){this.swapChainWidth===t&&this.swapChainHeight===e||(this.swapChainWidth=t,this.swapChainHeight=e)},r.prototype.getOnscreenTexture=function(){var t=this.canvasContext.getCurrentTexture(),e=t.createView(),i=new Uv({id:0,device:this,descriptor:{format:U.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:jt.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return i.depthOrArrayLayers=1,i.sampleCount=1,i.gpuTexture=t,i.gpuTextureView=e,i.name="Onscreen",this.setResourceName(i,"Onscreen Texture"),i},r.prototype.getDevice=function(){return this},r.prototype.getCanvas=function(){return this.canvas},r.prototype.beginFrame=function(){Bt(this.frameCommandEncoderPool.length===0)},r.prototype.endFrame=function(){Bt(this.frameCommandEncoderPool.every(function(t){return t!==null})),this.device.queue.submit(this.frameCommandEncoderPool.map(function(t){return t.finish()})),this.frameCommandEncoderPool=[]},r.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},r.prototype.createBuffer=function(t){return new Net({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createTexture=function(t){return new Uv({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createSampler=function(t){return new Wet({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createRenderTarget=function(t){var e=new Uv({id:this.getNextUniqueId(),device:this,descriptor:S(S({},t),{dimension:jt.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:ai.RENDER_TARGET}),sampleCount:t.sampleCount});return e.depthOrArrayLayers=1,e.type=ne.RenderTarget,e},r.prototype.createRenderTargetFromTexture=function(t){var e=t,i=e.format,n=e.width,a=e.height,o=e.depthOrArrayLayers,s=e.sampleCount,l=e.mipLevelCount,u=e.gpuTexture,c=e.gpuTextureView,h=e.usage;Bt(!!(h&vr.RENDER_ATTACHMENT));var f=new Uv({id:this.getNextUniqueId(),device:this,descriptor:{format:i,width:n,height:a,depthOrArrayLayers:o,dimension:jt.TEXTURE_2D,mipLevelCount:l,usage:h},skipCreate:!0});return f.depthOrArrayLayers=o,f.sampleCount=s,f.gpuTexture=u,f.gpuTextureView=c,f},r.prototype.createProgram=function(t){var e,i;return!((e=t.vertex)===null||e===void 0)&&e.glsl&&(t.vertex.glsl=Rc(this.queryVendorInfo(),"vert",t.vertex.glsl)),!((i=t.fragment)===null||i===void 0)&&i.glsl&&(t.fragment.glsl=Rc(this.queryVendorInfo(),"frag",t.fragment.glsl)),new aR({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createProgramSimple=function(t){return new aR({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createTextureShared=function(t,e,i){var n={width:t.width,height:t.height,depthOrArrayLayers:t.depthOrArrayLayers},a=t.mipLevelCount,o=FE(t.format),s=det(t.dimension),l=fet(t.usage);if(e.gpuTextureformat=o,e.dimension=t.dimension,e.format=t.format,e.width=t.width,e.height=t.height,e.depthOrArrayLayers=t.depthOrArrayLayers,e.mipLevelCount=a,e.usage=l,e.sampleCount=t.sampleCount,!i){var u=this.device.createTexture({size:n,mipLevelCount:a,format:o,dimension:s,sampleCount:t.sampleCount,usage:l}),c=u.createView();e.gpuTexture=u,e.gpuTextureView=c}},r.prototype.getFallbackSampler=function(t){var e=t.formatKind;return e===Ye.Depth&&t.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},r.prototype.getFallbackTexture=function(t){var e=t.dimension,i=t.formatKind;if(e===jt.TEXTURE_2D)return i===Ye.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(e===jt.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(e===jt.TEXTURE_3D)return this.fallbackTexture3D;if(e===jt.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},r.prototype.createFallbackTexture=function(t,e){var i=t===jt.TEXTURE_CUBE_MAP?6:1,n=e===Ye.Float?U.U8_RGBA_NORM:U.D24;return this.createTexture({dimension:t,format:n,usage:ai.SAMPLED,width:1,height:1,depthOrArrayLayers:i,mipLevelCount:1})},r.prototype.createBindings=function(t){return new Det({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createInputLayout=function(t){return new Uet({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createComputePipeline=function(t){return new ket({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createRenderPipeline=function(t){return new $et({id:this.getNextUniqueId(),device:this,descriptor:S({},t)})},r.prototype.createQueryPool=function(t,e){return new zet({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:e}})},r.prototype.createRenderPipelineInternal=function(t,e){var i;if(t.gpuRenderPipeline===null){var n=t.descriptor,a=n.program,o=a.vertexStage,s=a.fragmentStage;if(!(o===null||s===null)){var l=n.megaStateDescriptor||{},u=l.stencilBack,c=l.stencilFront,h=Ut(l,["stencilBack","stencilFront"]),f=bc(wc);n.megaStateDescriptor=S(S(S({},f),{stencilBack:S(S({},f.stencilBack),u),stencilFront:S(S({},f.stencilFront),c)}),h);var d=n.megaStateDescriptor.attachmentsState[0];n.colorAttachmentFormats.forEach(function(x,C){n.megaStateDescriptor.attachmentsState[C]||(n.megaStateDescriptor.attachmentsState[C]=SB(void 0,d))});var v=Aet((i=n.topology)!==null&&i!==void 0?i:ar.TRIANGLES,n.megaStateDescriptor),p=Ret(n.colorAttachmentFormats,n.megaStateDescriptor),g=Met(n.depthStencilAttachmentFormat,n.megaStateDescriptor),m=void 0;n.inputLayout!==null&&(m=n.inputLayout.buffers);var y=n.sampleCount,_={layout:"auto",vertex:S(S({},o),{buffers:m}),primitive:v,depthStencil:g,multisample:{count:y},fragment:S(S({},s),{targets:p})};t.gpuRenderPipeline=this.device.createRenderPipeline(_)}}},r.prototype.createReadback=function(){return new Het({id:this.getNextUniqueId(),device:this})},r.prototype.createRenderBundle=function(){return new Vet({id:this.getNextUniqueId(),device:this})},r.prototype.createRenderPass=function(t){var e=this.renderPassPool.pop();e===void 0&&(e=new oR(this));var i=this.frameCommandEncoderPool.pop();return i===void 0&&(i=this.device.createCommandEncoder()),e.beginRenderPass(i,t),e},r.prototype.createComputePass=function(){var t=this.computePassPool.pop();t===void 0&&(t=new nR);var e=this.frameCommandEncoderPool.pop();return e===void 0&&(e=this.device.createCommandEncoder()),t.beginComputePass(e),t},r.prototype.submitPass=function(t){var e=t;e instanceof oR?(this.frameCommandEncoderPool.push(e.frameCommandEncoder),e.finish(),this.renderPassPool.push(e)):e instanceof nR&&(this.frameCommandEncoderPool.push(e.frameCommandEncoder),e.finish(),this.computePassPool.push(e))},r.prototype.copySubTexture2D=function(t,e,i,n,a,o,s){var l=this.device.createCommandEncoder(),u=t,c=n,h={texture:c.gpuTexture,origin:[a,o,0],mipLevel:0,aspect:"all"},f={texture:u.gpuTexture,origin:[e,i,0],mipLevel:0,aspect:"all"};Bt(!!(c.usage&vr.COPY_SRC)),Bt(!!(u.usage&vr.COPY_DST)),l.copyTextureToTexture(h,f,[c.width,c.height,s||1]),this.device.queue.submit([l.finish()])},r.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},r.prototype.queryTextureFormatSupported=function(t,e,i){if(Pet(t)){if(!this.featureTextureCompressionBC)return!1;var n=Fet(t);return e%n!==0||i%n!==0?!1:this.featureTextureCompressionBC}switch(t){case U.U16_RGBA_NORM:return!1;case U.F32_RGBA:return!1}return!0},r.prototype.queryPlatformAvailable=function(){return!0},r.prototype.queryVendorInfo=function(){return this},r.prototype.queryRenderPass=function(t){var e=t;return e.descriptor},r.prototype.queryRenderTarget=function(t){var e=t;return e},r.prototype.setResourceName=function(t,e){if(t.name=e,t.type===ne.Buffer){var i=t;i.gpuBuffer.label=e}else if(t.type===ne.Texture){var i=t;i.gpuTexture.label=e,i.gpuTextureView.label=e}else if(t.type===ne.RenderTarget){var i=t;i.gpuTexture.label=e,i.gpuTextureView.label=e}else if(t.type===ne.Sampler){var i=t;i.gpuSampler.label=e}else if(t.type===ne.RenderPipeline){var i=t;i.gpuRenderPipeline!==null&&(i.gpuRenderPipeline.label=e)}},r.prototype.setResourceLeakCheck=function(t,e){},r.prototype.checkForLeaks=function(){},r.prototype.programPatched=function(t){},r.prototype.pipelineQueryReady=function(t){var e=t;return e.gpuRenderPipeline!==null},r.prototype.pipelineForceReady=function(t){var e=t;this.createRenderPipelineInternal(e,!1)},r}(),Xet=function(){function r(t){this.pluginOptions=t}return r.prototype.createSwapChain=function(t){return xi(this,void 0,void 0,function(){var e,i,n,a,o,s,l,u;return da(this,function(c){switch(c.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];e=null,c.label=1;case 1:return c.trys.push([1,3,,4]),i=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:i})];case 2:return e=c.sent(),[3,4];case 3:return n=c.sent(),console.log(n),[3,4];case 4:return e===null?[2,null]:(a=["depth32float-stencil8","texture-compression-bc","float32-filterable"],o=a.filter(function(h){return e.features.has(h)}),[4,e.requestDevice({requiredFeatures:o})]);case 5:if(s=c.sent(),s&&(l=this.pluginOptions.onContextLost,s.lost.then(function(){l&&l()})),s===null)return[2,null];if(u=t.getContext("webgpu"),!u)return[2,null];c.label=6;case 6:return c.trys.push([6,8,,9]),[4,IB(this.pluginOptions.shaderCompilerPath)];case 7:return c.sent(),[3,9];case 8:return c.sent(),[3,9];case 9:return[2,new Get(e,s,t,u,set,Gf&&new Gf)]}})})},r}(),Yet=class{constructor(r,t){const{buffer:e,offset:i,stride:n,normalized:a,size:o,divisor:s,shaderLocation:l}=t;this.buffer=e,this.attribute={shaderLocation:l,buffer:e.get(),offset:i||0,stride:n||0,normalized:a||!1,divisor:s||0},o&&(this.attribute.size=o)}get(){return this.buffer}updateBuffer(r){this.buffer.subData(r)}destroy(){this.buffer.destroy()}},Ug={[b.FLOAT]:Float32Array,[b.UNSIGNED_BYTE]:Uint8Array,[b.SHORT]:Int16Array,[b.UNSIGNED_SHORT]:Uint16Array,[b.INT]:Int32Array,[b.UNSIGNED_INT]:Uint32Array},jet={[b.POINTS]:ar.POINTS,[b.LINES]:ar.LINES,[b.LINE_LOOP]:ar.LINES,[b.LINE_STRIP]:ar.LINE_STRIP,[b.TRIANGLES]:ar.TRIANGLES,[b.TRIANGLE_FAN]:ar.TRIANGLES,[b.TRIANGLE_STRIP]:ar.TRIANGLE_STRIP},Zet={1:U.F32_R,2:U.F32_RG,3:U.F32_RGB,4:U.F32_RGBA},qet={[b.STATIC_DRAW]:va.STATIC,[b.DYNAMIC_DRAW]:va.DYNAMIC,[b.STREAM_DRAW]:va.DYNAMIC},sR={[b.REPEAT]:Ci.REPEAT,[b.CLAMP_TO_EDGE]:Ci.CLAMP_TO_EDGE,[b.MIRRORED_REPEAT]:Ci.MIRRORED_REPEAT},Ket={[b.NEVER]:fe.NEVER,[b.ALWAYS]:fe.ALWAYS,[b.LESS]:fe.LESS,[b.LEQUAL]:fe.LEQUAL,[b.GREATER]:fe.GREATER,[b.GEQUAL]:fe.GEQUAL,[b.EQUAL]:fe.EQUAL,[b.NOTEQUAL]:fe.NOTEQUAL},Qet={[b.FRONT]:ki.FRONT,[b.BACK]:ki.BACK},lR={[b.FUNC_ADD]:Sr.ADD,[b.MIN_EXT]:Sr.MIN,[b.MAX_EXT]:Sr.MAX,[b.FUNC_SUBTRACT]:Sr.SUBSTRACT,[b.FUNC_REVERSE_SUBTRACT]:Sr.REVERSE_SUBSTRACT},zv={[b.ZERO]:Yt.ZERO,[b.ONE]:Yt.ONE,[b.SRC_COLOR]:Yt.SRC,[b.ONE_MINUS_SRC_COLOR]:Yt.ONE_MINUS_SRC,[b.SRC_ALPHA]:Yt.SRC_ALPHA,[b.ONE_MINUS_SRC_ALPHA]:Yt.ONE_MINUS_SRC_ALPHA,[b.DST_COLOR]:Yt.DST,[b.ONE_MINUS_DST_COLOR]:Yt.ONE_MINUS_DST,[b.DST_ALPHA]:Yt.DST_ALPHA,[b.ONE_MINUS_DST_ALPHA]:Yt.ONE_MINUS_DST_ALPHA,[b.CONSTANT_COLOR]:Yt.CONST,[b.ONE_MINUS_CONSTANT_COLOR]:Yt.ONE_MINUS_CONSTANT,[b.CONSTANT_ALPHA]:Yt.CONST,[b.ONE_MINUS_CONSTANT_ALPHA]:Yt.ONE_MINUS_CONSTANT,[b.SRC_ALPHA_SATURATE]:Yt.SRC_ALPHA_SATURATE},Mu={[b.REPLACE]:je.REPLACE,[b.KEEP]:je.KEEP,[b.ZERO]:je.ZERO,[b.INVERT]:je.INVERT,[b.INCR]:je.INCREMENT_CLAMP,[b.DECR]:je.DECREMENT_CLAMP,[b.INCR_WRAP]:je.INCREMENT_WRAP,[b.DECR_WRAP]:je.DECREMENT_WRAP},Jet={[b.ALWAYS]:fe.ALWAYS,[b.EQUAL]:fe.EQUAL,[b.GEQUAL]:fe.GEQUAL,[b.GREATER]:fe.GREATER,[b.LEQUAL]:fe.LEQUAL,[b.LESS]:fe.LESS,[b.NEVER]:fe.NEVER,[b.NOTEQUAL]:fe.NOTEQUAL},trt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function zg(r){return Object.prototype.toString.call(r)in trt}function ert(r,t){const e=r.length,i=Math.ceil(e/3),n=e+i,a=new Float32Array(n);for(let o=0;o<n;o+=4)a[o]=r[o/4*3],a[o+1]=r[o/4*3+1],a[o+2]=r[o/4*3+2],a[o+3]=t;return a}var rrt=class{constructor(r,t){this.isDestroyed=!1;const{data:e,usage:i,type:n,isUBO:a,label:o}=t;let s;zg(e)?s=e:s=new Ug[this.type||b.FLOAT](e),this.type=n,this.size=s.byteLength,this.buffer=r.createBuffer({viewOrSize:s,usage:a?Ae.UNIFORM:Ae.VERTEX,hint:qet[i||b.STATIC_DRAW]}),o&&r.setResourceName(this.buffer,o)}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:r,offset:t}){let e;zg(r)?e=r:e=new Ug[this.type||b.FLOAT](r),this.buffer.setSubData(t,new Uint8Array(e.buffer))}};function pe(r,t=0){return r+=t,r+=r<<10,r+=r>>>6,r>>>0}function OB(r){return r+=r<<3,r^=r>>>11,r+=r<<15,r>>>0}function uR(){return 0}var irt=class{constructor(){this.keys=[],this.values=[]}},Hv=class{constructor(r,t){this.keyEqualFunc=r,this.keyHashFunc=t,this.buckets=new Map}findBucketIndex(r,t){for(let e=0;e<r.keys.length;e++)if(this.keyEqualFunc(t,r.keys[e]))return e;return-1}findBucket(r){const t=this.keyHashFunc(r);return this.buckets.get(t)}get(r){const t=this.findBucket(r);if(t===void 0)return null;const e=this.findBucketIndex(t,r);return e<0?null:t.values[e]}add(r,t){const e=this.keyHashFunc(r);this.buckets.get(e)===void 0&&this.buckets.set(e,new irt);const i=this.buckets.get(e);i.keys.push(r),i.values.push(t)}delete(r){const t=this.findBucket(r);if(t===void 0)return;const e=this.findBucketIndex(t,r);e!==-1&&(t.keys.splice(e,1),t.values.splice(e,1))}clear(){this.buckets.clear()}size(){let r=0;for(const t of this.buckets.values())r+=t.values.length;return r}*values(){for(const r of this.buckets.values())for(let t=r.values.length-1;t>=0;t--)yield r.values[t]}};function cR(r,t){return r=pe(r,t.blendMode),r=pe(r,t.blendSrcFactor),r=pe(r,t.blendDstFactor),r}function nrt(r,t){return r=cR(r,t.rgbBlendState),r=cR(r,t.alphaBlendState),r=pe(r,t.channelWriteMask),r}function art(r,t){return r=pe(r,t.r<<24|t.g<<16|t.b<<8|t.a),r}function ort(r,t){var e,i,n,a,o,s,l,u;for(let c=0;c<t.attachmentsState.length;c++)r=nrt(r,t.attachmentsState[c]);return r=art(r,t.blendConstant||Y0),r=pe(r,t.depthCompare),r=pe(r,t.depthWrite?1:0),r=pe(r,(e=t.stencilFront)==null?void 0:e.compare),r=pe(r,(i=t.stencilFront)==null?void 0:i.passOp),r=pe(r,(n=t.stencilFront)==null?void 0:n.failOp),r=pe(r,(a=t.stencilFront)==null?void 0:a.depthFailOp),r=pe(r,(o=t.stencilBack)==null?void 0:o.compare),r=pe(r,(s=t.stencilBack)==null?void 0:s.passOp),r=pe(r,(l=t.stencilBack)==null?void 0:l.failOp),r=pe(r,(u=t.stencilBack)==null?void 0:u.depthFailOp),r=pe(r,t.stencilWrite?1:0),r=pe(r,t.cullMode),r=pe(r,t.frontFace?1:0),r=pe(r,t.polygonOffset?1:0),r}function srt(r){let t=0;t=pe(t,r.program.id),r.inputLayout!==null&&(t=pe(t,r.inputLayout.id)),t=ort(t,r.megaStateDescriptor);for(let e=0;e<r.colorAttachmentFormats.length;e++)t=pe(t,r.colorAttachmentFormats[e]||0);return t=pe(t,r.depthStencilAttachmentFormat||0),OB(t)}function lrt(r){let t=0;if(r.samplerBindings)for(let e=0;e<r.samplerBindings.length;e++){const i=r.samplerBindings[e];i!==null&&i.texture!==null&&(t=pe(t,i.texture.id))}if(r.uniformBufferBindings)for(let e=0;e<r.uniformBufferBindings.length;e++){const i=r.uniformBufferBindings[e];i!==null&&i.buffer!==null&&(t=pe(t,i.buffer.id),t=pe(t,i.binding),t=pe(t,i.offset),t=pe(t,i.size))}if(r.storageBufferBindings)for(let e=0;e<r.storageBufferBindings.length;e++){const i=r.storageBufferBindings[e];i!==null&&i.buffer!==null&&(t=pe(t,i.buffer.id),t=pe(t,i.binding),t=pe(t,i.offset),t=pe(t,i.size))}if(r.storageTextureBindings)for(let e=0;e<r.storageTextureBindings.length;e++){const i=r.storageTextureBindings[e];i!==null&&i.texture!==null&&(t=pe(t,i.texture.id),t=pe(t,i.binding))}return OB(t)}function urt(r,t){var e,i,n,a;return((e=r.vertex)==null?void 0:e.glsl)===((i=t.vertex)==null?void 0:i.glsl)&&((n=r.fragment)==null?void 0:n.glsl)===((a=t.fragment)==null?void 0:a.glsl)}function crt(r){var t,e;return{vertex:{glsl:(t=r.vertex)==null?void 0:t.glsl},fragment:{glsl:(e=r.fragment)==null?void 0:e.glsl}}}var hrt=class{constructor(r){this.device=r,this.bindingsCache=new Hv(ltt,lrt),this.renderPipelinesCache=new Hv(ftt,srt),this.inputLayoutsCache=new Hv(ptt,uR),this.programCache=new Hv(urt,uR)}createBindings(r){var t;let e=this.bindingsCache.get(r);if(e===null){const i=ytt(r);i.uniformBufferBindings=(t=i.uniformBufferBindings)==null?void 0:t.filter(({size:n})=>n&&n>0),e=this.device.createBindings(i),this.bindingsCache.add(i,e)}return e}createRenderPipeline(r){let t=this.renderPipelinesCache.get(r);if(t===null){const e=_tt(r);e.colorAttachmentFormats=e.colorAttachmentFormats.filter(i=>i),t=this.device.createRenderPipeline(e),this.renderPipelinesCache.add(e,t)}return t}createInputLayout(r){r.vertexBufferDescriptors=r.vertexBufferDescriptors.filter(e=>!!e);let t=this.inputLayoutsCache.get(r);if(t===null){const e=Ett(r);t=this.device.createInputLayout(e),this.inputLayoutsCache.add(e,t)}return t}createProgram(r){let t=this.programCache.get(r);if(t===null){const e=crt(r);t=this.device.createProgram(r),this.programCache.add(e,t)}return t}destroy(){for(const r of this.bindingsCache.values())r.destroy();for(const r of this.renderPipelinesCache.values())r.destroy();for(const r of this.inputLayoutsCache.values())r.destroy();for(const r of this.programCache.values())r.destroy();this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}},frt=class{constructor(r,t){const{data:e,type:i,count:n=0}=t;let a;zg(e)?a=e:a=new Ug[this.type||b.UNSIGNED_INT](e),this.type=i,this.count=n,this.indexBuffer=r.createBuffer({viewOrSize:a,usage:Ae.INDEX})}get(){return this.indexBuffer}subData({data:r}){let t;zg(r)?t=r:t=new Ug[this.type||b.UNSIGNED_INT](r),this.indexBuffer.setSubData(0,new Uint8Array(t.buffer))}destroy(){this.indexBuffer.destroy()}};function hR(r){return!!(r&&r.texture)}var PB=class{constructor(r,t){this.device=r,this.options=t,this.isDestroy=!1;const{wrapS:e=b.CLAMP_TO_EDGE,wrapT:i=b.CLAMP_TO_EDGE,aniso:n,mag:a=b.NEAREST,min:o=b.NEAREST}=t;this.createTexture(t),this.sampler=r.createSampler({addressModeU:sR[e],addressModeV:sR[i],minFilter:o===b.NEAREST?qe.POINT:qe.BILINEAR,magFilter:a===b.NEAREST?qe.POINT:qe.BILINEAR,mipmapFilter:gr.NO_MIP,maxAnisotropy:n})}createTexture(r){const{type:t=b.UNSIGNED_BYTE,width:e,height:i,flipY:n=!1,format:a=b.RGBA,alignment:o=1,usage:s=$l.SAMPLED,unorm:l=!1,label:u}=r;let{data:c}=r;this.width=e,this.height=i;let h=U.U8_RGBA_RT;if(t===b.UNSIGNED_BYTE&&a===b.RGBA)h=l?U.U8_RGBA_NORM:U.U8_RGBA_RT;else if(t===b.UNSIGNED_BYTE&&a===b.LUMINANCE)h=U.U8_LUMINANCE;else if(t===b.FLOAT&&a===b.LUMINANCE)h=U.F32_LUMINANCE;else if(t===b.FLOAT&&a===b.RGB)this.device.queryVendorInfo().platformString==="WebGPU"?(c&&(c=ert(c,0)),h=U.F32_RGBA):h=U.F32_RGB;else if(t===b.FLOAT&&a===b.RGBA)h=U.F32_RGBA;else if(t===b.FLOAT&&a===b.RED)h=U.F32_R;else throw new Error(`create texture error, type: ${t}, format: ${a}`);this.texture=this.device.createTexture({format:h,width:e,height:i,usage:s===$l.SAMPLED?ai.SAMPLED:ai.RENDER_TARGET,pixelStore:{unpackFlipY:n,packAlignment:o},mipLevelCount:1}),u&&this.device.setResourceName(this.texture,u),c&&this.texture.setImageData([c])}get(){return this.texture}update(r){const{data:t}=r;this.texture.setImageData([t])}bind(){}resize({width:r,height:t}){(this.width!==r||this.height!==t)&&this.destroy(),this.options.width=r,this.options.height=t,this.createTexture(this.options),this.isDestroy=!1}getSize(){return[this.width,this.height]}destroy(){var r;!this.isDestroy&&!this.texture.destroyed&&((r=this.texture)==null||r.destroy()),this.isDestroy=!0}},FB=class{constructor(r,t){this.device=r,this.options=t,this.createColorRenderTarget(),this.createDepthRenderTarget()}createColorRenderTarget(r=!1){const{width:t,height:e,color:i}=this.options;i&&(hR(i)?(r&&i.resize({width:t,height:e}),this.colorTexture=i.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=i.width,this.height=i.height):t&&e&&(this.colorTexture=this.device.createTexture({format:U.U8_RGBA_RT,usage:ai.RENDER_TARGET,width:t,height:e}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=t,this.height=e))}createDepthRenderTarget(r=!1){const{width:t,height:e,depth:i}=this.options;i&&(hR(i)?(r&&i.resize({width:t,height:e}),this.depthTexture=i.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=i.width,this.height=i.height):t&&e&&(this.depthTexture=this.device.createTexture({format:U.D24_S8,usage:ai.RENDER_TARGET,width:t,height:e}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=t,this.height=e))}get(){return this.colorRenderTarget}destroy(){var r,t;(r=this.colorRenderTarget)==null||r.destroy(),(t=this.depthRenderTarget)==null||t.destroy()}resize({width:r,height:t}){(this.width!==r||this.height!==t)&&(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=r,this.options.height=t,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}},drt=Object.defineProperty,vrt=Object.defineProperties,prt=Object.getOwnPropertyDescriptors,fR=Object.getOwnPropertySymbols,grt=Object.prototype.hasOwnProperty,mrt=Object.prototype.propertyIsEnumerable,dR=(r,t,e)=>t in r?drt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,il=(r,t)=>{for(var e in t||(t={}))grt.call(t,e)&&dR(r,e,t[e]);if(fR)for(var e of fR(t))mrt.call(t,e)&&dR(r,e,t[e]);return r},yrt=(r,t)=>vrt(r,prt(t)),{isPlainObject:_rt,isTypedArray:xrt,isNil:vR}=tr,Crt=class{constructor(r,t,e){this.device=r,this.options=t,this.service=e,this.destroyed=!1,this.uniforms={},this.vertexBuffers=[];const{vs:i,fs:n,attributes:a,uniforms:o,count:s,elements:l,diagnosticDerivativeUniformityEnabled:u}=t;this.options=t;const c=u?"":this.service.viewportOrigin===ca.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=e.renderCache.createProgram({vertex:{glsl:i},fragment:{glsl:n,postprocess:v=>c+v}}),o&&(this.uniforms=this.extractUniforms(o));const h=[];let f=0;Object.keys(a).forEach(v=>{const p=a[v],g=p.get();this.vertexBuffers.push(g.get());const{offset:m=0,stride:y=0,size:_=1,divisor:x=0,shaderLocation:C=0}=p.attribute;h.push({arrayStride:y||_*4,stepMode:Vl.VERTEX,attributes:[{format:Zet[_],shaderLocation:C,offset:m,divisor:x}]}),f=g.size/_}),s||(this.options.count=f),l&&(this.indexBuffer=l.get());const d=e.renderCache.createInputLayout({vertexBufferDescriptors:h,indexBufferFormat:l?U.U32_R:null,program:this.program});this.inputLayout=d,this.pipeline=this.createPipeline(t)}createPipeline(r,t){var e;const{primitive:i=b.TRIANGLES,depth:n,cull:a,blend:o,stencil:s}=r,l=this.initDepthDrawParams({depth:n}),u=!!(l&&l.enable),c=this.initCullDrawParams({cull:a}),h=!!(c&&c.enable),f=this.getBlendDrawParams({blend:o}),d=!!(f&&f.enable),v=this.getStencilDrawParams({stencil:s}),p=!!(v&&v.enable),g=this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:jet[i],colorAttachmentFormats:[U.U8_RGBA_RT],depthStencilAttachmentFormat:U.D24_S8,megaStateDescriptor:{attachmentsState:[t?{channelWriteMask:_r.ALL,rgbBlendState:{blendMode:Sr.ADD,blendSrcFactor:Yt.ONE,blendDstFactor:Yt.ZERO},alphaBlendState:{blendMode:Sr.ADD,blendSrcFactor:Yt.ONE,blendDstFactor:Yt.ZERO}}:{channelWriteMask:p&&v.opFront.zpass===je.REPLACE?_r.NONE:_r.ALL,rgbBlendState:{blendMode:d&&f.equation.rgb||Sr.ADD,blendSrcFactor:d&&f.func.srcRGB||Yt.SRC_ALPHA,blendDstFactor:d&&f.func.dstRGB||Yt.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:d&&f.equation.alpha||Sr.ADD,blendSrcFactor:d&&f.func.srcAlpha||Yt.ONE,blendDstFactor:d&&f.func.dstAlpha||Yt.ONE}}],blendConstant:d?Y0:void 0,depthWrite:u,depthCompare:u&&l.func||fe.LESS,cullMode:h&&c.face||ki.NONE,stencilWrite:p,stencilFront:{compare:p?v.func.cmp:fe.ALWAYS,passOp:v.opFront.zpass,failOp:v.opFront.fail,depthFailOp:v.opFront.zfail,mask:v.opFront.mask},stencilBack:{compare:p?v.func.cmp:fe.ALWAYS,passOp:v.opBack.zpass,failOp:v.opBack.fail,depthFailOp:v.opBack.zfail,mask:v.opBack.mask}}});return p&&!vR((e=s==null?void 0:s.func)==null?void 0:e.ref)&&(g.stencilFuncReference=s.func.ref),g}updateAttributesAndElements(){}updateAttributes(){}addUniforms(r){this.uniforms=il(il({},this.uniforms),this.extractUniforms(r))}draw(r,t){const e=il(il({},this.options),r),{count:i=0,instances:n,elements:a,uniforms:o={},uniformBuffers:s,textures:l}=e;this.uniforms=il(il({},this.uniforms),this.extractUniforms(o));const{renderPass:u,currentFramebuffer:c,width:h,height:f}=this.service;this.pipeline=this.createPipeline(e,t);const d=this.service.device,v=d.swapChainHeight;if(d.swapChainHeight=(c==null?void 0:c.height)||f,u.setViewport(0,0,(c==null?void 0:c.width)||h,(c==null?void 0:c.height)||f),d.swapChainHeight=v,u.setPipeline(this.pipeline),vR(this.pipeline.stencilFuncReference)||u.setStencilReference(this.pipeline.stencilFuncReference),u.setVertexInput(this.inputLayout,this.vertexBuffers.map(p=>({buffer:p})),a?{buffer:this.indexBuffer,offset:0}:null),s&&(this.bindings=d.createBindings({pipeline:this.pipeline,uniformBufferBindings:s.map((p,g)=>{const m=p;return{binding:g,buffer:m.get(),size:m.size}}),samplerBindings:l==null?void 0:l.map(p=>({texture:p.texture,sampler:p.sampler}))})),this.bindings&&(u.setBindings(this.bindings),Object.keys(this.uniforms).forEach(p=>{const g=this.uniforms[p];g instanceof PB?this.uniforms[p]=g.get():g instanceof FB&&(this.uniforms[p]=g.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),a){const p=a.count;p===0?u.draw(i,n):u.drawIndexed(p,n)}else u.draw(i,n)}destroy(){var r,t,e;(r=this.vertexBuffers)==null||r.forEach(i=>i.destroy()),(t=this.indexBuffer)==null||t.destroy(),(e=this.bindings)==null||e.destroy(),this.pipeline.destroy(),this.destroyed=!0}initDepthDrawParams({depth:r}){if(r)return{enable:r.enable===void 0?!0:!!r.enable,mask:r.mask===void 0?!0:!!r.mask,func:Ket[r.func||b.LESS],range:r.range||[0,1]}}getBlendDrawParams({blend:r}){const{enable:t,func:e,equation:i,color:n=[0,0,0,0]}=r||{};return{enable:!!t,func:{srcRGB:zv[e&&e.srcRGB||b.SRC_ALPHA],srcAlpha:zv[e&&e.srcAlpha||b.SRC_ALPHA],dstRGB:zv[e&&e.dstRGB||b.ONE_MINUS_SRC_ALPHA],dstAlpha:zv[e&&e.dstAlpha||b.ONE_MINUS_SRC_ALPHA]},equation:{rgb:lR[i&&i.rgb||b.FUNC_ADD],alpha:lR[i&&i.alpha||b.FUNC_ADD]},color:n}}getStencilDrawParams({stencil:r}){const{enable:t,mask:e=4294967295,func:i={cmp:b.ALWAYS,ref:0,mask:4294967295},opFront:n={fail:b.KEEP,zfail:b.KEEP,zpass:b.KEEP},opBack:a={fail:b.KEEP,zfail:b.KEEP,zpass:b.KEEP}}=r||{};return{enable:!!t,mask:e,func:yrt(il({},i),{cmp:Jet[i.cmp]}),opFront:{fail:Mu[n.fail],zfail:Mu[n.zfail],zpass:Mu[n.zpass],mask:i.mask},opBack:{fail:Mu[a.fail],zfail:Mu[a.zfail],zpass:Mu[a.zpass],mask:i.mask}}}initCullDrawParams({cull:r}){if(r){const{enable:t,face:e=b.BACK}=r;return{enable:!!t,face:Qet[e]}}}extractUniforms(r){const t={};return Object.keys(r).forEach(e=>{this.extractUniformsRecursively(e,r[e],t,"")}),t}extractUniformsRecursively(r,t,e,i){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||xrt(t)||t===""||"resize"in t){e[`${i&&i+"."}${r}`]=t;return}_rt(t)&&Object.keys(t).forEach(n=>{this.extractUniformsRecursively(n,t[n],e,`${i&&i+"."}${r}`)}),Array.isArray(t)&&t.forEach((n,a)=>{Object.keys(n).forEach(o=>{this.extractUniformsRecursively(o,n[o],e,`${i&&i+"."}${r}[${a}]`)})})}};function Ert(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}var Ky=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),{isUndefined:$v}=tr,Srt=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>this.device.queryVendorInfo().platformString,this.createModel=r=>new Crt(this.device,r,this),this.createAttribute=r=>new Yet(this.device,r),this.createBuffer=r=>new rrt(this.device,r),this.createElements=r=>new frt(this.device,r),this.createTexture2D=r=>new PB(this.device,r),this.createFramebuffer=r=>new FB(this.device,r),this.useFramebuffer=(r,t)=>{this.currentFramebuffer=r,this.beginFrame(),t(),this.endFrame(),this.currentFramebuffer=null},this.useFramebufferAsync=(r,t)=>Ky(this,null,function*(){this.currentFramebuffer=r,this.preRenderPass=this.renderPass,this.beginFrame(),yield t(),this.endFrame(),this.currentFramebuffer=null,this.renderPass=this.preRenderPass}),this.clear=r=>{const{color:t,depth:e,stencil:i,framebuffer:n=null}=r;if(n)n.clearOptions={color:t,depth:e,stencil:i};else{const a=this.queryVerdorInfo();if(a==="WebGL1"){const o=this.getGLContext();$v(i)?$v(e)||(o.clearDepth(e),o.clear(o.DEPTH_BUFFER_BIT)):(o.clearStencil(i),o.clear(o.STENCIL_BUFFER_BIT))}else if(a==="WebGL2"){const o=this.getGLContext();$v(i)?$v(e)||o.clearBufferfv(o.DEPTH,0,[e]):o.clearBufferiv(o.STENCIL,0,[i])}}},this.viewport=({width:r,height:t})=>{this.swapChain.configureSwapChain(r,t),this.createMainColorDepthRT(r,t),this.width=r,this.height=t},this.readPixels=r=>{const{framebuffer:t,x:e,y:i,width:n,height:a}=r,o=this.device.createReadback(),s=t.colorTexture,l=o.readTextureSync(s,e,this.viewportOrigin===ca.LOWER_LEFT?i:this.height-i,n,a,new Uint8Array(n*a*4));if(this.viewportOrigin!==ca.LOWER_LEFT)for(let u=0;u<l.length;u+=4){const c=l[u];l[u]=l[u+2],l[u+2]=c}return o.destroy(),l},this.readPixelsAsync=r=>Ky(this,null,function*(){const{framebuffer:t,x:e,y:i,width:n,height:a}=r,o=this.device.createReadback(),s=t.colorTexture,l=yield o.readTexture(s,e,this.viewportOrigin===ca.LOWER_LEFT?i:this.height-i,n,a,new Uint8Array(n*a*4));if(this.viewportOrigin!==ca.LOWER_LEFT)for(let u=0;u<l.length;u+=4){const c=l[u];l[u]=l[u+2],l[u+2]=c}return o.destroy(),l}),this.getViewportSize=()=>({width:this.width,height:this.height}),this.getContainer=()=>{var r;return(r=this.canvas)==null?void 0:r.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.device.gl,this.destroy=()=>{var r;this.canvas=null,(r=this.uniformBuffers)==null||r.forEach(t=>{t.destroy()}),this.device.destroy(),this.renderCache.destroy()}}init(r,t){return Ky(this,null,function*(){const{enableWebGPU:e,shaderCompilerPath:i,antialias:n}=t;this.canvas=r;const o=yield(e?new Xet({shaderCompilerPath:i}):new ret({targets:["webgl2","webgl1"],antialias:n,onContextLost(l){console.warn("context lost",l)},onContextCreationError(l){console.warn("context creation error",l)},onContextRestored(l){console.warn("context restored",l)}})).createSwapChain(r);o.configureSwapChain(r.width,r.height),this.device=o.getDevice(),this.swapChain=o,this.renderCache=new hrt(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin;const s=this.device.gl;this.extensionObject={OES_texture_float:!Ert(s)&&this.device.OES_texture_float},this.createMainColorDepthRT(r.width,r.height)})}createMainColorDepthRT(r,t){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:U.U8_RGBA_RT,width:r,height:t,usage:ai.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:U.D24_S8,width:r,height:t,usage:ai.RENDER_TARGET}))}beginFrame(){this.device.beginFrame();const{currentFramebuffer:r,swapChain:t,mainColorRT:e,mainDepthRT:i}=this,n=r?r.colorRenderTarget:e,a=r?null:t.getOnscreenTexture(),o=r?r.depthRenderTarget:i,{color:s=[0,0,0,0],depth:l=1,stencil:u=0}=(r==null?void 0:r.clearOptions)||{},c=n?Wd(s[0]*255,s[1]*255,s[2]*255,s[3]):Y0,h=o?l:void 0,f=o?u:void 0,d=this.device.createRenderPass({colorAttachment:[n],colorResolveTo:[a],colorClearColor:[c],colorStore:[!0],depthStencilAttachment:o,depthClearValue:h,stencilClearValue:f});this.renderPass=d}endFrame(){this.device.submitPass(this.renderPass),this.device.endFrame()}getPointSizeRange(){const r=this.device.gl;return r.getParameter(r.ALIASED_POINT_SIZE_RANGE)}testExtension(r){return!!this.getGLContext().getExtension(r)}setState(){}setBaseState(){}setCustomLayerDefaults(){}setDirty(r){this.isDirty=r}getDirty(){return this.isDirty}},Art=class{constructor(r,t){const{buffer:e,offset:i,stride:n,normalized:a,size:o,divisor:s}=t;this.buffer=e,this.attribute={buffer:e.get(),offset:i||0,stride:n||0,normalized:a||!1,divisor:s||0},o&&(this.attribute.size=o)}get(){return this.attribute}updateBuffer(r){this.buffer.subData(r)}destroy(){this.buffer.destroy()}},Trt={[b.POINTS]:"points",[b.LINES]:"lines",[b.LINE_LOOP]:"line loop",[b.LINE_STRIP]:"line strip",[b.TRIANGLES]:"triangles",[b.TRIANGLE_FAN]:"triangle fan",[b.TRIANGLE_STRIP]:"triangle strip"},BB={[b.STATIC_DRAW]:"static",[b.DYNAMIC_DRAW]:"dynamic",[b.STREAM_DRAW]:"stream"},BE={[b.BYTE]:"int8",[b.INT]:"int32",[b.UNSIGNED_BYTE]:"uint8",[b.UNSIGNED_SHORT]:"uint16",[b.UNSIGNED_INT]:"uint32",[b.FLOAT]:"float"},brt={[b.ALPHA]:"alpha",[b.LUMINANCE]:"luminance",[b.LUMINANCE_ALPHA]:"luminance alpha",[b.RGB]:"rgb",[b.RGBA]:"rgba",[b.RGBA4]:"rgba4",[b.RGB5_A1]:"rgb5 a1",[b.RGB565]:"rgb565",[b.DEPTH_COMPONENT]:"depth",[b.DEPTH_STENCIL]:"depth stencil"},wrt={[b.DONT_CARE]:"dont care",[b.NICEST]:"nice",[b.FASTEST]:"fast"},pR={[b.NEAREST]:"nearest",[b.LINEAR]:"linear",[b.LINEAR_MIPMAP_LINEAR]:"mipmap",[b.NEAREST_MIPMAP_LINEAR]:"nearest mipmap linear",[b.LINEAR_MIPMAP_NEAREST]:"linear mipmap nearest",[b.NEAREST_MIPMAP_NEAREST]:"nearest mipmap nearest"},gR={[b.REPEAT]:"repeat",[b.CLAMP_TO_EDGE]:"clamp",[b.MIRRORED_REPEAT]:"mirror"},Rrt={[b.NONE]:"none",[b.BROWSER_DEFAULT_WEBGL]:"browser"},Mrt={[b.NEVER]:"never",[b.ALWAYS]:"always",[b.LESS]:"less",[b.LEQUAL]:"lequal",[b.GREATER]:"greater",[b.GEQUAL]:"gequal",[b.EQUAL]:"equal",[b.NOTEQUAL]:"notequal"},mR={[b.FUNC_ADD]:"add",[b.MIN_EXT]:"min",[b.MAX_EXT]:"max",[b.FUNC_SUBTRACT]:"subtract",[b.FUNC_REVERSE_SUBTRACT]:"reverse subtract"},Wv={[b.ZERO]:"zero",[b.ONE]:"one",[b.SRC_COLOR]:"src color",[b.ONE_MINUS_SRC_COLOR]:"one minus src color",[b.SRC_ALPHA]:"src alpha",[b.ONE_MINUS_SRC_ALPHA]:"one minus src alpha",[b.DST_COLOR]:"dst color",[b.ONE_MINUS_DST_COLOR]:"one minus dst color",[b.DST_ALPHA]:"dst alpha",[b.ONE_MINUS_DST_ALPHA]:"one minus dst alpha",[b.CONSTANT_COLOR]:"constant color",[b.ONE_MINUS_CONSTANT_COLOR]:"one minus constant color",[b.CONSTANT_ALPHA]:"constant alpha",[b.ONE_MINUS_CONSTANT_ALPHA]:"one minus constant alpha",[b.SRC_ALPHA_SATURATE]:"src alpha saturate"},Irt={[b.NEVER]:"never",[b.ALWAYS]:"always",[b.LESS]:"less",[b.LEQUAL]:"lequal",[b.GREATER]:"greater",[b.GEQUAL]:"gequal",[b.EQUAL]:"equal",[b.NOTEQUAL]:"notequal"},Iu={[b.ZERO]:"zero",[b.KEEP]:"keep",[b.REPLACE]:"replace",[b.INVERT]:"invert",[b.INCR]:"increment",[b.DECR]:"decrement",[b.INCR_WRAP]:"increment wrap",[b.DECR_WRAP]:"decrement wrap"},Lrt={[b.FRONT]:"front",[b.BACK]:"back"},Ort=class{constructor(r,t){this.isDestroyed=!1;const{data:e,usage:i,type:n}=t;this.buffer=r.buffer({data:e,usage:BB[i||b.STATIC_DRAW],type:BE[n||b.UNSIGNED_BYTE]})}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:r,offset:t}){this.buffer.subdata(r,t)}},Prt=class{constructor(r,t){const{data:e,usage:i,type:n,count:a}=t;this.elements=r.elements({data:e,usage:BB[i||b.STATIC_DRAW],type:BE[n||b.UNSIGNED_BYTE],count:a})}get(){return this.elements}subData({data:r}){this.elements.subdata(r)}destroy(){}},Frt=class{constructor(r,t){const{width:e,height:i,color:n,colors:a}=t,o={width:e,height:i};Array.isArray(a)&&(o.colors=a.map(s=>s.get())),n&&typeof n!="boolean"&&(o.color=n.get()),this.framebuffer=r.framebuffer(o)}get(){return this.framebuffer}destroy(){this.framebuffer.destroy()}resize({width:r,height:t}){this.framebuffer.resize(r,t)}},Brt=Object.defineProperty,Drt=Object.defineProperties,Nrt=Object.getOwnPropertyDescriptors,yR=Object.getOwnPropertySymbols,krt=Object.prototype.hasOwnProperty,Urt=Object.prototype.propertyIsEnumerable,_R=(r,t,e)=>t in r?Brt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Dh=(r,t)=>{for(var e in t||(t={}))krt.call(t,e)&&_R(r,e,t[e]);if(yR)for(var e of yR(t))Urt.call(t,e)&&_R(r,e,t[e]);return r},zrt=(r,t)=>Drt(r,Nrt(t)),{isPlainObject:Hrt,isTypedArray:$rt}=tr,Wrt=class{constructor(r,t){this.destroyed=!1,this.uniforms={},this.reGl=r;const{vs:e,fs:i,attributes:n,uniforms:a,primitive:o,count:s,elements:l,depth:u,cull:c,instances:h}=t,f={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:ca.LOWER_LEFT,clipSpaceNearZ:Ac.NEGATIVE_ONE,supportMRT:!1},d={};this.options=t,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach(y=>{d[y]=r.prop(y)}));const v={};Object.keys(n).forEach(y=>{v[y]=n[y].get()});const p=a2(Rc(f,"frag",i,null,!1)),g=a2(Rc(f,"vert",e,null,!1)),m={attributes:v,frag:p,uniforms:d,vert:g,colorMask:r.prop("colorMask"),lineWidth:1,blend:{enable:r.prop("blend.enable"),func:r.prop("blend.func"),equation:r.prop("blend.equation"),color:r.prop("blend.color")},stencil:{enable:r.prop("stencil.enable"),mask:r.prop("stencil.mask"),func:r.prop("stencil.func"),opFront:r.prop("stencil.opFront"),opBack:r.prop("stencil.opBack")},primitive:Trt[o===void 0?b.TRIANGLES:o]};h&&(m.instances=h),s?m.count=s:l&&(m.elements=l.get()),this.initDepthDrawParams({depth:u},m),this.initCullDrawParams({cull:c},m),this.drawCommand=r(m),this.drawParams=m}updateAttributesAndElements(r,t){const e={};Object.keys(r).forEach(i=>{e[i]=r[i].get()}),this.drawParams.attributes=e,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}updateAttributes(r){const t={};Object.keys(r).forEach(e=>{t[e]=r[e].get()}),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}addUniforms(r){this.uniforms=Dh(Dh({},this.uniforms),this.extractUniforms(r))}draw(r,t){if(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)return;const e=Dh(Dh({},this.uniforms),this.extractUniforms(r.uniforms||{})),i={};Object.keys(e).forEach(n=>{const a=typeof e[n];a==="boolean"||a==="number"||Array.isArray(e[n])||e[n].BYTES_PER_ELEMENT?i[n]=e[n]:i[n]=e[n].get()}),i.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(r),i.stencil=this.getStencilDrawParams(r),i.colorMask=this.getColorMaskDrawParams(r,t),this.drawCommand(i)}destroy(){var r,t;(t=(r=this.drawParams)==null?void 0:r.elements)==null||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(e=>{e==null||e.destroy()}),this.destroyed=!0}initDepthDrawParams({depth:r},t){r&&(t.depth={enable:r.enable===void 0?!0:!!r.enable,mask:r.mask===void 0?!0:!!r.mask,func:Mrt[r.func||b.LESS],range:r.range||[0,1]})}getBlendDrawParams({blend:r}){const{enable:t,func:e,equation:i,color:n=[0,0,0,0]}=r||{};return{enable:!!t,func:{srcRGB:Wv[e&&e.srcRGB||b.SRC_ALPHA],srcAlpha:Wv[e&&e.srcAlpha||b.SRC_ALPHA],dstRGB:Wv[e&&e.dstRGB||b.ONE_MINUS_SRC_ALPHA],dstAlpha:Wv[e&&e.dstAlpha||b.ONE_MINUS_SRC_ALPHA]},equation:{rgb:mR[i&&i.rgb||b.FUNC_ADD],alpha:mR[i&&i.alpha||b.FUNC_ADD]},color:n}}getStencilDrawParams({stencil:r}){const{enable:t,mask:e=-1,func:i={cmp:b.ALWAYS,ref:0,mask:-1},opFront:n={fail:b.KEEP,zfail:b.KEEP,zpass:b.KEEP},opBack:a={fail:b.KEEP,zfail:b.KEEP,zpass:b.KEEP}}=r||{};return{enable:!!t,mask:e,func:zrt(Dh({},i),{cmp:Irt[i.cmp]}),opFront:{fail:Iu[n.fail],zfail:Iu[n.zfail],zpass:Iu[n.zpass]},opBack:{fail:Iu[a.fail],zfail:Iu[a.zfail],zpass:Iu[a.zpass]}}}getColorMaskDrawParams({stencil:r},t){return r!=null&&r.enable&&r.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}initCullDrawParams({cull:r},t){if(r){const{enable:e,face:i=b.BACK}=r;t.cull={enable:!!e,face:Lrt[i]}}}extractUniforms(r){const t={};return Object.keys(r).forEach(e=>{this.extractUniformsRecursively(e,r[e],t,"")}),t}extractUniformsRecursively(r,t,e,i){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||$rt(t)||t===""||"resize"in t){e[`${i&&i+"."}${r}`]=t;return}Hrt(t)&&Object.keys(t).forEach(n=>{this.extractUniformsRecursively(n,t[n],e,`${i&&i+"."}${r}`)}),Array.isArray(t)&&t.forEach((n,a)=>{Object.keys(n).forEach(o=>{this.extractUniformsRecursively(o,n[o],e,`${i&&i+"."}${r}[${a}]`)})})}},Vrt=class{constructor(r,t){this.isDestroy=!1;const{data:e,type:i=b.UNSIGNED_BYTE,width:n,height:a,flipY:o=!1,format:s=b.RGBA,mipmap:l=!1,wrapS:u=b.CLAMP_TO_EDGE,wrapT:c=b.CLAMP_TO_EDGE,aniso:h=0,alignment:f=1,premultiplyAlpha:d=!1,mag:v=b.NEAREST,min:p=b.NEAREST,colorSpace:g=b.BROWSER_DEFAULT_WEBGL,x:m=0,y=0,copy:_=!1}=t;this.width=n,this.height=a;const x={width:n,height:a,type:BE[i],format:brt[s],wrapS:gR[u],wrapT:gR[c],mag:pR[v],min:pR[p],alignment:f,flipY:o,colorSpace:Rrt[g],premultiplyAlpha:d,aniso:h,x:m,y,copy:_};e&&(x.data=e),typeof l=="number"?x.mipmap=wrt[l]:typeof l=="boolean"&&(x.mipmap=l),this.texture=r.texture(x)}get(){return this.texture}update(r={}){this.texture(r)}bind(){this.texture._texture.bind()}resize({width:r,height:t}){this.texture.resize(r,t),this.width=r,this.height=t}getSize(){return[this.width,this.height]}destroy(){var r;this.isDestroy||(r=this.texture)==null||r.destroy(),this.isDestroy=!0}},Qy=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),Grt=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>"WebGL1",this.createModel=r=>new Wrt(this.gl,r),this.createAttribute=r=>new Art(this.gl,r),this.createBuffer=r=>new Ort(this.gl,r),this.createElements=r=>new Prt(this.gl,r),this.createTexture2D=r=>new Vrt(this.gl,r),this.createFramebuffer=r=>new Frt(this.gl,r),this.useFramebuffer=(r,t)=>{this.gl({framebuffer:r?r.get():null})(t)},this.useFramebufferAsync=(r,t)=>Qy(this,null,function*(){this.gl({framebuffer:r?r.get():null})(t)}),this.clear=r=>{var t;const{color:e,depth:i,stencil:n,framebuffer:a=null}=r,o={color:e,depth:i,stencil:n};o.framebuffer=a===null?a:a.get(),(t=this.gl)==null||t.clear(o)},this.viewport=({x:r,y:t,width:e,height:i})=>{this.gl._gl.viewport(r,t,e,i),this.width=e,this.height=i,this.gl._refresh()},this.readPixels=r=>{const{framebuffer:t,x:e,y:i,width:n,height:a}=r,o={x:e,y:i,width:n,height:a};return t&&(o.framebuffer=t.get()),this.gl.read(o)},this.readPixelsAsync=r=>Qy(this,null,function*(){return this.readPixels(r)}),this.getViewportSize=()=>({width:this.gl._gl.drawingBufferWidth,height:this.gl._gl.drawingBufferHeight}),this.getContainer=()=>{var r;return(r=this.canvas)==null?void 0:r.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.gl._gl,this.destroy=()=>{var r,t,e;this.canvas=null,(e=(t=(r=this.gl)==null?void 0:r._gl)==null?void 0:t.getExtension("WEBGL_lose_context"))==null||e.loseContext(),this.gl.destroy(),this.gl=null}}init(r,t,e){return Qy(this,null,function*(){this.canvas=r,e?this.gl=e:this.gl=yield new Promise((i,n)=>{wH({canvas:this.canvas,attributes:{alpha:!0,antialias:t.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,stencil:t.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:(a,o)=>{(a||!o)&&n(a),i(o)}})}),this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")}})}getPointSizeRange(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}testExtension(r){return!!this.getGLContext().getExtension(r)}setState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}setBaseState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}setCustomLayerDefaults(){const r=this.getGLContext();r.disable(r.CULL_FACE)}setDirty(r){this.isDirty=r}getDirty(){return this.isDirty}beginFrame(){}endFrame(){}},Jy=["selectstart","selecting","selectend"],Xrt=class extends Ti.EventEmitter{constructor(r,t={}){super(),this.isEnable=!1,this.onDragStart=e=>{this.box.style.display="block",this.startEvent=this.endEvent=e,this.syncBoxBound(),this.emit("selectstart",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragging=e=>{this.endEvent=e,this.syncBoxBound(),this.emit("selecting",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragEnd=e=>{this.endEvent=e,this.box.style.display="none",this.emit("selectend",this.getLngLatBox(),this.startEvent,this.endEvent)},this.scene=r,this.options=t}get container(){return this.scene.getMapService().getMarkerContainer()}enable(){if(this.isEnable)return;const{className:r}=this.options;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){const t=Me("div",void 0,this.container);t.classList.add("l7-select-box"),r&&t.classList.add(r),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}disable(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}syncBoxBound(){const{x:r,y:t}=this.startEvent,{x:e,y:i}=this.endEvent,n=Math.min(r,e),a=Math.min(t,i),o=Math.abs(r-e),s=Math.abs(t-i);this.box.style.top=`${a}px`,this.box.style.left=`${n}px`,this.box.style.width=`${o}px`,this.box.style.height=`${s}px`}getLngLatBox(){const{lngLat:{lng:r,lat:t}}=this.startEvent,{lngLat:{lng:e,lat:i}}=this.endEvent;return k$([[r,t],[e,i]])}},Yrt=Object.defineProperty,jrt=Object.defineProperties,Zrt=Object.getOwnPropertyDescriptors,xR=Object.getOwnPropertySymbols,qrt=Object.prototype.hasOwnProperty,Krt=Object.prototype.propertyIsEnumerable,CR=(r,t,e)=>t in r?Yrt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Qrt=(r,t)=>{for(var e in t||(t={}))qrt.call(t,e)&&CR(r,e,t[e]);if(xR)for(var e of xR(t))Krt.call(t,e)&&CR(r,e,t[e]);return r},Jrt=(r,t)=>jrt(r,Zrt(t)),Nh=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),tit=class{constructor(r){const{id:t,map:e,renderer:i="device"}=r,n=DX();this.container=n,e.setContainer(n,t),i==="regl"?n.rendererService=new Grt:n.rendererService=new Srt,this.sceneService=n.sceneService,this.mapService=n.mapService,this.iconService=n.iconService,this.fontService=n.fontService,this.controlService=n.controlService,this.layerService=n.layerService,this.debugService=n.debugService,this.debugService.setEnable(r.debug),this.markerService=n.markerService,this.interactionService=n.interactionService,this.popupService=n.popupService,this.boxSelect=new Xrt(this,{}),this.initComponent(t),this.sceneService.init(r),this.initControl()}get map(){return this.mapService.map}get loaded(){return this.sceneService.loaded}getServiceContainer(){return this.container}getSize(){return this.mapService.getSize()}getMinZoom(){return this.mapService.getMinZoom()}getMaxZoom(){return this.mapService.getMaxZoom()}getType(){return this.mapService.getType()}getMapContainer(){return this.mapService.getMapContainer()}getMapCanvasContainer(){return this.mapService.getMapCanvasContainer()}getMapService(){return this.mapService}getDebugService(){return this.debugService}exportPng(r){return Nh(this,null,function*(){return this.sceneService.exportPng(r)})}exportMap(r){return Nh(this,null,function*(){return this.sceneService.exportPng(r)})}registerRenderService(r){this.sceneService.loaded?new r(this).init():this.on("loaded",()=>{new r(this).init()})}setBgColor(r){this.mapService.setBgColor(r)}addLayer(r){this.loaded?this.preAddLayer(r):this.once("loaded",()=>{this.preAddLayer(r)})}preAddLayer(r){const t=gf(this.container);if(r.setContainer(t),this.sceneService.addLayer(r),r.inited){this.initTileLayer(r);const e=this.initMask(r);this.addMask(e,r.id)}else r.on("inited",()=>{this.initTileLayer(r);const e=this.initMask(r);this.addMask(e,r.id)})}initMask(r){const{mask:t,maskfence:e,maskColor:i="#000",maskOpacity:n=0}=r.getLayerConfig();return!t||!e?void 0:new iB().source(e).shape("fill").style({color:i,opacity:n})}addMask(r,t){if(!r)return;const e=this.getLayer(t);if(e){const i=gf(this.container);r.setContainer(i),e.addMaskLayer(r),this.sceneService.addMask(r)}else console.warn("parent layer not find!")}getPickedLayer(){return this.layerService.pickedLayerId}getLayers(){return this.layerService.getLayers()}getLayer(r){return this.layerService.getLayer(r)}getLayerByName(r){return this.layerService.getLayerByName(r)}removeLayer(r,t){return Nh(this,null,function*(){yield this.layerService.remove(r,t)})}removeAllLayer(){return Nh(this,null,function*(){yield this.layerService.removeAllLayers()})}render(){this.sceneService.render()}setEnableRender(r){this.layerService.setEnableRender(r)}addIconFont(r,t){this.fontService.addIconFont(r,t)}addIconFonts(r){r.forEach(([t,e])=>{this.fontService.addIconFont(t,e)})}addFontFace(r,t){this.fontService.once("fontloaded",e=>{this.emit("fontloaded",e)}),this.fontService.addFontFace(r,t)}addImage(r,t){return Nh(this,null,function*(){yield this.iconService.addImage(r,t)})}hasImage(r){return this.iconService.hasImage(r)}removeImage(r){this.iconService.removeImage(r)}addIconFontGlyphs(r,t){this.fontService.addIconGlyphs(t)}addControl(r){this.controlService.addControl(r,this.container)}removeControl(r){this.controlService.removeControl(r)}getControlByName(r){return this.controlService.getControlByName(r)}addMarker(r){this.markerService.addMarker(r)}addMarkerLayer(r){this.markerService.addMarkerLayer(r)}removeMarkerLayer(r){this.markerService.removeMarkerLayer(r)}removeAllMarkers(){this.markerService.removeAllMarkers()}removeAllMakers(){console.warn("removeAllMakers 已废弃，请使用 removeAllMarkers"),this.markerService.removeAllMarkers()}addPopup(r){this.popupService.addPopup(r)}removePopup(r){this.popupService.removePopup(r)}on(r,t){var e;Jy.includes(r)?(e=this.boxSelect)==null||e.on(r,t):Sv.includes(r)?this.sceneService.on(r,t):this.mapService.on(r,t)}once(r,t){var e;Jy.includes(r)?(e=this.boxSelect)==null||e.once(r,t):Sv.includes(r)?this.sceneService.once(r,t):this.mapService.once(r,t)}emit(r,t){Sv.indexOf(r)===-1?this.mapService.on(r,t):this.sceneService.emit(r,t)}off(r,t){var e;Jy.includes(r)?(e=this.boxSelect)==null||e.off(r,t):Sv.includes(r)?this.sceneService.off(r,t):this.mapService.off(r,t)}getZoom(){return this.mapService.getZoom()}getCenter(r){return this.mapService.getCenter(r)}setCenter(r,t){return this.mapService.setCenter(r,t)}getPitch(){return this.mapService.getPitch()}setPitch(r){return this.mapService.setPitch(r)}getRotation(){return this.mapService.getRotation()}getBounds(){return this.mapService.getBounds()}setRotation(r){this.mapService.setRotation(r)}zoomIn(){this.mapService.zoomIn()}zoomOut(){this.mapService.zoomOut()}panTo(r){this.mapService.panTo(r)}panBy(r,t){this.mapService.panBy(r,t)}getContainer(){return this.mapService.getContainer()}setZoom(r){this.mapService.setZoom(r)}fitBounds(r,t){const{fitBoundsOptions:e,animate:i}=this.sceneService.getSceneConfig();this.mapService.fitBounds(r,t||Jrt(Qrt({},e),{animate:i}))}setZoomAndCenter(r,t){this.mapService.setZoomAndCenter(r,t)}setMapStyle(r){this.mapService.setMapStyle(r)}setMapStatus(r){this.mapService.setMapStatus(r)}pixelToLngLat(r){return this.mapService.pixelToLngLat(r)}lngLatToPixel(r){return this.mapService.lngLatToPixel(r)}containerToLngLat(r){return this.mapService.containerToLngLat(r)}lngLatToContainer(r){return this.mapService.lngLatToContainer(r)}destroy(){this.sceneService.destroy()}registerPostProcessingPass(r){this.container.postProcessingPass.name=new r}enableShaderPick(){this.layerService.enableShaderPick()}diasbleShaderPick(){this.layerService.disableShaderPick()}enableBoxSelect(r=!0){this.boxSelect.enable(),r&&this.boxSelect.once("selectend",()=>{this.disableBoxSelect()})}disableBoxSelect(){this.boxSelect.disable()}static addProtocol(r,t){Hp.REGISTERED_PROTOCOLS[r]=t}static removeProtocol(r){delete Hp.REGISTERED_PROTOCOLS[r]}getProtocol(r){return Hp.REGISTERED_PROTOCOLS[r]}startAnimate(){this.layerService.startAnimate()}stopAnimate(){this.layerService.stopAnimate()}getPointSizeRange(){return this.sceneService.getPointSizeRange()}initComponent(r){this.controlService.init({container:m$(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}initControl(){const{logoVisible:r,logoPosition:t}=this.sceneService.getSceneConfig();r&&this.addControl(new Aj({position:t}))}initTileLayer(r){r.getSource().isTile&&(r.tileLayer=new gQ(r))}},dn=function(r){return r!==null&&typeof r!="function"&&isFinite(r.length)},gl=function(r,t){return dn(r)?r.indexOf(t)>-1:!1},Ur=function(r,t){if(!dn(r))return r;for(var e=[],i=0;i<r.length;i++){var n=r[i];t(n,i)&&e.push(n)}return e},eit=function(r,t){return t===void 0&&(t=[]),Ur(r,function(e){return!gl(t,e)})},rit={}.toString,Ws=function(r,t){return rit.call(r)==="[object "+t+"]"};const ut=function(r){return Ws(r,"Function")};var j=function(r){return r==null};const Z=function(r){return Array.isArray?Array.isArray(r):Ws(r,"Array")},re=function(r){var t=typeof r;return r!==null&&t==="object"||t==="function"};function R(r,t){if(r){var e;if(Z(r))for(var i=0,n=r.length;i<n&&(e=t(r[i],i),e!==!1);i++);else if(re(r)){for(var a in r)if(r.hasOwnProperty(a)&&(e=t(r[a],a),e===!1))break}}}var Kc=Object.keys?function(r){return Object.keys(r)}:function(r){var t=[];return R(r,function(e,i){ut(r)&&i==="prototype"||t.push(i)}),t};function DB(r,t){var e=Kc(t),i=e.length;if(j(r))return!i;for(var n=0;n<i;n+=1){var a=e[n];if(t[a]!==r[a]||!(a in r))return!1}return!0}var U1=function(r){return typeof r=="object"&&r!==null},Va=function(r){if(!U1(r)||!Ws(r,"Object"))return!1;if(Object.getPrototypeOf(r)===null)return!0;for(var t=r;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(r)===t};function pa(r,t){if(!Z(r))return null;var e;if(ut(t)&&(e=t),Va(t)&&(e=function(n){return DB(n,t)}),e){for(var i=0;i<r.length;i+=1)if(e(r[i]))return r[i]}return null}function NB(r,t,e){e===void 0&&(e=0);for(var i=e;i<r.length;i++)if(t(r[i],i))return i;return-1}var iit=function(r,t){for(var e=null,i=0;i<r.length;i++){var n=r[i],a=n[t];if(!j(a)){Z(a)?e=a[0]:e=a;break}}return e},vn=function(r){if(!Z(r))return[];for(var t=[],e=0;e<r.length;e++)t=t.concat(r[e]);return t};const pn=function(r){if(Z(r))return r.reduce(function(t,e){return Math.max(t,e)},r[0])},Wn=function(r){if(Z(r))return r.reduce(function(t,e){return Math.min(t,e)},r[0])};var kB=function(r){var t=r.filter(function(o){return!isNaN(o)});if(!t.length)return{min:0,max:0};if(Z(r[0])){for(var e=[],i=0;i<r.length;i++)e=e.concat(r[i]);t=e}var n=pn(t),a=Wn(t);return{min:a,max:n}},nit=Array.prototype.splice,ait=function(t,e){if(!dn(t))return[];for(var i=t?e.length:0,n=i-1;i--;){var a=void 0,o=e[i];(i===n||o!==a)&&(a=o,nit.call(t,o,1))}return t},oi=function(r,t,e){if(!Z(r)&&!Va(r))return r;var i=e;return R(r,function(n,a){i=t(i,n,a)}),i},oit=function(r,t){var e=[];if(!dn(r))return e;for(var i=-1,n=[],a=r.length;++i<a;){var o=r[i];t(o,i,r)&&(e.push(o),n.push(i))}return ait(r,n),e};const mt=function(r){return Ws(r,"String")};function sit(r,t){var e;if(ut(t))e=function(n,a){return t(n)-t(a)};else{var i=[];mt(t)?i.push(t):Z(t)&&(i=t),e=function(n,a){for(var o=0;o<i.length;o+=1){var s=i[o];if(n[s]>a[s])return 1;if(n[s]<a[s])return-1}return 0}}return r.sort(e),r}function Gl(r,t){t===void 0&&(t=new Map);var e=[];if(Array.isArray(r))for(var i=0,n=r.length;i<n;i++){var a=r[i];t.has(a)||(e.push(a),t.set(a,!0))}return e}const xa=function(r,t){for(var e=[],i={},n=0;n<r.length;n++){var a=r[n],o=a[t];if(!j(o)){Z(o)||(o=[o]);for(var s=0;s<o.length;s++){var l=o[s];i[l]||(e.push(l),i[l]=!0)}}}return e};function un(r){if(dn(r))return r[0]}function fr(r){if(dn(r)){var t=r;return t[t.length-1]}}var DE=function(r,t){for(var e=0;e<r.length;e++)if(!t(r[e],e))return!1;return!0},j0=function(r,t){for(var e=0;e<r.length;e++)if(t(r[e],e))return!0;return!1},lit=Object.prototype.hasOwnProperty;function cn(r,t){if(!t||!Z(r))return{};for(var e={},i=ut(t)?t:function(s){return s[t]},n,a=0;a<r.length;a++){var o=r[a];n=i(o),lit.call(e,n)?e[n].push(o):e[n]=[o]}return e}function UB(r,t){if(!t)return{0:r};if(!ut(t)){var e=Z(t)?t:t.replace(/\s+/g,"").split("*");t=function(i){for(var n="_",a=0,o=e.length;a<o;a++)n+=i[e[a]]&&i[e[a]].toString();return n}}return cn(r,t)}const uit=function(r,t){if(!t)return[r];var e=UB(r,t),i=[];for(var n in e)i.push(e[n]);return i};var Be=function(r,t,e){return r<t?t:r>e?e:r},t_=function(r,t){var e=t.toString(),i=e.indexOf(".");if(i===-1)return Math.round(r);var n=e.substr(i+1).length;return n>20&&(n=20),parseFloat(r.toFixed(n))},Mt=function(r){return Ws(r,"Number")},cit=1e-5;function Br(r,t,e){return e===void 0&&(e=cit),Math.abs(r-t)<e}const zB=function(r,t){if(Z(r)){for(var e,i=-1/0,n=0;n<r.length;n++){var a=r[n],o=ut(t)?t(a):a[t];o>i&&(e=a,i=o)}return e}},hit=function(r,t){if(Z(r)){for(var e,i=1/0,n=0;n<r.length;n++){var a=r[n],o=ut(t)?t(a):a[t];o<i&&(e=a,i=o)}return e}};var Z0=function(r,t){return(r%t+t)%t},fit=Math.PI/180,q0=function(r){return fit*r};const ws=function(r,t){return r.hasOwnProperty(t)};var K0=Object.values?function(r){return Object.values(r)}:function(r){var t=[];return R(r,function(e,i){ut(r)&&i==="prototype"||t.push(e)}),t};const Vd=function(r){return j(r)?"":r.toString()};var hu=function(r){return Vd(r).toLowerCase()},fu=function(r){var t=Vd(r);return t.charAt(0).toUpperCase()+t.substring(1)},dit={}.toString,vit=function(r){return dit.call(r).replace(/^\[object /,"").replace(/]$/,"")},Rs=function(r){return Ws(r,"Boolean")},HB=function(r){return Ws(r,"Date")},pit=function(r){return r===null},git=Object.prototype,mit=function(r){var t=r&&r.constructor,e=typeof t=="function"&&t.prototype||git;return r===e},Wr=function(r){return r===void 0},$B=function(r){return r instanceof Element||r instanceof HTMLDocument};function yit(r){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,16)};return t(r)}function _it(r){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;t(r)}function e_(r,t){for(var e in t)t.hasOwnProperty(e)&&e!=="constructor"&&t[e]!==void 0&&(r[e]=t[e])}function ye(r,t,e,i){return t&&e_(r,t),e&&e_(r,e),i&&e_(r,i),r}var Dr=function(r){if(typeof r!="object"||r===null)return r;var t;if(Z(r)){t=[];for(var e=0,i=r.length;e<i;e++)typeof r[e]=="object"&&r[e]!=null?t[e]=Dr(r[e]):t[e]=r[e]}else{t={};for(var n in r)typeof r[n]=="object"&&r[n]!=null?t[n]=Dr(r[n]):t[n]=r[n]}return t};function WB(r,t,e){var i;return function(){var n=this,a=arguments,o=function(){i=null,e||r.apply(n,a)},s=e&&!i;clearTimeout(i),i=setTimeout(o,t),s&&r.apply(n,a)}}const Qc=function(r,t){if(!ut(r))throw new TypeError("Expected a function");var e=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var a=t?t.apply(this,i):i[0],o=e.cache;if(o.has(a))return o.get(a);var s=r.apply(this,i);return o.set(a,s),s};return e.cache=new Map,e};var xit=5;function VB(r,t,e,i){e=e||0,i=i||xit;for(var n in t)if(t.hasOwnProperty(n)){var a=t[n];a!==null&&Va(a)?(Va(r[n])||(r[n]={}),e<i?VB(r[n],a,e+1,i):r[n]=t[n]):Z(a)?(r[n]=[],r[n]=r[n].concat(a)):a!==void 0&&(r[n]=a)}}var nt=function(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];for(var i=0;i<t.length;i+=1)VB(r,t[i]);return r},GB=function(r,t){if(!dn(r))return-1;var e=Array.prototype.indexOf;if(e)return e.call(r,t);for(var i=-1,n=0;n<r.length;n++)if(r[n]===t){i=n;break}return i},Cit=Object.prototype.hasOwnProperty;function Gi(r){if(j(r))return!0;if(dn(r))return!r.length;var t=vit(r);if(t==="Map"||t==="Set")return!r.size;if(mit(r))return!Object.keys(r).length;for(var e in r)if(Cit.call(r,e))return!1;return!0}var Jt=function(r,t){if(r===t)return!0;if(!r||!t||mt(r)||mt(t))return!1;if(dn(r)||dn(t)){if(r.length!==t.length)return!1;for(var e=!0,i=0;i<r.length&&(e=Jt(r[i],t[i]),!!e);i++);return e}if(U1(r)||U1(t)){var n=Object.keys(r),a=Object.keys(t);if(n.length!==a.length)return!1;for(var e=!0,i=0;i<n.length&&(e=Jt(r[n[i]],t[n[i]]),!!e);i++);return e}return!1},Ne=function(r,t){if(!dn(r))return r;for(var e=[],i=0;i<r.length;i++){var n=r[i];e.push(t(n,i))}return e},Eit=function(r){return r};const Sit=function(r,t){t===void 0&&(t=Eit);var e={};return re(r)&&!j(r)&&Object.keys(r).forEach(function(i){e[i]=t(r[i],i)}),e},L=function(r,t,e){for(var i=0,n=mt(t)?t.split("."):t;r&&i<n.length;)r=r[n[i++]];return r===void 0||i<n.length?e:r},cr=function(r,t,e){var i=r,n=mt(t)?t.split("."):t;return n.forEach(function(a,o){o<n.length-1?(re(i[a])||(i[a]=Mt(n[o+1])?[]:{}),i=i[a]):i[a]=e}),r};var Ait=Object.prototype.hasOwnProperty;const Ga=function(r,t){if(r===null||!Va(r))return{};var e={};return R(t,function(i){Ait.call(r,i)&&(e[i]=r[i])}),e},Q0=function(r,t){return oi(r,function(e,i,n){return t.includes(n)||(e[n]=i),e},{})},NE=function(r,t,e){var i,n,a,o,s=0;e||(e={});var l=function(){s=e.leading===!1?0:Date.now(),i=null,o=r.apply(n,a),i||(n=a=null)},u=function(){var c=Date.now();!s&&e.leading===!1&&(s=c);var h=t-(c-s);return n=this,a=arguments,h<=0||h>t?(i&&(clearTimeout(i),i=null),s=c,o=r.apply(n,a),i||(n=a=null)):!i&&e.trailing!==!1&&(i=setTimeout(l,h)),o};return u.cancel=function(){clearTimeout(i),s=0,i=n=a=null},u},Tit=function(r){return dn(r)?Array.prototype.slice.call(r):[]};var Vv={};const Cn=function(r){return r=r||"g",Vv[r]?Vv[r]+=1:Vv[r]=1,r+Vv[r]},ms=function(){};function Tr(r){return j(r)?0:dn(r)?r.length:Object.keys(r).length}var Gv;const Xv=Qc(function(r,t){t===void 0&&(t={});var e=t.fontSize,i=t.fontFamily,n=t.fontWeight,a=t.fontStyle,o=t.fontVariant;return Gv||(Gv=document.createElement("canvas").getContext("2d")),Gv.font=[a,o,n,e+"px",i].join(" "),Gv.measureText(mt(r)?r:"").width},function(r,t){return t===void 0&&(t={}),kf([r],K0(t)).join("")}),bit=function(r,t,e,i){i===void 0&&(i="...");var n=16,a=Xv(i,e),o=mt(r)?r:Vd(r),s=t,l=[],u,c;if(Xv(r,e)<=t)return r;for(;u=o.substr(0,n),c=Xv(u,e),!(c+a>s&&c>s);)if(l.push(u),s-=c,o=o.substr(n),!o)return l.join("");for(;u=o.substr(0,1),c=Xv(u,e),!(c+a>s);)if(l.push(u),s-=c,o=o.substr(1),!o)return l.join("");return""+l.join("")+i};var wit=function(){function r(){this.map={}}return r.prototype.has=function(t){return this.map[t]!==void 0},r.prototype.get=function(t,e){var i=this.map[t];return i===void 0?e:i},r.prototype.set=function(t,e){this.map[t]=e},r.prototype.clear=function(){this.map={}},r.prototype.delete=function(t){delete this.map[t]},r.prototype.size=function(){return Object.keys(this.map).length},r}(),yf=`	
\v\f\r   ᠎             　\u2028\u2029`,Rit=new RegExp("([a-z])["+yf+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+yf+"]*,?["+yf+"]*)+)","ig"),Mit=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+yf+"]*,?["+yf+"]*","ig"),Yu=function(r){if(!r)return null;if(Z(r))return r;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(r).replace(Rit,function(i,n,a){var o=[],s=n.toLowerCase();if(a.replace(Mit,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(e.push([n].concat(o.splice(0,2))),s="l",n=n==="m"?"l":"L"),s==="o"&&o.length===1&&e.push([n,o[0]]),s==="r")e.push([n].concat(o));else for(;o.length>=t[s]&&(e.push([n].concat(o.splice(0,t[s]))),!!t[s]););return r}),e},z1=function(r,t){for(var e=[],i=0,n=r.length;n-2*!t>i;i+=2){var a=[{x:+r[i-2],y:+r[i-1]},{x:+r[i],y:+r[i+1]},{x:+r[i+2],y:+r[i+3]},{x:+r[i+4],y:+r[i+5]}];t?i?n-4===i?a[3]={x:+r[0],y:+r[1]}:n-2===i&&(a[2]={x:+r[0],y:+r[1]},a[3]={x:+r[2],y:+r[3]}):a[0]={x:+r[n-2],y:+r[n-1]}:n-4===i?a[3]=a[2]:i||(a[0]={x:+r[i],y:+r[i+1]}),e.push(["C",(-a[0].x+6*a[1].x+a[2].x)/6,(-a[0].y+6*a[1].y+a[2].y)/6,(a[1].x+6*a[2].x-a[3].x)/6,(a[1].y+6*a[2].y-a[3].y)/6,a[2].x,a[2].y])}return e},Yv=function(r,t,e,i,n){var a=[];if(n===null&&i===null&&(i=e),r=+r,t=+t,e=+e,i=+i,n!==null){var o=Math.PI/180,s=r+e*Math.cos(-i*o),l=r+e*Math.cos(-n*o),u=t+e*Math.sin(-i*o),c=t+e*Math.sin(-n*o);a=[["M",s,u],["A",e,e,0,+(n-i>180),0,l,c]]}else a=[["M",r,t],["m",0,-i],["a",e,i,0,1,1,0,2*i],["a",e,i,0,1,1,0,-2*i],["z"]];return a},H1=function(r){if(r=Yu(r),!r||!r.length)return[["M",0,0]];var t=[],e=0,i=0,n=0,a=0,o=0,s,l;r[0][0]==="M"&&(e=+r[0][1],i=+r[0][2],n=e,a=i,o++,t[0]=["M",e,i]);for(var u=r.length===3&&r[0][0]==="M"&&r[1][0].toUpperCase()==="R"&&r[2][0].toUpperCase()==="Z",c=void 0,h=void 0,f=o,d=r.length;f<d;f++){if(t.push(c=[]),h=r[f],s=h[0],s!==s.toUpperCase())switch(c[0]=s.toUpperCase(),c[0]){case"A":c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=+h[6]+e,c[7]=+h[7]+i;break;case"V":c[1]=+h[1]+i;break;case"H":c[1]=+h[1]+e;break;case"R":l=[e,i].concat(h.slice(1));for(var v=2,p=l.length;v<p;v++)l[v]=+l[v]+e,l[++v]=+l[v]+i;t.pop(),t=t.concat(z1(l,u));break;case"O":t.pop(),l=Yv(e,i,h[1],h[2]),l.push(l[0]),t=t.concat(l);break;case"U":t.pop(),t=t.concat(Yv(e,i,h[1],h[2],h[3])),c=["U"].concat(t[t.length-1].slice(-2));break;case"M":n=+h[1]+e,a=+h[2]+i;break;default:for(var v=1,p=h.length;v<p;v++)c[v]=+h[v]+(v%2?e:i)}else if(s==="R")l=[e,i].concat(h.slice(1)),t.pop(),t=t.concat(z1(l,u)),c=["R"].concat(h.slice(-2));else if(s==="O")t.pop(),l=Yv(e,i,h[1],h[2]),l.push(l[0]),t=t.concat(l);else if(s==="U")t.pop(),t=t.concat(Yv(e,i,h[1],h[2],h[3])),c=["U"].concat(t[t.length-1].slice(-2));else for(var g=0,m=h.length;g<m;g++)c[g]=h[g];if(s=s.toUpperCase(),s!=="O")switch(c[0]){case"Z":e=+n,i=+a;break;case"H":e=c[1];break;case"V":i=c[1];break;case"M":n=c[c.length-2],a=c[c.length-1];break;default:e=c[c.length-2],i=c[c.length-1]}}return t},jv=function(r,t,e,i){return[r,t,e,i,e,i]},ER=function(r,t,e,i,n,a){var o=.3333333333333333,s=2/3;return[o*r+s*e,o*t+s*i,o*n+s*e,o*a+s*i,n,a]},XB=function(r,t,e,i,n,a,o,s,l,u){e===i&&(e+=1);var c=Math.PI*120/180,h=Math.PI/180*(+n||0),f=[],d,v,p,g,m,y=function(le,me,We){var Ri=le*Math.cos(We)-me*Math.sin(We),tn=le*Math.sin(We)+me*Math.cos(We);return{x:Ri,y:tn}};if(u)v=u[0],p=u[1],g=u[2],m=u[3];else{d=y(r,t,-h),r=d.x,t=d.y,d=y(s,l,-h),s=d.x,l=d.y,r===s&&t===l&&(s+=1,l+=1);var _=(r-s)/2,x=(t-l)/2,C=_*_/(e*e)+x*x/(i*i);C>1&&(C=Math.sqrt(C),e=C*e,i=C*i);var A=e*e,T=i*i,w=(a===o?-1:1)*Math.sqrt(Math.abs((A*T-A*x*x-T*_*_)/(A*x*x+T*_*_)));g=w*e*x/i+(r+s)/2,m=w*-i*_/e+(t+l)/2,v=Math.asin(((t-m)/i).toFixed(9)),p=Math.asin(((l-m)/i).toFixed(9)),v=r<g?Math.PI-v:v,p=s<g?Math.PI-p:p,v<0&&(v=Math.PI*2+v),p<0&&(p=Math.PI*2+p),o&&v>p&&(v=v-Math.PI*2),!o&&p>v&&(p=p-Math.PI*2)}var M=p-v;if(Math.abs(M)>c){var O=p,P=s,D=l;p=v+c*(o&&p>v?1:-1),s=g+e*Math.cos(p),l=m+i*Math.sin(p),f=XB(s,l,e,i,n,0,o,P,D,[p,O,g,m])}M=p-v;var z=Math.cos(v),Y=Math.sin(v),H=Math.cos(p),N=Math.sin(p),W=Math.tan(M/4),Q=4/3*e*W,q=4/3*i*W,J=[r,t],et=[r+Q*Y,t-q*z],ft=[s+Q*N,l-q*H],Ct=[s,l];if(et[0]=2*J[0]-et[0],et[1]=2*J[1]-et[1],u)return[et,ft,Ct].concat(f);f=[et,ft,Ct].concat(f).join().split(",");for(var ct=[],dt=0,Rt=f.length;dt<Rt;dt++)ct[dt]=dt%2?y(f[dt-1],f[dt],h).y:y(f[dt],f[dt+1],h).x;return ct},$1=function(r,t){var e=H1(r),i=t&&H1(t),n={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=[],s=[],l="",u="",c,h=function(_,x,C){var A,T;if(!_)return["C",x.x,x.y,x.x,x.y,x.x,x.y];switch(!(_[0]in{T:1,Q:1})&&(x.qx=x.qy=null),_[0]){case"M":x.X=_[1],x.Y=_[2];break;case"A":_=["C"].concat(XB.apply(0,[x.x,x.y].concat(_.slice(1))));break;case"S":C==="C"||C==="S"?(A=x.x*2-x.bx,T=x.y*2-x.by):(A=x.x,T=x.y),_=["C",A,T].concat(_.slice(1));break;case"T":C==="Q"||C==="T"?(x.qx=x.x*2-x.qx,x.qy=x.y*2-x.qy):(x.qx=x.x,x.qy=x.y),_=["C"].concat(ER(x.x,x.y,x.qx,x.qy,_[1],_[2]));break;case"Q":x.qx=_[1],x.qy=_[2],_=["C"].concat(ER(x.x,x.y,_[1],_[2],_[3],_[4]));break;case"L":_=["C"].concat(jv(x.x,x.y,_[1],_[2]));break;case"H":_=["C"].concat(jv(x.x,x.y,_[1],x.y));break;case"V":_=["C"].concat(jv(x.x,x.y,x.x,_[1]));break;case"Z":_=["C"].concat(jv(x.x,x.y,x.X,x.Y));break}return _},f=function(_,x){if(_[x].length>7){_[x].shift();for(var C=_[x];C.length;)o[x]="A",i&&(s[x]="A"),_.splice(x++,0,["C"].concat(C.splice(0,6)));_.splice(x,1),c=Math.max(e.length,i&&i.length||0)}},d=function(_,x,C,A,T){_&&x&&_[T][0]==="M"&&x[T][0]!=="M"&&(x.splice(T,0,["M",A.x,A.y]),C.bx=0,C.by=0,C.x=_[T][1],C.y=_[T][2],c=Math.max(e.length,i&&i.length||0))};c=Math.max(e.length,i&&i.length||0);for(var v=0;v<c;v++){e[v]&&(l=e[v][0]),l!=="C"&&(o[v]=l,v&&(u=o[v-1])),e[v]=h(e[v],n,u),o[v]!=="A"&&l==="C"&&(o[v]="C"),f(e,v),i&&(i[v]&&(l=i[v][0]),l!=="C"&&(s[v]=l,v&&(u=s[v-1])),i[v]=h(i[v],a,u),s[v]!=="A"&&l==="C"&&(s[v]="C"),f(i,v)),d(e,i,n,a,v),d(i,e,a,n,v);var p=e[v],g=i&&i[v],m=p.length,y=i&&g.length;n.x=p[m-2],n.y=p[m-1],n.bx=parseFloat(p[m-4])||n.x,n.by=parseFloat(p[m-3])||n.y,a.bx=i&&(parseFloat(g[y-4])||a.x),a.by=i&&(parseFloat(g[y-3])||a.y),a.x=i&&g[y-2],a.y=i&&g[y-1]}return i?[e,i]:e},Iit=/,?([a-z]),?/gi,YB=function(r){return r.join(",").replace(Iit,"$1")},SR=function(r,t,e,i,n){var a=-3*t+9*e-9*i+3*n,o=r*a+6*t-12*e+6*i;return r*o-3*t+3*e},AR=function(r,t,e,i,n,a,o,s,l){l===null&&(l=1),l=l>1?1:l<0?0:l;for(var u=l/2,c=12,h=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],f=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],d=0,v=0;v<c;v++){var p=u*h[v]+u,g=SR(p,r,e,n,o),m=SR(p,t,i,a,s),y=g*g+m*m;d+=f[v]*Math.sqrt(y)}return u*d},Lit=function(r,t,e,i,n,a,o,s){for(var l=[],u=[[],[]],c,h,f,d,v=0;v<2;++v){if(v===0?(h=6*r-12*e+6*n,c=-3*r+9*e-9*n+3*o,f=3*e-3*r):(h=6*t-12*i+6*a,c=-3*t+9*i-9*a+3*s,f=3*i-3*t),Math.abs(c)<1e-12){if(Math.abs(h)<1e-12)continue;d=-f/h,d>0&&d<1&&l.push(d);continue}var p=h*h-4*f*c,g=Math.sqrt(p);if(!(p<0)){var m=(-h+g)/(2*c);m>0&&m<1&&l.push(m);var y=(-h-g)/(2*c);y>0&&y<1&&l.push(y)}}for(var _=l.length,x=_,C;_--;)d=l[_],C=1-d,u[0][_]=C*C*C*r+3*C*C*d*e+3*C*d*d*n+d*d*d*o,u[1][_]=C*C*C*t+3*C*C*d*i+3*C*d*d*a+d*d*d*s;return u[0][x]=r,u[1][x]=t,u[0][x+1]=o,u[1][x+1]=s,u[0].length=u[1].length=x+2,{min:{x:Math.min.apply(0,u[0]),y:Math.min.apply(0,u[1])},max:{x:Math.max.apply(0,u[0]),y:Math.max.apply(0,u[1])}}},Oit=function(r,t,e,i,n,a,o,s){if(!(Math.max(r,e)<Math.min(n,o)||Math.min(r,e)>Math.max(n,o)||Math.max(t,i)<Math.min(a,s)||Math.min(t,i)>Math.max(a,s))){var l=(r*i-t*e)*(n-o)-(r-e)*(n*s-a*o),u=(r*i-t*e)*(a-s)-(t-i)*(n*s-a*o),c=(r-e)*(a-s)-(t-i)*(n-o);if(c){var h=l/c,f=u/c,d=+h.toFixed(2),v=+f.toFixed(2);if(!(d<+Math.min(r,e).toFixed(2)||d>+Math.max(r,e).toFixed(2)||d<+Math.min(n,o).toFixed(2)||d>+Math.max(n,o).toFixed(2)||v<+Math.min(t,i).toFixed(2)||v>+Math.max(t,i).toFixed(2)||v<+Math.min(a,s).toFixed(2)||v>+Math.max(a,s).toFixed(2)))return{x:h,y:f}}}},rs=function(r,t,e){return t>=r.x&&t<=r.x+r.width&&e>=r.y&&e<=r.y+r.height},jB=function(r,t,e,i,n){if(n)return[["M",+r+ +n,t],["l",e-n*2,0],["a",n,n,0,0,1,n,n],["l",0,i-n*2],["a",n,n,0,0,1,-n,n],["l",n*2-e,0],["a",n,n,0,0,1,-n,-n],["l",0,n*2-i],["a",n,n,0,0,1,n,-n],["z"]];var a=[["M",r,t],["l",e,0],["l",0,i],["l",-e,0],["z"]];return a.parsePathArray=YB,a},W1=function(r,t,e,i){return r===null&&(r=t=e=i=0),t===null&&(t=r.y,e=r.width,i=r.height,r=r.x),{x:r,y:t,width:e,w:e,height:i,h:i,x2:r+e,y2:t+i,cx:r+e/2,cy:t+i/2,r1:Math.min(e,i)/2,r2:Math.max(e,i)/2,r0:Math.sqrt(e*e+i*i)/2,path:jB(r,t,e,i),vb:[r,t,e,i].join(" ")}},Pit=function(r,t){return r=W1(r),t=W1(t),rs(t,r.x,r.y)||rs(t,r.x2,r.y)||rs(t,r.x,r.y2)||rs(t,r.x2,r.y2)||rs(r,t.x,t.y)||rs(r,t.x2,t.y)||rs(r,t.x,t.y2)||rs(r,t.x2,t.y2)||(r.x<t.x2&&r.x>t.x||t.x<r.x2&&t.x>r.x)&&(r.y<t.y2&&r.y>t.y||t.y<r.y2&&t.y>r.y)},TR=function(r,t,e,i,n,a,o,s){Z(r)||(r=[r,t,e,i,n,a,o,s]);var l=Lit.apply(null,r);return W1(l.min.x,l.min.y,l.max.x-l.min.x,l.max.y-l.min.y)},bR=function(r,t,e,i,n,a,o,s,l){var u=1-l,c=Math.pow(u,3),h=Math.pow(u,2),f=l*l,d=f*l,v=c*r+h*3*l*e+u*3*l*l*n+d*o,p=c*t+h*3*l*i+u*3*l*l*a+d*s,g=r+2*l*(e-r)+f*(n-2*e+r),m=t+2*l*(i-t)+f*(a-2*i+t),y=e+2*l*(n-e)+f*(o-2*n+e),_=i+2*l*(a-i)+f*(s-2*a+i),x=u*r+l*e,C=u*t+l*i,A=u*n+l*o,T=u*a+l*s,w=90-Math.atan2(g-y,m-_)*180/Math.PI;return{x:v,y:p,m:{x:g,y:m},n:{x:y,y:_},start:{x,y:C},end:{x:A,y:T},alpha:w}},Fit=function(r,t,e){var i=TR(r),n=TR(t);if(!Pit(i,n))return e?0:[];for(var a=AR.apply(0,r),o=AR.apply(0,t),s=~~(a/8),l=~~(o/8),u=[],c=[],h={},f=e?0:[],d=0;d<s+1;d++){var v=bR.apply(0,r.concat(d/s));u.push({x:v.x,y:v.y,t:d/s})}for(var d=0;d<l+1;d++){var v=bR.apply(0,t.concat(d/l));c.push({x:v.x,y:v.y,t:d/l})}for(var d=0;d<s;d++)for(var p=0;p<l;p++){var g=u[d],m=u[d+1],y=c[p],_=c[p+1],x=Math.abs(m.x-g.x)<.001?"y":"x",C=Math.abs(_.x-y.x)<.001?"y":"x",A=Oit(g.x,g.y,m.x,m.y,y.x,y.y,_.x,_.y);if(A){if(h[A.x.toFixed(4)]===A.y.toFixed(4))continue;h[A.x.toFixed(4)]=A.y.toFixed(4);var T=g.t+Math.abs((A[x]-g[x])/(m[x]-g[x]))*(m.t-g.t),w=y.t+Math.abs((A[C]-y[C])/(_[C]-y[C]))*(_.t-y.t);T>=0&&T<=1&&w>=0&&w<=1&&(e?f+=1:f.push({x:A.x,y:A.y,t1:T,t2:w}))}}return f},Bit=function(r,t,e){r=$1(r),t=$1(t);for(var i,n,a,o,s,l,u,c,h,f,d=e?0:[],v=0,p=r.length;v<p;v++){var g=r[v];if(g[0]==="M")i=s=g[1],n=l=g[2];else{g[0]==="C"?(h=[i,n].concat(g.slice(1)),i=h[6],n=h[7]):(h=[i,n,i,n,s,l,s,l],i=s,n=l);for(var m=0,y=t.length;m<y;m++){var _=t[m];if(_[0]==="M")a=u=_[1],o=c=_[2];else{_[0]==="C"?(f=[a,o].concat(_.slice(1)),a=f[6],o=f[7]):(f=[a,o,a,o,u,c,u,c],a=u,o=c);var x=Fit(h,f,e);if(e)d+=x;else{for(var C=0,A=x.length;C<A;C++)x[C].segment1=v,x[C].segment2=m,x[C].bez1=h,x[C].bez2=f;d=d.concat(x)}}}}}return d},Dit=function(r,t){return Bit(r,t)};function Nit(r,t){var e=[],i=[];function n(a,o){if(a.length===1)e.push(a[0]),i.push(a[0]);else{for(var s=[],l=0;l<a.length-1;l++)l===0&&e.push(a[0]),l===a.length-2&&i.push(a[l+1]),s[l]=[(1-o)*a[l][0]+o*a[l+1][0],(1-o)*a[l][1]+o*a[l+1][1]];n(s,o)}}return r.length&&n(r,t),{left:e,right:i.reverse()}}function kit(r,t,e){var i=[[r[1],r[2]]];e=e||2;var n=[];t[0]==="A"?(i.push(t[6]),i.push(t[7])):t[0]==="C"?(i.push([t[1],t[2]]),i.push([t[3],t[4]]),i.push([t[5],t[6]])):t[0]==="S"||t[0]==="Q"?(i.push([t[1],t[2]]),i.push([t[3],t[4]])):i.push([t[1],t[2]]);for(var a=i,o=1/e,s=0;s<e-1;s++){var l=o/(1-o*s),u=Nit(a,l);n.push(u.left),a=u.right}n.push(a);var c=n.map(function(h){var f=[];return h.length===4&&(f.push("C"),f=f.concat(h[2])),h.length>=3&&(h.length===3&&f.push("Q"),f=f.concat(h[1])),h.length===2&&f.push("L"),f=f.concat(h[h.length-1]),f});return c}var Uit=function(r,t,e){if(e===1)return[[].concat(r)];var i=[];if(t[0]==="L"||t[0]==="C"||t[0]==="Q")i=i.concat(kit(r,t,e));else{var n=[].concat(r);n[0]==="M"&&(n[0]="L");for(var a=0;a<=e-1;a++)i.push(n)}return i},zit=function(r,t){if(r.length===1)return r;var e=r.length-1,i=t.length-1,n=e/i,a=[];if(r.length===1&&r[0][0]==="M"){for(var o=0;o<i-e;o++)r.push(r[0]);return r}for(var o=0;o<i;o++){var s=Math.floor(n*o);a[s]=(a[s]||0)+1}var l=a.reduce(function(u,c,h){return h===e?u.concat(r[e]):u.concat(Uit(r[h],r[h+1],c))},[]);return l.unshift(r[0]),(t[i]==="Z"||t[i]==="z")&&l.push("Z"),l},Hit=function(r,t){if(r.length!==t.length)return!1;var e=!0;return R(r,function(i,n){if(i!==t[n])return e=!1,!1}),e};function $it(r,t,e){var i=null,n=e;return t<n&&(n=t,i="add"),r<n&&(n=r,i="del"),{type:i,min:n}}var Wit=function(r,t){var e=r.length,i=t.length,n,a,o=0;if(e===0||i===0)return null;for(var s=[],l=0;l<=e;l++)s[l]=[],s[l][0]={min:l};for(var u=0;u<=i;u++)s[0][u]={min:u};for(var l=1;l<=e;l++){n=r[l-1];for(var u=1;u<=i;u++){a=t[u-1],Hit(n,a)?o=0:o=1;var c=s[l-1][u].min+1,h=s[l][u-1].min+1,f=s[l-1][u-1].min+o;s[l][u]=$it(c,h,f)}}return s},ZB=function(r,t){var e=Wit(r,t),i=r.length,n=t.length,a=[],o=1,s=1;if(e[i][n].min!==i){for(var l=1;l<=i;l++){var u=e[l][l].min;s=l;for(var c=o;c<=n;c++)e[l][c].min<u&&(u=e[l][c].min,s=c);o=s,e[l][o].type&&a.push({index:l-1,type:e[l][o].type})}for(var l=a.length-1;l>=0;l--)o=a[l].index,a[l].type==="add"?r.splice(o,0,[].concat(r[o])):r.splice(o,1)}i=r.length;var h=n-i;if(i<n)for(var l=0;l<h;l++)r[i-1][0]==="z"||r[i-1][0]==="Z"?r.splice(i-2,0,r[i-2]):r.push(r[i-1]),i+=1;return r};function r_(r,t,e){for(var i=[].concat(r),n,a=1/(e+1),o=qB(t)[0],s=1;s<=e;s++)a*=s,n=Math.floor(r.length*a),n===0?i.unshift([o[0]*a+r[n][0]*(1-a),o[1]*a+r[n][1]*(1-a)]):i.splice(n,0,[o[0]*a+r[n][0]*(1-a),o[1]*a+r[n][1]*(1-a)]);return i}function qB(r){var t=[];switch(r[0]){case"M":t.push([r[1],r[2]]);break;case"L":t.push([r[1],r[2]]);break;case"A":t.push([r[6],r[7]]);break;case"Q":t.push([r[3],r[4]]),t.push([r[1],r[2]]);break;case"T":t.push([r[1],r[2]]);break;case"C":t.push([r[5],r[6]]),t.push([r[1],r[2]]),t.push([r[3],r[4]]);break;case"S":t.push([r[3],r[4]]),t.push([r[1],r[2]]);break;case"H":t.push([r[1],r[1]]);break;case"V":t.push([r[1],r[1]]);break}return t}var V1=function(r,t){if(r.length<=1)return r;for(var e,i=0;i<t.length;i++)if(r[i][0]!==t[i][0])switch(e=qB(r[i]),t[i][0]){case"M":r[i]=["M"].concat(e[0]);break;case"L":r[i]=["L"].concat(e[0]);break;case"A":r[i]=[].concat(t[i]),r[i][6]=e[0][0],r[i][7]=e[0][1];break;case"Q":if(e.length<2)if(i>0)e=r_(e,r[i-1],1);else{r[i]=t[i];break}r[i]=["Q"].concat(e.reduce(function(n,a){return n.concat(a)},[]));break;case"T":r[i]=["T"].concat(e[0]);break;case"C":if(e.length<3)if(i>0)e=r_(e,r[i-1],2);else{r[i]=t[i];break}r[i]=["C"].concat(e.reduce(function(n,a){return n.concat(a)},[]));break;case"S":if(e.length<2)if(i>0)e=r_(e,r[i-1],1);else{r[i]=t[i];break}r[i]=["S"].concat(e.reduce(function(n,a){return n.concat(a)},[]));break;default:r[i]=t[i]}return r};const kE=Object.freeze(Object.defineProperty({__proto__:null,catmullRomToBezier:z1,fillPath:zit,fillPathByDiff:ZB,formatPath:V1,intersection:Dit,parsePathArray:YB,parsePathString:Yu,pathToAbsolute:H1,pathToCurve:$1,rectPath:jB},Symbol.toStringTag,{value:"Module"}));var Gd=function(){function r(t,e){this.bubbles=!0,this.target=null,this.currentTarget=null,this.delegateTarget=null,this.delegateObject=null,this.defaultPrevented=!1,this.propagationStopped=!1,this.shape=null,this.fromShape=null,this.toShape=null,this.propagationPath=[],this.type=t,this.name=t,this.originalEvent=e,this.timeStamp=e.timeStamp}return r.prototype.preventDefault=function(){this.defaultPrevented=!0,this.originalEvent.preventDefault&&this.originalEvent.preventDefault()},r.prototype.stopPropagation=function(){this.propagationStopped=!0},r.prototype.toString=function(){var t=this.type;return"[Event (type="+t+")]"},r.prototype.save=function(){},r.prototype.restore=function(){},r}(),Vit="*",du=function(){function r(){this._events={}}return r.prototype.on=function(t,e,i){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!i}),this},r.prototype.once=function(t,e){return this.on(t,e,!0)},r.prototype.emit=function(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var a=this._events[t]||[],o=this._events[Vit]||[],s=function(l){for(var u=l.length,c=0;c<u;c++)if(l[c]){var h=l[c],f=h.callback,d=h.once;d&&(l.splice(c,1),l.length===0&&delete e._events[t],u--,c--),f.apply(e,i)}};s(a),s(o)},r.prototype.off=function(t,e){if(!t)this._events={};else if(!e)delete this._events[t];else{for(var i=this._events[t]||[],n=i.length,a=0;a<n;a++)i[a].callback===e&&(i.splice(a,1),n--,a--);i.length===0&&delete this._events[t]}return this},r.prototype.getEvents=function(){return this._events},r}();function KB(r,t){var e=r.indexOf(t);e!==-1&&r.splice(e,1)}var wR=typeof window<"u"&&typeof window.document<"u";function QB(r,t){if(r.isCanvas())return!0;for(var e=t.getParent(),i=!1;e;){if(e===r){i=!0;break}e=e.getParent()}return i}function Xf(r){return r.cfg.visible&&r.cfg.capture}var J0=function(r){B(t,r);function t(e){var i=r.call(this)||this;i.destroyed=!1;var n=i.getDefaultCfg();return i.cfg=ye(n,e),i}return t.prototype.getDefaultCfg=function(){return{}},t.prototype.get=function(e){return this.cfg[e]},t.prototype.set=function(e,i){this.cfg[e]=i},t.prototype.destroy=function(){this.cfg={destroyed:!0},this.off(),this.destroyed=!0},t}(du);function ku(r,t,e){var i=[0,0,0,0,0,0,0,0,0];return eH(i,e),N0(r,i,t)}function UE(r,t,e){var i=[0,0,0,0,0,0,0,0,0];return rH(i,e),N0(r,i,t)}function JB(r,t,e){var i=[0,0,0,0,0,0,0,0,0];return iH(i,e),N0(r,i,t)}function Git(r,t,e){return N0(r,e,t)}function hr(r,t){for(var e=r?[].concat(r):[1,0,0,0,1,0,0,0,1],i=0,n=t.length;i<n;i++){var a=t[i];switch(a[0]){case"t":ku(e,e,[a[1],a[2]]);break;case"s":JB(e,e,[a[1],a[2]]);break;case"r":UE(e,e,a[1]);break;case"m":Git(e,e,a[1]);break}}return e}function Xit(r,t){return r[0]*t[1]-t[0]*r[1]}function zE(r,t,e){var i=l1(r,t),n=Xit(r,t)>=0;return e?n?Math.PI*2-i:i:n?i:Math.PI*2-i}function RR(r,t){var e=[],i=r[0],n=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6],c=r[7],h=r[8],f=t[0],d=t[1],v=t[2],p=t[3],g=t[4],m=t[5],y=t[6],_=t[7],x=t[8];return e[0]=f*i+d*o+v*u,e[1]=f*n+d*s+v*c,e[2]=f*a+d*l+v*h,e[3]=p*i+g*o+m*u,e[4]=p*n+g*s+m*c,e[5]=p*a+g*l+m*h,e[6]=y*i+_*o+x*u,e[7]=y*n+_*s+x*c,e[8]=y*a+_*l+x*h,e}function Ao(r,t){var e=[],i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function tm(r){var t=[],e=r[0],i=r[1],n=r[2],a=r[3],o=r[4],s=r[5],l=r[6],u=r[7],c=r[8],h=c*o-s*u,f=-c*a+s*l,d=u*a-o*l,v=e*h+i*f+n*d;return v?(v=1/v,t[0]=h*v,t[1]=(-c*i+n*u)*v,t[2]=(s*i-n*o)*v,t[3]=f*v,t[4]=(c*e-n*l)*v,t[5]=(-s*e+n*a)*v,t[6]=d*v,t[7]=(-u*e+i*l)*v,t[8]=(o*e-i*a)*v,t):null}var kh=hr,i_="matrix",Yit=["zIndex","capture","visible","type"],jit=["repeat"],Zit=":",qit="*";function Kit(r){for(var t=[],e=0;e<r.length;e++)Z(r[e])?t.push([].concat(r[e])):t.push(r[e]);return t}function Qit(r,t){var e={},i=t.attrs;for(var n in r)e[n]=i[n];return e}function Jit(r,t){var e={},i=t.attr();return R(r,function(n,a){jit.indexOf(a)===-1&&!Jt(i[a],n)&&(e[a]=n)}),e}function tnt(r,t){if(t.onFrame)return r;var e=t.startTime,i=t.delay,n=t.duration,a=Object.prototype.hasOwnProperty;return R(r,function(o){e+i<o.startTime+o.delay+o.duration&&n>o.delay&&R(t.toAttrs,function(s,l){a.call(o.toAttrs,l)&&(delete o.toAttrs[l],delete o.fromAttrs[l])})}),r}var tD=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;i.attrs={};var n=i.getDefaultAttrs();return ye(n,e.attrs),i.attrs=n,i.initAttrs(n),i.initAnimate(),i}return t.prototype.getDefaultCfg=function(){return{visible:!0,capture:!0,zIndex:0}},t.prototype.getDefaultAttrs=function(){return{matrix:this.getDefaultMatrix(),opacity:1}},t.prototype.onCanvasChange=function(e){},t.prototype.initAttrs=function(e){},t.prototype.initAnimate=function(){this.set("animable",!0),this.set("animating",!1)},t.prototype.isGroup=function(){return!1},t.prototype.getParent=function(){return this.get("parent")},t.prototype.getCanvas=function(){return this.get("canvas")},t.prototype.attr=function(){for(var e,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var a=i[0],o=i[1];if(!a)return this.attrs;if(re(a)){for(var s in a)this.setAttr(s,a[s]);return this.afterAttrsChange(a),this}return i.length===2?(this.setAttr(a,o),this.afterAttrsChange((e={},e[a]=o,e)),this):this.attrs[a]},t.prototype.isClipped=function(e,i){var n=this.getClip();return n&&!n.isHit(e,i)},t.prototype.setAttr=function(e,i){var n=this.attrs[e];n!==i&&(this.attrs[e]=i,this.onAttrChange(e,i,n))},t.prototype.onAttrChange=function(e,i,n){e==="matrix"&&this.set("totalMatrix",null)},t.prototype.afterAttrsChange=function(e){if(this.cfg.isClipShape){var i=this.cfg.applyTo;i&&i.onCanvasChange("clip")}else this.onCanvasChange("attr")},t.prototype.show=function(){return this.set("visible",!0),this.onCanvasChange("show"),this},t.prototype.hide=function(){return this.set("visible",!1),this.onCanvasChange("hide"),this},t.prototype.setZIndex=function(e){this.set("zIndex",e);var i=this.getParent();return i&&i.sort(),this},t.prototype.toFront=function(){var e=this.getParent();if(e){var i=e.getChildren();this.get("el");var n=i.indexOf(this);i.splice(n,1),i.push(this),this.onCanvasChange("zIndex")}},t.prototype.toBack=function(){var e=this.getParent();if(e){var i=e.getChildren();this.get("el");var n=i.indexOf(this);i.splice(n,1),i.unshift(this),this.onCanvasChange("zIndex")}},t.prototype.remove=function(e){e===void 0&&(e=!0);var i=this.getParent();i?(KB(i.getChildren(),this),i.get("clearing")||this.onCanvasChange("remove")):this.onCanvasChange("remove"),e&&this.destroy()},t.prototype.resetMatrix=function(){this.attr(i_,this.getDefaultMatrix()),this.onCanvasChange("matrix")},t.prototype.getMatrix=function(){return this.attr(i_)},t.prototype.setMatrix=function(e){this.attr(i_,e),this.onCanvasChange("matrix")},t.prototype.getTotalMatrix=function(){var e=this.cfg.totalMatrix;if(!e){var i=this.attr("matrix"),n=this.cfg.parentMatrix;n&&i?e=RR(n,i):e=i||n,this.set("totalMatrix",e)}return e},t.prototype.applyMatrix=function(e){var i=this.attr("matrix"),n=null;e&&i?n=RR(e,i):n=i||e,this.set("totalMatrix",n),this.set("parentMatrix",e)},t.prototype.getDefaultMatrix=function(){return null},t.prototype.applyToMatrix=function(e){var i=this.attr("matrix");return i?Ao(i,e):e},t.prototype.invertFromMatrix=function(e){var i=this.attr("matrix");if(i){var n=tm(i);if(n)return Ao(n,e)}return e},t.prototype.setClip=function(e){var i=this.getCanvas(),n=null;if(e){var a=this.getShapeBase(),o=fu(e.type),s=a[o];s&&(n=new s({type:e.type,isClipShape:!0,applyTo:this,attrs:e.attrs,canvas:i}))}return this.set("clipShape",n),this.onCanvasChange("clip"),n},t.prototype.getClip=function(){var e=this.cfg.clipShape;return e||null},t.prototype.clone=function(){var e=this,i=this.attrs,n={};R(i,function(s,l){Z(i[l])?n[l]=Kit(i[l]):n[l]=i[l]});var a=this.constructor,o=new a({attrs:n});return R(Yit,function(s){o.set(s,e.get(s))}),o},t.prototype.destroy=function(){var e=this.destroyed;e||(this.attrs={},r.prototype.destroy.call(this))},t.prototype.isAnimatePaused=function(){return this.get("_pause").isPaused},t.prototype.animate=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(!(!this.get("timeline")&&!this.get("canvas"))){this.set("animating",!0);var n=this.get("timeline");n||(n=this.get("canvas").get("timeline"),this.set("timeline",n));var a=this.get("animations")||[];n.timer||n.initTimer();var o=e[0],s=e[1],l=e[2],u=l===void 0?"easeLinear":l,c=e[3],h=c===void 0?ms:c,f=e[4],d=f===void 0?0:f,v,p,g,m,y;ut(o)?(v=o,o={}):re(o)&&o.onFrame&&(v=o.onFrame,p=o.repeat),re(s)?(y=s,s=y.duration,u=y.easing||"easeLinear",d=y.delay||0,p=y.repeat||p||!1,h=y.callback||ms,g=y.pauseCallback||ms,m=y.resumeCallback||ms):(Mt(h)&&(d=h,h=null),ut(u)?(h=u,u="easeLinear"):u=u||"easeLinear");var _=Jit(o,this),x={fromAttrs:Qit(_,this),toAttrs:_,duration:s,easing:u,repeat:p,callback:h,pauseCallback:g,resumeCallback:m,delay:d,startTime:n.getTime(),id:Cn(),onFrame:v,pathFormatted:!1};a.length>0?a=tnt(a,x):n.addAnimator(this),a.push(x),this.set("animations",a),this.set("_pause",{isPaused:!1})}},t.prototype.stopAnimate=function(e){var i=this;e===void 0&&(e=!0);var n=this.get("animations");R(n,function(a){e&&(a.onFrame?i.attr(a.onFrame(1)):i.attr(a.toAttrs)),a.callback&&a.callback()}),this.set("animating",!1),this.set("animations",[])},t.prototype.pauseAnimate=function(){var e=this.get("timeline"),i=this.get("animations"),n=e.getTime();return R(i,function(a){a._paused=!0,a._pauseTime=n,a.pauseCallback&&a.pauseCallback()}),this.set("_pause",{isPaused:!0,pauseTime:n}),this},t.prototype.resumeAnimate=function(){var e=this.get("timeline"),i=e.getTime(),n=this.get("animations"),a=this.get("_pause").pauseTime;return R(n,function(o){o.startTime=o.startTime+(i-a),o._paused=!1,o._pauseTime=null,o.resumeCallback&&o.resumeCallback()}),this.set("_pause",{isPaused:!1}),this.set("animations",n),this},t.prototype.emitDelegation=function(e,i){var n=this,a=i.propagationPath;this.getEvents();var o;e==="mouseenter"?o=i.fromShape:e==="mouseleave"&&(o=i.toShape);for(var s=function(h){var f=a[h],d=f.get("name");if(d){if((f.isGroup()||f.isCanvas&&f.isCanvas())&&o&&QB(f,o))return"break";Z(d)?R(d,function(v){n.emitDelegateEvent(f,v,i)}):l.emitDelegateEvent(f,d,i)}},l=this,u=0;u<a.length;u++){var c=s(u);if(c==="break")break}},t.prototype.emitDelegateEvent=function(e,i,n){var a=this.getEvents(),o=i+Zit+n.type;(a[o]||a[qit])&&(n.name=o,n.currentTarget=e,n.delegateTarget=this,n.delegateObject=e.get("delegateObject"),this.emit(o,n))},t.prototype.translate=function(e,i){e===void 0&&(e=0),i===void 0&&(i=0);var n=this.getMatrix(),a=kh(n,[["t",e,i]]);return this.setMatrix(a),this},t.prototype.move=function(e,i){var n=this.attr("x")||0,a=this.attr("y")||0;return this.translate(e-n,i-a),this},t.prototype.moveTo=function(e,i){return this.move(e,i)},t.prototype.scale=function(e,i){var n=this.getMatrix(),a=kh(n,[["s",e,i||e]]);return this.setMatrix(a),this},t.prototype.rotate=function(e){var i=this.getMatrix(),n=kh(i,[["r",e]]);return this.setMatrix(n),this},t.prototype.rotateAtStart=function(e){var i=this.attr(),n=i.x,a=i.y,o=this.getMatrix(),s=kh(o,[["t",-n,-a],["r",e],["t",n,a]]);return this.setMatrix(s),this},t.prototype.rotateAtPoint=function(e,i,n){var a=this.getMatrix(),o=kh(a,[["t",-e,-i],["r",n],["t",e,i]]);return this.setMatrix(o),this},t}(J0),MR={},G1="_INDEX";function eD(r,t){if(r.set("canvas",t),r.isGroup()){var e=r.get("children");e.length&&e.forEach(function(i){eD(i,t)})}}function rD(r,t){if(r.set("timeline",t),r.isGroup()){var e=r.get("children");e.length&&e.forEach(function(i){rD(i,t)})}}function ent(r,t,e){e===void 0&&(e=!0),e?t.destroy():(t.set("parent",null),t.set("canvas",null)),KB(r.getChildren(),t)}function rnt(r){return function(t,e){var i=r(t,e);return i===0?t[G1]-e[G1]:i}}var iD=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isCanvas=function(){return!1},t.prototype.getBBox=function(){var e=1/0,i=-1/0,n=1/0,a=-1/0,o=this.getChildren().filter(function(l){return l.get("visible")&&(!l.isGroup()||l.isGroup()&&l.getChildren().length>0)});o.length>0?R(o,function(l){var u=l.getBBox(),c=u.minX,h=u.maxX,f=u.minY,d=u.maxY;c<e&&(e=c),h>i&&(i=h),f<n&&(n=f),d>a&&(a=d)}):(e=0,i=0,n=0,a=0);var s={x:e,y:n,minX:e,minY:n,maxX:i,maxY:a,width:i-e,height:a-n};return s},t.prototype.getCanvasBBox=function(){var e=1/0,i=-1/0,n=1/0,a=-1/0,o=this.getChildren().filter(function(l){return l.get("visible")&&(!l.isGroup()||l.isGroup()&&l.getChildren().length>0)});o.length>0?R(o,function(l){var u=l.getCanvasBBox(),c=u.minX,h=u.maxX,f=u.minY,d=u.maxY;c<e&&(e=c),h>i&&(i=h),f<n&&(n=f),d>a&&(a=d)}):(e=0,i=0,n=0,a=0);var s={x:e,y:n,minX:e,minY:n,maxX:i,maxY:a,width:i-e,height:a-n};return s},t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return e.children=[],e},t.prototype.onAttrChange=function(e,i,n){if(r.prototype.onAttrChange.call(this,e,i,n),e==="matrix"){var a=this.getTotalMatrix();this._applyChildrenMarix(a)}},t.prototype.applyMatrix=function(e){var i=this.getTotalMatrix();r.prototype.applyMatrix.call(this,e);var n=this.getTotalMatrix();n!==i&&this._applyChildrenMarix(n)},t.prototype._applyChildrenMarix=function(e){var i=this.getChildren();R(i,function(n){n.applyMatrix(e)})},t.prototype.addShape=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=e[0],a=e[1];re(n)?a=n:a.type=n;var o=MR[a.type];o||(o=fu(a.type),MR[a.type]=o);var s=this.getShapeBase(),l=new s[o](a);return this.add(l),l},t.prototype.addGroup=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=e[0],a=e[1],o;if(ut(n))a?o=new n(a):o=new n({parent:this});else{var s=n||{},l=this.getGroupBase();o=new l(s)}return this.add(o),o},t.prototype.getCanvas=function(){var e;return this.isCanvas()?e=this:e=this.get("canvas"),e},t.prototype.getShape=function(e,i,n){if(!Xf(this))return null;var a=this.getChildren(),o;if(this.isCanvas())o=this._findShape(a,e,i,n);else{var s=[e,i,1];s=this.invertFromMatrix(s),this.isClipped(s[0],s[1])||(o=this._findShape(a,s[0],s[1],n))}return o},t.prototype._findShape=function(e,i,n,a){for(var o=null,s=e.length-1;s>=0;s--){var l=e[s];if(Xf(l)&&(l.isGroup()?o=l.getShape(i,n,a):l.isHit(i,n)&&(o=l)),o)break}return o},t.prototype.add=function(e){var i=this.getCanvas(),n=this.getChildren(),a=this.get("timeline"),o=e.getParent();o&&ent(o,e,!1),e.set("parent",this),i&&eD(e,i),a&&rD(e,a),n.push(e),e.onCanvasChange("add"),this._applyElementMatrix(e)},t.prototype._applyElementMatrix=function(e){var i=this.getTotalMatrix();i&&e.applyMatrix(i)},t.prototype.getChildren=function(){return this.get("children")||[]},t.prototype.sort=function(){var e=this.getChildren();R(e,function(i,n){return i[G1]=n,i}),e.sort(rnt(function(i,n){return i.get("zIndex")-n.get("zIndex")})),this.onCanvasChange("sort")},t.prototype.clear=function(){if(this.set("clearing",!0),!this.destroyed){for(var e=this.getChildren(),i=e.length-1;i>=0;i--)e[i].destroy();this.set("children",[]),this.onCanvasChange("clear"),this.set("clearing",!1)}},t.prototype.destroy=function(){this.get("destroyed")||(this.clear(),r.prototype.destroy.call(this))},t.prototype.getFirst=function(){return this.getChildByIndex(0)},t.prototype.getLast=function(){var e=this.getChildren();return this.getChildByIndex(e.length-1)},t.prototype.getChildByIndex=function(e){var i=this.getChildren();return i[e]},t.prototype.getCount=function(){var e=this.getChildren();return e.length},t.prototype.contain=function(e){var i=this.getChildren();return i.indexOf(e)>-1},t.prototype.removeChild=function(e,i){i===void 0&&(i=!0),this.contain(e)&&e.remove(i)},t.prototype.findAll=function(e){var i=[],n=this.getChildren();return R(n,function(a){e(a)&&i.push(a),a.isGroup()&&(i=i.concat(a.findAll(e)))}),i},t.prototype.find=function(e){var i=null,n=this.getChildren();return R(n,function(a){if(e(a)?i=a:a.isGroup()&&(i=a.find(e)),i)return!1}),i},t.prototype.findById=function(e){return this.find(function(i){return i.get("id")===e})},t.prototype.findByClassName=function(e){return this.find(function(i){return i.get("className")===e})},t.prototype.findAllByName=function(e){return this.findAll(function(i){return i.get("name")===e})},t}(tD),nD={};function int(r){return nD[r.toLowerCase()]||PH[r]}function aD(r,t){nD[r.toLowerCase()]=t}var nnt=function(r){return["fill","stroke","fillStyle","strokeStyle"].includes(r)},ant=function(r){return/^[r,R,L,l]{1}[\s]*\(/.test(r)},IR=[1,0,0,0,1,0,0,0,1];function ont(r,t,e){var i={},n=t.fromAttrs,a=t.toAttrs;if(!r.destroyed){var o;for(var s in a)if(!Jt(n[s],a[s]))if(s==="path"){var l=a[s],u=n[s];l.length>u.length?(l=Yu(a[s]),u=Yu(n[s]),u=ZB(u,l),u=V1(u,l),t.fromAttrs.path=u,t.toAttrs.path=l):t.pathFormatted||(l=Yu(a[s]),u=Yu(n[s]),u=V1(u,l),t.fromAttrs.path=u,t.toAttrs.path=l,t.pathFormatted=!0),i[s]=[];for(var c=0;c<l.length;c++){for(var h=l[c],f=u[c],d=[],v=0;v<h.length;v++)Mt(h[v])&&f&&Mt(f[v])?(o=Cb(f[v],h[v]),d.push(o(e))):d.push(h[v]);i[s].push(d)}}else if(s==="matrix"){var p=FH(n[s]||IR,a[s]||IR),g=p(e);i[s]=g}else nnt(s)&&ant(a[s])?i[s]=a[s]:ut(a[s])||(o=Cb(n[s],a[s]),i[s]=o(e));r.attr(i)}}function snt(r,t,e){var i=t.startTime,n=t.delay;if(e<i+n||t._paused)return!1;var a,o=t.duration,s=t.easing,l=int(s);if(e=e-i-t.delay,t.repeat)a=e%o/o,a=l(a);else if(a=e/o,a<1)a=l(a);else return t.onFrame?r.attr(t.onFrame(1)):r.attr(t.toAttrs),!0;if(t.onFrame){var u=t.onFrame(a);r.attr(u)}else ont(r,t,a);return!1}var lnt=function(){function r(t){this.animators=[],this.current=0,this.timer=null,this.canvas=t}return r.prototype.initTimer=function(){var t=this,e=!1,i,n,a;this.timer=BH(function(o){if(t.current=o,t.animators.length>0){for(var s=t.animators.length-1;s>=0;s--){if(i=t.animators[s],i.destroyed){t.removeAnimator(s);continue}if(!i.isAnimatePaused()){n=i.get("animations");for(var l=n.length-1;l>=0;l--)a=n[l],e=snt(i,a,o),e&&(n.splice(l,1),e=!1,a.callback&&a.callback())}n.length===0&&t.removeAnimator(s)}var u=t.canvas.get("autoDraw");u||t.canvas.draw()}})},r.prototype.addAnimator=function(t){this.animators.push(t)},r.prototype.removeAnimator=function(t){this.animators.splice(t,1)},r.prototype.isAnimating=function(){return!!this.animators.length},r.prototype.stop=function(){this.timer&&this.timer.stop()},r.prototype.stopAllAnimations=function(t){t===void 0&&(t=!0),this.animators.forEach(function(e){e.stopAnimate(t)}),this.animators=[],this.canvas.draw()},r.prototype.getTime=function(){return this.current},r}(),unt=40,LR=0,OR=["mousedown","mouseup","dblclick","mouseout","mouseover","mousemove","mouseleave","mouseenter","touchstart","touchmove","touchend","dragenter","dragover","dragleave","drop","contextmenu","mousewheel"];function PR(r,t,e){e.name=t,e.target=r,e.currentTarget=r,e.delegateTarget=r,r.emit(t,e)}function cnt(r,t,e){if(e.bubbles){var i=void 0,n=!1;if(t==="mouseenter"?(i=e.fromShape,n=!0):t==="mouseleave"&&(n=!0,i=e.toShape),r.isCanvas()&&n)return;if(i&&QB(r,i)){e.bubbles=!1;return}e.name=t,e.currentTarget=r,e.delegateTarget=r,r.emit(t,e)}}var hnt=function(){function r(t){var e=this;this.draggingShape=null,this.dragging=!1,this.currentShape=null,this.mousedownShape=null,this.mousedownPoint=null,this._eventCallback=function(i){var n=i.type;e._triggerEvent(n,i)},this._onDocumentMove=function(i){var n=e.canvas,a=n.get("el");if(a!==i.target&&(e.dragging||e.currentShape)){var o=e._getPointInfo(i);e.dragging&&e._emitEvent("drag",i,o,e.draggingShape)}},this._onDocumentMouseUp=function(i){var n=e.canvas,a=n.get("el");if(a!==i.target&&e.dragging){var o=e._getPointInfo(i);e.draggingShape&&e._emitEvent("drop",i,o,null),e._emitEvent("dragend",i,o,e.draggingShape),e._afterDrag(e.draggingShape,o,i)}},this.canvas=t.canvas}return r.prototype.init=function(){this._bindEvents()},r.prototype._bindEvents=function(){var t=this,e=this.canvas.get("el");R(OR,function(i){e.addEventListener(i,t._eventCallback)}),document&&(document.addEventListener("mousemove",this._onDocumentMove),document.addEventListener("mouseup",this._onDocumentMouseUp))},r.prototype._clearEvents=function(){var t=this,e=this.canvas.get("el");R(OR,function(i){e.removeEventListener(i,t._eventCallback)}),document&&(document.removeEventListener("mousemove",this._onDocumentMove),document.removeEventListener("mouseup",this._onDocumentMouseUp))},r.prototype._getEventObj=function(t,e,i,n,a,o){var s=new Gd(t,e);return s.fromShape=a,s.toShape=o,s.x=i.x,s.y=i.y,s.clientX=i.clientX,s.clientY=i.clientY,s.propagationPath.push(n),s},r.prototype._getShape=function(t,e){return this.canvas.getShape(t.x,t.y,e)},r.prototype._getPointInfo=function(t){var e=this.canvas,i=e.getClientByEvent(t),n=e.getPointByEvent(t);return{x:n.x,y:n.y,clientX:i.x,clientY:i.y}},r.prototype._triggerEvent=function(t,e){var i=this._getPointInfo(e),n=this._getShape(i,e),a=this["_on"+t],o=!1;if(a)a.call(this,i,n,e);else{var s=this.currentShape;t==="mouseenter"||t==="dragenter"||t==="mouseover"?(this._emitEvent(t,e,i,null,null,n),n&&this._emitEvent(t,e,i,n,null,n),t==="mouseenter"&&this.draggingShape&&this._emitEvent("dragenter",e,i,null)):t==="mouseleave"||t==="dragleave"||t==="mouseout"?(o=!0,s&&this._emitEvent(t,e,i,s,s,null),this._emitEvent(t,e,i,null,s,null),t==="mouseleave"&&this.draggingShape&&this._emitEvent("dragleave",e,i,null)):this._emitEvent(t,e,i,n,null,null)}if(o||(this.currentShape=n),n&&!n.get("destroyed")){var l=this.canvas,u=l.get("el");u.style.cursor=n.attr("cursor")||l.get("cursor")}},r.prototype._onmousedown=function(t,e,i){i.button===LR&&(this.mousedownShape=e,this.mousedownPoint=t,this.mousedownTimeStamp=i.timeStamp),this._emitEvent("mousedown",i,t,e,null,null)},r.prototype._emitMouseoverEvents=function(t,e,i,n){var a=this.canvas.get("el");i!==n&&(i&&(this._emitEvent("mouseout",t,e,i,i,n),this._emitEvent("mouseleave",t,e,i,i,n),(!n||n.get("destroyed"))&&(a.style.cursor=this.canvas.get("cursor"))),n&&(this._emitEvent("mouseover",t,e,n,i,n),this._emitEvent("mouseenter",t,e,n,i,n)))},r.prototype._emitDragoverEvents=function(t,e,i,n,a){n?(n!==i&&(i&&this._emitEvent("dragleave",t,e,i,i,n),this._emitEvent("dragenter",t,e,n,i,n)),a||this._emitEvent("dragover",t,e,n)):i&&this._emitEvent("dragleave",t,e,i,i,n),a&&this._emitEvent("dragover",t,e,n)},r.prototype._afterDrag=function(t,e,i){t&&(t.set("capture",!0),this.draggingShape=null),this.dragging=!1;var n=this._getShape(e,i);n!==t&&this._emitMouseoverEvents(i,e,t,n),this.currentShape=n},r.prototype._onmouseup=function(t,e,i){if(i.button===LR){var n=this.draggingShape;this.dragging?(n&&this._emitEvent("drop",i,t,e),this._emitEvent("dragend",i,t,n),this._afterDrag(n,t,i)):(this._emitEvent("mouseup",i,t,e),e===this.mousedownShape&&this._emitEvent("click",i,t,e),this.mousedownShape=null,this.mousedownPoint=null)}},r.prototype._ondragover=function(t,e,i){i.preventDefault();var n=this.currentShape;this._emitDragoverEvents(i,t,n,e,!0)},r.prototype._onmousemove=function(t,e,i){var n=this.canvas,a=this.currentShape,o=this.draggingShape;if(this.dragging)o&&this._emitDragoverEvents(i,t,a,e,!1),this._emitEvent("drag",i,t,o);else{var s=this.mousedownPoint;if(s){var l=this.mousedownShape,u=i.timeStamp,c=u-this.mousedownTimeStamp,h=s.clientX-t.clientX,f=s.clientY-t.clientY,d=h*h+f*f;c>120||d>unt?l&&l.get("draggable")?(o=this.mousedownShape,o.set("capture",!1),this.draggingShape=o,this.dragging=!0,this._emitEvent("dragstart",i,t,o),this.mousedownShape=null,this.mousedownPoint=null):!l&&n.get("draggable")?(this.dragging=!0,this._emitEvent("dragstart",i,t,null),this.mousedownShape=null,this.mousedownPoint=null):(this._emitMouseoverEvents(i,t,a,e),this._emitEvent("mousemove",i,t,e)):(this._emitMouseoverEvents(i,t,a,e),this._emitEvent("mousemove",i,t,e))}else this._emitMouseoverEvents(i,t,a,e),this._emitEvent("mousemove",i,t,e)}},r.prototype._emitEvent=function(t,e,i,n,a,o){var s=this._getEventObj(t,e,i,n,a,o);if(n){s.shape=n,PR(n,t,s);for(var l=n.getParent();l;)l.emitDelegation(t,s),s.propagationStopped||cnt(l,t,s),s.propagationPath.push(l),l=l.getParent()}else{var u=this.canvas;PR(u,t,s)}},r.prototype.destroy=function(){this._clearEvents(),this.canvas=null,this.currentShape=null,this.draggingShape=null,this.mousedownPoint=null,this.mousedownShape=null,this.mousedownTimeStamp=null},r}(),FR="px",BR=IP(),fnt=BR&&BR.name==="firefox",em=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.initContainer(),i.initDom(),i.initEvents(),i.initTimeline(),i}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return e.cursor="default",e.supportCSSTransform=!1,e},t.prototype.initContainer=function(){var e=this.get("container");mt(e)&&(e=document.getElementById(e),this.set("container",e))},t.prototype.initDom=function(){var e=this.createDom();this.set("el",e);var i=this.get("container");i.appendChild(e),this.setDOMSize(this.get("width"),this.get("height"))},t.prototype.initEvents=function(){var e=new hnt({canvas:this});e.init(),this.set("eventController",e)},t.prototype.initTimeline=function(){var e=new lnt(this);this.set("timeline",e)},t.prototype.setDOMSize=function(e,i){var n=this.get("el");wR&&(n.style.width=e+FR,n.style.height=i+FR)},t.prototype.changeSize=function(e,i){this.setDOMSize(e,i),this.set("width",e),this.set("height",i),this.onCanvasChange("changeSize")},t.prototype.getRenderer=function(){return this.get("renderer")},t.prototype.getCursor=function(){return this.get("cursor")},t.prototype.setCursor=function(e){this.set("cursor",e);var i=this.get("el");wR&&i&&(i.style.cursor=e)},t.prototype.getPointByEvent=function(e){var i=this.get("supportCSSTransform");if(i){if(fnt&&!j(e.layerX)&&e.layerX!==e.offsetX)return{x:e.layerX,y:e.layerY};if(!j(e.offsetX))return{x:e.offsetX,y:e.offsetY}}var n=this.getClientByEvent(e),a=n.x,o=n.y;return this.getPointByClient(a,o)},t.prototype.getClientByEvent=function(e){var i=e;return e.touches&&(e.type==="touchend"?i=e.changedTouches[0]:i=e.touches[0]),{x:i.clientX,y:i.clientY}},t.prototype.getPointByClient=function(e,i){var n=this.get("el"),a=n.getBoundingClientRect();return{x:e-a.left,y:i-a.top}},t.prototype.getClientByPoint=function(e,i){var n=this.get("el"),a=n.getBoundingClientRect();return{x:e+a.left,y:i+a.top}},t.prototype.draw=function(){},t.prototype.removeDom=function(){var e=this.get("el");e.parentNode.removeChild(e)},t.prototype.clearEvents=function(){var e=this.get("eventController");e.destroy()},t.prototype.isCanvas=function(){return!0},t.prototype.getParent=function(){return null},t.prototype.destroy=function(){var e=this.get("timeline");this.get("destroyed")||(this.clear(),e&&e.stop(),this.clearEvents(),this.removeDom(),r.prototype.destroy.call(this))},t}(iD),rm=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isGroup=function(){return!0},t.prototype.isEntityGroup=function(){return!1},t.prototype.clone=function(){for(var e=r.prototype.clone.call(this),i=this.getChildren(),n=0;n<i.length;n++){var a=i[n];e.add(a.clone())}return e},t}(iD),im=function(r){B(t,r);function t(e){return r.call(this,e)||this}return t.prototype._isInBBox=function(e,i){var n=this.getBBox();return n.minX<=e&&n.maxX>=e&&n.minY<=i&&n.maxY>=i},t.prototype.afterAttrsChange=function(e){r.prototype.afterAttrsChange.call(this,e),this.clearCacheBBox()},t.prototype.getBBox=function(){var e=this.cfg.bbox;return e||(e=this.calculateBBox(),this.set("bbox",e)),e},t.prototype.getCanvasBBox=function(){var e=this.cfg.canvasBBox;return e||(e=this.calculateCanvasBBox(),this.set("canvasBBox",e)),e},t.prototype.applyMatrix=function(e){r.prototype.applyMatrix.call(this,e),this.set("canvasBBox",null)},t.prototype.calculateCanvasBBox=function(){var e=this.getBBox(),i=this.getTotalMatrix(),n=e.minX,a=e.minY,o=e.maxX,s=e.maxY;if(i){var l=Ao(i,[e.minX,e.minY]),u=Ao(i,[e.maxX,e.minY]),c=Ao(i,[e.minX,e.maxY]),h=Ao(i,[e.maxX,e.maxY]);n=Math.min(l[0],u[0],c[0],h[0]),o=Math.max(l[0],u[0],c[0],h[0]),a=Math.min(l[1],u[1],c[1],h[1]),s=Math.max(l[1],u[1],c[1],h[1])}var f=this.attrs;if(f.shadowColor){var d=f.shadowBlur,v=d===void 0?0:d,p=f.shadowOffsetX,g=p===void 0?0:p,m=f.shadowOffsetY,y=m===void 0?0:m,_=n-v+g,x=o+v+g,C=a-v+y,A=s+v+y;n=Math.min(n,_),o=Math.max(o,x),a=Math.min(a,C),s=Math.max(s,A)}return{x:n,y:a,minX:n,minY:a,maxX:o,maxY:s,width:o-n,height:s-a}},t.prototype.clearCacheBBox=function(){this.set("bbox",null),this.set("canvasBBox",null)},t.prototype.isClipShape=function(){return this.get("isClipShape")},t.prototype.isInShape=function(e,i){return!1},t.prototype.isOnlyHitBox=function(){return!1},t.prototype.isHit=function(e,i){var n=this.get("startArrowShape"),a=this.get("endArrowShape"),o=[e,i,1];o=this.invertFromMatrix(o);var s=o[0],l=o[1],u=this._isInBBox(s,l);return this.isOnlyHitBox()?u:!!(u&&!this.isClipped(s,l)&&(this.isInShape(s,l)||n&&n.isHit(s,l)||a&&a.isHit(s,l)))},t}(tD),oD=new Map;function Kn(r,t){oD.set(r,t)}function nm(r){return oD.get(r)}function sD(r){var t=r.attr(),e=t.x,i=t.y,n=t.width,a=t.height;return{x:e,y:i,width:n,height:a}}function lD(r){var t=r.attr(),e=t.x,i=t.y,n=t.r;return{x:e-n,y:i-n,width:n*2,height:n*2}}function si(r,t,e,i){var n=r-e,a=t-i;return Math.sqrt(n*n+a*a)}function Kp(r,t){return Math.abs(r-t)<.001}function Jc(r,t){var e=Wn(r),i=Wn(t),n=pn(r),a=pn(t);return{x:e,y:i,width:n-e,height:a-i}}function am(r){return(r+Math.PI*2)%(Math.PI*2)}const Nr={box:function(r,t,e,i){return Jc([r,e],[t,i])},length:function(r,t,e,i){return si(r,t,e,i)},pointAt:function(r,t,e,i,n){return{x:(1-n)*r+n*e,y:(1-n)*t+n*i}},pointDistance:function(r,t,e,i,n,a){var o=(e-r)*(n-r)+(i-t)*(a-t);if(o<0)return si(r,t,n,a);var s=(e-r)*(e-r)+(i-t)*(i-t);return o>s?si(e,i,n,a):this.pointToLine(r,t,e,i,n,a)},pointToLine:function(r,t,e,i,n,a){var o=[e-r,i-t];if(nH(o,[0,0]))return Math.sqrt((n-r)*(n-r)+(a-t)*(a-t));var s=[-o[1],o[0]];yc(s,s);var l=[n-r,a-t];return Math.abs(yg(l,s))},tangentAngle:function(r,t,e,i){return Math.atan2(i-t,e-r)}};var dnt=1e-4;function uD(r,t,e,i,n,a){var o,s=1/0,l=[e,i],u=20;a&&a>200&&(u=a/10);for(var c=1/u,h=c/10,f=0;f<=u;f++){var d=f*c,v=[n.apply(null,r.concat([d])),n.apply(null,t.concat([d]))],p=si(l[0],l[1],v[0],v[1]);p<s&&(o=d,s=p)}if(o===0)return{x:r[0],y:t[0]};if(o===1){var g=r.length;return{x:r[g-1],y:t[g-1]}}s=1/0;for(var f=0;f<32&&!(h<dnt);f++){var m=o-h,y=o+h,v=[n.apply(null,r.concat([m])),n.apply(null,t.concat([m]))],p=si(l[0],l[1],v[0],v[1]);if(m>=0&&p<s)o=m,s=p;else{var _=[n.apply(null,r.concat([y])),n.apply(null,t.concat([y]))],x=si(l[0],l[1],_[0],_[1]);y<=1&&x<s?(o=y,s=x):h*=.5}}return{x:n.apply(null,r.concat([o])),y:n.apply(null,t.concat([o]))}}function vnt(r,t){for(var e=0,i=r.length,n=0;n<i;n++){var a=r[n],o=t[n],s=r[(n+1)%i],l=t[(n+1)%i];e+=si(a,o,s,l)}return e/2}function ls(r,t,e,i){var n=1-i;return n*n*r+2*i*n*t+i*i*e}function DR(r,t,e){var i=r+e-2*t;if(Kp(i,0))return[.5];var n=(r-t)/i;return n<=1&&n>=0?[n]:[]}function NR(r,t,e,i){return 2*(1-i)*(t-r)+2*i*(e-t)}function cD(r,t,e,i,n,a,o){var s=ls(r,e,n,o),l=ls(t,i,a,o),u=Nr.pointAt(r,t,e,i,o),c=Nr.pointAt(e,i,n,a,o);return[[r,t,u.x,u.y,s,l],[s,l,c.x,c.y,n,a]]}function X1(r,t,e,i,n,a,o){if(o===0)return(si(r,t,e,i)+si(e,i,n,a)+si(r,t,n,a))/2;var s=cD(r,t,e,i,n,a,.5),l=s[0],u=s[1];return l.push(o-1),u.push(o-1),X1.apply(null,l)+X1.apply(null,u)}const hD={box:function(r,t,e,i,n,a){var o=DR(r,e,n)[0],s=DR(t,i,a)[0],l=[r,n],u=[t,a];return o!==void 0&&l.push(ls(r,e,n,o)),s!==void 0&&u.push(ls(t,i,a,s)),Jc(l,u)},length:function(r,t,e,i,n,a){return X1(r,t,e,i,n,a,3)},nearestPoint:function(r,t,e,i,n,a,o,s){return uD([r,e,n],[t,i,a],o,s,ls)},pointDistance:function(r,t,e,i,n,a,o,s){var l=this.nearestPoint(r,t,e,i,n,a,o,s);return si(l.x,l.y,o,s)},interpolationAt:ls,pointAt:function(r,t,e,i,n,a,o){return{x:ls(r,e,n,o),y:ls(t,i,a,o)}},divide:function(r,t,e,i,n,a,o){return cD(r,t,e,i,n,a,o)},tangentAngle:function(r,t,e,i,n,a,o){var s=NR(r,e,n,o),l=NR(t,i,a,o),u=Math.atan2(l,s);return am(u)}};function us(r,t,e,i,n){var a=1-n;return a*a*a*r+3*t*n*a*a+3*e*n*n*a+i*n*n*n}function kR(r,t,e,i,n){var a=1-n;return 3*(a*a*(t-r)+2*a*n*(e-t)+n*n*(i-e))}function n_(r,t,e,i){var n=-3*r+9*t-9*e+3*i,a=6*r-12*t+6*e,o=3*t-3*r,s=[],l,u,c;if(Kp(n,0))Kp(a,0)||(l=-o/a,l>=0&&l<=1&&s.push(l));else{var h=a*a-4*n*o;Kp(h,0)?s.push(-a/(2*n)):h>0&&(c=Math.sqrt(h),l=(-a+c)/(2*n),u=(-a-c)/(2*n),l>=0&&l<=1&&s.push(l),u>=0&&u<=1&&s.push(u))}return s}function fD(r,t,e,i,n,a,o,s,l){var u=us(r,e,n,o,l),c=us(t,i,a,s,l),h=Nr.pointAt(r,t,e,i,l),f=Nr.pointAt(e,i,n,a,l),d=Nr.pointAt(n,a,o,s,l),v=Nr.pointAt(h.x,h.y,f.x,f.y,l),p=Nr.pointAt(f.x,f.y,d.x,d.y,l);return[[r,t,h.x,h.y,v.x,v.y,u,c],[u,c,p.x,p.y,d.x,d.y,o,s]]}function Y1(r,t,e,i,n,a,o,s,l){if(l===0)return vnt([r,e,n,o],[t,i,a,s]);var u=fD(r,t,e,i,n,a,o,s,.5),c=u[0],h=u[1];return c.push(l-1),h.push(l-1),Y1.apply(null,c)+Y1.apply(null,h)}const _f={extrema:n_,box:function(r,t,e,i,n,a,o,s){for(var l=[r,o],u=[t,s],c=n_(r,e,n,o),h=n_(t,i,a,s),f=0;f<c.length;f++)l.push(us(r,e,n,o,c[f]));for(var f=0;f<h.length;f++)u.push(us(t,i,a,s,h[f]));return Jc(l,u)},length:function(r,t,e,i,n,a,o,s){return Y1(r,t,e,i,n,a,o,s,3)},nearestPoint:function(r,t,e,i,n,a,o,s,l,u,c){return uD([r,e,n,o],[t,i,a,s],l,u,us,c)},pointDistance:function(r,t,e,i,n,a,o,s,l,u,c){var h=this.nearestPoint(r,t,e,i,n,a,o,s,l,u,c);return si(h.x,h.y,l,u)},interpolationAt:us,pointAt:function(r,t,e,i,n,a,o,s,l){return{x:us(r,e,n,o,l),y:us(t,i,a,s,l)}},divide:function(r,t,e,i,n,a,o,s,l){return fD(r,t,e,i,n,a,o,s,l)},tangentAngle:function(r,t,e,i,n,a,o,s,l){var u=kR(r,e,n,o,l),c=kR(t,i,a,s,l);return am(Math.atan2(c,u))}};function UR(r,t){var e=Math.abs(r);return t>0?e:e*-1}const pnt={box:function(r,t,e,i){return{x:r-e,y:t-i,width:e*2,height:i*2}},length:function(r,t,e,i){return Math.PI*(3*(e+i)-Math.sqrt((3*e+i)*(e+3*i)))},nearestPoint:function(r,t,e,i,n,a){var o=e,s=i;if(o===0||s===0)return{x:r,y:t};for(var l=n-r,u=a-t,c=Math.abs(l),h=Math.abs(u),f=o*o,d=s*s,v=Math.PI/4,p,g,m=0;m<4;m++){p=o*Math.cos(v),g=s*Math.sin(v);var y=(f-d)*Math.pow(Math.cos(v),3)/o,_=(d-f)*Math.pow(Math.sin(v),3)/s,x=p-y,C=g-_,A=c-y,T=h-_,w=Math.hypot(C,x),M=Math.hypot(T,A),O=w*Math.asin((x*T-C*A)/(w*M)),P=O/Math.sqrt(f+d-p*p-g*g);v+=P,v=Math.min(Math.PI/2,Math.max(0,v))}return{x:r+UR(p,l),y:t+UR(g,u)}},pointDistance:function(r,t,e,i,n,a){var o=this.nearestPoint(r,t,e,i,n,a);return si(o.x,o.y,n,a)},pointAt:function(r,t,e,i,n){var a=2*Math.PI*n;return{x:r+e*Math.cos(a),y:t+i*Math.sin(a)}},tangentAngle:function(r,t,e,i,n){var a=2*Math.PI*n,o=Math.atan2(i*Math.cos(a),-e*Math.sin(a));return am(o)}};function gnt(r,t,e,i,n,a,o,s){return-1*e*Math.cos(n)*Math.sin(s)-i*Math.sin(n)*Math.cos(s)}function mnt(r,t,e,i,n,a,o,s){return-1*e*Math.sin(n)*Math.sin(s)+i*Math.cos(n)*Math.cos(s)}function ynt(r,t,e){return Math.atan(-t/r*Math.tan(e))}function _nt(r,t,e){return Math.atan(t/(r*Math.tan(e)))}function zR(r,t,e,i,n,a){return e*Math.cos(n)*Math.cos(a)-i*Math.sin(n)*Math.sin(a)+r}function HR(r,t,e,i,n,a){return e*Math.sin(n)*Math.cos(a)+i*Math.cos(n)*Math.sin(a)+t}function xnt(r,t,e,i){var n=Math.atan2(i*r,e*t);return(n+Math.PI*2)%(Math.PI*2)}function $R(r,t,e){return{x:r*Math.cos(e),y:t*Math.sin(e)}}function WR(r,t,e){var i=Math.cos(e),n=Math.sin(e);return[r*i-t*n,r*n+t*i]}const Cnt={box:function(r,t,e,i,n,a,o){for(var s=ynt(e,i,n),l=1/0,u=-1/0,c=[a,o],h=-Math.PI*2;h<=Math.PI*2;h+=Math.PI){var f=s+h;a<o?a<f&&f<o&&c.push(f):o<f&&f<a&&c.push(f)}for(var h=0;h<c.length;h++){var d=zR(r,t,e,i,n,c[h]);d<l&&(l=d),d>u&&(u=d)}for(var v=_nt(e,i,n),p=1/0,g=-1/0,m=[a,o],h=-Math.PI*2;h<=Math.PI*2;h+=Math.PI){var y=v+h;a<o?a<y&&y<o&&m.push(y):o<y&&y<a&&m.push(y)}for(var h=0;h<m.length;h++){var _=HR(r,t,e,i,n,m[h]);_<p&&(p=_),_>g&&(g=_)}return{x:l,y:p,width:u-l,height:g-p}},length:function(r,t,e,i,n,a,o){},nearestPoint:function(r,t,e,i,n,a,o,s,l){var u=WR(s-r,l-t,-n),c=u[0],h=u[1],f=pnt.nearestPoint(0,0,e,i,c,h),d=xnt(e,i,f.x,f.y);d<a?f=$R(e,i,a):d>o&&(f=$R(e,i,o));var v=WR(f.x,f.y,n);return{x:v[0]+r,y:v[1]+t}},pointDistance:function(r,t,e,i,n,a,o,s,l){var u=this.nearestPoint(r,t,e,i,s,l);return si(u.x,u.y,s,l)},pointAt:function(r,t,e,i,n,a,o,s){var l=(o-a)*s+a;return{x:zR(r,t,e,i,n,l),y:HR(r,t,e,i,n,l)}},tangentAngle:function(r,t,e,i,n,a,o,s){var l=(o-a)*s+a,u=gnt(r,t,e,i,n,a,o,l),c=mnt(r,t,e,i,n,a,o,l);return am(Math.atan2(c,u))}};function dD(r){for(var t=0,e=[],i=0;i<r.length-1;i++){var n=r[i],a=r[i+1],o=si(n[0],n[1],a[0],a[1]),s={from:n,to:a,length:o};e.push(s),t+=o}return{segments:e,totalLength:t}}function Ent(r){if(r.length<2)return 0;for(var t=0,e=0;e<r.length-1;e++){var i=r[e],n=r[e+1];t+=si(i[0],i[1],n[0],n[1])}return t}function Snt(r,t){if(t>1||t<0||r.length<2)return null;var e=dD(r),i=e.segments,n=e.totalLength;if(n===0)return{x:r[0][0],y:r[0][1]};for(var a=0,o=null,s=0;s<i.length;s++){var l=i[s],u=l.from,c=l.to,h=l.length/n;if(t>=a&&t<=a+h){var f=(t-a)/h;o=Nr.pointAt(u[0],u[1],c[0],c[1],f);break}a+=h}return o}function Ant(r,t){if(t>1||t<0||r.length<2)return 0;for(var e=dD(r),i=e.segments,n=e.totalLength,a=0,o=0,s=0;s<i.length;s++){var l=i[s],u=l.from,c=l.to,h=l.length/n;if(t>=a&&t<=a+h){o=Math.atan2(c[1]-u[1],c[0]-u[0]);break}a+=h}return o}function Tnt(r,t,e){for(var i=1/0,n=0;n<r.length-1;n++){var a=r[n],o=r[n+1],s=Nr.pointDistance(a[0],a[1],o[0],o[1],t,e);s<i&&(i=s)}return i}const vD={box:function(r){for(var t=[],e=[],i=0;i<r.length;i++){var n=r[i];t.push(n[0]),e.push(n[1])}return Jc(t,e)},length:function(r){return Ent(r)},pointAt:function(r,t){return Snt(r,t)},pointDistance:function(r,t,e){return Tnt(r,t,e)},tangentAngle:function(r,t){return Ant(r,t)}};function VR(r,t){return!r||!t?r||t:{minX:Math.min(r.minX,t.minX),minY:Math.min(r.minY,t.minY),maxX:Math.max(r.maxX,t.maxX),maxY:Math.max(r.maxY,t.maxY)}}function HE(r,t){var e=r.get("startArrowShape"),i=r.get("endArrowShape"),n=null,a=null;return e&&(n=e.getCanvasBBox(),t=VR(t,n)),i&&(a=i.getCanvasBBox(),t=VR(t,a)),t}function bnt(r){for(var t=r.attr(),e=t.points,i=[],n=[],a=0;a<e.length;a++){var o=e[a];i.push(o[0]),n.push(o[1])}var s=Jc(i,n),l=s.x,u=s.y,c=s.width,h=s.height,f={minX:l,minY:u,maxX:l+c,maxY:u+h};return f=HE(r,f),{x:f.minX,y:f.minY,width:f.maxX-f.minX,height:f.maxY-f.minY}}function wnt(r){for(var t=r.attr(),e=t.points,i=[],n=[],a=0;a<e.length;a++){var o=e[a];i.push(o[0]),n.push(o[1])}return Jc(i,n)}var a_=null;function om(){if(!a_){var r=document.createElement("canvas");r.width=1,r.height=1,a_=r.getContext("2d")}return a_}function sm(r,t,e){var i=1;if(mt(r)&&(i=r.split(`
`).length),i>1){var n=Rnt(t,e);return t*i+n*(i-1)}return t}function Rnt(r,t){return t?t-r:r*.14}function Mnt(r,t){var e=om(),i=0;if(j(r)||r==="")return i;if(e.save(),e.font=t,mt(r)&&r.includes(`
`)){var n=r.split(`
`);R(n,function(a){var o=e.measureText(a).width;i<o&&(i=o)})}else i=e.measureText(r).width;return e.restore(),i}function lm(r){var t=r.fontSize,e=r.fontFamily,i=r.fontWeight,n=r.fontStyle,a=r.fontVariant;return[n,a,i,t+"px",e].join(" ").trim()}function Int(r){var t=r.attr(),e=t.x,i=t.y,n=t.text,a=t.fontSize,o=t.lineHeight,s=t.font;s||(s=lm(t));var l=Mnt(n,s),u;if(!l)u={x:e,y:i,width:0,height:0};else{var c=t.textAlign,h=t.textBaseline,f=sm(n,a,o),d={x:e,y:i-f};c&&(c==="end"||c==="right"?d.x-=l:c==="center"&&(d.x-=l/2)),h&&(h==="top"?d.y+=f:h==="middle"&&(d.y+=f/2)),u={x:d.x,y:d.y,width:l,height:f}}return u}var Lnt=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/ig,Ont=/[^\s\,]+/ig;function Pnt(r){var t=r||[];if(Z(t))return t;if(mt(t))return t=t.match(Lnt),R(t,function(e,i){if(e=e.match(Ont),e[0].length>1){var n=e[0].charAt(0);e.splice(1,0,e[0].substr(1)),e[0]=n}R(e,function(a,o){isNaN(a)||(e[o]=+a)}),t[i]=e}),t}function Zv(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function j1(r,t){return Zv(r)*Zv(t)?(r[0]*t[0]+r[1]*t[1])/(Zv(r)*Zv(t)):1}function GR(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(j1(r,t))}function Z1(r,t){return r[0]===t[0]&&r[1]===t[1]}function Fnt(r,t){var e=t[1],i=t[2],n=Z0(q0(t[3]),Math.PI*2),a=t[4],o=t[5],s=r[0],l=r[1],u=t[6],c=t[7],h=Math.cos(n)*(s-u)/2+Math.sin(n)*(l-c)/2,f=-1*Math.sin(n)*(s-u)/2+Math.cos(n)*(l-c)/2,d=h*h/(e*e)+f*f/(i*i);d>1&&(e*=Math.sqrt(d),i*=Math.sqrt(d));var v=e*e*(f*f)+i*i*(h*h),p=v?Math.sqrt((e*e*(i*i)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=i?p*e*f/i:0,m=e?p*-i*h/e:0,y=(s+u)/2+Math.cos(n)*g-Math.sin(n)*m,_=(l+c)/2+Math.sin(n)*g+Math.cos(n)*m,x=[(h-g)/e,(f-m)/i],C=[(-1*h-g)/e,(-1*f-m)/i],A=GR([1,0],x),T=GR(x,C);return j1(x,C)<=-1&&(T=Math.PI),j1(x,C)>=1&&(T=0),o===0&&T>0&&(T=T-2*Math.PI),o===1&&T<0&&(T=T+2*Math.PI),{cx:y,cy:_,rx:Z1(r,[u,c])?0:e,ry:Z1(r,[u,c])?0:i,startAngle:A,endAngle:A+T,xRotation:n,arcFlag:a,sweepFlag:o}}function XR(r,t){return[t[0]+(t[0]-r[0]),t[1]+(t[1]-r[1])]}function Bnt(r){r=Pnt(r);for(var t=[],e=null,i=null,n=null,a=0,o=r.length,s=0;s<o;s++){var l=r[s];i=r[s+1];var u=l[0],c={command:u,prePoint:e,params:l,startTangent:null,endTangent:null};switch(u){case"M":n=[l[1],l[2]],a=s;break;case"A":var h=Fnt(e,l);c.arcParams=h;break}if(u==="Z")e=n,i=r[a+1];else{var f=l.length;e=[l[f-2],l[f-1]]}i&&i[0]==="Z"&&(i=r[a],t[a]&&(t[a].prePoint=e)),c.currentPoint=e,t[a]&&Z1(e,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var d=i?[i[i.length-2],i[i.length-1]]:null;c.nextPoint=d;var v=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[v[0]-e[0],v[1]-e[1]],c.endTangent=[e[0]-v[0],e[1]-v[1]];else if(u==="Q"){var p=[l[1],l[2]];c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[e[0]-p[0],e[1]-p[1]]}else if(u==="T"){var g=t[s-1],p=XR(g.currentPoint,v);g.command==="Q"?(c.command="Q",c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[e[0]-p[0],e[1]-p[1]]):(c.command="TL",c.startTangent=[v[0]-e[0],v[1]-e[1]],c.endTangent=[e[0]-v[0],e[1]-v[1]])}else if(u==="C"){var m=[l[1],l[2]],y=[l[3],l[4]];c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]],c.startTangent[0]===0&&c.startTangent[1]===0&&(c.startTangent=[m[0]-y[0],m[1]-y[1]]),c.endTangent[0]===0&&c.endTangent[1]===0&&(c.endTangent=[y[0]-m[0],y[1]-m[1]])}else if(u==="S"){var g=t[s-1],m=XR(g.currentPoint,v),y=[l[1],l[2]];g.command==="C"?(c.command="C",c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]]):(c.command="SQ",c.startTangent=[v[0]-y[0],v[1]-y[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]])}else if(u==="A"){var _=.001,x=c.arcParams||{},C=x.cx,A=C===void 0?0:C,T=x.cy,w=T===void 0?0:T,M=x.rx,O=M===void 0?0:M,P=x.ry,D=P===void 0?0:P,z=x.sweepFlag,Y=z===void 0?0:z,H=x.startAngle,N=H===void 0?0:H,W=x.endAngle,Q=W===void 0?0:W;Y===0&&(_*=-1);var q=O*Math.cos(N-_)+A,J=D*Math.sin(N-_)+w;c.startTangent=[q-n[0],J-n[1]];var et=O*Math.cos(N+Q+_)+A,ft=D*Math.sin(N+Q-_)+w;c.endTangent=[v[0]-et,v[1]-ft]}t.push(c)}return t}function Dnt(r,t){for(var e=[],i=[],n=[],a=0;a<r.length;a++){var o=r[a],s=o.currentPoint,l=o.params,u=o.prePoint,c=void 0;switch(o.command){case"Q":c=hD.box(u[0],u[1],l[1],l[2],l[3],l[4]);break;case"C":c=_f.box(u[0],u[1],l[1],l[2],l[3],l[4],l[5],l[6]);break;case"A":var h=o.arcParams;c=Cnt.box(h.cx,h.cy,h.rx,h.ry,h.xRotation,h.startAngle,h.endAngle);break;default:e.push(s[0]),i.push(s[1]);break}c&&(o.box=c,e.push(c.x,c.x+c.width),i.push(c.y,c.y+c.height)),t&&(o.command==="L"||o.command==="M")&&o.prePoint&&o.nextPoint&&n.push(o)}e=e.filter(function(m){return!Number.isNaN(m)&&m!==1/0&&m!==-1/0}),i=i.filter(function(m){return!Number.isNaN(m)&&m!==1/0&&m!==-1/0});var f=Wn(e),d=Wn(i),v=pn(e),p=pn(i);if(n.length===0)return{x:f,y:d,width:v-f,height:p-d};for(var a=0;a<n.length;a++){var o=n[a],s=o.currentPoint,g=void 0;s[0]===f?(g=qv(o,t),f=f-g.xExtra):s[0]===v&&(g=qv(o,t),v=v+g.xExtra),s[1]===d?(g=qv(o,t),d=d-g.yExtra):s[1]===p&&(g=qv(o,t),p=p+g.yExtra)}return{x:f,y:d,width:v-f,height:p-d}}function qv(r,t){var e=r.prePoint,i=r.currentPoint,n=r.nextPoint,a=Math.pow(i[0]-e[0],2)+Math.pow(i[1]-e[1],2),o=Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2),s=Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2),l=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!l||Math.sin(l)===0||Br(l,0))return{xExtra:0,yExtra:0};var u=Math.abs(Math.atan2(n[1]-i[1],n[0]-i[0])),c=Math.abs(Math.atan2(n[0]-i[0],n[1]-i[1]));u=u>Math.PI/2?Math.PI-u:u,c=c>Math.PI/2?Math.PI-c:c;var h={xExtra:Math.cos(l/2-u)*(t/2*(1/Math.sin(l/2)))-t/2||0,yExtra:Math.cos(c-l/2)*(t/2*(1/Math.sin(l/2)))-t/2||0};return h}function Nnt(r){var t=r.attr(),e=t.path,i=t.stroke,n=i?t.lineWidth:0,a=r.get("segments")||Bnt(e),o=Dnt(a,n),s=o.x,l=o.y,u=o.width,c=o.height,h={minX:s,minY:l,maxX:s+u,maxY:l+c};return h=HE(r,h),{x:h.minX,y:h.minY,width:h.maxX-h.minX,height:h.maxY-h.minY}}function knt(r){var t=r.attr(),e=t.x1,i=t.y1,n=t.x2,a=t.y2,o=Math.min(e,n),s=Math.max(e,n),l=Math.min(i,a),u=Math.max(i,a),c={minX:o,maxX:s,minY:l,maxY:u};return c=HE(r,c),{x:c.minX,y:c.minY,width:c.maxX-c.minX,height:c.maxY-c.minY}}function Unt(r){var t=r.attr(),e=t.x,i=t.y,n=t.rx,a=t.ry;return{x:e-n,y:i-a,width:n*2,height:a*2}}Kn("rect",sD);Kn("image",sD);Kn("circle",lD);Kn("marker",lD);Kn("polyline",bnt);Kn("polygon",wnt);Kn("text",Int);Kn("path",Nnt);Kn("line",knt);Kn("ellipse",Unt);function znt(){return window?window.devicePixelRatio:1}function pD(r,t,e,i){var n=r-e,a=t-i;return Math.sqrt(n*n+a*a)}function xl(r,t,e,i,n,a){return n>=r&&n<=r+e&&a>=t&&a<=t+i}function Yf(r,t){return!(t.minX>r.maxX||t.maxX<r.minX||t.minY>r.maxY||t.maxY<r.minY)}function Hnt(r,t){return!r||!t?r||t:{minX:Math.min(r.minX,t.minX),minY:Math.min(r.minY,t.minY),maxX:Math.max(r.maxX,t.maxX),maxY:Math.max(r.maxY,t.maxY)}}function YR(r,t){return r[0]===t[0]&&r[1]===t[1]}var $nt=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,Wnt=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,Vnt=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,gD=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function mD(r,t){var e=r.match(gD);R(e,function(i){var n=i.split(":");t.addColorStop(n[0],n[1])})}function Gnt(r,t,e){var i=$nt.exec(e),n=parseFloat(i[1])%360*(Math.PI/180),a=i[2],o=t.getBBox(),s,l;n>=0&&n<1/2*Math.PI?(s={x:o.minX,y:o.minY},l={x:o.maxX,y:o.maxY}):1/2*Math.PI<=n&&n<Math.PI?(s={x:o.maxX,y:o.minY},l={x:o.minX,y:o.maxY}):Math.PI<=n&&n<3/2*Math.PI?(s={x:o.maxX,y:o.maxY},l={x:o.minX,y:o.minY}):(s={x:o.minX,y:o.maxY},l={x:o.maxX,y:o.minY});var u=Math.tan(n),c=u*u,h=(l.x-s.x+u*(l.y-s.y))/(c+1)+s.x,f=u*(l.x-s.x+u*(l.y-s.y))/(c+1)+s.y,d=r.createLinearGradient(s.x,s.y,h,f);return mD(a,d),d}function Xnt(r,t,e){var i=Wnt.exec(e),n=parseFloat(i[1]),a=parseFloat(i[2]),o=parseFloat(i[3]),s=i[4];if(o===0){var l=s.match(gD);return l[l.length-1].split(":")[1]}var u=t.getBBox(),c=u.maxX-u.minX,h=u.maxY-u.minY,f=Math.sqrt(c*c+h*h)/2,d=r.createRadialGradient(u.minX+c*n,u.minY+h*a,0,u.minX+c/2,u.minY+h/2,o*f);return mD(s,d),d}function Ynt(r,t,e){if(t.get("patternSource")&&t.get("patternSource")===e)return t.get("pattern");var i,n,a=Vnt.exec(e),o=a[1],s=a[2];function l(){i=r.createPattern(n,o),t.set("pattern",i),t.set("patternSource",e)}switch(o){case"a":o="repeat";break;case"x":o="repeat-x";break;case"y":o="repeat-y";break;case"n":o="no-repeat";break;default:o="no-repeat"}return n=new Image,s.match(/^data:/i)||(n.crossOrigin="Anonymous"),n.src=s,n.complete?l():(n.onload=l,n.src=n.src),i}function jnt(r,t,e){var i=t.getBBox();if(isNaN(i.x)||isNaN(i.y)||isNaN(i.width)||isNaN(i.height))return e;if(mt(e)){if(e[1]==="("||e[2]==="("){if(e[0]==="l")return Gnt(r,t,e);if(e[0]==="r")return Xnt(r,t,e);if(e[0]==="p")return Ynt(r,t,e)}return e}if(e instanceof CanvasPattern)return e}function Znt(r){var t=0,e=0,i=0,n=0;return Z(r)?r.length===1?t=e=i=n=r[0]:r.length===2?(t=i=r[0],e=n=r[1]):r.length===3?(t=r[0],e=n=r[1],i=r[2]):(t=r[0],e=r[1],i=r[2],n=r[3]):t=e=i=n=r,[t,e,i,n]}function Kv(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function q1(r,t){return Kv(r)*Kv(t)?(r[0]*t[0]+r[1]*t[1])/(Kv(r)*Kv(t)):1}function jR(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(q1(r,t))}function Hg(r,t){var e=t[1],i=t[2],n=Z0(q0(t[3]),Math.PI*2),a=t[4],o=t[5],s=r[0],l=r[1],u=t[6],c=t[7],h=Math.cos(n)*(s-u)/2+Math.sin(n)*(l-c)/2,f=-1*Math.sin(n)*(s-u)/2+Math.cos(n)*(l-c)/2,d=h*h/(e*e)+f*f/(i*i);d>1&&(e*=Math.sqrt(d),i*=Math.sqrt(d));var v=e*e*(f*f)+i*i*(h*h),p=v?Math.sqrt((e*e*(i*i)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=i?p*e*f/i:0,m=e?p*-i*h/e:0,y=(s+u)/2+Math.cos(n)*g-Math.sin(n)*m,_=(l+c)/2+Math.sin(n)*g+Math.cos(n)*m,x=[(h-g)/e,(f-m)/i],C=[(-1*h-g)/e,(-1*f-m)/i],A=jR([1,0],x),T=jR(x,C);return q1(x,C)<=-1&&(T=Math.PI),q1(x,C)>=1&&(T=0),o===0&&T>0&&(T=T-2*Math.PI),o===1&&T<0&&(T=T+2*Math.PI),{cx:y,cy:_,rx:YR(r,[u,c])?0:e,ry:YR(r,[u,c])?0:i,startAngle:A,endAngle:A+T,xRotation:n,arcFlag:a,sweepFlag:o}}var $g=Math.sin,Wg=Math.cos,$E=Math.atan2,Qv=Math.PI;function yD(r,t,e,i,n,a,o){var s=t.stroke,l=t.lineWidth,u=e-n,c=i-a,h=$E(c,u),f=new YE({type:"path",canvas:r.get("canvas"),isArrowShape:!0,attrs:{path:"M"+10*Wg(Qv/6)+","+10*$g(Qv/6)+" L0,0 L"+10*Wg(Qv/6)+",-"+10*$g(Qv/6),stroke:s,lineWidth:l}});f.translate(n,a),f.rotateAtPoint(n,a,h),r.set(o?"startArrowShape":"endArrowShape",f)}function _D(r,t,e,i,n,a,o){var s=t.startArrow,l=t.endArrow,u=t.stroke,c=t.lineWidth,h=o?s:l,f=h.d,d=h.fill,v=h.stroke,p=h.lineWidth,g=Ut(h,["d","fill","stroke","lineWidth"]),m=e-n,y=i-a,_=$E(y,m);f&&(n=n-Wg(_)*f,a=a-$g(_)*f);var x=new YE({type:"path",canvas:r.get("canvas"),isArrowShape:!0,attrs:S(S({},g),{stroke:v||u,lineWidth:p||c,fill:d})});x.translate(n,a),x.rotateAtPoint(n,a,_),r.set(o?"startArrowShape":"endArrowShape",x)}function Ll(r,t,e,i,n){var a=$E(i-t,e-r);return{dx:Wg(a)*n,dy:$g(a)*n}}function WE(r,t,e,i,n,a){typeof t.startArrow=="object"?_D(r,t,e,i,n,a,!0):t.startArrow?yD(r,t,e,i,n,a,!0):r.set("startArrowShape",null)}function VE(r,t,e,i,n,a){typeof t.endArrow=="object"?_D(r,t,e,i,n,a,!1):t.endArrow?yD(r,t,e,i,n,a,!1):r.set("startArrowShape",null)}var ZR={fill:"fillStyle",stroke:"strokeStyle",opacity:"globalAlpha"};function Ic(r,t){var e=t.attr();for(var i in e){var n=e[i],a=ZR[i]?ZR[i]:i;a==="matrix"&&n?r.transform(n[0],n[1],n[3],n[4],n[6],n[7]):a==="lineDash"&&r.setLineDash?Z(n)&&r.setLineDash(n):(a==="strokeStyle"||a==="fillStyle"?n=jnt(r,t,n):a==="globalAlpha"&&(n=n*r.globalAlpha),r[a]=n)}}function K1(r,t,e){for(var i=0;i<t.length;i++){var n=t[i];n.cfg.visible?n.draw(r,e):n.skipDraw()}}function qnt(r,t,e){var i=r.get("refreshElements");R(i,function(n){if(n!==r)for(var a=n.cfg.parent;a&&a!==r&&!a.cfg.refresh;)a.cfg.refresh=!0,a=a.cfg.parent}),i[0]===r?GE(t):Q1(t,e)}function Q1(r,t){for(var e=0;e<r.length;e++){var i=r[e];if(i.cfg.visible)if(i.cfg.hasChanged)i.cfg.refresh=!0,i.isGroup()&&GE(i.cfg.children);else if(i.cfg.refresh)i.isGroup()&&Q1(i.cfg.children,t);else{var n=Knt(i,t);i.cfg.refresh=n,n&&i.isGroup()&&Q1(i.cfg.children,t)}}}function xD(r){for(var t=0;t<r.length;t++){var e=r[t];e.cfg.hasChanged=!1,e.isGroup()&&!e.destroyed&&xD(e.cfg.children)}}function GE(r,t){for(var e=0;e<r.length;e++){var i=r[e];i.cfg.visible&&(i.cfg.refresh=!0,i.isGroup()&&GE(i.get("children")))}}function Knt(r,t){var e=r.cfg.cacheCanvasBBox,i=r.cfg.isInView&&e&&Yf(e,t);return i}function CD(r,t,e,i){var n=e.path,a=e.startArrow,o=e.endArrow;if(n){var s=[0,0],l=[0,0],u={dx:0,dy:0};t.beginPath();for(var c=0;c<n.length;c++){var h=n[c],f=h[0];if(c===0&&a&&a.d){var d=r.getStartTangent();u=Ll(d[0][0],d[0][1],d[1][0],d[1][1],a.d)}else if(c===n.length-2&&n[c+1][0]==="Z"&&o&&o.d){var v=n[c+1];if(v[0]==="Z"){var d=r.getEndTangent();u=Ll(d[0][0],d[0][1],d[1][0],d[1][1],o.d)}}else if(c===n.length-1&&o&&o.d&&n[0]!=="Z"){var d=r.getEndTangent();u=Ll(d[0][0],d[0][1],d[1][0],d[1][1],o.d)}var p=u.dx,g=u.dy;switch(f){case"M":t.moveTo(h[1]-p,h[2]-g),l=[h[1],h[2]];break;case"L":t.lineTo(h[1]-p,h[2]-g);break;case"Q":t.quadraticCurveTo(h[1],h[2],h[3]-p,h[4]-g);break;case"C":t.bezierCurveTo(h[1],h[2],h[3],h[4],h[5]-p,h[6]-g);break;case"A":{var m=void 0;i?(m=i[c],m||(m=Hg(s,h),i[c]=m)):m=Hg(s,h);var y=m.cx,_=m.cy,x=m.rx,C=m.ry,A=m.startAngle,T=m.endAngle,w=m.xRotation,M=m.sweepFlag;if(t.ellipse)t.ellipse(y,_,x,C,w,A,T,1-M);else{var O=x>C?x:C,P=x>C?1:x/C,D=x>C?C/x:1;t.translate(y,_),t.rotate(w),t.scale(P,D),t.arc(0,0,O,A,T,1-M),t.scale(1/P,1/D),t.rotate(-w),t.translate(-y,-_)}break}case"Z":t.closePath();break}if(f==="Z")s=l;else{var z=h.length;s=[h[z-2],h[z-1]]}}}}function ED(r,t){var e=r.get("canvas");e&&(t==="remove"&&(r._cacheCanvasBBox=r.get("cacheCanvasBBox")),r.get("hasChanged")||(r.set("hasChanged",!0),r.cfg.parent&&r.cfg.parent.get("hasChanged")||(e.refreshElement(r,t,e),e.get("autoDraw")&&e.draw())))}function Qnt(r){var t;if(r.destroyed)t=r._cacheCanvasBBox;else{var e=r.get("cacheCanvasBBox"),i=e&&!!(e.width&&e.height),n=r.getCanvasBBox(),a=n&&!!(n.width&&n.height);i&&a?t=Hnt(e,n):i?t=e:a&&(t=n)}return t}function Jnt(r){if(!r.length)return null;var t=[],e=[],i=[],n=[];return R(r,function(a){var o=Qnt(a);o&&(t.push(o.minX),e.push(o.minY),i.push(o.maxX),n.push(o.maxY))}),{minX:Wn(t),minY:Wn(e),maxX:pn(i),maxY:pn(n)}}function tat(r,t){return!r||!t||!Yf(r,t)?null:{minX:Math.max(r.minX,t.minX),minY:Math.max(r.minY,t.minY),maxX:Math.min(r.maxX,t.maxX),maxY:Math.min(r.maxY,t.maxY)}}var XE=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.onCanvasChange=function(e){ED(this,e)},t.prototype.getShapeBase=function(){return k0},t.prototype.getGroupBase=function(){return t},t.prototype._applyClip=function(e,i){i&&(e.save(),Ic(e,i),i.createPath(e),e.restore(),e.clip(),i._afterDraw())},t.prototype.cacheCanvasBBox=function(){var e=this.cfg.children,i=[],n=[];R(e,function(f){var d=f.cfg.cacheCanvasBBox;d&&f.cfg.isInView&&(i.push(d.minX,d.maxX),n.push(d.minY,d.maxY))});var a=null;if(i.length){var o=Wn(i),s=pn(i),l=Wn(n),u=pn(n);a={minX:o,minY:l,x:o,y:l,maxX:s,maxY:u,width:s-o,height:u-l};var c=this.cfg.canvas;if(c){var h=c.getViewRange();this.set("isInView",Yf(a,h))}}else this.set("isInView",!1);this.set("cacheCanvasBBox",a)},t.prototype.draw=function(e,i){var n=this.cfg.children,a=i?this.cfg.refresh:!0;n.length&&a&&(e.save(),Ic(e,this),this._applyClip(e,this.getClip()),K1(e,n,i),e.restore(),this.cacheCanvasBBox()),this.cfg.refresh=null,this.set("hasChanged",!1)},t.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("hasChanged",!1)},t}(rm),wa=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},t.prototype.getShapeBase=function(){return k0},t.prototype.getGroupBase=function(){return XE},t.prototype.onCanvasChange=function(e){ED(this,e)},t.prototype.calculateBBox=function(){var e=this.get("type"),i=this.getHitLineWidth(),n=nm(e),a=n(this),o=i/2,s=a.x-o,l=a.y-o,u=a.x+a.width+o,c=a.y+a.height+o;return{x:s,minX:s,y:l,minY:l,width:a.width+i,height:a.height+i,maxX:u,maxY:c}},t.prototype.isFill=function(){return!!this.attrs.fill||this.isClipShape()},t.prototype.isStroke=function(){return!!this.attrs.stroke},t.prototype._applyClip=function(e,i){i&&(e.save(),Ic(e,i),i.createPath(e),e.restore(),e.clip(),i._afterDraw())},t.prototype.draw=function(e,i){var n=this.cfg.clipShape;if(i){if(this.cfg.refresh===!1){this.set("hasChanged",!1);return}var a=this.getCanvasBBox();if(!Yf(i,a)){this.set("hasChanged",!1),this.cfg.isInView&&this._afterDraw();return}}e.save(),Ic(e,this),this._applyClip(e,n),this.drawPath(e),e.restore(),this._afterDraw()},t.prototype.getCanvasViewBox=function(){var e=this.cfg.canvas;return e?e.getViewRange():null},t.prototype.cacheCanvasBBox=function(){var e=this.getCanvasViewBox();if(e){var i=this.getCanvasBBox(),n=Yf(i,e);this.set("isInView",n),n?this.set("cacheCanvasBBox",i):this.set("cacheCanvasBBox",null)}},t.prototype._afterDraw=function(){this.cacheCanvasBBox(),this.set("hasChanged",!1),this.set("refresh",null)},t.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("isInView",null),this.set("hasChanged",!1)},t.prototype.drawPath=function(e){this.createPath(e),this.strokeAndFill(e),this.afterDrawPath(e)},t.prototype.fill=function(e){e.fill()},t.prototype.stroke=function(e){e.stroke()},t.prototype.strokeAndFill=function(e){var i=this.attrs,n=i.lineWidth,a=i.opacity,o=i.strokeOpacity,s=i.fillOpacity;this.isFill()&&(!j(s)&&s!==1?(e.globalAlpha=s,this.fill(e),e.globalAlpha=a):this.fill(e)),this.isStroke()&&n>0&&(!j(o)&&o!==1&&(e.globalAlpha=o),this.stroke(e)),this.afterDrawPath(e)},t.prototype.createPath=function(e){},t.prototype.afterDrawPath=function(e){},t.prototype.isInShape=function(e,i){var n=this.isStroke(),a=this.isFill(),o=this.getHitLineWidth();return this.isInStrokeOrPath(e,i,n,a,o)},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){return!1},t.prototype.getHitLineWidth=function(){if(!this.isStroke())return 0;var e=this.attrs;return e.lineWidth+e.lineAppendWidth},t}(im),eat=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,r:0})},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr(),l=s.x,u=s.y,c=s.r,h=o/2,f=pD(l,u,e,i);return a&&n?f<=c+h:a?f<=c:n?f>=c-h&&f<=c+h:!1},t.prototype.createPath=function(e){var i=this.attr(),n=i.x,a=i.y,o=i.r;e.beginPath(),e.arc(n,a,o,0,Math.PI*2,!1),e.closePath()},t}(wa);function Jv(r,t,e,i){return r/(e*e)+t/(i*i)}var rat=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,rx:0,ry:0})},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr(),l=o/2,u=s.x,c=s.y,h=s.rx,f=s.ry,d=(e-u)*(e-u),v=(i-c)*(i-c);return a&&n?Jv(d,v,h+l,f+l)<=1:a?Jv(d,v,h,f)<=1:n?Jv(d,v,h-l,f-l)>=1&&Jv(d,v,h+l,f+l)<=1:!1},t.prototype.createPath=function(e){var i=this.attr(),n=i.x,a=i.y,o=i.rx,s=i.ry;if(e.beginPath(),e.ellipse)e.ellipse(n,a,o,s,0,0,Math.PI*2,!1);else{var l=o>s?o:s,u=o>s?1:o/s,c=o>s?s/o:1;e.save(),e.translate(n,a),e.scale(u,c),e.arc(0,0,l,0,Math.PI*2),e.restore(),e.closePath()}},t}(wa);function qR(r){return r instanceof HTMLElement&&mt(r.nodeName)&&r.nodeName.toUpperCase()==="CANVAS"}var iat=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,width:0,height:0})},t.prototype.initAttrs=function(e){this._setImage(e.img)},t.prototype.isStroke=function(){return!1},t.prototype.isOnlyHitBox=function(){return!0},t.prototype._afterLoading=function(){if(this.get("toDraw")===!0){var e=this.get("canvas");e?e.draw():this.createPath(this.get("context"))}},t.prototype._setImage=function(e){var i=this,n=this.attrs;if(mt(e)){var a=new Image;a.onload=function(){if(i.destroyed)return!1;i.attr("img",a),i.set("loading",!1),i._afterLoading();var o=i.get("callback");o&&o.call(i)},a.crossOrigin="Anonymous",a.src=e,this.set("loading",!0)}else e instanceof Image?(n.width||(n.width=e.width),n.height||(n.height=e.height)):qR(e)&&(n.width||(n.width=Number(e.getAttribute("width"))),n.height||(n.height,Number(e.getAttribute("height"))))},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),e==="img"&&this._setImage(i)},t.prototype.createPath=function(e){if(this.get("loading")){this.set("toDraw",!0),this.set("context",e);return}var i=this.attr(),n=i.x,a=i.y,o=i.width,s=i.height,l=i.sx,u=i.sy,c=i.swidth,h=i.sheight,f=i.img;(f instanceof Image||qR(f))&&(!j(l)&&!j(u)&&!j(c)&&!j(h)?e.drawImage(f,l,u,c,h,n,a,o,s):e.drawImage(f,n,a,o,s))},t}(wa);function ys(r,t,e,i,n,a,o){var s=Math.min(r,e),l=Math.max(r,e),u=Math.min(t,i),c=Math.max(t,i),h=n/2;return a>=s-h&&a<=l+h&&o>=u-h&&o<=c+h?Nr.pointToLine(r,t,e,i,a,o)<=n/2:!1}var nat=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(e){this.setArrow()},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),this.setArrow()},t.prototype.setArrow=function(){var e=this.attr(),i=e.x1,n=e.y1,a=e.x2,o=e.y2,s=e.startArrow,l=e.endArrow;s&&WE(this,e,a,o,i,n),l&&VE(this,e,i,n,a,o)},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){if(!n||!o)return!1;var s=this.attr(),l=s.x1,u=s.y1,c=s.x2,h=s.y2;return ys(l,u,c,h,o,e,i)},t.prototype.createPath=function(e){var i=this.attr(),n=i.x1,a=i.y1,o=i.x2,s=i.y2,l=i.startArrow,u=i.endArrow,c={dx:0,dy:0},h={dx:0,dy:0};l&&l.d&&(c=Ll(n,a,o,s,i.startArrow.d)),u&&u.d&&(h=Ll(n,a,o,s,i.endArrow.d)),e.beginPath(),e.moveTo(n+c.dx,a+c.dy),e.lineTo(o-h.dx,s-h.dy)},t.prototype.afterDrawPath=function(e){var i=this.get("startArrowShape"),n=this.get("endArrowShape");i&&i.draw(e),n&&n.draw(e)},t.prototype.getTotalLength=function(){var e=this.attr(),i=e.x1,n=e.y1,a=e.x2,o=e.y2;return Nr.length(i,n,a,o)},t.prototype.getPoint=function(e){var i=this.attr(),n=i.x1,a=i.y1,o=i.x2,s=i.y2;return Nr.pointAt(n,a,o,s,e)},t}(wa),aat=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/ig,oat=/[^\s\,]+/ig;function sat(r){var t=r||[];if(Z(t))return t;if(mt(t))return t=t.match(aat),R(t,function(e,i){if(e=e.match(oat),e[0].length>1){var n=e[0].charAt(0);e.splice(1,0,e[0].substr(1)),e[0]=n}R(e,function(a,o){isNaN(a)||(e[o]=+a)}),t[i]=e}),t}var xf=`	
\v\f\r   ᠎             　\u2028\u2029`,lat=new RegExp("([a-z])["+xf+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+xf+"]*,?["+xf+"]*)+)","ig"),uat=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+xf+"]*,?["+xf+"]*","ig");function cat(r){if(!r)return null;if(Z(r))return r;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(r).replace(lat,function(i,n,a){var o=[],s=n.toLowerCase();if(a.replace(uat,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(e.push([n].concat(o.splice(0,2))),s="l",n=n==="m"?"l":"L"),s==="o"&&o.length===1&&e.push([n,o[0]]),s==="r")e.push([n].concat(o));else for(;o.length>=t[s]&&(e.push([n].concat(o.splice(0,t[s]))),!!t[s]););return""}),e}var hat=/[a-z]/;function KR(r,t){return[t[0]+(t[0]-r[0]),t[1]+(t[1]-r[1])]}function SD(r){var t=cat(r);if(!t||!t.length)return[["M",0,0]];for(var e=!1,i=0;i<t.length;i++){var n=t[i][0];if(hat.test(n)||["V","H","T","S"].indexOf(n)>=0){e=!0;break}}if(!e)return t;var a=[],o=0,s=0,l=0,u=0,c=0,h=t[0];(h[0]==="M"||h[0]==="m")&&(o=+h[1],s=+h[2],l=o,u=s,c++,a[0]=["M",o,s]);for(var i=c,f=t.length;i<f;i++){var d=t[i],v=a[i-1],p=[],n=d[0],g=n.toUpperCase();if(n!==g)switch(p[0]=g,g){case"A":p[1]=d[1],p[2]=d[2],p[3]=d[3],p[4]=d[4],p[5]=d[5],p[6]=+d[6]+o,p[7]=+d[7]+s;break;case"V":p[1]=+d[1]+s;break;case"H":p[1]=+d[1]+o;break;case"M":l=+d[1]+o,u=+d[2]+s,p[1]=l,p[2]=u;break;default:for(var m=1,y=d.length;m<y;m++)p[m]=+d[m]+(m%2?o:s)}else p=t[i];switch(g){case"Z":o=+l,s=+u;break;case"H":o=p[1],p=["L",o,s];break;case"V":s=p[1],p=["L",o,s];break;case"T":o=p[1],s=p[2];var _=KR([v[1],v[2]],[v[3],v[4]]);p=["Q",_[0],_[1],o,s];break;case"S":o=p[p.length-2],s=p[p.length-1];var x=v.length,C=KR([v[x-4],v[x-3]],[v[x-2],v[x-1]]);p=["C",C[0],C[1],p[1],p[2],o,s];break;case"M":l=p[p.length-2],u=p[p.length-1];break;default:o=p[p.length-2],s=p[p.length-1]}a.push(p)}return a}function tp(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function J1(r,t){return tp(r)*tp(t)?(r[0]*t[0]+r[1]*t[1])/(tp(r)*tp(t)):1}function QR(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(J1(r,t))}function tx(r,t){return r[0]===t[0]&&r[1]===t[1]}function fat(r,t){var e=t[1],i=t[2],n=Z0(q0(t[3]),Math.PI*2),a=t[4],o=t[5],s=r[0],l=r[1],u=t[6],c=t[7],h=Math.cos(n)*(s-u)/2+Math.sin(n)*(l-c)/2,f=-1*Math.sin(n)*(s-u)/2+Math.cos(n)*(l-c)/2,d=h*h/(e*e)+f*f/(i*i);d>1&&(e*=Math.sqrt(d),i*=Math.sqrt(d));var v=e*e*(f*f)+i*i*(h*h),p=v?Math.sqrt((e*e*(i*i)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=i?p*e*f/i:0,m=e?p*-i*h/e:0,y=(s+u)/2+Math.cos(n)*g-Math.sin(n)*m,_=(l+c)/2+Math.sin(n)*g+Math.cos(n)*m,x=[(h-g)/e,(f-m)/i],C=[(-1*h-g)/e,(-1*f-m)/i],A=QR([1,0],x),T=QR(x,C);return J1(x,C)<=-1&&(T=Math.PI),J1(x,C)>=1&&(T=0),o===0&&T>0&&(T=T-2*Math.PI),o===1&&T<0&&(T=T+2*Math.PI),{cx:y,cy:_,rx:tx(r,[u,c])?0:e,ry:tx(r,[u,c])?0:i,startAngle:A,endAngle:A+T,xRotation:n,arcFlag:a,sweepFlag:o}}function JR(r,t){return[t[0]+(t[0]-r[0]),t[1]+(t[1]-r[1])]}function dat(r){r=sat(r);for(var t=[],e=null,i=null,n=null,a=0,o=r.length,s=0;s<o;s++){var l=r[s];i=r[s+1];var u=l[0],c={command:u,prePoint:e,params:l,startTangent:null,endTangent:null};switch(u){case"M":n=[l[1],l[2]],a=s;break;case"A":var h=fat(e,l);c.arcParams=h;break}if(u==="Z")e=n,i=r[a+1];else{var f=l.length;e=[l[f-2],l[f-1]]}i&&i[0]==="Z"&&(i=r[a],t[a]&&(t[a].prePoint=e)),c.currentPoint=e,t[a]&&tx(e,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var d=i?[i[i.length-2],i[i.length-1]]:null;c.nextPoint=d;var v=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[v[0]-e[0],v[1]-e[1]],c.endTangent=[e[0]-v[0],e[1]-v[1]];else if(u==="Q"){var p=[l[1],l[2]];c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[e[0]-p[0],e[1]-p[1]]}else if(u==="T"){var g=t[s-1],p=JR(g.currentPoint,v);g.command==="Q"?(c.command="Q",c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[e[0]-p[0],e[1]-p[1]]):(c.command="TL",c.startTangent=[v[0]-e[0],v[1]-e[1]],c.endTangent=[e[0]-v[0],e[1]-v[1]])}else if(u==="C"){var m=[l[1],l[2]],y=[l[3],l[4]];c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]],c.startTangent[0]===0&&c.startTangent[1]===0&&(c.startTangent=[m[0]-y[0],m[1]-y[1]]),c.endTangent[0]===0&&c.endTangent[1]===0&&(c.endTangent=[y[0]-m[0],y[1]-m[1]])}else if(u==="S"){var g=t[s-1],m=JR(g.currentPoint,v),y=[l[1],l[2]];g.command==="C"?(c.command="C",c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]]):(c.command="SQ",c.startTangent=[v[0]-y[0],v[1]-y[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]])}else if(u==="A"){var _=.001,x=c.arcParams||{},C=x.cx,A=C===void 0?0:C,T=x.cy,w=T===void 0?0:T,M=x.rx,O=M===void 0?0:M,P=x.ry,D=P===void 0?0:P,z=x.sweepFlag,Y=z===void 0?0:z,H=x.startAngle,N=H===void 0?0:H,W=x.endAngle,Q=W===void 0?0:W;Y===0&&(_*=-1);var q=O*Math.cos(N-_)+A,J=D*Math.sin(N-_)+w;c.startTangent=[q-n[0],J-n[1]];var et=O*Math.cos(N+Q+_)+A,ft=D*Math.sin(N+Q-_)+w;c.endTangent=[v[0]-et,v[1]-ft]}t.push(c)}return t}var vat={circle:function(r,t,e){return[["M",r-e,t],["A",e,e,0,1,0,r+e,t],["A",e,e,0,1,0,r-e,t]]},square:function(r,t,e){return[["M",r-e,t-e],["L",r+e,t-e],["L",r+e,t+e],["L",r-e,t+e],["Z"]]},diamond:function(r,t,e){return[["M",r-e,t],["L",r,t-e],["L",r+e,t],["L",r,t+e],["Z"]]},triangle:function(r,t,e){var i=e*Math.sin(.3333333333333333*Math.PI);return[["M",r-e,t+i],["L",r,t-i],["L",r+e,t+i],["Z"]]},"triangle-down":function(r,t,e){var i=e*Math.sin(.3333333333333333*Math.PI);return[["M",r-e,t-i],["L",r+e,t-i],["L",r,t+i],["Z"]]}},pat=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.initAttrs=function(e){this._resetParamsCache()},t.prototype._resetParamsCache=function(){this.set("paramsCache",{})},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),["symbol","x","y","r","radius"].indexOf(e)!==-1&&this._resetParamsCache()},t.prototype.isOnlyHitBox=function(){return!0},t.prototype._getR=function(e){return j(e.r)?e.radius:e.r},t.prototype._getPath=function(){var e=this.attr(),i=e.x,n=e.y,a=e.symbol||"circle",o=this._getR(e),s,l;if(ut(a))s=a,l=s(i,n,o),l=SD(l);else{if(s=t.Symbols[a],!s)return console.warn(a+" marker is not supported."),null;l=s(i,n,o)}return l},t.prototype.createPath=function(e){var i=this._getPath(),n=this.get("paramsCache");CD(this,e,{path:i},n)},t.Symbols=vat,t}(wa);function AD(r,t,e){var i=om();return r.createPath(i),i.isPointInPath(t,e)}var gat=1e-6;function o_(r){return Math.abs(r)<gat?0:r<0?-1:1}function mat(r,t,e){return(e[0]-r[0])*(t[1]-r[1])===(t[0]-r[0])*(e[1]-r[1])&&Math.min(r[0],t[0])<=e[0]&&e[0]<=Math.max(r[0],t[0])&&Math.min(r[1],t[1])<=e[1]&&e[1]<=Math.max(r[1],t[1])}function TD(r,t,e){var i=!1,n=r.length;if(n<=2)return!1;for(var a=0;a<n;a++){var o=r[a],s=r[(a+1)%n];if(mat(o,s,[t,e]))return!0;o_(o[1]-e)>0!=o_(s[1]-e)>0&&o_(t-(e-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(i=!i)}return i}function nf(r,t,e,i,n,a,o,s){var l=(Math.atan2(s-t,o-r)+Math.PI*2)%(Math.PI*2);if(l<i||l>n)return!1;var u={x:r+e*Math.cos(l),y:t+e*Math.sin(l)};return pD(u.x,u.y,o,s)<=a/2}var yat=hr;function _at(r){for(var t=!1,e=r.length,i=0;i<e;i++){var n=r[i],a=n[0];if(a==="C"||a==="A"||a==="Q"){t=!0;break}}return t}function xat(r,t,e,i,n){for(var a=!1,o=t/2,s=0;s<r.length;s++){var l=r[s],u=l.currentPoint,c=l.params,h=l.prePoint,f=l.box;if(!(f&&!xl(f.x-o,f.y-o,f.width+t,f.height+t,e,i))){switch(l.command){case"L":case"Z":a=ys(h[0],h[1],u[0],u[1],t,e,i);break;case"Q":var d=hD.pointDistance(h[0],h[1],c[1],c[2],c[3],c[4],e,i);a=d<=t/2;break;case"C":var v=_f.pointDistance(h[0],h[1],c[1],c[2],c[3],c[4],c[5],c[6],e,i,n);a=v<=t/2;break;case"A":var p=l.arcParams,g=p.cx,m=p.cy,y=p.rx,_=p.ry,x=p.startAngle,C=p.endAngle,A=p.xRotation,T=[e,i,1],w=y>_?y:_,M=y>_?1:y/_,O=y>_?_/y:1,P=yat(null,[["t",-g,-m],["r",-A],["s",1/M,1/O]]);Nf(T,T,P),a=nf(0,0,w,x,C,t,T[0],T[1]);break}if(a)break}}return a}function Cat(r){for(var t=r.length,e=[],i=[],n=[],a=0;a<t;a++){var o=r[a],s=o[0];s==="M"?(n.length&&(i.push(n),n=[]),n.push([o[1],o[2]])):s==="Z"?n.length&&(e.push(n),n=[]):n.push([o[1],o[2]])}return n.length>0&&i.push(n),{polygons:e,polylines:i}}const ep=S({hasArc:_at,extractPolygons:Cat,isPointInStroke:xat},kE);function tM(r,t,e){for(var i=!1,n=0;n<r.length;n++){var a=r[n];if(i=TD(a,t,e),i)break}return i}var YE=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(e){this._setPathArr(e.path),this.setArrow()},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),e==="path"&&this._setPathArr(i),this.setArrow()},t.prototype._setPathArr=function(e){this.attrs.path=SD(e);var i=ep.hasArc(e);this.set("hasArc",i),this.set("paramsCache",{}),this.set("segments",null),this.set("curve",null),this.set("tCache",null),this.set("totalLength",null)},t.prototype.getSegments=function(){var e=this.get("segements");return e||(e=dat(this.attr("path")),this.set("segments",e)),e},t.prototype.setArrow=function(){var e=this.attr(),i=e.startArrow,n=e.endArrow;if(i){var a=this.getStartTangent();WE(this,e,a[0][0],a[0][1],a[1][0],a[1][1])}if(n){var a=this.getEndTangent();VE(this,e,a[0][0],a[0][1],a[1][0],a[1][1])}},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.getSegments(),l=this.get("hasArc"),u=!1;if(n){var c=this.getTotalLength();u=ep.isPointInStroke(s,o,e,i,c)}if(!u&&a)if(l)u=AD(this,e,i);else{var h=this.attr("path"),f=ep.extractPolygons(h);u=tM(f.polygons,e,i)||tM(f.polylines,e,i)}return u},t.prototype.createPath=function(e){var i=this.attr(),n=this.get("paramsCache");CD(this,e,i,n)},t.prototype.afterDrawPath=function(e){var i=this.get("startArrowShape"),n=this.get("endArrowShape");i&&i.draw(e),n&&n.draw(e)},t.prototype.getTotalLength=function(){var e=this.get("totalLength");return j(e)?(this._calculateCurve(),this._setTcache(),this.get("totalLength")):e},t.prototype.getPoint=function(e){var i=this.get("tCache");i||(this._calculateCurve(),this._setTcache(),i=this.get("tCache"));var n,a,o=this.get("curve");if(!i||i.length===0)return o?{x:o[0][1],y:o[0][2]}:null;R(i,function(c,h){e>=c[0]&&e<=c[1]&&(n=(e-c[0])/(c[1]-c[0]),a=h)});var s=o[a];if(j(s)||j(a))return null;var l=s.length,u=o[a+1];return _f.pointAt(s[l-2],s[l-1],u[1],u[2],u[3],u[4],u[5],u[6],n)},t.prototype._calculateCurve=function(){var e=this.attr().path;this.set("curve",ep.pathToCurve(e))},t.prototype._setTcache=function(){var e=0,i=0,n=[],a,o,s,l,u=this.get("curve");if(u){if(R(u,function(c,h){s=u[h+1],l=c.length,s&&(e+=_f.length(c[l-2],c[l-1],s[1],s[2],s[3],s[4],s[5],s[6])||0)}),this.set("totalLength",e),e===0){this.set("tCache",[]);return}R(u,function(c,h){s=u[h+1],l=c.length,s&&(a=[],a[0]=i/e,o=_f.length(c[l-2],c[l-1],s[1],s[2],s[3],s[4],s[5],s[6]),i+=o||0,a[1]=i/e,n.push(a))}),this.set("tCache",n)}},t.prototype.getStartTangent=function(){var e=this.getSegments(),i;if(e.length>1){var n=e[0].currentPoint,a=e[1].currentPoint,o=e[1].startTangent;i=[],o?(i.push([n[0]-o[0],n[1]-o[1]]),i.push([n[0],n[1]])):(i.push([a[0],a[1]]),i.push([n[0],n[1]]))}return i},t.prototype.getEndTangent=function(){var e=this.getSegments(),i=e.length,n;if(i>1){var a=e[i-2].currentPoint,o=e[i-1].currentPoint,s=e[i-1].endTangent;n=[],s?(n.push([o[0]-s[0],o[1]-s[1]]),n.push([o[0],o[1]])):(n.push([a[0],a[1]]),n.push([o[0],o[1]]))}return n},t}(wa);function bD(r,t,e,i,n){var a=r.length;if(a<2)return!1;for(var o=0;o<a-1;o++){var s=r[o][0],l=r[o][1],u=r[o+1][0],c=r[o+1][1];if(ys(s,l,u,c,t,e,i))return!0}if(n){var h=r[0],f=r[a-1];if(ys(h[0],h[1],f[0],f[1],t,e,i))return!0}return!1}var Eat=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr().points,l=!1;return n&&(l=bD(s,o,e,i,!0)),!l&&a&&(l=TD(s,e,i)),l},t.prototype.createPath=function(e){var i=this.attr(),n=i.points;if(!(n.length<2)){e.beginPath();for(var a=0;a<n.length;a++){var o=n[a];a===0?e.moveTo(o[0],o[1]):e.lineTo(o[0],o[1])}e.closePath()}},t}(wa),Sat=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(e){this.setArrow()},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),this.setArrow(),["points"].indexOf(e)!==-1&&this._resetCache()},t.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},t.prototype.setArrow=function(){var e=this.attr(),i=this.attrs,n=i.points,a=i.startArrow,o=i.endArrow,s=n.length,l=n[0][0],u=n[0][1],c=n[s-1][0],h=n[s-1][1];a&&WE(this,e,n[1][0],n[1][1],l,u),o&&VE(this,e,n[s-2][0],n[s-2][1],c,h)},t.prototype.isFill=function(){return!1},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){if(!n||!o)return!1;var s=this.attr().points;return bD(s,o,e,i,!1)},t.prototype.isStroke=function(){return!0},t.prototype.createPath=function(e){var i=this.attr(),n=i.points,a=i.startArrow,o=i.endArrow,s=n.length;if(!(n.length<2)){var l=n[0][0],u=n[0][1],c=n[s-1][0],h=n[s-1][1];if(a&&a.d){var f=Ll(l,u,n[1][0],n[1][1],a.d);l+=f.dx,u+=f.dy}if(o&&o.d){var f=Ll(n[s-2][0],n[s-2][1],c,h,o.d);c-=f.dx,h-=f.dy}e.beginPath(),e.moveTo(l,u);for(var d=0;d<s-1;d++){var v=n[d];e.lineTo(v[0],v[1])}e.lineTo(c,h)}},t.prototype.afterDrawPath=function(e){var i=this.get("startArrowShape"),n=this.get("endArrowShape");i&&i.draw(e),n&&n.draw(e)},t.prototype.getTotalLength=function(){var e=this.attr().points,i=this.get("totalLength");return j(i)?(this.set("totalLength",vD.length(e)),this.get("totalLength")):i},t.prototype.getPoint=function(e){var i=this.attr().points,n=this.get("tCache");n||(this._setTcache(),n=this.get("tCache"));var a,o;return R(n,function(s,l){e>=s[0]&&e<=s[1]&&(a=(e-s[0])/(s[1]-s[0]),o=l)}),Nr.pointAt(i[o][0],i[o][1],i[o+1][0],i[o+1][1],a)},t.prototype._setTcache=function(){var e=this.attr().points;if(!(!e||e.length===0)){var i=this.getTotalLength();if(!(i<=0)){var n=0,a=[],o,s;R(e,function(l,u){e[u+1]&&(o=[],o[0]=n/i,s=Nr.length(l[0],l[1],e[u+1][0],e[u+1][1]),n+=s,o[1]=n/i,a.push(o))}),this.set("tCache",a)}}},t.prototype.getStartTangent=function(){var e=this.attr().points,i=[];return i.push([e[1][0],e[1][1]]),i.push([e[0][0],e[0][1]]),i},t.prototype.getEndTangent=function(){var e=this.attr().points,i=e.length-1,n=[];return n.push([e[i-1][0],e[i-1][1]]),n.push([e[i][0],e[i][1]]),n},t}(wa);function Aat(r,t,e,i,n,a,o){var s=n/2;return xl(r-s,t-s,e,n,a,o)||xl(r+e-s,t-s,n,i,a,o)||xl(r+s,t+i-s,e,n,a,o)||xl(r-s,t+s,n,i,a,o)}function Tat(r,t,e,i,n,a,o,s){return ys(r+n,t,r+e-n,t,a,o,s)||ys(r+e,t+n,r+e,t+i-n,a,o,s)||ys(r+e-n,t+i,r+n,t+i,a,o,s)||ys(r,t+i-n,r,t+n,a,o,s)||nf(r+e-n,t+n,n,1.5*Math.PI,2*Math.PI,a,o,s)||nf(r+e-n,t+i-n,n,0,.5*Math.PI,a,o,s)||nf(r+n,t+i-n,n,.5*Math.PI,Math.PI,a,o,s)||nf(r+n,t+n,n,Math.PI,1.5*Math.PI,a,o,s)}var bat=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,width:0,height:0,radius:0})},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr(),l=s.x,u=s.y,c=s.width,h=s.height,f=s.radius;if(f){var v=!1;return n&&(v=Tat(l,u,c,h,f,o,e,i)),!v&&a&&(v=AD(this,e,i)),v}else{var d=o/2;if(a&&n)return xl(l-d,u-d,c+d,h+d,e,i);if(a)return xl(l,u,c,h,e,i);if(n)return Aat(l,u,c,h,o,e,i)}},t.prototype.createPath=function(e){var i=this.attr(),n=i.x,a=i.y,o=i.width,s=i.height,l=i.radius;if(e.beginPath(),l===0)e.rect(n,a,o,s);else{var u=Znt(l),c=u[0],h=u[1],f=u[2],d=u[3];e.moveTo(n+c,a),e.lineTo(n+o-h,a),h!==0&&e.arc(n+o-h,a+h,h,-Math.PI/2,0),e.lineTo(n+o,a+s-f),f!==0&&e.arc(n+o-f,a+s-f,f,0,Math.PI/2),e.lineTo(n+d,a+s),d!==0&&e.arc(n+d,a+s-d,d,Math.PI/2,Math.PI),e.lineTo(n,a+c),c!==0&&e.arc(n+c,a+c,c,Math.PI,Math.PI*1.5),e.closePath()}},t}(wa),wat=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},t.prototype.isOnlyHitBox=function(){return!0},t.prototype.initAttrs=function(e){this._assembleFont(),e.text&&this._setText(e.text)},t.prototype._assembleFont=function(){var e=this.attrs;e.font=lm(e)},t.prototype._setText=function(e){var i=null;mt(e)&&e.indexOf(`
`)!==-1&&(i=e.split(`
`)),this.set("textArr",i)},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),e.startsWith("font")&&this._assembleFont(),e==="text"&&this._setText(i)},t.prototype._getSpaceingY=function(){var e=this.attrs,i=e.lineHeight,n=e.fontSize*1;return i?i-n:n*.14},t.prototype._drawTextArr=function(e,i,n){var a=this.attrs,o=a.textBaseline,s=a.x,l=a.y,u=a.fontSize*1,c=this._getSpaceingY(),h=sm(a.text,a.fontSize,a.lineHeight),f;R(i,function(d,v){f=l+v*(c+u)-h+u,o==="middle"&&(f+=h-u-(h-u)/2),o==="top"&&(f+=h-u),j(d)||(n?e.fillText(d,s,f):e.strokeText(d,s,f))})},t.prototype._drawText=function(e,i){var n=this.attr(),a=n.x,o=n.y,s=this.get("textArr");if(s)this._drawTextArr(e,s,i);else{var l=n.text;j(l)||(i?e.fillText(l,a,o):e.strokeText(l,a,o))}},t.prototype.strokeAndFill=function(e){var i=this.attrs,n=i.lineWidth,a=i.opacity,o=i.strokeOpacity,s=i.fillOpacity;this.isStroke()&&n>0&&(!j(o)&&o!==1&&(e.globalAlpha=a),this.stroke(e)),this.isFill()&&(!j(s)&&s!==1?(e.globalAlpha=s,this.fill(e),e.globalAlpha=a):this.fill(e)),this.afterDrawPath(e)},t.prototype.fill=function(e){this._drawText(e,!0)},t.prototype.stroke=function(e){this._drawText(e,!1)},t}(wa);function Rat(r,t){if(t){var e=tm(t);return Ao(e,r)}return r}function wD(r,t,e){var i=r.getTotalMatrix();if(i){var n=Rat([t,e,1],i),a=n[0],o=n[1];return[a,o]}return[t,e]}function eM(r,t,e){if(r.isCanvas&&r.isCanvas())return!0;if(!Xf(r)||r.cfg.isInView===!1)return!1;if(r.cfg.clipShape){var i=wD(r,t,e),n=i[0],a=i[1];if(r.isClipped(n,a))return!1}var o=r.cfg.cacheCanvasBBox||r.getCanvasBBox();return t>=o.minX&&t<=o.maxX&&e>=o.minY&&e<=o.maxY}function RD(r,t,e){if(!eM(r,t,e))return null;for(var i=null,n=r.getChildren(),a=n.length,o=a-1;o>=0;o--){var s=n[o];if(s.isGroup())i=RD(s,t,e);else if(eM(s,t,e)){var l=s,u=wD(s,t,e),c=u[0],h=u[1];l.isInShape(c,h)&&(i=s)}if(i)break}return i}var Mat=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return e.renderer="canvas",e.autoDraw=!0,e.localRefresh=!0,e.refreshElements=[],e.clipView=!0,e.quickHit=!1,e},t.prototype.onCanvasChange=function(e){(e==="attr"||e==="sort"||e==="changeSize")&&(this.set("refreshElements",[this]),this.draw())},t.prototype.getShapeBase=function(){return k0},t.prototype.getGroupBase=function(){return XE},t.prototype.getPixelRatio=function(){var e=this.get("pixelRatio")||znt();return e>=1?Math.ceil(e):1},t.prototype.getViewRange=function(){return{minX:0,minY:0,maxX:this.cfg.width,maxY:this.cfg.height}},t.prototype.createDom=function(){var e=document.createElement("canvas"),i=e.getContext("2d");return this.set("context",i),e},t.prototype.setDOMSize=function(e,i){r.prototype.setDOMSize.call(this,e,i);var n=this.get("context"),a=this.get("el"),o=this.getPixelRatio();a.width=o*e,a.height=o*i,o>1&&n.scale(o,o)},t.prototype.clear=function(){r.prototype.clear.call(this),this._clearFrame();var e=this.get("context"),i=this.get("el");e.clearRect(0,0,i.width,i.height)},t.prototype.getShape=function(e,i){var n;return this.get("quickHit")?n=RD(this,e,i):n=r.prototype.getShape.call(this,e,i,null),n},t.prototype._getRefreshRegion=function(){var e=this.get("refreshElements"),i=this.getViewRange(),n;if(e.length&&e[0]===this)n=i;else if(n=Jnt(e),n){n.minX=Math.floor(n.minX),n.minY=Math.floor(n.minY),n.maxX=Math.ceil(n.maxX),n.maxY=Math.ceil(n.maxY),n.maxY+=1;var a=this.get("clipView");a&&(n=tat(n,i))}return n},t.prototype.refreshElement=function(e){var i=this.get("refreshElements");i.push(e)},t.prototype._clearFrame=function(){var e=this.get("drawFrame");e&&(_it(e),this.set("drawFrame",null),this.set("refreshElements",[]))},t.prototype.draw=function(){var e=this.get("drawFrame");this.get("autoDraw")&&e||this._startDraw()},t.prototype._drawAll=function(){var e=this.get("context"),i=this.get("el"),n=this.getChildren();e.clearRect(0,0,i.width,i.height),Ic(e,this),K1(e,n),this.set("refreshElements",[])},t.prototype._drawRegion=function(){var e=this.get("context"),i=this.get("refreshElements"),n=this.getChildren(),a=this._getRefreshRegion();a?(e.clearRect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),e.save(),e.beginPath(),e.rect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),e.clip(),Ic(e,this),qnt(this,n,a),K1(e,n,a),e.restore()):i.length&&xD(i),R(i,function(o){o.get("hasChanged")&&o.set("hasChanged",!1)}),this.set("refreshElements",[])},t.prototype._startDraw=function(){var e=this,i=this.get("drawFrame"),n=this.get("drawFrameCallback");i||(i=yit(function(){e.get("localRefresh")?e._drawRegion():e._drawAll(),e.set("drawFrame",null),n&&n()}),this.set("drawFrame",i))},t.prototype.skipDraw=function(){},t.prototype.removeDom=function(){var e=this.get("el");e.width=0,e.height=0,e.parentNode.removeChild(e)},t}(em),Iat="0.5.12";const Lat=Object.freeze(Object.defineProperty({__proto__:null,AbstractCanvas:em,AbstractGroup:rm,AbstractShape:im,Base:J0,Canvas:Mat,Event:Gd,Group:XE,PathUtil:kE,Shape:k0,assembleFont:lm,getArcParams:Hg,getBBoxMethod:nm,getOffScreenContext:om,getTextHeight:sm,invert:tm,isAllowCapture:Xf,multiplyVec2:Ao,registerBBox:Kn,registerEasing:aD,version:Iat},Symbol.toStringTag,{value:"Module"}));class jE extends du{constructor(t=[],e={}){super(),this.name=e.name?e.name:Cn("layerGroup"),this.layers=t}addTo(t){this.scene=t;let e=0;const i=this.layers.length;this.layers.forEach(n=>{n.once("inited",a=>{e++,this.emit("inited",a),e===i&&this.emit("inited-all")}),n.addTo(t)})}hasLayer(t){return this.layers.some(e=>e===t)}addLayer(t){this.layers.push(t),this.scene&&(t.once("inited",e=>this.emit("inited",e)),t.addTo(this.scene))}removeLayer(t){const e=this.layers.findIndex(i=>i===t);return e===-1?!1:(this.layers.splice(e,1),this.scene&&t.remove(this.scene),!0)}getLayers(){return this.layers}getInteractionLayers(){return this.layers.filter(({interaction:t})=>t)}getLayer(t){return this.layers.find(({layer:e})=>e.id===t)}getLayerByName(t){return this.layers.find(e=>e.name===t)}removeAllLayer(){this.layers.forEach(t=>{this.scene&&t.remove(this.scene)}),this.layers=[]}isEmpty(){return this.layers.length===0}}function Lu(r,t,e){if(r){if(typeof r.addEventListener=="function")return r.addEventListener(t,e,!1),{remove:function(){r.removeEventListener(t,e,!1)}};if(typeof r.attachEvent=="function")return r.attachEvent("on"+t,e),{remove:function(){r.detachEvent("on"+t,e)}}}}function Ni(r,t,e){var i;try{i=window.getComputedStyle?window.getComputedStyle(r,null)[t]:r.style[t]}catch{}finally{i=i===void 0?e:i}return i}function Oat(r,t){var e=Ni(r,"height",t);return e==="auto"&&(e=r.offsetHeight),parseFloat(e)}function Pat(r,t){var e=Oat(r,t),i=parseFloat(Ni(r,"borderTopWidth"))||0,n=parseFloat(Ni(r,"paddingTop"))||0,a=parseFloat(Ni(r,"paddingBottom"))||0,o=parseFloat(Ni(r,"borderBottomWidth"))||0,s=parseFloat(Ni(r,"marginTop"))||0,l=parseFloat(Ni(r,"marginBottom"))||0;return e+i+o+n+a+s+l}function Fat(r,t){var e=Ni(r,"width",t);return e==="auto"&&(e=r.offsetWidth),parseFloat(e)}function Bat(r,t){var e=Fat(r,t),i=parseFloat(Ni(r,"borderLeftWidth"))||0,n=parseFloat(Ni(r,"paddingLeft"))||0,a=parseFloat(Ni(r,"paddingRight"))||0,o=parseFloat(Ni(r,"borderRightWidth"))||0,s=parseFloat(Ni(r,"marginRight"))||0,l=parseFloat(Ni(r,"marginLeft"))||0;return e+i+o+n+a+l+s}function Te(r,t){if(r)for(var e in t)t.hasOwnProperty(e)&&(r.style[e]=t[e]);return r}const ZE={fontFamily:`
  "-apple-system", BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",
  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
  SimSun, "sans-serif"`},qE="l7plot-tooltip",KE="l7plot-tooltip__title",QE="l7plot-tooltip__list",MD="l7plot-tooltip__list-item",ID="l7plot-tooltip__name",LD="l7plot-tooltip__value",Dat=`<div class="${qE}">
  <div class="${KE}"></div>
  <ul class="${QE}"></ul>
</div>`,rM=`<li class="${MD}" data-index={index}>
  <span class="${ID}">{name}</span>
  <span class="${LD}">{value}</span>
</li>`,Nat={[qE]:{visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:ZE.fontFamily,lineHeight:"20px",padding:"10px 10px 6px 10px"},[KE]:{marginBottom:"4px"},[QE]:{margin:"0px",listStyleType:"none",padding:"0px"},[MD]:{listStyleType:"none",marginBottom:"4px",whiteSpace:"nowrap",display:"flex",justifyContent:"space-between"},[ID]:{},[LD]:{marginLeft:"30px"}};function kat(r,t){return!!r.className.match(new RegExp(`(\\s|^)${t}(\\s|$)`))}function JE(r){const t=r.childNodes,e=t.length;for(let i=e-1;i>=0;i--)r.removeChild(t[i])}let tS=class{constructor(t){this.destroyed=!1,this.options=nt({},this.getDefaultOptions(),t),this.container=this.initContainer(),this.initDom(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible(),this.render()}getDefaultOptions(){return{name:"",containerTpl:"<div></div>",visible:!0,capture:!0,domStyles:{}}}getContainer(){return this.container}getParentContainer(){const t=this.options.parent;let e;if(!t)return e;if(mt(t)){const i=document.getElementById(t);if(i)e=i;else throw new Error(`No parent id ${t}`)}else e=t;return e}initContainer(){const t=this.createDom(this.options.containerTpl),e=this.getParentContainer();return e&&e.appendChild(t),t}initVisible(){this.options.visible?this.show():this.hide()}initCapture(){this.setCapture(this.options.capture)}update(t){this.options=nt({},this.options,t),this.updateInner(t),this.afterUpdate(t)}updateInner(t){t.domStyles&&this.applyStyles()}afterUpdate(t){t.capture&&this.setCapture(t.capture)}setCapture(t){const e=this.container,i=t?"auto":"none";e.style.pointerEvents=i}applyStyles(){const t=this.options.domStyles;if(!t)return;const e=this.container;this.applyChildrenStyles(e,t);const i=this.options.className;if(i&&kat(e,i)){const n=t[i];Te(e,n)}}applyChildrenStyles(t,e){R(e,(i,n)=>{const a=t.getElementsByClassName(n);R(a,o=>{Te(o,i)})})}applyStyle(t,e){const i=this.options.domStyles;i&&Te(e,i[t])}createDom(t="<div></div>"){return Lo(t)}removeDom(){const t=this.container;t&&t.parentNode&&t.parentNode.removeChild(t)}destroy(){this.removeEvent(),this.removeDom(),this.destroyed=!0}},Uat=class extends tS{getDefaultOptions(){return nt({},super.getDefaultOptions(),{id:"l7plot-tooltip",name:"l7plot-tooltip",title:"",showTitle:!0,items:[],containerTpl:Dat,itemTpl:rM,domStyles:Nat,className:qE})}initContainer(){const{customContent:t}=this.options;if(t){const e=this.getHtmlContentNode(t),i=this.getParentContainer();return i&&i.appendChild(e),e}else return super.initContainer()}initDom(){this.cacheDoms()}initEvent(){}removeEvent(){}cacheDoms(){const t=this.container,e=t.getElementsByClassName(KE)[0],i=t.getElementsByClassName(QE)[0];this.titleDom=e,this.listDom=i}render(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())}show(){const t=this.container;!t||this.destroyed||Te(t,{visibility:"visible"})}hide(){const t=this.container;!t||this.destroyed||Te(t,{visibility:"hidden"})}updateInner(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),super.updateInner(t)}renderCustomContent(t){const e=this.container.parentNode,i=this.getHtmlContentNode(t),n=this.container;e&&e.replaceChild(i,n),this.container=i,this.applyStyles()}getHtmlContentNode(t){let e;const i=t(this.options.title||"",this.options.items);return mt(i)?e=this.createDom(i):e=i,e}resetTitle(){const t=this.options.title;this.options.showTitle&&t?(this.showTitle(),this.setTitle(t)):this.hideTitle()}showTitle(){const t=this.titleDom;t&&Te(t,{display:"block"})}hideTitle(){const t=this.titleDom;t&&Te(t,{display:"none"})}setTitle(t){const e=this.titleDom;e&&(e.innerHTML=t)}renderItems(){this.clearItemDoms();const t=this.options.items,e=this.options.itemTpl||rM,i=this.listDom;i&&(t.forEach(n=>{const a=Object.assign({},n),o=Nd(e,a),s=this.createDom(o);i.appendChild(s)}),this.applyChildrenStyles(i,this.options.domStyles))}clearItemDoms(){this.listDom&&JE(this.listDom)}clear(){this.setTitle(""),this.clearItemDoms()}};const zat={[qC]:{visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:ZE.fontFamily,padding:"10px 10px 6px 10px",lineHeight:1,fontSize:"12px"},[KC]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[QC]:{margin:"0px",listStyleType:"none",padding:"0px"},[PP]:{listStyleType:"none",display:"flex",alignItems:"center",marginBottom:"2px"},[FP]:{width:"10px",height:"10px"},[BP]:{paddingLeft:"8px"}};let Hat=class extends tS{getDefaultOptions(){return nt({},super.getDefaultOptions(),{id:"l7plot-category-legend",name:"l7plot-category-legend",title:"",items:[],containerTpl:e$,itemTpl:Tb,domStyles:zat,className:qC})}initContainer(){const{customContent:t}=this.options;if(t){const e=this.getHtmlContentNode(t),i=this.getParentContainer();return i&&i.appendChild(e),e}else return super.initContainer()}initDom(){this.cacheDoms()}initEvent(){}removeEvent(){}cacheDoms(){const t=this.container,e=t.getElementsByClassName(KC)[0],i=t.getElementsByClassName(QC)[0];this.titleDom=e,this.listDom=i}render(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())}show(){const t=this.container;!t||this.destroyed||Te(t,{visibility:"visible"})}hide(){const t=this.container;!t||this.destroyed||Te(t,{visibility:"hidden"})}updateInner(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),super.updateInner(t)}renderCustomContent(t){const e=this.container.parentNode,i=this.getHtmlContentNode(t),n=this.container;e&&e.replaceChild(i,n),this.container=i,this.applyStyles()}getHtmlContentNode(t){let e;const i=t(this.options.title||"",this.options.items);return mt(i)?e=this.createDom(i):e=i,e}resetTitle(){const t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()}showTitle(){const t=this.titleDom;t&&Te(t,{display:"block"})}hideTitle(){const t=this.titleDom;t&&Te(t,{display:"none"})}setTitle(t){const e=this.titleDom;e&&(e.innerHTML=t)}renderItems(){this.clearItemDoms();const t=this.options.items.length>30?this.options.items.slice(0,30):this.options.items,e=this.options.itemTpl||Tb,i=this.listDom;i&&(t.forEach(n=>{const o=n.value===""?"—":Array.isArray(n.value)?n.value.join(" - "):n.value,s=Object.assign(Object.assign({},n),{value:o}),l=Nd(e,s),u=this.createDom(l);i.appendChild(u)}),this.applyChildrenStyles(i,this.options.domStyles))}clearItemDoms(){this.listDom&&JE(this.listDom)}clear(){this.setTitle(""),this.clearItemDoms()}};const eS="l7plot-legend l7plot-legend__continue",rS="l7plot-legend__title",OD="l7plot-legend__ribbon-container",PD="l7plot-legend__ribbon",FD="l7plot-legend__gradient-bar",ex="l7plot-legend__value-range",$at=`<div class="${eS}">
  <div class="${rS}"></div>
  <div class="${OD}"></div>
</div>`,iM=`<div class="${PD}">
  <span class="${ex}">{min}</span>
  <div class="${FD}" style="background-image: {backgroundImage}"></div>
  <span class="${ex}">{max}</span>
</div>`,Wat={[eS]:{visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:ZE.fontFamily,padding:"10px",lineHeight:1,fontSize:"12px"},[rS]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[PD]:{display:"flex",alignItems:"center"},[FD]:{width:"140px",height:"14px",margin:"0px 5px"},[ex]:{padding:"0px"}};let Vat=class extends tS{getDefaultOptions(){return nt({},super.getDefaultOptions(),{id:"l7plot-continue-legend",name:"l7plot-continue-legend",title:"",containerTpl:$at,ribbonTpl:iM,domStyles:Wat,className:eS})}initContainer(){const{customContent:t}=this.options;if(t){const e=this.getHtmlContentNode(t),i=this.getParentContainer();return i&&i.appendChild(e),e}else return super.initContainer()}initDom(){this.cacheDoms()}initEvent(){}removeEvent(){}cacheDoms(){const t=this.container,e=t.getElementsByClassName(rS)[0],i=t.getElementsByClassName(OD)[0];this.titleDom=e,this.ribbonContainerDom=i}render(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderRibbon())}show(){const t=this.container;!t||this.destroyed||Te(t,{visibility:"visible"})}hide(){const t=this.container;!t||this.destroyed||Te(t,{visibility:"hidden"})}updateInner(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.colors&&this.renderRibbon()),super.updateInner(t)}renderCustomContent(t){const e=this.container.parentNode,i=this.getHtmlContentNode(t),n=this.container;e&&e.replaceChild(i,n),this.container=i,this.applyStyles()}getHtmlContentNode(t){let e;const i=t(this.options.title||"",this.options.min,this.options.max,this.options.colors);return mt(i)?e=this.createDom(i):e=i,e}resetTitle(){const t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()}showTitle(){const t=this.titleDom;t&&Te(t,{display:"block"})}hideTitle(){const t=this.titleDom;t&&Te(t,{display:"none"})}setTitle(t){const e=this.titleDom;e&&(e.innerHTML=t)}renderRibbon(){this.clearRibbonContainerDoms();const{min:t,max:e,colors:i,ribbonTpl:n=iM}=this.options,a=this.ribbonContainerDom;if(a){const o=`linear-gradient(to right, ${i.join(", ")})`,l=Nd(n,{min:t,max:e,backgroundImage:o}),u=this.createDom(l);a.appendChild(u),this.applyChildrenStyles(a,this.options.domStyles)}}clearRibbonContainerDoms(){this.ribbonContainerDom&&JE(this.ribbonContainerDom)}clear(){this.setTitle(""),this.clearRibbonContainerDoms()}},Gat=class extends ko{constructor(t){super(t),this.legendComponents=[],this.options=t,this.legendComponents=this.initLegendComponents(t.items)}initLegendComponents(t){const e=[];for(let i=0;i<t.length;i++){const n=t[i];if(n.type==="category"){const a=new Hat({title:n.options.title,items:n.options.items,className:n.options.className,customContent:n.options.customContent,domStyles:n.options.domStyles});e.push(a)}else if(n.type==="continue"){const a=new Vat({title:n.options.title,min:n.options.min,max:n.options.max,colors:n.options.colors,className:n.options.className,customContent:n.options.customContent,domStyles:n.options.domStyles});e.push(a)}}return e}getDefaultOptions(){return{position:"bottomleft"}}onAdd(){const t=window.document.createElement("div");return t.className="l7plot-legend-container",this.legendComponents.forEach(e=>{const i=e.getContainer();t.appendChild(i)}),t}onRemove(){this.legendComponents.forEach(t=>{t.destroy()})}};var nM;(function(r){r[r.solid=0]="solid",r[r.dash=1]="dash"})(nM||(nM={}));var rx;(function(r){r.TextLayer="textLayer",r.DotLayer="dotLayer",r.IconLayer="iconLayer",r.DotDensity="dotDensityLayer",r.ColumnLayer="columnLayer",r.HeatmapLayer="heatmapLayer",r.GridLayer="gridLayer",r.HexbinLayer="hexbinLayer",r.LinesLayer="linesLayer",r.PathLayer="pathLayer",r.ArcLayer="arcLayer",r.AreaLayer="areaLayer",r.PrismLayer="prismLayer"})(rx||(rx={}));var aa;(function(r){r.Map="map",r.Amap="amap",r.AmapV1="amapv1",r.AmapV2="amapv2",r.Mapbox="mapbox"})(aa||(aa={}));var ix;(function(r){r.Dot="dot",r.DotDensity="dotDensity",r.Heatmap="heatmap",r.Grid="grid",r.Hexbin="hexbin",r.Path="path",r.Flow="flow",r.Area="area",r.Choropleth="choropleth"})(ix||(ix={}));const Xat=5,Yat=new Object().toString,BD=(r,t)=>Yat.call(r)==="[object "+t+"]",jat=r=>BD(r,"Array"),Zat=r=>typeof r=="object"&&r!==null,aM=r=>{if(!Zat(r)||!BD(r,"Object"))return!1;let t=r;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(r)===t},DD=(r,t,e,i)=>{e=e||0,i=i||Xat;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const a=t[n];a?aM(a)?(aM(r[n])||(r[n]={}),e<i?DD(r[n],a,e+1,i):r[n]=t[n]):jat(a)?(r[n]=[],r[n]=r[n].concat(a)):r[n]=a:r[n]=a}},or=(r,...t)=>{for(let e=0;e<t.length;e+=1)DD(r,t[e]);return r},qat=["mousemove","click"];let Kat=class extends du{constructor(t,e,i){super(),this.currentVisible=!1,this.interactionTriggerHander=h=>{const{feature:f,featureId:d}=h,{title:v,customTitle:p,items:g,customItems:m}=this.options,_=f.type==="Feature"&&f.geometry&&f.properties?f.properties:f;let x=[];if(m){const A=m(f);if(Array.isArray(A))x=A;else throw new Error("customItems return array")}else g&&g.forEach(A=>{if(mt(A)){const T=A.split(".").pop()||A,w=_b(_,A);w!==void 0&&x.push({name:T,value:w})}else{const{field:T,alias:w,customValue:M}=A,O=w||T.split(".").pop()||T,P=_b(_,T);P!==void 0&&x.push({name:O,value:M?M(P,_,d):P})}});const C={title:p?p(_):v,items:x};this.updateTooltip(h,C)},this.interactionUntriggerHander=()=>{this.hideTooltip()},this.scene=t,this.interactionLayers=e,this.options=or({},this.getDefaultOptions(),i);const{offsets:n,title:a,showTitle:o,customContent:s,domStyles:l,anchor:u,className:c}=this.options;this.marker=new K2({offsets:n,anchor:u,draggable:!1}),this.tooltipComponent=new Uat({title:a,showTitle:o,items:[],customContent:s,domStyles:l,className:c}),this.setComponent(),this.initInteractionEvent()}getDefaultOptions(){return{showTitle:!0,showComponent:!0,items:[],offsets:[15,0],trigger:"mousemove",anchor:z0["TOP-LEFT"]}}update(t){this.marker.remove(),this.currentVisible=!1,this.options=or({},this.options,t);const{offsets:e,showTitle:i,customContent:n,domStyles:a,anchor:o,className:s}=this.options;this.marker=new K2({offsets:e,anchor:o,draggable:!1}),this.tooltipComponent.update({showTitle:i,customContent:n,domStyles:a,className:s}),this.setComponent()}initInteractionEvent(){const t=this.options.trigger||"mousemove";if(!qat.includes(t))throw new Error("trigger is mousemove or click");this.interactionLayers.forEach(({layer:e})=>{e.on(t,this.interactionTriggerHander),e.on(`un${t}`,this.interactionUntriggerHander)})}unBindInteractionEvent(){const t=this.options.trigger||"mousemove";this.interactionLayers.forEach(({layer:e})=>{e.off(t,this.interactionTriggerHander),e.off(`un${t}`,this.interactionUntriggerHander)})}updateTooltip(t,e){const{lngLat:i,x:n,y:a}=t;if(this.options.showComponent&&(this.updateComponent(e),this.setPostion(i)),this.currentVisible){const o={type:"tooltip:change",data:e,lngLat:i,x:n,y:a};this.emit("tooltip:change",o)}else{this.showTooltip();const o={type:"tooltip:show",data:e,lngLat:i,x:n,y:a};this.emit("tooltip:show",o)}}showTooltip(){this.currentVisible||(this.options.showComponent&&this.scene.addMarker(this.marker),this.currentVisible=!0)}hideTooltip(){if(!this.currentVisible)return;this.options.showComponent&&this.marker.remove(),this.currentVisible=!1;const t={type:"tooltip:hide"};this.emit("tooltip:hide",t)}updateComponent(t){Jt(this.lastComponentOptions,t)||(this.tooltipComponent.update(t),this.lastComponentOptions=t)}setComponent(){const t=this.tooltipComponent.getContainer(),e=window.document.createElement("div");e.style.cursor="auto",e.style.userSelect="text",e.className="l7plot-tooltip-container",["mousemove","mousedown","mouseup","click","dblclick"].forEach(i=>{e.addEventListener(i,n=>n.stopPropagation())}),e.appendChild(t),this.marker.setElement(e)}setPostion(t){this.marker.setLnglat(t)}destroy(){this.unBindInteractionEvent(),this.off(),this.marker.remove(),this.tooltipComponent.destroy()}};var ul={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ITEM_TPL=r.CONTAINER_TPL=r.VALUE_CLASS=r.NAME_CLASS=r.LIST_ITEM_CLASS=r.LIST_CLASS=r.TITLE_CLASS=r.CONTAINER_CLASS=void 0,r.CONTAINER_CLASS="l7plot-tooltip",r.TITLE_CLASS="l7plot-tooltip__title",r.LIST_CLASS="l7plot-tooltip__list",r.LIST_ITEM_CLASS="l7plot-tooltip__list-item",r.NAME_CLASS="l7plot-tooltip__name",r.VALUE_CLASS="l7plot-tooltip__value",r.CONTAINER_TPL=`<div class="${r.CONTAINER_CLASS}">
  <div class="${r.TITLE_CLASS}"></div>
  <ul class="${r.LIST_CLASS}"></ul>
</div>`,r.ITEM_TPL=`<li class="${r.LIST_ITEM_CLASS}" data-index={index}>
  <span class="${r.NAME_CLASS}">{name}</span>
  <span class="${r.VALUE_CLASS}">{value}</span>
</li>`})(ul);var cl={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ITEM_TPL=r.CONTAINER_TPL=r.VALUE_CLASS=r.MARKER_CLASS=r.LIST_ITEM_CLASS=r.LIST_CLASS=r.TITLE_CLASS=r.CONTAINER_CLASS=void 0,r.CONTAINER_CLASS="l7plot-legend l7plot-legend__category",r.TITLE_CLASS="l7plot-legend__title",r.LIST_CLASS="l7plot-legend__category-list",r.LIST_ITEM_CLASS="l7plot-legend__list-item",r.MARKER_CLASS="l7plot-legend__category-marker",r.VALUE_CLASS="l7plot-legend__category-value",r.CONTAINER_TPL=`<div class="${r.CONTAINER_CLASS}">
  <div class="${r.TITLE_CLASS}"></div>
  <ul class="${r.LIST_CLASS}"></ul>
</div>`,r.ITEM_TPL=`<li class="${r.LIST_ITEM_CLASS}" data-index={index}>
  <span class="${r.MARKER_CLASS}" style="background:{color}"></span>
  <span class="${r.VALUE_CLASS}">{value}</span>
</li>`})(cl);var Uu={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.RIBBON_TPL=r.CONTAINER_TPL=r.VALUE_RANGE_CLASS=r.GRADIENT_BAR_CLASS=r.RIBBON_CLASS=r.RIBBON_CONTAINER_CLASS=r.TITLE_CLASS=r.CONTAINER_CLASS=void 0,r.CONTAINER_CLASS="l7plot-legend l7plot-legend__continue",r.TITLE_CLASS="l7plot-legend__title",r.RIBBON_CONTAINER_CLASS="l7plot-legend__ribbon-container",r.RIBBON_CLASS="l7plot-legend__ribbon",r.GRADIENT_BAR_CLASS="l7plot-legend__gradient-bar",r.VALUE_RANGE_CLASS="l7plot-legend__value-range",r.CONTAINER_TPL=`<div class="${r.CONTAINER_CLASS}">
  <div class="${r.TITLE_CLASS}"></div>
  <div class="${r.RIBBON_CONTAINER_CLASS}"></div>
</div>`,r.RIBBON_TPL=`<div class="${r.RIBBON_CLASS}">
  <span class="${r.VALUE_RANGE_CLASS}">{min}</span>
  <div class="${r.GRADIENT_BAR_CLASS}" style="background-image: {backgroundImage}"></div>
  <span class="${r.VALUE_RANGE_CLASS}">{max}</span>
</div>`})(Uu);function ND(r){const t={point:{default:{fill:r.pointFillColor,size:r.pointSize,stroke:r.pointBorderColor,lineWidth:r.pointBorder,fillOpacity:r.pointFillOpacity},active:{fill:r.pointActiveFillColor},selected:{fill:r.pointSelectedFillColor}}};return{mapStyle:r.mapStyle,defaultColor:r.brandColor,subColor:r.subColor,semanticRed:r.paletteSemanticRed,semanticGreen:r.paletteSemanticGreen,fontFamily:r.fontFamily,colors10:r.paletteQualitative10,colors20:r.paletteQualitative20,sequenceColors:r.paletteSequence,shapes:{point:["circle","square"],line:["line"]},sizes:[1,10],geometries:{point:{circle:{default:{style:t.point.default},active:{style:t.point.active},selected:{style:t.point.selected}}},line:{},polygon:{}},components:{legend:{category:{domStyles:{[cl.CONTAINER_CLASS]:{visibility:"visible",zIndex:1,backgroundColor:r.legendContainerFillColor,boxShadow:r.legendContainerShadow,borderRadius:`${r.legendContainerBorderRadius}px`,color:r.legendTextFillColor,fontFamily:r.fontFamily,padding:"10px",lineHeight:"1",fontSize:`${r.legendTextFontSize}px`},[cl.TITLE_CLASS]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[cl.LIST_CLASS]:{margin:"0px",padding:"0px"},[cl.LIST_ITEM_CLASS]:{marginBottom:"2px"},[cl.MARKER_CLASS]:{width:"10px",height:"10px"},[cl.VALUE_CLASS]:{paddingLeft:"8px"}}},continue:{domStyles:{[Uu.CONTAINER_CLASS]:{visibility:"visible",zIndex:1,backgroundColor:r.legendContainerFillColor,boxShadow:r.legendContainerShadow,borderRadius:`${r.legendContainerBorderRadius}px`,color:r.legendTextFillColor,fontFamily:r.fontFamily,padding:"10px",lineHeight:1,fontSize:`${r.legendTextFontSize}px`},[Uu.TITLE_CLASS]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[Uu.RIBBON_CLASS]:{display:"flex",alignItems:"center"},[Uu.GRADIENT_BAR_CLASS]:{width:"140px",height:"14px",margin:"0px 5px"},[Uu.VALUE_RANGE_CLASS]:{padding:"0px"}}}},tooltip:{domStyles:{[ul.CONTAINER_CLASS]:{visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:r.tooltipContainerFillColor,boxShadow:r.tooltipContainerShadow,borderRadius:`${r.tooltipContainerBorderRadius}px`,color:r.tooltipTextFillColor,fontSize:`${r.tooltipTextFontSize}px`,fontFamily:r.fontFamily,lineHeight:r.tooltipTextLineHeight},[ul.TITLE_CLASS]:{marginBottom:"4px"},[ul.LIST_CLASS]:{margin:"0px",padding:"0px"},[ul.LIST_ITEM_CLASS]:{marginBottom:"4px"},[ul.NAME_CLASS]:{color:r.tooltipItemNameFillColor},[ul.VALUE_CLASS]:{color:r.tooltipItemValueFillColor,marginLeft:"30px"}}},label:{style:{textAnchor:"center",textOffset:[0,0],fill:r.labelFillColor,fontSize:r.labelFontSize,fontFamily:r.fontFamily,fillColorDark:r.labelFillColorDark,fillColorLight:r.labelFillColorLight}}}}}const nl={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},Qat={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},Jat=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],tot=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],eot=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],kD=(r={})=>{const{mapStyle:t="light",subColor:e="rgba(0,0,0,0.05)",paletteQualitative10:i=Jat,paletteQualitative20:n=tot,paletteSemanticRed:a="#F4664A",paletteSemanticGreen:o="#30BF78",paletteSemanticYellow:s="#FAAD14",paletteSequence:l=eot,fontFamily:u=`"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`}=r,{brandColor:c=i[0]}=r;return{mapStyle:t,brandColor:c,subColor:e,paletteQualitative10:i,paletteQualitative20:n,paletteSemanticRed:a,paletteSemanticGreen:o,paletteSemanticYellow:s,paletteSequence:l,fontFamily:u,legendContainerFillColor:"rgba(255, 255, 255, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:nl[65],legendTextFontSize:12,tooltipContainerFillColor:"rgba(255, 255, 255, 0.9)",tooltipContainerShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",tooltipContainerBorderRadius:2,tooltipTextFillColor:nl[65],tooltipItemNameFillColor:nl[65],tooltipItemValueFillColor:nl[65],tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:nl[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:c,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:Qat[100],pointActiveBorderColor:nl[100],pointSelectedBorderColor:nl[100]}};kD();const rot={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},al={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},oM=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],iot=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],not=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],UD=(r={})=>{const{mapStyle:t="dark",subColor:e="rgba(255,255,255,0.05)",paletteQualitative10:i=oM,paletteQualitative20:n=iot,paletteSemanticRed:a="#F4664A",paletteSemanticGreen:o="#30BF78",paletteSemanticYellow:s="#FAAD14",paletteSequence:l=not,fontFamily:u=`"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`}=r,{brandColor:c=i[0]}=r;return{mapStyle:t,brandColor:c,subColor:e,paletteQualitative10:i,paletteQualitative20:n,paletteSemanticRed:a,paletteSemanticGreen:o,paletteSemanticYellow:s,paletteSequence:l,fontFamily:u,legendContainerFillColor:"rgba(31, 31, 31, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:al[65],legendTextFontSize:12,tooltipContainerFillColor:"rgba(31, 31, 31, 0.9)",tooltipContainerShadow:"0px 2px 4px rgba(0, 0, 0, 0.5)",tooltipContainerBorderRadius:2,tooltipTextFillColor:al[65],tooltipItemNameFillColor:al[65],tooltipItemValueFillColor:al[65],tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:al[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:oM[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:rot[100],pointActiveBorderColor:al[100],pointSelectedBorderColor:al[100]}};UD();function zD(r){const{styleSheet:t={}}=r,e=Ut(r,["styleSheet"]),i=kD(t);return nt({},ND(i),e)}function aot(r){const{styleSheet:t={}}=r,e=Ut(r,["styleSheet"]),i=UD(t);return nt({},ND(i),e)}const sM=zD({}),oot=aot({}),lM={default:sM,light:sM,dark:oot};function nx(r="default"){return L(lM,hu(r),lM.default)}const sot=[{original:"loaded",adaptation:"scene-loaded"},{original:"resize",adaptation:"resize"},{original:"destroy",adaptation:"destroy"},{original:"resize",adaptation:"resize"}],lot=["mapmove","movestart","moveend","zoomchange","zoomstart","zoomend","click","dblclick","contextmenu","mousemove","mousewheel","mouseover","mouseout","mouseup","mousedown","dragstart","dragging","dragend"],Qp=["inited","add","remove","dataUpdate","click","unclick","dblclick","undblclick","contextmenu","uncontextmenu","mouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","uncontextmenu","unpick","legend","legend:color","legend:size"],uM=new Map,cM=new Map,hM=new Map,HD={map:{type:aa.Amap},logo:!0};let $D=class WD extends du{constructor(t){super(),this.inited=!1,this.sceneLoaded=!1,this.layersLoaded=!1,this.loaded=!1,this.layerGroup=new jE,this.options=or({},this.getDefaultOptions(),t),this.lastOptions=this.options}getDefaultOptions(){return WD.DefaultOptions}createContainer(t){const{width:e,height:i}=this.options,n=typeof t=="string"?document.getElementById(t):t;return n.style.position||(n.style.position="relative"),e&&(n.style.width||(n.style.width=`${e}px`)),i&&(n.style.height||(n.style.height=`${i}px`)),n}createTheme(){return re(this.options.theme)?or({},nx("default"),zD(this.options.theme)):nx(this.options.theme)}createMap(){const t=this.options.map?this.options.map:HD.map,{type:e}=t,i=Ut(t,["type"]),n=Object.assign({style:this.theme.mapStyle},i);return e===aa.Amap?new XJ(n):e===aa.AmapV1?new YJ(n):e===aa.AmapV2?new jJ(n):e===aa.Mapbox?new GJ(n):new UJ(n)}createScene(){const{logo:t,antialias:e,preserveDrawingBuffer:i}=this.options,n=Rs(t)?{logoVisible:t}:{logoVisible:t==null?void 0:t.visible,logoPosition:t==null?void 0:t.position},a=Object.assign({antialias:e,preserveDrawingBuffer:i},n),o=this.createMap();return new tit(Object.assign({id:this.container,map:o},a))}registerResources(){uM.size&&uM.forEach((t,e)=>{!this.scene.hasImage(e)&&this.scene.addImage(e,t)}),cM.size&&cM.forEach((t,e)=>{this.scene.addFontFace(e,t)}),hM.size&&hM.forEach((t,e)=>{this.scene.addIconFont(e,t)})}update(t){this.updateOption(t),t.map&&!Jt(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.render(),this.emit("update")}updateOption(t){this.lastOptions=this.options,this.options=or({},this.options,t)}updateMap(t){var e;if(!this.scene)return;const{style:i,center:n,zoom:a,rotation:o,pitch:s}=t;Wr(s)||this.scene.setPitch(s),Wr(o)||this.scene.setRotation(o),i&&i!==((e=this.lastOptions.map)===null||e===void 0?void 0:e.style)&&this.scene.setMapStyle(i),a&&n&&this.scene.setZoomAndCenter(a,n)}changeSize(t,e){this.options.width===t&&this.options.height===e||(this.container.style.width=`${t}px`,this.container.style.height=`${e}px`,this.options=Object.assign(this.options,{width:t,height:e}))}on(t,e,i){return this.proxyEventHander("on",t,e,i),this}once(t,e){return this.proxyEventHander("once",t,e),this}off(t,e){return this.proxyEventHander("off",t,e),this}proxyEventHander(t,e,i,n){const a=sot.find(o=>o.adaptation===e);if(a)this.scene[t](a.original,i);else if(lot.indexOf(e)!==-1)this.scene[t](e,i);else if(e.includes("Layer:")){const[o,s]=e.split(":");if(this[o]&&this[o][t]&&Qp.indexOf(s)!==-1)this[o][t](s,i);else throw new Error(`No event name "${e}"`)}else super[t](e,i,n)}getScene(){return this.scene}getMap(){var t,e,i,n;return((t=this.options.map)===null||t===void 0?void 0:t.type)===aa.Amap?this.scene.map:((e=this.options.map)===null||e===void 0?void 0:e.type)===aa.AmapV2?this.scene.map:((i=this.options.map)===null||i===void 0?void 0:i.type)===aa.Mapbox?this.scene.map:((n=this.options.map)===null||n===void 0?void 0:n.type)===aa.Map?this.scene.map:this.scene.map}addLayer(t){this.layerGroup.addLayer(t)}getLayes(){return console.warn("Replace to use getLayers()"),this.getLayers()}getLayers(){return this.layerGroup.getLayers()}getLayerByName(t){return this.layerGroup.getLayerByName(t)}removeLayer(t){return this.layerGroup.removeLayer(t)}removeAllLayer(){this.layerGroup.removeAllLayer()}zoomIn(){this.scene.zoomIn()}zoomOut(){this.scene.zoomOut()}setPitch(t){this.scene.setPitch(t)}fitBounds(t){this.scene.fitBounds(t)}setMapStatus(t){this.scene.setMapStatus(t)}setBgColor(t){this.scene.setBgColor(t)}initComponents(){this.initControls(),this.initTooltip()}updateComponents(){this.updateControls(),this.initTooltip()}initControls(){const{zoom:t,scale:e,layerMenu:i,legend:n}=this.options;e&&this.addScaleControl(e),t&&this.addZoomControl(t),i&&this.addLayerMenuControl(i),n&&(this.addLegendControl(n),this.emit("add-legend"))}updateControls(){const{zoom:t,scale:e,layerMenu:i,legend:n}=this.options;Jt(this.lastOptions.zoom,t)||(t?this.updateZoomControl(t):this.removeZoomControl()),Jt(this.lastOptions.scale,e)||(e?this.updateScaleControl(e):this.removeScaleControl()),Jt(this.lastOptions.layerMenu,i)||(i?this.updateLayerMenuControl(i):this.removeLayerMenuControl()),Jt(this.lastOptions.legend,n)||(n?this.updateLegendControl(n):this.removeLegendControl())}addZoomControl(t){this.zoomControl||(this.zoomControl=new mQ(t),this.scene.addControl(this.zoomControl))}updateZoomControl(t){if(!this.zoomControl){this.addZoomControl(t);return}this.removeZoomControl(),this.addZoomControl(t)}removeZoomControl(){this.zoomControl&&(this.zoomControl.remove(),this.zoomControl=void 0)}addScaleControl(t){this.scaleControl||(this.scaleControl=new Tj(t),this.scene.addControl(this.scaleControl))}updateScaleControl(t){if(!this.scaleControl){this.addScaleControl(t);return}this.removeScaleControl(),this.addScaleControl(t)}removeScaleControl(){this.scaleControl&&(this.scaleControl.remove(),this.scaleControl=void 0)}addLayerMenuControl(t){this.layerGroup.getLayers().forEach(({name:e,layer:i})=>{})}updateLayerMenuControl(t){this.removeLayerMenuControl(),this.addLayerMenuControl(t)}removeLayerMenuControl(){}getLegendOptions(){return{}}addLegendControl(t){if(this.legendControl)return;const e=this.theme.components.legend,i=or({},this.getLegendOptions(),t),{type:n,position:a}=i,o=Ut(i,["type","position"]),s=[];if(n==="category"){const l=or({},{domStyles:e.category.domStyles},o);s.push({type:n,options:l})}else if(n==="continue"){const l=or({},{domStyles:e.continue.domStyles},o);s.push({type:n,options:l})}s.length&&(this.legendControl=new Gat({position:a,items:s}),this.scene.addControl(this.legendControl))}updateLegendControl(t){if(!this.legendControl){this.addLegendControl(t);return}this.removeLegendControl(),this.addLegendControl(t)}removeLegendControl(){this.legendControl&&(this.legendControl.remove(),this.legendControl=void 0)}initTooltip(){this.tooltip&&this.tooltip.destroy();const{tooltip:t}=this.options;if(t){const e=or({},{domStyles:this.theme.components.tooltip.domStyles},t),i=this.layerGroup.getInteractionLayers();this.tooltip=new Kat(this.scene,i,e),this.tooltip.on("*",n=>this.emit(n.type,n))}}exportPng(t){return this.scene.exportPng(t)}destroy(){var t;super.off("*"),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),(t=this.tooltip)===null||t===void 0||t.destroy(),this.scene.destroy()}};$D.DefaultOptions=HD;class ax{static aggregation(t,e){const{type:i="grid",radius:n,method:a,field:o}=e,s={type:i,size:n,method:a,field:o};t.transforms?(t.transforms=t.transforms.filter(l=>l.type!==s.type),t.transforms.push(s)):t.transforms=[s]}}const VD=["name","zIndex","visible","minZoom","maxZoom","pickingBuffer","autoFit","blend"];class Xi extends du{constructor(t){super(),this.options=or({},this.getDefaultOptions(),t),this.lastOptions=this.options}getDefaultOptions(){return{}}pickLayerConfig(t){return Ga(t,VD)}addTo(t){t.addLayer(this.layer)}remove(t){t.removeLayer(this.layer)}update(t){this.updateOption(t),this.updateConfig(t)}updateOption(t){this.lastOptions=this.options,this.options=or({},this.options,t)}updateConfig(t){!Wr(t.zIndex)&&!Jt(this.lastOptions.zIndex,this.options.zIndex)&&this.setIndex(t.zIndex),!Wr(t.blend)&&!Jt(this.lastOptions.blend,this.options.blend)&&this.setBlend(t.blend),!Wr(t.minZoom)&&!Jt(this.lastOptions.minZoom,this.options.minZoom)&&this.setMinZoom(t.minZoom),!Wr(t.maxZoom)&&!Jt(this.lastOptions.maxZoom,this.options.maxZoom)&&this.setMinZoom(t.maxZoom),!Wr(t.visible)&&!Jt(this.lastOptions.visible,this.options.visible)&&(t.visible?this.show():this.hide())}render(){this.layer.renderLayers()}setSource(t){if(t instanceof V0)this.layer.setSource(t);else{const{data:e,aggregation:i}=t,n=Ut(t,["data","aggregation"]);i&&ax.aggregation(n,i),this.layer.getSource()?this.layer.setData(e,n):this.layer.source(e,n)}}changeData(t){this.setSource(t)}setIndex(t){this.layer.setIndex(t)}setBlend(t){this.layer.setBlend(t)}setMinZoom(t){this.layer.setMinZoom(t)}setMaxZoom(t){this.layer.setMaxZoom(t)}show(){this.layer.inited&&this.layer.show()}hide(){this.layer.inited&&this.layer.hide()}toggleVisible(){this.isVisible()?this.hide():this.show()}isVisible(){return this.layer.inited?this.layer.isVisible():this.options.visible}fitBounds(t){this.layer.fitBounds(t)}on(t,e){return Qp.indexOf(t)!==-1?this.layer.on(t,e):super.on(t,e),this}once(t,e){return Qp.indexOf(t)!==-1?this.layer.once(t,e):super.once(t,e),this}off(t,e){return Qp.indexOf(t)!==-1?this.layer.off(t,e):super.off(t,e),this}}Xi.LayerType=rx;Xi.LayerConfigkeys=VD;function ol(r,t){return(...e)=>{const i={};return r.forEach((n,a)=>{i[n]=e[a]}),delete i.undefined,t(i)}}class Qt{static shape(t,e){if(mt(e))t.shape(e);else if(ut(e)){const i=[];t.shape(i.join("*"),ol(i,e))}else if(re(e)){const i=e.field?e.field:"";if(ut(e.value)){const n=Z(i)?i:i.split("*");t.shape(i,ol(n,e.value))}else t.shape(i,e.value);mt(i)&&e.scale&&Qt.scale(t,i,e.scale)}}static size(t,e){if(Mt(e))t.size(e);else if(Z(e))t.size(e);else if(ut(e)){const i=[];t.size(i.join("*"),ol(i,e))}else if(re(e)){const i=e.field?e.field:"";if(ut(e.value)){const n=Z(i)?i:i.split("*");t.size(i,ol(n,e.value))}else t.size(i,e.value);mt(i)&&e.scale&&Qt.scale(t,i,e.scale)}}static color(t,e){if(mt(e))t.color(e);else if(ut(e)){const i=[];t.color(i.join("*"),ol(i,e))}else if(re(e)){const i=e.field?e.field:"";if(ut(e.value)){const n=Z(i)?i:i.split("*");t.color(i,ol(n,e.value))}else t.color(i,e.value);mt(i)&&e.scale&&Qt.scale(t,i,e.scale)}}static style(t,e){e&&t.style(e)}static state(t,e){const{active:i,select:n}=e;i&&t.active(i),n&&t.select(n)}static rotate(t,e){mt(e)||ut(e)}static texture(t,e){mt(e)&&t.texture(e)}static animate(t,e){(Rs(e)||re(e))&&t.animate(e)}static scale(t,e,i){t.scale(e,i)}static filter(t,e){const i=e.field?e.field:"",n=Z(i)?i:i.split("*");t.filter(n.join("*"),ol(n,e.value))}}function uot(r,t){const{field:e,content:i,style:n={},state:a}=t,{fontSize:o,fill:s}=n,u={field:e||i||"",value:"text"};Qt.shape(r,u),o&&Qt.size(r,o),s&&Qt.color(r,s),n&&Qt.style(r,n),a&&Qt.state(r,a)}const GD={style:{fontSize:12}},cot=[];class um extends Xi{constructor(t){super(t),this.type=Xi.LayerType.TextLayer,this.interaction=!1;const{name:e,source:i}=this.options,n=this.pickLayerConfig(this.options);this.name=e||Cn(this.type),this.layer=new Wf(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(i)}getDefaultOptions(){return GD}mappingLayer(t,e){uot(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}}um.DefaultOptions=GD;um.LayerOptionsKeys=Xi.LayerConfigkeys.concat(cot);const hot={autoFit:!1};let Ms=class XD extends $D{constructor(t,e){if(typeof t=="string"||t instanceof Element){if(e===void 0)throw new Error("options is undefined");super(e),this.container=this.createContainer(t),this.theme=this.createTheme(),this.scene=this.createScene(),this.registerResources(),this.initSource()}else super(t)}initSource(){this.source=this.createSource(),this.render(),this.inited=!0}initLayersEvent(){}getDefaultOptions(){return XD.DefaultOptions}createSource(){const t=this.options.source,{data:e,aggregation:i}=t,n=Ut(t,["data","aggregation"]);return i&&ax.aggregation(n,i),new V0(e,n)}createLabelLayer(t,e,i){const{visible:n,minZoom:a,maxZoom:o,zIndex:s=0}=i||{};return new um(Object.assign({name:"labelLayer",visible:n,minZoom:a,maxZoom:o,zIndex:s+.1,source:t},e))}updateLabelLayer(t,e,i,n){e?n?n.update(Object.assign({},e)):(n=this.createLabelLayer(t,e,i),this.layerGroup.addLayer(n)):e===!1&&n&&this.layerGroup.removeLayer(n)}render(){const t=this.createLayers(this.source);this.inited?(this.layerGroup.removeAllLayer(),t.addTo(this.scene),this.layerGroup=t):(this.layerGroup=t,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",()=>{this.onSceneLoaded()})),this.initLayersEvent()}onSceneLoaded(){this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",()=>{this.onLayersLoaded()}),this.layerGroup.addTo(this.scene)}onLayersLoaded(){this.layersLoaded=!0,this.initComponents(),this.loaded=!0,this.emit("loaded")}attachToScene(t,e){this.scene=t,this.theme=e||nx("default"),this.registerResources(),this.initSource()}unattachFromScene(){var t;this.removeAllLayer(),(t=this.tooltip)===null||t===void 0||t.destroy()}addToScene(t){this.attachToScene(t)}removeFromScene(){var t;this.removeAllLayer(),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),(t=this.tooltip)===null||t===void 0||t.destroy()}update(t){if(this.updateOption(t),t.map&&!Jt(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.scene.setEnableRender(!1),t.source&&!Jt(this.lastOptions.source,this.options.source)){const e=t.source,{data:i}=e,n=Ut(e,["data"]);this.changeData(i,n)}this.scene.setEnableRender(!0),this.render(),this.updateComponents(),this.emit("update")}changeData(t,e){this.options.source=or({},this.options.source,Object.assign({data:t},e));const i=this.options.source,{aggregation:n}=i,a=Ut(i,["aggregation"]);n&&ax.aggregation(a,n),this.source.setData(this.options.source.data,a);const o=this.options.legend;o&&setTimeout(()=>{this.updateLegendControl(o)},500),this.emit("change-data")}};Ms.DefaultOptions=hot;Ms.PlotType=ix;const fM="#2f54eb",Ir={active:{fill:!1,stroke:fM,lineWidth:1.5,lineOpacity:.8},select:{fill:!1,stroke:fM,lineWidth:1.5,lineOpacity:.8}},af=r=>(Wr(r)||(r.active===!1?Ir.active=Object.assign(Ir.active,{fill:!1,stroke:!1}):typeof r.active=="object"&&(r.active.fill===!1?Ir.active.fill=!1:typeof r.active.fill=="string"&&(Ir.active.fill=r.active.fill),r.active.stroke===!1?Ir.active.stroke=!1:typeof r.active.stroke=="string"&&(Ir.active.stroke=r.active.stroke),typeof r.active.lineWidth=="number"&&(Ir.active.lineWidth=r.active.lineWidth),typeof r.active.lineOpacity=="number"&&(Ir.active.lineOpacity=r.active.lineOpacity)),r.select===!1?Ir.select=Object.assign(Ir.select,{fill:!1,stroke:!1}):typeof r.select=="object"&&(r.select.fill===!1?Ir.select.fill=!1:typeof r.select.fill=="string"&&(Ir.select.fill=r.select.fill),r.select.stroke===!1?Ir.select.stroke=!1:typeof r.select.stroke=="string"&&(Ir.select.stroke=r.select.stroke),typeof r.select.lineWidth=="number"&&(Ir.select.lineWidth=r.select.lineWidth),typeof r.select.lineOpacity=="number"&&(Ir.select.lineOpacity=r.select.lineOpacity))),Ir);function fot(r,t,e,i,n,a){const{color:o,style:s,state:l}=a,u=af(l),c={active:u.active.fill===!1?!1:{color:u.active.fill},select:!1},h={opacity:s==null?void 0:s.opacity},f=s==null?void 0:s.lineWidth,d=s==null?void 0:s.stroke,v={opacity:s==null?void 0:s.lineOpacity,dashArray:s==null?void 0:s.lineDash,lineType:s==null?void 0:s.lineType};if(Qt.shape(r,"fill"),o&&Qt.color(r,o),h&&Qt.style(r,h),c&&Qt.state(r,c),Qt.shape(t,"line"),f&&Qt.size(t,f),d&&Qt.color(t,d),v&&Qt.style(t,v),u.active.stroke){const p=u.active.stroke,g=u.active.lineWidth||f,m={opacity:u.active.lineOpacity};Qt.shape(e,"line"),g&&Qt.size(e,g),p&&Qt.color(e,p),m&&Qt.style(e,m)}if(u.select.fill){const p=u.select.fill;Qt.shape(i,"fill"),p&&Qt.color(i,p),h&&Qt.style(i,h),Qt.state(i,{select:!1,active:!1})}if(u.select.stroke){const p=u.select.stroke,g=u.select.lineWidth||f,m={opacity:u.select.lineOpacity};Qt.shape(n,"line"),g&&Qt.size(n,g),p&&Qt.color(n,p),m&&Qt.style(n,m)}}const dot=r=>!Array.isArray(r[0].value),iS=r=>dot(r)?r:r.map(e=>Object.assign(Object.assign({},e),{value:[xb(e.value[0],4),xb(e.value[1],4)]})),YD={visible:!0,state:{active:!1,select:!1},enabledMultiSelect:!1},vot=["color","style","state","enabledMultiSelect"];class Cf extends Xi{constructor(t){super(t),this.selectData=[],this.type=Xi.LayerType.AreaLayer,this.interaction=!0,this.onHighlighHandle=c=>{const{feature:h,featureId:f}=c;this.setHighlightLayerSource(h,f)},this.onUnhighlighHandle=()=>{this.setHighlightLayerSource()},this.onSelectHandle=c=>{const h=this.options.enabledMultiSelect,{feature:f,featureId:d}=c;let v=Dr(this.selectData);const p=v.findIndex(g=>g.featureId===d);if(p===-1)h?v.push({feature:f,featureId:d}):v=[{feature:f,featureId:d}],this.emit("select",f,Dr(v));else{const g=v[p];h?v.splice(p,1):v=[],this.emit("unselect",g,Dr(v))}this.setSelectLayerSource(v)};const{name:e,source:i,visible:n,minZoom:a,maxZoom:o,zIndex:s=0}=this.options,l=this.pickLayerConfig(this.options),u=af(this.options.state);this.name=e||Cn(this.type),this.layer=new Ig(Object.assign(Object.assign({},l),{name:this.name})),this.strokeLayer=new nc({name:"strokeLayer",visible:n,zIndex:s,minZoom:a,maxZoom:o}),this.highlightLayer=new nc({name:"highlightLayer",visible:n&&!!u.active.stroke,zIndex:s+.1,minZoom:a,maxZoom:o}),this.selectFillLayer=new Ig({name:"selectFillLayer",visible:n&&!!u.select.fill,zIndex:s+.1,minZoom:a,maxZoom:o}),this.selectStrokeLayer=new nc({name:"selectStrokeLayer",visible:n&&!!u.select.stroke,zIndex:s+.1,minZoom:a,maxZoom:o}),this.mappingLayer(this.options),this.setSource(i),this.initEvent()}getDefaultOptions(){return YD}mappingLayer(t){fot(this.layer,this.strokeLayer,this.highlightLayer,this.selectFillLayer,this.selectStrokeLayer,t)}setSource(t){super.setSource(t),this.setStrokeLayerSource(),this.setHighlightLayerSource(),this.selectFillLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.selectStrokeLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}})}setStrokeLayerSource(){const t=this.layer.getSource();if(t)this.strokeLayer.setSource(t);else{const{data:e,options:i}=this.layer.sourceOption;this.strokeLayer.source(e,i)}}setHighlightLayerSource(t,e=-999){if(this.highlightLayerData===e)return;const i=t?[t]:[];this.highlightLayer.getSource()?this.highlightLayer.setData({type:"FeatureCollection",features:i},{parser:{type:"geojson"}}):this.highlightLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.highlightLayerData=e}setSelectLayerSource(t=[]){if(this.selectData.length===t.length&&Jt(this.selectData.map(({featureId:i})=>i),t.map(({featureId:i})=>i)))return;const e=t.map(({feature:i})=>i);this.selectFillLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.selectStrokeLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.selectData=t}initEvent(){this.layer.off("mousemove",this.onHighlighHandle),this.layer.off("unmousemove",this.onHighlighHandle),this.layer.off("click",this.onSelectHandle),this.selectData=[],this.highlightLayerData=null,this.options.state&&(this.options.state.active&&(this.layer.on("mousemove",this.onHighlighHandle),this.layer.on("unmousemove",this.onUnhighlighHandle)),this.options.state.select&&this.layer.on("click",this.onSelectHandle))}addTo(t){t.addLayer(this.layer),t.addLayer(this.strokeLayer),t.addLayer(this.highlightLayer),t.addLayer(this.selectFillLayer),t.addLayer(this.selectStrokeLayer)}remove(t){t.removeLayer(this.layer),t.removeLayer(this.strokeLayer),t.removeLayer(this.highlightLayer),t.removeLayer(this.selectFillLayer),t.removeLayer(this.selectStrokeLayer)}update(t){if(super.update(t),this.mappingLayer(this.options),this.options.visible){!Wr(t.state)&&!Jt(this.lastOptions.state,this.options.state)&&this.updateHighlightLayer();const e=af(this.options.state);e.active.stroke&&this.setHighlightLayerSource(),(e.select.fill||e.select.stroke)&&this.setSelectLayerSource()}this.initEvent()}updateHighlightLayer(){const t=af(this.options.state),e=af(this.lastOptions.state);e.active.stroke!==t.active.stroke&&(t.active.stroke?this.highlightLayer.show():this.highlightLayer.hide()),e.select.fill!==t.select.fill&&(t.select.fill?this.selectFillLayer.show():this.selectFillLayer.hide()),e.select.stroke!==t.select.stroke&&(t.select.stroke?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())}setIndex(t){this.layer.setIndex(t),this.strokeLayer.setIndex(t),this.highlightLayer.setIndex(t+.1),this.selectFillLayer.setIndex(t+.1),this.selectStrokeLayer.setIndex(t+.1)}setMinZoom(t){this.layer.setMinZoom(t),this.strokeLayer.setMinZoom(t),this.highlightLayer.setMinZoom(t),this.selectFillLayer.setMinZoom(t),this.selectStrokeLayer.setMinZoom(t)}setMaxZoom(t){this.layer.setMaxZoom(t),this.strokeLayer.setMaxZoom(t),this.highlightLayer.setMaxZoom(t),this.selectFillLayer.setMaxZoom(t),this.selectStrokeLayer.setMaxZoom(t)}show(){this.layer.inited&&(this.layer.show(),this.strokeLayer.show(),this.selectFillLayer.show(),this.selectStrokeLayer.show())}hide(){this.layer.inited&&(this.layer.hide(),this.strokeLayer.hide(),this.selectFillLayer.hide(),this.selectStrokeLayer.hide())}getColorLegendItems(){const t=this.layer.getLegendItems("color");return Array.isArray(t)&&t.length!==0?iS(t):[]}setActive(t){}setSelect(t){}}Cf.DefaultOptions=YD;Cf.LayerOptionsKeys=Xi.LayerConfigkeys.concat(vot);const jD=new Map;function pot(r,t){jD.set(r,t)}function got(r){return jD.get(r)}const mot=or({},Ms.DefaultOptions,{source:{data:[],joinBy:{geoField:"adcode"}},viewLevel:{level:"country",adcode:"100000"},chinaBorder:!0}),Ou={world:"country",country:"province",province:"city",city:"district",district:"district"},ZD="https://gw.alipayobjects.com/os/alisis/geo-data-v0.1.2",ox=`${ZD}/choropleth-data`,dM={national:{color:"red",width:1,opacity:1},dispute:{color:"red",width:1,opacity:.8,dashArray:[2,4]},coast:{color:"blue",width:.7,opacity:.8},hkm:{color:"gray",width:.7,opacity:.8,dashArray:[2,4]}},yot=r=>{const t={url:ox,type:"topojson",extension:"topo.json"};return Wr(r)||(typeof r=="string"?t.url=r:(t.url=(r==null?void 0:r.url)||ox,t.type=r.type,t.extension=r.type==="topojson"?"topo.json":"json")),t},_ot=r=>{try{return sH(r,"json")}catch{throw new Error('Failed convert to geojson from topojson, topojson default layer name "json"')}},xot=(r,t)=>{if(r.length!==t.length)return!1;for(let e=0;e<r.length;e++){const{level:i,granularity:n}=r[e];if(t[e].level!==i||t[e].granularity!==n)return!1}return!0},vM=r=>Ga(r,["source","color","style","state","label","tooltip"]);function Cot(r,t){const{shape:e,color:i,size:n,style:a,state:o,animate:s,texture:l}=t;e&&Qt.shape(r,e),n&&Qt.size(r,n),i&&Qt.color(r,i),a&&Qt.style(r,a),o&&Qt.state(r,o),s&&Qt.animate(r,s),l&&Qt.texture(r,l)}const qD={},Eot=["shape","color","size","style","state","animate"];class oc extends Xi{constructor(t){super(t),this.type=Xi.LayerType.LinesLayer,this.interaction=!0;const{name:e,source:i}=this.options,n=this.pickLayerConfig(this.options);this.name=e||Cn(this.type),this.layer=new nc(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(i)}getDefaultOptions(){return qD}mappingLayer(t,e){Cot(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}getColorLegendItems(){const t=this.layer.getLegendItems("color");return Array.isArray(t)&&t.length!==0?iS(t):[]}}oc.DefaultOptions=qD;oc.LayerOptionsKeys=Xi.LayerConfigkeys.concat(Eot);const Sot=["color","size","style","state","animate"];class Jp extends oc{constructor(){super(...arguments),this.type=oc.LayerType.PathLayer}getDefaultOptions(){return or({},oc.DefaultOptions,{shape:"line"})}}Jp.LayerOptionsKeys=oc.LayerConfigkeys.concat(Sot);const Aot=(r,t)=>{const{visible:e,minZoom:i,maxZoom:n,zIndex:a=0,chinaBorder:o}=t||{},s=typeof o=="object"?or({},dM,o):dM,l=r.features.filter(({properties:v})=>["coast","national"].includes(v==null?void 0:v.type)),u=r.features.filter(({properties:v})=>(v==null?void 0:v.type)==="dispute"),c=r.features.filter(({properties:v})=>(v==null?void 0:v.type)==="hkm"),h=new Jp({name:"chinaBoundaryLayer",visible:e,minZoom:i,maxZoom:n,zIndex:a+.1,source:{data:{type:"FeatureCollection",features:l},parser:{type:"geojson"}},color:{field:"type",value:({type:v})=>s[v].color},size:{field:"type",value:({type:v})=>s[v].width},style:{opacity:s.national.opacity}}),f=new Jp({name:"chinaHkmBoundaryLayer",visible:e,minZoom:i,maxZoom:n,zIndex:a+.1,source:{data:{type:"FeatureCollection",features:c},parser:{type:"geojson"}},color:s.hkm.color,size:s.hkm.width,style:{opacity:s.hkm.opacity,lineType:"dash",dashArray:s.hkm.dashArray}}),d=new Jp({name:"chinaDisputeBoundaryLayer",visible:e,minZoom:i,maxZoom:n,zIndex:a+.1,source:{data:{type:"FeatureCollection",features:u},parser:{type:"geojson"}},color:s.dispute.color,size:s.dispute.width,style:{opacity:s.dispute.opacity,lineType:"dash",dashArray:s.dispute.dashArray}});return{chinaBoundaryLayer:h,chinaHkmBoundaryLayer:f,chinaDisputeBoundaryLayer:d}};class th extends Ms{constructor(){super(...arguments),this.type=Ms.PlotType.Choropleth,this.chinaBoundaryData={type:"FeatureCollection",features:[]},this.currentDistrictData={type:"FeatureCollection",features:[]},this.drillSteps=[],this.drillStacks=[],this.onDrillDownHander=t=>{var e;const{steps:i,onDown:n}=this.options.drill,a=(e=t.feature)===null||e===void 0?void 0:e.properties,{adcode:o}=a;if(this.drillStacks.length===i.length+1)return;const s=this.drillStacks.slice(-1)[0],l=this.drillStacks.length-1,u=this.drillSteps[l],{level:c,granularity:h=Ou[c]}=u,f=Ut(u,["level","granularity"]),d={nativeEvent:!0,from:{level:s.level,adcode:s.adcode,granularity:s.granularity},to:{level:c,adcode:o,granularity:h,properties:a}},v=(p={})=>{const g={level:c,adcode:o,granularity:h},m=or({},f,p);this.changeView(g,m).then(y=>{y&&(this.drillStacks.push(y),this.emit("drilldown",d))})};n?n(d.from,d.to,v):v()},this.onDrillUpHander=()=>{const{onUp:t}=this.options.drill;if(this.drillStacks.length===0||this.drillStacks.length===1)return;const i=this.drillStacks.length-1,n=this.drillStacks[i],a=this.drillStacks[i-1],o={nativeEvent:!0,from:{level:n.level,adcode:n.adcode,granularity:n.granularity},to:{level:a.level,adcode:a.adcode,granularity:a.granularity}},s=(l={})=>{const u=o.to,c=or({},a.config,l);this.changeView(u,c).then(h=>{h&&(this.drillStacks.pop(),this.emit("drillup",o))})};t?t(o.from,o.to,s):s()}}initSource(){this.getInitDistrictData().then(()=>{this.source=this.createSource(),this.render(),this.inited=!0})}render(){if(this.inited)this.scene.setEnableRender(!0),this.scene.render();else{const t=this.createLayers(this.source);this.layerGroup=t,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",()=>{this.onSceneLoaded()}),this.initLayersEvent()}}update(t){var e,i,n;if(this.updateOption(t),t.map&&!Jt(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),t.drill&&t.drill.enabled!==!1&&!Jt((e=this.lastOptions.drill)===null||e===void 0?void 0:e.steps,(i=this.options.drill)===null||i===void 0?void 0:i.steps)&&(this.drillReset(),this.initDrillEvent()),this.scene.setEnableRender(!1),t.viewLevel&&!Jt(this.lastOptions.viewLevel,this.options.viewLevel)){const a=(n=t.source)===null||n===void 0?void 0:n.joinBy.geoData;this.getDistrictData(a).then(()=>{const o=this.options.source,{data:s}=o,l=Ut(o,["data"]);this.changeData(s,l),this.updateLayers(t),this.render(),this.updateComponents(),this.emit("update")})}else{if(t.source&&!Jt(this.lastOptions.source,this.options.source)){const a=this.options.source,{data:o}=a,s=Ut(a,["data"]);this.changeData(o,s)}this.updateLayers(t),this.render(),this.updateComponents(),this.emit("update")}}getDefaultOptions(){return th.DefaultOptions}parserSourceConfig(t){const{data:e,joinBy:i}=t,n=Ut(t,["data","joinBy"]),{sourceField:a,geoField:o,geoData:s}=i,l=s,u={type:"join",sourceField:a,targetField:o,data:e};return n.transforms?n.transforms.push(u):n.transforms=[u],n.parser&&delete n.parser,{data:l,sourceCFG:n}}createSource(){const{data:t,sourceCFG:e}=this.parserSourceConfig(this.options.source);return new V0(t,e)}changeData(t,e){this.options.source=or({},this.options.source,Object.assign({data:t},e));const{data:i,sourceCFG:n}=this.parserSourceConfig(this.options.source);this.source.setData(i,n),this.emit("change-data")}createLayers(t){this.fillAreaLayer=new Cf(Object.assign({name:"fillAreaLayer",source:t},Ga(this.options,Cf.LayerOptionsKeys)));const e=new jE([this.fillAreaLayer]);return this.options.chinaBorder&&this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options).forEach(n=>e.addLayer(n)),this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),e.addLayer(this.labelLayer)),e}createCountryBoundaryLayer(t,e){const{chinaBoundaryLayer:i,chinaHkmBoundaryLayer:n,chinaDisputeBoundaryLayer:a}=Aot(t,e);return this.chinaBoundaryLayer=i,this.chinaHkmBoundaryLayer=n,this.chinaDisputeBoundaryLayer=a,[i,n,a]}createLabelLayer(t,e){const i=t.originData.features.map(({properties:c})=>Object.assign({},c,{centroid:c.centroid||c.center})).filter(({centroid:c})=>c),{visible:n,minZoom:a,maxZoom:o,zIndex:s=0}=this.options,l=new um(Object.assign({name:"labelLayer",source:{data:i,parser:{type:"json",coordinates:"centroid"},transforms:t.transforms},visible:n,minZoom:a,maxZoom:o,zIndex:s+.1},e)),u=()=>{const c=this.source.originData.features.map(({properties:h})=>h).filter(({centroid:h})=>h);l.layer.setData(c,{transforms:t.transforms})};return t.on("update",u),l.on("remove",()=>{t.off("update",u)}),l}updateLayers(t){const e=Ga(t,Cf.LayerOptionsKeys);this.fillAreaLayer.update(e);const i=()=>{this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options).forEach(o=>this.layerGroup.addLayer(o))},n=()=>{this.chinaBoundaryLayer&&this.layerGroup.removeLayer(this.chinaBoundaryLayer),this.chinaHkmBoundaryLayer&&this.layerGroup.removeLayer(this.chinaHkmBoundaryLayer),this.chinaDisputeBoundaryLayer&&this.layerGroup.removeLayer(this.chinaDisputeBoundaryLayer)};t.chinaBorder?(this.chinaBoundaryLayer&&n(),i()):t.chinaBorder===!1&&n(),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}initLayersEvent(){this.initDrillEvent(),this.initLegendEvent()}initDrillEvent(){if(this.lastOptions.drill){const{triggerUp:a="unclick",triggerDown:o="click"}=this.lastOptions.drill;this.fillAreaLayer.off(a,this.onDrillUpHander),this.fillAreaLayer.off(o,this.onDrillDownHander)}if(!this.options.drill||this.options.drill.enabled===!1)return;const{steps:t,triggerUp:e="unclick",triggerDown:i="click"}=this.options.drill,n=t.map(a=>typeof a=="string"?{level:a,granularity:Ou[a]}:(a.granularity||(a.granularity=Ou[a.level]),a));if(xot(n,this.drillSteps)||(this.drillSteps=n,this.drillStacks=[]),!this.drillStacks.length){const{level:a,adcode:o,granularity:s=Ou[a]}=this.options.viewLevel,l=vM(this.options);this.drillStacks=[{level:a,adcode:o,granularity:s,config:l}]}this.fillAreaLayer.on(e,this.onDrillUpHander),this.fillAreaLayer.on(i,this.onDrillDownHander)}initLegendEvent(){const t=this.options.legend;if(!t)return;const e=()=>{this.updateLegendControl(t)};this.fillAreaLayer.on("legend:color",e)}drillReset(){this.drillStacks=[]}getCurrentDrillSteps(){return this.drillStacks.map(e=>Ga(e,["level","adcode","granularity"]))}getLegendOptions(){const t=this.fillAreaLayer.getColorLegendItems();return t.length!==0?{type:"category",items:t}:{}}fetchData(t,e,i){return xi(this,void 0,void 0,function*(){const n=`${e}_${t}_${i}`,a=got(n);if(a)return a;const{url:o,type:s,extension:l}=yot(this.options.geoArea);let u;const c=this.options.customFetchGeoData;return c?u=yield c({url:o,level:t,adcode:e,granularity:i,extension:l}):u=yield(yield fetch(`${o}/${t}/${n}.${l}`)).json(),s==="topojson"&&(u=_ot(u)),pot(n,u),u})}getInitDistrictData(){return xi(this,void 0,void 0,function*(){var t;const e=this.fetchData("country","100000","boundary"),i=(t=this.options.source)===null||t===void 0?void 0:t.joinBy.geoData;try{[this.chinaBoundaryData]=yield Promise.all([e,this.getDistrictData(i)])}catch(n){throw new Error(`Failed to get china boundary data，${n}`)}})}getDistrictData(t){return xi(this,void 0,void 0,function*(){const{level:e,adcode:i,granularity:n=Ou[e]}=this.options.viewLevel,a=t?Promise.resolve(t):this.fetchData(e,i,n);try{this.currentDistrictData=yield a,this.options.source=or({},this.options.source,{joinBy:{geoData:this.currentDistrictData}})}catch(o){throw new Error(`Failed to get district data，${o}`)}})}drillDown(t,e={}){const i=this.drillStacks.slice(-1)[0],{level:n,adcode:a,granularity:o}=t,s={nativeEvent:!1,from:{level:i.level,adcode:i.adcode,granularity:i.granularity},to:{level:n,adcode:a,granularity:o}};this.changeView(t,e).then(l=>{l&&(this.drillStacks.push(l),this.emit("drilldown",s))})}drillUp(t={},e){const i=this.drillStacks.length;if([0,1].includes(i))return;const a=e?this.drillStacks.findIndex(v=>v.level===e):-1,o=a!==-1,s=o?a:i-2,l=this.drillStacks[s],{config:u}=l,c=Ut(l,["config"]),h=or({},u,t),f=this.drillStacks[this.drillStacks.length-1],d={nativeEvent:!1,from:{level:f.level,adcode:f.adcode,granularity:f.granularity},to:{level:c.level,adcode:c.adcode,granularity:c.granularity}};this.changeView(c,h).then(v=>{v&&(o?this.drillStacks.splice(a+1):this.drillStacks.pop(),this.emit("drillup",d))})}changeView(t){return xi(this,arguments,void 0,function*(e,i={}){const{level:n,adcode:a,granularity:o=Ou[n]}=e,s=yield this.fetchData(n,a,o);if(!s.features.length)return;const l=or({},vM(this.options),i,{viewLevel:{level:n,adcode:a,granularity:o},source:{joinBy:{geoData:s}}});return this.update(l),{level:n,adcode:a,granularity:o,config:l}})}}th.DefaultOptions=mot;th.GeoDataUrl=ZD;th.GeoAreaUrl=ox;const bzt=Object.freeze(Object.defineProperty({__proto__:null,Choropleth:th},Symbol.toStringTag,{value:"Module"})),Tot=or({},Ms.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}});function bot(r,t){const{shape:e,color:i,size:n,style:a,state:o,animate:s}=t;e&&Qt.shape(r,e),n&&Qt.size(r,n),i&&Qt.color(r,i),a&&Qt.style(r,a),o&&Qt.state(r,o),s&&Qt.animate(r,s)}const KD={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"circle",size:12,color:"#5FD3A6"},wot=["shape","color","size","style","state","animate"];class Ef extends Xi{constructor(t){super(t),this.type=Xi.LayerType.DotLayer,this.interaction=!0;const{name:e,source:i}=this.options,n=this.pickLayerConfig(this.options);this.name=e||Cn(this.type),this.layer=new Wf(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(i)}getDefaultOptions(){return KD}mappingLayer(t,e){bot(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}getColorLegendItems(){const t=this.layer.getLegendItems("color");return Array.isArray(t)&&t.length!==0?iS(t):[]}}Ef.DefaultOptions=KD;Ef.LayerOptionsKeys=Xi.LayerConfigkeys.concat(wot);class nS extends Ms{constructor(){super(...arguments),this.type=Ms.PlotType.Dot}getDefaultOptions(){return nS.DefaultOptions}createLayers(t){this.dotLayer=new Ef(Object.assign({source:t},Ga(this.options,Ef.LayerOptionsKeys)));const e=new jE([this.dotLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),e.addLayer(this.labelLayer)),e}updateLayers(t){const e=Ga(t,Ef.LayerOptionsKeys);this.dotLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}getLegendOptions(){const t=this.dotLayer.getColorLegendItems();return t.length!==0?{type:"category",items:t}:{}}}nS.DefaultOptions=Tot;var aS=Object.freeze({__proto__:null,get Base(){return Ra},get Circle(){return jut},get Ellipse(){return qut},get Image(){return yS},get Line(){return Jut},get Marker(){return rct},get Path(){return _S},get Polygon(){return hct},get Polyline(){return dct},get Rect(){return mct},get Text(){return _ct}}),sx=function(r,t){return sx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])},sx(r,t)};function gt(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");sx(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var k=function(){return k=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},k.apply(this,arguments)};function cm(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}function Vn(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function tt(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),n,a=[],o;try{for(;(t===void 0||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return a}function Rot(){for(var r=0,t=0,e=arguments.length;t<e;t++)r+=arguments[t].length;for(var i=Array(r),n=0,t=0;t<e;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,n++)i[n]=a[o];return i}function ht(r,t,e){if(e||arguments.length===2)for(var i=0,n=t.length,a;i<n;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return r.concat(a||Array.prototype.slice.call(t))}var pM=function(r){return r!==null&&typeof r!="function"&&isFinite(r.length)},Mot={}.toString,hm=function(r,t){return Mot.call(r)==="[object "+t+"]"},Xl=function(r){return hm(r,"Function")},br=function(r){return r==null},Gn=function(r){return Array.isArray?Array.isArray(r):hm(r,"Array")},Sf=function(r){var t=typeof r;return r!==null&&t==="object"||t==="function"};function _e(r,t){if(r){var e;if(Gn(r))for(var i=0,n=r.length;i<n&&(e=t(r[i],i),e!==!1);i++);else if(Sf(r)){for(var a in r)if(r.hasOwnProperty(a)&&(e=t(r[a],a),e===!1))break}}}var gM=function(r){return typeof r=="object"&&r!==null},Is=function(r){if(Gn(r))return r.reduce(function(t,e){return Math.max(t,e)},r[0])},Ls=function(r){if(Gn(r))return r.reduce(function(t,e){return Math.min(t,e)},r[0])},Ca=function(r){return hm(r,"String")},lx=function(r){return hm(r,"Number")},Iot=1e-5;function Lot(r,t,e){return e===void 0&&(e=Iot),Math.abs(r-t)<e}var QD=function(r,t){return(r%t+t)%t},Oot=Math.PI/180,JD=function(r){return Oot*r},Pot=Object.values?function(r){return Object.values(r)}:function(r){var t=[];return _e(r,function(e,i){Xl(r)&&i==="prototype"||t.push(e)}),t},Fot=function(r){return br(r)?"":r.toString()},t5=function(r){var t=Fot(r);return t.charAt(0).toUpperCase()+t.substring(1)};function Bot(r){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,16)};return t(r)}function Dot(r){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;t(r)}function s_(r,t){for(var e in t)t.hasOwnProperty(e)&&e!=="constructor"&&t[e]!==void 0&&(r[e]=t[e])}function e5(r,t,e,i){return t&&s_(r,t),e&&s_(r,e),i&&s_(r,i),r}var Not=function(r,t){if(!Xl(r))throw new TypeError("Expected a function");var e=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var a=t?t.apply(this,i):i[0],o=e.cache;if(o.has(a))return o.get(a);var s=r.apply(this,i);return o.set(a,s),s};return e.cache=new Map,e},Vg=function(r,t){if(r===t)return!0;if(!r||!t||Ca(r)||Ca(t))return!1;if(pM(r)||pM(t)){if(r.length!==t.length)return!1;for(var e=!0,i=0;i<r.length&&(e=Vg(r[i],t[i]),!!e);i++);return e}if(gM(r)||gM(t)){var n=Object.keys(r),a=Object.keys(t);if(n.length!==a.length)return!1;for(var e=!0,i=0;i<n.length&&(e=Vg(r[n[i]],t[n[i]]),!!e);i++);return e}return!1},rp={},kot=function(r){return r=r||"g",rp[r]?rp[r]+=1:rp[r]=1,r+rp[r]},ip=function(){},np;Not(function(r,t){t===void 0&&(t={});var e=t.fontSize,i=t.fontFamily,n=t.fontWeight,a=t.fontStyle,o=t.fontVariant;return np||(np=document.createElement("canvas").getContext("2d")),np.font=[a,o,n,e+"px",i].join(" "),np.measureText(Ca(r)?r:"").width},function(r,t){return t===void 0&&(t={}),Rot([r],Pot(t)).join("")});var Af=`	
\v\f\r   ᠎             　\u2028\u2029`,Uot=new RegExp("([a-z])["+Af+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+Af+"]*,?["+Af+"]*)+)","ig"),zot=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+Af+"]*,?["+Af+"]*","ig"),ju=function(r){if(!r)return null;if(Gn(r))return r;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(r).replace(Uot,function(i,n,a){var o=[],s=n.toLowerCase();if(a.replace(zot,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(e.push([n].concat(o.splice(0,2))),s="l",n=n==="m"?"l":"L"),s==="o"&&o.length===1&&e.push([n,o[0]]),s==="r")e.push([n].concat(o));else for(;o.length>=t[s]&&(e.push([n].concat(o.splice(0,t[s]))),!!t[s]););return r}),e},ux=function(r,t){for(var e=[],i=0,n=r.length;n-2*!t>i;i+=2){var a=[{x:+r[i-2],y:+r[i-1]},{x:+r[i],y:+r[i+1]},{x:+r[i+2],y:+r[i+3]},{x:+r[i+4],y:+r[i+5]}];t?i?n-4===i?a[3]={x:+r[0],y:+r[1]}:n-2===i&&(a[2]={x:+r[0],y:+r[1]},a[3]={x:+r[2],y:+r[3]}):a[0]={x:+r[n-2],y:+r[n-1]}:n-4===i?a[3]=a[2]:i||(a[0]={x:+r[i],y:+r[i+1]}),e.push(["C",(-a[0].x+6*a[1].x+a[2].x)/6,(-a[0].y+6*a[1].y+a[2].y)/6,(a[1].x+6*a[2].x-a[3].x)/6,(a[1].y+6*a[2].y-a[3].y)/6,a[2].x,a[2].y])}return e},ap=function(r,t,e,i,n){var a=[];if(n===null&&i===null&&(i=e),r=+r,t=+t,e=+e,i=+i,n!==null){var o=Math.PI/180,s=r+e*Math.cos(-i*o),l=r+e*Math.cos(-n*o),u=t+e*Math.sin(-i*o),c=t+e*Math.sin(-n*o);a=[["M",s,u],["A",e,e,0,+(n-i>180),0,l,c]]}else a=[["M",r,t],["m",0,-i],["a",e,i,0,1,1,0,2*i],["a",e,i,0,1,1,0,-2*i],["z"]];return a},cx=function(r){if(r=ju(r),!r||!r.length)return[["M",0,0]];var t=[],e=0,i=0,n=0,a=0,o=0,s,l;r[0][0]==="M"&&(e=+r[0][1],i=+r[0][2],n=e,a=i,o++,t[0]=["M",e,i]);for(var u=r.length===3&&r[0][0]==="M"&&r[1][0].toUpperCase()==="R"&&r[2][0].toUpperCase()==="Z",c=void 0,h=void 0,f=o,d=r.length;f<d;f++){if(t.push(c=[]),h=r[f],s=h[0],s!==s.toUpperCase())switch(c[0]=s.toUpperCase(),c[0]){case"A":c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=+h[6]+e,c[7]=+h[7]+i;break;case"V":c[1]=+h[1]+i;break;case"H":c[1]=+h[1]+e;break;case"R":l=[e,i].concat(h.slice(1));for(var v=2,p=l.length;v<p;v++)l[v]=+l[v]+e,l[++v]=+l[v]+i;t.pop(),t=t.concat(ux(l,u));break;case"O":t.pop(),l=ap(e,i,h[1],h[2]),l.push(l[0]),t=t.concat(l);break;case"U":t.pop(),t=t.concat(ap(e,i,h[1],h[2],h[3])),c=["U"].concat(t[t.length-1].slice(-2));break;case"M":n=+h[1]+e,a=+h[2]+i;break;default:for(var v=1,p=h.length;v<p;v++)c[v]=+h[v]+(v%2?e:i)}else if(s==="R")l=[e,i].concat(h.slice(1)),t.pop(),t=t.concat(ux(l,u)),c=["R"].concat(h.slice(-2));else if(s==="O")t.pop(),l=ap(e,i,h[1],h[2]),l.push(l[0]),t=t.concat(l);else if(s==="U")t.pop(),t=t.concat(ap(e,i,h[1],h[2],h[3])),c=["U"].concat(t[t.length-1].slice(-2));else for(var g=0,m=h.length;g<m;g++)c[g]=h[g];if(s=s.toUpperCase(),s!=="O")switch(c[0]){case"Z":e=+n,i=+a;break;case"H":e=c[1];break;case"V":i=c[1];break;case"M":n=c[c.length-2],a=c[c.length-1];break;default:e=c[c.length-2],i=c[c.length-1]}}return t},op=function(r,t,e,i){return[r,t,e,i,e,i]},mM=function(r,t,e,i,n,a){var o=.3333333333333333,s=2/3;return[o*r+s*e,o*t+s*i,o*n+s*e,o*a+s*i,n,a]},r5=function(r,t,e,i,n,a,o,s,l,u){e===i&&(e+=1);var c=Math.PI*120/180,h=Math.PI/180*(+n||0),f=[],d,v,p,g,m,y=function(le,me,We){var Ri=le*Math.cos(We)-me*Math.sin(We),tn=le*Math.sin(We)+me*Math.cos(We);return{x:Ri,y:tn}};if(u)v=u[0],p=u[1],g=u[2],m=u[3];else{d=y(r,t,-h),r=d.x,t=d.y,d=y(s,l,-h),s=d.x,l=d.y,r===s&&t===l&&(s+=1,l+=1);var _=(r-s)/2,x=(t-l)/2,C=_*_/(e*e)+x*x/(i*i);C>1&&(C=Math.sqrt(C),e=C*e,i=C*i);var A=e*e,T=i*i,w=(a===o?-1:1)*Math.sqrt(Math.abs((A*T-A*x*x-T*_*_)/(A*x*x+T*_*_)));g=w*e*x/i+(r+s)/2,m=w*-i*_/e+(t+l)/2,v=Math.asin(((t-m)/i).toFixed(9)),p=Math.asin(((l-m)/i).toFixed(9)),v=r<g?Math.PI-v:v,p=s<g?Math.PI-p:p,v<0&&(v=Math.PI*2+v),p<0&&(p=Math.PI*2+p),o&&v>p&&(v=v-Math.PI*2),!o&&p>v&&(p=p-Math.PI*2)}var M=p-v;if(Math.abs(M)>c){var O=p,P=s,D=l;p=v+c*(o&&p>v?1:-1),s=g+e*Math.cos(p),l=m+i*Math.sin(p),f=r5(s,l,e,i,n,0,o,P,D,[p,O,g,m])}M=p-v;var z=Math.cos(v),Y=Math.sin(v),H=Math.cos(p),N=Math.sin(p),W=Math.tan(M/4),Q=4/3*e*W,q=4/3*i*W,J=[r,t],et=[r+Q*Y,t-q*z],ft=[s+Q*N,l-q*H],Ct=[s,l];if(et[0]=2*J[0]-et[0],et[1]=2*J[1]-et[1],u)return[et,ft,Ct].concat(f);f=[et,ft,Ct].concat(f).join().split(",");for(var ct=[],dt=0,Rt=f.length;dt<Rt;dt++)ct[dt]=dt%2?y(f[dt-1],f[dt],h).y:y(f[dt],f[dt+1],h).x;return ct},hx=function(r,t){var e=cx(r),i=t&&cx(t),n={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=[],s=[],l="",u="",c,h=function(_,x,C){var A,T;if(!_)return["C",x.x,x.y,x.x,x.y,x.x,x.y];switch(!(_[0]in{T:1,Q:1})&&(x.qx=x.qy=null),_[0]){case"M":x.X=_[1],x.Y=_[2];break;case"A":_=["C"].concat(r5.apply(0,[x.x,x.y].concat(_.slice(1))));break;case"S":C==="C"||C==="S"?(A=x.x*2-x.bx,T=x.y*2-x.by):(A=x.x,T=x.y),_=["C",A,T].concat(_.slice(1));break;case"T":C==="Q"||C==="T"?(x.qx=x.x*2-x.qx,x.qy=x.y*2-x.qy):(x.qx=x.x,x.qy=x.y),_=["C"].concat(mM(x.x,x.y,x.qx,x.qy,_[1],_[2]));break;case"Q":x.qx=_[1],x.qy=_[2],_=["C"].concat(mM(x.x,x.y,_[1],_[2],_[3],_[4]));break;case"L":_=["C"].concat(op(x.x,x.y,_[1],_[2]));break;case"H":_=["C"].concat(op(x.x,x.y,_[1],x.y));break;case"V":_=["C"].concat(op(x.x,x.y,x.x,_[1]));break;case"Z":_=["C"].concat(op(x.x,x.y,x.X,x.Y));break}return _},f=function(_,x){if(_[x].length>7){_[x].shift();for(var C=_[x];C.length;)o[x]="A",i&&(s[x]="A"),_.splice(x++,0,["C"].concat(C.splice(0,6)));_.splice(x,1),c=Math.max(e.length,i&&i.length||0)}},d=function(_,x,C,A,T){_&&x&&_[T][0]==="M"&&x[T][0]!=="M"&&(x.splice(T,0,["M",A.x,A.y]),C.bx=0,C.by=0,C.x=_[T][1],C.y=_[T][2],c=Math.max(e.length,i&&i.length||0))};c=Math.max(e.length,i&&i.length||0);for(var v=0;v<c;v++){e[v]&&(l=e[v][0]),l!=="C"&&(o[v]=l,v&&(u=o[v-1])),e[v]=h(e[v],n,u),o[v]!=="A"&&l==="C"&&(o[v]="C"),f(e,v),i&&(i[v]&&(l=i[v][0]),l!=="C"&&(s[v]=l,v&&(u=s[v-1])),i[v]=h(i[v],a,u),s[v]!=="A"&&l==="C"&&(s[v]="C"),f(i,v)),d(e,i,n,a,v),d(i,e,a,n,v);var p=e[v],g=i&&i[v],m=p.length,y=i&&g.length;n.x=p[m-2],n.y=p[m-1],n.bx=parseFloat(p[m-4])||n.x,n.by=parseFloat(p[m-3])||n.y,a.bx=i&&(parseFloat(g[y-4])||a.x),a.by=i&&(parseFloat(g[y-3])||a.y),a.x=i&&g[y-2],a.y=i&&g[y-1]}return i?[e,i]:e},Hot=/,?([a-z]),?/gi,i5=function(r){return r.join(",").replace(Hot,"$1")},yM=function(r,t,e,i,n){var a=-3*t+9*e-9*i+3*n,o=r*a+6*t-12*e+6*i;return r*o-3*t+3*e},_M=function(r,t,e,i,n,a,o,s,l){l===null&&(l=1),l=l>1?1:l<0?0:l;for(var u=l/2,c=12,h=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],f=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],d=0,v=0;v<c;v++){var p=u*h[v]+u,g=yM(p,r,e,n,o),m=yM(p,t,i,a,s),y=g*g+m*m;d+=f[v]*Math.sqrt(y)}return u*d},$ot=function(r,t,e,i,n,a,o,s){for(var l=[],u=[[],[]],c,h,f,d,v=0;v<2;++v){if(v===0?(h=6*r-12*e+6*n,c=-3*r+9*e-9*n+3*o,f=3*e-3*r):(h=6*t-12*i+6*a,c=-3*t+9*i-9*a+3*s,f=3*i-3*t),Math.abs(c)<1e-12){if(Math.abs(h)<1e-12)continue;d=-f/h,d>0&&d<1&&l.push(d);continue}var p=h*h-4*f*c,g=Math.sqrt(p);if(!(p<0)){var m=(-h+g)/(2*c);m>0&&m<1&&l.push(m);var y=(-h-g)/(2*c);y>0&&y<1&&l.push(y)}}for(var _=l.length,x=_,C;_--;)d=l[_],C=1-d,u[0][_]=C*C*C*r+3*C*C*d*e+3*C*d*d*n+d*d*d*o,u[1][_]=C*C*C*t+3*C*C*d*i+3*C*d*d*a+d*d*d*s;return u[0][x]=r,u[1][x]=t,u[0][x+1]=o,u[1][x+1]=s,u[0].length=u[1].length=x+2,{min:{x:Math.min.apply(0,u[0]),y:Math.min.apply(0,u[1])},max:{x:Math.max.apply(0,u[0]),y:Math.max.apply(0,u[1])}}},Wot=function(r,t,e,i,n,a,o,s){if(!(Math.max(r,e)<Math.min(n,o)||Math.min(r,e)>Math.max(n,o)||Math.max(t,i)<Math.min(a,s)||Math.min(t,i)>Math.max(a,s))){var l=(r*i-t*e)*(n-o)-(r-e)*(n*s-a*o),u=(r*i-t*e)*(a-s)-(t-i)*(n*s-a*o),c=(r-e)*(a-s)-(t-i)*(n-o);if(c){var h=l/c,f=u/c,d=+h.toFixed(2),v=+f.toFixed(2);if(!(d<+Math.min(r,e).toFixed(2)||d>+Math.max(r,e).toFixed(2)||d<+Math.min(n,o).toFixed(2)||d>+Math.max(n,o).toFixed(2)||v<+Math.min(t,i).toFixed(2)||v>+Math.max(t,i).toFixed(2)||v<+Math.min(a,s).toFixed(2)||v>+Math.max(a,s).toFixed(2)))return{x:h,y:f}}}},is=function(r,t,e){return t>=r.x&&t<=r.x+r.width&&e>=r.y&&e<=r.y+r.height},n5=function(r,t,e,i,n){if(n)return[["M",+r+ +n,t],["l",e-n*2,0],["a",n,n,0,0,1,n,n],["l",0,i-n*2],["a",n,n,0,0,1,-n,n],["l",n*2-e,0],["a",n,n,0,0,1,-n,-n],["l",0,n*2-i],["a",n,n,0,0,1,n,-n],["z"]];var a=[["M",r,t],["l",e,0],["l",0,i],["l",-e,0],["z"]];return a.parsePathArray=i5,a},fx=function(r,t,e,i){return r===null&&(r=t=e=i=0),t===null&&(t=r.y,e=r.width,i=r.height,r=r.x),{x:r,y:t,width:e,w:e,height:i,h:i,x2:r+e,y2:t+i,cx:r+e/2,cy:t+i/2,r1:Math.min(e,i)/2,r2:Math.max(e,i)/2,r0:Math.sqrt(e*e+i*i)/2,path:n5(r,t,e,i),vb:[r,t,e,i].join(" ")}},Vot=function(r,t){return r=fx(r),t=fx(t),is(t,r.x,r.y)||is(t,r.x2,r.y)||is(t,r.x,r.y2)||is(t,r.x2,r.y2)||is(r,t.x,t.y)||is(r,t.x2,t.y)||is(r,t.x,t.y2)||is(r,t.x2,t.y2)||(r.x<t.x2&&r.x>t.x||t.x<r.x2&&t.x>r.x)&&(r.y<t.y2&&r.y>t.y||t.y<r.y2&&t.y>r.y)},xM=function(r,t,e,i,n,a,o,s){Gn(r)||(r=[r,t,e,i,n,a,o,s]);var l=$ot.apply(null,r);return fx(l.min.x,l.min.y,l.max.x-l.min.x,l.max.y-l.min.y)},CM=function(r,t,e,i,n,a,o,s,l){var u=1-l,c=Math.pow(u,3),h=Math.pow(u,2),f=l*l,d=f*l,v=c*r+h*3*l*e+u*3*l*l*n+d*o,p=c*t+h*3*l*i+u*3*l*l*a+d*s,g=r+2*l*(e-r)+f*(n-2*e+r),m=t+2*l*(i-t)+f*(a-2*i+t),y=e+2*l*(n-e)+f*(o-2*n+e),_=i+2*l*(a-i)+f*(s-2*a+i),x=u*r+l*e,C=u*t+l*i,A=u*n+l*o,T=u*a+l*s,w=90-Math.atan2(g-y,m-_)*180/Math.PI;return{x:v,y:p,m:{x:g,y:m},n:{x:y,y:_},start:{x,y:C},end:{x:A,y:T},alpha:w}},Got=function(r,t,e){var i=xM(r),n=xM(t);if(!Vot(i,n))return e?0:[];for(var a=_M.apply(0,r),o=_M.apply(0,t),s=~~(a/8),l=~~(o/8),u=[],c=[],h={},f=e?0:[],d=0;d<s+1;d++){var v=CM.apply(0,r.concat(d/s));u.push({x:v.x,y:v.y,t:d/s})}for(var d=0;d<l+1;d++){var v=CM.apply(0,t.concat(d/l));c.push({x:v.x,y:v.y,t:d/l})}for(var d=0;d<s;d++)for(var p=0;p<l;p++){var g=u[d],m=u[d+1],y=c[p],_=c[p+1],x=Math.abs(m.x-g.x)<.001?"y":"x",C=Math.abs(_.x-y.x)<.001?"y":"x",A=Wot(g.x,g.y,m.x,m.y,y.x,y.y,_.x,_.y);if(A){if(h[A.x.toFixed(4)]===A.y.toFixed(4))continue;h[A.x.toFixed(4)]=A.y.toFixed(4);var T=g.t+Math.abs((A[x]-g[x])/(m[x]-g[x]))*(m.t-g.t),w=y.t+Math.abs((A[C]-y[C])/(_[C]-y[C]))*(_.t-y.t);T>=0&&T<=1&&w>=0&&w<=1&&(e?f+=1:f.push({x:A.x,y:A.y,t1:T,t2:w}))}}return f},Xot=function(r,t,e){r=hx(r),t=hx(t);for(var i,n,a,o,s,l,u,c,h,f,d=e?0:[],v=0,p=r.length;v<p;v++){var g=r[v];if(g[0]==="M")i=s=g[1],n=l=g[2];else{g[0]==="C"?(h=[i,n].concat(g.slice(1)),i=h[6],n=h[7]):(h=[i,n,i,n,s,l,s,l],i=s,n=l);for(var m=0,y=t.length;m<y;m++){var _=t[m];if(_[0]==="M")a=u=_[1],o=c=_[2];else{_[0]==="C"?(f=[a,o].concat(_.slice(1)),a=f[6],o=f[7]):(f=[a,o,a,o,u,c,u,c],a=u,o=c);var x=Got(h,f,e);if(e)d+=x;else{for(var C=0,A=x.length;C<A;C++)x[C].segment1=v,x[C].segment2=m,x[C].bez1=h,x[C].bez2=f;d=d.concat(x)}}}}}return d},Yot=function(r,t){return Xot(r,t)};function jot(r,t){var e=[],i=[];function n(a,o){if(a.length===1)e.push(a[0]),i.push(a[0]);else{for(var s=[],l=0;l<a.length-1;l++)l===0&&e.push(a[0]),l===a.length-2&&i.push(a[l+1]),s[l]=[(1-o)*a[l][0]+o*a[l+1][0],(1-o)*a[l][1]+o*a[l+1][1]];n(s,o)}}return r.length&&n(r,t),{left:e,right:i.reverse()}}function Zot(r,t,e){var i=[[r[1],r[2]]];e=e||2;var n=[];t[0]==="A"?(i.push(t[6]),i.push(t[7])):t[0]==="C"?(i.push([t[1],t[2]]),i.push([t[3],t[4]]),i.push([t[5],t[6]])):t[0]==="S"||t[0]==="Q"?(i.push([t[1],t[2]]),i.push([t[3],t[4]])):i.push([t[1],t[2]]);for(var a=i,o=1/e,s=0;s<e-1;s++){var l=o/(1-o*s),u=jot(a,l);n.push(u.left),a=u.right}n.push(a);var c=n.map(function(h){var f=[];return h.length===4&&(f.push("C"),f=f.concat(h[2])),h.length>=3&&(h.length===3&&f.push("Q"),f=f.concat(h[1])),h.length===2&&f.push("L"),f=f.concat(h[h.length-1]),f});return c}var qot=function(r,t,e){if(e===1)return[[].concat(r)];var i=[];if(t[0]==="L"||t[0]==="C"||t[0]==="Q")i=i.concat(Zot(r,t,e));else{var n=[].concat(r);n[0]==="M"&&(n[0]="L");for(var a=0;a<=e-1;a++)i.push(n)}return i},Kot=function(r,t){if(r.length===1)return r;var e=r.length-1,i=t.length-1,n=e/i,a=[];if(r.length===1&&r[0][0]==="M"){for(var o=0;o<i-e;o++)r.push(r[0]);return r}for(var o=0;o<i;o++){var s=Math.floor(n*o);a[s]=(a[s]||0)+1}var l=a.reduce(function(u,c,h){return h===e?u.concat(r[e]):u.concat(qot(r[h],r[h+1],c))},[]);return l.unshift(r[0]),(t[i]==="Z"||t[i]==="z")&&l.push("Z"),l},Qot=function(r,t){if(r.length!==t.length)return!1;var e=!0;return _e(r,function(i,n){if(i!==t[n])return e=!1,!1}),e};function Jot(r,t,e){var i=null,n=e;return t<n&&(n=t,i="add"),r<n&&(n=r,i="del"),{type:i,min:n}}var tst=function(r,t){var e=r.length,i=t.length,n,a,o=0;if(e===0||i===0)return null;for(var s=[],l=0;l<=e;l++)s[l]=[],s[l][0]={min:l};for(var u=0;u<=i;u++)s[0][u]={min:u};for(var l=1;l<=e;l++){n=r[l-1];for(var u=1;u<=i;u++){a=t[u-1],Qot(n,a)?o=0:o=1;var c=s[l-1][u].min+1,h=s[l][u-1].min+1,f=s[l-1][u-1].min+o;s[l][u]=Jot(c,h,f)}}return s},a5=function(r,t){var e=tst(r,t),i=r.length,n=t.length,a=[],o=1,s=1;if(e[i][n].min!==i){for(var l=1;l<=i;l++){var u=e[l][l].min;s=l;for(var c=o;c<=n;c++)e[l][c].min<u&&(u=e[l][c].min,s=c);o=s,e[l][o].type&&a.push({index:l-1,type:e[l][o].type})}for(var l=a.length-1;l>=0;l--)o=a[l].index,a[l].type==="add"?r.splice(o,0,[].concat(r[o])):r.splice(o,1)}i=r.length;var h=n-i;if(i<n)for(var l=0;l<h;l++)r[i-1][0]==="z"||r[i-1][0]==="Z"?r.splice(i-2,0,r[i-2]):r.push(r[i-1]),i+=1;return r};function l_(r,t,e){for(var i=[].concat(r),n,a=1/(e+1),o=o5(t)[0],s=1;s<=e;s++)a*=s,n=Math.floor(r.length*a),n===0?i.unshift([o[0]*a+r[n][0]*(1-a),o[1]*a+r[n][1]*(1-a)]):i.splice(n,0,[o[0]*a+r[n][0]*(1-a),o[1]*a+r[n][1]*(1-a)]);return i}function o5(r){var t=[];switch(r[0]){case"M":t.push([r[1],r[2]]);break;case"L":t.push([r[1],r[2]]);break;case"A":t.push([r[6],r[7]]);break;case"Q":t.push([r[3],r[4]]),t.push([r[1],r[2]]);break;case"T":t.push([r[1],r[2]]);break;case"C":t.push([r[5],r[6]]),t.push([r[1],r[2]]),t.push([r[3],r[4]]);break;case"S":t.push([r[3],r[4]]),t.push([r[1],r[2]]);break;case"H":t.push([r[1],r[1]]);break;case"V":t.push([r[1],r[1]]);break}return t}var dx=function(r,t){if(r.length<=1)return r;for(var e,i=0;i<t.length;i++)if(r[i][0]!==t[i][0])switch(e=o5(r[i]),t[i][0]){case"M":r[i]=["M"].concat(e[0]);break;case"L":r[i]=["L"].concat(e[0]);break;case"A":r[i]=[].concat(t[i]),r[i][6]=e[0][0],r[i][7]=e[0][1];break;case"Q":if(e.length<2)if(i>0)e=l_(e,r[i-1],1);else{r[i]=t[i];break}r[i]=["Q"].concat(e.reduce(function(n,a){return n.concat(a)},[]));break;case"T":r[i]=["T"].concat(e[0]);break;case"C":if(e.length<3)if(i>0)e=l_(e,r[i-1],2);else{r[i]=t[i];break}r[i]=["C"].concat(e.reduce(function(n,a){return n.concat(a)},[]));break;case"S":if(e.length<2)if(i>0)e=l_(e,r[i-1],1);else{r[i]=t[i];break}r[i]=["S"].concat(e.reduce(function(n,a){return n.concat(a)},[]));break;default:r[i]=t[i]}return r},est=Object.freeze({__proto__:null,catmullRomToBezier:ux,fillPath:Kot,fillPathByDiff:a5,formatPath:dx,intersection:Yot,parsePathArray:i5,parsePathString:ju,pathToAbsolute:cx,pathToCurve:hx,rectPath:n5}),rst=function(){function r(t,e){this.bubbles=!0,this.target=null,this.currentTarget=null,this.delegateTarget=null,this.delegateObject=null,this.defaultPrevented=!1,this.propagationStopped=!1,this.shape=null,this.fromShape=null,this.toShape=null,this.propagationPath=[],this.type=t,this.name=t,this.originalEvent=e,this.timeStamp=e.timeStamp}return r.prototype.preventDefault=function(){this.defaultPrevented=!0,this.originalEvent.preventDefault&&this.originalEvent.preventDefault()},r.prototype.stopPropagation=function(){this.propagationStopped=!0},r.prototype.toString=function(){var t=this.type;return"[Event (type="+t+")]"},r.prototype.save=function(){},r.prototype.restore=function(){},r}(),ist="*",fm=function(){function r(){this._events={}}return r.prototype.on=function(t,e,i){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!i}),this},r.prototype.once=function(t,e){return this.on(t,e,!0)},r.prototype.emit=function(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var a=this._events[t]||[],o=this._events[ist]||[],s=function(l){for(var u=l.length,c=0;c<u;c++)if(l[c]){var h=l[c],f=h.callback,d=h.once;d&&(l.splice(c,1),l.length===0&&delete e._events[t],u--,c--),f.apply(e,i)}};s(a),s(o)},r.prototype.off=function(t,e){if(!t)this._events={};else if(!e)delete this._events[t];else{for(var i=this._events[t]||[],n=i.length,a=0;a<n;a++)i[a].callback===e&&(i.splice(a,1),n--,a--);i.length===0&&delete this._events[t]}return this},r.prototype.getEvents=function(){return this._events},r}();function s5(r,t){var e=r.indexOf(t);e!==-1&&r.splice(e,1)}var EM=typeof window<"u"&&typeof window.document<"u";function l5(r,t){if(r.isCanvas())return!0;for(var e=t.getParent(),i=!1;e;){if(e===r){i=!0;break}e=e.getParent()}return i}function vx(r){return r.cfg.visible&&r.cfg.capture}var nst=function(r){gt(t,r);function t(e){var i=r.call(this)||this;i.destroyed=!1;var n=i.getDefaultCfg();return i.cfg=e5(n,e),i}return t.prototype.getDefaultCfg=function(){return{}},t.prototype.get=function(e){return this.cfg[e]},t.prototype.set=function(e,i){this.cfg[e]=i},t.prototype.destroy=function(){this.cfg={destroyed:!0},this.off(),this.destroyed=!0},t}(fm),SM=function(r,t,e){if(e||arguments.length===2)for(var i=0,n=t.length,a;i<n;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return r.concat(a||Array.prototype.slice.call(t))},ast=function(){function r(t,e,i){this.name=t,this.version=e,this.os=i,this.type="browser"}return r}(),ost=function(){function r(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return r}(),sst=function(){function r(t,e,i,n){this.name=t,this.version=e,this.os=i,this.bot=n,this.type="bot-device"}return r}(),lst=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),ust=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),cst=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,hst=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,AM=3,fst=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",cst]],TM=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function dst(r){return r?bM(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ust:typeof navigator<"u"?bM(navigator.userAgent):gst()}function vst(r){return r!==""&&fst.reduce(function(t,e){var i=e[0],n=e[1];if(t)return t;var a=n.exec(r);return!!a&&[i,a]},!1)}function bM(r){var t=vst(r);if(!t)return null;var e=t[0],i=t[1];if(e==="searchbot")return new lst;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<AM&&(n=SM(SM([],n,!0),mst(AM-n.length),!0)):n=[];var a=n.join("."),o=pst(r),s=hst.exec(r);return s&&s[1]?new sst(e,a,o,s[1]):new ast(e,a,o)}function pst(r){for(var t=0,e=TM.length;t<e;t++){var i=TM[t],n=i[0],a=i[1],o=a.exec(r);if(o)return n}return null}function gst(){var r=typeof process<"u"&&process.version;return r?new ost(process.version.slice(1)):null}function mst(r){for(var t=[],e=0;e<r;e++)t.push("0");return t}var Gg=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});function dm(r,t,e){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=e[0],d=e[1],v=e[2],p=e[3],g=e[4],m=e[5],y=e[6],_=e[7],x=e[8];return r[0]=f*i+d*o+v*u,r[1]=f*n+d*s+v*c,r[2]=f*a+d*l+v*h,r[3]=p*i+g*o+m*u,r[4]=p*n+g*s+m*c,r[5]=p*a+g*l+m*h,r[6]=y*i+_*o+x*u,r[7]=y*n+_*s+x*c,r[8]=y*a+_*l+x*h,r}function yst(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=t[0],r[7]=t[1],r[8]=1,r}function _st(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=i,r[1]=e,r[2]=0,r[3]=-e,r[4]=i,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function xst(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=t[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function Cst(){var r=new Gg(3);return Gg!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Est(r,t,e){var i=t[0],n=t[1],a=t[2];return r[0]=i*e[0]+n*e[3]+a*e[6],r[1]=i*e[1]+n*e[4]+a*e[7],r[2]=i*e[2]+n*e[5]+a*e[8],r}(function(){var r=Cst();return function(t,e,i,n,a,o){var s,l;for(e||(e=3),i||(i=0),n?l=Math.min(n*e+i,t.length):l=t.length,s=i;s<l;s+=e)r[0]=t[s],r[1]=t[s+1],r[2]=t[s+2],a(r,r,o),t[s]=r[0],t[s+1]=r[1],t[s+2]=r[2];return t}})();function Sst(){var r=new Gg(2);return Gg!=Float32Array&&(r[0]=0,r[1]=0),r}function Ast(r,t){var e=t[0],i=t[1],n=e*e+i*i;return n>0&&(n=1/Math.sqrt(n)),r[0]=t[0]*n,r[1]=t[1]*n,r}function Tst(r,t){return r[0]*t[0]+r[1]*t[1]}function bst(r,t){return r[0]===t[0]&&r[1]===t[1]}(function(){var r=Sst();return function(t,e,i,n,a,o){var s,l;for(e||(e=2),i||(i=0),n?l=Math.min(n*e+i,t.length):l=t.length,s=i;s<l;s+=e)r[0]=t[s],r[1]=t[s+1],a(r,r,o),t[s]=r[0],t[s+1]=r[1];return t}})();function wst(r,t,e){var i=[0,0,0,0,0,0,0,0,0];return yst(i,e),dm(r,i,t)}function Rst(r,t,e){var i=[0,0,0,0,0,0,0,0,0];return _st(i,e),dm(r,i,t)}function Mst(r,t,e){var i=[0,0,0,0,0,0,0,0,0];return xst(i,e),dm(r,i,t)}function Ist(r,t,e){return dm(r,e,t)}function u5(r,t){for(var e=r?[].concat(r):[1,0,0,0,1,0,0,0,1],i=0,n=t.length;i<n;i++){var a=t[i];switch(a[0]){case"t":wst(e,e,[a[1],a[2]]);break;case"s":Mst(e,e,[a[1],a[2]]);break;case"r":Rst(e,e,a[1]);break;case"m":Ist(e,e,a[1]);break}}return e}function wM(r,t){var e=[],i=r[0],n=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6],c=r[7],h=r[8],f=t[0],d=t[1],v=t[2],p=t[3],g=t[4],m=t[5],y=t[6],_=t[7],x=t[8];return e[0]=f*i+d*o+v*u,e[1]=f*n+d*s+v*c,e[2]=f*a+d*l+v*h,e[3]=p*i+g*o+m*u,e[4]=p*n+g*s+m*c,e[5]=p*a+g*l+m*h,e[6]=y*i+_*o+x*u,e[7]=y*n+_*s+x*c,e[8]=y*a+_*l+x*h,e}function Cl(r,t){var e=[],i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function c5(r){var t=[],e=r[0],i=r[1],n=r[2],a=r[3],o=r[4],s=r[5],l=r[6],u=r[7],c=r[8],h=c*o-s*u,f=-c*a+s*l,d=u*a-o*l,v=e*h+i*f+n*d;return v?(v=1/v,t[0]=h*v,t[1]=(-c*i+n*u)*v,t[2]=(s*i-n*o)*v,t[3]=f*v,t[4]=(c*e-n*l)*v,t[5]=(-s*e+n*a)*v,t[6]=d*v,t[7]=(-u*e+i*l)*v,t[8]=(o*e-i*a)*v,t):null}var Uh=u5,u_="matrix",Lst=["zIndex","capture","visible","type"],Ost=["repeat"],Pst=":",Fst="*";function Bst(r){for(var t=[],e=0;e<r.length;e++)Gn(r[e])?t.push([].concat(r[e])):t.push(r[e]);return t}function Dst(r,t){var e={},i=t.attrs;for(var n in r)e[n]=i[n];return e}function Nst(r,t){var e={},i=t.attr();return _e(r,function(n,a){Ost.indexOf(a)===-1&&!Vg(i[a],n)&&(e[a]=n)}),e}function kst(r,t){if(t.onFrame)return r;var e=t.startTime,i=t.delay,n=t.duration,a=Object.prototype.hasOwnProperty;return _e(r,function(o){e+i<o.startTime+o.delay+o.duration&&n>o.delay&&_e(t.toAttrs,function(s,l){a.call(o.toAttrs,l)&&(delete o.toAttrs[l],delete o.fromAttrs[l])})}),r}var h5=function(r){gt(t,r);function t(e){var i=r.call(this,e)||this;i.attrs={};var n=i.getDefaultAttrs();return e5(n,e.attrs),i.attrs=n,i.initAttrs(n),i.initAnimate(),i}return t.prototype.getDefaultCfg=function(){return{visible:!0,capture:!0,zIndex:0}},t.prototype.getDefaultAttrs=function(){return{matrix:this.getDefaultMatrix(),opacity:1}},t.prototype.onCanvasChange=function(e){},t.prototype.initAttrs=function(e){},t.prototype.initAnimate=function(){this.set("animable",!0),this.set("animating",!1)},t.prototype.isGroup=function(){return!1},t.prototype.getParent=function(){return this.get("parent")},t.prototype.getCanvas=function(){return this.get("canvas")},t.prototype.attr=function(){for(var e,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var a=i[0],o=i[1];if(!a)return this.attrs;if(Sf(a)){for(var s in a)this.setAttr(s,a[s]);return this.afterAttrsChange(a),this}return i.length===2?(this.setAttr(a,o),this.afterAttrsChange((e={},e[a]=o,e)),this):this.attrs[a]},t.prototype.isClipped=function(e,i){var n=this.getClip();return n&&!n.isHit(e,i)},t.prototype.setAttr=function(e,i){var n=this.attrs[e];n!==i&&(this.attrs[e]=i,this.onAttrChange(e,i,n))},t.prototype.onAttrChange=function(e,i,n){e==="matrix"&&this.set("totalMatrix",null)},t.prototype.afterAttrsChange=function(e){if(this.cfg.isClipShape){var i=this.cfg.applyTo;i&&i.onCanvasChange("clip")}else this.onCanvasChange("attr")},t.prototype.show=function(){return this.set("visible",!0),this.onCanvasChange("show"),this},t.prototype.hide=function(){return this.set("visible",!1),this.onCanvasChange("hide"),this},t.prototype.setZIndex=function(e){this.set("zIndex",e);var i=this.getParent();return i&&i.sort(),this},t.prototype.toFront=function(){var e=this.getParent();if(e){var i=e.getChildren();this.get("el");var n=i.indexOf(this);i.splice(n,1),i.push(this),this.onCanvasChange("zIndex")}},t.prototype.toBack=function(){var e=this.getParent();if(e){var i=e.getChildren();this.get("el");var n=i.indexOf(this);i.splice(n,1),i.unshift(this),this.onCanvasChange("zIndex")}},t.prototype.remove=function(e){e===void 0&&(e=!0);var i=this.getParent();i?(s5(i.getChildren(),this),i.get("clearing")||this.onCanvasChange("remove")):this.onCanvasChange("remove"),e&&this.destroy()},t.prototype.resetMatrix=function(){this.attr(u_,this.getDefaultMatrix()),this.onCanvasChange("matrix")},t.prototype.getMatrix=function(){return this.attr(u_)},t.prototype.setMatrix=function(e){this.attr(u_,e),this.onCanvasChange("matrix")},t.prototype.getTotalMatrix=function(){var e=this.cfg.totalMatrix;if(!e){var i=this.attr("matrix"),n=this.cfg.parentMatrix;n&&i?e=wM(n,i):e=i||n,this.set("totalMatrix",e)}return e},t.prototype.applyMatrix=function(e){var i=this.attr("matrix"),n=null;e&&i?n=wM(e,i):n=i||e,this.set("totalMatrix",n),this.set("parentMatrix",e)},t.prototype.getDefaultMatrix=function(){return null},t.prototype.applyToMatrix=function(e){var i=this.attr("matrix");return i?Cl(i,e):e},t.prototype.invertFromMatrix=function(e){var i=this.attr("matrix");if(i){var n=c5(i);if(n)return Cl(n,e)}return e},t.prototype.setClip=function(e){var i=this.getCanvas(),n=null;if(e){var a=this.getShapeBase(),o=t5(e.type),s=a[o];s&&(n=new s({type:e.type,isClipShape:!0,applyTo:this,attrs:e.attrs,canvas:i}))}return this.set("clipShape",n),this.onCanvasChange("clip"),n},t.prototype.getClip=function(){var e=this.cfg.clipShape;return e||null},t.prototype.clone=function(){var e=this,i=this.attrs,n={};_e(i,function(s,l){Gn(i[l])?n[l]=Bst(i[l]):n[l]=i[l]});var a=this.constructor,o=new a({attrs:n});return _e(Lst,function(s){o.set(s,e.get(s))}),o},t.prototype.destroy=function(){var e=this.destroyed;e||(this.attrs={},r.prototype.destroy.call(this))},t.prototype.isAnimatePaused=function(){return this.get("_pause").isPaused},t.prototype.animate=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(!(!this.get("timeline")&&!this.get("canvas"))){this.set("animating",!0);var n=this.get("timeline");n||(n=this.get("canvas").get("timeline"),this.set("timeline",n));var a=this.get("animations")||[];n.timer||n.initTimer();var o=e[0],s=e[1],l=e[2],u=l===void 0?"easeLinear":l,c=e[3],h=c===void 0?ip:c,f=e[4],d=f===void 0?0:f,v,p,g,m,y;Xl(o)?(v=o,o={}):Sf(o)&&o.onFrame&&(v=o.onFrame,p=o.repeat),Sf(s)?(y=s,s=y.duration,u=y.easing||"easeLinear",d=y.delay||0,p=y.repeat||p||!1,h=y.callback||ip,g=y.pauseCallback||ip,m=y.resumeCallback||ip):(lx(h)&&(d=h,h=null),Xl(u)?(h=u,u="easeLinear"):u=u||"easeLinear");var _=Nst(o,this),x={fromAttrs:Dst(_,this),toAttrs:_,duration:s,easing:u,repeat:p,callback:h,pauseCallback:g,resumeCallback:m,delay:d,startTime:n.getTime(),id:kot(),onFrame:v,pathFormatted:!1};a.length>0?a=kst(a,x):n.addAnimator(this),a.push(x),this.set("animations",a),this.set("_pause",{isPaused:!1})}},t.prototype.stopAnimate=function(e){var i=this;e===void 0&&(e=!0);var n=this.get("animations");_e(n,function(a){e&&(a.onFrame?i.attr(a.onFrame(1)):i.attr(a.toAttrs)),a.callback&&a.callback()}),this.set("animating",!1),this.set("animations",[])},t.prototype.pauseAnimate=function(){var e=this.get("timeline"),i=this.get("animations"),n=e.getTime();return _e(i,function(a){a._paused=!0,a._pauseTime=n,a.pauseCallback&&a.pauseCallback()}),this.set("_pause",{isPaused:!0,pauseTime:n}),this},t.prototype.resumeAnimate=function(){var e=this.get("timeline"),i=e.getTime(),n=this.get("animations"),a=this.get("_pause").pauseTime;return _e(n,function(o){o.startTime=o.startTime+(i-a),o._paused=!1,o._pauseTime=null,o.resumeCallback&&o.resumeCallback()}),this.set("_pause",{isPaused:!1}),this.set("animations",n),this},t.prototype.emitDelegation=function(e,i){var n=this,a=i.propagationPath;this.getEvents();var o;e==="mouseenter"?o=i.fromShape:e==="mouseleave"&&(o=i.toShape);for(var s=function(h){var f=a[h],d=f.get("name");if(d){if((f.isGroup()||f.isCanvas&&f.isCanvas())&&o&&l5(f,o))return"break";Gn(d)?_e(d,function(v){n.emitDelegateEvent(f,v,i)}):l.emitDelegateEvent(f,d,i)}},l=this,u=0;u<a.length;u++){var c=s(u);if(c==="break")break}},t.prototype.emitDelegateEvent=function(e,i,n){var a=this.getEvents(),o=i+Pst+n.type;(a[o]||a[Fst])&&(n.name=o,n.currentTarget=e,n.delegateTarget=this,n.delegateObject=e.get("delegateObject"),this.emit(o,n))},t.prototype.translate=function(e,i){e===void 0&&(e=0),i===void 0&&(i=0);var n=this.getMatrix(),a=Uh(n,[["t",e,i]]);return this.setMatrix(a),this},t.prototype.move=function(e,i){var n=this.attr("x")||0,a=this.attr("y")||0;return this.translate(e-n,i-a),this},t.prototype.moveTo=function(e,i){return this.move(e,i)},t.prototype.scale=function(e,i){var n=this.getMatrix(),a=Uh(n,[["s",e,i||e]]);return this.setMatrix(a),this},t.prototype.rotate=function(e){var i=this.getMatrix(),n=Uh(i,[["r",e]]);return this.setMatrix(n),this},t.prototype.rotateAtStart=function(e){var i=this.attr(),n=i.x,a=i.y,o=this.getMatrix(),s=Uh(o,[["t",-n,-a],["r",e],["t",n,a]]);return this.setMatrix(s),this},t.prototype.rotateAtPoint=function(e,i,n){var a=this.getMatrix(),o=Uh(a,[["t",-e,-i],["r",n],["t",e,i]]);return this.setMatrix(o),this},t}(nst),RM={},px="_INDEX";function f5(r,t){if(r.set("canvas",t),r.isGroup()){var e=r.get("children");e.length&&e.forEach(function(i){f5(i,t)})}}function d5(r,t){if(r.set("timeline",t),r.isGroup()){var e=r.get("children");e.length&&e.forEach(function(i){d5(i,t)})}}function Ust(r,t,e){e===void 0&&(e=!0),e?t.destroy():(t.set("parent",null),t.set("canvas",null)),s5(r.getChildren(),t)}function zst(r){return function(t,e){var i=r(t,e);return i===0?t[px]-e[px]:i}}var v5=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isCanvas=function(){return!1},t.prototype.getBBox=function(){var e=1/0,i=-1/0,n=1/0,a=-1/0,o=this.getChildren().filter(function(l){return l.get("visible")&&(!l.isGroup()||l.isGroup()&&l.getChildren().length>0)});o.length>0?_e(o,function(l){var u=l.getBBox(),c=u.minX,h=u.maxX,f=u.minY,d=u.maxY;c<e&&(e=c),h>i&&(i=h),f<n&&(n=f),d>a&&(a=d)}):(e=0,i=0,n=0,a=0);var s={x:e,y:n,minX:e,minY:n,maxX:i,maxY:a,width:i-e,height:a-n};return s},t.prototype.getCanvasBBox=function(){var e=1/0,i=-1/0,n=1/0,a=-1/0,o=this.getChildren().filter(function(l){return l.get("visible")&&(!l.isGroup()||l.isGroup()&&l.getChildren().length>0)});o.length>0?_e(o,function(l){var u=l.getCanvasBBox(),c=u.minX,h=u.maxX,f=u.minY,d=u.maxY;c<e&&(e=c),h>i&&(i=h),f<n&&(n=f),d>a&&(a=d)}):(e=0,i=0,n=0,a=0);var s={x:e,y:n,minX:e,minY:n,maxX:i,maxY:a,width:i-e,height:a-n};return s},t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return e.children=[],e},t.prototype.onAttrChange=function(e,i,n){if(r.prototype.onAttrChange.call(this,e,i,n),e==="matrix"){var a=this.getTotalMatrix();this._applyChildrenMarix(a)}},t.prototype.applyMatrix=function(e){var i=this.getTotalMatrix();r.prototype.applyMatrix.call(this,e);var n=this.getTotalMatrix();n!==i&&this._applyChildrenMarix(n)},t.prototype._applyChildrenMarix=function(e){var i=this.getChildren();_e(i,function(n){n.applyMatrix(e)})},t.prototype.addShape=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=e[0],a=e[1];Sf(n)?a=n:a.type=n;var o=RM[a.type];o||(o=t5(a.type),RM[a.type]=o);var s=this.getShapeBase(),l=new s[o](a);return this.add(l),l},t.prototype.addGroup=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=e[0],a=e[1],o;if(Xl(n))a?o=new n(a):o=new n({parent:this});else{var s=n||{},l=this.getGroupBase();o=new l(s)}return this.add(o),o},t.prototype.getCanvas=function(){var e;return this.isCanvas()?e=this:e=this.get("canvas"),e},t.prototype.getShape=function(e,i,n){if(!vx(this))return null;var a=this.getChildren(),o;if(this.isCanvas())o=this._findShape(a,e,i,n);else{var s=[e,i,1];s=this.invertFromMatrix(s),this.isClipped(s[0],s[1])||(o=this._findShape(a,s[0],s[1],n))}return o},t.prototype._findShape=function(e,i,n,a){for(var o=null,s=e.length-1;s>=0;s--){var l=e[s];if(vx(l)&&(l.isGroup()?o=l.getShape(i,n,a):l.isHit(i,n)&&(o=l)),o)break}return o},t.prototype.add=function(e){var i=this.getCanvas(),n=this.getChildren(),a=this.get("timeline"),o=e.getParent();o&&Ust(o,e,!1),e.set("parent",this),i&&f5(e,i),a&&d5(e,a),n.push(e),e.onCanvasChange("add"),this._applyElementMatrix(e)},t.prototype._applyElementMatrix=function(e){var i=this.getTotalMatrix();i&&e.applyMatrix(i)},t.prototype.getChildren=function(){return this.get("children")},t.prototype.sort=function(){var e=this.getChildren();_e(e,function(i,n){return i[px]=n,i}),e.sort(zst(function(i,n){return i.get("zIndex")-n.get("zIndex")})),this.onCanvasChange("sort")},t.prototype.clear=function(){if(this.set("clearing",!0),!this.destroyed){for(var e=this.getChildren(),i=e.length-1;i>=0;i--)e[i].destroy();this.set("children",[]),this.onCanvasChange("clear"),this.set("clearing",!1)}},t.prototype.destroy=function(){this.get("destroyed")||(this.clear(),r.prototype.destroy.call(this))},t.prototype.getFirst=function(){return this.getChildByIndex(0)},t.prototype.getLast=function(){var e=this.getChildren();return this.getChildByIndex(e.length-1)},t.prototype.getChildByIndex=function(e){var i=this.getChildren();return i[e]},t.prototype.getCount=function(){var e=this.getChildren();return e.length},t.prototype.contain=function(e){var i=this.getChildren();return i.indexOf(e)>-1},t.prototype.removeChild=function(e,i){i===void 0&&(i=!0),this.contain(e)&&e.remove(i)},t.prototype.findAll=function(e){var i=[],n=this.getChildren();return _e(n,function(a){e(a)&&i.push(a),a.isGroup()&&(i=i.concat(a.findAll(e)))}),i},t.prototype.find=function(e){var i=null,n=this.getChildren();return _e(n,function(a){if(e(a)?i=a:a.isGroup()&&(i=a.find(e)),i)return!1}),i},t.prototype.findById=function(e){return this.find(function(i){return i.get("id")===e})},t.prototype.findByClassName=function(e){return this.find(function(i){return i.get("className")===e})},t.prototype.findAllByName=function(e){return this.findAll(function(i){return i.get("name")===e})},t}(h5),Lc=0,of=0,zh=0,p5=1e3,Xg,sf,Yg=0,Yl=0,vm=0,jf=typeof performance=="object"&&performance.now?performance:Date,g5=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function m5(){return Yl||(g5(Hst),Yl=jf.now()+vm)}function Hst(){Yl=0}function gx(){this._call=this._time=this._next=null}gx.prototype=oS.prototype={constructor:gx,restart:function(r,t,e){if(typeof r!="function")throw new TypeError("callback is not a function");e=(e==null?m5():+e)+(t==null?0:+t),!this._next&&sf!==this&&(sf?sf._next=this:Xg=this,sf=this),this._call=r,this._time=e,mx()},stop:function(){this._call&&(this._call=null,this._time=1/0,mx())}};function oS(r,t,e){var i=new gx;return i.restart(r,t,e),i}function $st(){m5(),++Lc;for(var r=Xg,t;r;)(t=Yl-r._time)>=0&&r._call.call(null,t),r=r._next;--Lc}function MM(){Yl=(Yg=jf.now())+vm,Lc=of=0;try{$st()}finally{Lc=0,Vst(),Yl=0}}function Wst(){var r=jf.now(),t=r-Yg;t>p5&&(vm-=t,Yg=r)}function Vst(){for(var r,t=Xg,e,i=1/0;t;)t._call?(i>t._time&&(i=t._time),r=t,t=t._next):(e=t._next,t._next=null,t=r?r._next=e:Xg=e);sf=r,mx(i)}function mx(r){if(!Lc){of&&(of=clearTimeout(of));var t=r-Yl;t>24?(r<1/0&&(of=setTimeout(MM,r-jf.now()-vm)),zh&&(zh=clearInterval(zh))):(zh||(Yg=jf.now(),zh=setInterval(Wst,p5)),Lc=1,g5(MM))}}function sS(r,t,e){r.prototype=t.prototype=e,e.constructor=r}function y5(r,t){var e=Object.create(r.prototype);for(var i in t)e[i]=t[i];return e}function Xd(){}var Zf=.7,jg=1/Zf,sc="\\s*([+-]?\\d+)\\s*",qf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Xa="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Gst=/^#([0-9a-f]{3,8})$/,Xst=new RegExp(`^rgb\\(${sc},${sc},${sc}\\)$`),Yst=new RegExp(`^rgb\\(${Xa},${Xa},${Xa}\\)$`),jst=new RegExp(`^rgba\\(${sc},${sc},${sc},${qf}\\)$`),Zst=new RegExp(`^rgba\\(${Xa},${Xa},${Xa},${qf}\\)$`),qst=new RegExp(`^hsl\\(${qf},${Xa},${Xa}\\)$`),Kst=new RegExp(`^hsla\\(${qf},${Xa},${Xa},${qf}\\)$`),IM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};sS(Xd,Kf,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:LM,formatHex:LM,formatHex8:Qst,formatHsl:Jst,formatRgb:OM,toString:OM});function LM(){return this.rgb().formatHex()}function Qst(){return this.rgb().formatHex8()}function Jst(){return _5(this).formatHsl()}function OM(){return this.rgb().formatRgb()}function Kf(r){var t,e;return r=(r+"").trim().toLowerCase(),(t=Gst.exec(r))?(e=t[1].length,t=parseInt(t[1],16),e===6?PM(t):e===3?new Hi(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?sp(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?sp(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Xst.exec(r))?new Hi(t[1],t[2],t[3],1):(t=Yst.exec(r))?new Hi(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=jst.exec(r))?sp(t[1],t[2],t[3],t[4]):(t=Zst.exec(r))?sp(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=qst.exec(r))?DM(t[1],t[2]/100,t[3]/100,1):(t=Kst.exec(r))?DM(t[1],t[2]/100,t[3]/100,t[4]):IM.hasOwnProperty(r)?PM(IM[r]):r==="transparent"?new Hi(NaN,NaN,NaN,0):null}function PM(r){return new Hi(r>>16&255,r>>8&255,r&255,1)}function sp(r,t,e,i){return i<=0&&(r=t=e=NaN),new Hi(r,t,e,i)}function tlt(r){return r instanceof Xd||(r=Kf(r)),r?(r=r.rgb(),new Hi(r.r,r.g,r.b,r.opacity)):new Hi}function yx(r,t,e,i){return arguments.length===1?tlt(r):new Hi(r,t,e,i??1)}function Hi(r,t,e,i){this.r=+r,this.g=+t,this.b=+e,this.opacity=+i}sS(Hi,yx,y5(Xd,{brighter(r){return r=r==null?jg:Math.pow(jg,r),new Hi(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?Zf:Math.pow(Zf,r),new Hi(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new Hi(Ol(this.r),Ol(this.g),Ol(this.b),Zg(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:FM,formatHex:FM,formatHex8:elt,formatRgb:BM,toString:BM}));function FM(){return`#${El(this.r)}${El(this.g)}${El(this.b)}`}function elt(){return`#${El(this.r)}${El(this.g)}${El(this.b)}${El((isNaN(this.opacity)?1:this.opacity)*255)}`}function BM(){const r=Zg(this.opacity);return`${r===1?"rgb(":"rgba("}${Ol(this.r)}, ${Ol(this.g)}, ${Ol(this.b)}${r===1?")":`, ${r})`}`}function Zg(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function Ol(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function El(r){return r=Ol(r),(r<16?"0":"")+r.toString(16)}function DM(r,t,e,i){return i<=0?r=t=e=NaN:e<=0||e>=1?r=t=NaN:t<=0&&(r=NaN),new la(r,t,e,i)}function _5(r){if(r instanceof la)return new la(r.h,r.s,r.l,r.opacity);if(r instanceof Xd||(r=Kf(r)),!r)return new la;if(r instanceof la)return r;r=r.rgb();var t=r.r/255,e=r.g/255,i=r.b/255,n=Math.min(t,e,i),a=Math.max(t,e,i),o=NaN,s=a-n,l=(a+n)/2;return s?(t===a?o=(e-i)/s+(e<i)*6:e===a?o=(i-t)/s+2:o=(t-e)/s+4,s/=l<.5?a+n:2-a-n,o*=60):s=l>0&&l<1?0:o,new la(o,s,l,r.opacity)}function rlt(r,t,e,i){return arguments.length===1?_5(r):new la(r,t,e,i??1)}function la(r,t,e,i){this.h=+r,this.s=+t,this.l=+e,this.opacity=+i}sS(la,rlt,y5(Xd,{brighter(r){return r=r==null?jg:Math.pow(jg,r),new la(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?Zf:Math.pow(Zf,r),new la(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,t=isNaN(r)||isNaN(this.s)?0:this.s,e=this.l,i=e+(e<.5?e:1-e)*t,n=2*e-i;return new Hi(c_(r>=240?r-240:r+120,n,i),c_(r,n,i),c_(r<120?r+240:r-120,n,i),this.opacity)},clamp(){return new la(NM(this.h),lp(this.s),lp(this.l),Zg(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=Zg(this.opacity);return`${r===1?"hsl(":"hsla("}${NM(this.h)}, ${lp(this.s)*100}%, ${lp(this.l)*100}%${r===1?")":`, ${r})`}`}}));function NM(r){return r=(r||0)%360,r<0?r+360:r}function lp(r){return Math.max(0,Math.min(1,r||0))}function c_(r,t,e){return(r<60?t+(e-t)*r/60:r<180?e:r<240?t+(e-t)*(240-r)/60:t)*255}var lS=r=>()=>r;function ilt(r,t){return function(e){return r+e*t}}function nlt(r,t,e){return r=Math.pow(r,e),t=Math.pow(t,e)-r,e=1/e,function(i){return Math.pow(r+i*t,e)}}function alt(r){return(r=+r)==1?x5:function(t,e){return e-t?nlt(t,e,r):lS(isNaN(t)?e:t)}}function x5(r,t){var e=t-r;return e?ilt(r,e):lS(isNaN(r)?t:r)}var kM=function r(t){var e=alt(t);function i(n,a){var o=e((n=yx(n)).r,(a=yx(a)).r),s=e(n.g,a.g),l=e(n.b,a.b),u=x5(n.opacity,a.opacity);return function(c){return n.r=o(c),n.g=s(c),n.b=l(c),n.opacity=u(c),n+""}}return i.gamma=r,i}(1);function C5(r,t){t||(t=[]);var e=r?Math.min(t.length,r.length):0,i=t.slice(),n;return function(a){for(n=0;n<e;++n)i[n]=r[n]*(1-a)+t[n]*a;return i}}function E5(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function olt(r,t){return(E5(t)?C5:S5)(r,t)}function S5(r,t){var e=t?t.length:0,i=r?Math.min(e,r.length):0,n=new Array(i),a=new Array(e),o;for(o=0;o<i;++o)n[o]=qg(r[o],t[o]);for(;o<e;++o)a[o]=t[o];return function(s){for(o=0;o<i;++o)a[o]=n[o](s);return a}}function slt(r,t){var e=new Date;return r=+r,t=+t,function(i){return e.setTime(r*(1-i)+t*i),e}}function _x(r,t){return r=+r,t=+t,function(e){return r*(1-e)+t*e}}function llt(r,t){var e={},i={},n;(r===null||typeof r!="object")&&(r={}),(t===null||typeof t!="object")&&(t={});for(n in t)n in r?e[n]=qg(r[n],t[n]):i[n]=t[n];return function(a){for(n in e)i[n]=e[n](a);return i}}var xx=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,h_=new RegExp(xx.source,"g");function ult(r){return function(){return r}}function clt(r){return function(t){return r(t)+""}}function hlt(r,t){var e=xx.lastIndex=h_.lastIndex=0,i,n,a,o=-1,s=[],l=[];for(r=r+"",t=t+"";(i=xx.exec(r))&&(n=h_.exec(t));)(a=n.index)>e&&(a=t.slice(e,a),s[o]?s[o]+=a:s[++o]=a),(i=i[0])===(n=n[0])?s[o]?s[o]+=n:s[++o]=n:(s[++o]=null,l.push({i:o,x:_x(i,n)})),e=h_.lastIndex;return e<t.length&&(a=t.slice(e),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?clt(l[0].x):ult(t):(t=l.length,function(u){for(var c=0,h;c<t;++c)s[(h=l[c]).i]=h.x(u);return s.join("")})}function qg(r,t){var e=typeof t,i;return t==null||e==="boolean"?lS(t):(e==="number"?_x:e==="string"?(i=Kf(t))?(t=i,kM):hlt:t instanceof Kf?kM:t instanceof Date?slt:E5(t)?C5:Array.isArray(t)?S5:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?llt:_x)(r,t)}function flt(r){return+r}function dlt(r){return r*r}function vlt(r){return r*(2-r)}function UM(r){return((r*=2)<=1?r*r:--r*(2-r)+1)/2}function A5(r){return r*r*r}function plt(r){return--r*r*r+1}function zM(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var uS=3,glt=function r(t){t=+t;function e(i){return Math.pow(i,t)}return e.exponent=r,e}(uS),mlt=function r(t){t=+t;function e(i){return 1-Math.pow(1-i,t)}return e.exponent=r,e}(uS),HM=function r(t){t=+t;function e(i){return((i*=2)<=1?Math.pow(i,t):2-Math.pow(2-i,t))/2}return e.exponent=r,e}(uS),T5=Math.PI,b5=T5/2;function ylt(r){return+r==1?1:1-Math.cos(r*b5)}function _lt(r){return Math.sin(r*b5)}function $M(r){return(1-Math.cos(T5*r))/2}function Os(r){return(Math.pow(2,-10*r)-.0009765625)*1.0009775171065494}function xlt(r){return Os(1-+r)}function Clt(r){return 1-Os(r)}function WM(r){return((r*=2)<=1?Os(1-r):2-Os(r-1))/2}function Elt(r){return 1-Math.sqrt(1-r*r)}function Slt(r){return Math.sqrt(1- --r*r)}function VM(r){return((r*=2)<=1?1-Math.sqrt(1-r*r):Math.sqrt(1-(r-=2)*r)+1)/2}var Cx=4/11,Alt=6/11,Tlt=8/11,blt=3/4,wlt=9/11,Rlt=10/11,Mlt=15/16,Ilt=21/22,Llt=63/64,up=1/Cx/Cx;function Olt(r){return 1-Qf(1-r)}function Qf(r){return(r=+r)<Cx?up*r*r:r<Tlt?up*(r-=Alt)*r+blt:r<Rlt?up*(r-=wlt)*r+Mlt:up*(r-=Ilt)*r+Llt}function Plt(r){return((r*=2)<=1?1-Qf(1-r):Qf(r-1)+1)/2}var cS=1.70158,Flt=function r(t){t=+t;function e(i){return(i=+i)*i*(t*(i-1)+i)}return e.overshoot=r,e}(cS),Blt=function r(t){t=+t;function e(i){return--i*i*((i+1)*t+i)+1}return e.overshoot=r,e}(cS),GM=function r(t){t=+t;function e(i){return((i*=2)<1?i*i*((t+1)*i-t):(i-=2)*i*((t+1)*i+t)+2)/2}return e.overshoot=r,e}(cS),Oc=2*Math.PI,hS=1,fS=.3,Dlt=function r(t,e){var i=Math.asin(1/(t=Math.max(1,t)))*(e/=Oc);function n(a){return t*Os(- --a)*Math.sin((i-a)/e)}return n.amplitude=function(a){return r(a,e*Oc)},n.period=function(a){return r(t,a)},n}(hS,fS),XM=function r(t,e){var i=Math.asin(1/(t=Math.max(1,t)))*(e/=Oc);function n(a){return 1-t*Os(a=+a)*Math.sin((a+i)/e)}return n.amplitude=function(a){return r(a,e*Oc)},n.period=function(a){return r(t,a)},n}(hS,fS),Nlt=function r(t,e){var i=Math.asin(1/(t=Math.max(1,t)))*(e/=Oc);function n(a){return((a=a*2-1)<0?t*Os(-a)*Math.sin((i-a)/e):2-t*Os(a)*Math.sin((i+a)/e))/2}return n.amplitude=function(a){return r(a,e*Oc)},n.period=function(a){return r(t,a)},n}(hS,fS),klt=Object.freeze({__proto__:null,easeLinear:flt,easeQuad:UM,easeQuadIn:dlt,easeQuadOut:vlt,easeQuadInOut:UM,easeCubic:zM,easeCubicIn:A5,easeCubicOut:plt,easeCubicInOut:zM,easePoly:HM,easePolyIn:glt,easePolyOut:mlt,easePolyInOut:HM,easeSin:$M,easeSinIn:ylt,easeSinOut:_lt,easeSinInOut:$M,easeExp:WM,easeExpIn:xlt,easeExpOut:Clt,easeExpInOut:WM,easeCircle:VM,easeCircleIn:Elt,easeCircleOut:Slt,easeCircleInOut:VM,easeBounce:Qf,easeBounceIn:Olt,easeBounceOut:Qf,easeBounceInOut:Plt,easeBack:GM,easeBackIn:Flt,easeBackOut:Blt,easeBackInOut:GM,easeElastic:XM,easeElasticIn:Dlt,easeElasticOut:XM,easeElasticInOut:Nlt}),Ult={};function zlt(r){return Ult[r.toLowerCase()]||klt[r]}var Hlt=function(r){return["fill","stroke","fillStyle","strokeStyle"].includes(r)},$lt=function(r){return/^[r,R,L,l]{1}[\s]*\(/.test(r)},YM=[1,0,0,0,1,0,0,0,1];function Wlt(r,t,e){var i={},n=t.fromAttrs,a=t.toAttrs;if(!r.destroyed){var o;for(var s in a)if(!Vg(n[s],a[s]))if(s==="path"){var l=a[s],u=n[s];l.length>u.length?(l=ju(a[s]),u=ju(n[s]),u=a5(u,l),u=dx(u,l),t.fromAttrs.path=u,t.toAttrs.path=l):t.pathFormatted||(l=ju(a[s]),u=ju(n[s]),u=dx(u,l),t.fromAttrs.path=u,t.toAttrs.path=l,t.pathFormatted=!0),i[s]=[];for(var c=0;c<l.length;c++){for(var h=l[c],f=u[c],d=[],v=0;v<h.length;v++)lx(h[v])&&f&&lx(f[v])?(o=qg(f[v],h[v]),d.push(o(e))):d.push(h[v]);i[s].push(d)}}else if(s==="matrix"){var p=olt(n[s]||YM,a[s]||YM),g=p(e);i[s]=g}else Hlt(s)&&$lt(a[s])?i[s]=a[s]:Xl(a[s])||(o=qg(n[s],a[s]),i[s]=o(e));r.attr(i)}}function Vlt(r,t,e){var i=t.startTime,n=t.delay;if(e<i+n||t._paused)return!1;var a,o=t.duration,s=t.easing,l=zlt(s);if(e=e-i-t.delay,t.repeat)a=e%o/o,a=l(a);else if(a=e/o,a<1)a=l(a);else return t.onFrame?r.attr(t.onFrame(1)):r.attr(t.toAttrs),!0;if(t.onFrame){var u=t.onFrame(a);r.attr(u)}else Wlt(r,t,a);return!1}var Glt=function(){function r(t){this.animators=[],this.current=0,this.timer=null,this.canvas=t}return r.prototype.initTimer=function(){var t=this,e=!1,i,n,a;this.timer=oS(function(o){if(t.current=o,t.animators.length>0){for(var s=t.animators.length-1;s>=0;s--){if(i=t.animators[s],i.destroyed){t.removeAnimator(s);continue}if(!i.isAnimatePaused()){n=i.get("animations");for(var l=n.length-1;l>=0;l--)a=n[l],e=Vlt(i,a,o),e&&(n.splice(l,1),e=!1,a.callback&&a.callback())}n.length===0&&t.removeAnimator(s)}var u=t.canvas.get("autoDraw");u||t.canvas.draw()}})},r.prototype.addAnimator=function(t){this.animators.push(t)},r.prototype.removeAnimator=function(t){this.animators.splice(t,1)},r.prototype.isAnimating=function(){return!!this.animators.length},r.prototype.stop=function(){this.timer&&this.timer.stop()},r.prototype.stopAllAnimations=function(t){t===void 0&&(t=!0),this.animators.forEach(function(e){e.stopAnimate(t)}),this.animators=[],this.canvas.draw()},r.prototype.getTime=function(){return this.current},r}(),Xlt=40,jM=0,ZM=["mousedown","mouseup","dblclick","mouseout","mouseover","mousemove","mouseleave","mouseenter","touchstart","touchmove","touchend","dragenter","dragover","dragleave","drop","contextmenu","mousewheel"];function qM(r,t,e){e.name=t,e.target=r,e.currentTarget=r,e.delegateTarget=r,r.emit(t,e)}function Ylt(r,t,e){if(e.bubbles){var i=void 0,n=!1;if(t==="mouseenter"?(i=e.fromShape,n=!0):t==="mouseleave"&&(n=!0,i=e.toShape),r.isCanvas()&&n)return;if(i&&l5(r,i)){e.bubbles=!1;return}e.name=t,e.currentTarget=r,e.delegateTarget=r,r.emit(t,e)}}var jlt=function(){function r(t){var e=this;this.draggingShape=null,this.dragging=!1,this.currentShape=null,this.mousedownShape=null,this.mousedownPoint=null,this._eventCallback=function(i){var n=i.type;e._triggerEvent(n,i)},this._onDocumentMove=function(i){var n=e.canvas,a=n.get("el");if(a!==i.target&&(e.dragging||e.currentShape)){var o=e._getPointInfo(i);e.dragging&&e._emitEvent("drag",i,o,e.draggingShape)}},this._onDocumentMouseUp=function(i){var n=e.canvas,a=n.get("el");if(a!==i.target&&e.dragging){var o=e._getPointInfo(i);e.draggingShape&&e._emitEvent("drop",i,o,null),e._emitEvent("dragend",i,o,e.draggingShape),e._afterDrag(e.draggingShape,o,i)}},this.canvas=t.canvas}return r.prototype.init=function(){this._bindEvents()},r.prototype._bindEvents=function(){var t=this,e=this.canvas.get("el");_e(ZM,function(i){e.addEventListener(i,t._eventCallback)}),document&&(document.addEventListener("mousemove",this._onDocumentMove),document.addEventListener("mouseup",this._onDocumentMouseUp))},r.prototype._clearEvents=function(){var t=this,e=this.canvas.get("el");_e(ZM,function(i){e.removeEventListener(i,t._eventCallback)}),document&&(document.removeEventListener("mousemove",this._onDocumentMove),document.removeEventListener("mouseup",this._onDocumentMouseUp))},r.prototype._getEventObj=function(t,e,i,n,a,o){var s=new rst(t,e);return s.fromShape=a,s.toShape=o,s.x=i.x,s.y=i.y,s.clientX=i.clientX,s.clientY=i.clientY,s.propagationPath.push(n),s},r.prototype._getShape=function(t,e){return this.canvas.getShape(t.x,t.y,e)},r.prototype._getPointInfo=function(t){var e=this.canvas,i=e.getClientByEvent(t),n=e.getPointByEvent(t);return{x:n.x,y:n.y,clientX:i.x,clientY:i.y}},r.prototype._triggerEvent=function(t,e){var i=this._getPointInfo(e),n=this._getShape(i,e),a=this["_on"+t],o=!1;if(a)a.call(this,i,n,e);else{var s=this.currentShape;t==="mouseenter"||t==="dragenter"||t==="mouseover"?(this._emitEvent(t,e,i,null,null,n),n&&this._emitEvent(t,e,i,n,null,n),t==="mouseenter"&&this.draggingShape&&this._emitEvent("dragenter",e,i,null)):t==="mouseleave"||t==="dragleave"||t==="mouseout"?(o=!0,s&&this._emitEvent(t,e,i,s,s,null),this._emitEvent(t,e,i,null,s,null),t==="mouseleave"&&this.draggingShape&&this._emitEvent("dragleave",e,i,null)):this._emitEvent(t,e,i,n,null,null)}if(o||(this.currentShape=n),n&&!n.get("destroyed")){var l=this.canvas,u=l.get("el");u.style.cursor=n.attr("cursor")||l.get("cursor")}},r.prototype._onmousedown=function(t,e,i){i.button===jM&&(this.mousedownShape=e,this.mousedownPoint=t,this.mousedownTimeStamp=i.timeStamp),this._emitEvent("mousedown",i,t,e,null,null)},r.prototype._emitMouseoverEvents=function(t,e,i,n){var a=this.canvas.get("el");i!==n&&(i&&(this._emitEvent("mouseout",t,e,i,i,n),this._emitEvent("mouseleave",t,e,i,i,n),(!n||n.get("destroyed"))&&(a.style.cursor=this.canvas.get("cursor"))),n&&(this._emitEvent("mouseover",t,e,n,i,n),this._emitEvent("mouseenter",t,e,n,i,n)))},r.prototype._emitDragoverEvents=function(t,e,i,n,a){n?(n!==i&&(i&&this._emitEvent("dragleave",t,e,i,i,n),this._emitEvent("dragenter",t,e,n,i,n)),a||this._emitEvent("dragover",t,e,n)):i&&this._emitEvent("dragleave",t,e,i,i,n),a&&this._emitEvent("dragover",t,e,n)},r.prototype._afterDrag=function(t,e,i){t&&(t.set("capture",!0),this.draggingShape=null),this.dragging=!1;var n=this._getShape(e,i);n!==t&&this._emitMouseoverEvents(i,e,t,n),this.currentShape=n},r.prototype._onmouseup=function(t,e,i){if(i.button===jM){var n=this.draggingShape;this.dragging?(n&&this._emitEvent("drop",i,t,e),this._emitEvent("dragend",i,t,n),this._afterDrag(n,t,i)):(this._emitEvent("mouseup",i,t,e),e===this.mousedownShape&&this._emitEvent("click",i,t,e),this.mousedownShape=null,this.mousedownPoint=null)}},r.prototype._ondragover=function(t,e,i){i.preventDefault();var n=this.currentShape;this._emitDragoverEvents(i,t,n,e,!0)},r.prototype._onmousemove=function(t,e,i){var n=this.canvas,a=this.currentShape,o=this.draggingShape;if(this.dragging)o&&this._emitDragoverEvents(i,t,a,e,!1),this._emitEvent("drag",i,t,o);else{var s=this.mousedownPoint;if(s){var l=this.mousedownShape,u=i.timeStamp,c=u-this.mousedownTimeStamp,h=s.clientX-t.clientX,f=s.clientY-t.clientY,d=h*h+f*f;c>120||d>Xlt?l&&l.get("draggable")?(o=this.mousedownShape,o.set("capture",!1),this.draggingShape=o,this.dragging=!0,this._emitEvent("dragstart",i,t,o),this.mousedownShape=null,this.mousedownPoint=null):!l&&n.get("draggable")?(this.dragging=!0,this._emitEvent("dragstart",i,t,null),this.mousedownShape=null,this.mousedownPoint=null):(this._emitMouseoverEvents(i,t,a,e),this._emitEvent("mousemove",i,t,e)):(this._emitMouseoverEvents(i,t,a,e),this._emitEvent("mousemove",i,t,e))}else this._emitMouseoverEvents(i,t,a,e),this._emitEvent("mousemove",i,t,e)}},r.prototype._emitEvent=function(t,e,i,n,a,o){var s=this._getEventObj(t,e,i,n,a,o);if(n){s.shape=n,qM(n,t,s);for(var l=n.getParent();l;)l.emitDelegation(t,s),s.propagationStopped||Ylt(l,t,s),s.propagationPath.push(l),l=l.getParent()}else{var u=this.canvas;qM(u,t,s)}},r.prototype.destroy=function(){this._clearEvents(),this.canvas=null,this.currentShape=null,this.draggingShape=null,this.mousedownPoint=null,this.mousedownShape=null,this.mousedownTimeStamp=null},r}(),KM="px",QM=dst(),Zlt=QM&&QM.name==="firefox",qlt=function(r){gt(t,r);function t(e){var i=r.call(this,e)||this;return i.initContainer(),i.initDom(),i.initEvents(),i.initTimeline(),i}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return e.cursor="default",e.supportCSSTransform=!1,e},t.prototype.initContainer=function(){var e=this.get("container");Ca(e)&&(e=document.getElementById(e),this.set("container",e))},t.prototype.initDom=function(){var e=this.createDom();this.set("el",e);var i=this.get("container");i.appendChild(e),this.setDOMSize(this.get("width"),this.get("height"))},t.prototype.initEvents=function(){var e=new jlt({canvas:this});e.init(),this.set("eventController",e)},t.prototype.initTimeline=function(){var e=new Glt(this);this.set("timeline",e)},t.prototype.setDOMSize=function(e,i){var n=this.get("el");EM&&(n.style.width=e+KM,n.style.height=i+KM)},t.prototype.changeSize=function(e,i){this.setDOMSize(e,i),this.set("width",e),this.set("height",i),this.onCanvasChange("changeSize")},t.prototype.getRenderer=function(){return this.get("renderer")},t.prototype.getCursor=function(){return this.get("cursor")},t.prototype.setCursor=function(e){this.set("cursor",e);var i=this.get("el");EM&&i&&(i.style.cursor=e)},t.prototype.getPointByEvent=function(e){var i=this.get("supportCSSTransform");if(i){if(Zlt&&!br(e.layerX)&&e.layerX!==e.offsetX)return{x:e.layerX,y:e.layerY};if(!br(e.offsetX))return{x:e.offsetX,y:e.offsetY}}var n=this.getClientByEvent(e),a=n.x,o=n.y;return this.getPointByClient(a,o)},t.prototype.getClientByEvent=function(e){var i=e;return e.touches&&(e.type==="touchend"?i=e.changedTouches[0]:i=e.touches[0]),{x:i.clientX,y:i.clientY}},t.prototype.getPointByClient=function(e,i){var n=this.get("el"),a=n.getBoundingClientRect();return{x:e-a.left,y:i-a.top}},t.prototype.getClientByPoint=function(e,i){var n=this.get("el"),a=n.getBoundingClientRect();return{x:e+a.left,y:i+a.top}},t.prototype.draw=function(){},t.prototype.removeDom=function(){var e=this.get("el");e.parentNode.removeChild(e)},t.prototype.clearEvents=function(){var e=this.get("eventController");e.destroy()},t.prototype.isCanvas=function(){return!0},t.prototype.getParent=function(){return null},t.prototype.destroy=function(){var e=this.get("timeline");this.get("destroyed")||(this.clear(),e&&e.stop(),this.clearEvents(),this.removeDom(),r.prototype.destroy.call(this))},t}(v5),Klt=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isGroup=function(){return!0},t.prototype.isEntityGroup=function(){return!1},t.prototype.clone=function(){for(var e=r.prototype.clone.call(this),i=this.getChildren(),n=0;n<i.length;n++){var a=i[n];e.add(a.clone())}return e},t}(v5),Qlt=function(r){gt(t,r);function t(e){return r.call(this,e)||this}return t.prototype._isInBBox=function(e,i){var n=this.getBBox();return n.minX<=e&&n.maxX>=e&&n.minY<=i&&n.maxY>=i},t.prototype.afterAttrsChange=function(e){r.prototype.afterAttrsChange.call(this,e),this.clearCacheBBox()},t.prototype.getBBox=function(){var e=this.cfg.bbox;return e||(e=this.calculateBBox(),this.set("bbox",e)),e},t.prototype.getCanvasBBox=function(){var e=this.cfg.canvasBBox;return e||(e=this.calculateCanvasBBox(),this.set("canvasBBox",e)),e},t.prototype.applyMatrix=function(e){r.prototype.applyMatrix.call(this,e),this.set("canvasBBox",null)},t.prototype.calculateCanvasBBox=function(){var e=this.getBBox(),i=this.getTotalMatrix(),n=e.minX,a=e.minY,o=e.maxX,s=e.maxY;if(i){var l=Cl(i,[e.minX,e.minY]),u=Cl(i,[e.maxX,e.minY]),c=Cl(i,[e.minX,e.maxY]),h=Cl(i,[e.maxX,e.maxY]);n=Math.min(l[0],u[0],c[0],h[0]),o=Math.max(l[0],u[0],c[0],h[0]),a=Math.min(l[1],u[1],c[1],h[1]),s=Math.max(l[1],u[1],c[1],h[1])}var f=this.attrs;if(f.shadowColor){var d=f.shadowBlur,v=d===void 0?0:d,p=f.shadowOffsetX,g=p===void 0?0:p,m=f.shadowOffsetY,y=m===void 0?0:m,_=n-v+g,x=o+v+g,C=a-v+y,A=s+v+y;n=Math.min(n,_),o=Math.max(o,x),a=Math.min(a,C),s=Math.max(s,A)}return{x:n,y:a,minX:n,minY:a,maxX:o,maxY:s,width:o-n,height:s-a}},t.prototype.clearCacheBBox=function(){this.set("bbox",null),this.set("canvasBBox",null)},t.prototype.isClipShape=function(){return this.get("isClipShape")},t.prototype.isInShape=function(e,i){return!1},t.prototype.isOnlyHitBox=function(){return!1},t.prototype.isHit=function(e,i){var n=this.get("startArrowShape"),a=this.get("endArrowShape"),o=[e,i,1];o=this.invertFromMatrix(o);var s=o[0],l=o[1],u=this._isInBBox(s,l);return this.isOnlyHitBox()?u:!!(u&&!this.isClipped(s,l)&&(this.isInShape(s,l)||n&&n.isHit(s,l)||a&&a.isHit(s,l)))},t}(h5),w5=new Map;function io(r,t){w5.set(r,t)}function Jlt(r){return w5.get(r)}function R5(r){var t=r.attr(),e=t.x,i=t.y,n=t.width,a=t.height;return{x:e,y:i,width:n,height:a}}function M5(r){var t=r.attr(),e=t.x,i=t.y,n=t.r;return{x:e-n,y:i-n,width:n*2,height:n*2}}function li(r,t,e,i){var n=r-e,a=t-i;return Math.sqrt(n*n+a*a)}function tg(r,t){return Math.abs(r-t)<.001}function eh(r,t){var e=Ls(r),i=Ls(t),n=Is(r),a=Is(t);return{x:e,y:i,width:n-e,height:a-i}}function pm(r){return(r+Math.PI*2)%(Math.PI*2)}var Ui={box:function(r,t,e,i){return eh([r,e],[t,i])},length:function(r,t,e,i){return li(r,t,e,i)},pointAt:function(r,t,e,i,n){return{x:(1-n)*r+n*e,y:(1-n)*t+n*i}},pointDistance:function(r,t,e,i,n,a){var o=(e-r)*(n-r)+(i-t)*(a-t);if(o<0)return li(r,t,n,a);var s=(e-r)*(e-r)+(i-t)*(i-t);return o>s?li(e,i,n,a):this.pointToLine(r,t,e,i,n,a)},pointToLine:function(r,t,e,i,n,a){var o=[e-r,i-t];if(bst(o,[0,0]))return Math.sqrt((n-r)*(n-r)+(a-t)*(a-t));var s=[-o[1],o[0]];Ast(s,s);var l=[n-r,a-t];return Math.abs(Tst(l,s))},tangentAngle:function(r,t,e,i){return Math.atan2(i-t,e-r)}},tut=1e-4;function I5(r,t,e,i,n,a){var o,s=1/0,l=[e,i],u=20;a&&a>200&&(u=a/10);for(var c=1/u,h=c/10,f=0;f<=u;f++){var d=f*c,v=[n.apply(null,r.concat([d])),n.apply(null,t.concat([d]))],p=li(l[0],l[1],v[0],v[1]);p<s&&(o=d,s=p)}if(o===0)return{x:r[0],y:t[0]};if(o===1){var g=r.length;return{x:r[g-1],y:t[g-1]}}s=1/0;for(var f=0;f<32&&!(h<tut);f++){var m=o-h,y=o+h,v=[n.apply(null,r.concat([m])),n.apply(null,t.concat([m]))],p=li(l[0],l[1],v[0],v[1]);if(m>=0&&p<s)o=m,s=p;else{var _=[n.apply(null,r.concat([y])),n.apply(null,t.concat([y]))],x=li(l[0],l[1],_[0],_[1]);y<=1&&x<s?(o=y,s=x):h*=.5}}return{x:n.apply(null,r.concat([o])),y:n.apply(null,t.concat([o]))}}function eut(r,t){for(var e=0,i=r.length,n=0;n<i;n++){var a=r[n],o=t[n],s=r[(n+1)%i],l=t[(n+1)%i];e+=li(a,o,s,l)}return e/2}function cs(r,t,e,i){var n=1-i;return n*n*r+2*i*n*t+i*i*e}function JM(r,t,e){var i=r+e-2*t;if(tg(i,0))return[.5];var n=(r-t)/i;return n<=1&&n>=0?[n]:[]}function t3(r,t,e,i){return 2*(1-i)*(t-r)+2*i*(e-t)}function L5(r,t,e,i,n,a,o){var s=cs(r,e,n,o),l=cs(t,i,a,o),u=Ui.pointAt(r,t,e,i,o),c=Ui.pointAt(e,i,n,a,o);return[[r,t,u.x,u.y,s,l],[s,l,c.x,c.y,n,a]]}function Ex(r,t,e,i,n,a,o){if(o===0)return(li(r,t,e,i)+li(e,i,n,a)+li(r,t,n,a))/2;var s=L5(r,t,e,i,n,a,.5),l=s[0],u=s[1];return l.push(o-1),u.push(o-1),Ex.apply(null,l)+Ex.apply(null,u)}var O5={box:function(r,t,e,i,n,a){var o=JM(r,e,n)[0],s=JM(t,i,a)[0],l=[r,n],u=[t,a];return o!==void 0&&l.push(cs(r,e,n,o)),s!==void 0&&u.push(cs(t,i,a,s)),eh(l,u)},length:function(r,t,e,i,n,a){return Ex(r,t,e,i,n,a,3)},nearestPoint:function(r,t,e,i,n,a,o,s){return I5([r,e,n],[t,i,a],o,s,cs)},pointDistance:function(r,t,e,i,n,a,o,s){var l=this.nearestPoint(r,t,e,i,n,a,o,s);return li(l.x,l.y,o,s)},interpolationAt:cs,pointAt:function(r,t,e,i,n,a,o){return{x:cs(r,e,n,o),y:cs(t,i,a,o)}},divide:function(r,t,e,i,n,a,o){return L5(r,t,e,i,n,a,o)},tangentAngle:function(r,t,e,i,n,a,o){var s=t3(r,e,n,o),l=t3(t,i,a,o),u=Math.atan2(l,s);return pm(u)}};function hs(r,t,e,i,n){var a=1-n;return a*a*a*r+3*t*n*a*a+3*e*n*n*a+i*n*n*n}function e3(r,t,e,i,n){var a=1-n;return 3*(a*a*(t-r)+2*a*n*(e-t)+n*n*(i-e))}function f_(r,t,e,i){var n=-3*r+9*t-9*e+3*i,a=6*r-12*t+6*e,o=3*t-3*r,s=[],l,u,c;if(tg(n,0))tg(a,0)||(l=-o/a,l>=0&&l<=1&&s.push(l));else{var h=a*a-4*n*o;tg(h,0)?s.push(-a/(2*n)):h>0&&(c=Math.sqrt(h),l=(-a+c)/(2*n),u=(-a-c)/(2*n),l>=0&&l<=1&&s.push(l),u>=0&&u<=1&&s.push(u))}return s}function P5(r,t,e,i,n,a,o,s,l){var u=hs(r,e,n,o,l),c=hs(t,i,a,s,l),h=Ui.pointAt(r,t,e,i,l),f=Ui.pointAt(e,i,n,a,l),d=Ui.pointAt(n,a,o,s,l),v=Ui.pointAt(h.x,h.y,f.x,f.y,l),p=Ui.pointAt(f.x,f.y,d.x,d.y,l);return[[r,t,h.x,h.y,v.x,v.y,u,c],[u,c,p.x,p.y,d.x,d.y,o,s]]}function Sx(r,t,e,i,n,a,o,s,l){if(l===0)return eut([r,e,n,o],[t,i,a,s]);var u=P5(r,t,e,i,n,a,o,s,.5),c=u[0],h=u[1];return c.push(l-1),h.push(l-1),Sx.apply(null,c)+Sx.apply(null,h)}var Tf={extrema:f_,box:function(r,t,e,i,n,a,o,s){for(var l=[r,o],u=[t,s],c=f_(r,e,n,o),h=f_(t,i,a,s),f=0;f<c.length;f++)l.push(hs(r,e,n,o,c[f]));for(var f=0;f<h.length;f++)u.push(hs(t,i,a,s,h[f]));return eh(l,u)},length:function(r,t,e,i,n,a,o,s){return Sx(r,t,e,i,n,a,o,s,3)},nearestPoint:function(r,t,e,i,n,a,o,s,l,u,c){return I5([r,e,n,o],[t,i,a,s],l,u,hs,c)},pointDistance:function(r,t,e,i,n,a,o,s,l,u,c){var h=this.nearestPoint(r,t,e,i,n,a,o,s,l,u,c);return li(h.x,h.y,l,u)},interpolationAt:hs,pointAt:function(r,t,e,i,n,a,o,s,l){return{x:hs(r,e,n,o,l),y:hs(t,i,a,s,l)}},divide:function(r,t,e,i,n,a,o,s,l){return P5(r,t,e,i,n,a,o,s,l)},tangentAngle:function(r,t,e,i,n,a,o,s,l){var u=e3(r,e,n,o,l),c=e3(t,i,a,s,l);return pm(Math.atan2(c,u))}};function r3(r,t){var e=Math.abs(r);return t>0?e:e*-1}var rut={box:function(r,t,e,i){return{x:r-e,y:t-i,width:e*2,height:i*2}},length:function(r,t,e,i){return Math.PI*(3*(e+i)-Math.sqrt((3*e+i)*(e+3*i)))},nearestPoint:function(r,t,e,i,n,a){var o=e,s=i;if(o===0||s===0)return{x:r,y:t};for(var l=n-r,u=a-t,c=Math.abs(l),h=Math.abs(u),f=o*o,d=s*s,v=Math.PI/4,p,g,m=0;m<4;m++){p=o*Math.cos(v),g=s*Math.sin(v);var y=(f-d)*Math.pow(Math.cos(v),3)/o,_=(d-f)*Math.pow(Math.sin(v),3)/s,x=p-y,C=g-_,A=c-y,T=h-_,w=Math.hypot(C,x),M=Math.hypot(T,A),O=w*Math.asin((x*T-C*A)/(w*M)),P=O/Math.sqrt(f+d-p*p-g*g);v+=P,v=Math.min(Math.PI/2,Math.max(0,v))}return{x:r+r3(p,l),y:t+r3(g,u)}},pointDistance:function(r,t,e,i,n,a){var o=this.nearestPoint(r,t,e,i,n,a);return li(o.x,o.y,n,a)},pointAt:function(r,t,e,i,n){var a=2*Math.PI*n;return{x:r+e*Math.cos(a),y:t+i*Math.sin(a)}},tangentAngle:function(r,t,e,i,n){var a=2*Math.PI*n,o=Math.atan2(i*Math.cos(a),-e*Math.sin(a));return pm(o)}};function iut(r,t,e,i,n,a,o,s){return-1*e*Math.cos(n)*Math.sin(s)-i*Math.sin(n)*Math.cos(s)}function nut(r,t,e,i,n,a,o,s){return-1*e*Math.sin(n)*Math.sin(s)+i*Math.cos(n)*Math.cos(s)}function aut(r,t,e){return Math.atan(-t/r*Math.tan(e))}function out(r,t,e){return Math.atan(t/(r*Math.tan(e)))}function i3(r,t,e,i,n,a){return e*Math.cos(n)*Math.cos(a)-i*Math.sin(n)*Math.sin(a)+r}function n3(r,t,e,i,n,a){return e*Math.sin(n)*Math.cos(a)+i*Math.cos(n)*Math.sin(a)+t}function sut(r,t,e,i){var n=Math.atan2(i*r,e*t);return(n+Math.PI*2)%(Math.PI*2)}function a3(r,t,e){return{x:r*Math.cos(e),y:t*Math.sin(e)}}function o3(r,t,e){var i=Math.cos(e),n=Math.sin(e);return[r*i-t*n,r*n+t*i]}var lut={box:function(r,t,e,i,n,a,o){for(var s=aut(e,i,n),l=1/0,u=-1/0,c=[a,o],h=-Math.PI*2;h<=Math.PI*2;h+=Math.PI){var f=s+h;a<o?a<f&&f<o&&c.push(f):o<f&&f<a&&c.push(f)}for(var h=0;h<c.length;h++){var d=i3(r,t,e,i,n,c[h]);d<l&&(l=d),d>u&&(u=d)}for(var v=out(e,i,n),p=1/0,g=-1/0,m=[a,o],h=-Math.PI*2;h<=Math.PI*2;h+=Math.PI){var y=v+h;a<o?a<y&&y<o&&m.push(y):o<y&&y<a&&m.push(y)}for(var h=0;h<m.length;h++){var _=n3(r,t,e,i,n,m[h]);_<p&&(p=_),_>g&&(g=_)}return{x:l,y:p,width:u-l,height:g-p}},length:function(r,t,e,i,n,a,o){},nearestPoint:function(r,t,e,i,n,a,o,s,l){var u=o3(s-r,l-t,-n),c=u[0],h=u[1],f=rut.nearestPoint(0,0,e,i,c,h),d=sut(e,i,f.x,f.y);d<a?f=a3(e,i,a):d>o&&(f=a3(e,i,o));var v=o3(f.x,f.y,n);return{x:v[0]+r,y:v[1]+t}},pointDistance:function(r,t,e,i,n,a,o,s,l){var u=this.nearestPoint(r,t,e,i,s,l);return li(u.x,u.y,s,l)},pointAt:function(r,t,e,i,n,a,o,s){var l=(o-a)*s+a;return{x:i3(r,t,e,i,n,l),y:n3(r,t,e,i,n,l)}},tangentAngle:function(r,t,e,i,n,a,o,s){var l=(o-a)*s+a,u=iut(r,t,e,i,n,a,o,l),c=nut(r,t,e,i,n,a,o,l);return pm(Math.atan2(c,u))}};function F5(r){for(var t=0,e=[],i=0;i<r.length-1;i++){var n=r[i],a=r[i+1],o=li(n[0],n[1],a[0],a[1]),s={from:n,to:a,length:o};e.push(s),t+=o}return{segments:e,totalLength:t}}function uut(r){if(r.length<2)return 0;for(var t=0,e=0;e<r.length-1;e++){var i=r[e],n=r[e+1];t+=li(i[0],i[1],n[0],n[1])}return t}function cut(r,t){if(t>1||t<0||r.length<2)return null;var e=F5(r),i=e.segments,n=e.totalLength;if(n===0)return{x:r[0][0],y:r[0][1]};for(var a=0,o=null,s=0;s<i.length;s++){var l=i[s],u=l.from,c=l.to,h=l.length/n;if(t>=a&&t<=a+h){var f=(t-a)/h;o=Ui.pointAt(u[0],u[1],c[0],c[1],f);break}a+=h}return o}function hut(r,t){if(t>1||t<0||r.length<2)return 0;for(var e=F5(r),i=e.segments,n=e.totalLength,a=0,o=0,s=0;s<i.length;s++){var l=i[s],u=l.from,c=l.to,h=l.length/n;if(t>=a&&t<=a+h){o=Math.atan2(c[1]-u[1],c[0]-u[0]);break}a+=h}return o}function fut(r,t,e){for(var i=1/0,n=0;n<r.length-1;n++){var a=r[n],o=r[n+1],s=Ui.pointDistance(a[0],a[1],o[0],o[1],t,e);s<i&&(i=s)}return i}var dut={box:function(r){for(var t=[],e=[],i=0;i<r.length;i++){var n=r[i];t.push(n[0]),e.push(n[1])}return eh(t,e)},length:function(r){return uut(r)},pointAt:function(r,t){return cut(r,t)},pointDistance:function(r,t,e){return fut(r,t,e)},tangentAngle:function(r,t){return hut(r,t)}};function s3(r,t){return!r||!t?r||t:{minX:Math.min(r.minX,t.minX),minY:Math.min(r.minY,t.minY),maxX:Math.max(r.maxX,t.maxX),maxY:Math.max(r.maxY,t.maxY)}}function dS(r,t){var e=r.get("startArrowShape"),i=r.get("endArrowShape"),n=null,a=null;return e&&(n=e.getCanvasBBox(),t=s3(t,n)),i&&(a=i.getCanvasBBox(),t=s3(t,a)),t}function vut(r){for(var t=r.attr(),e=t.points,i=[],n=[],a=0;a<e.length;a++){var o=e[a];i.push(o[0]),n.push(o[1])}var s=eh(i,n),l=s.x,u=s.y,c=s.width,h=s.height,f={minX:l,minY:u,maxX:l+c,maxY:u+h};return f=dS(r,f),{x:f.minX,y:f.minY,width:f.maxX-f.minX,height:f.maxY-f.minY}}function put(r){for(var t=r.attr(),e=t.points,i=[],n=[],a=0;a<e.length;a++){var o=e[a];i.push(o[0]),n.push(o[1])}return eh(i,n)}var d_=null;function B5(){if(!d_){var r=document.createElement("canvas");r.width=1,r.height=1,d_=r.getContext("2d")}return d_}function D5(r,t,e){var i=1;if(Ca(r)&&(i=r.split(`
`).length),i>1){var n=gut(t,e);return t*i+n*(i-1)}return t}function gut(r,t){return t?t-r:r*.14}function mut(r,t){var e=B5(),i=0;if(br(r)||r==="")return i;if(e.save(),e.font=t,Ca(r)&&r.includes(`
`)){var n=r.split(`
`);_e(n,function(a){var o=e.measureText(a).width;i<o&&(i=o)})}else i=e.measureText(r).width;return e.restore(),i}function N5(r){var t=r.fontSize,e=r.fontFamily,i=r.fontWeight,n=r.fontStyle,a=r.fontVariant;return[n,a,i,t+"px",e].join(" ").trim()}function yut(r){var t=r.attr(),e=t.x,i=t.y,n=t.text,a=t.fontSize,o=t.lineHeight,s=t.font;s||(s=N5(t));var l=mut(n,s),u;if(!l)u={x:e,y:i,width:0,height:0};else{var c=t.textAlign,h=t.textBaseline,f=D5(n,a,o),d={x:e,y:i-f};c&&(c==="end"||c==="right"?d.x-=l:c==="center"&&(d.x-=l/2)),h&&(h==="top"?d.y+=f:h==="middle"&&(d.y+=f/2)),u={x:d.x,y:d.y,width:l,height:f}}return u}var _ut=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/ig,xut=/[^\s\,]+/ig;function Cut(r){var t=r||[];if(Gn(t))return t;if(Ca(t))return t=t.match(_ut),_e(t,function(e,i){if(e=e.match(xut),e[0].length>1){var n=e[0].charAt(0);e.splice(1,0,e[0].substr(1)),e[0]=n}_e(e,function(a,o){isNaN(a)||(e[o]=+a)}),t[i]=e}),t}var bf=`	
\v\f\r   ᠎             　\u2028\u2029`,Eut=new RegExp("([a-z])["+bf+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+bf+"]*,?["+bf+"]*)+)","ig"),Sut=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+bf+"]*,?["+bf+"]*","ig");function Aut(r){if(!r)return null;if(Gn(r))return r;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(r).replace(Eut,function(i,n,a){var o=[],s=n.toLowerCase();if(a.replace(Sut,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(e.push([n].concat(o.splice(0,2))),s="l",n=n==="m"?"l":"L"),s==="o"&&o.length===1&&e.push([n,o[0]]),s==="r")e.push([n].concat(o));else for(;o.length>=t[s]&&(e.push([n].concat(o.splice(0,t[s]))),!!t[s]););return""}),e}var Tut=/[a-z]/;function l3(r,t){return[t[0]+(t[0]-r[0]),t[1]+(t[1]-r[1])]}function k5(r){var t=Aut(r);if(!t||!t.length)return[["M",0,0]];for(var e=!1,i=0;i<t.length;i++){var n=t[i][0];if(Tut.test(n)||["V","H","T","S"].indexOf(n)>=0){e=!0;break}}if(!e)return t;var a=[],o=0,s=0,l=0,u=0,c=0,h=t[0];(h[0]==="M"||h[0]==="m")&&(o=+h[1],s=+h[2],l=o,u=s,c++,a[0]=["M",o,s]);for(var i=c,f=t.length;i<f;i++){var d=t[i],v=a[i-1],p=[],n=d[0],g=n.toUpperCase();if(n!==g)switch(p[0]=g,g){case"A":p[1]=d[1],p[2]=d[2],p[3]=d[3],p[4]=d[4],p[5]=d[5],p[6]=+d[6]+o,p[7]=+d[7]+s;break;case"V":p[1]=+d[1]+s;break;case"H":p[1]=+d[1]+o;break;case"M":l=+d[1]+o,u=+d[2]+s,p[1]=l,p[2]=u;break;default:for(var m=1,y=d.length;m<y;m++)p[m]=+d[m]+(m%2?o:s)}else p=t[i];switch(g){case"Z":o=+l,s=+u;break;case"H":o=p[1],p=["L",o,s];break;case"V":s=p[1],p=["L",o,s];break;case"T":o=p[1],s=p[2];var _=l3([v[1],v[2]],[v[3],v[4]]);p=["Q",_[0],_[1],o,s];break;case"S":o=p[p.length-2],s=p[p.length-1];var x=v.length,C=l3([v[x-4],v[x-3]],[v[x-2],v[x-1]]);p=["C",C[0],C[1],p[1],p[2],o,s];break;case"M":l=p[p.length-2],u=p[p.length-1];break;default:o=p[p.length-2],s=p[p.length-1]}a.push(p)}return a}function cp(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Ax(r,t){return cp(r)*cp(t)?(r[0]*t[0]+r[1]*t[1])/(cp(r)*cp(t)):1}function u3(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(Ax(r,t))}function Tx(r,t){return r[0]===t[0]&&r[1]===t[1]}function but(r,t){var e=t[1],i=t[2],n=QD(JD(t[3]),Math.PI*2),a=t[4],o=t[5],s=r[0],l=r[1],u=t[6],c=t[7],h=Math.cos(n)*(s-u)/2+Math.sin(n)*(l-c)/2,f=-1*Math.sin(n)*(s-u)/2+Math.cos(n)*(l-c)/2,d=h*h/(e*e)+f*f/(i*i);d>1&&(e*=Math.sqrt(d),i*=Math.sqrt(d));var v=e*e*(f*f)+i*i*(h*h),p=v?Math.sqrt((e*e*(i*i)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=i?p*e*f/i:0,m=e?p*-i*h/e:0,y=(s+u)/2+Math.cos(n)*g-Math.sin(n)*m,_=(l+c)/2+Math.sin(n)*g+Math.cos(n)*m,x=[(h-g)/e,(f-m)/i],C=[(-1*h-g)/e,(-1*f-m)/i],A=u3([1,0],x),T=u3(x,C);return Ax(x,C)<=-1&&(T=Math.PI),Ax(x,C)>=1&&(T=0),o===0&&T>0&&(T=T-2*Math.PI),o===1&&T<0&&(T=T+2*Math.PI),{cx:y,cy:_,rx:Tx(r,[u,c])?0:e,ry:Tx(r,[u,c])?0:i,startAngle:A,endAngle:A+T,xRotation:n,arcFlag:a,sweepFlag:o}}function c3(r,t){return[t[0]+(t[0]-r[0]),t[1]+(t[1]-r[1])]}function U5(r){r=Cut(r);for(var t=[],e=null,i=null,n=null,a=0,o=r.length,s=0;s<o;s++){var l=r[s];i=r[s+1];var u=l[0],c={command:u,prePoint:e,params:l,startTangent:null,endTangent:null};switch(u){case"M":n=[l[1],l[2]],a=s;break;case"A":var h=but(e,l);c.arcParams=h;break}if(u==="Z")e=n,i=r[a+1];else{var f=l.length;e=[l[f-2],l[f-1]]}i&&i[0]==="Z"&&(i=r[a],t[a]&&(t[a].prePoint=e)),c.currentPoint=e,t[a]&&Tx(e,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var d=i?[i[i.length-2],i[i.length-1]]:null;c.nextPoint=d;var v=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[v[0]-e[0],v[1]-e[1]],c.endTangent=[e[0]-v[0],e[1]-v[1]];else if(u==="Q"){var p=[l[1],l[2]];c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[e[0]-p[0],e[1]-p[1]]}else if(u==="T"){var g=t[s-1],p=c3(g.currentPoint,v);g.command==="Q"?(c.command="Q",c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[e[0]-p[0],e[1]-p[1]]):(c.command="TL",c.startTangent=[v[0]-e[0],v[1]-e[1]],c.endTangent=[e[0]-v[0],e[1]-v[1]])}else if(u==="C"){var m=[l[1],l[2]],y=[l[3],l[4]];c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]],c.startTangent[0]===0&&c.startTangent[1]===0&&(c.startTangent=[m[0]-y[0],m[1]-y[1]]),c.endTangent[0]===0&&c.endTangent[1]===0&&(c.endTangent=[y[0]-m[0],y[1]-m[1]])}else if(u==="S"){var g=t[s-1],m=c3(g.currentPoint,v),y=[l[1],l[2]];g.command==="C"?(c.command="C",c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]]):(c.command="SQ",c.startTangent=[v[0]-y[0],v[1]-y[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]])}else if(u==="A"){var _=.001,x=c.arcParams||{},C=x.cx,A=C===void 0?0:C,T=x.cy,w=T===void 0?0:T,M=x.rx,O=M===void 0?0:M,P=x.ry,D=P===void 0?0:P,z=x.sweepFlag,Y=z===void 0?0:z,H=x.startAngle,N=H===void 0?0:H,W=x.endAngle,Q=W===void 0?0:W;Y===0&&(_*=-1);var q=O*Math.cos(N-_)+A,J=D*Math.sin(N-_)+w;c.startTangent=[q-n[0],J-n[1]];var et=O*Math.cos(N+Q+_)+A,ft=D*Math.sin(N+Q-_)+w;c.endTangent=[v[0]-et,v[1]-ft]}t.push(c)}return t}function wut(r,t){for(var e=[],i=[],n=[],a=0;a<r.length;a++){var o=r[a],s=o.currentPoint,l=o.params,u=o.prePoint,c=void 0;switch(o.command){case"Q":c=O5.box(u[0],u[1],l[1],l[2],l[3],l[4]);break;case"C":c=Tf.box(u[0],u[1],l[1],l[2],l[3],l[4],l[5],l[6]);break;case"A":var h=o.arcParams;c=lut.box(h.cx,h.cy,h.rx,h.ry,h.xRotation,h.startAngle,h.endAngle);break;default:e.push(s[0]),i.push(s[1]);break}c&&(o.box=c,e.push(c.x,c.x+c.width),i.push(c.y,c.y+c.height)),t&&(o.command==="L"||o.command==="M")&&o.prePoint&&o.nextPoint&&n.push(o)}e=e.filter(function(m){return!Number.isNaN(m)&&m!==1/0&&m!==-1/0}),i=i.filter(function(m){return!Number.isNaN(m)&&m!==1/0&&m!==-1/0});var f=Ls(e),d=Ls(i),v=Is(e),p=Is(i);if(n.length===0)return{x:f,y:d,width:v-f,height:p-d};for(var a=0;a<n.length;a++){var o=n[a],s=o.currentPoint,g=void 0;s[0]===f?(g=hp(o,t),f=f-g.xExtra):s[0]===v&&(g=hp(o,t),v=v+g.xExtra),s[1]===d?(g=hp(o,t),d=d-g.yExtra):s[1]===p&&(g=hp(o,t),p=p+g.yExtra)}return{x:f,y:d,width:v-f,height:p-d}}function hp(r,t){var e=r.prePoint,i=r.currentPoint,n=r.nextPoint,a=Math.pow(i[0]-e[0],2)+Math.pow(i[1]-e[1],2),o=Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2),s=Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2),l=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!l||Math.sin(l)===0||Lot(l,0))return{xExtra:0,yExtra:0};var u=Math.abs(Math.atan2(n[1]-i[1],n[0]-i[0])),c=Math.abs(Math.atan2(n[0]-i[0],n[1]-i[1]));u=u>Math.PI/2?Math.PI-u:u,c=c>Math.PI/2?Math.PI-c:c;var h={xExtra:Math.cos(l/2-u)*(t/2*(1/Math.sin(l/2)))-t/2||0,yExtra:Math.cos(c-l/2)*(t/2*(1/Math.sin(l/2)))-t/2||0};return h}function Rut(r){var t=r.attr(),e=t.path,i=t.stroke,n=i?t.lineWidth:0,a=r.get("segments")||U5(e),o=wut(a,n),s=o.x,l=o.y,u=o.width,c=o.height,h={minX:s,minY:l,maxX:s+u,maxY:l+c};return h=dS(r,h),{x:h.minX,y:h.minY,width:h.maxX-h.minX,height:h.maxY-h.minY}}function Mut(r){var t=r.attr(),e=t.x1,i=t.y1,n=t.x2,a=t.y2,o=Math.min(e,n),s=Math.max(e,n),l=Math.min(i,a),u=Math.max(i,a),c={minX:o,maxX:s,minY:l,maxY:u};return c=dS(r,c),{x:c.minX,y:c.minY,width:c.maxX-c.minX,height:c.maxY-c.minY}}function Iut(r){var t=r.attr(),e=t.x,i=t.y,n=t.rx,a=t.ry;return{x:e-n,y:i-a,width:n*2,height:a*2}}io("rect",R5);io("image",R5);io("circle",M5);io("marker",M5);io("polyline",vut);io("polygon",put);io("text",yut);io("path",Rut);io("line",Mut);io("ellipse",Iut);function Lut(){return window?window.devicePixelRatio:1}function z5(r,t,e,i){var n=r-e,a=t-i;return Math.sqrt(n*n+a*a)}function Sl(r,t,e,i,n,a){return n>=r&&n<=r+e&&a>=t&&a<=t+i}function Jf(r,t){return!(t.minX>r.maxX||t.maxX<r.minX||t.minY>r.maxY||t.maxY<r.minY)}function Out(r,t){return!r||!t?r||t:{minX:Math.min(r.minX,t.minX),minY:Math.min(r.minY,t.minY),maxX:Math.max(r.maxX,t.maxX),maxY:Math.max(r.maxY,t.maxY)}}function h3(r,t){return r[0]===t[0]&&r[1]===t[1]}var Put=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,Fut=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,But=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,H5=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function $5(r,t){var e=r.match(H5);_e(e,function(i){var n=i.split(":");t.addColorStop(n[0],n[1])})}function Dut(r,t,e){var i=Put.exec(e),n=parseFloat(i[1])%360*(Math.PI/180),a=i[2],o=t.getBBox(),s,l;n>=0&&n<1/2*Math.PI?(s={x:o.minX,y:o.minY},l={x:o.maxX,y:o.maxY}):1/2*Math.PI<=n&&n<Math.PI?(s={x:o.maxX,y:o.minY},l={x:o.minX,y:o.maxY}):Math.PI<=n&&n<3/2*Math.PI?(s={x:o.maxX,y:o.maxY},l={x:o.minX,y:o.minY}):(s={x:o.minX,y:o.maxY},l={x:o.maxX,y:o.minY});var u=Math.tan(n),c=u*u,h=(l.x-s.x+u*(l.y-s.y))/(c+1)+s.x,f=u*(l.x-s.x+u*(l.y-s.y))/(c+1)+s.y,d=r.createLinearGradient(s.x,s.y,h,f);return $5(a,d),d}function Nut(r,t,e){var i=Fut.exec(e),n=parseFloat(i[1]),a=parseFloat(i[2]),o=parseFloat(i[3]),s=i[4];if(o===0){var l=s.match(H5);return l[l.length-1].split(":")[1]}var u=t.getBBox(),c=u.maxX-u.minX,h=u.maxY-u.minY,f=Math.sqrt(c*c+h*h)/2,d=r.createRadialGradient(u.minX+c*n,u.minY+h*a,0,u.minX+c/2,u.minY+h/2,o*f);return $5(s,d),d}function kut(r,t,e){if(t.get("patternSource")&&t.get("patternSource")===e)return t.get("pattern");var i,n,a=But.exec(e),o=a[1],s=a[2];function l(){i=r.createPattern(n,o),t.set("pattern",i),t.set("patternSource",e)}switch(o){case"a":o="repeat";break;case"x":o="repeat-x";break;case"y":o="repeat-y";break;case"n":o="no-repeat";break;default:o="no-repeat"}return n=new Image,s.match(/^data:/i)||(n.crossOrigin="Anonymous"),n.src=s,n.complete?l():(n.onload=l,n.src=n.src),i}function Uut(r,t,e){var i=t.getBBox();if(isNaN(i.x)||isNaN(i.y)||isNaN(i.width)||isNaN(i.height))return e;if(Ca(e)){if(e[1]==="("||e[2]==="("){if(e[0]==="l")return Dut(r,t,e);if(e[0]==="r")return Nut(r,t,e);if(e[0]==="p")return kut(r,t,e)}return e}if(e instanceof CanvasPattern)return e}function zut(r){var t=0,e=0,i=0,n=0;return Gn(r)?r.length===1?t=e=i=n=r[0]:r.length===2?(t=i=r[0],e=n=r[1]):r.length===3?(t=r[0],e=n=r[1],i=r[2]):(t=r[0],e=r[1],i=r[2],n=r[3]):t=e=i=n=r,[t,e,i,n]}function fp(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function bx(r,t){return fp(r)*fp(t)?(r[0]*t[0]+r[1]*t[1])/(fp(r)*fp(t)):1}function f3(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(bx(r,t))}function d3(r,t){var e=t[1],i=t[2],n=QD(JD(t[3]),Math.PI*2),a=t[4],o=t[5],s=r[0],l=r[1],u=t[6],c=t[7],h=Math.cos(n)*(s-u)/2+Math.sin(n)*(l-c)/2,f=-1*Math.sin(n)*(s-u)/2+Math.cos(n)*(l-c)/2,d=h*h/(e*e)+f*f/(i*i);d>1&&(e*=Math.sqrt(d),i*=Math.sqrt(d));var v=e*e*(f*f)+i*i*(h*h),p=v?Math.sqrt((e*e*(i*i)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=i?p*e*f/i:0,m=e?p*-i*h/e:0,y=(s+u)/2+Math.cos(n)*g-Math.sin(n)*m,_=(l+c)/2+Math.sin(n)*g+Math.cos(n)*m,x=[(h-g)/e,(f-m)/i],C=[(-1*h-g)/e,(-1*f-m)/i],A=f3([1,0],x),T=f3(x,C);return bx(x,C)<=-1&&(T=Math.PI),bx(x,C)>=1&&(T=0),o===0&&T>0&&(T=T-2*Math.PI),o===1&&T<0&&(T=T+2*Math.PI),{cx:y,cy:_,rx:h3(r,[u,c])?0:e,ry:h3(r,[u,c])?0:i,startAngle:A,endAngle:A+T,xRotation:n,arcFlag:a,sweepFlag:o}}var Kg=Math.sin,Qg=Math.cos,vS=Math.atan2,dp=Math.PI;function W5(r,t,e,i,n,a,o){var s=t.stroke,l=t.lineWidth,u=e-n,c=i-a,h=vS(c,u),f=new _S({type:"path",canvas:r.get("canvas"),isArrowShape:!0,attrs:{path:"M"+10*Qg(dp/6)+","+10*Kg(dp/6)+" L0,0 L"+10*Qg(dp/6)+",-"+10*Kg(dp/6),stroke:s,lineWidth:l}});f.translate(n,a),f.rotateAtPoint(n,a,h),r.set(o?"startArrowShape":"endArrowShape",f)}function V5(r,t,e,i,n,a,o){var s=t.startArrow,l=t.endArrow,u=t.stroke,c=t.lineWidth,h=o?s:l,f=h.d,d=h.fill,v=h.stroke,p=h.lineWidth,g=cm(h,["d","fill","stroke","lineWidth"]),m=e-n,y=i-a,_=vS(y,m);f&&(n=n-Qg(_)*f,a=a-Kg(_)*f);var x=new _S({type:"path",canvas:r.get("canvas"),isArrowShape:!0,attrs:k(k({},g),{stroke:v||u,lineWidth:p||c,fill:d})});x.translate(n,a),x.rotateAtPoint(n,a,_),r.set(o?"startArrowShape":"endArrowShape",x)}function Pl(r,t,e,i,n){var a=vS(i-t,e-r);return{dx:Qg(a)*n,dy:Kg(a)*n}}function pS(r,t,e,i,n,a){typeof t.startArrow=="object"?V5(r,t,e,i,n,a,!0):t.startArrow?W5(r,t,e,i,n,a,!0):r.set("startArrowShape",null)}function gS(r,t,e,i,n,a){typeof t.endArrow=="object"?V5(r,t,e,i,n,a,!1):t.endArrow?W5(r,t,e,i,n,a,!1):r.set("startArrowShape",null)}var v3={fill:"fillStyle",stroke:"strokeStyle",opacity:"globalAlpha"};function Pc(r,t){var e=t.attr();for(var i in e){var n=e[i],a=v3[i]?v3[i]:i;a==="matrix"&&n?r.transform(n[0],n[1],n[3],n[4],n[6],n[7]):a==="lineDash"&&r.setLineDash?Gn(n)&&r.setLineDash(n):(a==="strokeStyle"||a==="fillStyle"?n=Uut(r,t,n):a==="globalAlpha"&&(n=n*r.globalAlpha),r[a]=n)}}function Rx(r,t,e){for(var i=0;i<t.length;i++){var n=t[i];n.cfg.visible?n.draw(r,e):n.skipDraw()}}function Hut(r,t,e){var i=r.get("refreshElements");_e(i,function(n){if(n!==r)for(var a=n.cfg.parent;a&&a!==r&&!a.cfg.refresh;)a.cfg.refresh=!0,a=a.cfg.parent}),i[0]===r?mS(t):Mx(t,e)}function Mx(r,t){for(var e=0;e<r.length;e++){var i=r[e];if(i.cfg.visible)if(i.cfg.hasChanged)i.cfg.refresh=!0,i.isGroup()&&mS(i.cfg.children);else if(i.cfg.refresh)i.isGroup()&&Mx(i.cfg.children,t);else{var n=$ut(i,t);i.cfg.refresh=n,n&&i.isGroup()&&Mx(i.cfg.children,t)}}}function G5(r){for(var t=0;t<r.length;t++){var e=r[t];e.cfg.hasChanged=!1,e.isGroup()&&!e.destroyed&&G5(e.cfg.children)}}function mS(r,t){for(var e=0;e<r.length;e++){var i=r[e];i.cfg.visible&&(i.cfg.refresh=!0,i.isGroup()&&mS(i.get("children")))}}function $ut(r,t){var e=r.cfg.cacheCanvasBBox,i=r.cfg.isInView&&e&&Jf(e,t);return i}function X5(r,t,e,i){var n=e.path,a=e.startArrow,o=e.endArrow;if(n){var s=[0,0],l=[0,0],u={dx:0,dy:0};t.beginPath();for(var c=0;c<n.length;c++){var h=n[c],f=h[0];if(c===0&&a&&a.d){var d=r.getStartTangent();u=Pl(d[0][0],d[0][1],d[1][0],d[1][1],a.d)}else if(c===n.length-2&&n[c+1][0]==="Z"&&o&&o.d){var v=n[c+1];if(v[0]==="Z"){var d=r.getEndTangent();u=Pl(d[0][0],d[0][1],d[1][0],d[1][1],o.d)}}else if(c===n.length-1&&o&&o.d&&n[0]!=="Z"){var d=r.getEndTangent();u=Pl(d[0][0],d[0][1],d[1][0],d[1][1],o.d)}var p=u.dx,g=u.dy;switch(f){case"M":t.moveTo(h[1]-p,h[2]-g),l=[h[1],h[2]];break;case"L":t.lineTo(h[1]-p,h[2]-g);break;case"Q":t.quadraticCurveTo(h[1],h[2],h[3]-p,h[4]-g);break;case"C":t.bezierCurveTo(h[1],h[2],h[3],h[4],h[5]-p,h[6]-g);break;case"A":{var m=void 0;i?(m=i[c],m||(m=d3(s,h),i[c]=m)):m=d3(s,h);var y=m.cx,_=m.cy,x=m.rx,C=m.ry,A=m.startAngle,T=m.endAngle,w=m.xRotation,M=m.sweepFlag;if(t.ellipse)t.ellipse(y,_,x,C,w,A,T,1-M);else{var O=x>C?x:C,P=x>C?1:x/C,D=x>C?C/x:1;t.translate(y,_),t.rotate(w),t.scale(P,D),t.arc(0,0,O,A,T,1-M),t.scale(1/P,1/D),t.rotate(-w),t.translate(-y,-_)}break}case"Z":t.closePath();break}if(f==="Z")s=l;else{var z=h.length;s=[h[z-2],h[z-1]]}}}}function Y5(r,t){var e=r.get("canvas");e&&(t==="remove"&&(r._cacheCanvasBBox=r.get("cacheCanvasBBox")),r.get("hasChanged")||(r.set("hasChanged",!0),r.cfg.parent&&r.cfg.parent.get("hasChanged")||(e.refreshElement(r,t,e),e.get("autoDraw")&&e.draw())))}function Wut(r){var t;if(r.destroyed)t=r._cacheCanvasBBox;else{var e=r.get("cacheCanvasBBox"),i=e&&!!(e.width&&e.height),n=r.getCanvasBBox(),a=n&&!!(n.width&&n.height);i&&a?t=Out(e,n):i?t=e:a&&(t=n)}return t}function Vut(r){if(!r.length)return null;var t=[],e=[],i=[],n=[];return _e(r,function(a){var o=Wut(a);o&&(t.push(o.minX),e.push(o.minY),i.push(o.maxX),n.push(o.maxY))}),{minX:Ls(t),minY:Ls(e),maxX:Is(i),maxY:Is(n)}}function Gut(r,t){return!r||!t||!Jf(r,t)?null:{minX:Math.max(r.minX,t.minX),minY:Math.max(r.minY,t.minY),maxX:Math.min(r.maxX,t.maxX),maxY:Math.min(r.maxY,t.maxY)}}var no=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.onCanvasChange=function(e){Y5(this,e)},t.prototype.getShapeBase=function(){return aS},t.prototype.getGroupBase=function(){return t},t.prototype._applyClip=function(e,i){i&&(e.save(),Pc(e,i),i.createPath(e),e.restore(),e.clip(),i._afterDraw())},t.prototype.cacheCanvasBBox=function(){var e=this.cfg.children,i=[],n=[];_e(e,function(f){var d=f.cfg.cacheCanvasBBox;d&&f.cfg.isInView&&(i.push(d.minX,d.maxX),n.push(d.minY,d.maxY))});var a=null;if(i.length){var o=Ls(i),s=Is(i),l=Ls(n),u=Is(n);a={minX:o,minY:l,x:o,y:l,maxX:s,maxY:u,width:s-o,height:u-l};var c=this.cfg.canvas;if(c){var h=c.getViewRange();this.set("isInView",Jf(a,h))}}else this.set("isInView",!1);this.set("cacheCanvasBBox",a)},t.prototype.draw=function(e,i){var n=this.cfg.children,a=i?this.cfg.refresh:!0;n.length&&a&&(e.save(),Pc(e,this),this._applyClip(e,this.getClip()),Rx(e,n,i),e.restore(),this.cacheCanvasBBox()),this.cfg.refresh=null,this.set("hasChanged",!1)},t.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("hasChanged",!1)},t}(Klt),Xut=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return k(k({},e),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},t.prototype.getShapeBase=function(){return aS},t.prototype.getGroupBase=function(){return no},t.prototype.onCanvasChange=function(e){Y5(this,e)},t.prototype.calculateBBox=function(){var e=this.get("type"),i=this.getHitLineWidth(),n=Jlt(e),a=n(this),o=i/2,s=a.x-o,l=a.y-o,u=a.x+a.width+o,c=a.y+a.height+o;return{x:s,minX:s,y:l,minY:l,width:a.width+i,height:a.height+i,maxX:u,maxY:c}},t.prototype.isFill=function(){return!!this.attrs.fill||this.isClipShape()},t.prototype.isStroke=function(){return!!this.attrs.stroke},t.prototype._applyClip=function(e,i){i&&(e.save(),Pc(e,i),i.createPath(e),e.restore(),e.clip(),i._afterDraw())},t.prototype.draw=function(e,i){var n=this.cfg.clipShape;if(i){if(this.cfg.refresh===!1){this.set("hasChanged",!1);return}var a=this.getCanvasBBox();if(!Jf(i,a)){this.set("hasChanged",!1),this.cfg.isInView&&this._afterDraw();return}}e.save(),Pc(e,this),this._applyClip(e,n),this.drawPath(e),e.restore(),this._afterDraw()},t.prototype.getCanvasViewBox=function(){var e=this.cfg.canvas;return e?e.getViewRange():null},t.prototype.cacheCanvasBBox=function(){var e=this.getCanvasViewBox();if(e){var i=this.getCanvasBBox(),n=Jf(i,e);this.set("isInView",n),n?this.set("cacheCanvasBBox",i):this.set("cacheCanvasBBox",null)}},t.prototype._afterDraw=function(){this.cacheCanvasBBox(),this.set("hasChanged",!1),this.set("refresh",null)},t.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("isInView",null),this.set("hasChanged",!1)},t.prototype.drawPath=function(e){this.createPath(e),this.strokeAndFill(e),this.afterDrawPath(e)},t.prototype.fill=function(e){e.fill()},t.prototype.stroke=function(e){e.stroke()},t.prototype.strokeAndFill=function(e){var i=this.attrs,n=i.lineWidth,a=i.opacity,o=i.strokeOpacity,s=i.fillOpacity;this.isFill()&&(!br(s)&&s!==1?(e.globalAlpha=s,this.fill(e),e.globalAlpha=a):this.fill(e)),this.isStroke()&&n>0&&(!br(o)&&o!==1&&(e.globalAlpha=o),this.stroke(e)),this.afterDrawPath(e)},t.prototype.createPath=function(e){},t.prototype.afterDrawPath=function(e){},t.prototype.isInShape=function(e,i){var n=this.isStroke(),a=this.isFill(),o=this.getHitLineWidth();return this.isInStrokeOrPath(e,i,n,a,o)},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){return!1},t.prototype.getHitLineWidth=function(){if(!this.isStroke())return 0;var e=this.attrs;return e.lineWidth+e.lineAppendWidth},t}(Qlt),Ra=Xut,Yut=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return k(k({},e),{x:0,y:0,r:0})},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr(),l=s.x,u=s.y,c=s.r,h=o/2,f=z5(l,u,e,i);return a&&n?f<=c+h:a?f<=c:n?f>=c-h&&f<=c+h:!1},t.prototype.createPath=function(e){var i=this.attr(),n=i.x,a=i.y,o=i.r;e.beginPath(),e.arc(n,a,o,0,Math.PI*2,!1),e.closePath()},t}(Ra),jut=Yut;function vp(r,t,e,i){return r/(e*e)+t/(i*i)}var Zut=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return k(k({},e),{x:0,y:0,rx:0,ry:0})},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr(),l=o/2,u=s.x,c=s.y,h=s.rx,f=s.ry,d=(e-u)*(e-u),v=(i-c)*(i-c);return a&&n?vp(d,v,h+l,f+l)<=1:a?vp(d,v,h,f)<=1:n?vp(d,v,h-l,f-l)>=1&&vp(d,v,h+l,f+l)<=1:!1},t.prototype.createPath=function(e){var i=this.attr(),n=i.x,a=i.y,o=i.rx,s=i.ry;if(e.beginPath(),e.ellipse)e.ellipse(n,a,o,s,0,0,Math.PI*2,!1);else{var l=o>s?o:s,u=o>s?1:o/s,c=o>s?s/o:1;e.save(),e.translate(n,a),e.scale(u,c),e.arc(0,0,l,0,Math.PI*2),e.restore(),e.closePath()}},t}(Ra),qut=Zut;function p3(r){return r instanceof HTMLElement&&Ca(r.nodeName)&&r.nodeName.toUpperCase()==="CANVAS"}var Kut=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return k(k({},e),{x:0,y:0,width:0,height:0})},t.prototype.initAttrs=function(e){this._setImage(e.img)},t.prototype.isStroke=function(){return!1},t.prototype.isOnlyHitBox=function(){return!0},t.prototype._afterLoading=function(){if(this.get("toDraw")===!0){var e=this.get("canvas");e?e.draw():this.createPath(this.get("context"))}},t.prototype._setImage=function(e){var i=this,n=this.attrs;if(Ca(e)){var a=new Image;a.onload=function(){if(i.destroyed)return!1;i.attr("img",a),i.set("loading",!1),i._afterLoading();var o=i.get("callback");o&&o.call(i)},a.crossOrigin="Anonymous",a.src=e,this.set("loading",!0)}else e instanceof Image?(n.width||(n.width=e.width),n.height||(n.height=e.height)):p3(e)&&(n.width||(n.width=Number(e.getAttribute("width"))),n.height||(n.height,Number(e.getAttribute("height"))))},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),e==="img"&&this._setImage(i)},t.prototype.createPath=function(e){if(this.get("loading")){this.set("toDraw",!0),this.set("context",e);return}var i=this.attr(),n=i.x,a=i.y,o=i.width,s=i.height,l=i.sx,u=i.sy,c=i.swidth,h=i.sheight,f=i.img;(f instanceof Image||p3(f))&&(!br(l)&&!br(u)&&!br(c)&&!br(h)?e.drawImage(f,l,u,c,h,n,a,o,s):e.drawImage(f,n,a,o,s))},t}(Ra),yS=Kut;function _s(r,t,e,i,n,a,o){var s=Math.min(r,e),l=Math.max(r,e),u=Math.min(t,i),c=Math.max(t,i),h=n/2;return a>=s-h&&a<=l+h&&o>=u-h&&o<=c+h?Ui.pointToLine(r,t,e,i,a,o)<=n/2:!1}var Qut=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return k(k({},e),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(e){this.setArrow()},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),this.setArrow()},t.prototype.setArrow=function(){var e=this.attr(),i=e.x1,n=e.y1,a=e.x2,o=e.y2,s=e.startArrow,l=e.endArrow;s&&pS(this,e,a,o,i,n),l&&gS(this,e,i,n,a,o)},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){if(!n||!o)return!1;var s=this.attr(),l=s.x1,u=s.y1,c=s.x2,h=s.y2;return _s(l,u,c,h,o,e,i)},t.prototype.createPath=function(e){var i=this.attr(),n=i.x1,a=i.y1,o=i.x2,s=i.y2,l=i.startArrow,u=i.endArrow,c={dx:0,dy:0},h={dx:0,dy:0};l&&l.d&&(c=Pl(n,a,o,s,i.startArrow.d)),u&&u.d&&(h=Pl(n,a,o,s,i.endArrow.d)),e.beginPath(),e.moveTo(n+c.dx,a+c.dy),e.lineTo(o-h.dx,s-h.dy)},t.prototype.afterDrawPath=function(e){var i=this.get("startArrowShape"),n=this.get("endArrowShape");i&&i.draw(e),n&&n.draw(e)},t.prototype.getTotalLength=function(){var e=this.attr(),i=e.x1,n=e.y1,a=e.x2,o=e.y2;return Ui.length(i,n,a,o)},t.prototype.getPoint=function(e){var i=this.attr(),n=i.x1,a=i.y1,o=i.x2,s=i.y2;return Ui.pointAt(n,a,o,s,e)},t}(Ra),Jut=Qut,tct={circle:function(r,t,e){return[["M",r-e,t],["A",e,e,0,1,0,r+e,t],["A",e,e,0,1,0,r-e,t]]},square:function(r,t,e){return[["M",r-e,t-e],["L",r+e,t-e],["L",r+e,t+e],["L",r-e,t+e],["Z"]]},diamond:function(r,t,e){return[["M",r-e,t],["L",r,t-e],["L",r+e,t],["L",r,t+e],["Z"]]},triangle:function(r,t,e){var i=e*Math.sin(.3333333333333333*Math.PI);return[["M",r-e,t+i],["L",r,t-i],["L",r+e,t+i],["Z"]]},"triangle-down":function(r,t,e){var i=e*Math.sin(.3333333333333333*Math.PI);return[["M",r-e,t-i],["L",r+e,t-i],["L",r,t+i],["Z"]]}},ect=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.initAttrs=function(e){this._resetParamsCache()},t.prototype._resetParamsCache=function(){this.set("paramsCache",{})},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),["symbol","x","y","r","radius"].indexOf(e)!==-1&&this._resetParamsCache()},t.prototype.isOnlyHitBox=function(){return!0},t.prototype._getR=function(e){return br(e.r)?e.radius:e.r},t.prototype._getPath=function(){var e=this.attr(),i=e.x,n=e.y,a=e.symbol||"circle",o=this._getR(e),s,l;if(Xl(a))s=a,l=s(i,n,o),l=k5(l);else{if(s=t.Symbols[a],!s)return console.warn(a+" marker is not supported."),null;l=s(i,n,o)}return l},t.prototype.createPath=function(e){var i=this._getPath(),n=this.get("paramsCache");X5(this,e,{path:i},n)},t.Symbols=tct,t}(Ra),rct=ect;function j5(r,t,e){var i=B5();return r.createPath(i),i.isPointInPath(t,e)}var ict=1e-6;function v_(r){return Math.abs(r)<ict?0:r<0?-1:1}function nct(r,t,e){return(e[0]-r[0])*(t[1]-r[1])===(t[0]-r[0])*(e[1]-r[1])&&Math.min(r[0],t[0])<=e[0]&&e[0]<=Math.max(r[0],t[0])&&Math.min(r[1],t[1])<=e[1]&&e[1]<=Math.max(r[1],t[1])}function Z5(r,t,e){var i=!1,n=r.length;if(n<=2)return!1;for(var a=0;a<n;a++){var o=r[a],s=r[(a+1)%n];if(nct(o,s,[t,e]))return!0;v_(o[1]-e)>0!=v_(s[1]-e)>0&&v_(t-(e-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(i=!i)}return i}function lf(r,t,e,i,n,a,o,s){var l=(Math.atan2(s-t,o-r)+Math.PI*2)%(Math.PI*2);if(l<i||l>n)return!1;var u={x:r+e*Math.cos(l),y:t+e*Math.sin(l)};return z5(u.x,u.y,o,s)<=a/2}var act=u5;function oct(r){for(var t=!1,e=r.length,i=0;i<e;i++){var n=r[i],a=n[0];if(a==="C"||a==="A"||a==="Q"){t=!0;break}}return t}function sct(r,t,e,i,n){for(var a=!1,o=t/2,s=0;s<r.length;s++){var l=r[s],u=l.currentPoint,c=l.params,h=l.prePoint,f=l.box;if(!(f&&!Sl(f.x-o,f.y-o,f.width+t,f.height+t,e,i))){switch(l.command){case"L":case"Z":a=_s(h[0],h[1],u[0],u[1],t,e,i);break;case"Q":var d=O5.pointDistance(h[0],h[1],c[1],c[2],c[3],c[4],e,i);a=d<=t/2;break;case"C":var v=Tf.pointDistance(h[0],h[1],c[1],c[2],c[3],c[4],c[5],c[6],e,i,n);a=v<=t/2;break;case"A":var p=l.arcParams,g=p.cx,m=p.cy,y=p.rx,_=p.ry,x=p.startAngle,C=p.endAngle,A=p.xRotation,T=[e,i,1],w=y>_?y:_,M=y>_?1:y/_,O=y>_?_/y:1,P=act(null,[["t",-g,-m],["r",-A],["s",1/M,1/O]]);Est(T,T,P),a=lf(0,0,w,x,C,t,T[0],T[1]);break}if(a)break}}return a}function lct(r){for(var t=r.length,e=[],i=[],n=[],a=0;a<t;a++){var o=r[a],s=o[0];s==="M"?(n.length&&(i.push(n),n=[]),n.push([o[1],o[2]])):s==="Z"?n.length&&(e.push(n),n=[]):n.push([o[1],o[2]])}return n.length>0&&i.push(n),{polygons:e,polylines:i}}var pp=k({hasArc:oct,extractPolygons:lct,isPointInStroke:sct},est);function g3(r,t,e){for(var i=!1,n=0;n<r.length;n++){var a=r[n];if(i=Z5(a,t,e),i)break}return i}var uct=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return k(k({},e),{startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(e){this._setPathArr(e.path),this.setArrow()},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),e==="path"&&this._setPathArr(i),this.setArrow()},t.prototype._setPathArr=function(e){this.attrs.path=k5(e);var i=pp.hasArc(e);this.set("hasArc",i),this.set("paramsCache",{}),this.set("segments",null),this.set("curve",null),this.set("tCache",null),this.set("totalLength",null)},t.prototype.getSegments=function(){var e=this.get("segements");return e||(e=U5(this.attr("path")),this.set("segments",e)),e},t.prototype.setArrow=function(){var e=this.attr(),i=e.startArrow,n=e.endArrow;if(i){var a=this.getStartTangent();pS(this,e,a[0][0],a[0][1],a[1][0],a[1][1])}if(n){var a=this.getEndTangent();gS(this,e,a[0][0],a[0][1],a[1][0],a[1][1])}},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.getSegments(),l=this.get("hasArc"),u=!1;if(n){var c=this.getTotalLength();u=pp.isPointInStroke(s,o,e,i,c)}if(!u&&a)if(l)u=j5(this,e,i);else{var h=this.attr("path"),f=pp.extractPolygons(h);u=g3(f.polygons,e,i)||g3(f.polylines,e,i)}return u},t.prototype.createPath=function(e){var i=this.attr(),n=this.get("paramsCache");X5(this,e,i,n)},t.prototype.afterDrawPath=function(e){var i=this.get("startArrowShape"),n=this.get("endArrowShape");i&&i.draw(e),n&&n.draw(e)},t.prototype.getTotalLength=function(){var e=this.get("totalLength");return br(e)?(this._calculateCurve(),this._setTcache(),this.get("totalLength")):e},t.prototype.getPoint=function(e){var i=this.get("tCache");i||(this._calculateCurve(),this._setTcache(),i=this.get("tCache"));var n,a,o=this.get("curve");if(!i||i.length===0)return o?{x:o[0][1],y:o[0][2]}:null;_e(i,function(c,h){e>=c[0]&&e<=c[1]&&(n=(e-c[0])/(c[1]-c[0]),a=h)});var s=o[a];if(br(s)||br(a))return null;var l=s.length,u=o[a+1];return Tf.pointAt(s[l-2],s[l-1],u[1],u[2],u[3],u[4],u[5],u[6],n)},t.prototype._calculateCurve=function(){var e=this.attr().path;this.set("curve",pp.pathToCurve(e))},t.prototype._setTcache=function(){var e=0,i=0,n=[],a,o,s,l,u=this.get("curve");if(u){if(_e(u,function(c,h){s=u[h+1],l=c.length,s&&(e+=Tf.length(c[l-2],c[l-1],s[1],s[2],s[3],s[4],s[5],s[6])||0)}),this.set("totalLength",e),e===0){this.set("tCache",[]);return}_e(u,function(c,h){s=u[h+1],l=c.length,s&&(a=[],a[0]=i/e,o=Tf.length(c[l-2],c[l-1],s[1],s[2],s[3],s[4],s[5],s[6]),i+=o||0,a[1]=i/e,n.push(a))}),this.set("tCache",n)}},t.prototype.getStartTangent=function(){var e=this.getSegments(),i;if(e.length>1){var n=e[0].currentPoint,a=e[1].currentPoint,o=e[1].startTangent;i=[],o?(i.push([n[0]-o[0],n[1]-o[1]]),i.push([n[0],n[1]])):(i.push([a[0],a[1]]),i.push([n[0],n[1]]))}return i},t.prototype.getEndTangent=function(){var e=this.getSegments(),i=e.length,n;if(i>1){var a=e[i-2].currentPoint,o=e[i-1].currentPoint,s=e[i-1].endTangent;n=[],s?(n.push([o[0]-s[0],o[1]-s[1]]),n.push([o[0],o[1]])):(n.push([a[0],a[1]]),n.push([o[0],o[1]]))}return n},t}(Ra),_S=uct;function q5(r,t,e,i,n){var a=r.length;if(a<2)return!1;for(var o=0;o<a-1;o++){var s=r[o][0],l=r[o][1],u=r[o+1][0],c=r[o+1][1];if(_s(s,l,u,c,t,e,i))return!0}if(n){var h=r[0],f=r[a-1];if(_s(h[0],h[1],f[0],f[1],t,e,i))return!0}return!1}var cct=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr().points,l=!1;return n&&(l=q5(s,o,e,i,!0)),!l&&a&&(l=Z5(s,e,i)),l},t.prototype.createPath=function(e){var i=this.attr(),n=i.points;if(!(n.length<2)){e.beginPath();for(var a=0;a<n.length;a++){var o=n[a];a===0?e.moveTo(o[0],o[1]):e.lineTo(o[0],o[1])}e.closePath()}},t}(Ra),hct=cct,fct=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return k(k({},e),{startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(e){this.setArrow()},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),this.setArrow(),["points"].indexOf(e)!==-1&&this._resetCache()},t.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},t.prototype.setArrow=function(){var e=this.attr(),i=this.attrs,n=i.points,a=i.startArrow,o=i.endArrow,s=n.length,l=n[0][0],u=n[0][1],c=n[s-1][0],h=n[s-1][1];a&&pS(this,e,n[1][0],n[1][1],l,u),o&&gS(this,e,n[s-2][0],n[s-2][1],c,h)},t.prototype.isFill=function(){return!1},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){if(!n||!o)return!1;var s=this.attr().points;return q5(s,o,e,i,!1)},t.prototype.isStroke=function(){return!0},t.prototype.createPath=function(e){var i=this.attr(),n=i.points,a=i.startArrow,o=i.endArrow,s=n.length;if(!(n.length<2)){var l=n[0][0],u=n[0][1],c=n[s-1][0],h=n[s-1][1];if(a&&a.d){var f=Pl(l,u,n[1][0],n[1][1],a.d);l+=f.dx,u+=f.dy}if(o&&o.d){var f=Pl(n[s-2][0],n[s-2][1],c,h,o.d);c-=f.dx,h-=f.dy}e.beginPath(),e.moveTo(l,u);for(var d=0;d<s-1;d++){var v=n[d];e.lineTo(v[0],v[1])}e.lineTo(c,h)}},t.prototype.afterDrawPath=function(e){var i=this.get("startArrowShape"),n=this.get("endArrowShape");i&&i.draw(e),n&&n.draw(e)},t.prototype.getTotalLength=function(){var e=this.attr().points,i=this.get("totalLength");return br(i)?(this.set("totalLength",dut.length(e)),this.get("totalLength")):i},t.prototype.getPoint=function(e){var i=this.attr().points,n=this.get("tCache");n||(this._setTcache(),n=this.get("tCache"));var a,o;return _e(n,function(s,l){e>=s[0]&&e<=s[1]&&(a=(e-s[0])/(s[1]-s[0]),o=l)}),Ui.pointAt(i[o][0],i[o][1],i[o+1][0],i[o+1][1],a)},t.prototype._setTcache=function(){var e=this.attr().points;if(!(!e||e.length===0)){var i=this.getTotalLength();if(!(i<=0)){var n=0,a=[],o,s;_e(e,function(l,u){e[u+1]&&(o=[],o[0]=n/i,s=Ui.length(l[0],l[1],e[u+1][0],e[u+1][1]),n+=s,o[1]=n/i,a.push(o))}),this.set("tCache",a)}}},t.prototype.getStartTangent=function(){var e=this.attr().points,i=[];return i.push([e[1][0],e[1][1]]),i.push([e[0][0],e[0][1]]),i},t.prototype.getEndTangent=function(){var e=this.attr().points,i=e.length-1,n=[];return n.push([e[i-1][0],e[i-1][1]]),n.push([e[i][0],e[i][1]]),n},t}(Ra),dct=fct;function vct(r,t,e,i,n,a,o){var s=n/2;return Sl(r-s,t-s,e,n,a,o)||Sl(r+e-s,t-s,n,i,a,o)||Sl(r+s,t+i-s,e,n,a,o)||Sl(r-s,t+s,n,i,a,o)}function pct(r,t,e,i,n,a,o,s){return _s(r+n,t,r+e-n,t,a,o,s)||_s(r+e,t+n,r+e,t+i-n,a,o,s)||_s(r+e-n,t+i,r+n,t+i,a,o,s)||_s(r,t+i-n,r,t+n,a,o,s)||lf(r+e-n,t+n,n,1.5*Math.PI,2*Math.PI,a,o,s)||lf(r+e-n,t+i-n,n,0,.5*Math.PI,a,o,s)||lf(r+n,t+i-n,n,.5*Math.PI,Math.PI,a,o,s)||lf(r+n,t+n,n,Math.PI,1.5*Math.PI,a,o,s)}var gct=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return k(k({},e),{x:0,y:0,width:0,height:0,radius:0})},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr(),l=s.x,u=s.y,c=s.width,h=s.height,f=s.radius;if(f){var v=!1;return n&&(v=pct(l,u,c,h,f,o,e,i)),!v&&a&&(v=j5(this,e,i)),v}else{var d=o/2;if(a&&n)return Sl(l-d,u-d,c+d,h+d,e,i);if(a)return Sl(l,u,c,h,e,i);if(n)return vct(l,u,c,h,o,e,i)}},t.prototype.createPath=function(e){var i=this.attr(),n=i.x,a=i.y,o=i.width,s=i.height,l=i.radius;if(e.beginPath(),l===0)e.rect(n,a,o,s);else{var u=zut(l),c=u[0],h=u[1],f=u[2],d=u[3];e.moveTo(n+c,a),e.lineTo(n+o-h,a),h!==0&&e.arc(n+o-h,a+h,h,-Math.PI/2,0),e.lineTo(n+o,a+s-f),f!==0&&e.arc(n+o-f,a+s-f,f,0,Math.PI/2),e.lineTo(n+d,a+s),d!==0&&e.arc(n+d,a+s-d,d,Math.PI/2,Math.PI),e.lineTo(n,a+c),c!==0&&e.arc(n+c,a+c,c,Math.PI,Math.PI*1.5),e.closePath()}},t}(Ra),mct=gct,yct=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return k(k({},e),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},t.prototype.isOnlyHitBox=function(){return!0},t.prototype.initAttrs=function(e){this._assembleFont(),e.text&&this._setText(e.text)},t.prototype._assembleFont=function(){var e=this.attrs;e.font=N5(e)},t.prototype._setText=function(e){var i=null;Ca(e)&&e.indexOf(`
`)!==-1&&(i=e.split(`
`)),this.set("textArr",i)},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),e.startsWith("font")&&this._assembleFont(),e==="text"&&this._setText(i)},t.prototype._getSpaceingY=function(){var e=this.attrs,i=e.lineHeight,n=e.fontSize*1;return i?i-n:n*.14},t.prototype._drawTextArr=function(e,i,n){var a=this.attrs,o=a.textBaseline,s=a.x,l=a.y,u=a.fontSize*1,c=this._getSpaceingY(),h=D5(a.text,a.fontSize,a.lineHeight),f;_e(i,function(d,v){f=l+v*(c+u)-h+u,o==="middle"&&(f+=h-u-(h-u)/2),o==="top"&&(f+=h-u),br(d)||(n?e.fillText(d,s,f):e.strokeText(d,s,f))})},t.prototype._drawText=function(e,i){var n=this.attr(),a=n.x,o=n.y,s=this.get("textArr");if(s)this._drawTextArr(e,s,i);else{var l=n.text;br(l)||(i?e.fillText(l,a,o):e.strokeText(l,a,o))}},t.prototype.strokeAndFill=function(e){var i=this.attrs,n=i.lineWidth,a=i.opacity,o=i.strokeOpacity,s=i.fillOpacity;this.isStroke()&&n>0&&(!br(o)&&o!==1&&(e.globalAlpha=a),this.stroke(e)),this.isFill()&&(!br(s)&&s!==1?(e.globalAlpha=s,this.fill(e),e.globalAlpha=a):this.fill(e)),this.afterDrawPath(e)},t.prototype.fill=function(e){this._drawText(e,!0)},t.prototype.stroke=function(e){this._drawText(e,!1)},t}(Ra),_ct=yct;function xct(r,t){if(t){var e=c5(t);return Cl(e,r)}return r}function K5(r,t,e){var i=r.getTotalMatrix();if(i){var n=xct([t,e,1],i),a=n[0],o=n[1];return[a,o]}return[t,e]}function m3(r,t,e){if(r.isCanvas&&r.isCanvas())return!0;if(!vx(r)||r.cfg.isInView===!1)return!1;if(r.cfg.clipShape){var i=K5(r,t,e),n=i[0],a=i[1];if(r.isClipped(n,a))return!1}var o=r.cfg.cacheCanvasBBox||r.getCanvasBBox();return t>=o.minX&&t<=o.maxX&&e>=o.minY&&e<=o.maxY}function Q5(r,t,e){if(!m3(r,t,e))return null;for(var i=null,n=r.getChildren(),a=n.length,o=a-1;o>=0;o--){var s=n[o];if(s.isGroup())i=Q5(s,t,e);else if(m3(s,t,e)){var l=s,u=K5(s,t,e),c=u[0],h=u[1];l.isInShape(c,h)&&(i=s)}if(i)break}return i}var y3=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return e.renderer="canvas",e.autoDraw=!0,e.localRefresh=!0,e.refreshElements=[],e.clipView=!0,e.quickHit=!1,e},t.prototype.onCanvasChange=function(e){(e==="attr"||e==="sort"||e==="changeSize")&&(this.set("refreshElements",[this]),this.draw())},t.prototype.getShapeBase=function(){return aS},t.prototype.getGroupBase=function(){return no},t.prototype.getPixelRatio=function(){var e=this.get("pixelRatio")||Lut();return e>=1?Math.ceil(e):1},t.prototype.getViewRange=function(){return{minX:0,minY:0,maxX:this.cfg.width,maxY:this.cfg.height}},t.prototype.createDom=function(){var e=document.createElement("canvas"),i=e.getContext("2d");return this.set("context",i),e},t.prototype.setDOMSize=function(e,i){r.prototype.setDOMSize.call(this,e,i);var n=this.get("context"),a=this.get("el"),o=this.getPixelRatio();a.width=o*e,a.height=o*i,o>1&&n.scale(o,o)},t.prototype.clear=function(){r.prototype.clear.call(this),this._clearFrame();var e=this.get("context"),i=this.get("el");e.clearRect(0,0,i.width,i.height)},t.prototype.getShape=function(e,i){var n;return this.get("quickHit")?n=Q5(this,e,i):n=r.prototype.getShape.call(this,e,i,null),n},t.prototype._getRefreshRegion=function(){var e=this.get("refreshElements"),i=this.getViewRange(),n;if(e.length&&e[0]===this)n=i;else if(n=Vut(e),n){n.minX=Math.floor(n.minX),n.minY=Math.floor(n.minY),n.maxX=Math.ceil(n.maxX),n.maxY=Math.ceil(n.maxY),n.maxY+=1;var a=this.get("clipView");a&&(n=Gut(n,i))}return n},t.prototype.refreshElement=function(e){var i=this.get("refreshElements");i.push(e)},t.prototype._clearFrame=function(){var e=this.get("drawFrame");e&&(Dot(e),this.set("drawFrame",null),this.set("refreshElements",[]))},t.prototype.draw=function(){var e=this.get("drawFrame");this.get("autoDraw")&&e||this._startDraw()},t.prototype._drawAll=function(){var e=this.get("context"),i=this.get("el"),n=this.getChildren();e.clearRect(0,0,i.width,i.height),Pc(e,this),Rx(e,n),this.set("refreshElements",[])},t.prototype._drawRegion=function(){var e=this.get("context"),i=this.get("refreshElements"),n=this.getChildren(),a=this._getRefreshRegion();a?(e.clearRect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),e.save(),e.beginPath(),e.rect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),e.clip(),Pc(e,this),Hut(this,n,a),Rx(e,n,a),e.restore()):i.length&&G5(i),_e(i,function(o){o.get("hasChanged")&&o.set("hasChanged",!1)}),this.set("refreshElements",[])},t.prototype._startDraw=function(){var e=this,i=this.get("drawFrame");i||(i=Bot(function(){e.get("localRefresh")?e._drawRegion():e._drawAll(),e.set("drawFrame",null)}),this.set("drawFrame",i))},t.prototype.skipDraw=function(){},t.prototype.removeDom=function(){var e=this.get("el");e.width=0,e.height=0,e.parentNode.removeChild(e)},t}(qlt),$i="$$value$$",Zt="$$extra$$",xS="$$origin$$",Cct="$$extra_column$$",Ka="$$total$$",eg="$$multi$$",jl="$$series_number$$",vu="$$empty_field_value$$",CS="$$empty_extra_placeholder$$",_3;(function(r){r.DATA_CELL_CLICK_EVENT="interaction:data-cell-click",r.MERGED_CELLS_CLICK_EVENT="interaction:merged-cells-click",r.CORNER_TEXT_CLICK_EVENT="interaction:corner-cell-text-click",r.ROW_COLUMN_CLICK_EVENT="interaction:row-column-click",r.ROW_TEXT_CLICK_EVENT="interaction:row-text-click",r.HOVER_EVENT="interaction:hover",r.TREND_ICON_CLICK="interaction:trend-icon-click"})(_3||(_3={}));var pi;(function(r){r.MOUSE_DOWN="mousedown",r.MOUSE_MOVE="mousemove",r.MOUSE_OUT="mouseout",r.MOUSE_LEAVE="mouseleave",r.MOUSE_UP="mouseup",r.KEY_DOWN="keydown",r.KEY_UP="keyup",r.CLICK="click",r.HOVER="hover",r.DOUBLE_CLICK="dblclick",r.CONTEXT_MENU="contextmenu"})(pi||(pi={}));var G;(function(r){r.ROW_CELL_HOVER="row-cell:hover",r.ROW_CELL_CLICK="row-cell:click",r.ROW_CELL_DOUBLE_CLICK="row-cell:double-click",r.ROW_CELL_CONTEXT_MENU="row-cell:context-menu",r.ROW_CELL_MOUSE_DOWN="row-cell:mouse-down",r.ROW_CELL_MOUSE_UP="row-cell:mouse-up",r.ROW_CELL_MOUSE_MOVE="row-cell:mouse-move",r.ROW_CELL_COLLAPSE_TREE_ROWS="row-cell:collapsed-tree-rows",r.ROW_CELL_SCROLL="row-cell:scroll",r.ROW_CELL_BRUSH_SELECTION="row-cell:brush-selection",r.COL_CELL_HOVER="col-cell:hover",r.COL_CELL_CLICK="col-cell:click",r.COL_CELL_DOUBLE_CLICK="col-cell:double-click",r.COL_CELL_CONTEXT_MENU="col-cell:context-menu",r.COL_CELL_MOUSE_DOWN="col-cell:mouse-down",r.COL_CELL_MOUSE_UP="col-cell:mouse-up",r.COL_CELL_MOUSE_MOVE="col-cell:mouse-move",r.COL_CELL_BRUSH_SELECTION="col-cell:brush-selection",r.DATA_CELL_HOVER="data-cell:hover",r.DATA_CELL_CLICK="data-cell:click",r.DATA_CELL_DOUBLE_CLICK="data-cell:double-click",r.DATA_CELL_CONTEXT_MENU="data-cell:context-menu",r.DATA_CELL_MOUSE_UP="data-cell:mouse-up",r.DATA_CELL_MOUSE_DOWN="data-cell:mouse-down",r.DATA_CELL_MOUSE_MOVE="data-cell:mouse-move",r.DATA_CELL_TREND_ICON_CLICK="data-cell:trend-icon-click",r.DATA_CELL_BRUSH_SELECTION="data-cell:brush-selection",r.DATA_CELL_SELECT_MOVE="data-cell:select-move",r.CORNER_CELL_HOVER="corner-cell:hover",r.CORNER_CELL_CLICK="corner-cell:click",r.CORNER_CELL_DOUBLE_CLICK="corner-cell:double-click",r.CORNER_CELL_CONTEXT_MENU="corner-cell:context-menu",r.CORNER_CELL_MOUSE_DOWN="corner-cell:mouse-down",r.CORNER_CELL_MOUSE_UP="corner-cell:mouse-up",r.CORNER_CELL_MOUSE_MOVE="corner-cell:mouse-move",r.MERGED_CELLS_HOVER="merged-cells:hover",r.MERGED_CELLS_CLICK="merged-cells:click",r.MERGED_CELLS_DOUBLE_CLICK="merged-cells:double-click",r.MERGED_CELLS_CONTEXT_MENU="merged-cell:context-menu",r.MERGED_CELLS_MOUSE_DOWN="merged-cells:mouse-down",r.MERGED_CELLS_MOUSE_UP="merged-cells:mouse-up",r.MERGED_CELLS_MOUSE_MOVE="merged-cells:mouse-move",r.RANGE_SORT="sort:range-sort",r.RANGE_SORTED="sort:range-sorted",r.RANGE_FILTER="filter:range-filter",r.RANGE_FILTERED="filter:range-filtered",r.LAYOUT_AFTER_HEADER_LAYOUT="layout:after-header-layout",r.LAYOUT_CELL_SCROLL="layout:cell-scroll",r.LAYOUT_PAGINATION="layout:pagination",r.LAYOUT_COLLAPSE_ROWS="layout:collapsed-rows",r.LAYOUT_AFTER_COLLAPSE_ROWS="layout:after-collapsed-rows",r.LAYOUT_AFTER_REAL_DATA_CELL_RENDER="layout:after-real-data-cell-render",r.LAYOUT_TREE_ROWS_COLLAPSE_ALL="layout:toggle-collapse-all",r.LAYOUT_COLS_EXPANDED="layout:table-col-expanded",r.LAYOUT_COLS_HIDDEN="layout:table-col-hidden",r.LAYOUT_AFTER_RENDER="layout:after-render",r.LAYOUT_BEFORE_RENDER="layout:before-render",r.LAYOUT_DESTROY="layout:destroy",r.LAYOUT_RESIZE="layout:resize",r.LAYOUT_RESIZE_SERIES_WIDTH="layout:resize-series-width",r.LAYOUT_RESIZE_ROW_WIDTH="layout:resize-row-width",r.LAYOUT_RESIZE_ROW_HEIGHT="layout:resize-row-height",r.LAYOUT_RESIZE_COL_WIDTH="layout:resize-column-width",r.LAYOUT_RESIZE_COL_HEIGHT="layout:resize-column-height",r.LAYOUT_RESIZE_TREE_WIDTH="layout:resize-tree-width",r.LAYOUT_RESIZE_MOUSE_DOWN="layout:resize:mouse-down",r.LAYOUT_RESIZE_MOUSE_MOVE="layout:resize:mouse-move",r.LAYOUT_RESIZE_MOUSE_UP="layout:resize-mouse-up",r.GLOBAL_KEYBOARD_DOWN="global:keyboard-down",r.GLOBAL_KEYBOARD_UP="global:keyboard-up",r.GLOBAL_COPIED="global:copied",r.GLOBAL_MOUSE_UP="global:mouse-up",r.GLOBAL_MOUSE_MOVE="global:mouse-move",r.GLOBAL_ACTION_ICON_CLICK="global:action-icon-click",r.GLOBAL_ACTION_ICON_HOVER="global:action-icon-hover",r.GLOBAL_ACTION_ICON_HOVER_OFF="global:action-icon-hover-off",r.GLOBAL_CONTEXT_MENU="global:context-menu",r.GLOBAL_CLICK="global:click",r.GLOBAL_DOUBLE_CLICK="global:double-click",r.GLOBAL_SELECTED="global:selected",r.GLOBAL_HOVER="global:hover",r.GLOBAL_RESET="global:reset",r.GLOBAL_LINK_FIELD_JUMP="global:link-field-jump",r.GLOBAL_SCROLL="global:scroll"})(G||(G={}));var Ect=0,Sct=3,J5=3,td=4,Act=5,Tct=5,bct=1,wct=1,t4=2,Rct="backGroundGroup",Mct="foreGroundGroup",Ict="panelGroup",Lct="panelScrollGroup",x3="mergedCellsGroup",e4="frozenRowGroup",r4="frozenColGroup",Oct="frozenTrailingRowGroup",Pct="frozenTrailingColGroup",Fct="frozenTopGroup",Bct="frozenBottomGroup",Fc="rowResizeAreaGroup",i4="rowFrozenResizeAreaGroup",Jg="frozenSplitLine",C3="rowIndexResizeAreaGroup",Ix="cornerResizeAreaGroup",n4="colResizeAreaGroup",a4="colFrozenResizeAreaGroup",Dct="colScrollGroup",Nct="colFrozenGroup",kct="colFrozenTrailingGroup",E3="gridGroup",Uct="rowScrollGroup",zct="rowHeaderFrozenGroup",Hct="series-number-node",o4="horizontal-resize-area-",s4="root",ii="[&]",Lx="-",gm="-",S3=28,A3=16,l4=16,$ct=.5,p_=50,Bc;(function(r){r.Line="line",r.Bar="bar",r.Bullet="bullet"})(Bc||(Bc={}));var T3="square",lc="...",Wct="antv-s2",t0="valueRanges",ES={},u4="#000000",Ox="#FFFFFF",Vct={data:[],totalData:[],fields:{rows:[],columns:[],values:[],customTreeItems:[],valueInCols:!0},meta:[],sortParams:[],filterParams:[]},po,pr;(function(r){r.ROW="row",r.COL="col",r.TRAILING_ROW="trailingRow",r.TRAILING_COL="trailingCol",r.SCROLL="scroll",r.TOP="top",r.BOTTOM="bottom"})(pr||(pr={}));var Ln;(function(r){r.FROZEN_COL="frozenCol",r.FROZEN_ROW="frozenRow",r.FROZEN_TRAILING_COL="frozenTrailingCol",r.FROZEN_TRAILING_ROW="frozenTrailingRow"})(Ln||(Ln={}));var c4=(po={},po[pr.ROW]="frozenRowGroup",po[pr.COL]="frozenColGroup",po[pr.TRAILING_COL]="frozenTrailingColGroup",po[pr.TRAILING_ROW]="frozenTrailingRowGroup",po[pr.SCROLL]="panelScrollGroup",po[pr.TOP]="frozenTopGroup",po[pr.BOTTOM]="frozenBottomGroup",po),vi;(function(r){r.CORNER_CELL_CLICK="cornerCellClick",r.DATA_CELL_CLICK="dataCellClick",r.MERGED_CELLS_CLICK="mergedCellsClick",r.ROW_COLUMN_CLICK="rowColumnClick",r.ROW_TEXT_CLICK="rowTextClick",r.HOVER="hover",r.BRUSH_SELECTION="brushSelection",r.ROW_BRUSH_SELECTION="rowBrushSelection",r.COL_BRUSH_SELECTION="colBrushSelection",r.COL_ROW_RESIZE="rowColResize",r.DATA_CELL_MULTI_SELECTION="dataCellMultiSelection",r.RANGE_SELECTION="rangeSelection",r.SELECTED_CELL_MOVE="selectedCellMove"})(vi||(vi={}));var At;(function(r){r.ALL_SELECTED="allSelected",r.SELECTED="selected",r.BRUSH_SELECTED="brushSelected",r.UNSELECTED="unselected",r.HOVER="hover",r.HOVER_FOCUS="hoverFocus",r.HIGHLIGHT="highlight",r.SEARCH_RESULT="searchResult",r.PREPARE_SELECT="prepareSelect"})(At||(At={}));var st;(function(r){r.DATA_CELL="dataCell",r.HEADER_CELL="headerCell",r.ROW_CELL="rowCell",r.COL_CELL="colCell",r.CORNER_CELL="cornerCell",r.MERGED_CELL="mergedCell"})(st||(st={}));var Px=800,an={textOpacity:"fillOpacity",backgroundOpacity:"fillOpacity",backgroundColor:"fill",borderOpacity:"strokeOpacity",borderColor:"stroke",borderWidth:"lineWidth",opacity:"opacity"},Gct={textShape:["textOpacity"],textShapes:["textOpacity"],linkFieldShape:["opacity"],interactiveBgShape:["backgroundColor","backgroundOpacity"],interactiveBorderShape:["borderColor","borderOpacity","borderWidth"]},Fx="interactionStateInfo",ei;(function(r){r.CLICK="click",r.UN_DRAGGED="unDragged",r.DRAGGED="dragged"})(ei||(ei={}));var ni;(function(r){r.SHIFT="Shift",r.COPY="c",r.ESC="Escape",r.META="Meta",r.CONTROL="Control",r.ARROW_UP="ArrowUp",r.ARROW_DOWN="ArrowDown",r.ARROW_LEFT="ArrowLeft",r.ARROW_RIGHT="ArrowRight"})(ni||(ni={}));var b3;(function(r){r.ASC="ASC",r.DESC="DESC"})(b3||(b3={}));var Vt;(function(r){r.HOVER="hover",r.CLICK="click",r.BRUSH_SELECTION="brushSelection",r.ROW_BRUSH_SELECTION="rowBrushSelection",r.COL_BRUSH_SELECTION="colBrushSelection",r.MULTI_SELECTION="multiSelection",r.RESIZE="resize"})(Vt||(Vt={}));var w3={x:{value:0,scroll:!1},y:{value:0,scroll:!1}},e0;(function(r){r.CONTENT="content",r.CANVAS="canvas"})(e0||(e0={}));var Lr;(function(r){r.SCROLL_UP="scrollUp",r.SCROLL_DOWN="scrollDown"})(Lr||(Lr={}));var r0;(function(r){r[r.SCROLL_UP=-1]="SCROLL_UP",r[r.SCROLL_DOWN=1]="SCROLL_DOWN"})(r0||(r0={}));var Xct="RESIZE_START_GUIDE_LINE",Yct="RESIZE_END_GUIDE_LINE",jct="RESIZE_MASK",zn;(function(r){r.Horizontal="col",r.Vertical="row"})(zn||(zn={}));var mi;(function(r){r.Field="field",r.Cell="cell",r.Tree="tree",r.Series="series"})(mi||(mi={}));var i0;(function(r){r.ALL="all",r.CURRENT="current"})(i0||(i0={}));var h4=1,Zl;(function(r){r.Adaptive="adaptive",r.ColAdaptive="colAdaptive",r.Compact="compact"})(Zl||(Zl={}));var R3=120,Zct={layoutWidthType:Zl.Adaptive,showTreeLeafNodeAlignDot:!1,collapsedRows:{},collapsedCols:{},cellCfg:{width:96,height:30},rowCfg:{width:null,widthByField:{},heightByField:{}},colCfg:{height:30,widthByFieldValue:{},heightByField:{}},device:"pc"},qct={width:600,height:480,debug:!1,hierarchyType:"grid",conditions:{},totals:{},tooltip:{showTooltip:!1,autoAdjustBoundary:"body",operation:{hiddenColumns:!1,trend:!1,sort:!1,menus:[]}},interaction:{linkFields:[],hiddenColumnFields:[],selectedCellsSpotlight:!1,hoverHighlight:!0,hoverFocus:{duration:Px},scrollSpeedRatio:{horizontal:1,vertical:1},autoResetSheetStyle:!0,brushSelection:{data:!0,row:!1,col:!1},multiSelection:!0,rangeSelection:!0,scrollbarPosition:e0.CONTENT,resize:{rowCellVertical:!0,cornerCellHorizontal:!0,colCellHorizontal:!0,colCellVertical:!0,rowResizeType:i0.ALL},eventListenerOptions:!1,selectedCellHighlight:!1,overscrollBehavior:"auto"},showSeriesNumber:!1,customSVGIcons:[],showDefaultHeaderActionIcon:!1,headerActionIcons:[],style:Zct,frozenRowHeader:!0,frozenRowCount:0,frozenColCount:0,frozenTrailingRowCount:0,frozenTrailingColCount:0,hdAdapter:!0,cornerText:"",cornerExtraFieldText:"",placeholder:gm,supportCSSTransform:!1,devicePixelRatio:window.devicePixelRatio},Kct=typeof global=="object"&&global&&global.Object===Object&&global,f4=Kct,Qct=typeof self=="object"&&self&&self.Object===Object&&self,Jct=f4||Qct||Function("return this")(),zr=Jct,tht=zr.Symbol,ui=tht,d4=Object.prototype,eht=d4.hasOwnProperty,rht=d4.toString,Hh=ui?ui.toStringTag:void 0;function iht(r){var t=eht.call(r,Hh),e=r[Hh];try{r[Hh]=void 0;var i=!0}catch{}var n=rht.call(r);return i&&(t?r[Hh]=e:delete r[Hh]),n}var nht=Object.prototype,aht=nht.toString;function oht(r){return aht.call(r)}var sht="[object Null]",lht="[object Undefined]",M3=ui?ui.toStringTag:void 0;function bi(r){return r==null?r===void 0?lht:sht:M3&&M3 in Object(r)?iht(r):oht(r)}function lr(r){return r!=null&&typeof r=="object"}var uht="[object Symbol]";function gn(r){return typeof r=="symbol"||lr(r)&&bi(r)==uht}var cht=0/0;function I3(r){return typeof r=="number"?r:gn(r)?cht:+r}function Ke(r,t){for(var e=-1,i=r==null?0:r.length,n=Array(i);++e<i;)n[e]=t(r[e],e,r);return n}var hht=Array.isArray,It=hht,fht=1/0,L3=ui?ui.prototype:void 0,O3=L3?L3.toString:void 0;function mn(r){if(typeof r=="string")return r;if(It(r))return Ke(r,mn)+"";if(gn(r))return O3?O3.call(r):"";var t=r+"";return t=="0"&&1/r==-fht?"-0":t}function mm(r,t){return function(e,i){var n;if(e===void 0&&i===void 0)return t;if(e!==void 0&&(n=e),i!==void 0){if(n===void 0)return i;typeof e=="string"||typeof i=="string"?(e=mn(e),i=mn(i)):(e=I3(e),i=I3(i)),n=r(e,i)}return n}}var dht=mm(function(r,t){return r+t},0),vht=dht,pht=/\s/;function v4(r){for(var t=r.length;t--&&pht.test(r.charAt(t)););return t}var ght=/^\s+/;function p4(r){return r&&r.slice(0,v4(r)+1).replace(ght,"")}function Oe(r){var t=typeof r;return r!=null&&(t=="object"||t=="function")}var P3=0/0,mht=/^[-+]0x[0-9a-f]+$/i,yht=/^0b[01]+$/i,_ht=/^0o[0-7]+$/i,xht=parseInt;function hn(r){if(typeof r=="number")return r;if(gn(r))return P3;if(Oe(r)){var t=typeof r.valueOf=="function"?r.valueOf():r;r=Oe(t)?t+"":t}if(typeof r!="string")return r===0?r:+r;r=p4(r);var e=yht.test(r);return e||_ht.test(r)?xht(r.slice(2),e?2:8):mht.test(r)?P3:+r}var F3=1/0,Cht=17976931348623157e292;function Fo(r){if(!r)return r===0?r:0;if(r=hn(r),r===F3||r===-F3){var t=r<0?-1:1;return t*Cht}return r===r?r:0}function te(r){var t=Fo(r),e=t%1;return t===t?e?t-e:t:0}var Eht="Expected a function";function Sht(r,t){if(typeof t!="function")throw new TypeError(Eht);return r=te(r),function(){if(--r<1)return t.apply(this,arguments)}}function fi(r){return r}var Aht="[object AsyncFunction]",Tht="[object Function]",bht="[object GeneratorFunction]",wht="[object Proxy]";function Zr(r){if(!Oe(r))return!1;var t=bi(r);return t==Tht||t==bht||t==Aht||t==wht}var Rht=zr["__core-js_shared__"],rg=Rht,B3=function(){var r=/[^.]+$/.exec(rg&&rg.keys&&rg.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function Mht(r){return!!B3&&B3 in r}var Iht=Function.prototype,Lht=Iht.toString;function pu(r){if(r!=null){try{return Lht.call(r)}catch{}try{return r+""}catch{}}return""}var Oht=/[\\^$.*+?()[\]{}|]/g,Pht=/^\[object .+?Constructor\]$/,Fht=Function.prototype,Bht=Object.prototype,Dht=Fht.toString,Nht=Bht.hasOwnProperty,kht=RegExp("^"+Dht.call(Nht).replace(Oht,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function g4(r){if(!Oe(r)||Mht(r))return!1;var t=Zr(r)?kht:Pht;return t.test(pu(r))}function Uht(r,t){return r==null?void 0:r[t]}function gu(r,t){var e=Uht(r,t);return g4(e)?e:void 0}var zht=gu(zr,"WeakMap"),ed=zht,Hht=ed&&new ed,n0=Hht,$ht=n0?function(r,t){return n0.set(r,t),r}:fi,m4=$ht,D3=Object.create,Wht=function(){function r(){}return function(t){if(!Oe(t))return{};if(D3)return D3(t);r.prototype=t;var e=new r;return r.prototype=void 0,e}}(),rh=Wht;function rd(r){return function(){var t=arguments;switch(t.length){case 0:return new r;case 1:return new r(t[0]);case 2:return new r(t[0],t[1]);case 3:return new r(t[0],t[1],t[2]);case 4:return new r(t[0],t[1],t[2],t[3]);case 5:return new r(t[0],t[1],t[2],t[3],t[4]);case 6:return new r(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new r(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var e=rh(r.prototype),i=r.apply(e,t);return Oe(i)?i:e}}var Vht=1;function Ght(r,t,e){var i=t&Vht,n=rd(r);function a(){var o=this&&this!==zr&&this instanceof a?n:r;return o.apply(i?e:this,arguments)}return a}function yn(r,t,e){switch(e.length){case 0:return r.call(t);case 1:return r.call(t,e[0]);case 2:return r.call(t,e[0],e[1]);case 3:return r.call(t,e[0],e[1],e[2])}return r.apply(t,e)}var Xht=Math.max;function y4(r,t,e,i){for(var n=-1,a=r.length,o=e.length,s=-1,l=t.length,u=Xht(a-o,0),c=Array(l+u),h=!i;++s<l;)c[s]=t[s];for(;++n<o;)(h||n<a)&&(c[e[n]]=r[n]);for(;u--;)c[s++]=r[n++];return c}var Yht=Math.max;function _4(r,t,e,i){for(var n=-1,a=r.length,o=-1,s=e.length,l=-1,u=t.length,c=Yht(a-s,0),h=Array(c+u),f=!i;++n<c;)h[n]=r[n];for(var d=n;++l<u;)h[d+l]=t[l];for(;++o<s;)(f||n<a)&&(h[d+e[o]]=r[n++]);return h}function jht(r,t){for(var e=r.length,i=0;e--;)r[e]===t&&++i;return i}function ym(){}var Zht=4294967295;function ce(r){this.__wrapped__=r,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Zht,this.__views__=[]}ce.prototype=rh(ym.prototype);ce.prototype.constructor=ce;function _m(){}var qht=n0?function(r){return n0.get(r)}:_m,SS=qht,Kht={},uc=Kht,Qht=Object.prototype,Jht=Qht.hasOwnProperty;function ig(r){for(var t=r.name+"",e=uc[t],i=Jht.call(uc,t)?e.length:0;i--;){var n=e[i],a=n.func;if(a==null||a==r)return n.name}return t}function Xn(r,t){this.__wrapped__=r,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}Xn.prototype=rh(ym.prototype);Xn.prototype.constructor=Xn;function Vi(r,t){var e=-1,i=r.length;for(t||(t=Array(i));++e<i;)t[e]=r[e];return t}function x4(r){if(r instanceof ce)return r.clone();var t=new Xn(r.__wrapped__,r.__chain__);return t.__actions__=Vi(r.__actions__),t.__index__=r.__index__,t.__values__=r.__values__,t}var tft=Object.prototype,eft=tft.hasOwnProperty;function I(r){if(lr(r)&&!It(r)&&!(r instanceof ce)){if(r instanceof Xn)return r;if(eft.call(r,"__wrapped__"))return x4(r)}return new Xn(r)}I.prototype=ym.prototype;I.prototype.constructor=I;function Bx(r){var t=ig(r),e=I[t];if(typeof e!="function"||!(t in ce.prototype))return!1;if(r===e)return!0;var i=SS(e);return!!i&&r===i[0]}var rft=800,ift=16,nft=Date.now;function C4(r){var t=0,e=0;return function(){var i=nft(),n=ift-(i-e);if(e=i,n>0){if(++t>=rft)return arguments[0]}else t=0;return r.apply(void 0,arguments)}}var aft=C4(m4),E4=aft,oft=/\{\n\/\* \[wrapped with (.+)\] \*/,sft=/,? & /;function lft(r){var t=r.match(oft);return t?t[1].split(sft):[]}var uft=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;function cft(r,t){var e=t.length;if(!e)return r;var i=e-1;return t[i]=(e>1?"& ":"")+t[i],t=t.join(e>2?", ":" "),r.replace(uft,`{
/* [wrapped with `+t+`] */
`)}function cc(r){return function(){return r}}var hft=function(){try{var r=gu(Object,"defineProperty");return r({},"",{}),r}catch{}}(),a0=hft,fft=a0?function(r,t){return a0(r,"toString",{configurable:!0,enumerable:!1,value:cc(t),writable:!0})}:fi,dft=fft,vft=C4(dft),AS=vft;function Qn(r,t){for(var e=-1,i=r==null?0:r.length;++e<i&&t(r[e],e,r)!==!1;);return r}function xm(r,t,e,i){for(var n=r.length,a=e+(i?1:-1);i?a--:++a<n;)if(t(r[a],a,r))return a;return-1}function S4(r){return r!==r}function pft(r,t,e){for(var i=e-1,n=r.length;++i<n;)if(r[i]===t)return i;return-1}function ih(r,t,e){return t===t?pft(r,t,e):xm(r,S4,e)}function Cm(r,t){var e=r==null?0:r.length;return!!e&&ih(r,t,0)>-1}var gft=1,mft=2,yft=8,_ft=16,xft=32,Cft=64,Eft=128,Sft=256,Aft=512,Tft=[["ary",Eft],["bind",gft],["bindKey",mft],["curry",yft],["curryRight",_ft],["flip",Aft],["partial",xft],["partialRight",Cft],["rearg",Sft]];function bft(r,t){return Qn(Tft,function(e){var i="_."+e[0];t&e[1]&&!Cm(r,i)&&r.push(i)}),r.sort()}function A4(r,t,e){var i=t+"";return AS(r,cft(i,bft(lft(i),e)))}var wft=1,Rft=2,Mft=4,Ift=8,N3=32,k3=64;function T4(r,t,e,i,n,a,o,s,l,u){var c=t&Ift,h=c?o:void 0,f=c?void 0:o,d=c?a:void 0,v=c?void 0:a;t|=c?N3:k3,t&=~(c?k3:N3),t&Mft||(t&=~(wft|Rft));var p=[r,t,n,d,h,v,f,s,l,u],g=e.apply(void 0,p);return Bx(r)&&E4(g,p),g.placeholder=i,A4(g,r,t)}function nh(r){var t=r;return t.placeholder}var Lft=9007199254740991,Oft=/^(?:0|[1-9]\d*)$/;function Vo(r,t){var e=typeof r;return t=t??Lft,!!t&&(e=="number"||e!="symbol"&&Oft.test(r))&&r>-1&&r%1==0&&r<t}var Pft=Math.min;function Fft(r,t){for(var e=r.length,i=Pft(t.length,e),n=Vi(r);i--;){var a=t[i];r[i]=Vo(a,e)?n[a]:void 0}return r}var U3="__lodash_placeholder__";function Ps(r,t){for(var e=-1,i=r.length,n=0,a=[];++e<i;){var o=r[e];(o===t||o===U3)&&(r[e]=U3,a[n++]=e)}return a}var Bft=1,Dft=2,Nft=8,kft=16,Uft=128,zft=512;function Em(r,t,e,i,n,a,o,s,l,u){var c=t&Uft,h=t&Bft,f=t&Dft,d=t&(Nft|kft),v=t&zft,p=f?void 0:rd(r);function g(){for(var m=arguments.length,y=Array(m),_=m;_--;)y[_]=arguments[_];if(d)var x=nh(g),C=jht(y,x);if(i&&(y=y4(y,i,n,d)),a&&(y=_4(y,a,o,d)),m-=C,d&&m<u){var A=Ps(y,x);return T4(r,t,Em,g.placeholder,e,y,A,s,l,u-m)}var T=h?e:this,w=f?T[r]:r;return m=y.length,s?y=Fft(y,s):v&&m>1&&y.reverse(),c&&l<m&&(y.length=l),this&&this!==zr&&this instanceof g&&(w=p||rd(w)),w.apply(T,y)}return g}function Hft(r,t,e){var i=rd(r);function n(){for(var a=arguments.length,o=Array(a),s=a,l=nh(n);s--;)o[s]=arguments[s];var u=a<3&&o[0]!==l&&o[a-1]!==l?[]:Ps(o,l);if(a-=u.length,a<e)return T4(r,t,Em,n.placeholder,void 0,o,u,void 0,void 0,e-a);var c=this&&this!==zr&&this instanceof n?i:r;return yn(c,this,o)}return n}var $ft=1;function Wft(r,t,e,i){var n=t&$ft,a=rd(r);function o(){for(var s=-1,l=arguments.length,u=-1,c=i.length,h=Array(c+l),f=this&&this!==zr&&this instanceof o?a:r;++u<c;)h[u]=i[u];for(;l--;)h[u++]=arguments[++s];return yn(f,n?e:this,h)}return o}var z3="__lodash_placeholder__",g_=1,Vft=2,Gft=4,H3=8,$h=128,$3=256,Xft=Math.min;function Yft(r,t){var e=r[1],i=t[1],n=e|i,a=n<(g_|Vft|$h),o=i==$h&&e==H3||i==$h&&e==$3&&r[7].length<=t[8]||i==($h|$3)&&t[7].length<=t[8]&&e==H3;if(!(a||o))return r;i&g_&&(r[2]=t[2],n|=e&g_?0:Gft);var s=t[3];if(s){var l=r[3];r[3]=l?y4(l,s,t[4]):s,r[4]=l?Ps(r[3],z3):t[4]}return s=t[5],s&&(l=r[5],r[5]=l?_4(l,s,t[6]):s,r[6]=l?Ps(r[5],z3):t[6]),s=t[7],s&&(r[7]=s),i&$h&&(r[8]=r[8]==null?t[8]:Xft(r[8],t[8])),r[9]==null&&(r[9]=t[9]),r[0]=t[0],r[1]=n,r}var jft="Expected a function",W3=1,Zft=2,m_=8,y_=16,__=32,V3=64,G3=Math.max;function Go(r,t,e,i,n,a,o,s){var l=t&Zft;if(!l&&typeof r!="function")throw new TypeError(jft);var u=i?i.length:0;if(u||(t&=~(__|V3),i=n=void 0),o=o===void 0?o:G3(te(o),0),s=s===void 0?s:te(s),u-=n?n.length:0,t&V3){var c=i,h=n;i=n=void 0}var f=l?void 0:SS(r),d=[r,t,e,i,n,c,h,a,o,s];if(f&&Yft(d,f),r=d[0],t=d[1],e=d[2],i=d[3],n=d[4],s=d[9]=d[9]===void 0?l?0:r.length:G3(d[9]-u,0),!s&&t&(m_|y_)&&(t&=~(m_|y_)),!t||t==W3)var v=Ght(r,t,e);else t==m_||t==y_?v=Hft(r,t,s):(t==__||t==(W3|__))&&!n.length?v=Wft(r,t,e,i):v=Em.apply(void 0,d);var p=f?m4:E4;return A4(p(v,d),r,t)}var qft=128;function b4(r,t,e){return t=e?void 0:t,t=r&&t==null?r.length:t,Go(r,qft,void 0,void 0,void 0,void 0,t)}function Xo(r,t,e){t=="__proto__"&&a0?a0(r,t,{configurable:!0,enumerable:!0,value:e,writable:!0}):r[t]=e}function Ma(r,t){return r===t||r!==r&&t!==t}var Kft=Object.prototype,Qft=Kft.hasOwnProperty;function Yd(r,t,e){var i=r[t];(!(Qft.call(r,t)&&Ma(i,e))||e===void 0&&!(t in r))&&Xo(r,t,e)}function ao(r,t,e,i){var n=!e;e||(e={});for(var a=-1,o=t.length;++a<o;){var s=t[a],l=i?i(e[s],r[s],s,e,r):void 0;l===void 0&&(l=r[s]),n?Xo(e,s,l):Yd(e,s,l)}return e}var X3=Math.max;function w4(r,t,e){return t=X3(t===void 0?r.length-1:t,0),function(){for(var i=arguments,n=-1,a=X3(i.length-t,0),o=Array(a);++n<a;)o[n]=i[t+n];n=-1;for(var s=Array(t+1);++n<t;)s[n]=i[n];return s[t]=e(o),yn(r,this,s)}}function ie(r,t){return AS(w4(r,t,fi),r+"")}var Jft=9007199254740991;function Sm(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Jft}function qi(r){return r!=null&&Sm(r.length)&&!Zr(r)}function Ai(r,t,e){if(!Oe(e))return!1;var i=typeof t;return(i=="number"?qi(e)&&Vo(t,e.length):i=="string"&&t in e)?Ma(e[t],r):!1}function ah(r){return ie(function(t,e){var i=-1,n=e.length,a=n>1?e[n-1]:void 0,o=n>2?e[2]:void 0;for(a=r.length>3&&typeof a=="function"?(n--,a):void 0,o&&Ai(e[0],e[1],o)&&(a=n<3?void 0:a,n=1),t=Object(t);++i<n;){var s=e[i];s&&r(t,s,i,a)}return t})}var tdt=Object.prototype;function jd(r){var t=r&&r.constructor,e=typeof t=="function"&&t.prototype||tdt;return r===e}function TS(r,t){for(var e=-1,i=Array(r);++e<r;)i[e]=t(e);return i}var edt="[object Arguments]";function Y3(r){return lr(r)&&bi(r)==edt}var R4=Object.prototype,rdt=R4.hasOwnProperty,idt=R4.propertyIsEnumerable,ndt=Y3(function(){return arguments}())?Y3:function(r){return lr(r)&&rdt.call(r,"callee")&&!idt.call(r,"callee")},ql=ndt;function bS(){return!1}var M4=typeof exports=="object"&&exports&&!exports.nodeType&&exports,j3=M4&&typeof module=="object"&&module&&!module.nodeType&&module,adt=j3&&j3.exports===M4,Z3=adt?zr.Buffer:void 0,odt=Z3?Z3.isBuffer:void 0,sdt=odt||bS,Fs=sdt,ldt="[object Arguments]",udt="[object Array]",cdt="[object Boolean]",hdt="[object Date]",fdt="[object Error]",ddt="[object Function]",vdt="[object Map]",pdt="[object Number]",gdt="[object Object]",mdt="[object RegExp]",ydt="[object Set]",_dt="[object String]",xdt="[object WeakMap]",Cdt="[object ArrayBuffer]",Edt="[object DataView]",Sdt="[object Float32Array]",Adt="[object Float64Array]",Tdt="[object Int8Array]",bdt="[object Int16Array]",wdt="[object Int32Array]",Rdt="[object Uint8Array]",Mdt="[object Uint8ClampedArray]",Idt="[object Uint16Array]",Ldt="[object Uint32Array]",Ge={};Ge[Sdt]=Ge[Adt]=Ge[Tdt]=Ge[bdt]=Ge[wdt]=Ge[Rdt]=Ge[Mdt]=Ge[Idt]=Ge[Ldt]=!0;Ge[ldt]=Ge[udt]=Ge[Cdt]=Ge[cdt]=Ge[Edt]=Ge[hdt]=Ge[fdt]=Ge[ddt]=Ge[vdt]=Ge[pdt]=Ge[gdt]=Ge[mdt]=Ge[ydt]=Ge[_dt]=Ge[xdt]=!1;function Odt(r){return lr(r)&&Sm(r.length)&&!!Ge[bi(r)]}function _n(r){return function(t){return r(t)}}var I4=typeof exports=="object"&&exports&&!exports.nodeType&&exports,wf=I4&&typeof module=="object"&&module&&!module.nodeType&&module,Pdt=wf&&wf.exports===I4,x_=Pdt&&f4.process,Fdt=function(){try{var r=wf&&wf.require&&wf.require("util").types;return r||x_&&x_.binding&&x_.binding("util")}catch{}}(),Yn=Fdt,q3=Yn&&Yn.isTypedArray,Bdt=q3?_n(q3):Odt,oh=Bdt,Ddt=Object.prototype,Ndt=Ddt.hasOwnProperty;function L4(r,t){var e=It(r),i=!e&&ql(r),n=!e&&!i&&Fs(r),a=!e&&!i&&!n&&oh(r),o=e||i||n||a,s=o?TS(r.length,String):[],l=s.length;for(var u in r)(t||Ndt.call(r,u))&&!(o&&(u=="length"||n&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Vo(u,l)))&&s.push(u);return s}function O4(r,t){return function(e){return r(t(e))}}var kdt=O4(Object.keys,Object),Udt=kdt,zdt=Object.prototype,Hdt=zdt.hasOwnProperty;function wS(r){if(!jd(r))return Udt(r);var t=[];for(var e in Object(r))Hdt.call(r,e)&&e!="constructor"&&t.push(e);return t}function ir(r){return qi(r)?L4(r):wS(r)}var $dt=Object.prototype,Wdt=$dt.hasOwnProperty,Vdt=ah(function(r,t){if(jd(t)||qi(t)){ao(t,ir(t),r);return}for(var e in t)Wdt.call(t,e)&&Yd(r,e,t[e])}),P4=Vdt;function Gdt(r){var t=[];if(r!=null)for(var e in Object(r))t.push(e);return t}var Xdt=Object.prototype,Ydt=Xdt.hasOwnProperty;function jdt(r){if(!Oe(r))return Gdt(r);var t=jd(r),e=[];for(var i in r)i=="constructor"&&(t||!Ydt.call(r,i))||e.push(i);return e}function Ki(r){return qi(r)?L4(r,!0):jdt(r)}var Zdt=ah(function(r,t){ao(t,Ki(t),r)}),K3=Zdt,qdt=ah(function(r,t,e,i){ao(t,Ki(t),r,i)}),o0=qdt,Kdt=ah(function(r,t,e,i){ao(t,ir(t),r,i)}),Qdt=Kdt,Jdt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tvt=/^\w*$/;function RS(r,t){if(It(r))return!1;var e=typeof r;return e=="number"||e=="symbol"||e=="boolean"||r==null||gn(r)?!0:tvt.test(r)||!Jdt.test(r)||t!=null&&r in Object(t)}var evt=gu(Object,"create"),id=evt;function rvt(){this.__data__=id?id(null):{},this.size=0}function ivt(r){var t=this.has(r)&&delete this.__data__[r];return this.size-=t?1:0,t}var nvt="__lodash_hash_undefined__",avt=Object.prototype,ovt=avt.hasOwnProperty;function svt(r){var t=this.__data__;if(id){var e=t[r];return e===nvt?void 0:e}return ovt.call(t,r)?t[r]:void 0}var lvt=Object.prototype,uvt=lvt.hasOwnProperty;function cvt(r){var t=this.__data__;return id?t[r]!==void 0:uvt.call(t,r)}var hvt="__lodash_hash_undefined__";function fvt(r,t){var e=this.__data__;return this.size+=this.has(r)?0:1,e[r]=id&&t===void 0?hvt:t,this}function Kl(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var i=r[t];this.set(i[0],i[1])}}Kl.prototype.clear=rvt;Kl.prototype.delete=ivt;Kl.prototype.get=svt;Kl.prototype.has=cvt;Kl.prototype.set=fvt;function dvt(){this.__data__=[],this.size=0}function Am(r,t){for(var e=r.length;e--;)if(Ma(r[e][0],t))return e;return-1}var vvt=Array.prototype,pvt=vvt.splice;function gvt(r){var t=this.__data__,e=Am(t,r);if(e<0)return!1;var i=t.length-1;return e==i?t.pop():pvt.call(t,e,1),--this.size,!0}function mvt(r){var t=this.__data__,e=Am(t,r);return e<0?void 0:t[e][1]}function yvt(r){return Am(this.__data__,r)>-1}function _vt(r,t){var e=this.__data__,i=Am(e,r);return i<0?(++this.size,e.push([r,t])):e[i][1]=t,this}function Yo(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var i=r[t];this.set(i[0],i[1])}}Yo.prototype.clear=dvt;Yo.prototype.delete=gvt;Yo.prototype.get=mvt;Yo.prototype.has=yvt;Yo.prototype.set=_vt;var xvt=gu(zr,"Map"),nd=xvt;function Cvt(){this.size=0,this.__data__={hash:new Kl,map:new(nd||Yo),string:new Kl}}function Evt(r){var t=typeof r;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?r!=="__proto__":r===null}function Tm(r,t){var e=r.__data__;return Evt(t)?e[typeof t=="string"?"string":"hash"]:e.map}function Svt(r){var t=Tm(this,r).delete(r);return this.size-=t?1:0,t}function Avt(r){return Tm(this,r).get(r)}function Tvt(r){return Tm(this,r).has(r)}function bvt(r,t){var e=Tm(this,r),i=e.size;return e.set(r,t),this.size+=e.size==i?0:1,this}function jo(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var i=r[t];this.set(i[0],i[1])}}jo.prototype.clear=Cvt;jo.prototype.delete=Svt;jo.prototype.get=Avt;jo.prototype.has=Tvt;jo.prototype.set=bvt;var wvt="Expected a function";function mu(r,t){if(typeof r!="function"||t!=null&&typeof t!="function")throw new TypeError(wvt);var e=function(){var i=arguments,n=t?t.apply(this,i):i[0],a=e.cache;if(a.has(n))return a.get(n);var o=r.apply(this,i);return e.cache=a.set(n,o)||a,o};return e.cache=new(mu.Cache||jo),e}mu.Cache=jo;var Rvt=500;function Mvt(r){var t=mu(r,function(i){return e.size===Rvt&&e.clear(),i}),e=t.cache;return t}var Ivt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Lvt=/\\(\\)?/g,Ovt=Mvt(function(r){var t=[];return r.charCodeAt(0)===46&&t.push(""),r.replace(Ivt,function(e,i,n,a){t.push(n?a.replace(Lvt,"$1"):i||e)}),t}),F4=Ovt;function be(r){return r==null?"":mn(r)}function Vs(r,t){return It(r)?r:RS(r,t)?[r]:F4(be(r))}var Pvt=1/0;function oo(r){if(typeof r=="string"||gn(r))return r;var t=r+"";return t=="0"&&1/r==-Pvt?"-0":t}function yu(r,t){t=Vs(t,r);for(var e=0,i=t.length;r!=null&&e<i;)r=r[oo(t[e++])];return e&&e==i?r:void 0}function Nt(r,t,e){var i=r==null?void 0:yu(r,t);return i===void 0?e:i}function MS(r,t){for(var e=-1,i=t.length,n=Array(i),a=r==null;++e<i;)n[e]=a?void 0:Nt(r,t[e]);return n}function Gs(r,t){for(var e=-1,i=t.length,n=r.length;++e<i;)r[n+e]=t[e];return r}var Q3=ui?ui.isConcatSpreadable:void 0;function Fvt(r){return It(r)||ql(r)||!!(Q3&&r&&r[Q3])}function Qr(r,t,e,i,n){var a=-1,o=r.length;for(e||(e=Fvt),n||(n=[]);++a<o;){var s=r[a];t>0&&e(s)?t>1?Qr(s,t-1,e,i,n):Gs(n,s):i||(n[n.length]=s)}return n}function B4(r){var t=r==null?0:r.length;return t?Qr(r,1):[]}function Zo(r){return AS(w4(r,void 0,B4),r+"")}var Bvt=Zo(MS),Dvt=Bvt,Nvt=O4(Object.getPrototypeOf,Object),bm=Nvt,kvt="[object Object]",Uvt=Function.prototype,zvt=Object.prototype,D4=Uvt.toString,Hvt=zvt.hasOwnProperty,$vt=D4.call(Object);function Zd(r){if(!lr(r)||bi(r)!=kvt)return!1;var t=bm(r);if(t===null)return!0;var e=Hvt.call(t,"constructor")&&t.constructor;return typeof e=="function"&&e instanceof e&&D4.call(e)==$vt}var Wvt="[object DOMException]",Vvt="[object Error]";function IS(r){if(!lr(r))return!1;var t=bi(r);return t==Vvt||t==Wvt||typeof r.message=="string"&&typeof r.name=="string"&&!Zd(r)}var Gvt=ie(function(r,t){try{return yn(r,void 0,t)}catch(e){return IS(e)?e:new Error(e)}}),N4=Gvt,Xvt="Expected a function";function k4(r,t){var e;if(typeof t!="function")throw new TypeError(Xvt);return r=te(r),function(){return--r>0&&(e=t.apply(this,arguments)),r<=1&&(t=void 0),e}}var Yvt=1,jvt=32,LS=ie(function(r,t,e){var i=Yvt;if(e.length){var n=Ps(e,nh(LS));i|=jvt}return Go(r,i,t,e,n)});LS.placeholder={};var U4=LS,Zvt=Zo(function(r,t){return Qn(t,function(e){e=oo(e),Xo(r,e,U4(r[e],r))}),r}),qvt=Zvt,Kvt=1,Qvt=2,Jvt=32,OS=ie(function(r,t,e){var i=Kvt|Qvt;if(e.length){var n=Ps(e,nh(OS));i|=Jvt}return Go(t,i,r,e,n)});OS.placeholder={};var tpt=OS;function jn(r,t,e){var i=-1,n=r.length;t<0&&(t=-t>n?0:n+t),e=e>n?n:e,e<0&&(e+=n),n=t>e?0:e-t>>>0,t>>>=0;for(var a=Array(n);++i<n;)a[i]=r[i+t];return a}function Xs(r,t,e){var i=r.length;return e=e===void 0?i:e,!t&&e>=i?r:jn(r,t,e)}var ept="\\ud800-\\udfff",rpt="\\u0300-\\u036f",ipt="\\ufe20-\\ufe2f",npt="\\u20d0-\\u20ff",apt=rpt+ipt+npt,opt="\\ufe0e\\ufe0f",spt="\\u200d",lpt=RegExp("["+spt+ept+apt+opt+"]");function sh(r){return lpt.test(r)}function upt(r){return r.split("")}var z4="\\ud800-\\udfff",cpt="\\u0300-\\u036f",hpt="\\ufe20-\\ufe2f",fpt="\\u20d0-\\u20ff",dpt=cpt+hpt+fpt,vpt="\\ufe0e\\ufe0f",ppt="["+z4+"]",Dx="["+dpt+"]",Nx="\\ud83c[\\udffb-\\udfff]",gpt="(?:"+Dx+"|"+Nx+")",H4="[^"+z4+"]",$4="(?:\\ud83c[\\udde6-\\uddff]){2}",W4="[\\ud800-\\udbff][\\udc00-\\udfff]",mpt="\\u200d",V4=gpt+"?",G4="["+vpt+"]?",ypt="(?:"+mpt+"(?:"+[H4,$4,W4].join("|")+")"+G4+V4+")*",_pt=G4+V4+ypt,xpt="(?:"+[H4+Dx+"?",Dx,$4,W4,ppt].join("|")+")",Cpt=RegExp(Nx+"(?="+Nx+")|"+xpt+_pt,"g");function Ept(r){return r.match(Cpt)||[]}function Ea(r){return sh(r)?Ept(r):upt(r)}function X4(r){return function(t){t=be(t);var e=sh(t)?Ea(t):void 0,i=e?e[0]:t.charAt(0),n=e?Xs(e,1).join(""):t.slice(1);return i[r]()+n}}var Spt=X4("toUpperCase"),PS=Spt;function Y4(r){return PS(be(r).toLowerCase())}function FS(r,t,e,i){var n=-1,a=r==null?0:r.length;for(i&&a&&(e=r[++n]);++n<a;)e=t(e,r[n],n,r);return e}function BS(r){return function(t){return r==null?void 0:r[t]}}var Apt={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Tpt=BS(Apt),bpt=Tpt,wpt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Rpt="\\u0300-\\u036f",Mpt="\\ufe20-\\ufe2f",Ipt="\\u20d0-\\u20ff",Lpt=Rpt+Mpt+Ipt,Opt="["+Lpt+"]",Ppt=RegExp(Opt,"g");function j4(r){return r=be(r),r&&r.replace(wpt,bpt).replace(Ppt,"")}var Fpt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function Bpt(r){return r.match(Fpt)||[]}var Dpt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function Npt(r){return Dpt.test(r)}var Z4="\\ud800-\\udfff",kpt="\\u0300-\\u036f",Upt="\\ufe20-\\ufe2f",zpt="\\u20d0-\\u20ff",Hpt=kpt+Upt+zpt,q4="\\u2700-\\u27bf",K4="a-z\\xdf-\\xf6\\xf8-\\xff",$pt="\\xac\\xb1\\xd7\\xf7",Wpt="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Vpt="\\u2000-\\u206f",Gpt=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Q4="A-Z\\xc0-\\xd6\\xd8-\\xde",Xpt="\\ufe0e\\ufe0f",J4=$pt+Wpt+Vpt+Gpt,tN="['’]",J3="["+J4+"]",Ypt="["+Hpt+"]",eN="\\d+",jpt="["+q4+"]",rN="["+K4+"]",iN="[^"+Z4+J4+eN+q4+K4+Q4+"]",Zpt="\\ud83c[\\udffb-\\udfff]",qpt="(?:"+Ypt+"|"+Zpt+")",Kpt="[^"+Z4+"]",nN="(?:\\ud83c[\\udde6-\\uddff]){2}",aN="[\\ud800-\\udbff][\\udc00-\\udfff]",zu="["+Q4+"]",Qpt="\\u200d",tI="(?:"+rN+"|"+iN+")",Jpt="(?:"+zu+"|"+iN+")",eI="(?:"+tN+"(?:d|ll|m|re|s|t|ve))?",rI="(?:"+tN+"(?:D|LL|M|RE|S|T|VE))?",oN=qpt+"?",sN="["+Xpt+"]?",tgt="(?:"+Qpt+"(?:"+[Kpt,nN,aN].join("|")+")"+sN+oN+")*",egt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",rgt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",igt=sN+oN+tgt,ngt="(?:"+[jpt,nN,aN].join("|")+")"+igt,agt=RegExp([zu+"?"+rN+"+"+eI+"(?="+[J3,zu,"$"].join("|")+")",Jpt+"+"+rI+"(?="+[J3,zu+tI,"$"].join("|")+")",zu+"?"+tI+"+"+eI,zu+"+"+rI,rgt,egt,eN,ngt].join("|"),"g");function ogt(r){return r.match(agt)||[]}function lN(r,t,e){return r=be(r),t=e?void 0:t,t===void 0?Npt(r)?ogt(r):Bpt(r):r.match(t)||[]}var sgt="['’]",lgt=RegExp(sgt,"g");function lh(r){return function(t){return FS(lN(j4(t).replace(lgt,"")),r,"")}}var ugt=lh(function(r,t,e){return t=t.toLowerCase(),r+(e?Y4(t):t)}),cgt=ugt;function hgt(){if(!arguments.length)return[];var r=arguments[0];return It(r)?r:[r]}var fgt=zr.isFinite,dgt=Math.min;function DS(r){var t=Math[r];return function(e,i){if(e=hn(e),i=i==null?0:dgt(te(i),292),i&&fgt(e)){var n=(be(e)+"e").split("e"),a=t(n[0]+"e"+(+n[1]+i));return n=(be(a)+"e").split("e"),+(n[0]+"e"+(+n[1]-i))}return t(e)}}var vgt=DS("ceil"),pgt=vgt;function uN(r){var t=I(r);return t.__chain__=!0,t}var ggt=Math.ceil,mgt=Math.max;function ygt(r,t,e){(e?Ai(r,t,e):t===void 0)?t=1:t=mgt(te(t),0);var i=r==null?0:r.length;if(!i||t<1)return[];for(var n=0,a=0,o=Array(ggt(i/t));n<i;)o[a++]=jn(r,n,n+=t);return o}function _u(r,t,e){return r===r&&(e!==void 0&&(r=r<=e?r:e),t!==void 0&&(r=r>=t?r:t)),r}function s0(r,t,e){return e===void 0&&(e=t,t=void 0),e!==void 0&&(e=hn(e),e=e===e?e:0),t!==void 0&&(t=hn(t),t=t===t?t:0),_u(hn(r),t,e)}function _gt(){this.__data__=new Yo,this.size=0}function xgt(r){var t=this.__data__,e=t.delete(r);return this.size=t.size,e}function Cgt(r){return this.__data__.get(r)}function Egt(r){return this.__data__.has(r)}var Sgt=200;function Agt(r,t){var e=this.__data__;if(e instanceof Yo){var i=e.__data__;if(!nd||i.length<Sgt-1)return i.push([r,t]),this.size=++e.size,this;e=this.__data__=new jo(i)}return e.set(r,t),this.size=e.size,this}function ga(r){var t=this.__data__=new Yo(r);this.size=t.size}ga.prototype.clear=_gt;ga.prototype.delete=xgt;ga.prototype.get=Cgt;ga.prototype.has=Egt;ga.prototype.set=Agt;function cN(r,t){return r&&ao(t,ir(t),r)}function Tgt(r,t){return r&&ao(t,Ki(t),r)}var hN=typeof exports=="object"&&exports&&!exports.nodeType&&exports,iI=hN&&typeof module=="object"&&module&&!module.nodeType&&module,bgt=iI&&iI.exports===hN,nI=bgt?zr.Buffer:void 0,aI=nI?nI.allocUnsafe:void 0;function fN(r,t){if(t)return r.slice();var e=r.length,i=aI?aI(e):new r.constructor(e);return r.copy(i),i}function Ys(r,t){for(var e=-1,i=r==null?0:r.length,n=0,a=[];++e<i;){var o=r[e];t(o,e,r)&&(a[n++]=o)}return a}function NS(){return[]}var wgt=Object.prototype,Rgt=wgt.propertyIsEnumerable,oI=Object.getOwnPropertySymbols,Mgt=oI?function(r){return r==null?[]:(r=Object(r),Ys(oI(r),function(t){return Rgt.call(r,t)}))}:NS,kS=Mgt;function Igt(r,t){return ao(r,kS(r),t)}var Lgt=Object.getOwnPropertySymbols,Ogt=Lgt?function(r){for(var t=[];r;)Gs(t,kS(r)),r=bm(r);return t}:NS,dN=Ogt;function Pgt(r,t){return ao(r,dN(r),t)}function vN(r,t,e){var i=t(r);return It(r)?i:Gs(i,e(r))}function kx(r){return vN(r,ir,kS)}function US(r){return vN(r,Ki,dN)}var Fgt=gu(zr,"DataView"),Ux=Fgt,Bgt=gu(zr,"Promise"),zx=Bgt,Dgt=gu(zr,"Set"),hc=Dgt,sI="[object Map]",Ngt="[object Object]",lI="[object Promise]",uI="[object Set]",cI="[object WeakMap]",hI="[object DataView]",kgt=pu(Ux),Ugt=pu(nd),zgt=pu(zx),Hgt=pu(hc),$gt=pu(ed),hl=bi;(Ux&&hl(new Ux(new ArrayBuffer(1)))!=hI||nd&&hl(new nd)!=sI||zx&&hl(zx.resolve())!=lI||hc&&hl(new hc)!=uI||ed&&hl(new ed)!=cI)&&(hl=function(r){var t=bi(r),e=t==Ngt?r.constructor:void 0,i=e?pu(e):"";if(i)switch(i){case kgt:return hI;case Ugt:return sI;case zgt:return lI;case Hgt:return uI;case $gt:return cI}return t});var Qa=hl,Wgt=Object.prototype,Vgt=Wgt.hasOwnProperty;function Ggt(r){var t=r.length,e=new r.constructor(t);return t&&typeof r[0]=="string"&&Vgt.call(r,"index")&&(e.index=r.index,e.input=r.input),e}var Xgt=zr.Uint8Array,l0=Xgt;function zS(r){var t=new r.constructor(r.byteLength);return new l0(t).set(new l0(r)),t}function Ygt(r,t){var e=t?zS(r.buffer):r.buffer;return new r.constructor(e,r.byteOffset,r.byteLength)}var jgt=/\w*$/;function Zgt(r){var t=new r.constructor(r.source,jgt.exec(r));return t.lastIndex=r.lastIndex,t}var fI=ui?ui.prototype:void 0,dI=fI?fI.valueOf:void 0;function qgt(r){return dI?Object(dI.call(r)):{}}function pN(r,t){var e=t?zS(r.buffer):r.buffer;return new r.constructor(e,r.byteOffset,r.length)}var Kgt="[object Boolean]",Qgt="[object Date]",Jgt="[object Map]",t0t="[object Number]",e0t="[object RegExp]",r0t="[object Set]",i0t="[object String]",n0t="[object Symbol]",a0t="[object ArrayBuffer]",o0t="[object DataView]",s0t="[object Float32Array]",l0t="[object Float64Array]",u0t="[object Int8Array]",c0t="[object Int16Array]",h0t="[object Int32Array]",f0t="[object Uint8Array]",d0t="[object Uint8ClampedArray]",v0t="[object Uint16Array]",p0t="[object Uint32Array]";function g0t(r,t,e){var i=r.constructor;switch(t){case a0t:return zS(r);case Kgt:case Qgt:return new i(+r);case o0t:return Ygt(r,e);case s0t:case l0t:case u0t:case c0t:case h0t:case f0t:case d0t:case v0t:case p0t:return pN(r,e);case Jgt:return new i;case t0t:case i0t:return new i(r);case e0t:return Zgt(r);case r0t:return new i;case n0t:return qgt(r)}}function gN(r){return typeof r.constructor=="function"&&!jd(r)?rh(bm(r)):{}}var m0t="[object Map]";function y0t(r){return lr(r)&&Qa(r)==m0t}var vI=Yn&&Yn.isMap,_0t=vI?_n(vI):y0t,mN=_0t,x0t="[object Set]";function C0t(r){return lr(r)&&Qa(r)==x0t}var pI=Yn&&Yn.isSet,E0t=pI?_n(pI):C0t,yN=E0t,S0t=1,A0t=2,T0t=4,_N="[object Arguments]",b0t="[object Array]",w0t="[object Boolean]",R0t="[object Date]",M0t="[object Error]",xN="[object Function]",I0t="[object GeneratorFunction]",L0t="[object Map]",O0t="[object Number]",CN="[object Object]",P0t="[object RegExp]",F0t="[object Set]",B0t="[object String]",D0t="[object Symbol]",N0t="[object WeakMap]",k0t="[object ArrayBuffer]",U0t="[object DataView]",z0t="[object Float32Array]",H0t="[object Float64Array]",$0t="[object Int8Array]",W0t="[object Int16Array]",V0t="[object Int32Array]",G0t="[object Uint8Array]",X0t="[object Uint8ClampedArray]",Y0t="[object Uint16Array]",j0t="[object Uint32Array]",ze={};ze[_N]=ze[b0t]=ze[k0t]=ze[U0t]=ze[w0t]=ze[R0t]=ze[z0t]=ze[H0t]=ze[$0t]=ze[W0t]=ze[V0t]=ze[L0t]=ze[O0t]=ze[CN]=ze[P0t]=ze[F0t]=ze[B0t]=ze[D0t]=ze[G0t]=ze[X0t]=ze[Y0t]=ze[j0t]=!0;ze[M0t]=ze[xN]=ze[N0t]=!1;function Hn(r,t,e,i,n,a){var o,s=t&S0t,l=t&A0t,u=t&T0t;if(e&&(o=n?e(r,i,n,a):e(r)),o!==void 0)return o;if(!Oe(r))return r;var c=It(r);if(c){if(o=Ggt(r),!s)return Vi(r,o)}else{var h=Qa(r),f=h==xN||h==I0t;if(Fs(r))return fN(r,s);if(h==CN||h==_N||f&&!n){if(o=l||f?{}:gN(r),!s)return l?Pgt(r,Tgt(o,r)):Igt(r,cN(o,r))}else{if(!ze[h])return n?r:{};o=g0t(r,h,s)}}a||(a=new ga);var d=a.get(r);if(d)return d;a.set(r,o),yN(r)?r.forEach(function(g){o.add(Hn(g,t,e,g,r,a))}):mN(r)&&r.forEach(function(g,m){o.set(m,Hn(g,t,e,m,r,a))});var v=u?l?US:kx:l?Ki:ir,p=c?void 0:v(r);return Qn(p||r,function(g,m){p&&(m=g,g=r[m]),Yd(o,m,Hn(g,t,e,m,r,a))}),o}var Z0t=4;function qd(r){return Hn(r,Z0t)}var q0t=1,K0t=4;function Hx(r){return Hn(r,q0t|K0t)}var Q0t=1,J0t=4;function tmt(r,t){return t=typeof t=="function"?t:void 0,Hn(r,Q0t|J0t,t)}var emt=4;function rmt(r,t){return t=typeof t=="function"?t:void 0,Hn(r,emt,t)}function imt(){return new Xn(this.value(),this.__chain__)}function ma(r){for(var t=-1,e=r==null?0:r.length,i=0,n=[];++t<e;){var a=r[t];a&&(n[i++]=a)}return n}function Zu(){var r=arguments.length;if(!r)return[];for(var t=Array(r-1),e=arguments[0],i=r;i--;)t[i-1]=arguments[i];return Gs(It(e)?Vi(e):[e],Qr(t,1))}var nmt="__lodash_hash_undefined__";function amt(r){return this.__data__.set(r,nmt),this}function omt(r){return this.__data__.has(r)}function Ql(r){var t=-1,e=r==null?0:r.length;for(this.__data__=new jo;++t<e;)this.add(r[t])}Ql.prototype.add=Ql.prototype.push=amt;Ql.prototype.has=omt;function HS(r,t){for(var e=-1,i=r==null?0:r.length;++e<i;)if(t(r[e],e,r))return!0;return!1}function ad(r,t){return r.has(t)}var smt=1,lmt=2;function EN(r,t,e,i,n,a){var o=e&smt,s=r.length,l=t.length;if(s!=l&&!(o&&l>s))return!1;var u=a.get(r),c=a.get(t);if(u&&c)return u==t&&c==r;var h=-1,f=!0,d=e&lmt?new Ql:void 0;for(a.set(r,t),a.set(t,r);++h<s;){var v=r[h],p=t[h];if(i)var g=o?i(p,v,h,t,r,a):i(v,p,h,r,t,a);if(g!==void 0){if(g)continue;f=!1;break}if(d){if(!HS(t,function(m,y){if(!ad(d,y)&&(v===m||n(v,m,e,i,a)))return d.push(y)})){f=!1;break}}else if(!(v===p||n(v,p,e,i,a))){f=!1;break}}return a.delete(r),a.delete(t),f}function $S(r){var t=-1,e=Array(r.size);return r.forEach(function(i,n){e[++t]=[n,i]}),e}function wm(r){var t=-1,e=Array(r.size);return r.forEach(function(i){e[++t]=i}),e}var umt=1,cmt=2,hmt="[object Boolean]",fmt="[object Date]",dmt="[object Error]",vmt="[object Map]",pmt="[object Number]",gmt="[object RegExp]",mmt="[object Set]",ymt="[object String]",_mt="[object Symbol]",xmt="[object ArrayBuffer]",Cmt="[object DataView]",gI=ui?ui.prototype:void 0,C_=gI?gI.valueOf:void 0;function Emt(r,t,e,i,n,a,o){switch(e){case Cmt:if(r.byteLength!=t.byteLength||r.byteOffset!=t.byteOffset)return!1;r=r.buffer,t=t.buffer;case xmt:return!(r.byteLength!=t.byteLength||!a(new l0(r),new l0(t)));case hmt:case fmt:case pmt:return Ma(+r,+t);case dmt:return r.name==t.name&&r.message==t.message;case gmt:case ymt:return r==t+"";case vmt:var s=$S;case mmt:var l=i&umt;if(s||(s=wm),r.size!=t.size&&!l)return!1;var u=o.get(r);if(u)return u==t;i|=cmt,o.set(r,t);var c=EN(s(r),s(t),i,n,a,o);return o.delete(r),c;case _mt:if(C_)return C_.call(r)==C_.call(t)}return!1}var Smt=1,Amt=Object.prototype,Tmt=Amt.hasOwnProperty;function bmt(r,t,e,i,n,a){var o=e&Smt,s=kx(r),l=s.length,u=kx(t),c=u.length;if(l!=c&&!o)return!1;for(var h=l;h--;){var f=s[h];if(!(o?f in t:Tmt.call(t,f)))return!1}var d=a.get(r),v=a.get(t);if(d&&v)return d==t&&v==r;var p=!0;a.set(r,t),a.set(t,r);for(var g=o;++h<l;){f=s[h];var m=r[f],y=t[f];if(i)var _=o?i(y,m,f,t,r,a):i(m,y,f,r,t,a);if(!(_===void 0?m===y||n(m,y,e,i,a):_)){p=!1;break}g||(g=f=="constructor")}if(p&&!g){var x=r.constructor,C=t.constructor;x!=C&&"constructor"in r&&"constructor"in t&&!(typeof x=="function"&&x instanceof x&&typeof C=="function"&&C instanceof C)&&(p=!1)}return a.delete(r),a.delete(t),p}var wmt=1,mI="[object Arguments]",yI="[object Array]",gp="[object Object]",Rmt=Object.prototype,_I=Rmt.hasOwnProperty;function Mmt(r,t,e,i,n,a){var o=It(r),s=It(t),l=o?yI:Qa(r),u=s?yI:Qa(t);l=l==mI?gp:l,u=u==mI?gp:u;var c=l==gp,h=u==gp,f=l==u;if(f&&Fs(r)){if(!Fs(t))return!1;o=!0,c=!1}if(f&&!c)return a||(a=new ga),o||oh(r)?EN(r,t,e,i,n,a):Emt(r,t,l,e,i,n,a);if(!(e&wmt)){var d=c&&_I.call(r,"__wrapped__"),v=h&&_I.call(t,"__wrapped__");if(d||v){var p=d?r.value():r,g=v?t.value():t;return a||(a=new ga),n(p,g,e,i,a)}}return f?(a||(a=new ga),bmt(r,t,e,i,n,a)):!1}function Kd(r,t,e,i,n){return r===t?!0:r==null||t==null||!lr(r)&&!lr(t)?r!==r&&t!==t:Mmt(r,t,e,i,Kd,n)}var Imt=1,Lmt=2;function WS(r,t,e,i){var n=e.length,a=n,o=!i;if(r==null)return!a;for(r=Object(r);n--;){var s=e[n];if(o&&s[2]?s[1]!==r[s[0]]:!(s[0]in r))return!1}for(;++n<a;){s=e[n];var l=s[0],u=r[l],c=s[1];if(o&&s[2]){if(u===void 0&&!(l in r))return!1}else{var h=new ga;if(i)var f=i(u,c,l,r,t,h);if(!(f===void 0?Kd(c,u,Imt|Lmt,i,h):f))return!1}}return!0}function SN(r){return r===r&&!Oe(r)}function VS(r){for(var t=ir(r),e=t.length;e--;){var i=t[e],n=r[i];t[e]=[i,n,SN(n)]}return t}function AN(r,t){return function(e){return e==null?!1:e[r]===t&&(t!==void 0||r in Object(e))}}function TN(r){var t=VS(r);return t.length==1&&t[0][2]?AN(t[0][0],t[0][1]):function(e){return e===r||WS(e,r,t)}}function Omt(r,t){return r!=null&&t in Object(r)}function bN(r,t,e){t=Vs(t,r);for(var i=-1,n=t.length,a=!1;++i<n;){var o=oo(t[i]);if(!(a=r!=null&&e(r,o)))break;r=r[o]}return a||++i!=n?a:(n=r==null?0:r.length,!!n&&Sm(n)&&Vo(o,n)&&(It(r)||ql(r)))}function Jl(r,t){return r!=null&&bN(r,t,Omt)}var Pmt=1,Fmt=2;function wN(r,t){return RS(r)&&SN(t)?AN(oo(r),t):function(e){var i=Nt(e,r);return i===void 0&&i===t?Jl(e,r):Kd(t,i,Pmt|Fmt)}}function GS(r){return function(t){return t==null?void 0:t[r]}}function Bmt(r){return function(t){return yu(t,r)}}function RN(r){return RS(r)?GS(oo(r)):Bmt(r)}function Xt(r){return typeof r=="function"?r:r==null?fi:typeof r=="object"?It(r)?wN(r[0],r[1]):TN(r):RN(r)}var Dmt="Expected a function";function MN(r){var t=r==null?0:r.length,e=Xt;return r=t?Ke(r,function(i){if(typeof i[1]!="function")throw new TypeError(Dmt);return[e(i[0]),i[1]]}):[],ie(function(i){for(var n=-1;++n<t;){var a=r[n];if(yn(a[0],this,i))return yn(a[1],this,i)}})}function IN(r,t,e){var i=e.length;if(r==null)return!i;for(r=Object(r);i--;){var n=e[i],a=t[n],o=r[n];if(o===void 0&&!(n in r)||!a(o))return!1}return!0}function Nmt(r){var t=ir(r);return function(e){return IN(e,r,t)}}var kmt=1;function Umt(r){return Nmt(Hn(r,kmt))}function zmt(r,t){return t==null||IN(r,t,ir(t))}function Hmt(r,t,e,i){for(var n=-1,a=r==null?0:r.length;++n<a;){var o=r[n];t(i,o,e(o),r)}return i}function LN(r){return function(t,e,i){for(var n=-1,a=Object(t),o=i(t),s=o.length;s--;){var l=o[r?s:++n];if(e(a[l],l,a)===!1)break}return t}}var $mt=LN(),XS=$mt;function so(r,t){return r&&XS(r,t,ir)}function ON(r,t){return function(e,i){if(e==null)return e;if(!qi(e))return r(e,i);for(var n=e.length,a=t?n:-1,o=Object(e);(t?a--:++a<n)&&i(o[a],a,o)!==!1;);return e}}var Wmt=ON(so),js=Wmt;function Vmt(r,t,e,i){return js(r,function(n,a,o){t(i,n,e(n),o)}),i}function Rm(r,t){return function(e,i){var n=It(e)?Hmt:Vmt,a=t?t():{};return n(e,r,Xt(i),a)}}var Gmt=Object.prototype,Xmt=Gmt.hasOwnProperty,Ymt=Rm(function(r,t,e){Xmt.call(r,e)?++r[e]:Xo(r,e,1)}),jmt=Ymt;function Zmt(r,t){var e=rh(r);return t==null?e:cN(e,t)}var qmt=8;function YS(r,t,e){t=e?void 0:t;var i=Go(r,qmt,void 0,void 0,void 0,void 0,void 0,t);return i.placeholder=YS.placeholder,i}YS.placeholder={};var Kmt=16;function jS(r,t,e){t=e?void 0:t;var i=Go(r,Kmt,void 0,void 0,void 0,void 0,void 0,t);return i.placeholder=jS.placeholder,i}jS.placeholder={};var Qmt=function(){return zr.Date.now()},ng=Qmt,Jmt="Expected a function",tyt=Math.max,eyt=Math.min;function od(r,t,e){var i,n,a,o,s,l,u=0,c=!1,h=!1,f=!0;if(typeof r!="function")throw new TypeError(Jmt);t=hn(t)||0,Oe(e)&&(c=!!e.leading,h="maxWait"in e,a=h?tyt(hn(e.maxWait)||0,t):a,f="trailing"in e?!!e.trailing:f);function d(A){var T=i,w=n;return i=n=void 0,u=A,o=r.apply(w,T),o}function v(A){return u=A,s=setTimeout(m,t),c?d(A):o}function p(A){var T=A-l,w=A-u,M=t-T;return h?eyt(M,a-w):M}function g(A){var T=A-l,w=A-u;return l===void 0||T>=t||T<0||h&&w>=a}function m(){var A=ng();if(g(A))return y(A);s=setTimeout(m,p(A))}function y(A){return s=void 0,f&&i?d(A):(i=n=void 0,o)}function _(){s!==void 0&&clearTimeout(s),u=0,i=l=n=s=void 0}function x(){return s===void 0?o:y(ng())}function C(){var A=ng(),T=g(A);if(i=arguments,n=this,l=A,T){if(s===void 0)return v(l);if(h)return clearTimeout(s),s=setTimeout(m,t),d(l)}return s===void 0&&(s=setTimeout(m,t)),o}return C.cancel=_,C.flush=x,C}function ryt(r,t){return r==null||r!==r?t:r}var PN=Object.prototype,iyt=PN.hasOwnProperty,nyt=ie(function(r,t){r=Object(r);var e=-1,i=t.length,n=i>2?t[2]:void 0;for(n&&Ai(t[0],t[1],n)&&(i=1);++e<i;)for(var a=t[e],o=Ki(a),s=-1,l=o.length;++s<l;){var u=o[s],c=r[u];(c===void 0||Ma(c,PN[u])&&!iyt.call(r,u))&&(r[u]=a[u])}return r}),ayt=nyt;function $x(r,t,e){(e!==void 0&&!Ma(r[t],e)||e===void 0&&!(t in r))&&Xo(r,t,e)}function dr(r){return lr(r)&&qi(r)}function Wx(r,t){if(!(t==="constructor"&&typeof r[t]=="function")&&t!="__proto__")return r[t]}function FN(r){return ao(r,Ki(r))}function oyt(r,t,e,i,n,a,o){var s=Wx(r,e),l=Wx(t,e),u=o.get(l);if(u){$x(r,e,u);return}var c=a?a(s,l,e+"",r,t,o):void 0,h=c===void 0;if(h){var f=It(l),d=!f&&Fs(l),v=!f&&!d&&oh(l);c=l,f||d||v?It(s)?c=s:dr(s)?c=Vi(s):d?(h=!1,c=fN(l,!0)):v?(h=!1,c=pN(l,!0)):c=[]:Zd(l)||ql(l)?(c=s,ql(s)?c=FN(s):(!Oe(s)||Zr(s))&&(c=gN(l))):h=!1}h&&(o.set(l,c),n(c,l,i,a,o),o.delete(l)),$x(r,e,c)}function Mm(r,t,e,i,n){r!==t&&XS(t,function(a,o){if(n||(n=new ga),Oe(a))oyt(r,t,o,e,Mm,i,n);else{var s=i?i(Wx(r,o),a,o+"",r,t,n):void 0;s===void 0&&(s=a),$x(r,o,s)}},Ki)}function BN(r,t,e,i,n,a){return Oe(r)&&Oe(t)&&(a.set(t,r),Mm(r,t,void 0,BN,a),a.delete(t)),r}var syt=ah(function(r,t,e,i){Mm(r,t,e,i)}),ZS=syt,lyt=ie(function(r){return r.push(void 0,BN),yn(ZS,void 0,r)}),uyt=lyt,cyt="Expected a function";function DN(r,t,e){if(typeof r!="function")throw new TypeError(cyt);return setTimeout(function(){r.apply(void 0,e)},t)}var hyt=ie(function(r,t){return DN(r,1,t)}),fyt=hyt,dyt=ie(function(r,t,e){return DN(r,hn(t)||0,e)}),vyt=dyt;function qS(r,t,e){for(var i=-1,n=r==null?0:r.length;++i<n;)if(e(t,r[i]))return!0;return!1}var pyt=200;function Qd(r,t,e,i){var n=-1,a=Cm,o=!0,s=r.length,l=[],u=t.length;if(!s)return l;e&&(t=Ke(t,_n(e))),i?(a=qS,o=!1):t.length>=pyt&&(a=ad,o=!1,t=new Ql(t));t:for(;++n<s;){var c=r[n],h=e==null?c:e(c);if(c=i||c!==0?c:0,o&&h===h){for(var f=u;f--;)if(t[f]===h)continue t;l.push(c)}else a(t,h,i)||l.push(c)}return l}var gyt=ie(function(r,t){return dr(r)?Qd(r,Qr(t,1,dr,!0)):[]}),NN=gyt;function Pe(r){var t=r==null?0:r.length;return t?r[t-1]:void 0}var myt=ie(function(r,t){var e=Pe(t);return dr(e)&&(e=void 0),dr(r)?Qd(r,Qr(t,1,dr,!0),Xt(e)):[]}),yyt=myt,_yt=ie(function(r,t){var e=Pe(t);return dr(e)&&(e=void 0),dr(r)?Qd(r,Qr(t,1,dr,!0),void 0,e):[]}),kN=_yt,xyt=mm(function(r,t){return r/t},1),Cyt=xyt;function Eyt(r,t,e){var i=r==null?0:r.length;return i?(t=e||t===void 0?1:te(t),jn(r,t<0?0:t,i)):[]}function Syt(r,t,e){var i=r==null?0:r.length;return i?(t=e||t===void 0?1:te(t),t=i-t,jn(r,0,t<0?0:t)):[]}function Im(r,t,e,i){for(var n=r.length,a=i?n:-1;(i?a--:++a<n)&&t(r[a],a,r););return e?jn(r,i?0:a,i?a+1:n):jn(r,i?a+1:0,i?n:a)}function Ayt(r,t){return r&&r.length?Im(r,Xt(t),!0,!0):[]}function Tyt(r,t){return r&&r.length?Im(r,Xt(t),!0):[]}function lo(r){return typeof r=="function"?r:fi}function Ht(r,t){var e=It(r)?Qn:js;return e(r,lo(t))}function byt(r,t){for(var e=r==null?0:r.length;e--&&t(r[e],e,r)!==!1;);return r}var wyt=LN(!0),UN=wyt;function KS(r,t){return r&&UN(r,t,ir)}var Ryt=ON(KS,!0),zN=Ryt;function xI(r,t){var e=It(r)?byt:zN;return e(r,lo(t))}function Myt(r,t,e){r=be(r),t=mn(t);var i=r.length;e=e===void 0?i:_u(te(e),0,i);var n=e;return e-=t.length,e>=0&&r.slice(e,n)==t}function Iyt(r,t){return Ke(t,function(e){return[e,r[e]]})}function Lyt(r){var t=-1,e=Array(r.size);return r.forEach(function(i){e[++t]=[i,i]}),e}var Oyt="[object Map]",Pyt="[object Set]";function HN(r){return function(t){var e=Qa(t);return e==Oyt?$S(t):e==Pyt?Lyt(t):Iyt(t,r(t))}}var Fyt=HN(ir),CI=Fyt,Byt=HN(Ki),EI=Byt,Dyt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Nyt=BS(Dyt),kyt=Nyt,$N=/[&<>"']/g,Uyt=RegExp($N.source);function QS(r){return r=be(r),r&&Uyt.test(r)?r.replace($N,kyt):r}var WN=/[\\^$.*+?()[\]{}|]/g,zyt=RegExp(WN.source);function Hyt(r){return r=be(r),r&&zyt.test(r)?r.replace(WN,"\\$&"):r}function VN(r,t){for(var e=-1,i=r==null?0:r.length;++e<i;)if(!t(r[e],e,r))return!1;return!0}function $yt(r,t){var e=!0;return js(r,function(i,n,a){return e=!!t(i,n,a),e}),e}function Lm(r,t,e){var i=It(r)?VN:$yt;return e&&Ai(r,t,e)&&(t=void 0),i(r,Xt(t))}var Wyt=4294967295;function GN(r){return r?_u(te(r),0,Wyt):0}function Vyt(r,t,e,i){var n=r.length;for(e=te(e),e<0&&(e=-e>n?0:n+e),i=i===void 0||i>n?n:te(i),i<0&&(i+=n),i=e>i?0:GN(i);e<i;)r[e++]=t;return r}function Gyt(r,t,e,i){var n=r==null?0:r.length;return n?(e&&typeof e!="number"&&Ai(r,t,e)&&(e=0,i=n),Vyt(r,t,e,i)):[]}function XN(r,t){var e=[];return js(r,function(i,n,a){t(i,n,a)&&e.push(i)}),e}function qo(r,t){var e=It(r)?Ys:XN;return e(r,Xt(t))}function YN(r){return function(t,e,i){var n=Object(t);if(!qi(t)){var a=Xt(e);t=ir(t),e=function(s){return a(n[s],s,n)}}var o=r(t,e,i);return o>-1?n[a?t[o]:o]:void 0}}var Xyt=Math.max;function Dc(r,t,e){var i=r==null?0:r.length;if(!i)return-1;var n=e==null?0:te(e);return n<0&&(n=Xyt(i+n,0)),xm(r,Xt(t),n)}var Yyt=YN(Dc),ci=Yyt;function jN(r,t,e){var i;return e(r,function(n,a,o){if(t(n,a,o))return i=a,!1}),i}function jyt(r,t){return jN(r,Xt(t),so)}var Zyt=Math.max,qyt=Math.min;function ZN(r,t,e){var i=r==null?0:r.length;if(!i)return-1;var n=i-1;return e!==void 0&&(n=te(e),n=e<0?Zyt(i+n,0):qyt(n,i-1)),xm(r,Xt(t),n,!0)}var Kyt=YN(ZN),Om=Kyt;function Qyt(r,t){return jN(r,Xt(t),KS)}function tu(r){return r&&r.length?r[0]:void 0}function qN(r,t){var e=-1,i=qi(r)?Array(r.length):[];return js(r,function(n,a,o){i[++e]=t(n,a,o)}),i}function se(r,t){var e=It(r)?Ke:qN;return e(r,Xt(t))}function Jd(r,t){return Qr(se(r,t),1)}var Jyt=1/0;function t_t(r,t){return Qr(se(r,t),Jyt)}function e_t(r,t,e){return e=e===void 0?1:te(e),Qr(se(r,t),e)}var r_t=1/0;function KN(r){var t=r==null?0:r.length;return t?Qr(r,r_t):[]}function i_t(r,t){var e=r==null?0:r.length;return e?(t=t===void 0?1:te(t),Qr(r,t)):[]}var n_t=512;function a_t(r){return Go(r,n_t)}var o_t=DS("floor"),s_t=o_t,l_t="Expected a function",u_t=8,c_t=32,h_t=128,f_t=256;function QN(r){return Zo(function(t){var e=t.length,i=e,n=Xn.prototype.thru;for(r&&t.reverse();i--;){var a=t[i];if(typeof a!="function")throw new TypeError(l_t);if(n&&!o&&ig(a)=="wrapper")var o=new Xn([],!0)}for(i=o?i:e;++i<e;){a=t[i];var s=ig(a),l=s=="wrapper"?SS(a):void 0;l&&Bx(l[0])&&l[1]==(h_t|u_t|c_t|f_t)&&!l[4].length&&l[9]==1?o=o[ig(l[0])].apply(o,l[3]):o=a.length==1&&Bx(a)?o[s]():o.thru(a)}return function(){var u=arguments,c=u[0];if(o&&u.length==1&&It(c))return o.plant(c).value();for(var h=0,f=e?t[h].apply(this,u):c;++h<e;)f=t[h].call(this,f);return f}})}var d_t=QN(),v_t=d_t,p_t=QN(!0),g_t=p_t;function JN(r,t){return r==null?r:XS(r,lo(t),Ki)}function m_t(r,t){return r==null?r:UN(r,lo(t),Ki)}function y_t(r,t){return r&&so(r,lo(t))}function __t(r,t){return r&&KS(r,lo(t))}function x_t(r){for(var t=-1,e=r==null?0:r.length,i={};++t<e;){var n=r[t];i[n[0]]=n[1]}return i}function Pm(r,t){return Ys(t,function(e){return Zr(r[e])})}function C_t(r){return r==null?[]:Pm(r,ir(r))}function E_t(r){return r==null?[]:Pm(r,Ki(r))}var S_t=Object.prototype,A_t=S_t.hasOwnProperty,T_t=Rm(function(r,t,e){A_t.call(r,e)?r[e].push(t):Xo(r,e,[t])}),b_t=T_t;function JS(r,t){return r>t}function Fm(r){return function(t,e){return typeof t=="string"&&typeof e=="string"||(t=hn(t),e=hn(e)),r(t,e)}}var w_t=Fm(JS),R_t=w_t,M_t=Fm(function(r,t){return r>=t}),I_t=M_t,L_t=Object.prototype,O_t=L_t.hasOwnProperty;function P_t(r,t){return r!=null&&O_t.call(r,t)}function Vx(r,t){return r!=null&&bN(r,t,P_t)}var F_t=Math.max,B_t=Math.min;function D_t(r,t,e){return r>=B_t(t,e)&&r<F_t(t,e)}function Gx(r,t,e){return t=Fo(t),e===void 0?(e=t,t=0):e=Fo(e),r=hn(r),D_t(r,t,e)}var N_t="[object String]";function uh(r){return typeof r=="string"||!It(r)&&lr(r)&&bi(r)==N_t}function tA(r,t){return Ke(t,function(e){return r[e]})}function Ko(r){return r==null?[]:tA(r,ir(r))}var k_t=Math.max;function Ei(r,t,e,i){r=qi(r)?r:Ko(r),e=e&&!i?te(e):0;var n=r.length;return e<0&&(e=k_t(n+e,0)),uh(r)?e<=n&&r.indexOf(t,e)>-1:!!n&&ih(r,t,e)>-1}var U_t=Math.max;function Bm(r,t,e){var i=r==null?0:r.length;if(!i)return-1;var n=e==null?0:te(e);return n<0&&(n=U_t(i+n,0)),ih(r,t,n)}function z_t(r){var t=r==null?0:r.length;return t?jn(r,0,-1):[]}var H_t=Math.min;function eA(r,t,e){for(var i=e?qS:Cm,n=r[0].length,a=r.length,o=a,s=Array(a),l=1/0,u=[];o--;){var c=r[o];o&&t&&(c=Ke(c,_n(t))),l=H_t(c.length,l),s[o]=!e&&(t||n>=120&&c.length>=120)?new Ql(o&&c):void 0}c=r[0];var h=-1,f=s[0];t:for(;++h<n&&u.length<l;){var d=c[h],v=t?t(d):d;if(d=e||d!==0?d:0,!(f?ad(f,v):i(u,v,e))){for(o=a;--o;){var p=s[o];if(!(p?ad(p,v):i(r[o],v,e)))continue t}f&&f.push(v),u.push(d)}}return u}function rA(r){return dr(r)?r:[]}var $_t=ie(function(r){var t=Ke(r,rA);return t.length&&t[0]===r[0]?eA(t):[]}),t6=$_t,W_t=ie(function(r){var t=Pe(r),e=Ke(r,rA);return t===Pe(e)?t=void 0:e.pop(),e.length&&e[0]===r[0]?eA(e,Xt(t)):[]}),V_t=W_t,G_t=ie(function(r){var t=Pe(r),e=Ke(r,rA);return t=typeof t=="function"?t:void 0,t&&e.pop(),e.length&&e[0]===r[0]?eA(e,void 0,t):[]}),X_t=G_t;function Y_t(r,t,e,i){return so(r,function(n,a,o){t(i,e(n),a,o)}),i}function e6(r,t){return function(e,i){return Y_t(e,r,t(i),{})}}var j_t=Object.prototype,Z_t=j_t.toString,q_t=e6(function(r,t,e){t!=null&&typeof t.toString!="function"&&(t=Z_t.call(t)),r[t]=e},cc(fi)),K_t=q_t,r6=Object.prototype,Q_t=r6.hasOwnProperty,J_t=r6.toString,t1t=e6(function(r,t,e){t!=null&&typeof t.toString!="function"&&(t=J_t.call(t)),Q_t.call(r,t)?r[t].push(e):r[t]=[e]},Xt),e1t=t1t;function i6(r,t){return t.length<2?r:yu(r,jn(t,0,-1))}function tv(r,t,e){t=Vs(t,r),r=i6(r,t);var i=r==null?r:r[oo(Pe(t))];return i==null?void 0:yn(i,r,e)}var r1t=ie(tv),i1t=r1t,n1t=ie(function(r,t,e){var i=-1,n=typeof t=="function",a=qi(r)?Array(r.length):[];return js(r,function(o){a[++i]=n?yn(t,o,e):tv(o,t,e)}),a}),a1t=n1t,o1t="[object ArrayBuffer]";function s1t(r){return lr(r)&&bi(r)==o1t}var SI=Yn&&Yn.isArrayBuffer,l1t=SI?_n(SI):s1t,u1t=l1t,c1t="[object Boolean]";function za(r){return r===!0||r===!1||lr(r)&&bi(r)==c1t}var h1t="[object Date]";function f1t(r){return lr(r)&&bi(r)==h1t}var AI=Yn&&Yn.isDate,d1t=AI?_n(AI):f1t,v1t=d1t;function p1t(r){return lr(r)&&r.nodeType===1&&!Zd(r)}var g1t="[object Map]",m1t="[object Set]",y1t=Object.prototype,_1t=y1t.hasOwnProperty;function at(r){if(r==null)return!0;if(qi(r)&&(It(r)||typeof r=="string"||typeof r.splice=="function"||Fs(r)||oh(r)||ql(r)))return!r.length;var t=Qa(r);if(t==g1t||t==m1t)return!r.size;if(jd(r))return!wS(r).length;for(var e in r)if(_1t.call(r,e))return!1;return!0}function jr(r,t){return Kd(r,t)}function x1t(r,t,e){e=typeof e=="function"?e:void 0;var i=e?e(r,t):void 0;return i===void 0?Kd(r,t,void 0,e):!!i}var C1t=zr.isFinite;function E1t(r){return typeof r=="number"&&C1t(r)}function n6(r){return typeof r=="number"&&r==te(r)}function S1t(r,t){return r===t||WS(r,t,VS(t))}function A1t(r,t,e){return e=typeof e=="function"?e:void 0,WS(r,t,VS(t),e)}var T1t="[object Number]";function yi(r){return typeof r=="number"||lr(r)&&bi(r)==T1t}function a6(r){return yi(r)&&r!=+r}var b1t=rg?Zr:bS,w1t=b1t,R1t="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.";function M1t(r){if(w1t(r))throw new Error(R1t);return g4(r)}function wr(r){return r==null}function o6(r){return r===null}var I1t="[object RegExp]";function L1t(r){return lr(r)&&bi(r)==I1t}var TI=Yn&&Yn.isRegExp,O1t=TI?_n(TI):L1t,iA=O1t,bI=9007199254740991;function P1t(r){return n6(r)&&r>=-bI&&r<=bI}function Dm(r){return r===void 0}var F1t="[object WeakMap]";function B1t(r){return lr(r)&&Qa(r)==F1t}var D1t="[object WeakSet]";function N1t(r){return lr(r)&&bi(r)==D1t}var k1t=1;function U1t(r){return Xt(typeof r=="function"?r:Hn(r,k1t))}var z1t=Array.prototype,H1t=z1t.join;function $1t(r,t){return r==null?"":H1t.call(r,t)}var W1t=lh(function(r,t,e){return r+(e?"-":"")+t.toLowerCase()}),V1t=W1t,G1t=Rm(function(r,t,e){Xo(r,e,t)}),X1t=G1t;function Y1t(r,t,e){for(var i=e+1;i--;)if(r[i]===t)return i;return i}var j1t=Math.max,Z1t=Math.min;function q1t(r,t,e){var i=r==null?0:r.length;if(!i)return-1;var n=i;return e!==void 0&&(n=te(e),n=n<0?j1t(i+n,0):Z1t(n,i-1)),t===t?Y1t(r,t,n):xm(r,S4,n,!0)}var K1t=lh(function(r,t,e){return r+(e?" ":"")+t.toLowerCase()}),nA=K1t,Q1t=X4("toLowerCase"),J1t=Q1t;function aA(r,t){return r<t}var txt=Fm(aA),ext=txt,rxt=Fm(function(r,t){return r<=t}),ixt=rxt;function s6(r,t){var e={};return t=Xt(t),so(r,function(i,n,a){Xo(e,t(i,n,a),i)}),e}function nxt(r,t){var e={};return t=Xt(t),so(r,function(i,n,a){Xo(e,n,t(i,n,a))}),e}var axt=1;function Xx(r){return TN(Hn(r,axt))}var oxt=1;function sxt(r,t){return wN(r,Hn(t,oxt))}function Nm(r,t,e){for(var i=-1,n=r.length;++i<n;){var a=r[i],o=t(a);if(o!=null&&(s===void 0?o===o&&!gn(o):e(o,s)))var s=o,l=a}return l}function Nc(r){return r&&r.length?Nm(r,fi,JS):void 0}function oA(r,t){return r&&r.length?Nm(r,Xt(t),JS):void 0}function sA(r,t){for(var e,i=-1,n=r.length;++i<n;){var a=t(r[i]);a!==void 0&&(e=e===void 0?a:e+a)}return e}var lxt=0/0;function l6(r,t){var e=r==null?0:r.length;return e?sA(r,t)/e:lxt}function uxt(r){return l6(r,fi)}function cxt(r,t){return l6(r,Xt(t))}var hxt=ah(function(r,t,e){Mm(r,t,e)}),u0=hxt,fxt=ie(function(r,t){return function(e){return tv(e,r,t)}}),dxt=fxt,vxt=ie(function(r,t){return function(e){return tv(r,e,t)}}),pxt=vxt;function lA(r){return r&&r.length?Nm(r,fi,aA):void 0}function gxt(r,t){return r&&r.length?Nm(r,Xt(t),aA):void 0}function u6(r,t,e){var i=ir(t),n=Pm(t,i),a=!(Oe(e)&&"chain"in e)||!!e.chain,o=Zr(r);return Qn(n,function(s){var l=t[s];r[s]=l,o&&(r.prototype[s]=function(){var u=this.__chain__;if(a||u){var c=r(this.__wrapped__),h=c.__actions__=Vi(this.__actions__);return h.push({func:l,args:arguments,thisArg:r}),c.__chain__=u,c}return l.apply(r,Gs([this.value()],arguments))})}),r}var mxt=mm(function(r,t){return r*t},1),yxt=mxt,_xt="Expected a function";function ev(r){if(typeof r!="function")throw new TypeError(_xt);return function(){var t=arguments;switch(t.length){case 0:return!r.call(this);case 1:return!r.call(this,t[0]);case 2:return!r.call(this,t[0],t[1]);case 3:return!r.call(this,t[0],t[1],t[2])}return!r.apply(this,t)}}function xxt(r){for(var t,e=[];!(t=r.next()).done;)e.push(t.value);return e}var Cxt="[object Map]",Ext="[object Set]",E_=ui?ui.iterator:void 0;function c6(r){if(!r)return[];if(qi(r))return uh(r)?Ea(r):Vi(r);if(E_&&r[E_])return xxt(r[E_]());var t=Qa(r),e=t==Cxt?$S:t==Ext?wm:Ko;return e(r)}function Sxt(){this.__values__===void 0&&(this.__values__=c6(this.value()));var r=this.__index__>=this.__values__.length,t=r?void 0:this.__values__[this.__index__++];return{done:r,value:t}}function h6(r,t){var e=r.length;if(e)return t+=t<0?e:0,Vo(t,e)?r[t]:void 0}function Axt(r,t){return r&&r.length?h6(r,te(t)):void 0}function Txt(r){return r=te(r),ie(function(t){return h6(t,r)})}function uA(r,t){return t=Vs(t,r),r=i6(r,t),r==null||delete r[oo(Pe(t))]}function bxt(r){return Zd(r)?void 0:r}var wxt=1,Rxt=2,Mxt=4,Ixt=Zo(function(r,t){var e={};if(r==null)return e;var i=!1;t=Ke(t,function(a){return a=Vs(a,r),i||(i=a.length>1),a}),ao(r,US(r),e),i&&(e=Hn(e,wxt|Rxt|Mxt,bxt));for(var n=t.length;n--;)uA(e,t[n]);return e}),cA=Ixt;function rv(r,t,e,i){if(!Oe(r))return r;t=Vs(t,r);for(var n=-1,a=t.length,o=a-1,s=r;s!=null&&++n<a;){var l=oo(t[n]),u=e;if(l==="__proto__"||l==="constructor"||l==="prototype")return r;if(n!=o){var c=s[l];u=i?i(c,l,s):void 0,u===void 0&&(u=Oe(c)?c:Vo(t[n+1])?[]:{})}Yd(s,l,u),s=s[l]}return r}function f6(r,t,e){for(var i=-1,n=t.length,a={};++i<n;){var o=t[i],s=yu(r,o);e(s,o)&&rv(a,Vs(o,r),s)}return a}function hA(r,t){if(r==null)return{};var e=Ke(US(r),function(i){return[i]});return t=Xt(t),f6(r,e,function(i,n){return t(i,n[0])})}function Lxt(r,t){return hA(r,ev(Xt(t)))}function Oxt(r){return k4(2,r)}function Pxt(r,t){var e=r.length;for(r.sort(t);e--;)r[e]=r[e].value;return r}function d6(r,t){if(r!==t){var e=r!==void 0,i=r===null,n=r===r,a=gn(r),o=t!==void 0,s=t===null,l=t===t,u=gn(t);if(!s&&!u&&!a&&r>t||a&&o&&l&&!s&&!u||i&&o&&l||!e&&l||!n)return 1;if(!i&&!a&&!u&&r<t||u&&e&&n&&!i&&!a||s&&e&&n||!o&&n||!l)return-1}return 0}function Fxt(r,t,e){for(var i=-1,n=r.criteria,a=t.criteria,o=n.length,s=e.length;++i<o;){var l=d6(n[i],a[i]);if(l){if(i>=s)return l;var u=e[i];return l*(u=="desc"?-1:1)}}return r.index-t.index}function v6(r,t,e){t.length?t=Ke(t,function(a){return It(a)?function(o){return yu(o,a.length===1?a[0]:a)}:a}):t=[fi];var i=-1;t=Ke(t,_n(Xt));var n=qN(r,function(a,o,s){var l=Ke(t,function(u){return u(a)});return{criteria:l,index:++i,value:a}});return Pxt(n,function(a,o){return Fxt(a,o,e)})}function fA(r,t,e,i){return r==null?[]:(It(t)||(t=t==null?[]:[t]),e=i?void 0:e,It(e)||(e=e==null?[]:[e]),v6(r,t,e))}function dA(r){return Zo(function(t){return t=Ke(t,_n(Xt)),ie(function(e){var i=this;return r(t,function(n){return yn(n,i,e)})})})}var Bxt=dA(Ke),Dxt=Bxt,Nxt=ie,kxt=Nxt,Uxt=Math.min,zxt=kxt(function(r,t){t=t.length==1&&It(t[0])?Ke(t[0],_n(Xt)):Ke(Qr(t,1),_n(Xt));var e=t.length;return ie(function(i){for(var n=-1,a=Uxt(i.length,e);++n<a;)i[n]=t[n].call(this,i[n]);return yn(r,this,i)})}),Hxt=zxt,$xt=dA(VN),Wxt=$xt,Vxt=dA(HS),Gxt=Vxt,Xxt=9007199254740991,Yxt=Math.floor;function Yx(r,t){var e="";if(!r||t<1||t>Xxt)return e;do t%2&&(e+=r),t=Yxt(t/2),t&&(r+=r);while(t);return e}var jxt=GS("length"),Zxt=jxt,p6="\\ud800-\\udfff",qxt="\\u0300-\\u036f",Kxt="\\ufe20-\\ufe2f",Qxt="\\u20d0-\\u20ff",Jxt=qxt+Kxt+Qxt,tCt="\\ufe0e\\ufe0f",eCt="["+p6+"]",jx="["+Jxt+"]",Zx="\\ud83c[\\udffb-\\udfff]",rCt="(?:"+jx+"|"+Zx+")",g6="[^"+p6+"]",m6="(?:\\ud83c[\\udde6-\\uddff]){2}",y6="[\\ud800-\\udbff][\\udc00-\\udfff]",iCt="\\u200d",_6=rCt+"?",x6="["+tCt+"]?",nCt="(?:"+iCt+"(?:"+[g6,m6,y6].join("|")+")"+x6+_6+")*",aCt=x6+_6+nCt,oCt="(?:"+[g6+jx+"?",jx,m6,y6,eCt].join("|")+")",wI=RegExp(Zx+"(?="+Zx+")|"+oCt+aCt,"g");function sCt(r){for(var t=wI.lastIndex=0;wI.test(r);)++t;return t}function ch(r){return sh(r)?sCt(r):Zxt(r)}var lCt=Math.ceil;function c0(r,t){t=t===void 0?" ":mn(t);var e=t.length;if(e<2)return e?Yx(t,r):t;var i=Yx(t,lCt(r/ch(t)));return sh(t)?Xs(Ea(i),0,r).join(""):i.slice(0,r)}var uCt=Math.ceil,cCt=Math.floor;function hCt(r,t,e){r=be(r),t=te(t);var i=t?ch(r):0;if(!t||i>=t)return r;var n=(t-i)/2;return c0(cCt(n),e)+r+c0(uCt(n),e)}function fCt(r,t,e){r=be(r),t=te(t);var i=t?ch(r):0;return t&&i<t?r+c0(t-i,e):r}function dCt(r,t,e){r=be(r),t=te(t);var i=t?ch(r):0;return t&&i<t?c0(t-i,e)+r:r}var vCt=/^\s+/,pCt=zr.parseInt;function gCt(r,t,e){return e||t==null?t=0:t&&(t=+t),pCt(be(r).replace(vCt,""),t||0)}var mCt=32,vA=ie(function(r,t){var e=Ps(t,nh(vA));return Go(r,mCt,void 0,t,e)});vA.placeholder={};var C6=vA,yCt=64,pA=ie(function(r,t){var e=Ps(t,nh(pA));return Go(r,yCt,void 0,t,e)});pA.placeholder={};var _Ct=pA,xCt=Rm(function(r,t,e){r[e?0:1].push(t)},function(){return[[],[]]}),CCt=xCt;function ECt(r,t){return f6(r,t,function(e,i){return Jl(r,i)})}var SCt=Zo(function(r,t){return r==null?{}:ECt(r,t)}),E6=SCt;function ACt(r){for(var t,e=this;e instanceof ym;){var i=x4(e);i.__index__=0,i.__values__=void 0,t?n.__wrapped__=i:t=i;var n=i;e=e.__wrapped__}return n.__wrapped__=r,t}function TCt(r){return function(t){return r==null?void 0:yu(r,t)}}function bCt(r,t,e,i){for(var n=e-1,a=r.length;++n<a;)if(i(r[n],t))return n;return-1}var wCt=Array.prototype,RI=wCt.splice;function gA(r,t,e,i){var n=i?bCt:ih,a=-1,o=t.length,s=r;for(r===t&&(t=Vi(t)),e&&(s=Ke(r,_n(e)));++a<o;)for(var l=0,u=t[a],c=e?e(u):u;(l=n(s,c,l,i))>-1;)s!==r&&RI.call(s,l,1),RI.call(r,l,1);return r}function S6(r,t){return r&&r.length&&t&&t.length?gA(r,t):r}var RCt=ie(S6),MCt=RCt;function ICt(r,t,e){return r&&r.length&&t&&t.length?gA(r,t,Xt(e)):r}function LCt(r,t,e){return r&&r.length&&t&&t.length?gA(r,t,void 0,e):r}var OCt=Array.prototype,PCt=OCt.splice;function A6(r,t){for(var e=r?t.length:0,i=e-1;e--;){var n=t[e];if(e==i||n!==a){var a=n;Vo(n)?PCt.call(r,n,1):uA(r,n)}}return r}var FCt=Zo(function(r,t){var e=r==null?0:r.length,i=MS(r,t);return A6(r,Ke(t,function(n){return Vo(n,e)?+n:n}).sort(d6)),i}),BCt=FCt,DCt=Math.floor,NCt=Math.random;function mA(r,t){return r+DCt(NCt()*(t-r+1))}var kCt=parseFloat,UCt=Math.min,zCt=Math.random;function HCt(r,t,e){if(e&&typeof e!="boolean"&&Ai(r,t,e)&&(t=e=void 0),e===void 0&&(typeof t=="boolean"?(e=t,t=void 0):typeof r=="boolean"&&(e=r,r=void 0)),r===void 0&&t===void 0?(r=0,t=1):(r=Fo(r),t===void 0?(t=r,r=0):t=Fo(t)),r>t){var i=r;r=t,t=i}if(e||r%1||t%1){var n=zCt();return UCt(r+n*(t-r+kCt("1e-"+((n+"").length-1))),t)}return mA(r,t)}var $Ct=Math.ceil,WCt=Math.max;function VCt(r,t,e,i){for(var n=-1,a=WCt($Ct((t-r)/(e||1)),0),o=Array(a);a--;)o[i?a:++n]=r,r+=e;return o}function T6(r){return function(t,e,i){return i&&typeof i!="number"&&Ai(t,e,i)&&(e=i=void 0),t=Fo(t),e===void 0?(e=t,t=0):e=Fo(e),i=i===void 0?t<e?1:-1:Fo(i),VCt(t,e,i,r)}}var GCt=T6(),fc=GCt,XCt=T6(!0),YCt=XCt,jCt=256,ZCt=Zo(function(r,t){return Go(r,jCt,void 0,void 0,void 0,t)}),qCt=ZCt;function b6(r,t,e,i,n){return n(r,function(a,o,s){e=i?(i=!1,a):t(e,a,o,s)}),e}function km(r,t,e){var i=It(r)?FS:b6,n=arguments.length<3;return i(r,Xt(t),e,n,js)}function KCt(r,t,e,i){var n=r==null?0:r.length;for(i&&n&&(e=r[--n]);n--;)e=t(e,r[n],n,r);return e}function QCt(r,t,e){var i=It(r)?KCt:b6,n=arguments.length<3;return i(r,Xt(t),e,n,zN)}function JCt(r,t){var e=It(r)?Ys:XN;return e(r,ev(Xt(t)))}function tEt(r,t){var e=[];if(!(r&&r.length))return e;var i=-1,n=[],a=r.length;for(t=Xt(t);++i<a;){var o=r[i];t(o,i,r)&&(e.push(o),n.push(i))}return A6(r,n),e}function eEt(r,t,e){return(e?Ai(r,t,e):t===void 0)?t=1:t=te(t),Yx(be(r),t)}function rEt(){var r=arguments,t=be(r[0]);return r.length<3?t:t.replace(r[1],r[2])}var iEt="Expected a function";function nEt(r,t){if(typeof r!="function")throw new TypeError(iEt);return t=t===void 0?t:te(t),ie(r,t)}function aEt(r,t,e){t=Vs(t,r);var i=-1,n=t.length;for(n||(n=1,r=void 0);++i<n;){var a=r==null?void 0:r[oo(t[i])];a===void 0&&(i=n,a=e),r=Zr(a)?a.call(r):a}return r}var oEt=Array.prototype,sEt=oEt.reverse;function qx(r){return r==null?r:sEt.call(r)}var lEt=DS("round"),uEt=lEt;function w6(r){var t=r.length;return t?r[mA(0,t-1)]:void 0}function cEt(r){return w6(Ko(r))}function hEt(r){var t=It(r)?w6:cEt;return t(r)}function Um(r,t){var e=-1,i=r.length,n=i-1;for(t=t===void 0?i:t;++e<t;){var a=mA(e,n),o=r[a];r[a]=r[e],r[e]=o}return r.length=t,r}function fEt(r,t){return Um(Vi(r),_u(t,0,r.length))}function dEt(r,t){var e=Ko(r);return Um(e,_u(t,0,e.length))}function vEt(r,t,e){(e?Ai(r,t,e):t===void 0)?t=1:t=te(t);var i=It(r)?fEt:dEt;return i(r,t)}function sd(r,t,e){return r==null?r:rv(r,t,e)}function pEt(r,t,e,i){return i=typeof i=="function"?i:void 0,r==null?r:rv(r,t,e,i)}function gEt(r){return Um(Vi(r))}function mEt(r){return Um(Ko(r))}function yEt(r){var t=It(r)?gEt:mEt;return t(r)}var _Et="[object Map]",xEt="[object Set]";function qu(r){if(r==null)return 0;if(qi(r))return uh(r)?ch(r):r.length;var t=Qa(r);return t==_Et||t==xEt?r.size:wS(r).length}function CEt(r,t,e){var i=r==null?0:r.length;return i?(e&&typeof e!="number"&&Ai(r,t,e)?(t=0,e=i):(t=t==null?0:te(t),e=e===void 0?i:te(e)),jn(r,t,e)):[]}var EEt=lh(function(r,t,e){return r+(e?"_":"")+t.toLowerCase()}),SEt=EEt;function AEt(r,t){var e;return js(r,function(i,n,a){return e=t(i,n,a),!e}),!!e}function R6(r,t,e){var i=It(r)?HS:AEt;return e&&Ai(r,t,e)&&(t=void 0),i(r,Xt(t))}var TEt=ie(function(r,t){if(r==null)return[];var e=t.length;return e>1&&Ai(r,t[0],t[1])?t=[]:e>2&&Ai(t[0],t[1],t[2])&&(t=[t[0]]),v6(r,Qr(t,1),[])}),M6=TEt,bEt=4294967295,wEt=bEt-1,REt=Math.floor,MEt=Math.min;function yA(r,t,e,i){var n=0,a=r==null?0:r.length;if(a===0)return 0;t=e(t);for(var o=t!==t,s=t===null,l=gn(t),u=t===void 0;n<a;){var c=REt((n+a)/2),h=e(r[c]),f=h!==void 0,d=h===null,v=h===h,p=gn(h);if(o)var g=i||v;else u?g=v&&(i||f):s?g=v&&f&&(i||!d):l?g=v&&f&&!d&&(i||!p):d||p?g=!1:g=i?h<=t:h<t;g?n=c+1:a=c}return MEt(a,wEt)}var IEt=4294967295,LEt=IEt>>>1;function zm(r,t,e){var i=0,n=r==null?i:r.length;if(typeof t=="number"&&t===t&&n<=LEt){for(;i<n;){var a=i+n>>>1,o=r[a];o!==null&&!gn(o)&&(e?o<=t:o<t)?i=a+1:n=a}return n}return yA(r,t,fi,e)}function OEt(r,t){return zm(r,t)}function PEt(r,t,e){return yA(r,t,Xt(e))}function FEt(r,t){var e=r==null?0:r.length;if(e){var i=zm(r,t);if(i<e&&Ma(r[i],t))return i}return-1}function BEt(r,t){return zm(r,t,!0)}function DEt(r,t,e){return yA(r,t,Xt(e),!0)}function NEt(r,t){var e=r==null?0:r.length;if(e){var i=zm(r,t,!0)-1;if(Ma(r[i],t))return i}return-1}function I6(r,t){for(var e=-1,i=r.length,n=0,a=[];++e<i;){var o=r[e],s=t?t(o):o;if(!e||!Ma(s,l)){var l=s;a[n++]=o===0?0:o}}return a}function kEt(r){return r&&r.length?I6(r):[]}function UEt(r,t){return r&&r.length?I6(r,Xt(t)):[]}var zEt=4294967295;function _A(r,t,e){return e&&typeof e!="number"&&Ai(r,t,e)&&(t=e=void 0),e=e===void 0?zEt:e>>>0,e?(r=be(r),r&&(typeof t=="string"||t!=null&&!iA(t))&&(t=mn(t),!t&&sh(r))?Xs(Ea(r),0,e):r.split(t,e)):[]}var HEt="Expected a function",$Et=Math.max;function WEt(r,t){if(typeof r!="function")throw new TypeError(HEt);return t=t==null?0:$Et(te(t),0),ie(function(e){var i=e[t],n=Xs(e,0,t);return i&&Gs(n,i),yn(r,this,n)})}var VEt=lh(function(r,t,e){return r+(e?" ":"")+PS(t)}),GEt=VEt;function XEt(r,t,e){return r=be(r),e=e==null?0:_u(te(e),0,r.length),t=mn(t),r.slice(e,e+t.length)==t}function YEt(){return{}}function jEt(){return""}function L6(){return!0}var ZEt=mm(function(r,t){return r-t},0),qEt=ZEt;function KEt(r){return r&&r.length?sA(r,fi):0}function O6(r,t){return r&&r.length?sA(r,Xt(t)):0}function QEt(r){var t=r==null?0:r.length;return t?jn(r,1,t):[]}function JEt(r,t,e){return r&&r.length?(t=e||t===void 0?1:te(t),jn(r,0,t<0?0:t)):[]}function tSt(r,t,e){var i=r==null?0:r.length;return i?(t=e||t===void 0?1:te(t),t=i-t,jn(r,t<0?0:t,i)):[]}function eSt(r,t){return r&&r.length?Im(r,Xt(t),!1,!0):[]}function rSt(r,t){return r&&r.length?Im(r,Xt(t)):[]}function iSt(r,t){return t(r),r}var P6=Object.prototype,nSt=P6.hasOwnProperty;function MI(r,t,e,i){return r===void 0||Ma(r,P6[e])&&!nSt.call(i,e)?t:r}var aSt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};function oSt(r){return"\\"+aSt[r]}var sSt=/<%=([\s\S]+?)%>/g,F6=sSt,lSt=/<%-([\s\S]+?)%>/g,uSt=lSt,cSt=/<%([\s\S]+?)%>/g,hSt=cSt,fSt={escape:uSt,evaluate:hSt,interpolate:F6,variable:"",imports:{_:{escape:QS}}},Kx=fSt,dSt="Invalid `variable` option passed into `_.template`",vSt=/\b__p \+= '';/g,pSt=/\b(__p \+=) '' \+/g,gSt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,mSt=/[()=,{}\[\]\/\s]/,ySt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mp=/($^)/,_St=/['\n\r\u2028\u2029\\]/g,xSt=Object.prototype,II=xSt.hasOwnProperty;function CSt(r,t,e){var i=Kx.imports._.templateSettings||Kx;e&&Ai(r,t,e)&&(t=void 0),r=be(r),t=o0({},t,i,MI);var n=o0({},t.imports,i.imports,MI),a=ir(n),o=tA(n,a),s,l,u=0,c=t.interpolate||mp,h="__p += '",f=RegExp((t.escape||mp).source+"|"+c.source+"|"+(c===F6?ySt:mp).source+"|"+(t.evaluate||mp).source+"|$","g"),d=II.call(t,"sourceURL")?"//# sourceURL="+(t.sourceURL+"").replace(/\s/g," ")+`
`:"";r.replace(f,function(g,m,y,_,x,C){return y||(y=_),h+=r.slice(u,C).replace(_St,oSt),m&&(s=!0,h+=`' +
__e(`+m+`) +
'`),x&&(l=!0,h+=`';
`+x+`;
__p += '`),y&&(h+=`' +
((__t = (`+y+`)) == null ? '' : __t) +
'`),u=C+g.length,g}),h+=`';
`;var v=II.call(t,"variable")&&t.variable;if(!v)h=`with (obj) {
`+h+`
}
`;else if(mSt.test(v))throw new Error(dSt);h=(l?h.replace(vSt,""):h).replace(pSt,"$1").replace(gSt,"$1;"),h="function("+(v||"obj")+`) {
`+(v?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(s?", __e = _.escape":"")+(l?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+h+`return __p
}`;var p=N4(function(){return Function(a,d+"return "+h).apply(void 0,o)});if(p.source=h,IS(p))throw p;return p}var ESt="Expected a function";function xA(r,t,e){var i=!0,n=!0;if(typeof r!="function")throw new TypeError(ESt);return Oe(e)&&(i="leading"in e?!!e.leading:i,n="trailing"in e?!!e.trailing:n),od(r,t,{leading:i,maxWait:t,trailing:n})}function iv(r,t){return t(r)}var SSt=9007199254740991,S_=4294967295,ASt=Math.min;function TSt(r,t){if(r=te(r),r<1||r>SSt)return[];var e=S_,i=ASt(r,S_);t=lo(t),r-=S_;for(var n=TS(i,t);++e<r;)t(e);return n}function bSt(){return this}function B6(r,t){var e=r;return e instanceof ce&&(e=e.value()),FS(t,function(i,n){return n.func.apply(n.thisArg,Gs([i],n.args))},e)}function A_(){return B6(this.__wrapped__,this.__actions__)}function wSt(r){return be(r).toLowerCase()}function RSt(r){return It(r)?Ke(r,oo):gn(r)?[r]:Vi(F4(be(r)))}var LI=9007199254740991;function MSt(r){return r?_u(te(r),-LI,LI):r===0?r:0}function ld(r){return be(r).toUpperCase()}function ISt(r,t,e){var i=It(r),n=i||Fs(r)||oh(r);if(t=Xt(t),e==null){var a=r&&r.constructor;n?e=i?new a:[]:Oe(r)?e=Zr(a)?rh(bm(r)):{}:e={}}return(n?Qn:so)(r,function(o,s,l){return t(e,o,s,l)}),e}function D6(r,t){for(var e=r.length;e--&&ih(t,r[e],0)>-1;);return e}function N6(r,t){for(var e=-1,i=r.length;++e<i&&ih(t,r[e],0)>-1;);return e}function LSt(r,t,e){if(r=be(r),r&&(e||t===void 0))return p4(r);if(!r||!(t=mn(t)))return r;var i=Ea(r),n=Ea(t),a=N6(i,n),o=D6(i,n)+1;return Xs(i,a,o).join("")}function OSt(r,t,e){if(r=be(r),r&&(e||t===void 0))return r.slice(0,v4(r)+1);if(!r||!(t=mn(t)))return r;var i=Ea(r),n=D6(i,Ea(t))+1;return Xs(i,0,n).join("")}var PSt=/^\s+/;function FSt(r,t,e){if(r=be(r),r&&(e||t===void 0))return r.replace(PSt,"");if(!r||!(t=mn(t)))return r;var i=Ea(r),n=N6(i,Ea(t));return Xs(i,n).join("")}var BSt=30,DSt="...",NSt=/\w*$/;function kSt(r,t){var e=BSt,i=DSt;if(Oe(t)){var n="separator"in t?t.separator:n;e="length"in t?te(t.length):e,i="omission"in t?mn(t.omission):i}r=be(r);var a=r.length;if(sh(r)){var o=Ea(r);a=o.length}if(e>=a)return r;var s=e-ch(i);if(s<1)return i;var l=o?Xs(o,0,s).join(""):r.slice(0,s);if(n===void 0)return l+i;if(o&&(s+=l.length-s),iA(n)){if(r.slice(s).search(n)){var u,c=l;for(n.global||(n=RegExp(n.source,be(NSt.exec(n))+"g")),n.lastIndex=0;u=n.exec(c);)var h=u.index;l=l.slice(0,h===void 0?s:h)}}else if(r.indexOf(mn(n),s)!=s){var f=l.lastIndexOf(n);f>-1&&(l=l.slice(0,f))}return l+i}function USt(r){return b4(r,1)}var zSt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},HSt=BS(zSt),$St=HSt,k6=/&(?:amp|lt|gt|quot|#39);/g,WSt=RegExp(k6.source);function VSt(r){return r=be(r),r&&WSt.test(r)?r.replace(k6,$St):r}var GSt=1/0,XSt=hc&&1/wm(new hc([,-0]))[1]==GSt?function(r){return new hc(r)}:_m,YSt=XSt,jSt=200;function Bs(r,t,e){var i=-1,n=Cm,a=r.length,o=!0,s=[],l=s;if(e)o=!1,n=qS;else if(a>=jSt){var u=t?null:YSt(r);if(u)return wm(u);o=!1,n=ad,l=new Ql}else l=t?[]:s;t:for(;++i<a;){var c=r[i],h=t?t(c):c;if(c=e||c!==0?c:0,o&&h===h){for(var f=l.length;f--;)if(l[f]===h)continue t;t&&l.push(h),s.push(c)}else n(l,h,e)||(l!==s&&l.push(h),s.push(c))}return s}var ZSt=ie(function(r){return Bs(Qr(r,1,dr,!0))}),qSt=ZSt,KSt=ie(function(r){var t=Pe(r);return dr(t)&&(t=void 0),Bs(Qr(r,1,dr,!0),Xt(t))}),QSt=KSt,JSt=ie(function(r){var t=Pe(r);return t=typeof t=="function"?t:void 0,Bs(Qr(r,1,dr,!0),void 0,t)}),tAt=JSt;function So(r){return r&&r.length?Bs(r):[]}function eAt(r,t){return r&&r.length?Bs(r,Xt(t)):[]}function rAt(r,t){return t=typeof t=="function"?t:void 0,r&&r.length?Bs(r,void 0,t):[]}var iAt=0;function nAt(r){var t=++iAt;return be(r)+t}function Qx(r,t){return r==null?!0:uA(r,t)}var aAt=Math.max;function CA(r){if(!(r&&r.length))return[];var t=0;return r=Ys(r,function(e){if(dr(e))return t=aAt(e.length,t),!0}),TS(t,function(e){return Ke(r,GS(e))})}function U6(r,t){if(!(r&&r.length))return[];var e=CA(r);return t==null?e:Ke(e,function(i){return yn(t,void 0,i)})}function z6(r,t,e,i){return rv(r,t,e(yu(r,t)),i)}function oAt(r,t,e){return r==null?r:z6(r,t,lo(e))}function sAt(r,t,e,i){return i=typeof i=="function"?i:void 0,r==null?r:z6(r,t,lo(e),i)}var lAt=lh(function(r,t,e){return r+(e?" ":"")+t.toUpperCase()}),uAt=lAt;function cAt(r){return r==null?[]:tA(r,Ki(r))}var hAt=ie(function(r,t){return dr(r)?Qd(r,t):[]}),fAt=hAt;function dAt(r,t){return C6(lo(t),r)}var vAt=Zo(function(r){var t=r.length,e=t?r[0]:0,i=this.__wrapped__,n=function(a){return MS(a,r)};return t>1||this.__actions__.length||!(i instanceof ce)||!Vo(e)?this.thru(n):(i=i.slice(e,+e+(t?1:0)),i.__actions__.push({func:iv,args:[n],thisArg:void 0}),new Xn(i,this.__chain__).thru(function(a){return t&&!a.length&&a.push(void 0),a}))}),pAt=vAt;function gAt(){return uN(this)}function mAt(){var r=this.__wrapped__;if(r instanceof ce){var t=r;return this.__actions__.length&&(t=new ce(this)),t=t.reverse(),t.__actions__.push({func:iv,args:[qx],thisArg:void 0}),new Xn(t,this.__chain__)}return this.thru(qx)}function EA(r,t,e){var i=r.length;if(i<2)return i?Bs(r[0]):[];for(var n=-1,a=Array(i);++n<i;)for(var o=r[n],s=-1;++s<i;)s!=n&&(a[n]=Qd(a[n]||o,r[s],t,e));return Bs(Qr(a,1),t,e)}var yAt=ie(function(r){return EA(Ys(r,dr))}),_At=yAt,xAt=ie(function(r){var t=Pe(r);return dr(t)&&(t=void 0),EA(Ys(r,dr),Xt(t))}),CAt=xAt,EAt=ie(function(r){var t=Pe(r);return t=typeof t=="function"?t:void 0,EA(Ys(r,dr),void 0,t)}),SAt=EAt,AAt=ie(CA),Hm=AAt;function H6(r,t,e){for(var i=-1,n=r.length,a=t.length,o={};++i<n;){var s=i<a?t[i]:void 0;e(o,r[i],s)}return o}function TAt(r,t){return H6(r||[],t||[],Yd)}function bAt(r,t){return H6(r||[],t||[],rv)}var wAt=ie(function(r){var t=r.length,e=t>1?r[t-1]:void 0;return e=typeof e=="function"?(r.pop(),e):void 0,U6(r,e)}),RAt=wAt,St={chunk:ygt,compact:ma,concat:Zu,difference:NN,differenceBy:yyt,differenceWith:kN,drop:Eyt,dropRight:Syt,dropRightWhile:Ayt,dropWhile:Tyt,fill:Gyt,findIndex:Dc,findLastIndex:ZN,first:tu,flatten:B4,flattenDeep:KN,flattenDepth:i_t,fromPairs:x_t,head:tu,indexOf:Bm,initial:z_t,intersection:t6,intersectionBy:V_t,intersectionWith:X_t,join:$1t,last:Pe,lastIndexOf:q1t,nth:Axt,pull:MCt,pullAll:S6,pullAllBy:ICt,pullAllWith:LCt,pullAt:BCt,remove:tEt,reverse:qx,slice:CEt,sortedIndex:OEt,sortedIndexBy:PEt,sortedIndexOf:FEt,sortedLastIndex:BEt,sortedLastIndexBy:DEt,sortedLastIndexOf:NEt,sortedUniq:kEt,sortedUniqBy:UEt,tail:QEt,take:JEt,takeRight:tSt,takeRightWhile:eSt,takeWhile:rSt,union:qSt,unionBy:QSt,unionWith:tAt,uniq:So,uniqBy:eAt,uniqWith:rAt,unzip:CA,unzipWith:U6,without:fAt,xor:_At,xorBy:CAt,xorWith:SAt,zip:Hm,zipObject:TAt,zipObjectDeep:bAt,zipWith:RAt},De={countBy:jmt,each:Ht,eachRight:xI,every:Lm,filter:qo,find:ci,findLast:Om,flatMap:Jd,flatMapDeep:t_t,flatMapDepth:e_t,forEach:Ht,forEachRight:xI,groupBy:b_t,includes:Ei,invokeMap:a1t,keyBy:X1t,map:se,orderBy:fA,partition:CCt,reduce:km,reduceRight:QCt,reject:JCt,sample:hEt,sampleSize:vEt,shuffle:yEt,size:qu,some:R6,sortBy:M6},MAt={now:ng},ur={after:Sht,ary:b4,before:k4,bind:U4,bindKey:tpt,curry:YS,curryRight:jS,debounce:od,defer:fyt,delay:vyt,flip:a_t,memoize:mu,negate:ev,once:Oxt,overArgs:Hxt,partial:C6,partialRight:_Ct,rearg:qCt,rest:nEt,spread:WEt,throttle:xA,unary:USt,wrap:dAt},Pt={castArray:hgt,clone:qd,cloneDeep:Hx,cloneDeepWith:tmt,cloneWith:rmt,conformsTo:zmt,eq:Ma,gt:R_t,gte:I_t,isArguments:ql,isArray:It,isArrayBuffer:u1t,isArrayLike:qi,isArrayLikeObject:dr,isBoolean:za,isBuffer:Fs,isDate:v1t,isElement:p1t,isEmpty:at,isEqual:jr,isEqualWith:x1t,isError:IS,isFinite:E1t,isFunction:Zr,isInteger:n6,isLength:Sm,isMap:mN,isMatch:S1t,isMatchWith:A1t,isNaN:a6,isNative:M1t,isNil:wr,isNull:o6,isNumber:yi,isObject:Oe,isObjectLike:lr,isPlainObject:Zd,isRegExp:iA,isSafeInteger:P1t,isSet:yN,isString:uh,isSymbol:gn,isTypedArray:oh,isUndefined:Dm,isWeakMap:B1t,isWeakSet:N1t,lt:ext,lte:ixt,toArray:c6,toFinite:Fo,toInteger:te,toLength:GN,toNumber:hn,toPlainObject:FN,toSafeInteger:MSt,toString:be},wi={add:vht,ceil:pgt,divide:Cyt,floor:s_t,max:Nc,maxBy:oA,mean:uxt,meanBy:cxt,min:lA,minBy:gxt,multiply:yxt,round:uEt,subtract:qEt,sum:KEt,sumBy:O6},SA={clamp:s0,inRange:Gx,random:HCt},Wt={assign:P4,assignIn:K3,assignInWith:o0,assignWith:Qdt,at:Dvt,create:Zmt,defaults:ayt,defaultsDeep:uyt,entries:CI,entriesIn:EI,extend:K3,extendWith:o0,findKey:jyt,findLastKey:Qyt,forIn:JN,forInRight:m_t,forOwn:y_t,forOwnRight:__t,functions:C_t,functionsIn:E_t,get:Nt,has:Vx,hasIn:Jl,invert:K_t,invertBy:e1t,invoke:i1t,keys:ir,keysIn:Ki,mapKeys:s6,mapValues:nxt,merge:u0,mergeWith:ZS,omit:cA,omitBy:Lxt,pick:E6,pickBy:hA,result:aEt,set:sd,setWith:pEt,toPairs:CI,toPairsIn:EI,transform:ISt,unset:Qx,update:oAt,updateWith:sAt,values:Ko,valuesIn:cAt},uo={at:pAt,chain:uN,commit:imt,lodash:I,next:Sxt,plant:ACt,reverse:mAt,tap:iSt,thru:iv,toIterator:bSt,toJSON:A_,value:A_,valueOf:A_,wrapperChain:gAt},Re={camelCase:cgt,capitalize:Y4,deburr:j4,endsWith:Myt,escape:QS,escapeRegExp:Hyt,kebabCase:V1t,lowerCase:nA,lowerFirst:J1t,pad:hCt,padEnd:fCt,padStart:dCt,parseInt:gCt,repeat:eEt,replace:rEt,snakeCase:SEt,split:_A,startCase:GEt,startsWith:XEt,template:CSt,templateSettings:Kx,toLower:wSt,toUpper:ld,trim:LSt,trimEnd:OSt,trimStart:FSt,truncate:kSt,unescape:VSt,upperCase:uAt,upperFirst:PS,words:lN},Ie={attempt:N4,bindAll:qvt,cond:MN,conforms:Umt,constant:cc,defaultTo:ryt,flow:v_t,flowRight:g_t,identity:fi,iteratee:U1t,matches:Xx,matchesProperty:sxt,method:dxt,methodOf:pxt,mixin:u6,noop:_m,nthArg:Txt,over:Dxt,overEvery:Wxt,overSome:Gxt,property:RN,propertyOf:TCt,range:fc,rangeRight:YCt,stubArray:NS,stubFalse:bS,stubObject:YEt,stubString:jEt,stubTrue:L6,times:TSt,toPath:RSt,uniqueId:nAt};function IAt(){var r=new ce(this.__wrapped__);return r.__actions__=Vi(this.__actions__),r.__dir__=this.__dir__,r.__filtered__=this.__filtered__,r.__iteratees__=Vi(this.__iteratees__),r.__takeCount__=this.__takeCount__,r.__views__=Vi(this.__views__),r}function LAt(){if(this.__filtered__){var r=new ce(this);r.__dir__=-1,r.__filtered__=!0}else r=this.clone(),r.__dir__*=-1;return r}var OAt=Math.max,PAt=Math.min;function FAt(r,t,e){for(var i=-1,n=e.length;++i<n;){var a=e[i],o=a.size;switch(a.type){case"drop":r+=o;break;case"dropRight":t-=o;break;case"take":t=PAt(t,r+o);break;case"takeRight":r=OAt(r,t-o);break}}return{start:r,end:t}}var BAt=1,DAt=2,NAt=Math.min;function kAt(){var r=this.__wrapped__.value(),t=this.__dir__,e=It(r),i=t<0,n=e?r.length:0,a=FAt(0,n,this.__views__),o=a.start,s=a.end,l=s-o,u=i?s:o-1,c=this.__iteratees__,h=c.length,f=0,d=NAt(l,this.__takeCount__);if(!e||!i&&n==l&&d==l)return B6(r,this.__actions__);var v=[];t:for(;l--&&f<d;){u+=t;for(var p=-1,g=r[u];++p<h;){var m=c[p],y=m.iteratee,_=m.type,x=y(g);if(_==DAt)g=x;else if(!x){if(_==BAt)continue t;break t}}v[f++]=g}return v}/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var UAt="4.17.21",zAt=2,HAt=1,$At=3,$6=4294967295,WAt=Array.prototype,VAt=Object.prototype,W6=VAt.hasOwnProperty,OI=ui?ui.iterator:void 0,GAt=Math.max,PI=Math.min,AA=function(r){return function(t,e,i){if(i==null){var n=Oe(e),a=n&&ir(e),o=a&&a.length&&Pm(e,a);(o?o.length:n)||(i=e,e=t,t=this)}return r(t,e,i)}}(u6);I.after=ur.after;I.ary=ur.ary;I.assign=Wt.assign;I.assignIn=Wt.assignIn;I.assignInWith=Wt.assignInWith;I.assignWith=Wt.assignWith;I.at=Wt.at;I.before=ur.before;I.bind=ur.bind;I.bindAll=Ie.bindAll;I.bindKey=ur.bindKey;I.castArray=Pt.castArray;I.chain=uo.chain;I.chunk=St.chunk;I.compact=St.compact;I.concat=St.concat;I.cond=Ie.cond;I.conforms=Ie.conforms;I.constant=Ie.constant;I.countBy=De.countBy;I.create=Wt.create;I.curry=ur.curry;I.curryRight=ur.curryRight;I.debounce=ur.debounce;I.defaults=Wt.defaults;I.defaultsDeep=Wt.defaultsDeep;I.defer=ur.defer;I.delay=ur.delay;I.difference=St.difference;I.differenceBy=St.differenceBy;I.differenceWith=St.differenceWith;I.drop=St.drop;I.dropRight=St.dropRight;I.dropRightWhile=St.dropRightWhile;I.dropWhile=St.dropWhile;I.fill=St.fill;I.filter=De.filter;I.flatMap=De.flatMap;I.flatMapDeep=De.flatMapDeep;I.flatMapDepth=De.flatMapDepth;I.flatten=St.flatten;I.flattenDeep=St.flattenDeep;I.flattenDepth=St.flattenDepth;I.flip=ur.flip;I.flow=Ie.flow;I.flowRight=Ie.flowRight;I.fromPairs=St.fromPairs;I.functions=Wt.functions;I.functionsIn=Wt.functionsIn;I.groupBy=De.groupBy;I.initial=St.initial;I.intersection=St.intersection;I.intersectionBy=St.intersectionBy;I.intersectionWith=St.intersectionWith;I.invert=Wt.invert;I.invertBy=Wt.invertBy;I.invokeMap=De.invokeMap;I.iteratee=Ie.iteratee;I.keyBy=De.keyBy;I.keys=ir;I.keysIn=Wt.keysIn;I.map=De.map;I.mapKeys=Wt.mapKeys;I.mapValues=Wt.mapValues;I.matches=Ie.matches;I.matchesProperty=Ie.matchesProperty;I.memoize=ur.memoize;I.merge=Wt.merge;I.mergeWith=Wt.mergeWith;I.method=Ie.method;I.methodOf=Ie.methodOf;I.mixin=AA;I.negate=ev;I.nthArg=Ie.nthArg;I.omit=Wt.omit;I.omitBy=Wt.omitBy;I.once=ur.once;I.orderBy=De.orderBy;I.over=Ie.over;I.overArgs=ur.overArgs;I.overEvery=Ie.overEvery;I.overSome=Ie.overSome;I.partial=ur.partial;I.partialRight=ur.partialRight;I.partition=De.partition;I.pick=Wt.pick;I.pickBy=Wt.pickBy;I.property=Ie.property;I.propertyOf=Ie.propertyOf;I.pull=St.pull;I.pullAll=St.pullAll;I.pullAllBy=St.pullAllBy;I.pullAllWith=St.pullAllWith;I.pullAt=St.pullAt;I.range=Ie.range;I.rangeRight=Ie.rangeRight;I.rearg=ur.rearg;I.reject=De.reject;I.remove=St.remove;I.rest=ur.rest;I.reverse=St.reverse;I.sampleSize=De.sampleSize;I.set=Wt.set;I.setWith=Wt.setWith;I.shuffle=De.shuffle;I.slice=St.slice;I.sortBy=De.sortBy;I.sortedUniq=St.sortedUniq;I.sortedUniqBy=St.sortedUniqBy;I.split=Re.split;I.spread=ur.spread;I.tail=St.tail;I.take=St.take;I.takeRight=St.takeRight;I.takeRightWhile=St.takeRightWhile;I.takeWhile=St.takeWhile;I.tap=uo.tap;I.throttle=ur.throttle;I.thru=iv;I.toArray=Pt.toArray;I.toPairs=Wt.toPairs;I.toPairsIn=Wt.toPairsIn;I.toPath=Ie.toPath;I.toPlainObject=Pt.toPlainObject;I.transform=Wt.transform;I.unary=ur.unary;I.union=St.union;I.unionBy=St.unionBy;I.unionWith=St.unionWith;I.uniq=St.uniq;I.uniqBy=St.uniqBy;I.uniqWith=St.uniqWith;I.unset=Wt.unset;I.unzip=St.unzip;I.unzipWith=St.unzipWith;I.update=Wt.update;I.updateWith=Wt.updateWith;I.values=Wt.values;I.valuesIn=Wt.valuesIn;I.without=St.without;I.words=Re.words;I.wrap=ur.wrap;I.xor=St.xor;I.xorBy=St.xorBy;I.xorWith=St.xorWith;I.zip=St.zip;I.zipObject=St.zipObject;I.zipObjectDeep=St.zipObjectDeep;I.zipWith=St.zipWith;I.entries=Wt.toPairs;I.entriesIn=Wt.toPairsIn;I.extend=Wt.assignIn;I.extendWith=Wt.assignInWith;AA(I,I);I.add=wi.add;I.attempt=Ie.attempt;I.camelCase=Re.camelCase;I.capitalize=Re.capitalize;I.ceil=wi.ceil;I.clamp=SA.clamp;I.clone=Pt.clone;I.cloneDeep=Pt.cloneDeep;I.cloneDeepWith=Pt.cloneDeepWith;I.cloneWith=Pt.cloneWith;I.conformsTo=Pt.conformsTo;I.deburr=Re.deburr;I.defaultTo=Ie.defaultTo;I.divide=wi.divide;I.endsWith=Re.endsWith;I.eq=Pt.eq;I.escape=Re.escape;I.escapeRegExp=Re.escapeRegExp;I.every=De.every;I.find=De.find;I.findIndex=St.findIndex;I.findKey=Wt.findKey;I.findLast=De.findLast;I.findLastIndex=St.findLastIndex;I.findLastKey=Wt.findLastKey;I.floor=wi.floor;I.forEach=De.forEach;I.forEachRight=De.forEachRight;I.forIn=Wt.forIn;I.forInRight=Wt.forInRight;I.forOwn=Wt.forOwn;I.forOwnRight=Wt.forOwnRight;I.get=Wt.get;I.gt=Pt.gt;I.gte=Pt.gte;I.has=Wt.has;I.hasIn=Wt.hasIn;I.head=St.head;I.identity=fi;I.includes=De.includes;I.indexOf=St.indexOf;I.inRange=SA.inRange;I.invoke=Wt.invoke;I.isArguments=Pt.isArguments;I.isArray=It;I.isArrayBuffer=Pt.isArrayBuffer;I.isArrayLike=Pt.isArrayLike;I.isArrayLikeObject=Pt.isArrayLikeObject;I.isBoolean=Pt.isBoolean;I.isBuffer=Pt.isBuffer;I.isDate=Pt.isDate;I.isElement=Pt.isElement;I.isEmpty=Pt.isEmpty;I.isEqual=Pt.isEqual;I.isEqualWith=Pt.isEqualWith;I.isError=Pt.isError;I.isFinite=Pt.isFinite;I.isFunction=Pt.isFunction;I.isInteger=Pt.isInteger;I.isLength=Pt.isLength;I.isMap=Pt.isMap;I.isMatch=Pt.isMatch;I.isMatchWith=Pt.isMatchWith;I.isNaN=Pt.isNaN;I.isNative=Pt.isNative;I.isNil=Pt.isNil;I.isNull=Pt.isNull;I.isNumber=Pt.isNumber;I.isObject=Oe;I.isObjectLike=Pt.isObjectLike;I.isPlainObject=Pt.isPlainObject;I.isRegExp=Pt.isRegExp;I.isSafeInteger=Pt.isSafeInteger;I.isSet=Pt.isSet;I.isString=Pt.isString;I.isSymbol=Pt.isSymbol;I.isTypedArray=Pt.isTypedArray;I.isUndefined=Pt.isUndefined;I.isWeakMap=Pt.isWeakMap;I.isWeakSet=Pt.isWeakSet;I.join=St.join;I.kebabCase=Re.kebabCase;I.last=Pe;I.lastIndexOf=St.lastIndexOf;I.lowerCase=Re.lowerCase;I.lowerFirst=Re.lowerFirst;I.lt=Pt.lt;I.lte=Pt.lte;I.max=wi.max;I.maxBy=wi.maxBy;I.mean=wi.mean;I.meanBy=wi.meanBy;I.min=wi.min;I.minBy=wi.minBy;I.stubArray=Ie.stubArray;I.stubFalse=Ie.stubFalse;I.stubObject=Ie.stubObject;I.stubString=Ie.stubString;I.stubTrue=Ie.stubTrue;I.multiply=wi.multiply;I.nth=St.nth;I.noop=Ie.noop;I.now=MAt.now;I.pad=Re.pad;I.padEnd=Re.padEnd;I.padStart=Re.padStart;I.parseInt=Re.parseInt;I.random=SA.random;I.reduce=De.reduce;I.reduceRight=De.reduceRight;I.repeat=Re.repeat;I.replace=Re.replace;I.result=Wt.result;I.round=wi.round;I.sample=De.sample;I.size=De.size;I.snakeCase=Re.snakeCase;I.some=De.some;I.sortedIndex=St.sortedIndex;I.sortedIndexBy=St.sortedIndexBy;I.sortedIndexOf=St.sortedIndexOf;I.sortedLastIndex=St.sortedLastIndex;I.sortedLastIndexBy=St.sortedLastIndexBy;I.sortedLastIndexOf=St.sortedLastIndexOf;I.startCase=Re.startCase;I.startsWith=Re.startsWith;I.subtract=wi.subtract;I.sum=wi.sum;I.sumBy=wi.sumBy;I.template=Re.template;I.times=Ie.times;I.toFinite=Pt.toFinite;I.toInteger=te;I.toLength=Pt.toLength;I.toLower=Re.toLower;I.toNumber=Pt.toNumber;I.toSafeInteger=Pt.toSafeInteger;I.toString=Pt.toString;I.toUpper=Re.toUpper;I.trim=Re.trim;I.trimEnd=Re.trimEnd;I.trimStart=Re.trimStart;I.truncate=Re.truncate;I.unescape=Re.unescape;I.uniqueId=Ie.uniqueId;I.upperCase=Re.upperCase;I.upperFirst=Re.upperFirst;I.each=De.forEach;I.eachRight=De.forEachRight;I.first=St.head;AA(I,function(){var r={};return so(I,function(t,e){W6.call(I.prototype,e)||(r[e]=t)}),r}(),{chain:!1});I.VERSION=UAt;(I.templateSettings=Re.templateSettings).imports._=I;Qn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(r){I[r].placeholder=I});Qn(["drop","take"],function(r,t){ce.prototype[r]=function(e){e=e===void 0?1:GAt(te(e),0);var i=this.__filtered__&&!t?new ce(this):this.clone();return i.__filtered__?i.__takeCount__=PI(e,i.__takeCount__):i.__views__.push({size:PI(e,$6),type:r+(i.__dir__<0?"Right":"")}),i},ce.prototype[r+"Right"]=function(e){return this.reverse()[r](e).reverse()}});Qn(["filter","map","takeWhile"],function(r,t){var e=t+1,i=e==HAt||e==$At;ce.prototype[r]=function(n){var a=this.clone();return a.__iteratees__.push({iteratee:Xt(n),type:e}),a.__filtered__=a.__filtered__||i,a}});Qn(["head","last"],function(r,t){var e="take"+(t?"Right":"");ce.prototype[r]=function(){return this[e](1).value()[0]}});Qn(["initial","tail"],function(r,t){var e="drop"+(t?"":"Right");ce.prototype[r]=function(){return this.__filtered__?new ce(this):this[e](1)}});ce.prototype.compact=function(){return this.filter(fi)};ce.prototype.find=function(r){return this.filter(r).head()};ce.prototype.findLast=function(r){return this.reverse().find(r)};ce.prototype.invokeMap=ie(function(r,t){return typeof r=="function"?new ce(this):this.map(function(e){return tv(e,r,t)})});ce.prototype.reject=function(r){return this.filter(ev(Xt(r)))};ce.prototype.slice=function(r,t){r=te(r);var e=this;return e.__filtered__&&(r>0||t<0)?new ce(e):(r<0?e=e.takeRight(-r):r&&(e=e.drop(r)),t!==void 0&&(t=te(t),e=t<0?e.dropRight(-t):e.take(t-r)),e)};ce.prototype.takeRightWhile=function(r){return this.reverse().takeWhile(r).reverse()};ce.prototype.toArray=function(){return this.take($6)};so(ce.prototype,function(r,t){var e=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),n=I[i?"take"+(t=="last"?"Right":""):t],a=i||/^find/.test(t);n&&(I.prototype[t]=function(){var o=this.__wrapped__,s=i?[1]:arguments,l=o instanceof ce,u=s[0],c=l||It(o),h=function(m){var y=n.apply(I,Gs([m],s));return i&&f?y[0]:y};c&&e&&typeof u=="function"&&u.length!=1&&(l=c=!1);var f=this.__chain__,d=!!this.__actions__.length,v=a&&!f,p=l&&!d;if(!a&&c){o=p?o:new ce(this);var g=r.apply(o,s);return g.__actions__.push({func:iv,args:[h],thisArg:void 0}),new Xn(g,f)}return v&&p?r.apply(this,s):(g=this.thru(h),v?i?g.value()[0]:g.value():g)})});Qn(["pop","push","shift","sort","splice","unshift"],function(r){var t=WAt[r],e=/^(?:push|sort|unshift)$/.test(r)?"tap":"thru",i=/^(?:pop|shift)$/.test(r);I.prototype[r]=function(){var n=arguments;if(i&&!this.__chain__){var a=this.value();return t.apply(It(a)?a:[],n)}return this[e](function(o){return t.apply(It(o)?o:[],n)})}});so(ce.prototype,function(r,t){var e=I[t];if(e){var i=e.name+"";W6.call(uc,i)||(uc[i]=[]),uc[i].push({name:t,func:e})}});uc[Em(void 0,zAt).name]=[{name:"wrapper",func:void 0}];ce.prototype.clone=IAt;ce.prototype.reverse=LAt;ce.prototype.value=kAt;I.prototype.at=uo.at;I.prototype.chain=uo.wrapperChain;I.prototype.commit=uo.commit;I.prototype.next=uo.next;I.prototype.plant=uo.plant;I.prototype.reverse=uo.reverse;I.prototype.toJSON=I.prototype.valueOf=I.prototype.value=uo.value;I.prototype.first=I.prototype.head;OI&&(I.prototype[OI]=uo.toIterator);function h0(r){"@babel/helpers - typeof";return h0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h0(r)}var XAt=/^\s+/,YAt=/\s+$/;function Tt(r,t){if(r=r||"",t=t||{},r instanceof Tt)return r;if(!(this instanceof Tt))return new Tt(r,t);var e=jAt(r);this._originalInput=r,this._r=e.r,this._g=e.g,this._b=e.b,this._a=e.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||e.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=e.ok}Tt.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},getLuminance:function(){var t=this.toRgb(),e,i,n,a,o,s;return e=t.r/255,i=t.g/255,n=t.b/255,e<=.03928?a=e/12.92:a=Math.pow((e+.055)/1.055,2.4),i<=.03928?o=i/12.92:o=Math.pow((i+.055)/1.055,2.4),n<=.03928?s=n/12.92:s=Math.pow((n+.055)/1.055,2.4),.2126*a+.7152*o+.0722*s},setAlpha:function(t){return this._a=V6(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=BI(this._r,this._g,this._b);return{h:t.h*360,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=BI(this._r,this._g,this._b),e=Math.round(t.h*360),i=Math.round(t.s*100),n=Math.round(t.v*100);return this._a==1?"hsv("+e+", "+i+"%, "+n+"%)":"hsva("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var t=FI(this._r,this._g,this._b);return{h:t.h*360,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=FI(this._r,this._g,this._b),e=Math.round(t.h*360),i=Math.round(t.s*100),n=Math.round(t.l*100);return this._a==1?"hsl("+e+", "+i+"%, "+n+"%)":"hsla("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHex:function(t){return DI(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return QAt(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Ze(this._r,255)*100)+"%",g:Math.round(Ze(this._g,255)*100)+"%",b:Math.round(Ze(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Ze(this._r,255)*100)+"%, "+Math.round(Ze(this._g,255)*100)+"%, "+Math.round(Ze(this._b,255)*100)+"%)":"rgba("+Math.round(Ze(this._r,255)*100)+"%, "+Math.round(Ze(this._g,255)*100)+"%, "+Math.round(Ze(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:cTt[DI(this._r,this._g,this._b,!0)]||!1},toFilter:function(t){var e="#"+NI(this._r,this._g,this._b,this._a),i=e,n=this._gradientType?"GradientType = 1, ":"";if(t){var a=Tt(t);i="#"+NI(a._r,a._g,a._b,a._a)}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+e+",endColorstr="+i+")"},toString:function(t){var e=!!t;t=t||this._format;var i=!1,n=this._a<1&&this._a>=0,a=!e&&n&&(t==="hex"||t==="hex6"||t==="hex3"||t==="hex4"||t==="hex8"||t==="name");return a?t==="name"&&this._a===0?this.toName():this.toRgbString():(t==="rgb"&&(i=this.toRgbString()),t==="prgb"&&(i=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(i=this.toHexString()),t==="hex3"&&(i=this.toHexString(!0)),t==="hex4"&&(i=this.toHex8String(!0)),t==="hex8"&&(i=this.toHex8String()),t==="name"&&(i=this.toName()),t==="hsl"&&(i=this.toHslString()),t==="hsv"&&(i=this.toHsvString()),i||this.toHexString())},clone:function(){return Tt(this.toString())},_applyModification:function(t,e){var i=t.apply(null,[this].concat([].slice.call(e)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(rTt,arguments)},brighten:function(){return this._applyModification(iTt,arguments)},darken:function(){return this._applyModification(nTt,arguments)},desaturate:function(){return this._applyModification(JAt,arguments)},saturate:function(){return this._applyModification(tTt,arguments)},greyscale:function(){return this._applyModification(eTt,arguments)},spin:function(){return this._applyModification(aTt,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(lTt,arguments)},complement:function(){return this._applyCombination(oTt,arguments)},monochromatic:function(){return this._applyCombination(uTt,arguments)},splitcomplement:function(){return this._applyCombination(sTt,arguments)},triad:function(){return this._applyCombination(kI,[3])},tetrad:function(){return this._applyCombination(kI,[4])}};Tt.fromRatio=function(r,t){if(h0(r)=="object"){var e={};for(var i in r)r.hasOwnProperty(i)&&(i==="a"?e[i]=r[i]:e[i]=uf(r[i]));r=e}return Tt(r,t)};function jAt(r){var t={r:0,g:0,b:0},e=1,i=null,n=null,a=null,o=!1,s=!1;return typeof r=="string"&&(r=vTt(r)),h0(r)=="object"&&(go(r.r)&&go(r.g)&&go(r.b)?(t=ZAt(r.r,r.g,r.b),o=!0,s=String(r.r).substr(-1)==="%"?"prgb":"rgb"):go(r.h)&&go(r.s)&&go(r.v)?(i=uf(r.s),n=uf(r.v),t=KAt(r.h,i,n),o=!0,s="hsv"):go(r.h)&&go(r.s)&&go(r.l)&&(i=uf(r.s),a=uf(r.l),t=qAt(r.h,i,a),o=!0,s="hsl"),r.hasOwnProperty("a")&&(e=r.a)),e=V6(e),{ok:o,format:r.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:e}}function ZAt(r,t,e){return{r:Ze(r,255)*255,g:Ze(t,255)*255,b:Ze(e,255)*255}}function FI(r,t,e){r=Ze(r,255),t=Ze(t,255),e=Ze(e,255);var i=Math.max(r,t,e),n=Math.min(r,t,e),a,o,s=(i+n)/2;if(i==n)a=o=0;else{var l=i-n;switch(o=s>.5?l/(2-i-n):l/(i+n),i){case r:a=(t-e)/l+(t<e?6:0);break;case t:a=(e-r)/l+2;break;case e:a=(r-t)/l+4;break}a/=6}return{h:a,s:o,l:s}}function qAt(r,t,e){var i,n,a;r=Ze(r,360),t=Ze(t,100),e=Ze(e,100);function o(u,c,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?u+(c-u)*6*h:h<1/2?c:h<2/3?u+(c-u)*(2/3-h)*6:u}if(t===0)i=n=a=e;else{var s=e<.5?e*(1+t):e+t-e*t,l=2*e-s;i=o(l,s,r+1/3),n=o(l,s,r),a=o(l,s,r-1/3)}return{r:i*255,g:n*255,b:a*255}}function BI(r,t,e){r=Ze(r,255),t=Ze(t,255),e=Ze(e,255);var i=Math.max(r,t,e),n=Math.min(r,t,e),a,o,s=i,l=i-n;if(o=i===0?0:l/i,i==n)a=0;else{switch(i){case r:a=(t-e)/l+(t<e?6:0);break;case t:a=(e-r)/l+2;break;case e:a=(r-t)/l+4;break}a/=6}return{h:a,s:o,v:s}}function KAt(r,t,e){r=Ze(r,360)*6,t=Ze(t,100),e=Ze(e,100);var i=Math.floor(r),n=r-i,a=e*(1-t),o=e*(1-n*t),s=e*(1-(1-n)*t),l=i%6,u=[e,o,a,a,s,e][l],c=[s,e,e,o,a,a][l],h=[a,a,s,e,e,o][l];return{r:u*255,g:c*255,b:h*255}}function DI(r,t,e,i){var n=[ha(Math.round(r).toString(16)),ha(Math.round(t).toString(16)),ha(Math.round(e).toString(16))];return i&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0):n.join("")}function QAt(r,t,e,i,n){var a=[ha(Math.round(r).toString(16)),ha(Math.round(t).toString(16)),ha(Math.round(e).toString(16)),ha(G6(i))];return n&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}function NI(r,t,e,i){var n=[ha(G6(i)),ha(Math.round(r).toString(16)),ha(Math.round(t).toString(16)),ha(Math.round(e).toString(16))];return n.join("")}Tt.equals=function(r,t){return!r||!t?!1:Tt(r).toRgbString()==Tt(t).toRgbString()};Tt.random=function(){return Tt.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function JAt(r,t){t=t===0?0:t||10;var e=Tt(r).toHsl();return e.s-=t/100,e.s=$m(e.s),Tt(e)}function tTt(r,t){t=t===0?0:t||10;var e=Tt(r).toHsl();return e.s+=t/100,e.s=$m(e.s),Tt(e)}function eTt(r){return Tt(r).desaturate(100)}function rTt(r,t){t=t===0?0:t||10;var e=Tt(r).toHsl();return e.l+=t/100,e.l=$m(e.l),Tt(e)}function iTt(r,t){t=t===0?0:t||10;var e=Tt(r).toRgb();return e.r=Math.max(0,Math.min(255,e.r-Math.round(255*-(t/100)))),e.g=Math.max(0,Math.min(255,e.g-Math.round(255*-(t/100)))),e.b=Math.max(0,Math.min(255,e.b-Math.round(255*-(t/100)))),Tt(e)}function nTt(r,t){t=t===0?0:t||10;var e=Tt(r).toHsl();return e.l-=t/100,e.l=$m(e.l),Tt(e)}function aTt(r,t){var e=Tt(r).toHsl(),i=(e.h+t)%360;return e.h=i<0?360+i:i,Tt(e)}function oTt(r){var t=Tt(r).toHsl();return t.h=(t.h+180)%360,Tt(t)}function kI(r,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var e=Tt(r).toHsl(),i=[Tt(r)],n=360/t,a=1;a<t;a++)i.push(Tt({h:(e.h+a*n)%360,s:e.s,l:e.l}));return i}function sTt(r){var t=Tt(r).toHsl(),e=t.h;return[Tt(r),Tt({h:(e+72)%360,s:t.s,l:t.l}),Tt({h:(e+216)%360,s:t.s,l:t.l})]}function lTt(r,t,e){t=t||6,e=e||30;var i=Tt(r).toHsl(),n=360/e,a=[Tt(r)];for(i.h=(i.h-(n*t>>1)+720)%360;--t;)i.h=(i.h+n)%360,a.push(Tt(i));return a}function uTt(r,t){t=t||6;for(var e=Tt(r).toHsv(),i=e.h,n=e.s,a=e.v,o=[],s=1/t;t--;)o.push(Tt({h:i,s:n,v:a})),a=(a+s)%1;return o}Tt.mix=function(r,t,e){e=e===0?0:e||50;var i=Tt(r).toRgb(),n=Tt(t).toRgb(),a=e/100,o={r:(n.r-i.r)*a+i.r,g:(n.g-i.g)*a+i.g,b:(n.b-i.b)*a+i.b,a:(n.a-i.a)*a+i.a};return Tt(o)};Tt.readability=function(r,t){var e=Tt(r),i=Tt(t);return(Math.max(e.getLuminance(),i.getLuminance())+.05)/(Math.min(e.getLuminance(),i.getLuminance())+.05)};Tt.isReadable=function(r,t,e){var i=Tt.readability(r,t),n,a;switch(a=!1,n=pTt(e),n.level+n.size){case"AAsmall":case"AAAlarge":a=i>=4.5;break;case"AAlarge":a=i>=3;break;case"AAAsmall":a=i>=7;break}return a};Tt.mostReadable=function(r,t,e){var i=null,n=0,a,o,s,l;e=e||{},o=e.includeFallbackColors,s=e.level,l=e.size;for(var u=0;u<t.length;u++)a=Tt.readability(r,t[u]),a>n&&(n=a,i=Tt(t[u]));return Tt.isReadable(r,i,{level:s,size:l})||!o?i:(e.includeFallbackColors=!1,Tt.mostReadable(r,["#fff","#000"],e))};var Jx=Tt.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},cTt=Tt.hexNames=hTt(Jx);function hTt(r){var t={};for(var e in r)r.hasOwnProperty(e)&&(t[r[e]]=e);return t}function V6(r){return r=parseFloat(r),(isNaN(r)||r<0||r>1)&&(r=1),r}function Ze(r,t){fTt(r)&&(r="100%");var e=dTt(r);return r=Math.min(t,Math.max(0,parseFloat(r))),e&&(r=parseInt(r*t,10)/100),Math.abs(r-t)<1e-6?1:r%t/parseFloat(t)}function $m(r){return Math.min(1,Math.max(0,r))}function nn(r){return parseInt(r,16)}function fTt(r){return typeof r=="string"&&r.indexOf(".")!=-1&&parseFloat(r)===1}function dTt(r){return typeof r=="string"&&r.indexOf("%")!=-1}function ha(r){return r.length==1?"0"+r:""+r}function uf(r){return r<=1&&(r=r*100+"%"),r}function G6(r){return Math.round(parseFloat(r)*255).toString(16)}function UI(r){return nn(r)/255}var na=function(){var r="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",e="(?:"+t+")|(?:"+r+")",i="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?",n="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?";return{CSS_UNIT:new RegExp(e),rgb:new RegExp("rgb"+i),rgba:new RegExp("rgba"+n),hsl:new RegExp("hsl"+i),hsla:new RegExp("hsla"+n),hsv:new RegExp("hsv"+i),hsva:new RegExp("hsva"+n),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function go(r){return!!na.CSS_UNIT.exec(r)}function vTt(r){r=r.replace(XAt,"").replace(YAt,"").toLowerCase();var t=!1;if(Jx[r])r=Jx[r],t=!0;else if(r=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var e;return(e=na.rgb.exec(r))?{r:e[1],g:e[2],b:e[3]}:(e=na.rgba.exec(r))?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=na.hsl.exec(r))?{h:e[1],s:e[2],l:e[3]}:(e=na.hsla.exec(r))?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=na.hsv.exec(r))?{h:e[1],s:e[2],v:e[3]}:(e=na.hsva.exec(r))?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=na.hex8.exec(r))?{r:nn(e[1]),g:nn(e[2]),b:nn(e[3]),a:UI(e[4]),format:t?"name":"hex8"}:(e=na.hex6.exec(r))?{r:nn(e[1]),g:nn(e[2]),b:nn(e[3]),format:t?"name":"hex"}:(e=na.hex4.exec(r))?{r:nn(e[1]+""+e[1]),g:nn(e[2]+""+e[2]),b:nn(e[3]+""+e[3]),a:UI(e[4]+""+e[4]),format:t?"name":"hex8"}:(e=na.hex3.exec(r))?{r:nn(e[1]+""+e[1]),g:nn(e[2]+""+e[2]),b:nn(e[3]+""+e[3]),format:t?"name":"hex"}:!1}function pTt(r){var t,e;return r=r||{level:"AA",size:"small"},t=(r.level||"AA").toUpperCase(),e=(r.size||"small").toLowerCase(),t!=="AA"&&t!=="AAA"&&(t="AA"),e!=="small"&&e!=="large"&&(e="small"),{level:t,size:e}}var gTt="#FFFFFF",mTt="#000000",yTt=[95,85,75,30,15,0,15,30,45,60,80],_Tt=15,X6=function(r){return Tt(r).getLuminance()<=.5},xTt=function(r,t){return Tt.isReadable(r,t,{level:"AA",size:"small"})},CTt=[{fontColorIndex:0,bgColorIndex:3},{fontColorIndex:13,bgColorIndex:8},{fontColorIndex:14,bgColorIndex:1}],ETt=function(r){for(var t=[],e=0;e<11;e++){var i=yTt[e];t.push(ld(i===0?r:Tt.mix(r,e<5?gTt:mTt,i).toHexString()))}return t},TA=function(r){r===void 0&&(r={});var t=Array.from(Array(_Tt)).fill(Ox),e=r.basicColorRelations,i=e===void 0?[]:e,n=r.brandColor,a=ETt(n);return i.forEach(function(o){t[o.basicColorIndex]=a[o.standardColorIndex]}),CTt.forEach(function(o){var s=o.fontColorIndex,l=o.bgColorIndex;t[s]=X6(t[l])?Ox:u4}),k(k({},r),{basicColors:t})},STt={brandColor:"#3471F9",semanticColors:{red:"#FF4D4F",green:"#29A294",yellow:"#FAAD14"},others:{highlight:"#87B5FF",results:"#F0F7FF"},basicColorRelations:[{basicColorIndex:1,standardColorIndex:0},{basicColorIndex:2,standardColorIndex:1},{basicColorIndex:3,standardColorIndex:5},{basicColorIndex:4,standardColorIndex:6},{basicColorIndex:5,standardColorIndex:6},{basicColorIndex:6,standardColorIndex:6},{basicColorIndex:7,standardColorIndex:5},{basicColorIndex:9,standardColorIndex:1},{basicColorIndex:10,standardColorIndex:4},{basicColorIndex:11,standardColorIndex:4},{basicColorIndex:12,standardColorIndex:5}]},ATt=TA(STt),TTt={brandColor:"#326EF4",semanticColors:{red:"#FF4D4F",green:"#29A294",yellow:"#FAAD14"},others:{highlight:"#87B5FF",results:"#F0F7FF"},basicColorRelations:[{basicColorIndex:1,standardColorIndex:0},{basicColorIndex:2,standardColorIndex:1},{basicColorIndex:3,standardColorIndex:1},{basicColorIndex:4,standardColorIndex:2},{basicColorIndex:5,standardColorIndex:7},{basicColorIndex:6,standardColorIndex:5},{basicColorIndex:7,standardColorIndex:5},{basicColorIndex:9,standardColorIndex:1},{basicColorIndex:10,standardColorIndex:2},{basicColorIndex:11,standardColorIndex:5},{basicColorIndex:12,standardColorIndex:5}]},bTt=TA(TTt),wTt={brandColor:"#9DA7B6",semanticColors:{red:"#FF4D4F",green:"#29A294",yellow:"#FAAD14"},others:{highlight:"#87B5FF",results:"#F0F7FF"},basicColorRelations:[{basicColorIndex:1,standardColorIndex:0},{basicColorIndex:2,standardColorIndex:1},{basicColorIndex:3,standardColorIndex:1},{basicColorIndex:4,standardColorIndex:2},{basicColorIndex:5,standardColorIndex:7},{basicColorIndex:6,standardColorIndex:8},{basicColorIndex:7,standardColorIndex:5},{basicColorIndex:9,standardColorIndex:1},{basicColorIndex:10,standardColorIndex:2},{basicColorIndex:11,standardColorIndex:3},{basicColorIndex:12,standardColorIndex:3}]},RTt=TA(wTt),MTt={default:bTt,colorful:ATt,gray:RTt},ra="Roboto, PingFangSC, BlinkMacSystemFont, Microsoft YaHei, Arial, sans-serif",ITt=12,LTt={小计:"Total",总计:"Total",总和:"(SUM)",项:"items",已选择:"selected",序号:"Index",度量:"Measure",数值:"Measure",共计:"Total",条:"",隐藏:"Hide",趋势:"Trend",组内升序:"Group ASC",组内降序:"Group DESC",升序:"ASC",降序:"DESC",不排序:"No order","，":", "},OTt={小计:"Промежуточный итог",总计:"Общий итог",总和:"(СУММА)",项:"элемент(-а/-ов)",已选择:"выбрано",序号:"Индекс",度量:"Мера",数值:"Численная величина",共计:"Общее количество",条:"",隐藏:"Скрыть",趋势:"Курс",组内升序:"Группировать по возрастанию",组内降序:"Группировать по убыванию",升序:"По возрастанию",降序:"По убыванию",不排序:"Не отсортировано","，":", "},PTt={小计:"小计",总计:"总计",总和:"（总和）",项:"项",已选择:"已选择",序号:"序号",度量:"度量",数值:"数值",共计:"共计",条:"条",趋势:"趋势",隐藏:"隐藏",组内升序:"组内升序",升序:"升序",降序:"降序",组内降序:"组内降序",不排序:"不排序","，":"，"},FTt="zh_CN",BTt=FTt,DTt={zh_CN:PTt,en_US:LTt,ru_RU:OTt},Rr=function(r,t){return t===void 0&&(t=r),Nt(DTt,[BTt,r],t)},NTt="".concat(Wct,"-tooltip"),bA="".concat(NTt,"-container"),kTt="".concat(bA,"-show"),UTt="".concat(bA,"-hide"),zI={x:15,y:10},zTt=function(){return{key:"hiddenColumns",text:Rr("隐藏"),icon:"EyeOutlined"}},HTt=function(){return{key:"trend",text:Rr("趋势"),icon:"Trend"}},$Tt=function(){return[{key:"asc",icon:"groupAsc",text:Rr("组内升序")},{key:"desc",icon:"groupDesc",text:Rr("组内降序")},{key:"none",text:Rr("不排序")}]},WTt=function(){return[{key:"asc",icon:"groupAsc",text:Rr("升序")},{key:"desc",icon:"groupDesc",text:Rr("降序")},{key:"none",text:Rr("不排序")}]},HI;(function(r){r[r.ALL=0]="ALL",r[r.COL=1]="COL",r[r.ROW=2]="ROW"})(HI||(HI={}));var tC=1,Dn;(function(r){r.All="all",r.DetailOnly="detailOnly"})(Dn||(Dn={}));function Or(r){return r==="mobile"?!0:/(iPhone|iPad|SymbianOS|Windows Phone|iPod|iOS|Android)/i.test(navigator.userAgent)}function VTt(){return/iPhone/gi.test(navigator.userAgent)&&window.screen.height===812&&window.screen.width===375}function Y6(){return/windows/i.test(navigator.userAgent)}var GTt=function(r){var t=r||"default";return MTt[t.toLowerCase()]},XTt=function(r){var t,e,i,n,a,o=(r==null?void 0:r.palette)||GTt(r==null?void 0:r.name),s=o.basicColors,l=o.semanticColors,u=o.others,c=(t=r==null?void 0:r.spreadsheet)===null||t===void 0?void 0:t.isTableMode(),h=Y6()?"bold":700,f=function(){var d,v;return{bolderText:{fontFamily:ra,fontSize:12,fontWeight:h,fill:s[13],opacity:1,textAlign:"right",textBaseline:"middle",linkTextFill:s[6]},text:{fontFamily:ra,fontSize:12,fontWeight:"normal",fill:s[13],opacity:1,textAlign:"right",textBaseline:"middle",linkTextFill:s[6]},cell:{crossBackgroundColor:s[1],backgroundColor:s[8],backgroundColorOpacity:1,horizontalBorderColor:s[9],horizontalBorderColorOpacity:1,verticalBorderColor:s[9],verticalBorderColorOpacity:1,horizontalBorderWidth:1,verticalBorderWidth:1,borderDash:[],padding:{top:8,right:8,bottom:8,left:8},interactionState:{hover:{backgroundColor:s[2],backgroundOpacity:.6},hoverFocus:{backgroundColor:s[2],backgroundOpacity:.6,borderColor:s[14],borderWidth:1,borderOpacity:1},selected:{backgroundColor:s[2],backgroundOpacity:.6},unselected:{backgroundOpacity:.3,textOpacity:.3,opacity:.3},searchResult:{backgroundColor:(d=u==null?void 0:u.results)!==null&&d!==void 0?d:s[2],backgroundOpacity:1},highlight:{backgroundColor:(v=u==null?void 0:u.highlight)!==null&&v!==void 0?v:s[6],backgroundOpacity:1},prepareSelect:{borderColor:s[14],borderOpacity:1,borderWidth:1}}},miniChart:{line:{point:{size:2.2,fill:s[6],opacity:1},linkLine:{size:1.5,fill:s[6],opacity:.6}},bar:{intervalPadding:4,fill:s[6],opacity:1},bullet:{progressBar:{widthPercent:.6,height:10,innerHeight:6},comparativeMeasure:{width:1,height:12,fill:s[13],opacity:.25},rangeColors:{good:l==null?void 0:l.green,satisfactory:l.yellow,bad:l.red},backgroundColor:"#E9E9E9"},interval:{height:ITt,fill:s[7]}},icon:{fill:s[13],downIconColor:l.red,upIconColor:l.green,size:10,margin:{right:4,left:4}}}};return{cornerCell:{bolderText:{fontFamily:ra,fontSize:12,fontWeight:h,fill:s[0],opacity:1,textAlign:c?"center":"left",textBaseline:"middle"},text:{fontFamily:ra,fontSize:12,fontWeight:h,fill:s[0],opacity:1,textAlign:"right",textBaseline:"middle"},cell:{backgroundColor:s[3],backgroundColorOpacity:1,horizontalBorderColor:s[10],horizontalBorderColorOpacity:1,verticalBorderColor:s[10],verticalBorderColorOpacity:1,horizontalBorderWidth:1,verticalBorderWidth:1,borderDash:[],padding:{top:0,right:8,bottom:0,left:8}},icon:{fill:s[0],size:10,margin:{right:4,left:4}}},rowCell:{seriesText:{fontFamily:ra,fontSize:12,fontWeight:"normal",fill:s[14],linkTextFill:s[6],opacity:1,textBaseline:c?"middle":"top",textAlign:"center"},measureText:{fontFamily:ra,fontSize:12,fontWeight:"normal",fill:s[14],linkTextFill:s[6],opacity:1,textAlign:c?"center":"left",textBaseline:"top"},bolderText:{fontFamily:ra,fontSize:12,fontWeight:h,fill:s[14],linkTextFill:s[6],opacity:1,textAlign:c?"center":"left",textBaseline:"top"},text:{fontFamily:ra,fontSize:12,fontWeight:"normal",fill:s[14],linkTextFill:s[6],opacity:1,textBaseline:"top",textAlign:c?"center":"left"},cell:{backgroundColor:s[1],backgroundColorOpacity:1,horizontalBorderColor:s[9],horizontalBorderColorOpacity:1,verticalBorderColor:s[9],verticalBorderColorOpacity:1,horizontalBorderWidth:1,verticalBorderWidth:1,borderDash:[],padding:{top:0,right:8,bottom:0,left:8},interactionState:{hover:{backgroundColor:s[2],backgroundOpacity:.6},selected:{backgroundColor:s[2],backgroundOpacity:.6},unselected:{backgroundOpacity:.3,textOpacity:.3,opacity:.3},prepareSelect:{borderColor:s[14],borderOpacity:1,borderWidth:1},searchResult:{backgroundColor:(e=u==null?void 0:u.results)!==null&&e!==void 0?e:s[2],backgroundOpacity:1},highlight:{backgroundColor:(i=u==null?void 0:u.highlight)!==null&&i!==void 0?i:s[6],backgroundOpacity:1}}},icon:{fill:s[14],size:10,margin:{right:4,left:4}},seriesNumberWidth:80},colCell:{measureText:{fontFamily:ra,fontSize:12,fontWeight:"normal",fill:s[0],opacity:1,textAlign:"right",textBaseline:"middle"},bolderText:{fontFamily:ra,fontSize:12,fontWeight:h,fill:s[0],opacity:1,textAlign:"center",textBaseline:"middle"},text:{fontFamily:ra,fontSize:12,fontWeight:"normal",fill:s[0],opacity:1,textAlign:"center",textBaseline:"middle"},cell:{backgroundColor:s[3],backgroundColorOpacity:1,horizontalBorderColor:s[10],horizontalBorderColorOpacity:1,verticalBorderColor:s[10],verticalBorderColorOpacity:1,horizontalBorderWidth:1,verticalBorderWidth:1,borderDash:[],padding:{top:0,right:8,bottom:0,left:8},interactionState:{hover:{backgroundColor:s[4],backgroundOpacity:.6},selected:{backgroundColor:s[4],backgroundOpacity:.6},unselected:{backgroundOpacity:.3,textOpacity:.3,opacity:.3},prepareSelect:{borderColor:s[14],borderOpacity:1,borderWidth:1},searchResult:{backgroundColor:(n=u==null?void 0:u.results)!==null&&n!==void 0?n:s[2],backgroundOpacity:1},highlight:{backgroundColor:(a=u==null?void 0:u.highlight)!==null&&a!==void 0?a:s[6],backgroundOpacity:1}}},icon:{fill:s[0],size:10,margin:{top:6,right:4,bottom:6,left:4}}},dataCell:f(),mergedCell:f(),resizeArea:{size:3,background:s[7],backgroundOpacity:0,guideLineColor:s[7],guideLineDisableColor:"rgba(0,0,0,0.25)",guideLineDash:[3,3],interactionState:{hover:{backgroundColor:s[7],backgroundOpacity:1}}},scrollBar:{trackColor:"rgba(0,0,0,0.01)",thumbHoverColor:"rgba(0,0,0,0.25)",thumbColor:"rgba(0,0,0,0.15)",thumbHorizontalMinSize:32,thumbVerticalMinSize:32,size:Or()?3:6,hoverSize:Or()?4:8,lineCap:"round"},splitLine:{horizontalBorderColor:s[12],horizontalBorderColorOpacity:.2,horizontalBorderWidth:2,verticalBorderColor:s[11],verticalBorderColorOpacity:.25,verticalBorderWidth:2,showShadow:!0,shadowWidth:8,shadowColors:{left:"rgba(0,0,0,0.1)",right:"rgba(0,0,0,0)"},borderDash:[]},prepareSelectMask:{backgroundColor:s[5],backgroundOpacity:.3},background:{color:s[8],opacity:1}}},Gr=function(){function r(t){this.x=0,this.y=0,this.width=0,this.height=0,this.colIndex=-1,this.level=0,this.isLeaf=!1,this.children=[],this.padding=0;var e=t.id,i=t.key,n=t.value,a=t.label,o=t.parent,s=t.level,l=t.rowIndex,u=t.isTotals,c=t.isGrandTotals,h=t.isSubTotals,f=t.isCollapsed,d=t.isTotalRoot,v=t.hierarchy,p=t.isPivotMode,g=t.seriesNumberWidth,m=t.field,y=t.spreadsheet,_=t.query,x=t.belongsCell,C=t.inCollapseNode,A=t.isTotalMeasure,T=t.isLeaf,w=t.extra;this.id=e,this.key=i,this.value=n,this.label=a||n,this.parent=o,this.level=s,this.rowIndex=l,this.isTotals=u,this.isCollapsed=f,this.hierarchy=v,this.isPivotMode=p,this.seriesNumberWidth=g,this.field=m,this.spreadsheet=y,this.query=_,this.belongsCell=x,this.inCollapseNode=C,this.isTotalMeasure=A,this.isLeaf=T,this.isGrandTotals=c,this.isSubTotals=h,this.isTotalRoot=d,this.extra=w}return r.getFieldPath=function(t,e){if(t&&!t.isTotals||t&&e){for(var i=t.parent,n=[t.field];i&&i.id!==s4;)n.push(i.field),i=i.parent;return n.reverse()}},r.getAllLeaveNodes=function(t){var e=[];if(t.isLeaf)return[t];for(var i=ht([],tt(t.children),!1),n=i.shift();n;)n.isLeaf?e.push(n):i.unshift.apply(i,ht([],tt(n.children),!1)),n=i.shift();return e},r.getAllChildrenNodes=function(t){var e=[];if(t.isLeaf)return[t];for(var i=ht([],tt(t.children||[]),!1),n=i.shift();n;)e.push(n),i.unshift.apply(i,ht([],tt(n.children),!1)),n=i.shift();return e},r.getAllBranch=function(t){for(var e=[],i=this.getAllLeaveNodes(t),n=i.shift(),a=[];n;){a.unshift(n);for(var o=n.parent;o&&!jr(o,t);){a.unshift(o);o=o.parent}e.push(a),n=i.shift(),a=[]}return e},r.blankNode=function(){return new r({id:"",key:"",value:""})},r.rootNode=function(){return new r({id:"root",key:"",value:""})},r.prototype.toJSON=function(){return cA(this,["config","hierarchy","parent","spreadsheet"])},r.prototype.getHeadLeafChild=function(){for(var t=this;!at(t.children);)t=tu(t.children);return t},r.prototype.getTotalHeightForTreeHierarchy=function(){return this.height===0||at(this.children)?this.height:this.children.reduce(function(t,e){return t+e.getTotalHeightForTreeHierarchy()},this.height)},r}(),j6=function(){function r(){this.width=0,this.height=0,this.maxLevel=-1,this.sampleNodesForAllLevels=[],this.sampleNodeForLastLevel=null,this.allNodesWithoutRoot=[],this.indexNode=[]}return r.prototype.getLeaves=function(){return this.allNodesWithoutRoot.filter(function(t){return t.isLeaf})},r.prototype.getNodes=function(t){return t!==void 0?this.allNodesWithoutRoot.filter(function(e){return e.level===t}):this.allNodesWithoutRoot},r.prototype.getNodesLessThanLevel=function(t){return this.allNodesWithoutRoot.filter(function(e){return e.level<=t})},r.prototype.pushNode=function(t,e){e===void 0&&(e=-1),e===-1?this.allNodesWithoutRoot.push(t):this.allNodesWithoutRoot.splice(e,0,t)},r.prototype.pushIndexNode=function(t){this.indexNode.push(t)},r.prototype.getIndexNodes=function(){return this.indexNode},r}(),kc=function(){function r(t){var e=t.label,i=t.isSubTotals,n=t.isGrandTotals,a=t.isTotalRoot;this.label=e,this.isSubTotals=i,this.isGrandTotals=n,this.isTotalRoot=a}return r}(),YTt=function(r){var t,e=r.isFirstField,i=r.currentField,n=r.fieldValues,a=r.spreadsheet,o=r.lastField,s=a.getTotalsConfig(e?i:o),l,u;e?s!=null&&s.showGrandTotals&&(l=s.reverseLayout?"unshift":"push",u=new kc({label:s.label,isSubTotals:!1,isGrandTotals:!0,isTotalRoot:!0})):s!=null&&s.showSubTotals&&(I.size(n)>1||I.get(s,"showSubTotals.always")!==!1)&&i!==Zt&&(l=s.reverseSubLayout?"unshift":"push",u=new kc({label:s.subLabel,isSubTotals:!0,isGrandTotals:!1,isTotalRoot:!0})),(t=n[l])===null||t===void 0||t.call(n,u)};function eC(r,t){for(var e={},i=r;i&&i.key;)(!i.isTotalRoot||t)&&i.value!==vu&&(e[i.key]=i.value),i=i.parent;return e}var jTt="Transform Data",ZTt="Header Layout",qTt="Data Cell Render",Ha=function(){function r(){var t=this;this.debug=!1,this.debugCallback=function(e,i){if(t.debug){var n=performance.now();i();var a=performance.now();console.log(e,"".concat(a-n," ms"))}else i()},this.logger=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];t.debug&&console.log.apply(console,ht([e],tt(i),!1))}}return r.getInstance=function(){return r.instance||(r.instance=new r),r.instance},r.prototype.setDebug=function(t){this.debug=t},r}(),KTt=`
<svg width="10px" height="10px" viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" font-family="Roboto, PingFangSC, BlinkMacSystemFont, Microsoft YaHei, Arial, sans-serif" font-size="12" font-weight="bold">
    <text id="↓" fill="#29A294">
        <tspan x="-0.225097656" y="8.5">↓</tspan>
    </text>
</g>
</svg>`,QTt=`<svg width="10px" height="10px" viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" font-family="Roboto, PingFangSC, BlinkMacSystemFont, Microsoft YaHei, Arial, sans-serif" font-size="12" font-weight="bold">
    <text id="↑" fill="#FF4D4F">
        <tspan x="-0.225097656" y="8.5">↑</tspan>
    </text>
</g>
</svg>
`,JTt=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="7px" height="9px" viewBox="0 0 7 9" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 58 (84663) - https://sketch.com -->
    <title>down</title>
    <desc>Created with Sketch.</desc>
    <g id="一期开发" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <polygon id="down" fill="#58AE57" transform="translate(3.500000, 4.500000) scale(1, -1) translate(-3.500000, -4.500000) " points="3.5 0 7 9 0 9"></polygon>
    </g>
</svg>`,tbt=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="7px" height="9px" viewBox="0 0 7 9" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 58 (84663) - https://sketch.com -->
    <title>up</title>
    <desc>Created with Sketch.</desc>
    <g id="一期开发" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <polygon id="up" fill="#F46649" points="3.5 0 7 9 0 9"></polygon>
    </g>
</svg> `,ebt=`<svg t="1557124621626" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
xmlns="http://www.w3.org/2000/svg" p-id="17452"
xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14">
<defs>
  <style type="text/css"></style>
</defs>
<path d="M182.272 167.04a8 8 0 0 0-12.544 0L57.728 309.056A8 8 0 0 0 64 321.984h76.032v530.048c0 4.352 3.584 7.936 7.936 7.936h56.064a8 8 0 0 0 7.936-7.936V321.92H288a8 8 0 0 0 6.272-12.992l-112-141.888z m209.728 626.944h176c4.416 0 8 3.584 8 8v56a8 8 0 0 1-8 8h-176A8 8 0 0 1 384 857.984v-56c0-4.416 3.584-8 8-8z m0-424h368c4.416 0 8 3.648 8 8v56a8 8 0 0 1-8 8h-368A8 8 0 0 1 384 433.984v-56c0-4.352 3.584-8 8-8z m528-139.968h-528A8 8 0 0 1 384 222.016v-56c0-4.416 3.584-8 8-8h528c4.416 0 8 3.584 8 8v56a8 8 0 0 1-8 8z m-256 424h-272A8 8 0 0 1 384 646.016v-56c0-4.416 3.584-8 8-8h272c4.416 0 8 3.584 8 8v56a8 8 0 0 1-8 8z" p-id="17453"></path>
</svg>`,rbt=`<svg t="1557124685600" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" p-id="17561"
  xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path d="M182.272 856.96a8 8 0 0 1-12.544 0l-112-141.952A8 8 0 0 1 64 702.08h76.032V172.032c0-4.416 3.584-8 7.936-8h56.064c4.352 0 7.936 3.584 7.936 8v529.984H288c6.72 0 10.496 7.808 6.272 12.992l-112 141.888z m209.728-626.944h176A8 8 0 0 0 576 222.016v-56a8 8 0 0 0-8-8h-176A8 8 0 0 0 384 166.016v56c0 4.416 3.584 8 8 8z m0 424h368a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8h-368A8 8 0 0 0 384 590.016v56c0 4.416 3.584 8 8 8z m528 139.968h-528a8 8 0 0 0-8 8v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z m-256-424h-272A8 8 0 0 0 384 377.984v56c0 4.416 3.584 8 8 8h272a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z" p-id="17562"></path>
</svg>`,ibt=`<svg t="1557124695786" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" p-id="17670"
  xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path d="M182.272 167.04a8 8 0 0 0-12.544 0L57.728 309.056A8 8 0 0 0 64 321.984h76.032v530.048c0 4.352 3.584 7.936 7.936 7.936h56.064a8 8 0 0 0 7.936-7.936V321.92H288a8 8 0 0 0 6.272-12.992l-112-141.888z m209.728 62.976h304A8 8 0 0 0 704 222.016v-56a8 8 0 0 0-8-8h-304A8 8 0 0 0 384 166.016v56c0 4.416 3.584 8 8 8z m0 424h304a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8h-304A8 8 0 0 0 384 590.016v56c0 4.416 3.584 8 8 8z m528 139.968h-528a8 8 0 0 0-8 8v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z m0-424h-528A8 8 0 0 0 384 377.984v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z" p-id="17671"></path>
</svg>`,nbt=`<svg t="1557124710652" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" p-id="17779"
  xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path d="M182.272 856.96a8 8 0 0 1-12.544 0l-112-141.952A8 8 0 0 1 64 702.08h76.032V172.032c0-4.416 3.584-8 7.936-8h56.064c4.352 0 7.936 3.584 7.936 8v529.984H288c6.72 0 10.496 7.808 6.272 12.992l-112 141.888z m209.728-626.944h304A8 8 0 0 0 704 222.016v-56a8 8 0 0 0-8-8h-304A8 8 0 0 0 384 166.016v56c0 4.416 3.584 8 8 8z m0 424h304a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8h-304A8 8 0 0 0 384 590.016v56c0 4.416 3.584 8 8 8z m528 139.968h-528a8 8 0 0 0-8 8v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z m0-424h-528A8 8 0 0 0 384 377.984v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z" p-id="17780"></path>
</svg>`,abt=`<svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="设计输出" stroke="none" stroke-width="1" fill-opacity="0.25" fill-rule="evenodd">
    <g id="设计输出-移动端指标详情页-阅读端" transform="translate(-3275.000000, -724.000000)" fill-rule="nonzero">
        <g id="编组-39" transform="translate(3064.500000, 667.000000)">
            <g id="编组-36" transform="translate(80.500000, 44.000000)">
                <g id="不排序" transform="translate(130.000000, 13.000000)">
                    <path d="M12.0009375,12.40625 C12.0696875,12.40625 12.1259375,12.4625 12.1259375,12.53125 L12.1259375,12.53125 L12.1259375,13.40625 C12.1259375,13.475 12.0696875,13.53125 12.0009375,13.53125 L12.0009375,13.53125 L6.25093747,13.53125 C6.18218747,13.53125 6.12593747,13.475 6.12593747,13.40625 L6.12593747,13.40625 L6.12593747,12.53125 C6.12593747,12.4625 6.18218747,12.40625 6.25093747,12.40625 L6.25093747,12.40625 Z M2.93949997,2.5801875 L2.97437497,2.6109375 L4.72437497,4.828125 C4.78062497,4.89776786 4.74503823,4.99725765 4.66779698,5.02426203 L4.62593747,5.03125 L3.438,5.03089062 L3.43843747,10.9691406 L4.62593747,10.9691406 C4.73062497,10.9691406 4.78999997,11.0910156 4.72437497,11.1722656 L2.97437497,13.3894531 C2.92437497,13.4535156 2.82749997,13.4535156 2.77749997,13.3894531 L1.02749997,11.1722656 C0.961874969,11.0894531 1.02124997,10.9691406 1.12593747,10.9691406 L2.31343747,10.9691406 L2.313,5.03089062 L1.12593747,5.03125 C1.03620533,5.03125 0.979764,4.94285714 1.00679571,4.8654519 L1.02749997,4.828125 L2.77749997,2.6109375 C2.81749997,2.5596875 2.88749997,2.5494375 2.93949997,2.5801875 Z M10.5009375,9.09375 C10.5696875,9.09375 10.6259375,9.15 10.6259375,9.21875 L10.6259375,9.21875 L10.6259375,10.09375 C10.6259375,10.1625 10.5696875,10.21875 10.5009375,10.21875 L10.5009375,10.21875 L6.25093747,10.21875 C6.18218747,10.21875 6.12593747,10.1625 6.12593747,10.09375 L6.12593747,10.09375 L6.12593747,9.21875 C6.12593747,9.15 6.18218747,9.09375 6.25093747,9.09375 L6.25093747,9.09375 Z M14.5009375,5.78125 C14.5696875,5.78125 14.6259375,5.8375 14.6259375,5.90625 L14.6259375,5.90625 L14.6259375,6.78125 C14.6259375,6.85 14.5696875,6.90625 14.5009375,6.90625 L14.5009375,6.90625 L6.25093747,6.90625 C6.18218747,6.90625 6.12593747,6.85 6.12593747,6.78125 L6.12593747,6.78125 L6.12593747,5.90625 C6.12593747,5.8375 6.18218747,5.78125 6.25093747,5.78125 L6.25093747,5.78125 Z M9.00093747,2.46875 C9.06968747,2.46875 9.12593747,2.525 9.12593747,2.59375 L9.12593747,2.59375 L9.12593747,3.46875 C9.12593747,3.5375 9.06968747,3.59375 9.00093747,3.59375 L9.00093747,3.59375 L6.25093747,3.59375 C6.18218747,3.59375 6.12593747,3.5375 6.12593747,3.46875 L6.12593747,3.46875 L6.12593747,2.59375 C6.12593747,2.525 6.18218747,2.46875 6.25093747,2.46875 L6.25093747,2.46875 Z" id="形状结合"></path>
                </g>
            </g>
        </g>
    </g>q
</g>
</svg>`,obt='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1590389330617" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19656" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M512 64c-247.4 0-448 200.6-448 448s200.6 448 448 448 448-200.6 448-448-200.6-448-448-448z m0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" fill="" p-id="19657"></path><path d="M464 336c0 26.5 21.5 48 48 48s48-21.5 48-48-21.5-48-48-48-48 21.5-48 48zM536 448h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-272c0-4.4-3.6-8-8-8z" fill="" p-id="19658"></path></svg>',sbt=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="23px" height="12px" viewBox="0 0 23 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>编组 8备份 3</title>
    <g id="----隐藏列标注！" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="隐藏列标注" transform="translate(-275.000000, -824.000000)">
            <rect fill="#FFFFFF" x="0" y="0" width="1333" height="1167"></rect>
            <g id="编组-8备份-3" transform="translate(275.000000, 824.000000)">
                <rect id="矩形" stroke-opacity="0.25" stroke="#000000" fill="#F7F7F7" x="0.5" y="0.5" width="11" height="11"></rect>
                <rect id="矩形备份-9" stroke-opacity="0.25" stroke="#000000" fill="#F7F7F7" x="11.5" y="0.5" width="11" height="11"></rect>
                <g id="7.Icon/arrow/15.down/fill" transform="translate(6.000000, 6.000000) rotate(90.000000) translate(-6.000000, -6.000000) " fill="#000000" fill-rule="nonzero" opacity="0.65">
                    <path d="M7.25020811,6.37218077 L4.91348936,8.20968077 C4.82677061,8.27764952 4.69903624,8.21671202 4.69903624,8.10655577 L4.69903624,4.43272764 C4.69903624,4.32257139 4.82677061,4.26046202 4.91348936,4.32960264 L7.25020811,6.16593077 C7.31700499,6.21866514 7.31700499,6.31944639 7.25020811,6.37218077 Z" id="fill" transform="translate(5.999671, 6.269385) rotate(90.000000) translate(-5.999671, -6.269385) "></path>
                </g>
                <g id="7.Icon/arrow/15.down/fill" transform="translate(17.000000, 6.000000) rotate(270.000000) translate(-17.000000, -6.000000) translate(11.000000, 0.000000)" fill="#000000" fill-rule="nonzero" opacity="0.65">
                    <path d="M7.25020811,6.37218077 L4.91348936,8.20968077 C4.82677061,8.27764952 4.69903624,8.21671202 4.69903624,8.10655577 L4.69903624,4.43272764 C4.69903624,4.32257139 4.82677061,4.26046202 4.91348936,4.32960264 L7.25020811,6.16593077 C7.31700499,6.21866514 7.31700499,6.31944639 7.25020811,6.37218077 Z" id="fill" transform="translate(5.999671, 6.269385) rotate(90.000000) translate(-5.999671, -6.269385) "></path>
                </g>
            </g>
            <line x1="286.5" y1="813" x2="286.5" y2="864.5" id="路径-2备份-3" stroke="#000000" opacity="0.25"></line>
        </g>
    </g>
</svg>`,lbt=`<svg t="1557140120188" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
xmlns="http://www.w3.org/2000/svg" p-id="16909" xmlns:xlink="http://www.w3.org/1999/xlink"
width="200" height="200">
	<defs>
		<style type="text/css">
		</style>
	</defs>
	<path d="M328 544h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"
	p-id="16910">
	</path>
	<path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32z m-40 728H184V184h656v656z"
	p-id="16911">
	</path>
</svg>`,ubt=`<svg t="1557140186692" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
xmlns="http://www.w3.org/2000/svg" p-id="17025" xmlns:xlink="http://www.w3.org/1999/xlink"
width="200" height="200">
	<defs>
		<style type="text/css">
		</style>
	</defs>
	<path d="M328 544h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"
	p-id="17026">
	</path>
	<path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32z m-40 728H184V184h656v656z"
	p-id="17027">
	</path>
</svg>`,cbt=`<svg t="1565940955886" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
     p-id="17472" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path
    d="M948 392.992l-403.008 488.99200001Q532 896 512.992 896t-32-14.016L76 392.992q-18.016-20.992-7.008-46.016T108 321.98400001L916 321.98400001q28 0 39.008 24.99199999T948 392.992z"
    p-id="17473" data-spm-anchor-id="a313x.7781069.0.i2" class="selected"></path>
</svg>
`,hbt=`<svg t="1565940955886" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
     p-id="17472" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path
    fill-opacity="0.45"
    d="M948 392.992l-403.008 488.99200001Q532 896 512.992 896t-32-14.016L76 392.992q-18.016-20.992-7.008-46.016T108 321.98400001L916 321.98400001q28 0 39.008 24.99199999T948 392.992z"
    p-id="17473" data-spm-anchor-id="a313x.7781069.0.i2" class="selected"></path>
</svg>
`,fbt=`<svg t="1565940979768" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
p-id="17620" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">
<defs>
<style type="text/css"></style>
</defs>
<path
d="M76 631.008l403.008-488.99200001Q492 128 511.008 128t32 14.016L948 631.008q18.016 20.992 7.008 46.016T916 702.01599999L108 702.01599999q-28 0-39.008-24.99199999T76 631.008z"
p-id="17621"></path>
</svg>
`,dbt=`<svg t="1565940979768" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
     p-id="17620" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path
    fill-opacity="0.45"
    d="M76 631.008l403.008-488.99200001Q492 128 511.008 128t32 14.016L948 631.008q18.016 20.992 7.008 46.016T916 702.01599999L108 702.01599999q-28 0-39.008-24.99199999T76 631.008z"
    p-id="17621"></path>
</svg>
`,vbt='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1596433821690" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20229" width="16" height="16" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><style type="text/css"></style></defs><path d="M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6c-3.1-3.1-8.2-3.1-11.3 0l-230 229.9L461.4 404c-3.1-3.1-8.2-3.1-11.3 0L266.3 586.7c-3.1 3.1-3.1 8.2 0 11.3l39.5 39.7z" p-id="20230"></path></svg>',pbt=`<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1608030723688" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="21482" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16"><defs><style type="text/css"></style></defs><path d="M547.648 696a32 32 0 0 1 31.488 26.24l0.512 5.76v151.68l145.216-144.512a32 32 0 0 1 40.832-3.648l4.416 3.712a32 32 0 0 1 3.584 40.832l-3.712 4.48-203.072 202.24a32 32 0 0 1-40.768 3.648l-4.416-3.712-202.24-202.24a32 32 0 0 1 40.832-48.96l4.416 3.712 150.912 150.912v-158.144a32 32 0 0 1 32-32z m194.56-529.28l4.928 3.072 233.792 180.224a32 32 0 0 1 1.728 49.28l-4.864 3.52-409.792 245.568a32 32 0 0 1-27.328 2.624l-5.184-2.432-422.4-245.568a32 32 0 0 1-7.552-49.28l4.544-4.032 242.816-180.288a32 32 0 0 1 42.432 47.552l-4.288 3.84-203.84 151.296 364.16 211.648 353.28-211.712-196.608-151.552a32 32 0 0 1-8.896-40l3.136-4.864a32 32 0 0 1 40-8.96zM547.712 28.672a32 32 0 0 1 31.488 26.24l0.512 5.76v396.992a32 32 0 0 1-63.488 5.76l-0.512-5.76V60.736a32 32 0 0 1 32-32z" p-id="21483" fill="currentColor"></path></svg>
`,gbt='<svg viewBox="64 64 896 896" focusable="false" data-icon="eye" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"></path></svg>',$I=Object.freeze({__proto__:null,ArrowDown:KTt,ArrowUp:QTt,CellDown:JTt,CellUp:tbt,GlobalAsc:ebt,GlobalDesc:rbt,GroupAsc:ibt,GroupDesc:nbt,GroupNone:abt,Minus:lbt,Plus:ubt,SortDown:hbt,SortUp:dbt,SortDownSelected:cbt,SortUpSelected:fbt,InfoCircle:obt,ExpandColIcon:sbt,Trend:vbt,DrillDownIcon:pbt,EyeOutlined:gbt}),Z6={},q6=function(r,t){Z6[nA(r)]=t},mbt=function(r){return Z6[nA(r)]};ir($I).forEach(function(r){q6(r,$I[r])});var WI="<svg",VI="data:image/svg+xml",GI={},ud=function(r){gt(t,r);function t(e){var i=r.call(this,e)||this;return i.isOnlineLink=function(n){return/^(https?:)?(\/\/)/.test(n)},i.render(),i}return t.prototype.getImage=function(e,i,n){var a=this;return new Promise(function(o,s){var l=mbt(e);if(l){var u=new Image;u.onload=function(){GI[i]=u,o(u)},u.onerror=s,l.includes(VI)||a.isOnlineLink(l)?(u.src=l,u.crossOrigin="anonymous"):(n&&(l=l.replace(/fill=[\'\"]#?\w+[\'\"]/g,""),l=l.replace(/fill>/g,">")),l=l.replace(WI,"".concat(WI,' fill="').concat(n,'"')),u.src="".concat(VI,";utf-8,").concat(encodeURIComponent(l)))}})},t.prototype.render=function(){var e=this.cfg,i=e.name,n=e.fill,a=qd(this.cfg),o=k(k({},cA(a,"fill")),{type:t.type}),s=new yS({attrs:o});this.iconImageShape=s,this.setImageAttrs({name:i,fill:n})},t.prototype.setImageAttrs=function(e){var i=this,n=e.name,a=e.fill,o=this.iconImageShape;n=n||o.attrs.name,a=a||o.attrs.fill;var s="".concat(n,"-").concat(a),l=GI[s];l?(o.attr("img",l),this.addShape("image",o)):this.getImage(n,s,a).then(function(u){var c,h,f,d=(f=(h=(c=i.getParent())===null||c===void 0?void 0:c.getMeta)===null||h===void 0?void 0:h.call(c).spreadsheet)===null||f===void 0?void 0:f.container;if(i.destroyed||d&&!d.get("refreshElements")){Ha.getInstance().logger("GuiIcon ".concat(n," destroyed."));return}o.attr("img",u),i.addShape("image",o)}).catch(function(u){if(u instanceof TypeError){console.warn("GuiIcon ".concat(n," destroyed:"),u);return}console.error("GuiIcon ".concat(n," load failed:"),u)})},t.type="__GUI_ICON__",t}(no),Cr;(function(r){r.TOP="TOP",r.BOTTOM="BOTTOM",r.LEFT="LEFT",r.RIGHT="RIGHT"})(Cr||(Cr={}));var Al;(function(r){r.SUM="SUM",r.MIN="MIN",r.MAX="MAX",r.AVG="AVG"})(Al||(Al={}));var ua;(function(r){r.Row="row",r.Col="col",r.Series="series"})(ua||(ua={}));var ybt=function(){function r(){this.store=new Map}return r.prototype.set=function(t,e){return this.store.set(t,e)},r.prototype.get=function(t,e){var i,n=this.store.get(t);return(i=n)!==null&&i!==void 0?i:e},r.prototype.clear=function(){this.store.clear()},r.prototype.size=function(){return this.store.size},r}(),ag=function(r){var t,e,i=r.facetCfg,n=r.level,a=r.fields,o=i.colCfg,s=i.spreadsheet,l=i.dataSet,u=l.moreThanOneValue(),c=(e=(t=s.dataCfg.fields)===null||t===void 0?void 0:t.valueInCols)!==null&&e!==void 0?e:!0,h=(o==null?void 0:o.hideMeasureColumn)&&c&&!u&&Ei(a,Zt),f=h?2:1;return n===a.length-f},K6=function(r,t,e,i){return t.layoutArrange?t.layoutArrange(t.spreadsheet,e,i,r):r},wA=function(r,t,e,i){var n,a,o=(a=(n=r.spreadsheet)===null||n===void 0?void 0:n.facet)===null||a===void 0?void 0:a.getHiddenColumnsInfo(e);if(o&&r.columns.find(function(p){return p===e.field}))return!1;var s=!0,l=function(p,g,m){g===void 0&&(g=-1),m===void 0&&(m=-1),g===-1?(t.children.push(p),i.pushNode(p)):(t.children.splice(g,0,p),i.pushNode(p,m))};if(r.layoutHierarchy){var u=r.layoutHierarchy(r.spreadsheet,e);if(u){var c=za(u==null?void 0:u.delete)?u==null?void 0:u.delete:!1;s=!c;var h=u.push,f=u.unshift,d=t.children.length,v=i.getNodes().length;at(f)||(Ht(f,function(p){l(p)}),d=t.children.length,v=i.getNodes().length),at(h)||Ht(h,function(p){l(p)}),c||l(e,d,v)}else l(e)}else l(e);return s},rC=function(r,t,e){r!=null&&r.layoutCoordinate&&(t!=null&&t.isLeaf||e!=null&&e.isLeaf)&&(r==null||r.layoutCoordinate(r.spreadsheet,t,e))},_bt=function(r,t){var e=r==null?void 0:r.layoutDataPosition;if(e){var i=t.getCellMeta,n=e(r.spreadsheet,i);return k(k({},t),{getCellMeta:n})}return t},Q6=function(){function r(t){this.label=t}return r}(),J6=function(r){var t=r.addTotalMeasureInTotal,e=r.parentNode,i=r.currentField,n=r.fields,a=r.facetCfg,o=r.hierarchy,s=n.indexOf(i),l=a.dataSet,u=a.values,c=a.spreadsheet,h=[],f={},d=c.getTotalsConfig(i),v=e.isGrandTotals?d.totalsGroupDimensions||[]:d.subTotalsGroupDimensions||[],p=l.isEmpty()?[]:v;if(p!=null&&p.includes(i)){f=eC(e);var g=l.getDimensionValues(i,f);h.push.apply(h,ht([],tt((g||[]).map(function(y){return new kc({label:y,isSubTotals:e.isSubTotals,isGrandTotals:e.isGrandTotals,isTotalRoot:!1})})),!1)),at(h)&&i&&h.push(vu)}else if(t&&i===Zt)f=eC(e),h.push.apply(h,ht([],tt(u.map(function(y){return new Q6(y)})),!1));else if(ag({facetCfg:a,level:s,fields:n})){e.isLeaf=!0,o.pushIndexNode(e),e.rowIndex=o.getIndexNodes().length-1;return}else{J6(k(k({},r),{currentField:n[s+1]}));return}var m=h.filter(function(y){return!Dm(y)});RA(k(k({},r),{fieldValues:m,level:s,parentNode:e,query:f}))},xbt=function(r){var t,e=r.parentNode,i=r.currentField,n=r.fields,a=r.facetCfg,o=n.indexOf(i),s=a.dataSet,l=a.spreadsheet,u=[],c={};c=eC(e,!0);var h=s.getDimensionValues(i,c),f=K6(h,a,e,i);u.push.apply(u,ht([],tt(f||[]),!1)),at(u)&&i&&(i===Zt?u.push.apply(u,ht([],tt((t=s.fields)===null||t===void 0?void 0:t.values),!1)):u.push(vu)),YTt({currentField:i,lastField:n[o-1],isFirstField:o===0,fieldValues:u,spreadsheet:l});var d=u.filter(function(v){return!Dm(v)});RA(k(k({},r),{fieldValues:d,level:o,parentNode:e,query:c}))},t7=function(r){r.parentNode.isTotals?J6(r):xbt(r)},cd=function(r,t){return"".concat(r).concat(ii).concat(t)},RA=function(r){var t,e,i,n,a,o,s,l,u,c,h=r.currentField,f=r.fields,d=r.fieldValues,v=r.facetCfg,p=r.hierarchy,g=r.parentNode,m=r.level,y=r.query,_=r.addMeasureInTotalQuery,x=r.addTotalMeasureInTotal,C=v.spreadsheet,A=v.collapsedCols;try{for(var T=Vn(d.entries()),w=T.next();!w.done;w=T.next()){var M=tt(w.value,2),O=M[0],P=M[1],D=P instanceof kc,z=P instanceof Q6,Y=void 0,H=void 0,N=!1,W=!1,Q=!1,q=!1,J=h;if(D){var et=P;W=et.isGrandTotals,Q=et.isSubTotals,q=et.isTotalRoot,Y=Rr(P.label),q?H=y:H=k(k({},y),(i={},i[h]=Y,i)),_&&(H[Zt]=(s=C==null?void 0:C.dataSet)===null||s===void 0?void 0:s.fields.values[0]),N=ag({facetCfg:v,level:m,fields:f})}else z?(Y=Rr(P.label),H=k(k({},y),(n={},n[Zt]=Y,n)),J=Zt,W=g.isGrandTotals,Q=g.isSubTotals,N=ag({facetCfg:v,level:m,fields:f})):C.isTableMode()?(Y=P,J=f[O],H=k(k({},y),(a={},a[J]=Y,a)),N=!0):(Y=P,H=Y===vu?k({},y):k(k({},y),(o={},o[h]=Y,o)),N=ag({facetCfg:v,level:m,fields:f}));var ft=cd(g.id,Y);if(!ft)return;var Ct=za(A==null?void 0:A[ft])?A==null?void 0:A[ft]:!1,ct=new Gr({id:ft,key:J,value:Y,level:m,field:J,parent:g,isTotals:D||z,isGrandTotals:W,isSubTotals:Q,isTotalMeasure:z,isCollapsed:Ct,isTotalRoot:q,hierarchy:p,query:H,spreadsheet:C,isLeaf:N||Ct}),dt=wA(v,g,ct,p),Rt=(l=C==null?void 0:C.facet)===null||l===void 0?void 0:l.getHiddenColumnsInfo(ct);Rt&&g&&(g.hiddenChildNodeInfo=Rt),m>p.maxLevel&&!W&&!g.isGrandTotals&&!g.isSubTotals&&!ct.isSubTotals&&(p.sampleNodesForAllLevels.push(ct),p.maxLevel=m,p.sampleNodeForLastLevel=Rt?((u=Rt==null?void 0:Rt.displaySiblingNode)===null||u===void 0?void 0:u.next)||((c=Rt==null?void 0:Rt.displaySiblingNode)===null||c===void 0?void 0:c.prev):ct);var le=N||Ct||!dt;le?(ct.isLeaf=!0,p.pushIndexNode(ct),ct.rowIndex=p.getIndexNodes().length-1):t7({addTotalMeasureInTotal:x,addMeasureInTotalQuery:_,parentNode:ct,currentField:f[m+1],fields:f,facetCfg:v,hierarchy:p})}}catch(me){t={error:me}}finally{try{w&&!w.done&&(e=T.return)&&e.call(T)}finally{if(t)throw t.error}}},e7=function(r,t,e,i){var n=t.facetCfg,a=t.hierarchy,o=t.parentNode,s=n.dataSet;r.forEach(function(l,u){typeof l=="string"&&(l={key:l});var c=l.key,h=c===jl?Rr("序号"):s.getFieldName(c),f=i||o;if(RA({currentField:c,fields:[c],fieldValues:[h],facetCfg:n,hierarchy:a,parentNode:f,level:e,query:{},addMeasureInTotalQuery:!1,addTotalMeasureInTotal:!1}),l.children&&l.children.length){var d=f.children[u];d.isLeaf=!1,e7(l.children,t,e+1,d)}})},Fl=function(r,t){return t>0&&r<t},Bl=function(r,t,e){return t>0&&r>=e-t},Wm=function(r,t,e){return e>0&&r<t+e},nv=function(r,t,e){return e>0&&r>=t+1-e},MA=function(r,t,e,i,n,a){var o=Dc(e,function(h,f){var d=r-(wr(a)?0:a)+n.x;return d>=h&&d<e[f+1]},0);o=Math.max(o,0);var s=Dc(e,function(h,f){var d=n.width+r+n.x;return d>=h&&d<e[f+1]},o);s=Math.min(s===-1?1/0:s,e.length-2);var l=i.getIndexRange(t+n.y,n.height+t+n.y),u=l.start,c=l.end;return[o,s,u,c]},Cbt=function(r,t,e){var i=2,n=Math.abs(r/t),a=n<=1/i?0:r,o=n>i?0:t;return[a*e.horizontal,o*e.vertical]},To=function(r,t,e){var i,n,a=r==null?void 0:r.getMatrix(),o=(i=a==null?void 0:a[6])!==null&&i!==void 0?i:0,s=(n=a==null?void 0:a[7])!==null&&n!==void 0?n:0;r==null||r.translate(t-o,e-s)},Vm=function(r,t){var e,i=r==null?void 0:r.getMatrix(),n=(e=i==null?void 0:i[6])!==null&&e!==void 0?e:0;r==null||r.translate(t-n,0)},Ebt=function(r,t){var e,i=r==null?void 0:r.getMatrix(),n=(e=i==null?void 0:i[7])!==null&&e!==void 0?e:0;r==null||r.translate(0,t-n)},Sbt=function(r,t,e,i){var n=t.frozenColCount,a=t.frozenRowCount,o=t.frozenTrailingColCount,s=t.frozenTrailingRowCount,l=r.colIndex,u=r.rowIndex;return Wm(u,i.start,a)?pr.ROW:nv(u,i.end,s)?pr.TRAILING_ROW:Fl(l,n)?pr.COL:Bl(l,o,e)?pr.TRAILING_COL:pr.SCROLL},Abt=function(r,t,e){for(var i,n=r.frozenColCount,a=r.frozenRowCount,o=r.frozenTrailingColCount,s=r.frozenTrailingRowCount,l=(i={},i[pr.TOP]=[],i[pr.BOTTOM]=[],i),u=0;u<n;u++){for(var c=e.start;c<e.start+a;c++)l[pr.TOP].push({x:u,y:c});if(s>0)for(var c=0;c<s;c++){var h=e.end-c;l[pr.BOTTOM].push({x:u,y:h})}}for(var u=0;u<o;u++){for(var f=t-1-u,c=e.start;c<e.start+a;c++)l[pr.TOP].push({x:f,y:c});if(s>0)for(var c=0;c<s;c++){var h=e.end-c;l[pr.BOTTOM].push({x:f,y:h})}}return l},Tbt=function(r,t,e,i){var n=t.frozenColCount,a=t.frozenRowCount,o=t.frozenTrailingColCount,s=t.frozenTrailingRowCount,l=ht([],tt(r),!1);Fl(l[0],n)&&(l[0]=n),Bl(l[1],o,e)&&(l[1]=e-o-1),Wm(l[2],i.start,a)&&(l[2]=i.start+a),nv(l[3],i.end,s)&&(l[3]=i.end-s);var u=ht([],tt(l),!1);u[2]=i.start,u[3]=i.start+a-1;var c=ht([],tt(l),!1);c[0]=0,c[1]=n-1;var h=ht([],tt(l),!1);h[2]=i.end+1-s,h[3]=i.end;var f=ht([],tt(l),!1);return f[0]=e-o,f[1]=e-1,{center:l,frozenRow:u,frozenCol:c,frozenTrailingCol:f,frozenTrailingRow:h}},bbt=function(r,t){var e=r,i=0,n=e.getTotalLength()-1;if(t){var a=t.current,o=a===void 0?tC:a,s=t.pageSize;i=Math.max((o-1)*s,0),n=Math.min(o*s-1,e.getTotalLength()-1)}return{start:i,end:n}},f0=function(r,t,e){var i=t,n=e,a=function(o){return o.isLeaf?1:o.children?o.children.reduce(function(s,l){return s+=a(l),s},0):0};return t&&(i=r.slice(0,t).reduce(function(o,s){return o+=a(s),o},0)),e&&(n=r.slice(r.length-e).reduce(function(o,s){return o+=a(s),o},0)),{colCount:i,trailingColCount:n}},r7=function(r,t){return r.reduce(function(e,i){typeof i=="string"&&(i={key:i});var n=k({},i);return n.children?(n.children=r7(n.children,t),e.push(n),e):(t[n.key]&&e.push(n),e)},[])},$a=function(r){return r.parent.id==="root"},wbt=function(r){for(;!$a(r);)r=r.parent;return r},Rbt=function(r){var t=[],e=function(i){i.forEach(function(n){typeof n=="string"||!n.children?t.push(n):e(n.children)})};return e(r),t},hh=function(r){var t=Rbt(r);return t.map(function(e){return typeof e=="string"?e:e.key})},iC=function(r){var t=r.children[0];return t?t.isLeaf?t:iC(t):r},Mbt=function(r){return at(r.rows)&&at(r.columns)&&at(r.values)&&at(r.customTreeItems)},Uc=function(r,t){var e,i=r.pagination,n=r.frozenFirstRow,a=r.hierarchyType,o=r.showSeriesNumber,s=i&&i.pageSize,l=!1,u=t==null?void 0:t[0];if(!s&&n){l=((e=u==null?void 0:u.children)===null||e===void 0?void 0:e.length)===0;var c=a==="tree"||a==="customTree";c&&!l&&(l=!o)}var h=l&&!!u;return{frozenRowCount:h?1:0,frozenColCount:0,frozenTrailingColCount:0,frozenTrailingRowCount:0,enableFrozenFirstRow:l,frozenRowHeight:h?u.height:0}},Ibt=function(r){return r===vu?gm:r},Lbt=function(r){var t=r.facetCfg,e=t.columns,i=t.spreadsheet,n=i.store.get("hiddenColumnsDetail"),a=t==null?void 0:t.showSeriesNumber,o=hh(e),s=o.filter(function(h){return n?n.every(function(f){return f.hideColumnNodes.every(function(d){return d.field!==h})}):!0}),l=ht([],tt(s),!1),u=ht([],tt(e),!1),c={};a&&(u.unshift({key:jl}),c[jl]=!0),l.reduce(function(h,f){return h[f]=!0,h},c),e7(r7(u,c),r,0,null)},Ku=function(r){return Number.parseFloat((hn(r)||0).toPrecision(l4))},Es=function(r,t,e){if(e===void 0&&(e=0),!Object.values(r).find(function(o){return o>0}))return r;var i=k({},r);i.frozenColCount>=t&&(i.frozenColCount=t);var n=t-i.frozenColCount;i.frozenTrailingColCount>n&&(i.frozenTrailingColCount=n),i.frozenRowCount>=e&&(i.frozenRowCount=e);var a=e-i.frozenRowCount;return i.frozenTrailingRowCount>a&&(i.frozenTrailingRowCount=a),i},Obt=function(r){var t;return(t=r==null?void 0:r.position)!==null&&t!==void 0?t:"right"},Pbt=function(r,t){r===void 0&&(r=0),t===void 0&&(t=0),r=Ku(r),t=Ku(t);var e=r>=0,i=t>=0&&r<=0,n=e?r:t,a=i?0:n,o=t-r;return function(s){var l=e?0:1,u=i?s0(Math.abs(0-r)/o,0,1):l,c=s0((s-a)/o,-1,1);return{zeroScale:u,scale:c}}},i7=function(r,t){return Om(r,function(e){return e.field instanceof RegExp?e.field.test(t):e.field===t})},IA=function(r){return u0({size:0,position:"right",margin:{left:0,right:0}},r)},n7=function(r,t,e){var i=t.size,n=t.margin,a=i7(r==null?void 0:r.icon,e),o=a&&a.mapping&&{size:i,margin:n,position:Obt(a)};return IA(o)};function fn(r,t,e){var i;return(i=r==null?void 0:r.addShape)===null||i===void 0?void 0:i.call(r,"rect",k({zIndex:1,attrs:t},e||{}))}function Fbt(r,t){var e;return(e=r==null?void 0:r.addShape)===null||e===void 0?void 0:e.call(r,"polygon",{attrs:t})}function Bbt(r,t){var e;return(e=r==null?void 0:r.addShape)===null||e===void 0?void 0:e.call(r,"polyline",{attrs:t})}function a7(r,t){var e;return(e=r==null?void 0:r.addShape)===null||e===void 0?void 0:e.call(r,"circle",{attrs:t})}function eu(r,t,e,i,n,a,o,s){var l;return!at(t)&&r&&Ht(t,function(u){r.contain(u)&&r.removeChild(u,!0)}),(l=r==null?void 0:r.addShape)===null||l===void 0?void 0:l.call(r,"text",{attrs:k(k({x:e,y:i,text:n,originalText:s},a),o)})}function Xr(r,t,e){var i;return(i=r==null?void 0:r.addShape)===null||i===void 0?void 0:i.call(r,"line",{zIndex:100,attrs:k(k({},t),e)})}function In(r,t,e){if(!at(r)){var i=It(r)?r:[r];i.forEach(function(n){sd(n,"attrs.".concat(t),e)})}}function LA(r,t){var e=new ud(t);return r==null||r.add(e),e}function o7(r,t,e,i,n){var a=new ud(k(k({name:i?"Plus":"Minus"},t),{fill:e}));return Zr(n)&&a.on("click",n),r==null||r.add(a),a}var nC="s2-offscreen-canvas",Dbt=function(){var r=document.getElementById(nC);return r||(r=document.createElement("canvas"),r.id=nC,r.style.display="none",document.body.appendChild(r),r)},Nbt=function(){var r;(r=document.getElementById(nC))===null||r===void 0||r.remove()},s7=function(r,t){var e,i,n,a=r.data,o=r.encode,s=r.type,l=t.getMeta(),u=l.x,c=l.y,h=l.height,f=l.width,d=t.getStyle(st.DATA_CELL),v=d.cell,p=d.miniChart,g=[],m=se(a,function(z){return g.push(z==null?void 0:z[o.y]),{x:z[o.x],y:z[o.y]}}),y=Nc(g),_=lA(g),x=y-_,C=u+v.padding.left,A=u+f-v.padding.right,T=c+v.padding.top,w=c+h-v.padding.bottom,M=w-T,O=s===Bc.Bar?(A-C-(g.length-1)*((e=p==null?void 0:p.bar)===null||e===void 0?void 0:e.intervalPadding))/g.length+((i=p==null?void 0:p.bar)===null||i===void 0?void 0:i.intervalPadding):(n=(A-C)/(g.length-1))!==null&&n!==void 0?n:0,P=[],D=se(m,function(z,Y){var H,N=C+Y*O,W;if(x!==0?W=w-((z==null?void 0:z.y)-_)/x*M:W=_>0?T:w,s===Bc.Bar){var Q=void 0,q=void 0;_<0&&y>0&&x!==0?(Q=w-(0-_)/x*M,q=Math.abs(W-Q),(z==null?void 0:z.y)<0&&(W=Q)):(Q=_<0?T:w,x=Nc([Math.abs(y),Math.abs(_)]),q=x===0?M:Math.abs((z==null?void 0:z.y)-0)/x*M,W=Q);var J=O-((H=p==null?void 0:p.bar)===null||H===void 0?void 0:H.intervalPadding);P.push([J,q])}return[N,W]});return{points:D,box:P}},kbt=function(r,t){if(!(at(r==null?void 0:r.data)||at(t))){var e=t.getStyle(st.DATA_CELL),i=e.miniChart,n=i.line,a=n.point,o=n.linkLine,s=s7(r,t).points;Bbt(t,{points:s,stroke:o.fill,lineWidth:o.size,opacity:o.opacity});for(var l=0;l<s.length;l++)a7(t,{x:s[l][0],y:s[l][1],r:a.size,fill:a.fill,fillOpacity:a.opacity})}},Ubt=function(r,t){if(!(at(r==null?void 0:r.data)||at(t)))for(var e=t.getStyle(st.DATA_CELL),i=e.miniChart,n=i.bar,a=s7(r,t),o=a.points,s=a.box,l=0;l<o.length;l++)fn(t,{x:o[l][0],y:o[l][1],width:s[l][0],height:s[l][1],fill:n.fill,fillOpacity:n.opacity})},zbt=function(r,t,e){var i=Number(t)-Number(r);return Number.isNaN(i)||Number(r)<0?e.bad:i<=.1?e.good:i>.1&&i<=.2?e.satisfactory:e.bad},Hbt=function(r,t){var e,i;t===void 0&&(t={min:0,max:0});var n=Number(r);if(Number.isNaN(n))return r;var a=(e=t==null?void 0:t.min)!==null&&e!==void 0?e:t,o=(i=t==null?void 0:t.max)!==null&&i!==void 0?i:t,s=new Intl.NumberFormat("en-US",{minimumFractionDigits:a,maximumFractionDigits:o,useGrouping:!1,style:"percent"});return s.format(n)},$bt=function(r){var t,e,i,n,a,o;if(!at(r)){var s=r.getCellArea(),l=s.x,u=s.y,c=s.height,h=s.width,f=r.findFieldCondition((t=r.cellConditions)===null||t===void 0?void 0:t.interval);if(f&&f.mapping){var d=r.mappingValue(f);if(!d)return;var v=d.isCompare?d:r.valueRangeByField,p=Ku(v.minValue),g=Ku(v.maxValue),m=wr(d==null?void 0:d.fieldValue)?Ku(r.getMeta().fieldValue):Ku(d==null?void 0:d.fieldValue);if(m<p||m>g)return;var y=(i=(e=r.getStyle().miniChart.interval)===null||e===void 0?void 0:e.height)!==null&&i!==void 0?i:r.getStyle().cell.miniBarChartHeight,_=(a=(n=r.getStyle().miniChart.interval)===null||n===void 0?void 0:n.fill)!==null&&a!==void 0?a:r.getStyle().cell.miniBarChartFillColor,x=Pbt(p,g),C=x(m),A=C.zeroScale,T=C.scale,w=(o=d.fill)!==null&&o!==void 0?o:_;return fn(r,{x:l+h*A,y:u+c/2-y/2,width:h*T,height:y,fill:w})}}},Wbt=function(r,t){var e,i=t.getStyle(st.DATA_CELL),n=t.getMeta(),a=n.x,o=n.y,s=n.height,l=n.width,u=n.spreadsheet;if(at(r)){eu(t,[],a+l-i.cell.padding.right,o+s/2,xu(t,u.options.placeholder),i.text);return}var c=i.miniChart.bullet,h=c.progressBar,f=c.comparativeMeasure,d=c.rangeColors,v=c.backgroundColor,p=r.measure,g=r.target,m=Math.max(Number(p),0),y=Math.max(Number(g),0),_=Hbt(p,2),x=(h==null?void 0:h.widthPercent)>1?(h==null?void 0:h.widthPercent)/100:h==null?void 0:h.widthPercent,C=i.cell.padding,A=l-C.left-C.right,T=x*A,w=A-T,M=a+l-C.right-T,O=o+s/2-h.height/2;fn(t,{x:M,y:O,width:T,height:h.height,fill:v,textBaseline:i.text.textBaseline});var P=Nt(t.getMeta(),"spreadsheet.options.bullet.getRangeColor"),D=Math.max(Math.min(T*m,T),0);fn(t,{x:M,y:O+(h.height-h.innerHeight)/2,width:D,height:h.innerHeight,fill:(e=P==null?void 0:P(m,y))!==null&&e!==void 0?e:zbt(m,y,d)});var z=M+T*y;Xr(t,{x1:z,y1:o+(s-f.height)/2,x2:z,y2:o+(s-f.height)/2+f.height},{stroke:(f==null?void 0:f.fill)||(f==null?void 0:f.color),lineWidth:f.width,opacity:f==null?void 0:f.opacity}),eu(t,[],M-C.right,o+s/2,zc({measureTextWidth:u.measureTextWidth,text:_,maxWidth:w-C.right,fontParam:i.text}),i.text)},Vbt=function(r,t){switch(t==null?void 0:t.type){case Bc.Line:kbt(t,r);break;case Bc.Bar:Ubt(t,r);break;default:Wbt(t,r);break}},l7=function(r,t){var e=r.x,i=r.y,n=r.width,a=r.height,o=n-(t==null?void 0:t.left)-(t==null?void 0:t.right),s=a-(t==null?void 0:t.top)-(t==null?void 0:t.bottom);return{x:e+(t==null?void 0:t.left),y:i+(t==null?void 0:t.top),width:o,height:s}},u7=function(r,t){return t=IA(t),r-t.size-t.margin.right-t.margin.left},d0=function(r,t,e){var i=r.y,n=r.height;e===void 0&&(e=0);var a=0;switch(t){case"top":a=i;break;case"middle":a=i+n/2-e/2;break;default:a=i+n-e;break}return a},av=function(r,t,e,i,n){e===void 0&&(e=0),n===void 0&&(n=1);var a=r.x,o=r.width,s=t||{},l=s.textAlign,u=s.textBaseline,c=IA(i),h=c.size,f=c.margin,d=c.position,v=n*(h+f.left)+(n?f.right:0),p,g;switch(l){case"left":p=a+(d==="left"?v:0),g=a+(d==="left"?f.left:e+f.left);break;case"center":{var m=v-(d==="left"?f.left:f.right)+e,y=a+o/2-m/2;p=y+e/2+(d==="left"?v-f.left:0),g=y+(d==="left"?0:e+f.left);break}default:{p=a+o-(d==="right"?v:0),g=a+o-(d==="right"?v-f.left:e+v-f.left);break}}var _=d0(r,u,0),x=d0(r,u,h);return{text:{x:p,y:_},icon:{x:g,y:x}}},Gbt=function(r,t){return av(r,t).text},Xbt=function(r,t,e){var i=t.start+t.width,n=r.start+r.width,a,o;if(t.start<=r.start&&i>=n)a=r.start+r.width/2,o=r.width;else if(t.start<=r.start){var s=t.width-(r.start-t.start);a=s<e?i-e/2:i-s/2,o=s}else if(i>=n){var s=t.width-(i-n);a=s<e?t.start+e/2:t.start+s/2,o=s}else a=t.start+t.width/2,o=t.width;return{start:a,width:o}},ru=function(r,t,e){var i=t.x,n=t.y,a=t.width,o=t.height,s=e.horizontalBorderWidth,l=e.horizontalBorderColorOpacity,u=e.horizontalBorderColor,c=e.verticalBorderWidth,h=e.verticalBorderColor,f=e.verticalBorderColorOpacity,d=e.borderDash,v,p,g,m,y;if(r===Cr.TOP||r===Cr.BOTTOM){var _=n;r===Cr.TOP?_=n+c/2:_=n+o-c/2,p=_,m=_,v=i,g=i+a,y={lineWidth:s,stroke:u,strokeOpacity:l,lineDash:d}}if(r===Cr.LEFT||r===Cr.RIGHT){var x=i;r===Cr.LEFT?x=i+s/2:x=i+a-s/2,v=x,g=x,p=n,m=n+o,y={lineWidth:c,stroke:h,strokeOpacity:f,lineDash:d}}return{position:{x1:v,x2:g,y1:p,y2:m},style:y}},Ybt=function(r,t,e){e===void 0&&(e={left:0,right:0});var i=k({},r);return t==="left"?(i.start+=e.left,i.width-=e.left):t==="right"&&(i.width-=e.right),i},jbt=function(r,t,e,i){var n=t+e,a=r.start;if(i==="center")return a-e/2;var o=r.width-n>0,s=o?r.width/2:n/2;return i==="left"?a-s:a+s-e};mu(function(r,t){if(r===void 0&&(r=""),!t)return 0;var e=Dbt().getContext("2d"),i=t,n=i.fontSize,a=i.fontFamily,o=i.fontWeight,s=i.fontStyle,l=i.fontVariant;return e.font=[s,l,o,"".concat(n,"px"),a].join(" ").trim(),e.measureText("".concat(r)).width},function(r,t){return ht([r],tt(Ko(t)),!1).join("")});var XI=function(r,t,e,i){var n=16,a=r(lc,i),o;uh(t)?o=t:o=be(t);var s=e,l=[],u,c;if(r(t,i)<=e)return t;for(var h=!0;h;){if(u=o.substr(0,n),c=r(u,i),c+a>s&&c>s){h=!1;break}if(l.push(u),s-=c,o=o.substr(n),!o)return l.join("")}for(var f=!0;f;){if(u=o.substr(0,1),c=r(u,i),c+a>s){f=!1;break}if(l.push(u),s-=c,o=o.substr(1),!o)return l.join("")}return"".concat(l.join(""),"...")},zc=function(r){var t=r.measureTextWidth,e=r.text,i=r.maxWidth,n=r.fontParam,a=r.priorityParam,o=r.placeholder,s={},l=o??gm,u=wr(e)||e===""||e===vu,c=u?l:"".concat(e),h=a;if(n&&It(n)?h=n:s=n||{},!h||!h.length)return XI(t,c,i,s);var f=[],d=[c];h.forEach(function(m){d.forEach(function(y,_){var x=-1,C=y.match(new RegExp(m));if(C){var A=C[0];x=C.index,f.push(A);var T=x+A.length,w=y.slice(0,x),M=y.slice(T),O=[w,M].filter(function(P){return!!P});d.splice.apply(d,ht([_,1],tt(O),!1))}})}),d=f.concat(d);var v=c,p=t(lc,s),g=i;return d.forEach(function(m){if(g<=0){var y=v.indexOf(m),_=v.slice(y-3,y);if(_&&_!==lc){var x=t(m,s);v=v.replace(m,x>p?lc:m)}else v=v.replace(m,"");g-=p}else{var x=t(m,s);if(g<x&&x>p){var C=XI(t,m,g,s);v=v.replace(m,C),g=0}else g-=x}}),v},Zbt=function(r,t,e,i){i===void 0&&(i="left");var n=t.right,a=t.left,o=e||0;return i==="left"?r+n/2+o:i==="right"?r-n/2-o:r+a/2+o},qbt=function(r){var t,e,i=r.getMeta().isTotals,n=(e=(t=r).isMeasureField)===null||e===void 0?void 0:e.call(t),a=r.getStyle(r.cellType||st.DATA_CELL),o;return n?o=a.measureText:i?o=a.bolderText:o=a.text,{cellStyle:a,textStyle:o}},Kbt=function(r){var t=r.rowIndex,e=r.colIndex,i=r.meta,n=r.data,a=r.textStyle,o=r.textCondition,s=a==null?void 0:a.fill;return o!=null&&o.mapping&&(s=o==null?void 0:o.mapping(n,{rowIndex:t,colIndex:e,meta:i}).fill),k(k({},a),{fill:s})},xu=function(r,t){return Zr(t)?t(r):t},Qbt=function(r,t,e){for(var i=r.x,n=r.y,a=r.width,o=r.height,s=o/qu(t),l=[],u,c,h,f=0,d=se(e,function(m){return m>1?m/100:m}),v=0;v<qu(t);v++){c=n+s*v;var p=[];u=i,f=0;for(var g=0;g<qu(t[v]);g++)h=at(d)?a/qu(t[0]):a*d[g],u=Zbt(i,{left:0,right:0},f,"left"),f+=h,p.push({x:u,y:c,width:h,height:s});l.push(p)}return l},Jbt=function(r,t,e){var i,n,a,o;e===void 0&&(e=!0);var s=r.getContentArea(),l=s.x,u=s.y,c=s.height,h=s.width,f=t||r.getMeta().fieldValue,d=f.values,v=r.getMeta().spreadsheet,p=v.options,g=v.measureTextWidth,m=p.style.cellCfg.valuesCfg,y=(n=(i=p==null?void 0:p.conditions)===null||i===void 0?void 0:i.text)===null||n===void 0?void 0:n[0],_=(o=(a=p==null?void 0:p.conditions)===null||a===void 0?void 0:a.icon)===null||o===void 0?void 0:o[0];if(!It(d)){Vbt(r,d);return}var x=m==null?void 0:m.widthPercent,C=0;if(f!=null&&f.label){var A=r.getStyle(st.DATA_CELL),T=A.bolderText;C=c/(d.length+1);var w=eu(r,[],l,u+C/2,zc({measureTextWidth:g,text:f.label,maxWidth:h,fontParam:T}),T);r.addTextShape(w)}for(var M=qbt(r),O=M.cellStyle,P=M.textStyle,D=O==null?void 0:O.icon,z=_&&_.mapping&&{size:D==null?void 0:D.size,margin:D==null?void 0:D.margin,position:_==null?void 0:_.position},Y,H=Qbt({x:l,y:u+C,height:c-C,width:h},d,x),N=0;N<d.length;N++)for(var W=qd(d[N]),Q=0;Q<W.length;Q++){Y=W[Q];var q=e?Kbt({rowIndex:N,colIndex:Q,meta:r==null?void 0:r.getMeta(),data:Y,textStyle:P,textCondition:y}):P,J=(r==null?void 0:r.getMeta().spreadsheet.options).placeholder,et=xu(r==null?void 0:r.getMeta(),J),ft=u7(H[N][Q].width,D),Ct=zc({measureTextWidth:g,text:Y,maxWidth:ft,fontParam:q,placeholder:et}),ct=g(Ct,P),dt=av(H[N][Q],P,ct,z,_?1:0),w=eu(r,[],dt.text.x,dt.text.y,Ct,q,{},Y==null?void 0:Y.toString());if(r.addTextShape(w),_&&e){var Rt=_==null?void 0:_.mapping(Y,{rowIndex:N,colIndex:Q,meta:r==null?void 0:r.getMeta()});if(Rt){var le=LA(r,k(k({},dt.icon),{name:Rt.icon,width:D==null?void 0:D.size,height:D==null?void 0:D.size,fill:Rt.fill}));r.addConditionIconShape(le)}}}},T_=function(r,t){return t===void 0&&(t=1),(r==null?void 0:r.width)*t},t2t=function(r){try{return JSON.parse(r)}catch{return null}},e2t=function(r,t,e){return r.sort(function(i,n){e&&(i=e(i),n=e(n));var a=t.indexOf(i),o=t.indexOf(n);return a===-1&&o===-1?0:a===-1?1:o===-1?-1:a-o})},r2t=function(r){return r===void 0&&(r=[]),r.filter(function(t){return t!==Ka&&t!==CS})},i2t=function(r){return It(r)?KN(r):[r]},n2t=function(r,t){var e;return(e=r==null?void 0:r.filter(function(i){return!(t!=null&&t.includes(i))}))===null||e===void 0?void 0:e.concat(t)};function a2t(r,t){var e=r.isRowTotal,i=r.isRowSubTotal,n=r.isColTotal,a=r.isColSubTotal,o=t||{},s=o.row,l=o.col,u=s||{},c=u.calcTotals,h=c===void 0?{}:c,f=u.calcSubTotals,d=f===void 0?{}:f,v=l||{},p=v.calcTotals,g=p===void 0?{}:p,m=v.calcSubTotals,y=m===void 0?{}:m,_=function(x,C){if((x.aggregation||x.calcFunc)&&C)return{aggregation:x.aggregation,calcFunc:x.calcFunc}};return _(g,n)||_(y,a)||_(h,e)||_(d,i)}function hd(r){return r===eg}function ml(r,t,e){return r===void 0&&(r={}),t===void 0&&(t=[]),e===void 0&&(e=Ka),t.reduce(function(i,n){var a=r[n];return n in r?i.push(String(a)):i.push(e),i},[])}function c7(r,t){var e=t.filter(function(i){return i in r});return at(e)&&e.push(CS),e}function YI(r,t,e){r===void 0&&(r={}),t===void 0&&(t=[]);var i=[];function n(a,o,s){return o.reduce(function(l,u){var c=a[u];return u in a?l.push(String(c)):u===Zt&&s?l.push(s):l.push(Ka),l},[])}return e?e.forEach(function(a){i.push(n(r,t,a))}):i.push(n(r,t)),i}function o2t(r,t,e){var i,n=t.slice(0,t.indexOf(r)+1);return(i=e.map(function(a){return n.map(function(o){return a[o]}).join("".concat(ii))}))===null||i===void 0?void 0:i.filter(function(a){return a})}function v0(r,t){return r.concat(t).filter(function(e){return e!==Zt}).join(ii)}function p0(r){var t=r.rowDimensionValues,e=r.colDimensionValues,i=r.isFirstCreate,n=r.onFirstCreate,a=r.rowFields,o=r.colFields,s=r.rowPivotMeta,l=r.colPivotMeta,u=r.prefix,c=u===void 0?"":u,h=function(v,p,g,m){for(var y=g,_=[],x=0;x<p.length;x++){var C=p[x];if(i&&y&&!(y!=null&&y.has(C))){var A=p.slice(0,x+1).map(function(D){return String(D)}),T=A.join(ii),w=C===Ka,M=void 0;w?M=0:y.has(Ka)?M=y.size:M=y.size+1,y.set(C,{id:T,dimensions:A,value:C,level:M,children:new Map}),n==null||n({dimension:v==null?void 0:v[x],dimensionPath:T,careRepeated:m})}var O=y==null?void 0:y.get(C);if(_.push(hd(C)?C:O==null?void 0:O.level),O){var P=v==null?void 0:v[x+1];i&&O.childField!==P&&(O.childField=P),y=O==null?void 0:O.children}}return _},f=h(a,t,s,!1),d=h(o,e,l,!0);return ht(ht([c],tt(f),!1),tt(d),!1)}function s2t(r){var t=r.rows,e=r.columns,i=r.values,n=r.valueInCols,a=r.data,o=a===void 0?[]:a,s=r.indexesData,l=s===void 0?{}:s,u=r.sortedDimensionValues,c=r.rowPivotMeta,h=r.colPivotMeta,f=r.getExistValuesByDataItem,d=[],v=new Set(t6(t,e)),p=function(m){var y=m.dimension,_=m.dimensionPath,x=m.careRepeated,C=x===void 0?!0:x;C&&v.has(y)||(u[y]||(u[y]=[])).push(_)},g=v0(t,e);return o.forEach(function(m){var y,_,x,C;if(!(!m||at(m))){var A=f?f(m,i):c7(m,i),T=YI(m,t,n?null:A),w=YI(m,e,n?A:null);try{for(var M=Vn(T),O=M.next();!O.done;O=M.next()){var P=O.value;try{for(var D=(x=void 0,Vn(w)),z=D.next();!z.done;z=D.next()){var Y=z.value,H=p0({rowDimensionValues:P,colDimensionValues:Y,rowPivotMeta:c,colPivotMeta:h,rowFields:t,colFields:e,isFirstCreate:!0,onFirstCreate:p,prefix:g});d.push(H),sd(l,H,m)}}catch(N){x={error:N}}finally{try{z&&!z.done&&(C=D.return)&&C.call(D)}finally{if(x)throw x.error}}}}catch(N){y={error:N}}finally{try{O&&!O.done&&(_=M.return)&&_.call(M)}finally{if(y)throw y.error}}}}),{paths:d,indexesData:l,rowPivotMeta:c,colPivotMeta:h,sortedDimensionValues:u}}function jI(r,t){if(!(!r||!t)){var e=t.split(ii),i=Pe(e),n=r;Ht(e,function(a,o){var s=n.get(a);return s?(a===i?(s.children=new Map,s.childField=void 0):n=s.children,!0):o===0&&a===s4})}}function l2t(r,t,e){var i=function(o){var s=ci(r,function(l){var u=l.field;return u===o});return Nt(s,"name",o)},n=t||e,a={field:Zt,name:n,formatter:function(o){return i(o)}};return a}function Rf(r,t){return{isRowTotal:r.isGrandTotals,isRowSubTotal:r.isSubTotals,isColTotal:t.isGrandTotals,isColSubTotal:t.isSubTotals}}function u2t(r){for(var t=null,e=0;e<r.length;e++){var i=r[e];if(hd(i))t=e;else if(!o6(t)&&t<e)return!0}return!1}function h7(r){var t=r.pivotMeta,e=r.dimensionValues,i=r.fieldIdx,n=r.queryType,a=r.fields,o=r.sortedDimensionValues,s={children:t},l=[s];function u(f,d){var v,p=Jd(f,function(y){var _,x,C=[];try{for(var A=Vn(y.children.values()),T=A.next();!T.done;T=A.next()){var w=T.value;w.value!==CS&&(n===Dn.All||w.value!==Ka)&&C.push(w)}}catch(M){_={error:M}}finally{try{T&&!T.done&&(x=A.return)&&x.call(A)}finally{if(_)throw _.error}}return C});if(f.length>1){var g=(v=o[d])!==null&&v!==void 0?v:[],m=new Map(g.map(function(y,_){return[y,_]}));return p.sort(function(y,_){return m.get(y.id)-m.get(_.id)}),p}return p}for(var c=function(f){var d=e[f],v=a[f];hd(d)?l=u(l,v):l=l.map(function(p){return p.children.get(d)}).filter(Boolean)},h=0;h<=i;h++)c(h);return l}function ZI(r){var t=r.dimensionValues,e=r.pivotMeta,i=r.fields,n=r.sortedDimensionValues,a=r.queryType,o=a===void 0?Dn.All:a;if(!u2t(t))return[t];var s=h7({pivotMeta:e,dimensionValues:t,fieldIdx:t.length-1,queryType:o,fields:i,sortedDimensionValues:n});return s.map(function(l){return l.dimensions})}function c2t(r){var t=r.rowFields,e=r.rowDimensionValues,i=r.rowPivotMeta,n=r.colFields,a=r.colDimensionValues,o=r.colPivotMeta,s=r.queryType,l=r.sortedDimensionValues,u=ZI({dimensionValues:e,pivotMeta:i,fields:t,sortedDimensionValues:l,queryType:s}),c=ZI({dimensionValues:a,pivotMeta:o,fields:n,sortedDimensionValues:l,queryType:s});return{rowQueries:u,colQueries:c}}function h2t(r,t){return r?It(r)?Jd(r,function(e){if(!It(e))return ma([e]);var i=t===Dn.DetailOnly?1:0;return ma(e.slice(i))}):ma([r]):[]}var yp;function qI(r,t){return!r||!t?!1:String(r).toLowerCase()===String(t).toLowerCase()}var f2t=`\r
`,d2t="	",g0=function(r,t){var e=r.getColumnNodes().find(function(i){return i.id===t});return r.isPivotMode()?e==null?void 0:e.value:e==null?void 0:e.field},v2t=function(r,t){var e=t.getColumnNodes().find(function(i){return i.colIndex===r});return g0(t,e.id)},p2t=function(r,t){var e=r.rowIndex,i=r.colIndex;return[t.getRowNodes().find(function(n){return n.rowIndex===e}),t.getColumnNodes().find(function(n){return n.colIndex===i})]},fd=function(r,t){var e=t.getColumnNodes().find(function(n){return n.colIndex===r}),i=g0(t,e.id);return t.options.interaction.copyWithFormat?t.dataSet.getFieldFormatter(i):function(n){return n}},g2t=function(r){var t,e,i,n,a=((n=(i=(e=r.options)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.colCfg)===null||n===void 0?void 0:n.hideMeasureColumn)&&r.isValueInCols();return a?(t={},t[Zt]=r.dataCfg.fields.values[0],t):{}},m2t=function(r,t,e){var i,n;if(e.isPivotMode()){var a=tt(p2t(r,e),2),o=a[0],s=a[1],l=g2t(e),u=e.dataSet.getCellData({query:k(k(k({},o.query),s.query),l),rowNode:o,isTotals:o.isTotals||o.isTotalMeasure||s.isTotals||s.isTotalMeasure,totalStatus:Rf(o,s)});return(i=u==null?void 0:u[$i])!==null&&i!==void 0?i:""}var c=v2t(r.colIndex,e);return(n=t[r.rowIndex])===null||n===void 0?void 0:n[c]},f7=function(r,t,e){var i=fd(r.colIndex,e);return i(m2t(r,t,e))},OA=function(r){return/\n/.test(r)?'"'+r.replace(/\r\n?/g,`
`)+'"':r},dd=function(r,t){var e=r.split(ii);return t?e.slice(e.length-t):(e.shift(),e)},aC=function(r,t){return se(r,function(e){return t.dataSet.getFieldName(e)})},Qe;(function(r){r.PLAIN="text/plain",r.HTML="text/html"})(Qe||(Qe={}));var y2t=function(r){return{type:Qe.PLAIN,content:se(r,function(t){return t.join(d2t)}).join(f2t)}},_2t=function(r){function t(i,n){return i.map(function(a){return"<".concat(n,">").concat(QS(a),"</").concat(n,">")}).join("")}function e(i,n){return i.map(function(a){return"<".concat(n,">").concat(t(a,"td"),"</").concat(n,">")}).join("")}return{type:Qe.HTML,content:'<meta charset="utf-8"><table><tbody>'.concat(e(r,"tr"),"</tbody></table>")}},x2t=(yp={},yp[Qe.PLAIN]=y2t,yp[Qe.HTML]=_2t,yp);function Yi(r){return x2t[r]}function C2t(r,t){return t===void 0&&(t=Qe.PLAIN),Array.isArray(t)?[].concat(r).filter(function(e){return t.includes(e.type)}).map(function(e){return e.content}):[].concat(r).filter(function(e){return(e==null?void 0:e.type)===t}).map(function(e){return e.content})[0]||""}var d7=function(r,t,e){var i,n,a,o,s,l,u=(n=(i=r[0])===null||i===void 0?void 0:i.length)!==null&&n!==void 0?n:0,c=(a=t==null?void 0:t.length)!==null&&a!==void 0?a:0,h=(s=(o=e[0])===null||o===void 0?void 0:o.length)!==null&&s!==void 0?s:0,f=(l=e.length)!==null&&l!==void 0?l:0,d=u+h,v=c+f,p=Array.from(Array(v),function(){return new Array(d)});return p=se(p,function(g,m){return se(g,function(y,_){if(_>=0&&_<u&&m>=0&&m<c)return"";if(_>=u&&_<=d&&m>=0&&m<c)return t[m][_-u];if(_>=0&&_<u&&m>=c&&m<v)return r[m-c][_];if(_>=u&&_<=d&&m>=c&&m<v)return e[m-c][_-u]})}),[Yi(Qe.PLAIN)(p),Yi(Qe.HTML)(p)]},E2t=function(r,t,e){var i=t.map(function(n){return n.map(function(a){return a?OA(f7(a,r,e)):""})});return[Yi(Qe.PLAIN)(i),Yi(Qe.HTML)(i)]},S2t=function(r){if(!(r!=null&&r.length))return[];var t=tt([{row:1/0,col:1/0},{row:0,col:0}],2),e=t[0],i=t[1];r.forEach(function(l){var u=l.rowIndex,c=l.colIndex;e.col=Math.min(c,e.col),e.row=Math.min(u,e.row),i.col=Math.max(c,i.col),i.row=Math.max(u,i.row)});var n=tt([i.row-e.row+1,i.col-e.col+1],2),a=n[0],o=n[1],s=new Array(a).fill("").map(function(){return new Array(o).fill("")});return r.forEach(function(l){var u=l.rowIndex,c=l.colIndex,h=tt([u-e.row,c-e.col],2),f=h[0],d=h[1];s[f][d]=l}),s},A2t=function(r,t){var e=r.dataSet.getDisplayDataSet(),i=t.length?t.map(function(a){return{field:g0(r,a.id),formatter:fd(a.colIndex,r)}}):r.dataCfg.fields.columns.map(function(a){return r.getColumnNodes().find(function(o){return o.field===a})}).map(function(a){return{field:g0(r,a.id),formatter:fd(a.colIndex,r)}}),n=e.map(function(a){return i.map(function(o){var s=o.field,l=o.formatter;return OA(l(a[s]))})});return[Yi(Qe.PLAIN)(n),Yi(Qe.HTML)(n)]},v7=function(r,t,e){return se(r,function(i){return t.map(function(n){var a,o=e.dataSet.getCellData({query:k(k({},i.query),n.query),rowNode:i,isTotals:i.isTotals||i.isTotalMeasure||n.isTotals||n.isTotalMeasure,totalStatus:Rf(i,n)});return fd(n.colIndex,e)((a=o==null?void 0:o[$i])!==null&&a!==void 0?a:"")})})},T2t=function(r,t,e){var i=v7(t,e,r);return[Yi(Qe.PLAIN)(i),Yi(Qe.HTML)(i)]},b2t=function(r,t,e){var i=se(t,function(o){return dd(o.id)}),n=Hm.apply(void 0,ht([],tt(se(e,function(o){return dd(o.id)})),!1)),a=v7(t,e,r);return d7(i,n,a)};function p7(r,t,e){var i=r.options.interaction.copyWithHeader;return i?b2t(r,t,e):T2t(r,t,e)}var w2t=function(r,t){var e=r.getRowNodes().filter(function(a){return a.isLeaf||r.isHierarchyTreeType()}),i=r.getColumnNodes().filter(function(a){return a.isLeaf}),n=t.length?t.reduce(function(a,o){return a.push.apply(a,ht([],tt(i.filter(function(s){return s.id.startsWith(o.id)})),!1)),a},[]):i;return p7(r,e,n)},KI=function(r,t,e){return t.isPivotMode()?w2t(t,e):A2t(t,e)},R2t=function(r,t){var e=r.dataSet.getDisplayDataSet(),i=e.filter(function(n,a){return t.map(function(o){return o.rowIndex}).includes(a)}).map(function(n){var a=r.getColumnNodes().reduce(function(o,s,l){return o[s.field]=l,o},{});return Object.keys(n).sort(function(o,s){return a[o]-a[s]}).map(function(o){return r.getColumnNodes().find(function(s){return s.field===o})}).filter(Boolean).map(function(o){return OA(fd(o.colIndex,r)(n[o.field]))})});return[Yi(Qe.PLAIN)(i),Yi(Qe.HTML)(i)]},M2t=function(r,t){var e=r.getRowNodes().filter(function(a){return a.isLeaf||r.isHierarchyTreeType()}),i=r.getColumnNodes().filter(function(a){return a.isLeaf}),n=t.reduce(function(a,o){return a.push.apply(a,ht([],tt(e.filter(function(s){return s.id.startsWith(o.id)})),!1)),a},[]);return p7(r,n,i)},I2t=function(r,t,e){return t.isPivotMode()?M2t(t,e):R2t(t,e)},L2t=function(r,t,e){var i=Hm.apply(void 0,ht([],tt(se(r[0],function(o){var s,l=(o==null?void 0:o.colId)||Pe((s=o==null?void 0:o.id)===null||s===void 0?void 0:s.split(Lx))||"";return aC(dd(l),e)})),!1)),n=se(r,function(o){var s,l,u,c=((s=o==null?void 0:o[0])===null||s===void 0?void 0:s.rowId)||tu((u=(l=o==null?void 0:o[0])===null||l===void 0?void 0:l.id)===null||u===void 0?void 0:u.split(Lx))||"";return aC(dd(c),e)}),a=se(r,function(o){return se(o,function(s){return f7(s,t,e)})});return d7(n,i,a)};function O2t(r){var t=new Set;return Ht(r,function(e){var i=e.getMeta().level;t.has(i)||t.add(i)}),t}function P2t(r,t){return qo(r,function(e){var i=e.getMeta(),n=i.level===t,a=i.isTotals&&at(i.children);return n||a})}function F2t(r,t){for(var e=r,i={level:t},n=e.label;e.level>=0;){for(var a=i.level-e.level;a>0;)n="".concat(e.label).concat(ii).concat(n),a--;i=e,e=e.parent}return n}function B2t(r,t,e){return se(r,function(i){var n=i.getMeta(),a=n.id,o=n.isTotals,s=n.spreadsheet,l=o?F2t(n,t):a,u=dd(l,e.size);return aC(u,s)})}function D2t(r){var t,e=O2t(r),i=(t=Nc(Array.from(e)))!==null&&t!==void 0?t:0,n=P2t(r,i),a=r[0].cellType===st.COL_CELL,o=B2t(n,i,e);return a&&(o=Hm.apply(void 0,ht([],tt(o),!1))),[Yi(Qe.PLAIN)(o),Yi(Qe.HTML)(o)]}var N2t=function(r,t,e){return se(t,function(i){var n;return(n=r[i])!==null&&n!==void 0?n:e})},k2t=function(r,t){var e=r.options.placeholder,i=r.dataCfg.fields,n=i.rows,a=i.columns,o=i.values,s=xu(r,e),l=r.getColumnLeafNodes(),u=[];if(r.isTableMode()){var c=qo(l,function(v){return v.field!==jl});u=se(t,function(v){return se(c,function(p){var g;return(g=v==null?void 0:v[p.field])!==null&&g!==void 0?g:s})})}else if(r.isPivotMode()){var h=ht(ht(ht([],tt(n),!1),tt(a),!1),tt(o),!1),f=i2t(t),d=f.filter(function(v){return ht(ht([],tt(n),!1),tt(a),!1).every(function(p){return!wr(v[p])})});u=km(d,function(v,p){return ht(ht([],tt(v),!1),[N2t(p,h,s)],!1)},[])}return[Yi(Qe.PLAIN)(u),Yi(Qe.HTML)(u)]};function U2t(r,t){var e,i,n=t.filter(function(c){var h=c.type;return h===st.COL_CELL}),a=t.filter(function(c){var h=c.type;return h===st.ROW_CELL}),o=r.dataSet.getDisplayDataSet();if(r.interaction.getCurrentStateName()===At.ALL_SELECTED)i=KI(o,r,[]);else if(n.length)i=KI(o,r,n);else if(a.length)i=I2t(o,r,a);else{if(!t.length)return;var s=S2t(t),l=r.interaction.getSelectedCellHighlight().currentRow;if(l){var u=fA(t,"rowIndex","asc").map(function(c){return r.dataSet.getRowData(c)});i=k2t(r,u)}else!((e=r.options.interaction)===null||e===void 0)&&e.copyWithHeader?i=L2t(s,o,r):i=E2t(o,s,r)}return i}var z2t=function(r){var t,e=r.interaction,i=e.getState().cells||[],n,a=(t=e.getInteractedCells())!==null&&t!==void 0?t:[],o=at(a)?!1:Lm(a,function(s){return s.cellType===st.ROW_CELL||s.cellType===st.COL_CELL});return o?n=D2t(a):n=U2t(r,i),n&&$2t(n),C2t(n,Qe.PLAIN)},g7=function(r){return new Promise(function(t,e){var i;Array.isArray(r)?i=Nt(r.filter(function(o){return o.type===Qe.PLAIN}),"[0].content",""):i=r.content||"";var n=document.createElement("textarea");n.value=i,document.body.appendChild(n),n.focus({preventScroll:!0}),n.select();var a=document.execCommand("copy");document.body.removeChild(n),a?t():e()})},H2t=function(r){return navigator.clipboard.write([new ClipboardItem([].concat(r).reduce(function(t,e){var i,n=e.type,a=e.content,o=a.replace(/\x00/g,"");return k(k({},t),(i={},i[n]=new Blob([o],{type:n}),i))},{}))]).catch(function(){return g7(r)})},$2t=function(r,t){t===void 0&&(t=!1);var e;return typeof r=="string"?e={content:r,type:Qe.PLAIN}:e=r,!navigator.clipboard||!window.ClipboardItem||t?g7(e):H2t(e)},PA=function(r,t,e){var i,n=r.split(ii);if(e)i=[r];else{i=[cd(n[0],n[1])];for(var a=2;a<n.length;a+=1)i.push(cd(i[a-2],n[a]))}var o=qo(t,function(s){var l;return i.includes((l=s.getMeta())===null||l===void 0?void 0:l.id)});return o},m7=function(r,t,e){if(r){var i=PA(r,t);Ht(i,function(n){n.updateByState(e)})}},W2t=function(r,t){return typeof r=="function"?r(t):r.some(function(e){return e===t.key||e===t.id||e===t.valueField})},Ba=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=function(n,a){if(It(n)&&It(a))return a},i=ht(ht([],tt(r),!1),[e],!1);return ZS.apply(void 0,ht([{}],tt(i),!1))},V2t=function(r){var t=["rows","columns","values"],e=t.reduce(function(i,n){var a=r[n],o=So(a);return jr(o,a)||console.warn("fields.".concat(n,":[").concat(a,"] should be unique")),i[n]=o,i},{});return k(k({},r),e)},b_=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=Ba.apply(void 0,ht([Vct],tt(r),!1));return e.fields=V2t(e.fields),(!at(e.fields.customTreeItems)||at(e.fields.values))&&(e.fields.valueInCols=!1),e},QI=function(r){return Ba(qct,r)},Gm=function(r){gt(t,r);function t(e,i){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];var o=r.call(this,{})||this;return o.textShapes=[],o.actualTextWidth=0,o.conditionIconShapes=[],o.stateShapes=new Map,o.meta=e,o.spreadsheet=i,o.theme=i.theme,o.conditions=o.spreadsheet.options.conditions,o.handleRestOptions.apply(o,ht([],tt(n),!1)),o.shouldInit()&&o.initCell(),o}return t.prototype.getMeta=function(){return this.meta},t.prototype.setMeta=function(e){this.meta=Ba(this.meta,e)},t.prototype.getIconStyle=function(){return this.theme[this.cellType].icon},t.prototype.getTextAndIconPosition=function(e){e===void 0&&(e=1);var i=this.getTextStyle(),n=this.getIconStyle();return av(this.getContentArea(),i,this.actualTextWidth,n,e)},t.prototype.getActualText=function(){return this.actualText},t.prototype.isTextOverflowing=function(){var e=this.getActualText();return e?Ei(e,lc):e!==this.getFieldValue()},t.prototype.getFieldValue=function(){var e=this.getFormattedFieldValue().formattedValue;return e===vu?this.getActualText():e},t.prototype.handleRestOptions=function(){},t.prototype.shouldInit=function(){var e=this.meta,i=e.width,n=e.height;return i>0&&n>0},t.prototype.getStyle=function(e){return Nt(this.theme,e||this.cellType)},t.prototype.getResizeAreaStyle=function(){return this.getStyle("resizeArea")},t.prototype.shouldDrawResizeAreaByType=function(e,i){var n=this.spreadsheet.options.interaction.resize;return za(n)?n:Zr(n.visible)?n.visible(i):n[e]},t.prototype.getCellArea=function(){var e=this.meta,i=e.x,n=e.y,a=e.height,o=e.width;return{x:i,y:n,height:a,width:o}},t.prototype.getContentArea=function(){var e=this.getStyle()||this.theme.dataCell,i=(e==null?void 0:e.cell).padding;return l7(this.getCellArea(),i)},t.prototype.getIconPosition=function(e){return e===void 0&&(e=1),this.getTextAndIconPosition(e).icon},t.prototype.drawTextShape=function(){var e=this.getFormattedFieldValue().formattedValue,i=this.getMaxTextWidth(),n=this.getTextStyle(),a=this.spreadsheet,o=a.options.placeholder,s=a.measureTextWidth,l=xu(this,o),u=zc({measureTextWidth:s,text:e,maxWidth:i,fontParam:n,placeholder:l});this.actualText=u,this.actualTextWidth=s(u,n);var c=this.getTextPosition();this.textShape=eu(this,[this.textShape],c.x,c.y,u,n),this.textShapes.push(this.textShape)},t.prototype.drawLinkFieldShape=function(e,i){if(e){var n=this.spreadsheet.options.style.device;if(!Or(n)){var a=this.getTextStyle(),o=this.getTextPosition(),s=o.x;a.textAlign==="center"?s-=this.actualTextWidth/2:a.textAlign==="right"&&(s-=this.actualTextWidth);var l=this.textShape.getBBox().maxY;this.linkFieldShape=Xr(this,{x1:s,y1:l+1,x2:s+this.actualTextWidth,y2:l+1},{stroke:i,lineWidth:1})}this.textShape.attr({fill:i,cursor:"pointer",appendInfo:{isLinkFieldText:!0,cellData:this.meta}})}},t.prototype.getLinkFieldStyle=function(){return this.getTextStyle().linkTextFill},t.prototype.drawLinkField=function(e){var i=this.spreadsheet.options.interaction.linkFields,n=i===void 0?[]:i,a=this.getLinkFieldStyle(),o=W2t(n,e);this.drawLinkFieldShape(o,a)},t.prototype.updateByState=function(e,i){var n=this;this.spreadsheet.interaction.setInteractedCells(i);var a=Nt(this.theme,"".concat(this.cellType,".cell.interactionState.").concat(e));Ht(a,function(o,s){var l=ir(hA(Gct,function(u){return Ei(u,s)}));l.forEach(function(u){var c=n.stateShapes.has(u),h=c?n.stateShapes.get(u):n[u],f=It(h)?h:[h];if(c&&f.forEach(function(v){v.set("visible",!0)}),u==="interactiveBorderShape"&&s==="borderWidth"&&yi(o)){var d=n.getInteractiveBorderShapeStyle(o);Ht(d,function(v,p){In(f,p,v)})}In(f,an[s],o)})})},t.prototype.getInteractiveBorderShapeStyle=function(e){var i=this.getCellArea(),n=i.x,a=i.y,o=i.height,s=i.width,l=this.theme.dataCell.cell,u=l.horizontalBorderWidth,c=l.verticalBorderWidth;return{x:n+c/2+e/2,y:a+u/2+e/2,width:s-c-e,height:o-u-e}},t.prototype.hideInteractionShape=function(){this.stateShapes.forEach(function(e){In(e,an.backgroundOpacity,0),In(e,an.backgroundColor,"transparent"),In(e,an.borderOpacity,0),In(e,an.borderWidth,1),In(e,an.borderColor,"transparent")})},t.prototype.clearUnselectedState=function(){In(this.backgroundShape,an.backgroundOpacity,1),In(this.textShapes,an.textOpacity,1),In(this.linkFieldShape,an.opacity,1)},t.prototype.getTextShape=function(){return this.textShape},t.prototype.getTextShapes=function(){return this.textShapes||[this.textShape]},t.prototype.addTextShape=function(e){e&&this.textShapes.push(e)},t.prototype.getConditionIconShape=function(){return this.conditionIconShape},t.prototype.getConditionIconShapes=function(){return this.conditionIconShapes||[this.conditionIconShape]},t.prototype.addConditionIconShape=function(e){e&&this.conditionIconShapes.push(e)},t.prototype.resetTextAndConditionIconShapes=function(){this.textShapes=[],this.conditionIconShapes=[]},Object.defineProperty(t.prototype,"cellConditions",{get:function(){return this.conditions},enumerable:!1,configurable:!0}),t.prototype.drawConditionIconShapes=function(){var e,i=this.findFieldCondition((e=this.conditions)===null||e===void 0?void 0:e.icon);if(i&&i.mapping){var n=this.mappingValue(i),a=this.getIconPosition(),o=this.theme.dataCell.icon.size;at(n==null?void 0:n.icon)||(this.conditionIconShape=LA(this,k(k({},a),{name:n.icon,width:o,height:o,fill:n.fill})),this.addConditionIconShape(this.conditionIconShape))}},t.prototype.getTextConditionFill=function(e){var i,n,a=e.fill,o=this.findFieldCondition((i=this.conditions)===null||i===void 0?void 0:i.text);return o!=null&&o.mapping&&(a=((n=this.mappingValue(o))===null||n===void 0?void 0:n.fill)||e.fill),a},t.prototype.getCrossBackgroundColor=function(e){var i=this.getStyle().cell,n=i.crossBackgroundColor,a=i.backgroundColorOpacity;return n&&e%2===0?{backgroundColorOpacity:a,backgroundColor:n}:{backgroundColorOpacity:a,backgroundColor:this.getStyle().cell.backgroundColor}},t}(no),y7=function(r,t){return t?t(r[Zt],r[$i]):r[$i]},Tl=function(r,t){var e=t.getMeta().id;return r.some(function(i){return jr(i.id,e)})},ov=function(r,t){return"".concat(r).concat(Lx).concat(t)},G2t=function(r){var t=r.interaction.getSelectedCellHighlight(),e=t.currentRow,i=t.currentCol,n=t.rowHeader,a=t.colHeader;return e||i||n||a},FA=function(r){return r.type===st.DATA_CELL},X2t=function(r,t){Ht(r,function(e){FA(e)&&e.rowIndex===t.getMeta().rowIndex&&t.updateByState(At.SELECTED)})},Y2t=function(r,t){Ht(r,function(e){FA(e)&&e.colIndex===t.getMeta().colIndex&&t.updateByState(At.SELECTED)})},j2t=function(r,t){Ht(r,function(e){FA(e)&&e.rowIndex===t.getMeta().rowIndex&&e.colIndex===t.getMeta().colIndex&&t.updateByState(At.SELECTED)})},Z2t=function(r,t,e){var i=e.interaction.getSelectedCellHighlight(),n=i.rowHeader,a=i.colHeader,o=i.currentRow,s=i.currentCol,l=t.cellType===st.ROW_CELL,u=e.isTableMode()&&e.options.showSeriesNumber&&n&&l;(o||u)&&X2t(r,t),s&&Y2t(r,t),(n||a)&&j2t(r,t)},Zs=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"cellType",{get:function(){return st.DATA_CELL},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valueRangeByField",{get:function(){return this.spreadsheet.dataSet.getValueRangeByField(this.meta.valueField)},enumerable:!1,configurable:!0}),t.prototype.handleByStateName=function(e,i){Tl(e,this)&&this.updateByState(i)},t.prototype.handleSearchResult=function(e){if(Tl(e,this)){var i=ci(e,function(n){return n==null?void 0:n.isTarget});i.id===this.getMeta().id?this.updateByState(At.HIGHLIGHT):this.updateByState(At.SEARCH_RESULT)}},t.prototype.handleSelect=function(e){var i,n=(i=e==null?void 0:e[0])===null||i===void 0?void 0:i.type;switch(n){case st.COL_CELL:this.changeRowColSelectState("colIndex");break;case st.ROW_CELL:this.changeRowColSelectState("rowIndex");break;case st.DATA_CELL:G2t(this.spreadsheet)?Z2t(e,this,this.spreadsheet):Tl(e,this)?this.updateByState(At.SELECTED):this.spreadsheet.options.interaction.selectedCellsSpotlight&&this.updateByState(At.UNSELECTED);break}},t.prototype.handleHover=function(e){var i=tu(e);if(i.type!==st.DATA_CELL){this.hideInteractionShape();return}var n=this.spreadsheet.interaction.getHoverHighlight(),a=n.currentRow,o=n.currentCol;if(a||o){var s=this.meta.colIndex,l=this.meta.rowIndex;o&&s===(i==null?void 0:i.colIndex)||a&&l===(i==null?void 0:i.rowIndex)?this.updateByState(At.HOVER):this.hideInteractionShape()}var u=this.getMeta(),c=u.id,h=u.rowIndex,f=u.colIndex;jr(i.id,c)&&jr(i.rowIndex,h)&&jr(i.colIndex,f)&&this.updateByState(At.HOVER_FOCUS)},t.prototype.update=function(){var e=this.spreadsheet.interaction.getCurrentStateName(),i=this.spreadsheet.interaction.getCells();if(e===At.ALL_SELECTED){this.updateByState(At.SELECTED);return}if(!(at(i)||!e))switch(e){case At.SELECTED:this.handleSelect(i);break;case At.HOVER_FOCUS:case At.HOVER:this.handleHover(i);break;case At.SEARCH_RESULT:this.handleSearchResult(i);break;default:this.handleByStateName(i,e);break}},t.prototype.setMeta=function(e){r.prototype.setMeta.call(this,e),this.initCell()},t.prototype.drawTextShape=function(){r.prototype.drawTextShape.call(this),this.drawLinkField(this.meta)},t.prototype.initCell=function(){this.resetTextAndConditionIconShapes(),this.drawBackgroundShape(),this.drawInteractiveBgShape(),this.shouldHideRowSubtotalData()||(this.drawConditionIntervalShape(),this.drawTextShape(),this.drawConditionIconShapes()),this.drawInteractiveBorderShape(),this.meta.isFrozenCorner&&this.drawBorderShape(),this.update()},t.prototype.getDefaultTextFill=function(e){var i=e.fill,n=this.getBackgroundColor(),a=n.backgroundColor,o=n.intelligentReverseTextColor;return X6(a)&&(i===u4||!xTt(a,i))&&o&&(i=Ox),i},t.prototype.getTextStyle=function(){var e=this.meta.isTotals,i=e?this.theme.dataCell.bolderText:this.theme.dataCell.text,n=this.getTextConditionFill(k(k({},i),{fill:this.getDefaultTextFill(i)}));return k(k({},i),{fill:n})},t.prototype.getIconStyle=function(){return n7(this.conditions,this.theme.dataCell.icon,this.meta.valueField)},t.prototype.drawConditionIntervalShape=function(){this.conditionIntervalShape=$bt(this)},t.prototype.shouldHideRowSubtotalData=function(){var e,i=this.meta,n=i.rowId,a=i.rowIndex,o=this.spreadsheet.store.get("drillDownIdPathMap");if(o!=null&&o.has(n))return!1;var s=((e=this.spreadsheet.options.totals)!==null&&e!==void 0?e:{}).row,l=s===void 0?{}:s,u=this.spreadsheet.facet.layoutResult.rowLeafNodes[a],c=!(u!=null&&u.isGrandTotals)&&(u==null?void 0:u.isTotals);return this.spreadsheet.options.hierarchyType==="tree"&&!l.showSubTotals&&c},t.prototype.getFormattedFieldValue=function(){var e;if(this.shouldHideRowSubtotalData())return{value:null,formattedValue:gm};var i=this.meta,n=i.rowId,a=i.valueField,o=i.fieldValue,s=i.data,l=i.id,u=(e=this.spreadsheet.dataSet.displayFormattedValueMap)===null||e===void 0?void 0:e.get(l),c=this.spreadsheet.dataSet.getFieldMeta(n),h=c?n:a,f=this.spreadsheet.dataSet.getFieldFormatter(h),d=u??f(o,s,this.meta);return{value:o,formattedValue:d}},t.prototype.getMaxTextWidth=function(){var e=this.getContentArea().width,i=this.getIconStyle();return u7(e,i)},t.prototype.getTextPosition=function(){return this.getTextAndIconPosition().text},t.prototype.getBackgroundColor=function(){var e,i=this.getCrossBackgroundColor(this.meta.rowIndex),n=i.backgroundColor,a=i.backgroundColorOpacity;if(this.shouldHideRowSubtotalData())return{backgroundColor:n,backgroundColorOpacity:a};var o=this.findFieldCondition((e=this.conditions)===null||e===void 0?void 0:e.background),s=!1;if(o&&o.mapping){var l=this.mappingValue(o);l&&(n=l.fill,s=l.intelligentReverseTextColor,a=1)}return{backgroundColor:n,backgroundColorOpacity:a,intelligentReverseTextColor:s}},t.prototype.drawBackgroundShape=function(){var e=this.getBackgroundColor(),i=e.backgroundColor,n=e.backgroundColorOpacity;this.backgroundShape=fn(this,k(k({},this.getCellArea()),{fill:i,fillOpacity:n}))},t.prototype.drawInteractiveBorderShape=function(){var e=1,i=this.getCellArea(),n=i.x,a=i.y,o=i.height,s=i.width;this.stateShapes.set("interactiveBorderShape",fn(this,{x:n+e,y:a+e,width:s-e*2,height:o-e*2},{capture:!1,visible:!1}))},t.prototype.drawInteractiveBgShape=function(){this.stateShapes.set("interactiveBgShape",fn(this,k({},this.getCellArea()),{visible:!1}))},t.prototype.changeRowColSelectState=function(e){var i=this.spreadsheet.interaction,n=Nt(this.meta,e),a=i.getState(),o=a.nodes,s=o===void 0?[]:o,l=a.cells,u=l===void 0?[]:l,c=!1;if(this.spreadsheet.isTableMode()&&s.length){var h=s[0].hierarchy.getLeaves();c=h.some(function(f,d){return s.some(function(v){return v===f})?d===n:!1})}else c=ht(ht([],tt(s),!1),tt(u),!1).some(function(f){return Nt(f,e)===n});c?this.updateByState(At.SELECTED):this.spreadsheet.options.interaction.selectedCellsSpotlight?this.updateByState(At.UNSELECTED):this.hideInteractionShape()},t.prototype.drawBorderShape=function(){var e=this;[Cr.BOTTOM,Cr.RIGHT].forEach(function(i){var n=ru(i,e.getCellArea(),e.getStyle().cell),a=n.position,o=n.style;Xr(e,a,o)})},t.prototype.findFieldCondition=function(e){return i7(e,this.meta.valueField)},t.prototype.mappingValue=function(e){var i=this.meta.fieldValue,n=this.spreadsheet.isTableMode()?this.spreadsheet.dataSet.getCellData({query:{rowIndex:this.meta.rowIndex}}):this.meta.data;return e==null?void 0:e.mapping(i,n)},t.prototype.updateByState=function(e){if(r.prototype.updateByState.call(this,e,this),e===At.UNSELECTED){var i=Nt(this.theme,"".concat(this.cellType,".cell.interactionState.").concat(e));i&&this.toggleConditionIntervalShapeOpacity(i.opacity)}},t.prototype.clearUnselectedState=function(){r.prototype.clearUnselectedState.call(this),this.toggleConditionIntervalShapeOpacity(1)},t.prototype.toggleConditionIntervalShapeOpacity=function(e){In(this.conditionIntervalShape,an.backgroundOpacity,e),In(this.conditionIconShapes,an.opacity,e)},t.prototype.drawLeftBorder=function(){var e=ru(Cr.LEFT,this.getCellArea(),this.getStyle().cell),i=e.position,n=e.style;Xr(this,i,n)},t}(Gm),q2t=function(r){gt(t,r);function t(e,i,n){return r.call(this,n,e,i)||this}return t.prototype.handleRestOptions=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=tt(e,1),a=n[0];this.cells=a},Object.defineProperty(t.prototype,"cellType",{get:function(){return st.MERGED_CELL},enumerable:!1,configurable:!0}),t.prototype.update=function(){},t.prototype.initCell=function(){this.resetTextAndConditionIconShapes(),this.conditions=this.spreadsheet.options.conditions,this.drawBackgroundShape(),this.drawTextShape()},t.prototype.drawBackgroundShape=function(){var e=twt(this.cells),i=this.theme.dataCell.cell;this.backgroundShape=Fbt(this,{points:e,stroke:i.horizontalBorderColor,fill:i.backgroundColor,lineHeight:i.horizontalBorderWidth})},t.prototype.drawTextShape=function(){at(this.meta)||(Oe(this.meta.fieldValue)?Jbt(this):r.prototype.drawTextShape.call(this))},t}(Zs),K2t=function(r,t,e,i){var n=[r,t],a=[r+e,t],o=[r+e,t+i],s=[r,t+i];return[[n,a],[a,o],[o,s],[s,n]]},Q2t=function(r){var t=[];return Ht(r,function(e){var i=[e[1],e[0]];JSON.stringify(r).includes(JSON.stringify(i))||t.push(e)}),t},J2t=function(r,t){return ci(t,function(e){return jr(e[0],r[1])})},twt=function(r){var t=[];r.forEach(function(o){var s=o.getMeta(),l=s.x,u=s.y,c=s.width,h=s.height;t=t.concat(K2t(l,u,c,h))}),t=Q2t(t);for(var e=[],i=t[0],n=i,a=[];!jr(i,a);)e=e.concat(n),a=J2t(n,t),n=a;return e},ewt=function(r,t){var e=[],i;return Ht(r,function(n){var a,o,s,l=(o=(a=t==null?void 0:t.facet)===null||a===void 0?void 0:a.layoutResult)===null||o===void 0?void 0:o.getCellMeta(n.rowIndex,n.colIndex);if(l){var u=(s=t==null?void 0:t.facet)===null||s===void 0?void 0:s.cfg.dataCell(l);i=n!=null&&n.showText?l:i,e.push(u)}}),{cells:e,cellsMeta:i}},rwt=function(r,t){var e=[],i=[],n;return Ht(r,function(a){var o=ci(t,function(s){var l,u=(l=s==null?void 0:s.getMeta)===null||l===void 0?void 0:l.call(s);if((u==null?void 0:u.colIndex)===(a==null?void 0:a.colIndex)&&(u==null?void 0:u.rowIndex)===(a==null?void 0:a.rowIndex))return s});o?(e.push(o),n=a!=null&&a.showText?o==null?void 0:o.getMeta():n):i.push(a)}),{cells:e,invisibleCellInfo:i,cellsMeta:n}},_7=function(r,t,e){var i;e===void 0&&(e=[]);var n=rwt(e,r),a=n.cellsMeta,o=n.cells,s=n.invisibleCellInfo,l=a,u=o,c=(s==null?void 0:s.length)>0&&s.length<e.length;if(c){var h=ewt(s,t),f=h.cells,d=h.cellsMeta;l=l||d,u=o.concat(f)}return!at(o)&&!l&&(l=(i=u[0])===null||i===void 0?void 0:i.getMeta()),{cells:u,viewMeta:l}},iwt=function(r){var t=r.interaction,e=t.getActiveCells(),i=[];return Ht(e,function(n,a){var o=n.getMeta(),s=a===0?{showText:!0}:{};i.push(k(k({},s),{colIndex:o==null?void 0:o.colIndex,rowIndex:o==null?void 0:o.rowIndex}))}),i},x7=function(r,t,e){var i;return!((i=r.options)===null||i===void 0)&&i.mergedCell?r.options.mergedCell(r,t,e):new q2t(r,t,e)},nwt=function(r,t,e){var i,n=t||iwt(r);if((n==null?void 0:n.length)<=1){console.error("[mergeCell]: The merged cells must be more than one!");return}var a=r.interaction.getPanelGroupAllDataCells(),o=_7(a,r,n),s=o.cells,l=o.viewMeta;if(!at(s)){var u=((i=r.options)===null||i===void 0?void 0:i.mergedCellsInfo)||[];u.push(n),r.setOptions({mergedCellsInfo:u});var c=e?void 0:l;r.panelScrollGroup.addMergeCell(x7(r,s,c))}},awt=function(r,t){var e=se(r.cells,function(i){return{colIndex:i.getMeta().colIndex,rowIndex:i.getMeta().rowIndex}});return qo(t,function(i){var n=i.map(function(a){return a.showText?{colIndex:a.colIndex,rowIndex:a.rowIndex}:a});return!jr(n,e)})},owt=function(r,t){var e,i,n;if(!t||t.cellType!==st.MERGED_CELL){console.error("[unmergeCell]: The ".concat(t," is not a MergedCell"));return}var a=awt(t,(e=r.options)===null||e===void 0?void 0:e.mergedCellsInfo);(a==null?void 0:a.length)!==((n=(i=r.options)===null||i===void 0?void 0:i.mergedCellsInfo)===null||n===void 0?void 0:n.length)&&(r.setOptions({mergedCellsInfo:a}),t.remove(!0))},swt=function(r){return se(r,function(t){return{cells:t.cells,viewMeta:t.getMeta()}})},JI=function(r,t){return kN(r,t,function(e,i){return jr(e.viewMeta.id,i.viewMeta.id)})},lwt=function(r,t){var e,i=(e=r.options)===null||e===void 0?void 0:e.mergedCellsInfo;if(!at(i)){var n=r.interaction.getPanelGroupAllDataCells();if(!at(n)){var a=[];i.forEach(function(c){var h=_7(n,r,c);h.cells.length>0&&a.push(h)});var o=t.getChildren(),s=swt(o),l=JI(s,a),u=JI(a,s);Ht(l,function(c){var h=ci(o,function(f){return jr(f.getMeta().id,c.viewMeta.id)});h==null||h.remove(!0)}),Ht(u,function(c){var h=c.cells,f=c.viewMeta;t.add(x7(r,h,f))})}}},C7=function(r){var t=r.includes(ii)?"id":"field";return t},oC=function(r,t){t===void 0&&(t=[]);var e=r.getInitColumnLeafNodes();return ma(t.map(function(i){var n=C7(i);return e.find(function(a){return a[n]===i})}))},uwt=function(r,t){if(t===void 0&&(t=[]),at(t))return{prev:null,next:null};var e=r.getInitColumnLeafNodes(),i=oC(r,t).map(function(l){return l==null?void 0:l.colIndex}),n=Math.max.apply(Math,ht([],tt(i),!1)),a=Math.min.apply(Math,ht([],tt(i),!1)),o=e.find(function(l){return l.colIndex===n+1}),s=e.find(function(l){return l.colIndex===a-1});return{prev:s||null,next:o||null}},cwt=function(r,t){if(at(t))return[];var e=Number.NEGATIVE_INFINITY;return r.reduce(function(i,n,a){if(!t.includes(n))return i;if(a===e+1){var o=Pe(i);o.push(n)}else{var s=[n];i.push(s)}return e=a,i},[])},tL=function(r,t,e){t===void 0&&(t=[]),e===void 0&&(e=!1);var i=function(h,f){h===void 0&&(h=[]),f===void 0&&(f=[]),r.setOptions({interaction:{hiddenColumnFields:h}}),r.interaction.reset(),r.store.set("hiddenColumnsDetail",f),r.render(!1,{reBuildHiddenColumnsDetail:!1})};if(at(t)&&e){i();return}var n=r.store.get("hiddenColumnsDetail",[]),a=r.options.interaction.hiddenColumnFields;if(!(jr(t,a)&&!e)){var o=So(ht(ht([],tt(t),!1),tt(a),!1)),s=oC(r,o).every(function(h,f,d){var v=d[f+1];return!v||Math.abs(h.colIndex-v.colIndex)===1}),l=uwt(r,s?o:t),u={hideColumnNodes:oC(r,t),displaySiblingNode:l},c=ht(ht([],tt(n),!1),[u],!1);r.emit(G.LAYOUT_COLS_HIDDEN,u,c),i(o,c)}},hwt=function(r){var t=r.dataCfg.fields.columns,e=t===void 0?[]:t;return r.isTableMode()?e:r.getInitColumnLeafNodes().map(function(i){var n=i.id;return n})},BA=function(r,t,e){t===void 0&&(t=[]),e===void 0&&(e=!1),at(t)&&e&&tL(r,t,!0);var i=hwt(r),n=hh(i),a=cwt(n,t);a.forEach(function(o){tL(r,o,e)})},fwt=function(r,t){var e=r.getColumnLeafNodes(),i=r.getInitColumnLeafNodes(),n=C7(t);return Nt(Pe(e),n)===t&&Nt(Pe(i),n)!==t},dwt=function(r){return(r==null?void 0:r.next)||(r==null?void 0:r.prev)},vwt=function(r){var t=dwt(r);return t==null?void 0:t.id},sC=function(r,t){return vwt(r)===t},vd=function(r){var t=r.type,e=r.id,i=r.theme,n=r.width,a=r.height,o=cm(r,["type","id","theme","width","height"]),s=t===zn.Horizontal?i.size:null,l=t===zn.Vertical?i.size:null;return{fill:i.background,fillOpacity:i.backgroundOpacity,cursor:"".concat(t,"-resize"),width:s,height:l,appendInfo:k(k({},o),{isResizeArea:!0,type:t,id:e,width:n,height:a,size:i.size})}},sv=function(r,t){if(r.foregroundGroup){var e=r.foregroundGroup.findById(t);return e||r.foregroundGroup.addGroup({id:t,zIndex:Act})}},DA=function(r,t,e){var i=e??{},n=i.scrollX,a=n===void 0?0:n,o=i.scrollY,s=o===void 0?0:o,l=!(r.x-a>t.x+t.width||r.x+r.width-a<t.x),u=!(r.y-s>t.y+t.height||r.y+r.height-s<t.y);return l&&u},pwt=function(r,t,e){if(!r)return!1;var i=r.iconNames,n=r.displayCondition,a=r.belongsCell;return at(i)||a!==e?!1:n?i.some(function(o){return n(t,o)}):!0},NA=function(r,t,e){var i=ci(r,function(a){return pwt(a,t,e)});if(i){var n=i.iconNames;return i.displayCondition&&(n=n.filter(function(a){return i.displayCondition(t,a)})),k(k({},i),{iconNames:n})}},E7=function(r,t){var e=r.label,i=r.field;return jr(i,Zt)?{formattedValue:t||e,value:e}:{formattedValue:e,value:e}},fh=function(r){return ld(r)==="ASC"},kA=function(r){return ld(r)==="DESC"},eL=function(r){return!a6(Number(r))},rL=function(r,t,e){var i=fh(t)?1:-1,n=["-",void 0];return r==null?void 0:r.sort(function(a,o){var s=a,l=o;if(e){if(s=a[e],l=o[e],eL(s)&&eL(l))return(Number(s)-Number(l))*i;if(s&&(n!=null&&n.includes(s==null?void 0:s.toString())))return-i;if(Number(s)&&(n!=null&&n.includes(l==null?void 0:l.toString())))return i}return!wr(s)&&!wr(l)?s.toString().localeCompare(l.toString(),"zh")*i:s?i:-i})},S7=function(r,t,e){return e?n2t(t,So(r)):ht([],tt(new Set(ht(ht([],tt(r),!1),tt(t),!1))),!1)},A7=function(r){var t=r.sortByValues,e=r.originValues,i=e.filter(function(s){return t.find(function(l){return Pe(_A(s,ii))===l})}),n=i.map(function(s){var l=s.split(ii);if(l.length>1){var u=l.slice(0,l.length-1).join(ii);return[u,l[l.length-1]]}return l}),a=Array.from(new Set(n.map(function(s){return s[0]})));n.sort(function(s,l){var u=s.slice(0,s.length-1),c=l.slice(0,l.length-1);if(u.join()!==c.join()){var h=a.indexOf(u[0]),f=a.indexOf(c[0]);return h-f}var d=t.indexOf(s[s.length-1]),v=t.indexOf(l[l.length-1]);return d-v});var o=n.map(function(s){return s.join(ii)});return e2t(e,o)},gwt=function(r){var t=r.originValues,e=r.measureValues,i=r.sortParam,n=r.dataSet,a=i.sortFunc,o=i.sortFieldId,s=i.sortMethod,l=a(k({data:e},i));return l!=null&&l.length?(n.fields.rows.indexOf(o)>0||n.fields.columns.indexOf(o)>0)&&!Ei(l[0],ii)?A7({sortByValues:l,originValues:t}):S7(l,t,fh(s)):t},mwt=function(r){var t=r.sortParam,e=r.measureValues,i=r.originValues,n=r.dataSet,a=t.sortByMeasure,o=t.query,s=t.sortFieldId,l=t.sortMethod,u=n.fields,c=u.rows,h=u.columns,f=c.includes(s),d;if(a){var v=rL(e,l,a===Ka?o[Zt]:a);d=o2t(s,f?c:hh(h),v)}else d=se(rL(e,l));return S7(d,i,fh(l))},ywt=function(r){var t=r.sortParam,e=r.originValues,i=r.measureValues,n=r.dataSet,a=t.sortFunc,o=t.sortMethod,s=t.sortBy,l=e,u={originValues:e,measureValues:i,sortParam:t,dataSet:n};return a?l=gwt(u):s?l=A7({sortByValues:s,originValues:e}):(fh(o)||kA(o))&&(l=mwt(u)),l},_wt=function(r,t,e){var i,n={},a=Ei(r,ii);if(a)for(var o=_A(r,ii),s=!((i=t==null?void 0:t.rows)===null||i===void 0)&&i.includes(e)?t.rows:hh(t.columns),l=0;l<=Bm(s,e);l++)n[s[l]]=o[l];else n[e]=r;return n},iL=function(r){return r.filter(function(t){return t!==Zt})},xwt=function(r){var t=r.dataSet,e=r.sortParam,i=r.originValues,n=t.fields,a=e.sortByMeasure,o=e.query,s=e.sortFieldId;if(a!==Ka){var l=t.getMultiData(o,{queryType:Dn.DetailOnly});return l}var u=t.getMultiData(o,{queryType:Dn.All}),c=hh(n.columns),h=Ei(n.rows,s),f=iL(h?n.rows:c),d=iL(h?c:n.rows),v=f[f.indexOf(s)+1],p=ir(o),g=d.filter(function(y){return!p.includes(y)}),m=u.filter(function(y){var _=new Set(Object.keys(y[xS]));if(!_.has(s)||_.has(v))return!1;var x=g.every(function(C){return!_.has(C)});return x});return at(m)?ma(se(i,function(y){var _=_wt(y,n,s);return t.getTotalValue(k(k({},o),_))})):m},Cwt=function(r){var t=r.dataSet,e=r.sortParam,i=r.originValues,n=r.isSortByMeasure,a;return n?a=xwt(r):a=i,ywt({sortParam:e,originValues:i,measureValues:a,dataSet:t})},T7=function(r,t){if(r!=null&&r.sortMethod){if(fh(r==null?void 0:r.sortMethod))return"groupAsc";if(kA(r==null?void 0:r.sortMethod))return"groupDesc"}if(t)return"SortDown"},nL=function(r){var t,e,i=r.pivotMeta,n=r.dimensions,a=r.sortedDimensionValues,o=r.sortFieldId,s={children:i},l=[s];try{for(var u=Vn(n),c=u.next();!c.done;c=u.next()){var h=c.value;if(h!==o)l=Jd(l,function(f){return ht([],tt(f.children.values()),!1)});else{l.forEach(function(f){var d=ht([],tt(f.children.values()),!1),v=M6(d,function(p){return Bm(a,p.id)}).map(function(p){return[p.value,p]});f.children=new Map(v)});break}}}catch(f){t={error:f}}finally{try{c&&!c.done&&(e=u.return)&&e.call(u)}finally{if(t)throw t.error}}return s.children},UA=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.handleRestOptions=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=tt(e,1),a=n[0];this.headerConfig=k({},a);var o=this.meta,s=o.value,l=o.query,u=this.spreadsheet.dataCfg.sortParams,c=this.isSortCell(),h=ci(ht([],tt(u),!1).reverse(),function(d){return c&&(d==null?void 0:d.sortByMeasure)===s&&jr(Nt(d,"query"),l)}),f=T7(h,c);this.headerConfig.sortParam=k(k(k({},this.headerConfig.sortParam),h||{query:l}),{type:f})},t.prototype.initCell=function(){this.resetTextAndConditionIconShapes(),this.actionIcons=[],this.hasDefaultHiddenIcon=!1},t.prototype.getTreeIcon=function(){return this.treeIcon},t.prototype.getInteractiveBorderShapeStyle=function(e){var i=this.getCellArea(),n=i.x,a=i.y,o=i.height,s=i.width;return{x:n+e,y:a+e,width:s-e*2,height:o-e*2}},t.prototype.getFormattedFieldValue=function(){var e=this.meta,i=e.label,n=e.isTotalRoot,a=e.isGrandTotals,o=this.spreadsheet.dataSet.getFieldFormatter(this.meta.field),s=!0;this.spreadsheet.isTableMode()?s=!1:this.spreadsheet.isHierarchyTreeType()?s=!(a&&n):s=!n;var l=s&&o?o(i,void 0,this.meta):i;return{formattedValue:l,value:i}},t.prototype.getActionIconCfg=function(){return NA(this.spreadsheet.options.headerActionIcons,this.meta,this.cellType)},t.prototype.showSortIcon=function(){var e=this.spreadsheet,i=e.options,n=e.dataCfg,a=at(n.fields.values);if(i.showDefaultHeaderActionIcon&&!a){var o=this.headerConfig.sortParam,s=this.meta.query;return s&&jr(o==null?void 0:o.query,s)&&(o==null?void 0:o.type)&&(o==null?void 0:o.type)!=="none"}return!1},t.prototype.getActionIconsCount=function(){if(this.showSortIcon())return 1;var e=this.getActionIconCfg();if(e){var i=e.iconNames;return i.length}return 0},t.prototype.getActionIconsWidth=function(){var e=this.getStyle().icon,i=e.size,n=e.margin;return(i+n.left)*this.getActionIconsCount()},t.prototype.drawSortIcons=function(){var e=this;if(this.showSortIcon()){var i=this.getStyle(),n=i.icon,a=i.text,o=this.getTextConditionFill(a),s=this.headerConfig.sortParam,l=this.getIconPosition(),u=new ud(k(k({name:Nt(s,"type","none")},l),{width:n.size,height:n.size,fill:o}));u.on("click",function(c){e.spreadsheet.emit(G.GLOBAL_ACTION_ICON_CLICK,c),e.spreadsheet.handleGroupSort(c,e.meta)}),this.add(u),this.actionIcons.push(u)}},t.prototype.hasDefaultHideActionIcon=function(){return this.hasDefaultHiddenIcon},t.prototype.addActionIcon=function(e){var i=this,n=e.x,a=e.y,o=e.iconName,s=e.defaultHide,l=e.action,u=e.onClick,c=e.onHover,h=this.getStyle(),f=h.icon,d=h.text,v=this.getTextConditionFill(d),p=(f==null?void 0:f.fill)||v,g=new ud({name:o,x:n,y:a,width:f==null?void 0:f.size,height:f==null?void 0:f.size,fill:p});g.set("visible",!s),g.on("mouseover",function(m){i.spreadsheet.emit(G.GLOBAL_ACTION_ICON_HOVER,m),c==null||c({hovering:!0,iconName:o,meta:i.meta,event:m})}),g.on("mouseleave",function(m){i.spreadsheet.emit(G.GLOBAL_ACTION_ICON_HOVER_OFF,m),c==null||c({hovering:!1,iconName:o,meta:i.meta,event:m})}),g.on("click",function(m){var y;i.spreadsheet.emit(G.GLOBAL_ACTION_ICON_CLICK,m),(y=u||l)===null||y===void 0||y({iconName:o,meta:i.meta,event:m})}),this.actionIcons.push(g),this.add(g)},t.prototype.drawActionIcons=function(){var e=this;if(this.showSortIcon()){this.drawSortIcons();return}var i=this.getActionIconCfg();if(i){var n=i.iconNames,a=i.action,o=i.onClick,s=i.onHover,l=i.defaultHide,u=this.getIconPosition(n.length),c=this.getStyle().icon,h=c.size,f=c.margin;Ht(n,function(d,v){var p=u.x+v*h+v*f.left,g=u.y,m=typeof l=="function"?l(e.meta,d):l;m&&(e.hasDefaultHiddenIcon=!0),e.addActionIcon({iconName:d,x:p,y:g,defaultHide:m,action:a,onClick:o,onHover:s})})}},t.prototype.drawBackgroundShape=function(){var e=this.getBackgroundColor(),i=e.backgroundColor,n=e.backgroundColorOpacity;this.backgroundShape=fn(this,k(k({},this.getCellArea()),{fill:i,fillOpacity:n}))},t.prototype.isSortCell=function(){var e,i,n,a=(i=(e=this.spreadsheet)===null||e===void 0?void 0:e.isValueInCols)===null||i===void 0?void 0:i.call(e),o=this.meta.level===((n=this.meta.hierarchy)===null||n===void 0?void 0:n.maxLevel);return a?o&&this.cellType===st.COL_CELL:o&&this.cellType===st.ROW_CELL},t.prototype.handleByStateName=function(e,i){Tl(e,this)&&this.updateByState(i)},t.prototype.handleSearchResult=function(e){if(Tl(e,this)){var i=ci(e,function(n){return n==null?void 0:n.isTarget});i.id===this.getMeta().id?this.updateByState(At.HIGHLIGHT):this.updateByState(At.SEARCH_RESULT)}},t.prototype.handleHover=function(e){var i;Tl(e,this)&&(this.updateByState(At.HOVER),this.hasDefaultHideActionIcon()&&this.toggleActionIcon((i=e==null?void 0:e[0])===null||i===void 0?void 0:i.id))},t.prototype.handleSelect=function(e,i){Tl(e,this)&&this.updateByState(At.SELECTED);var n=se(i,"id");Ei(n,this.meta.id)&&this.updateByState(At.SELECTED)},t.prototype.getTextStyle=function(){var e=this.getStyle(),i=e.text,n=e.bolderText,a=e.measureText,o;this.isMeasureField()?o=a||i:this.isBolderText()?o=n:o=i;var s=this.getTextConditionFill(o);return k(k({},o),{fill:s})},t.prototype.getBackgroundColor=function(){var e,i=((e=this.getStyle())===null||e===void 0?void 0:e.cell)||{},n=i.backgroundColor,a=i.backgroundColorOpacity;return this.getBackgroundColorByCondition(n,a)},t.prototype.getBackgroundColorByCondition=function(e,i){var n,a=e,o=this.findFieldCondition((n=this.conditions)===null||n===void 0?void 0:n.background);if(o&&o.mapping){var s=this.mappingValue(o);s&&(a=s.fill)}return{backgroundColor:a,backgroundColorOpacity:i}},t.prototype.toggleActionIcon=function(e){if(this.getMeta().id===e){var i=[];Ht(this.actionIcons,function(n){n.get("visible")||(n.set("visible",!0),i.push(n))}),this.spreadsheet.store.set("visibleActionIcons",i)}},t.prototype.update=function(){var e=this.spreadsheet.interaction,i=e==null?void 0:e.getState(),n=e==null?void 0:e.getCells([st.CORNER_CELL,st.COL_CELL,st.ROW_CELL]);if(tu(n))switch(i==null?void 0:i.stateName){case At.SELECTED:case At.BRUSH_SELECTED:this.handleSelect(n,i==null?void 0:i.nodes);break;case At.HOVER_FOCUS:case At.HOVER:this.handleHover(n);break;case At.SEARCH_RESULT:this.handleSearchResult(n);break;default:this.handleByStateName(n,i==null?void 0:i.stateName);break}},t.prototype.updateByState=function(e){r.prototype.updateByState.call(this,e,this)},t.prototype.hideInteractionShape=function(){r.prototype.hideInteractionShape.call(this)},t.prototype.isMeasureField=function(){return[Zt,Cct].includes(this.meta.field)},t.prototype.mappingValue=function(e){var i=this.getMeta().label;return e==null?void 0:e.mapping(i,this.meta)},t.prototype.findFieldCondition=function(e){var i=this;return Om(e,function(n){return n.field instanceof RegExp?n.field.test(i.meta.field):n.field===i.meta.field})},t}(Gm),Xm=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"cellType",{get:function(){return st.COL_CELL},enumerable:!1,configurable:!0}),t.prototype.initCell=function(){r.prototype.initCell.call(this),this.drawBackgroundShape(),this.drawInteractiveBgShape(),this.drawInteractiveBorderShape(),this.drawTextShape(),this.drawConditionIconShapes(),this.drawActionIcons(),this.drawBorders(),this.drawResizeArea(),this.addExpandColumnIconShapes(),this.update()},t.prototype.drawInteractiveBgShape=function(){this.stateShapes.set("interactiveBgShape",fn(this,k({},this.getCellArea()),{visible:!1}))},t.prototype.drawInteractiveBorderShape=function(){var e=2;this.stateShapes.set("interactiveBorderShape",fn(this,this.getInteractiveBorderShapeStyle(e),{visible:!1}))},t.prototype.getMaxTextWidth=function(){var e=this.getContentArea().width;return e-this.getActionIconsWidth()},t.prototype.getIconPosition=function(){if(this.meta.isLeaf)return r.prototype.getIconPosition.call(this,this.getActionIconsCount());var e=this.getIconStyle(),i=e.margin.left,n=this.getTextStyle(),a=this.textPosition,o=a==null?void 0:a.x,s=(a==null?void 0:a.y)-e.size/2;return n.textAlign==="left"?{x:o+this.actualTextWidth+i,y:s}:n.textAlign==="right"?{x:o+i,y:s}:{x:o+this.actualTextWidth/2+i,y:s}},t.prototype.isBolderText=function(){var e=this.meta,i=e.isLeaf,n=e.isTotals;return!!(n||!i)},t.prototype.getTextPosition=function(){var e,i=this.meta.isLeaf,n=this.headerConfig,a=n.width,o=n.scrollContainsRowHeader,s=n.cornerWidth,l=n.scrollX,u=this.getTextStyle(),c=this.getContentArea(),h=this.getIconStyle();if(i)return av(c,u,this.actualTextWidth,h,this.getActionIconsCount()).text;var f={start:l-(o?s:0),width:a+(o?s:0)},d=this.getTextStyle().textAlign,v=Ybt(f,d,(e=this.getStyle().cell)===null||e===void 0?void 0:e.padding),p=this.getActionIconsWidth(),g=this.actualTextWidth+p,m=Xbt(v,{start:c.x,width:c.width},g),y=jbt(m,this.actualTextWidth,p,d),_=c.y+c.height/2;return this.textPosition={x:y,y:_},this.textPosition},t.prototype.getActionIconsWidth=function(){var e=this.getStyle().icon,i=e.size,n=e.margin,a=this.getActionIconsCount();return(i+n.left)*a+(a>0?n.right:0)},t.prototype.getColResizeAreaKey=function(){return this.meta.key},t.prototype.getColResizeArea=function(){return sv(this.spreadsheet,n4)},t.prototype.getHorizontalResizeAreaName=function(){return"".concat(o4).concat(this.meta.key)},t.prototype.drawHorizontalResizeArea=function(){var e,i,n=((i=(e=this.spreadsheet.options.style)===null||e===void 0?void 0:e.colCfg)===null||i===void 0?void 0:i.height)===0;if(!(n||!this.shouldDrawResizeAreaByType("colCellVertical",this))){var a=this.headerConfig,o=a.cornerWidth,s=a.viewportWidth,l=this.meta,u=l.y,c=l.height,h=this.getResizeAreaStyle(),f=this.getColResizeArea(),d=this.getHorizontalResizeAreaName(),v=f.find(function(g){return g.attrs.name===d});if(!v){var p=o+s;f.addShape("rect",{attrs:k(k({},vd({theme:h,type:zn.Vertical,id:this.getColResizeAreaKey(),effect:mi.Field,offsetX:0,offsetY:u,width:p,height:c,meta:this.meta})),{name:d,x:0,y:u+c-h.size/2,width:p})})}}},t.prototype.shouldAddVerticalResizeArea=function(){var e=this.meta,i=e.x,n=e.y,a=e.width,o=e.height,s=this.headerConfig,l=s.scrollX,u=s.scrollY,c=s.scrollContainsRowHeader,h=s.cornerWidth,f=s.height,d=s.width,v=this.getResizeAreaStyle(),p={x:i+a-v.size/2,y:n,width:v.size,height:o},g={x:c?-h:0,y:0,width:c?h+d:d,height:f};return DA(p,g,{scrollX:l,scrollY:u})},t.prototype.getVerticalResizeAreaOffset=function(){var e=this.meta,i=e.x,n=e.y,a=this.headerConfig,o=a.scrollX,s=a.position;return{x:s.x+i-o,y:s.y+n}},t.prototype.drawVerticalResizeArea=function(){if(!(!this.meta.isLeaf||!this.shouldDrawResizeAreaByType("colCellHorizontal",this))){var e=this.meta,i=e.label,n=e.width,a=e.height,o=this.getResizeAreaStyle(),s=this.getColResizeArea();if(this.shouldAddVerticalResizeArea()){var l=this.getVerticalResizeAreaOffset(),u=l.x,c=l.y;s.addShape("rect",{attrs:k(k({},vd({theme:o,type:zn.Horizontal,effect:mi.Cell,id:i,offsetX:u,offsetY:c,width:n,height:a,meta:this.meta})),{x:u+n-o.size/2,y:c,height:a})})}}},t.prototype.drawResizeArea=function(){this.drawHorizontalResizeArea(),this.drawVerticalResizeArea()},t.prototype.drawHorizontalBorder=function(){var e=ru(Cr.TOP,this.meta,this.theme.colCell.cell),i=e.position,n=e.style;Xr(this,i,n)},t.prototype.drawVerticalBorder=function(e){var i=ru(e,this.meta,this.theme.colCell.cell),n=i.position,a=i.style;Xr(this,n,a)},t.prototype.drawBorders=function(){var e=this.spreadsheet,i=e.options,n=e.isTableMode;this.meta.colIndex===0&&n()&&!i.showSeriesNumber&&this.drawVerticalBorder(Cr.LEFT),this.drawHorizontalBorder(),this.drawVerticalBorder(Cr.RIGHT)},t.prototype.hasHiddenColumnCell=function(){var e=this,i=this.spreadsheet.options,n=i.interaction.hiddenColumnFields,a=n===void 0?[]:n,o=i.tooltip.operation,s=this.spreadsheet.store.get("hiddenColumnsDetail",[]);return at(s)||at(a)||!o.hiddenColumns?!1:!!s.find(function(l){return sC(l==null?void 0:l.displaySiblingNode,e.meta.id)})},t.prototype.getExpandIconTheme=function(){var e=this.getStyle();return e.icon},t.prototype.addExpandColumnSplitLine=function(){var e=this.meta,i=e.x,n=e.y,a=e.width,o=e.height,s=this.theme.splitLine,l=s.horizontalBorderColor,u=s.horizontalBorderWidth,c=s.horizontalBorderColorOpacity,h=s.borderDash,f=this.isLastColumn()?i+a-u:i;Xr(this,{x1:f,y1:n,x2:f,y2:n+o},{stroke:l,lineWidth:u,strokeOpacity:c,lineDash:h})},t.prototype.addExpandColumnIconShapes=function(){this.hasHiddenColumnCell()&&(this.addExpandColumnSplitLine(),this.addExpandColumnIcons())},t.prototype.addExpandColumnIcons=function(){var e=this.isLastColumn();this.addExpandColumnIcon(e),this.isAllDisplaySiblingNodeHidden()&&e&&this.addExpandColumnIcon(!1)},t.prototype.addExpandColumnIcon=function(e){var i=this,n=this.getExpandColumnIconConfig(e),a=LA(this,k(k({},n),{name:"ExpandColIcon",cursor:"pointer"}));a.on("click",function(){i.spreadsheet.emit(G.LAYOUT_COLS_EXPANDED,i.meta)})},t.prototype.getExpandColumnIconConfig=function(e){var i=this.getExpandIconTheme().size,n=this.getCellArea(),a=n.x,o=n.y,s=n.width,l=n.height,u=a-i,c=e?u+s:u,h=o+l/2-i/2;return{x:c,y:h,width:i*2,height:i}},t.prototype.isLastColumn=function(){return fwt(this.spreadsheet,this.meta.id)},t.prototype.isAllDisplaySiblingNodeHidden=function(){var e=this.meta.id,i=this.spreadsheet.store.get("hiddenColumnsDetail",[]),n=i.find(function(o){var s,l=o.displaySiblingNode;return((s=l==null?void 0:l.next)===null||s===void 0?void 0:s.id)===e}),a=i.find(function(o){var s,l=o.displaySiblingNode;return((s=l==null?void 0:l.prev)===null||s===void 0?void 0:s.id)===e});return a&&n},t}(UA),Ewt=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isBolderText=function(){var e=this.meta.cornerType;return e===ua.Col},Object.defineProperty(t.prototype,"cellType",{get:function(){return st.CORNER_CELL},enumerable:!1,configurable:!0}),t.prototype.initCell=function(){r.prototype.initCell.call(this),this.resetTextAndConditionIconShapes(),this.drawBackgroundShape(),this.drawTreeIcon(),this.drawCellText(),this.drawConditionIconShapes(),this.drawActionIcons(),this.drawBorderShape(),this.drawResizeArea(),this.update()},t.prototype.drawCellText=function(){this.drawTextShape()},t.prototype.drawTextShape=function(){var e=this.getContentArea().x,i=this.getCellArea(),n=i.y,a=i.height,o=this.getTextStyle(),s=this.getCornerText(),l=this.getMaxTextWidth(),u=xu(this.meta,this.spreadsheet.options.placeholder),c=this.spreadsheet.measureTextWidth,h=zc({measureTextWidth:c,text:s,maxWidth:l,fontParam:o,placeholder:u});this.actualText=h;var f=h.indexOf(lc),d=h,v="";if(f!==-1&&this.spreadsheet.isHierarchyTreeType()){var p=f+(VTt()?1:0);d=s.substr(0,p),v=s.slice(p),v=zc({measureTextWidth:c,text:v,maxWidth:l,fontParam:o})}var g=Gbt({x:e+this.getTreeIconWidth(),y:n,width:l,height:a},o).x,m=n+(at(v)?a/2:a/4);this.addTextShape(eu(this,[this.textShapes[0]],g,m,d,o)),at(v)||this.addTextShape(eu(this,[this.textShapes[1]],g,n+a*.75,v,o)),this.actualTextWidth=Nc([c(d,o),c(v,o)])},t.prototype.drawTreeIcon=function(){var e=this;if(!(!this.showTreeIcon()||this.meta.cornerType===ua.Col)){var i=this.headerConfig.hierarchyCollapse,n=this.getStyle().icon.size,a=this.getTextStyle(),o=a.textBaseline,s=a.fill,l=this.getContentArea();this.treeIcon=o7(this,{x:l.x,y:d0(l,o,n),width:n,height:n},s,i,function(){e.headerConfig.spreadsheet.store.set("scrollY",0),e.headerConfig.spreadsheet.emit(G.LAYOUT_TREE_ROWS_COLLAPSE_ALL,i)})}},t.prototype.drawBorderShape=function(){var e=this;[Cr.TOP,Cr.LEFT].forEach(function(i){var n=ru(i,e.getCellArea(),e.getStyle().cell),a=n.position,o=n.style;Xr(e,a,o)})},t.prototype.isLastRowCornerCell=function(){var e=this.meta,i=e.cornerType,n=e.field,a=this.headerConfig.rows;return i===ua.Row&&(this.spreadsheet.isHierarchyTreeType()||Pe(a)===n)},t.prototype.getResizeAreaEffect=function(){var e=this.meta.cornerType;return e===ua.Series?mi.Series:this.isLastRowCornerCell()&&this.spreadsheet.isHierarchyTreeType()?mi.Tree:mi.Field},t.prototype.drawResizeArea=function(){if(this.shouldDrawResizeAreaByType("cornerCellHorizontal",this)){var e=this.getResizeAreaStyle(),i=sv(this.spreadsheet,Ix),n=this.headerConfig,a=n.position,o=n.scrollX,s=n.scrollY,l=n.width,u=n.height,c=this.meta,h=c.x,f=c.y,d=c.width,v=c.height,p=c.field,g=c.cornerType,m={x:h+d-e.size/2,y:f,width:e.size,height:v},y={x:0,y:0,width:l,height:u};if(!(g===ua.Col||!DA(m,y,{scrollX:o,scrollY:s}))){var _=a.x+h-o,x=a.y+(this.isLastRowCornerCell()?0:f);i.addShape("rect",{attrs:k(k({},vd({theme:e,id:p,type:zn.Horizontal,effect:this.getResizeAreaEffect(),offsetX:_,offsetY:x,width:d,height:v,meta:this.meta})),{x:_+d-e.size/2,y:x,height:this.isLastRowCornerCell()?u:v})})}}},t.prototype.showTreeIcon=function(){var e;return this.spreadsheet.isHierarchyTreeType()&&((e=this.meta)===null||e===void 0?void 0:e.x)===0},t.prototype.getIconPosition=function(){var e,i,n=(i=(e=this.textShapes)===null||e===void 0?void 0:e[0])===null||i===void 0?void 0:i.cfg.attrs,a=this.getTextStyle(),o=a.textBaseline,s=a.textAlign,l=this.getStyle().icon,u=l.size,c=l.margin,h=(n==null?void 0:n.x)+MN([[Xx("center"),cc(this.actualTextWidth/2)],[Xx("right"),cc(0)],[L6,cc(this.actualTextWidth)]])(s)+c.left,f=d0(this.getContentArea(),o,u);return{x:h,y:f}},t.prototype.getTreeIconWidth=function(){var e=this.getStyle().icon,i=e.size,n=e.margin;return this.showTreeIcon()?i+n.right:0},t.prototype.getTextStyle=function(){var e=this.getStyle(),i=e.text,n=e.bolderText,a=this.isBolderText()?i:n,o=this.getTextConditionFill(a);return k(k({},a),{fill:o})},t.prototype.getMaxTextWidth=function(){var e=this.getContentArea().width;return e-this.getTreeIconWidth()-this.getActionIconsWidth()},t.prototype.getTextPosition=function(){return{x:0,y:0}},t.prototype.getFormattedFieldValue=function(){return E7(this.meta,this.spreadsheet.dataSet.getFieldName(this.meta.label))},t.prototype.getCornerText=function(){var e=this.getFormattedFieldValue().formattedValue;return e},t}(UA),Swt=function(r,t,e,i){var n,a,o=Nt(i,"size"),s=Nt(i,"margin"),l=0;return r.options.showDefaultHeaderActionIcon?l=1:l=(a=(n=NA(r.options.headerActionIcons,t,e))===null||n===void 0?void 0:n.iconNames.length)!==null&&a!==void 0?a:0,l*(o+s.left)+(l>0?s.right:0)},b7=function(r,t,e){var i,n,a=((i=e.icon.margin)===null||i===void 0?void 0:i.left)||0,o=((n=e.icon.margin)===null||n===void 0?void 0:n.right)||0,s=r.store.get("hiddenColumnsDetail",[]),l=!1,u=!1;s.forEach(function(h){var f,d,v,p;((d=(f=h==null?void 0:h.displaySiblingNode)===null||f===void 0?void 0:f.prev)===null||d===void 0?void 0:d.field)===t&&(l=!0),((p=(v=h==null?void 0:h.displaySiblingNode)===null||v===void 0?void 0:v.next)===null||p===void 0?void 0:p.field)===t&&(u=!0)});var c=Nt(e,"icon.size");return{left:u?c+o:0,right:l?c+a:0}},Awt=function(r,t,e){var i=Nt(e,"cell.padding"),n=b7(r,t.field,e);return i.left+i.right+Swt(r,t,st.COL_CELL,Nt(e,"icon"))+n.left+n.right},w7=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.handleRestOptions=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=tt(e,1),a=n[0];this.headerConfig=k({},a);var o=this.meta.field,s=this.spreadsheet.dataCfg.sortParams,l=ci(s,function(c){return(c==null?void 0:c.sortFieldId)===o}),u=T7(l,!0);this.headerConfig.sortParam=k(k(k({},this.headerConfig.sortParam),l||{}),{type:u})},t.prototype.isFrozenCell=function(){var e=this.spreadsheet.options,i=e.frozenColCount,n=e.frozenTrailingColCount,a=this.spreadsheet.facet.layoutResult.colNodes.filter(function(s){return $a(s)}),o=wbt(this.meta).colIndex;return Fl(o,i)||Bl(o,n,a.length)},t.prototype.getFormattedFieldValue=function(){return E7(this.meta,this.spreadsheet.dataSet.getFieldName(this.meta.label))},t.prototype.shouldAddVerticalResizeArea=function(){return this.isFrozenCell()?!0:r.prototype.shouldAddVerticalResizeArea.call(this)},t.prototype.getVerticalResizeAreaOffset=function(){var e=this.meta,i=e.x,n=e.y,a=this.headerConfig,o=a.scrollX,s=a.position;return this.isFrozenCell()?{x:i,y:n}:{x:s.x+i-o,y:s.y+n}},t.prototype.getColResizeArea=function(){var e=this.isFrozenCell();return e?sv(this.spreadsheet,a4):r.prototype.getColResizeArea.call(this)},t.prototype.isSortCell=function(){return!0},t.prototype.showSortIcon=function(){return this.spreadsheet.options.showDefaultHeaderActionIcon},t.prototype.getTextStyle=function(){var e=this.getStyle();return e==null?void 0:e.bolderText},t.prototype.getContentArea=function(){var e,i=(((e=this.getStyle())===null||e===void 0?void 0:e.cell)||this.theme.dataCell.cell).padding,n=k({},i),a=b7(this.spreadsheet,this.meta.field,this.getStyle());return a.left&&(n.left=(n.left||0)+a.left),a.right&&(n.right=(n.right||0)+a.right),l7(this.getCellArea(),n)},t.prototype.getHorizontalResizeAreaName=function(){return"".concat(o4).concat("table-col-cell")},t.prototype.drawBackgroundShape=function(){var e=this.getStyle().cell.backgroundColor;this.backgroundShape=fn(this,k(k({},this.getCellArea()),{fill:e}))},t}(Xm),Twt=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getStyle=function(e){return e?this.theme[e]:Nt(this,"theme.cornerCell")},t.prototype.showSortIcon=function(){return!1},t.prototype.drawLeftBorder=function(){var e=ru(Cr.LEFT,this.getCellArea(),this.getStyle().cell),i=e.position,n=e.style;Xr(this,i,n)},t.prototype.drawBorders=function(){r.prototype.drawBorders.call(this),this.meta.colIndex===0&&this.drawLeftBorder()},t}(w7),Ym=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getLinkFieldStyle=function(){return this.theme.rowCell.text.linkTextFill},t.prototype.drawBorderShape=function(){r.prototype.drawBorderShape.call(this),this.meta.colIndex===0&&this.drawLeftBorder()},t.prototype.shouldDrawResizeArea=function(){return this.meta.colIndex===0},t.prototype.drawResizeArea=function(){if(this.shouldDrawResizeArea()){var e=this.getCellArea(),i=e.x,n=e.y,a=e.width,o=e.height,s=this.meta.rowIndex,l=this.getResizeAreaStyle(),u=this.spreadsheet.options,c=u.frozenRowCount,h=u.frozenTrailingRowCount,f=this.spreadsheet.facet.getCellRange(),d=Wm(s,f.start,c),v=nv(s,f.end,h),p=d||v,g=p?i4:Fc,m=sv(this.spreadsheet,g),y=this.spreadsheet.facet.layoutResult.colsHierarchy.height,_=this.spreadsheet.facet.getScrollOffset().scrollY,x=this.spreadsheet.facet.getPaginationScrollY(),C=_+x,A=n+(v?0:y);v||(A-=d?x:C),m.addShape("rect",{attrs:k(k({},vd({id:String(this.meta.rowIndex),theme:l,type:zn.Vertical,effect:mi.Cell,offsetX:i,offsetY:A,width:a,height:o,meta:this.meta})),{x:i,y:A+o-l.size/2,width:a})})}},t}(Zs),R7=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"cellType",{get:function(){return st.ROW_CELL},enumerable:!1,configurable:!0}),t.prototype.getTextStyle=function(){return this.theme.rowCell.seriesText},t}(Ym),jm=function(){function r(t){this.EVENT="gesture",this.gm=t}return r.prototype.do=function(t){var e=t.type;switch(e){case"touchstart":this.onTouchStart(t);break;case"touchmove":this.onTouchMove(t);break;case"touchend":this.onTouchEnd(t);break;case"touchcancel":this.onTouchCancel(t);break;default:return}},r.prototype.emit=function(t){this.gm.emit(this.EVENT,t)},r}(),bwt=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.EVENT="pan",e}return t.prototype.onTouchCancel=function(e){},t.prototype.onTouchEnd=function(e){},t.prototype.onTouchMove=function(e){var i=e.x,n=e.y,a=i-this.preX,o=n-this.preY;this.preX=i,this.preY=n,this.emit({x:i,y:n,deltaX:a,deltaY:o,event:e})},t.prototype.onTouchStart=function(e){var i=e.x,n=e.y;this.preX=i,this.preY=n},t}(jm),Ss=typeof performance=="object"&&performance.now?performance:Date,wwt=300,aL=10,Rwt=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.EVENT="press",e}return t.prototype.onTouchCancel=function(e){this.clearTimeout()},t.prototype.onTouchEnd=function(e){this.clearTimeout()},t.prototype.onTouchMove=function(e){var i=e.x,n=e.y;(i-this.touchStartX>aL||n-this.touchStartY>aL)&&this.clearTimeout()},t.prototype.onTouchStart=function(e){var i=this;this.clearTimeout();var n=e.x,a=e.y;this.touchStartTime=Ss.now(),this.touchStartX=n,this.touchStartY=a,this.pressTimeout=window.setTimeout(function(){i.emit({x:n,y:a,event:e})},wwt)},t.prototype.clearTimeout=function(){window.clearTimeout(this.pressTimeout)},t}(jm),Mwt=100,Iwt=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.EVENT="swipe",e.latestMoveTime=0,e.ms=0,e.speedX=0,e.speedY=0,e.preX=0,e.preY=0,e}return t.prototype.onTouchCancel=function(e){},t.prototype.onTouchEnd=function(e){var i=this.speedX,n=this.speedY;if(Ss.now()-this.latestMoveTime<Mwt){var a=e.x,o=e.y;this.emit({x:a,y:o,speedX:i,speedY:n,event:e})}},t.prototype.onTouchMove=function(e){var i=e.x,n=e.y,a=Ss.now(),o=i-this.preX,s=n-this.preY,l=a-this.ms;this.speedX=o/l,this.speedY=s/l,this.latestMoveTime=a},t.prototype.onTouchStart=function(e){var i=e.x,n=e.y;this.speedX=this.speedY=0,this.preX=i,this.preY=n,this.ms=Ss.now()},t}(jm),Lwt=300,oL=2,Owt=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.EVENT="tap",e}return t.prototype.onTouchCancel=function(e){},t.prototype.onTouchEnd=function(e){var i=e.x,n=e.y;i-this.touchStartX<oL&&n-this.touchStartY<oL&&Ss.now()-this.touchStartTime<Lwt&&this.emit({x:i,y:n,event:e})},t.prototype.onTouchMove=function(e){},t.prototype.onTouchStart=function(e){var i=e.x,n=e.y;this.touchStartTime=Ss.now(),this.touchStartX=i,this.touchStartY=n},t}(jm),Pwt={Pan:bwt,Press:Rwt,Swipe:Iwt,Tap:Owt},Fwt=function(r){return Pwt[r]},M7=function(r){gt(t,r);function t(e,i){i===void 0&&(i={});var n=r.call(this)||this;return n.onTouchStart=function(a){n.preventEvent(a),n.element.on("touchmove",n.onTouchMove),n.element.on("touchend",n.onTouchEnd),n.element.on("touchcancel",n.onTouchCancel),n.emit("touchdown",a),n.doGestures(a)},n.onTouchMove=function(a){n.preventEvent(a),n.emit("touchmove",a),n.doGestures(a)},n.onTouchEnd=function(a){n.preventEvent(a),n.emit("touchend",a),n.element.off("touchmove",n.onTouchMove),n.element.off("touchend",n.onTouchEnd),n.element.off("touchcancel",n.onTouchCancel),n.doGestures(a)},n.onTouchCancel=function(a){n.preventEvent(a),n.emit("touchcancel",a),n.element.off("touchmove",n.onTouchMove),n.element.off("touchend",n.onTouchEnd),n.element.off("touchcancel",n.onTouchCancel),n.doGestures(a)},n.element=e,n.options=i,n.initialGestures(),n.bindTouchStart(),n}return t.prototype.destroy=function(){this.element.off("touchstart",this.onTouchStart),this.off()},t.prototype.initialGestures=function(){var e=this,i=this.options.gestures||["Pan","Press","Swipe","Tap"];this.gestures=i.map(function(n){var a=Fwt(n);return new a(e)})},t.prototype.bindTouchStart=function(){this.element.on("touchstart",this.onTouchStart)},t.prototype.preventEvent=function(e){var i=e.type,n=this.options.prevents||[];n.includes(i)&&e.preventDefault()},t.prototype.doGestures=function(e){this.gestures.forEach(function(i){i.do(e)})},t}(fm),Bwt=A5,Dwt=800,Nwt="swipe",kwt="pan",sL="wheel",Uwt=function(r){gt(t,r);function t(e){var i=r.call(this)||this;return i.rafMs=0,i.onPan=function(n){i.raf&&cancelAnimationFrame(i.raf);var a=n.deltaX,o=n.deltaY,s=i.getWrapperEvent(n,a,o);i.emit(sL,s)},i.onSwipe=function(n){var a=n.speedX,o=n.speedY;i.rafMs=Ss.now(),i.ms=i.rafMs,(a!==0||o!==0)&&i.rafInertia(n)},i.element=e,i.gm=new M7(e,{gestures:["Pan","Swipe"]}),i.gm.on(Nwt,i.onSwipe),i.gm.on(kwt,i.onPan),i}return t.prototype.destroy=function(){window.cancelAnimationFrame(this.raf),this.gm.destroy(),this.off()},t.prototype.rafInertia=function(e){var i=this,n=e.speedX,a=e.speedY;this.raf=window.requestAnimationFrame(function(){var o=Ss.now(),s=(o-i.ms)/Dwt;if(s<1){s=Bwt(1-s);var l=o-i.rafMs,u=n*s*l,c=a*s*l,h=i.getWrapperEvent(e,u,c);i.emit(sL,h),i.rafMs=o,i.rafInertia(e)}})},t.prototype.getWrapperEvent=function(e,i,n){return k(k({},e),{deltaX:-i,deltaY:-n})},t}(fm),zwt=function(r){var t=0,e=r.children;return e==null||e.forEach(function(i){t+=i.height||0}),t},I7=function(r,t,e,i,n){var a=0,o=r+(t-n)/2,s=r+(t+n)/2,l=e+i;return r+n>=l?a=r:l<s?a=e+i-n:e>o?r+t-e>n?a=e:a=r+t-n:a=r+(t-n)/2,a},Hwt=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"cellType",{get:function(){return st.ROW_CELL},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){var e;r.prototype.destroy.call(this),(e=this.gm)===null||e===void 0||e.destroy()},t.prototype.initCell=function(){r.prototype.initCell.call(this),this.drawBackgroundShape(),this.drawInteractiveBgShape(),this.drawInteractiveBorderShape(),this.drawTextShape(),this.drawConditionIconShapes(),this.drawTreeIcon(),this.drawTreeLeafNodeAlignDot(),this.drawRectBorder(),this.drawResizeAreaInLeaf(),this.drawActionIcons(),this.update()},t.prototype.getBackgroundColor=function(){var e=this.getCrossBackgroundColor(this.meta.rowIndex),i=e.backgroundColor,n=e.backgroundColorOpacity;return this.getBackgroundColorByCondition(i,n)},t.prototype.drawInteractiveBorderShape=function(){var e=2;this.stateShapes.set("interactiveBorderShape",fn(this,this.getInteractiveBorderShapeStyle(e),{visible:!1}))},t.prototype.drawInteractiveBgShape=function(){this.stateShapes.set("interactiveBgShape",fn(this,k({},this.getCellArea()),{visible:!1}))},t.prototype.showTreeIcon=function(){return this.spreadsheet.isHierarchyTreeType()&&!this.meta.isLeaf},t.prototype.showTreeLeafNodeAlignDot=function(){var e;return((e=this.spreadsheet.options.style)===null||e===void 0?void 0:e.showTreeLeafNodeAlignDot)&&this.spreadsheet.isHierarchyTreeType()},t.prototype.getParentTreeIconCfg=function(){if(!(!this.showTreeLeafNodeAlignDot()||!this.spreadsheet.isHierarchyTreeType()||!this.meta.isLeaf))return Nt(this.meta,"parent.belongsCell.treeIcon.cfg")},t.prototype.drawTreeIcon=function(){var e=this;if(this.showTreeIcon()){var i=this.meta,n=i.isCollapsed,a=i.id,o=i.hierarchy,s=this.getContentArea().x,l=this.getTextStyle().fill,u=this.getStyle().icon.size,c=this.getContentIndent(),h=s+c,f=this.getIconYPosition();this.treeIcon=o7(this,{x:h,y:f,width:u,height:u},l,n,function(){if(!Or()){if(!n){var d=e.spreadsheet.store.get("scrollY"),v=e.headerConfig.viewportHeight||0,p=zwt(e.meta),g=o.height-p;if(d>0&&d+v>g){var m=g-v;e.spreadsheet.store.set("scrollY",m>0?m:0)}}e.spreadsheet.emit(G.ROW_CELL_COLLAPSE_TREE_ROWS,{id:a,isCollapsed:!n,node:e.meta})}}),Or()&&(this.gm=new M7(this,{gestures:["Tap"]}),this.gm.on("tap",function(){e.spreadsheet.emit(G.ROW_CELL_COLLAPSE_TREE_ROWS,{id:a,isCollapsed:!n,node:e.meta})}))}},t.prototype.drawTreeLeafNodeAlignDot=function(){var e=this.getParentTreeIconCfg();if(e){var i=this.getStyle().icon,n=i.size,a=i.margin,o=e.x+n+a.right,s=this.getTextPosition().y,l=this.getTextStyle(),u=l.fill,c=l.fontSize,h=n/5;this.treeLeafNodeAlignDot=a7(this,{x:o+n/2,y:s+(c-h)/2,r:h,fill:u,fillOpacity:.3})}},t.prototype.isBolderText=function(){var e=this.meta,i=e.isLeaf,n=e.isTotals,a=e.level;return!i&&a===0||n},t.prototype.drawTextShape=function(){r.prototype.drawTextShape.call(this),this.drawLinkField(this.meta)},t.prototype.drawRectBorder=function(){var e=this,i=this.getCellArea().x,n=this.getContentIndent(),a=this.spreadsheet.isHierarchyTreeType()?i:i+n;[Cr.BOTTOM,Cr.LEFT].forEach(function(o){var s=ru(o,k(k({},e.getCellArea()),{x:a}),e.getStyle().cell),l=s.position,u=s.style;Xr(e,l,u)})},t.prototype.getResizeClipAreaBBox=function(){var e=this.headerConfig,i=e.width,n=e.viewportHeight;return{x:0,y:0,width:i,height:n}},t.prototype.drawResizeAreaInLeaf=function(){if(!(!this.meta.isLeaf||!this.shouldDrawResizeAreaByType("rowCellVertical",this))){var e=this.getCellArea(),i=e.x,n=e.y,a=e.width,o=e.height,s=this.getResizeAreaStyle(),l=sv(this.spreadsheet,Fc),u=this.headerConfig,c=u.position,h=u.seriesNumberWidth,f=u.width,d=u.scrollX,v=u.scrollY,p={x:i+h,y:n+o-s.size/2,width:a,height:s.size},g=this.getResizeClipAreaBBox();if(DA(p,g,{scrollX:d,scrollY:v})){var m=(c==null?void 0:c.x)+i-d+h,y=(c==null?void 0:c.y)+n-v,_=this.spreadsheet.isFrozenRowHeader()?f-h-(i-d):a;l.addShape("rect",{attrs:k(k({},vd({id:this.meta.id,theme:s,type:zn.Vertical,effect:mi.Cell,offsetX:m,offsetY:y,width:a,height:o,meta:this.meta})),{x:m,y:y+o-s.size/2,width:_})})}}},t.prototype.getContentIndent=function(){if(!this.spreadsheet.isHierarchyTreeType())return 0;for(var e=this.getStyle(),i=e.icon,n=e.cell,a=i.size+i.margin.right,o=this.meta.parent,s=0;o;)o.height!==0&&(s+=a),o=o.parent;return this.showTreeLeafNodeAlignDot()&&(s+=this.isTreeLevel()?0:n.padding.right+i.margin.right),s},t.prototype.getTextIndent=function(){var e=this.getStyle().icon,i=e.size,n=e.margin,a=this.getContentIndent(),o=this.showTreeIcon()||this.isTreeLevel()&&this.showTreeLeafNodeAlignDot()?i+n.right:0;return a+o},t.prototype.isTreeLevel=function(){return ci(Nt(this.meta,"parent.children"),function(e){return!e.isLeaf})},t.prototype.getIconPosition=function(){if(!this.textShape)return{x:0,y:0};var e=this.textShape.cfg.attrs,i=e.x,n=e.y,a=e.textAlign,o=this.getStyle().icon.margin.left;return a==="left"?{x:i+this.actualTextWidth+o,y:n}:a==="right"?{x:i+o,y:n}:{x:i+this.actualTextWidth/2+o,y:n}},t.prototype.getMaxTextWidth=function(){var e=this.getContentArea().width;return e-this.getTextIndent()-this.getActionIconsWidth()},t.prototype.getTextArea=function(){var e=this.getContentArea(),i=this.getTextIndent();return k(k({},e),{x:e.x+i,width:e.width-i})},t.prototype.getAdjustTextAreaHeight=function(e,i,n){var a=e.height;return!this.spreadsheet.facet.vScrollBar&&e.y+e.height>i+n&&(a=i+n-e.y),a},t.prototype.calculateTextY=function(e){var i=e.textArea,n=e.adjustTextAreaHeight,a=this.headerConfig,o=a.scrollY,s=a.viewportHeight,l=this.getTextStyle().fontSize;return I7(i.y,n,o,s,l)},t.prototype.getTextPosition=function(){var e=this.getTextArea(),i=this.headerConfig,n=i.scrollY,a=i.viewportHeight,o=this.getAdjustTextAreaHeight(e,n,a),s=this.calculateTextY({textArea:e,adjustTextAreaHeight:o}),l=av(e,this.getTextStyle(),0,this.getIconStyle(),this.getActionIconsCount()).text.x;return{x:l,y:s}},t.prototype.getIconYPosition=function(){var e=this.getTextPosition().y,i=this.getStyle().icon.size,n=this.getTextStyle().fontSize;return e+(n-i)/2},t}(UA),lv=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.handleRestOptions=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=tt(e),a=n[0],o=n.slice(1);r.prototype.handleRestOptions.call(this,a,o),this.frozenRowCell=o[0]},t.prototype.getAdjustTextAreaHeight=function(e,i,n){var a=e.y-this.getFrozenFirstRowHeight(),o=e.height;return!this.spreadsheet.facet.vScrollBar&&a+e.height>i+n&&(o=i+n-a),o},t.prototype.calculateTextY=function(e){var i=e.textArea,n=e.adjustTextAreaHeight,a=this.headerConfig,o=a.scrollY,s=a.viewportHeight,l=this.getTextStyle().fontSize;return I7(i.y,n,o+this.getFrozenFirstRowHeight(),s,l)},t.prototype.getResizeClipAreaBBox=function(){return k(k({},r.prototype.getResizeClipAreaBBox.call(this)),{y:this.getFrozenFirstRowHeight()})},t.prototype.getFrozenFirstRowHeight=function(){var e;if(this.frozenRowCell)return 0;var i=this.spreadsheet,n=i.facet,a=i.options,o=Uc(a,(e=n==null?void 0:n.layoutResult)===null||e===void 0?void 0:e.rowNodes).frozenRowHeight;return o},t}(Hwt),L7=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.initCell=function(){this.drawBackgroundShape(),this.drawRectBorder(),this.drawTextShape()},t.prototype.getTextStyle=function(){var e;return(e=this.getStyle())===null||e===void 0?void 0:e.seriesText},t.prototype.getTextPosition=function(){return r.prototype.getTextPosition.call(this)},t.prototype.getActionIconsCount=function(){return 0},t.prototype.getIconStyle=function(){},t.prototype.drawResizeAreaInLeaf=function(){},t.prototype.update=function(){},t.prototype.findFieldCondition=function(){},t.prototype.mappingValue=function(){},t}(lv),m0=function(r){return[ni.META,ni.CONTROL].includes(r.key)},O7=function(r){return r.ctrlKey||r.metaKey},Ya=function(r){var t=r.getMeta(),e=t||{},i=e.id,n=e.colIndex,a=e.rowIndex,o=e.rowQuery;return{id:i,colIndex:n,rowIndex:a,type:r.cellType,rowQuery:o}},$wt=function(r,t){var e=r.interaction;e.changeState({stateName:At.SELECTED,cells:t}),r.emit(G.GLOBAL_SELECTED,e.getActiveCells())};function lC(r,t){var e=Math.min(r.rowIndex,t.rowIndex),i=Math.max(r.rowIndex,t.rowIndex),n=Math.min(r.colIndex,t.colIndex),a=Math.max(r.colIndex,t.colIndex);return{start:{rowIndex:e,colIndex:n},end:{rowIndex:i,colIndex:a}}}function Wwt(r,t){var e=t.interaction,i=t.facet,n=t.options;if(t.isTableMode()){if(!n.showSeriesNumber)return[];var a=i.layoutResult.colLeafNodes[0].id,o=ov(String(r.rowIndex),a),s=[],l=e.getAllCells().find(function(u){return u.getMeta().id===o});return l&&l instanceof R7&&s.push(l),s}return PA(r.rowId,e.getAllRowHeaderCells(),t.isHierarchyTreeType())}var zA=function(r,t){var e=r.getSelectedCellHighlight(),i=e.colHeader,n=e.rowHeader;i&&r.updateCells(r.getAllColHeaderCells()),n&&r.updateCells(r.getAllRowHeaderCells()),t()},P7=function(r){var t=r.store.get("visibleActionIcons"),e=r.interaction.getInteractedCells(),i=r.interaction.getState().cells;if(at(e)&&at(i)&&at(t))return!1;if(Ht(t,function(a){a.set("visible",!1)}),r.store.set("visibleActionIcons",[]),Ht(e,function(a){a.hideInteractionShape()}),r.interaction.resetState(),r.options.interaction.selectedCellsSpotlight){var n=r.interaction.getPanelGroupAllUnSelectedDataCells()||[];Ht(n,function(a){a.clearUnselectedState()})}return!0},Vwt=function(r,t){var e=t==null?void 0:t.stateName;r.interaction.isEqualStateName(e)||(P7(r),r.hideTooltip(),r.store.set(Fx,t))},Gwt=function(r,t,e){var i,n,a=e.facet,o=a.panelBBox.width,s=a==null?void 0:a.frozenGroupInfo,l=(i=s==null?void 0:s.frozenCol.width)!==null&&i!==void 0?i:0,u=(n=s==null?void 0:s.frozenTrailingCol.width)!==null&&n!==void 0?n:0,c=a.layoutResult.colLeafNodes[r];return t===Lr.SCROLL_UP?c.x-l:c.x+c.width-(o-u)},Xwt=function(r,t,e){var i,n,a=e.facet,o=a.viewCellHeights.getCellOffsetY,s=a.panelBBox.height,l=o(r+1);if(wr(l))return 0;var u=a==null?void 0:a.frozenGroupInfo,c=(i=u==null?void 0:u.frozenRow.height)!==null&&i!==void 0?i:0,h=(n=u==null?void 0:u.frozenTrailingRow.height)!==null&&n!==void 0?n:0;return t===Lr.SCROLL_UP?o(r)-c:l-(s-h)};/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var Qu=9e15,qs=1e9,uC="0123456789abcdef",y0="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",_0="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",cC={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Qu,maxE:Qu,crypto:!1},F7,bo,$t=!0,Zm="[DecimalError] ",Ds=Zm+"Invalid argument: ",B7=Zm+"Precision limit exceeded",D7=Zm+"crypto unavailable",N7="[object Decimal]",hi=Math.floor,xr=Math.pow,Ywt=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,jwt=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Zwt=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,k7=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ya=1e7,Dt=7,qwt=9007199254740991,Kwt=y0.length-1,hC=_0.length-1,rt={toStringTag:N7};rt.absoluteValue=rt.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),wt(r)};rt.ceil=function(){return wt(new this.constructor(this),this.e+1,2)};rt.clampedTo=rt.clamp=function(r,t){var e,i=this,n=i.constructor;if(r=new n(r),t=new n(t),!r.s||!t.s)return new n(NaN);if(r.gt(t))throw Error(Ds+t);return e=i.cmp(r),e<0?r:i.cmp(t)>0?t:new n(i)};rt.comparedTo=rt.cmp=function(r){var t,e,i,n,a=this,o=a.d,s=(r=new a.constructor(r)).d,l=a.s,u=r.s;if(!o||!s)return!l||!u?NaN:l!==u?l:o===s?0:!o^l<0?1:-1;if(!o[0]||!s[0])return o[0]?l:s[0]?-u:0;if(l!==u)return l;if(a.e!==r.e)return a.e>r.e^l<0?1:-1;for(i=o.length,n=s.length,t=0,e=i<n?i:n;t<e;++t)if(o[t]!==s[t])return o[t]>s[t]^l<0?1:-1;return i===n?0:i>n^l<0?1:-1};rt.cosine=rt.cos=function(){var r,t,e=this,i=e.constructor;return e.d?e.d[0]?(r=i.precision,t=i.rounding,i.precision=r+Math.max(e.e,e.sd())+Dt,i.rounding=1,e=Qwt(i,W7(i,e)),i.precision=r,i.rounding=t,wt(bo==2||bo==3?e.neg():e,r,t,!0)):new i(1):new i(NaN)};rt.cubeRoot=rt.cbrt=function(){var r,t,e,i,n,a,o,s,l,u,c=this,h=c.constructor;if(!c.isFinite()||c.isZero())return new h(c);for($t=!1,a=c.s*xr(c.s*c,1/3),!a||Math.abs(a)==1/0?(e=Yr(c.d),r=c.e,(a=(r-e.length+1)%3)&&(e+=a==1||a==-2?"0":"00"),a=xr(e,1/3),r=hi((r+1)/3)-(r%3==(r<0?-1:2)),a==1/0?e="5e"+r:(e=a.toExponential(),e=e.slice(0,e.indexOf("e")+1)+r),i=new h(e),i.s=c.s):i=new h(a.toString()),o=(r=h.precision)+3;;)if(s=i,l=s.times(s).times(s),u=l.plus(c),i=ke(u.plus(c).times(s),u.plus(l),o+2,1),Yr(s.d).slice(0,o)===(e=Yr(i.d)).slice(0,o))if(e=e.slice(o-3,o+1),e=="9999"||!n&&e=="4999"){if(!n&&(wt(s,r+1,0),s.times(s).times(s).eq(c))){i=s;break}o+=4,n=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(wt(i,r+1,1),t=!i.times(i).times(i).eq(c));break}return $t=!0,wt(i,r,h.rounding,t)};rt.decimalPlaces=rt.dp=function(){var r,t=this.d,e=NaN;if(t){if(r=t.length-1,e=(r-hi(this.e/Dt))*Dt,r=t[r],r)for(;r%10==0;r/=10)e--;e<0&&(e=0)}return e};rt.dividedBy=rt.div=function(r){return ke(this,new this.constructor(r))};rt.dividedToIntegerBy=rt.divToInt=function(r){var t=this,e=t.constructor;return wt(ke(t,new e(r),0,1,1),e.precision,e.rounding)};rt.equals=rt.eq=function(r){return this.cmp(r)===0};rt.floor=function(){return wt(new this.constructor(this),this.e+1,3)};rt.greaterThan=rt.gt=function(r){return this.cmp(r)>0};rt.greaterThanOrEqualTo=rt.gte=function(r){var t=this.cmp(r);return t==1||t===0};rt.hyperbolicCosine=rt.cosh=function(){var r,t,e,i,n,a=this,o=a.constructor,s=new o(1);if(!a.isFinite())return new o(a.s?1/0:NaN);if(a.isZero())return s;e=o.precision,i=o.rounding,o.precision=e+Math.max(a.e,a.sd())+4,o.rounding=1,n=a.d.length,n<32?(r=Math.ceil(n/3),t=(1/Km(4,r)).toString()):(r=16,t="2.3283064365386962890625e-10"),a=Hc(o,1,a.times(t),new o(1),!0);for(var l,u=r,c=new o(8);u--;)l=a.times(a),a=s.minus(l.times(c.minus(l.times(c))));return wt(a,o.precision=e,o.rounding=i,!0)};rt.hyperbolicSine=rt.sinh=function(){var r,t,e,i,n=this,a=n.constructor;if(!n.isFinite()||n.isZero())return new a(n);if(t=a.precision,e=a.rounding,a.precision=t+Math.max(n.e,n.sd())+4,a.rounding=1,i=n.d.length,i<3)n=Hc(a,2,n,n,!0);else{r=1.4*Math.sqrt(i),r=r>16?16:r|0,n=n.times(1/Km(5,r)),n=Hc(a,2,n,n,!0);for(var o,s=new a(5),l=new a(16),u=new a(20);r--;)o=n.times(n),n=n.times(s.plus(o.times(l.times(o).plus(u))))}return a.precision=t,a.rounding=e,wt(n,t,e,!0)};rt.hyperbolicTangent=rt.tanh=function(){var r,t,e=this,i=e.constructor;return e.isFinite()?e.isZero()?new i(e):(r=i.precision,t=i.rounding,i.precision=r+7,i.rounding=1,ke(e.sinh(),e.cosh(),i.precision=r,i.rounding=t)):new i(e.s)};rt.inverseCosine=rt.acos=function(){var r,t=this,e=t.constructor,i=t.abs().cmp(1),n=e.precision,a=e.rounding;return i!==-1?i===0?t.isNeg()?fa(e,n,a):new e(0):new e(NaN):t.isZero()?fa(e,n+4,a).times(.5):(e.precision=n+6,e.rounding=1,t=t.asin(),r=fa(e,n+4,a).times(.5),e.precision=n,e.rounding=a,r.minus(t))};rt.inverseHyperbolicCosine=rt.acosh=function(){var r,t,e=this,i=e.constructor;return e.lte(1)?new i(e.eq(1)?0:NaN):e.isFinite()?(r=i.precision,t=i.rounding,i.precision=r+Math.max(Math.abs(e.e),e.sd())+4,i.rounding=1,$t=!1,e=e.times(e).minus(1).sqrt().plus(e),$t=!0,i.precision=r,i.rounding=t,e.ln()):new i(e)};rt.inverseHyperbolicSine=rt.asinh=function(){var r,t,e=this,i=e.constructor;return!e.isFinite()||e.isZero()?new i(e):(r=i.precision,t=i.rounding,i.precision=r+2*Math.max(Math.abs(e.e),e.sd())+6,i.rounding=1,$t=!1,e=e.times(e).plus(1).sqrt().plus(e),$t=!0,i.precision=r,i.rounding=t,e.ln())};rt.inverseHyperbolicTangent=rt.atanh=function(){var r,t,e,i,n=this,a=n.constructor;return n.isFinite()?n.e>=0?new a(n.abs().eq(1)?n.s/0:n.isZero()?n:NaN):(r=a.precision,t=a.rounding,i=n.sd(),Math.max(i,r)<2*-n.e-1?wt(new a(n),r,t,!0):(a.precision=e=i-n.e,n=ke(n.plus(1),new a(1).minus(n),e+r,1),a.precision=r+4,a.rounding=1,n=n.ln(),a.precision=r,a.rounding=t,n.times(.5))):new a(NaN)};rt.inverseSine=rt.asin=function(){var r,t,e,i,n=this,a=n.constructor;return n.isZero()?new a(n):(t=n.abs().cmp(1),e=a.precision,i=a.rounding,t!==-1?t===0?(r=fa(a,e+4,i).times(.5),r.s=n.s,r):new a(NaN):(a.precision=e+6,a.rounding=1,n=n.div(new a(1).minus(n.times(n)).sqrt().plus(1)).atan(),a.precision=e,a.rounding=i,n.times(2)))};rt.inverseTangent=rt.atan=function(){var r,t,e,i,n,a,o,s,l,u=this,c=u.constructor,h=c.precision,f=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);if(u.abs().eq(1)&&h+4<=hC)return o=fa(c,h+4,f).times(.25),o.s=u.s,o}else{if(!u.s)return new c(NaN);if(h+4<=hC)return o=fa(c,h+4,f).times(.5),o.s=u.s,o}for(c.precision=s=h+10,c.rounding=1,e=Math.min(28,s/Dt+2|0),r=e;r;--r)u=u.div(u.times(u).plus(1).sqrt().plus(1));for($t=!1,t=Math.ceil(s/Dt),i=1,l=u.times(u),o=new c(u),n=u;r!==-1;)if(n=n.times(l),a=o.minus(n.div(i+=2)),n=n.times(l),o=a.plus(n.div(i+=2)),o.d[t]!==void 0)for(r=t;o.d[r]===a.d[r]&&r--;);return e&&(o=o.times(2<<e-1)),$t=!0,wt(o,c.precision=h,c.rounding=f,!0)};rt.isFinite=function(){return!!this.d};rt.isInteger=rt.isInt=function(){return!!this.d&&hi(this.e/Dt)>this.d.length-2};rt.isNaN=function(){return!this.s};rt.isNegative=rt.isNeg=function(){return this.s<0};rt.isPositive=rt.isPos=function(){return this.s>0};rt.isZero=function(){return!!this.d&&this.d[0]===0};rt.lessThan=rt.lt=function(r){return this.cmp(r)<0};rt.lessThanOrEqualTo=rt.lte=function(r){return this.cmp(r)<1};rt.logarithm=rt.log=function(r){var t,e,i,n,a,o,s,l,u=this,c=u.constructor,h=c.precision,f=c.rounding,d=5;if(r==null)r=new c(10),t=!0;else{if(r=new c(r),e=r.d,r.s<0||!e||!e[0]||r.eq(1))return new c(NaN);t=r.eq(10)}if(e=u.d,u.s<0||!e||!e[0]||u.eq(1))return new c(e&&!e[0]?-1/0:u.s!=1?NaN:e?0:1/0);if(t)if(e.length>1)a=!0;else{for(n=e[0];n%10===0;)n/=10;a=n!==1}if($t=!1,s=h+d,o=xs(u,s),i=t?x0(c,s+10):xs(r,s),l=ke(o,i,s,1),pd(l.d,n=h,f))do if(s+=10,o=xs(u,s),i=t?x0(c,s+10):xs(r,s),l=ke(o,i,s,1),!a){+Yr(l.d).slice(n+1,n+15)+1==1e14&&(l=wt(l,h+1,0));break}while(pd(l.d,n+=10,f));return $t=!0,wt(l,h,f)};rt.minus=rt.sub=function(r){var t,e,i,n,a,o,s,l,u,c,h,f,d=this,v=d.constructor;if(r=new v(r),!d.d||!r.d)return!d.s||!r.s?r=new v(NaN):d.d?r.s=-r.s:r=new v(r.d||d.s!==r.s?d:NaN),r;if(d.s!=r.s)return r.s=-r.s,d.plus(r);if(u=d.d,f=r.d,s=v.precision,l=v.rounding,!u[0]||!f[0]){if(f[0])r.s=-r.s;else if(u[0])r=new v(d);else return new v(l===3?-0:0);return $t?wt(r,s,l):r}if(e=hi(r.e/Dt),c=hi(d.e/Dt),u=u.slice(),a=c-e,a){for(h=a<0,h?(t=u,a=-a,o=f.length):(t=f,e=c,o=u.length),i=Math.max(Math.ceil(s/Dt),o)+2,a>i&&(a=i,t.length=1),t.reverse(),i=a;i--;)t.push(0);t.reverse()}else{for(i=u.length,o=f.length,h=i<o,h&&(o=i),i=0;i<o;i++)if(u[i]!=f[i]){h=u[i]<f[i];break}a=0}for(h&&(t=u,u=f,f=t,r.s=-r.s),o=u.length,i=f.length-o;i>0;--i)u[o++]=0;for(i=f.length;i>a;){if(u[--i]<f[i]){for(n=i;n&&u[--n]===0;)u[n]=ya-1;--u[n],u[i]+=ya}u[i]-=f[i]}for(;u[--o]===0;)u.pop();for(;u[0]===0;u.shift())--e;return u[0]?(r.d=u,r.e=qm(u,e),$t?wt(r,s,l):r):new v(l===3?-0:0)};rt.modulo=rt.mod=function(r){var t,e=this,i=e.constructor;return r=new i(r),!e.d||!r.s||r.d&&!r.d[0]?new i(NaN):!r.d||e.d&&!e.d[0]?wt(new i(e),i.precision,i.rounding):($t=!1,i.modulo==9?(t=ke(e,r.abs(),0,3,1),t.s*=r.s):t=ke(e,r,0,i.modulo,1),t=t.times(r),$t=!0,e.minus(t))};rt.naturalExponential=rt.exp=function(){return fC(this)};rt.naturalLogarithm=rt.ln=function(){return xs(this)};rt.negated=rt.neg=function(){var r=new this.constructor(this);return r.s=-r.s,wt(r)};rt.plus=rt.add=function(r){var t,e,i,n,a,o,s,l,u,c,h=this,f=h.constructor;if(r=new f(r),!h.d||!r.d)return!h.s||!r.s?r=new f(NaN):h.d||(r=new f(r.d||h.s===r.s?h:NaN)),r;if(h.s!=r.s)return r.s=-r.s,h.minus(r);if(u=h.d,c=r.d,s=f.precision,l=f.rounding,!u[0]||!c[0])return c[0]||(r=new f(h)),$t?wt(r,s,l):r;if(a=hi(h.e/Dt),i=hi(r.e/Dt),u=u.slice(),n=a-i,n){for(n<0?(e=u,n=-n,o=c.length):(e=c,i=a,o=u.length),a=Math.ceil(s/Dt),o=a>o?a+1:o+1,n>o&&(n=o,e.length=1),e.reverse();n--;)e.push(0);e.reverse()}for(o=u.length,n=c.length,o-n<0&&(n=o,e=c,c=u,u=e),t=0;n;)t=(u[--n]=u[n]+c[n]+t)/ya|0,u[n]%=ya;for(t&&(u.unshift(t),++i),o=u.length;u[--o]==0;)u.pop();return r.d=u,r.e=qm(u,i),$t?wt(r,s,l):r};rt.precision=rt.sd=function(r){var t,e=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(Ds+r);return e.d?(t=U7(e.d),r&&e.e+1>t&&(t=e.e+1)):t=NaN,t};rt.round=function(){var r=this,t=r.constructor;return wt(new t(r),r.e+1,t.rounding)};rt.sine=rt.sin=function(){var r,t,e=this,i=e.constructor;return e.isFinite()?e.isZero()?new i(e):(r=i.precision,t=i.rounding,i.precision=r+Math.max(e.e,e.sd())+Dt,i.rounding=1,e=tRt(i,W7(i,e)),i.precision=r,i.rounding=t,wt(bo>2?e.neg():e,r,t,!0)):new i(NaN)};rt.squareRoot=rt.sqrt=function(){var r,t,e,i,n,a,o=this,s=o.d,l=o.e,u=o.s,c=o.constructor;if(u!==1||!s||!s[0])return new c(!u||u<0&&(!s||s[0])?NaN:s?o:1/0);for($t=!1,u=Math.sqrt(+o),u==0||u==1/0?(t=Yr(s),(t.length+l)%2==0&&(t+="0"),u=Math.sqrt(t),l=hi((l+1)/2)-(l<0||l%2),u==1/0?t="5e"+l:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+l),i=new c(t)):i=new c(u.toString()),e=(l=c.precision)+3;;)if(a=i,i=a.plus(ke(o,a,e+2,1)).times(.5),Yr(a.d).slice(0,e)===(t=Yr(i.d)).slice(0,e))if(t=t.slice(e-3,e+1),t=="9999"||!n&&t=="4999"){if(!n&&(wt(a,l+1,0),a.times(a).eq(o))){i=a;break}e+=4,n=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(wt(i,l+1,1),r=!i.times(i).eq(o));break}return $t=!0,wt(i,l,c.rounding,r)};rt.tangent=rt.tan=function(){var r,t,e=this,i=e.constructor;return e.isFinite()?e.isZero()?new i(e):(r=i.precision,t=i.rounding,i.precision=r+10,i.rounding=1,e=e.sin(),e.s=1,e=ke(e,new i(1).minus(e.times(e)).sqrt(),r+10,0),i.precision=r,i.rounding=t,wt(bo==2||bo==4?e.neg():e,r,t,!0)):new i(NaN)};rt.times=rt.mul=function(r){var t,e,i,n,a,o,s,l,u,c=this,h=c.constructor,f=c.d,d=(r=new h(r)).d;if(r.s*=c.s,!f||!f[0]||!d||!d[0])return new h(!r.s||f&&!f[0]&&!d||d&&!d[0]&&!f?NaN:!f||!d?r.s/0:r.s*0);for(e=hi(c.e/Dt)+hi(r.e/Dt),l=f.length,u=d.length,l<u&&(a=f,f=d,d=a,o=l,l=u,u=o),a=[],o=l+u,i=o;i--;)a.push(0);for(i=u;--i>=0;){for(t=0,n=l+i;n>i;)s=a[n]+d[i]*f[n-i-1]+t,a[n--]=s%ya|0,t=s/ya|0;a[n]=(a[n]+t)%ya|0}for(;!a[--o];)a.pop();return t?++e:a.shift(),r.d=a,r.e=qm(a,e),$t?wt(r,h.precision,h.rounding):r};rt.toBinary=function(r,t){return HA(this,2,r,t)};rt.toDecimalPlaces=rt.toDP=function(r,t){var e=this,i=e.constructor;return e=new i(e),r===void 0?e:(ji(r,0,qs),t===void 0?t=i.rounding:ji(t,0,8),wt(e,r+e.e+1,t))};rt.toExponential=function(r,t){var e,i=this,n=i.constructor;return r===void 0?e=Ja(i,!0):(ji(r,0,qs),t===void 0?t=n.rounding:ji(t,0,8),i=wt(new n(i),r+1,t),e=Ja(i,!0,r+1)),i.isNeg()&&!i.isZero()?"-"+e:e};rt.toFixed=function(r,t){var e,i,n=this,a=n.constructor;return r===void 0?e=Ja(n):(ji(r,0,qs),t===void 0?t=a.rounding:ji(t,0,8),i=wt(new a(n),r+n.e+1,t),e=Ja(i,!1,r+i.e+1)),n.isNeg()&&!n.isZero()?"-"+e:e};rt.toFraction=function(r){var t,e,i,n,a,o,s,l,u,c,h,f,d=this,v=d.d,p=d.constructor;if(!v)return new p(d);if(u=e=new p(1),i=l=new p(0),t=new p(i),a=t.e=U7(v)-d.e-1,o=a%Dt,t.d[0]=xr(10,o<0?Dt+o:o),r==null)r=a>0?t:u;else{if(s=new p(r),!s.isInt()||s.lt(u))throw Error(Ds+s);r=s.gt(t)?a>0?t:u:s}for($t=!1,s=new p(Yr(v)),c=p.precision,p.precision=a=v.length*Dt*2;h=ke(s,t,0,1,1),n=e.plus(h.times(i)),n.cmp(r)!=1;)e=i,i=n,n=u,u=l.plus(h.times(n)),l=n,n=t,t=s.minus(h.times(n)),s=n;return n=ke(r.minus(e),i,0,1,1),l=l.plus(n.times(u)),e=e.plus(n.times(i)),l.s=u.s=d.s,f=ke(u,i,a,1).minus(d).abs().cmp(ke(l,e,a,1).minus(d).abs())<1?[u,i]:[l,e],p.precision=c,$t=!0,f};rt.toHexadecimal=rt.toHex=function(r,t){return HA(this,16,r,t)};rt.toNearest=function(r,t){var e=this,i=e.constructor;if(e=new i(e),r==null){if(!e.d)return e;r=new i(1),t=i.rounding}else{if(r=new i(r),t===void 0?t=i.rounding:ji(t,0,8),!e.d)return r.s?e:r;if(!r.d)return r.s&&(r.s=e.s),r}return r.d[0]?($t=!1,e=ke(e,r,0,t,1).times(r),$t=!0,wt(e)):(r.s=e.s,e=r),e};rt.toNumber=function(){return+this};rt.toOctal=function(r,t){return HA(this,8,r,t)};rt.toPower=rt.pow=function(r){var t,e,i,n,a,o,s=this,l=s.constructor,u=+(r=new l(r));if(!s.d||!r.d||!s.d[0]||!r.d[0])return new l(xr(+s,u));if(s=new l(s),s.eq(1))return s;if(i=l.precision,a=l.rounding,r.eq(1))return wt(s,i,a);if(t=hi(r.e/Dt),t>=r.d.length-1&&(e=u<0?-u:u)<=qwt)return n=z7(l,s,e,i),r.s<0?new l(1).div(n):wt(n,i,a);if(o=s.s,o<0){if(t<r.d.length-1)return new l(NaN);if(r.d[t]&1||(o=1),s.e==0&&s.d[0]==1&&s.d.length==1)return s.s=o,s}return e=xr(+s,u),t=e==0||!isFinite(e)?hi(u*(Math.log("0."+Yr(s.d))/Math.LN10+s.e+1)):new l(e+"").e,t>l.maxE+1||t<l.minE-1?new l(t>0?o/0:0):($t=!1,l.rounding=s.s=1,e=Math.min(12,(t+"").length),n=fC(r.times(xs(s,i+e)),i),n.d&&(n=wt(n,i+5,1),pd(n.d,i,a)&&(t=i+10,n=wt(fC(r.times(xs(s,t+e)),t),t+5,1),+Yr(n.d).slice(i+1,i+15)+1==1e14&&(n=wt(n,i+1,0)))),n.s=o,$t=!0,l.rounding=a,wt(n,i,a))};rt.toPrecision=function(r,t){var e,i=this,n=i.constructor;return r===void 0?e=Ja(i,i.e<=n.toExpNeg||i.e>=n.toExpPos):(ji(r,1,qs),t===void 0?t=n.rounding:ji(t,0,8),i=wt(new n(i),r,t),e=Ja(i,r<=i.e||i.e<=n.toExpNeg,r)),i.isNeg()&&!i.isZero()?"-"+e:e};rt.toSignificantDigits=rt.toSD=function(r,t){var e=this,i=e.constructor;return r===void 0?(r=i.precision,t=i.rounding):(ji(r,1,qs),t===void 0?t=i.rounding:ji(t,0,8)),wt(new i(e),r,t)};rt.toString=function(){var r=this,t=r.constructor,e=Ja(r,r.e<=t.toExpNeg||r.e>=t.toExpPos);return r.isNeg()&&!r.isZero()?"-"+e:e};rt.truncated=rt.trunc=function(){return wt(new this.constructor(this),this.e+1,1)};rt.valueOf=rt.toJSON=function(){var r=this,t=r.constructor,e=Ja(r,r.e<=t.toExpNeg||r.e>=t.toExpPos);return r.isNeg()?"-"+e:e};function Yr(r){var t,e,i,n=r.length-1,a="",o=r[0];if(n>0){for(a+=o,t=1;t<n;t++)i=r[t]+"",e=Dt-i.length,e&&(a+=fs(e)),a+=i;o=r[t],i=o+"",e=Dt-i.length,e&&(a+=fs(e))}else if(o===0)return"0";for(;o%10===0;)o/=10;return a+o}function ji(r,t,e){if(r!==~~r||r<t||r>e)throw Error(Ds+r)}function pd(r,t,e,i){var n,a,o,s;for(a=r[0];a>=10;a/=10)--t;return--t<0?(t+=Dt,n=0):(n=Math.ceil((t+1)/Dt),t%=Dt),a=xr(10,Dt-t),s=r[n]%a|0,i==null?t<3?(t==0?s=s/100|0:t==1&&(s=s/10|0),o=e<4&&s==99999||e>3&&s==49999||s==5e4||s==0):o=(e<4&&s+1==a||e>3&&s+1==a/2)&&(r[n+1]/a/100|0)==xr(10,t-2)-1||(s==a/2||s==0)&&(r[n+1]/a/100|0)==0:t<4?(t==0?s=s/1e3|0:t==1?s=s/100|0:t==2&&(s=s/10|0),o=(i||e<4)&&s==9999||!i&&e>3&&s==4999):o=((i||e<4)&&s+1==a||!i&&e>3&&s+1==a/2)&&(r[n+1]/a/1e3|0)==xr(10,t-3)-1,o}function og(r,t,e){for(var i,n=[0],a,o=0,s=r.length;o<s;){for(a=n.length;a--;)n[a]*=t;for(n[0]+=uC.indexOf(r.charAt(o++)),i=0;i<n.length;i++)n[i]>e-1&&(n[i+1]===void 0&&(n[i+1]=0),n[i+1]+=n[i]/e|0,n[i]%=e)}return n.reverse()}function Qwt(r,t){var e,i,n;if(t.isZero())return t;i=t.d.length,i<32?(e=Math.ceil(i/3),n=(1/Km(4,e)).toString()):(e=16,n="2.3283064365386962890625e-10"),r.precision+=e,t=Hc(r,1,t.times(n),new r(1));for(var a=e;a--;){var o=t.times(t);t=o.times(o).minus(o).times(8).plus(1)}return r.precision-=e,t}var ke=function(){function r(i,n,a){var o,s=0,l=i.length;for(i=i.slice();l--;)o=i[l]*n+s,i[l]=o%a|0,s=o/a|0;return s&&i.unshift(s),i}function t(i,n,a,o){var s,l;if(a!=o)l=a>o?1:-1;else for(s=l=0;s<a;s++)if(i[s]!=n[s]){l=i[s]>n[s]?1:-1;break}return l}function e(i,n,a,o){for(var s=0;a--;)i[a]-=s,s=i[a]<n[a]?1:0,i[a]=s*o+i[a]-n[a];for(;!i[0]&&i.length>1;)i.shift()}return function(i,n,a,o,s,l){var u,c,h,f,d,v,p,g,m,y,_,x,C,A,T,w,M,O,P,D,z=i.constructor,Y=i.s==n.s?1:-1,H=i.d,N=n.d;if(!H||!H[0]||!N||!N[0])return new z(!i.s||!n.s||(H?N&&H[0]==N[0]:!N)?NaN:H&&H[0]==0||!N?Y*0:Y/0);for(l?(d=1,c=i.e-n.e):(l=ya,d=Dt,c=hi(i.e/d)-hi(n.e/d)),P=N.length,M=H.length,m=new z(Y),y=m.d=[],h=0;N[h]==(H[h]||0);h++);if(N[h]>(H[h]||0)&&c--,a==null?(A=a=z.precision,o=z.rounding):s?A=a+(i.e-n.e)+1:A=a,A<0)y.push(1),v=!0;else{if(A=A/d+2|0,h=0,P==1){for(f=0,N=N[0],A++;(h<M||f)&&A--;h++)T=f*l+(H[h]||0),y[h]=T/N|0,f=T%N|0;v=f||h<M}else{for(f=l/(N[0]+1)|0,f>1&&(N=r(N,f,l),H=r(H,f,l),P=N.length,M=H.length),w=P,_=H.slice(0,P),x=_.length;x<P;)_[x++]=0;D=N.slice(),D.unshift(0),O=N[0],N[1]>=l/2&&++O;do f=0,u=t(N,_,P,x),u<0?(C=_[0],P!=x&&(C=C*l+(_[1]||0)),f=C/O|0,f>1?(f>=l&&(f=l-1),p=r(N,f,l),g=p.length,x=_.length,u=t(p,_,g,x),u==1&&(f--,e(p,P<g?D:N,g,l))):(f==0&&(u=f=1),p=N.slice()),g=p.length,g<x&&p.unshift(0),e(_,p,x,l),u==-1&&(x=_.length,u=t(N,_,P,x),u<1&&(f++,e(_,P<x?D:N,x,l))),x=_.length):u===0&&(f++,_=[0]),y[h++]=f,u&&_[0]?_[x++]=H[w]||0:(_=[H[w]],x=1);while((w++<M||_[0]!==void 0)&&A--);v=_[0]!==void 0}y[0]||y.shift()}if(d==1)m.e=c,F7=v;else{for(h=1,f=y[0];f>=10;f/=10)h++;m.e=h+c*d-1,wt(m,s?a+m.e+1:a,o,v)}return m}}();function wt(r,t,e,i){var n,a,o,s,l,u,c,h,f,d=r.constructor;t:if(t!=null){if(h=r.d,!h)return r;for(n=1,s=h[0];s>=10;s/=10)n++;if(a=t-n,a<0)a+=Dt,o=t,c=h[f=0],l=c/xr(10,n-o-1)%10|0;else if(f=Math.ceil((a+1)/Dt),s=h.length,f>=s)if(i){for(;s++<=f;)h.push(0);c=l=0,n=1,a%=Dt,o=a-Dt+1}else break t;else{for(c=s=h[f],n=1;s>=10;s/=10)n++;a%=Dt,o=a-Dt+n,l=o<0?0:c/xr(10,n-o-1)%10|0}if(i=i||t<0||h[f+1]!==void 0||(o<0?c:c%xr(10,n-o-1)),u=e<4?(l||i)&&(e==0||e==(r.s<0?3:2)):l>5||l==5&&(e==4||i||e==6&&(a>0?o>0?c/xr(10,n-o):0:h[f-1])%10&1||e==(r.s<0?8:7)),t<1||!h[0])return h.length=0,u?(t-=r.e+1,h[0]=xr(10,(Dt-t%Dt)%Dt),r.e=-t||0):h[0]=r.e=0,r;if(a==0?(h.length=f,s=1,f--):(h.length=f+1,s=xr(10,Dt-a),h[f]=o>0?(c/xr(10,n-o)%xr(10,o)|0)*s:0),u)for(;;)if(f==0){for(a=1,o=h[0];o>=10;o/=10)a++;for(o=h[0]+=s,s=1;o>=10;o/=10)s++;a!=s&&(r.e++,h[0]==ya&&(h[0]=1));break}else{if(h[f]+=s,h[f]!=ya)break;h[f--]=0,s=1}for(a=h.length;h[--a]===0;)h.pop()}return $t&&(r.e>d.maxE?(r.d=null,r.e=NaN):r.e<d.minE&&(r.e=0,r.d=[0])),r}function Ja(r,t,e){if(!r.isFinite())return $7(r);var i,n=r.e,a=Yr(r.d),o=a.length;return t?(e&&(i=e-o)>0?a=a.charAt(0)+"."+a.slice(1)+fs(i):o>1&&(a=a.charAt(0)+"."+a.slice(1)),a=a+(r.e<0?"e":"e+")+r.e):n<0?(a="0."+fs(-n-1)+a,e&&(i=e-o)>0&&(a+=fs(i))):n>=o?(a+=fs(n+1-o),e&&(i=e-n-1)>0&&(a=a+"."+fs(i))):((i=n+1)<o&&(a=a.slice(0,i)+"."+a.slice(i)),e&&(i=e-o)>0&&(n+1===o&&(a+="."),a+=fs(i))),a}function qm(r,t){var e=r[0];for(t*=Dt;e>=10;e/=10)t++;return t}function x0(r,t,e){if(t>Kwt)throw $t=!0,e&&(r.precision=e),Error(B7);return wt(new r(y0),t,1,!0)}function fa(r,t,e){if(t>hC)throw Error(B7);return wt(new r(_0),t,e,!0)}function U7(r){var t=r.length-1,e=t*Dt+1;if(t=r[t],t){for(;t%10==0;t/=10)e--;for(t=r[0];t>=10;t/=10)e++}return e}function fs(r){for(var t="";r--;)t+="0";return t}function z7(r,t,e,i){var n,a=new r(1),o=Math.ceil(i/Dt+4);for($t=!1;;){if(e%2&&(a=a.times(t),uL(a.d,o)&&(n=!0)),e=hi(e/2),e===0){e=a.d.length-1,n&&a.d[e]===0&&++a.d[e];break}t=t.times(t),uL(t.d,o)}return $t=!0,a}function lL(r){return r.d[r.d.length-1]&1}function H7(r,t,e){for(var i,n=new r(t[0]),a=0;++a<t.length;)if(i=new r(t[a]),i.s)n[e](i)&&(n=i);else{n=i;break}return n}function fC(r,t){var e,i,n,a,o,s,l,u=0,c=0,h=0,f=r.constructor,d=f.rounding,v=f.precision;if(!r.d||!r.d[0]||r.e>17)return new f(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(t==null?($t=!1,l=v):l=t,s=new f(.03125);r.e>-2;)r=r.times(s),h+=5;for(i=Math.log(xr(2,h))/Math.LN10*2+5|0,l+=i,e=a=o=new f(1),f.precision=l;;){if(a=wt(a.times(r),l,1),e=e.times(++c),s=o.plus(ke(a,e,l,1)),Yr(s.d).slice(0,l)===Yr(o.d).slice(0,l)){for(n=h;n--;)o=wt(o.times(o),l,1);if(t==null)if(u<3&&pd(o.d,l-i,d,u))f.precision=l+=10,e=a=s=new f(1),c=0,u++;else return wt(o,f.precision=v,d,$t=!0);else return f.precision=v,o}o=s}}function xs(r,t){var e,i,n,a,o,s,l,u,c,h,f,d=1,v=10,p=r,g=p.d,m=p.constructor,y=m.rounding,_=m.precision;if(p.s<0||!g||!g[0]||!p.e&&g[0]==1&&g.length==1)return new m(g&&!g[0]?-1/0:p.s!=1?NaN:g?0:p);if(t==null?($t=!1,c=_):c=t,m.precision=c+=v,e=Yr(g),i=e.charAt(0),Math.abs(a=p.e)<15e14){for(;i<7&&i!=1||i==1&&e.charAt(1)>3;)p=p.times(r),e=Yr(p.d),i=e.charAt(0),d++;a=p.e,i>1?(p=new m("0."+e),a++):p=new m(i+"."+e.slice(1))}else return u=x0(m,c+2,_).times(a+""),p=xs(new m(i+"."+e.slice(1)),c-v).plus(u),m.precision=_,t==null?wt(p,_,y,$t=!0):p;for(h=p,l=o=p=ke(p.minus(1),p.plus(1),c,1),f=wt(p.times(p),c,1),n=3;;){if(o=wt(o.times(f),c,1),u=l.plus(ke(o,new m(n),c,1)),Yr(u.d).slice(0,c)===Yr(l.d).slice(0,c))if(l=l.times(2),a!==0&&(l=l.plus(x0(m,c+2,_).times(a+""))),l=ke(l,new m(d),c,1),t==null)if(pd(l.d,c-v,y,s))m.precision=c+=v,u=o=p=ke(h.minus(1),h.plus(1),c,1),f=wt(p.times(p),c,1),n=s=1;else return wt(l,m.precision=_,y,$t=!0);else return m.precision=_,l;l=u,n+=2}}function $7(r){return String(r.s*r.s/0)}function dC(r,t){var e,i,n;for((e=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(e<0&&(e=i),e+=+t.slice(i+1),t=t.substring(0,i)):e<0&&(e=t.length),i=0;t.charCodeAt(i)===48;i++);for(n=t.length;t.charCodeAt(n-1)===48;--n);if(t=t.slice(i,n),t){if(n-=i,r.e=e=e-i-1,r.d=[],i=(e+1)%Dt,e<0&&(i+=Dt),i<n){for(i&&r.d.push(+t.slice(0,i)),n-=Dt;i<n;)r.d.push(+t.slice(i,i+=Dt));t=t.slice(i),i=Dt-t.length}else i-=n;for(;i--;)t+="0";r.d.push(+t),$t&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function Jwt(r,t){var e,i,n,a,o,s,l,u,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),k7.test(t))return dC(r,t)}else if(t==="Infinity"||t==="NaN")return+t||(r.s=NaN),r.e=NaN,r.d=null,r;if(jwt.test(t))e=16,t=t.toLowerCase();else if(Ywt.test(t))e=2;else if(Zwt.test(t))e=8;else throw Error(Ds+t);for(a=t.search(/p/i),a>0?(l=+t.slice(a+1),t=t.substring(2,a)):t=t.slice(2),a=t.indexOf("."),o=a>=0,i=r.constructor,o&&(t=t.replace(".",""),s=t.length,a=s-a,n=z7(i,new i(e),a,a*2)),u=og(t,e,ya),c=u.length-1,a=c;u[a]===0;--a)u.pop();return a<0?new i(r.s*0):(r.e=qm(u,c),r.d=u,$t=!1,o&&(r=ke(r,n,s*4)),l&&(r=r.times(Math.abs(l)<54?xr(2,l):Sa.pow(2,l))),$t=!0,r)}function tRt(r,t){var e,i=t.d.length;if(i<3)return t.isZero()?t:Hc(r,2,t,t);e=1.4*Math.sqrt(i),e=e>16?16:e|0,t=t.times(1/Km(5,e)),t=Hc(r,2,t,t);for(var n,a=new r(5),o=new r(16),s=new r(20);e--;)n=t.times(t),t=t.times(a.plus(n.times(o.times(n).minus(s))));return t}function Hc(r,t,e,i,n){var a,o,s,l,u=r.precision,c=Math.ceil(u/Dt);for($t=!1,l=e.times(e),s=new r(i);;){if(o=ke(s.times(l),new r(t++*t++),u,1),s=n?i.plus(o):i.minus(o),i=ke(o.times(l),new r(t++*t++),u,1),o=s.plus(i),o.d[c]!==void 0){for(a=c;o.d[a]===s.d[a]&&a--;);if(a==-1)break}a=s,s=i,i=o,o=a}return $t=!0,o.d.length=c+1,o}function Km(r,t){for(var e=r;--t;)e*=r;return e}function W7(r,t){var e,i=t.s<0,n=fa(r,r.precision,1),a=n.times(.5);if(t=t.abs(),t.lte(a))return bo=i?4:1,t;if(e=t.divToInt(n),e.isZero())bo=i?3:2;else{if(t=t.minus(e.times(n)),t.lte(a))return bo=lL(e)?i?2:3:i?4:1,t;bo=lL(e)?i?1:4:i?3:2}return t.minus(n).abs()}function HA(r,t,e,i){var n,a,o,s,l,u,c,h,f,d=r.constructor,v=e!==void 0;if(v?(ji(e,1,qs),i===void 0?i=d.rounding:ji(i,0,8)):(e=d.precision,i=d.rounding),!r.isFinite())c=$7(r);else{for(c=Ja(r),o=c.indexOf("."),v?(n=2,t==16?e=e*4-3:t==8&&(e=e*3-2)):n=t,o>=0&&(c=c.replace(".",""),f=new d(1),f.e=c.length-o,f.d=og(Ja(f),10,n),f.e=f.d.length),h=og(c,10,n),a=l=h.length;h[--l]==0;)h.pop();if(!h[0])c=v?"0p+0":"0";else{if(o<0?a--:(r=new d(r),r.d=h,r.e=a,r=ke(r,f,e,i,0,n),h=r.d,a=r.e,u=F7),o=h[e],s=n/2,u=u||h[e+1]!==void 0,u=i<4?(o!==void 0||u)&&(i===0||i===(r.s<0?3:2)):o>s||o===s&&(i===4||u||i===6&&h[e-1]&1||i===(r.s<0?8:7)),h.length=e,u)for(;++h[--e]>n-1;)h[e]=0,e||(++a,h.unshift(1));for(l=h.length;!h[l-1];--l);for(o=0,c="";o<l;o++)c+=uC.charAt(h[o]);if(v){if(l>1)if(t==16||t==8){for(o=t==16?4:3,--l;l%o;l++)c+="0";for(h=og(c,n,t),l=h.length;!h[l-1];--l);for(o=1,c="1.";o<l;o++)c+=uC.charAt(h[o])}else c=c.charAt(0)+"."+c.slice(1);c=c+(a<0?"p":"p+")+a}else if(a<0){for(;++a;)c="0"+c;c="0."+c}else if(++a>l)for(a-=l;a--;)c+="0";else a<l&&(c=c.slice(0,a)+"."+c.slice(a))}c=(t==16?"0x":t==2?"0b":t==8?"0o":"")+c}return r.s<0?"-"+c:c}function uL(r,t){if(r.length>t)return r.length=t,!0}function eRt(r){return new this(r).abs()}function rRt(r){return new this(r).acos()}function iRt(r){return new this(r).acosh()}function nRt(r,t){return new this(r).plus(t)}function aRt(r){return new this(r).asin()}function oRt(r){return new this(r).asinh()}function sRt(r){return new this(r).atan()}function lRt(r){return new this(r).atanh()}function uRt(r,t){r=new this(r),t=new this(t);var e,i=this.precision,n=this.rounding,a=i+4;return!r.s||!t.s?e=new this(NaN):!r.d&&!t.d?(e=fa(this,a,1).times(t.s>0?.25:.75),e.s=r.s):!t.d||r.isZero()?(e=t.s<0?fa(this,i,n):new this(0),e.s=r.s):!r.d||t.isZero()?(e=fa(this,a,1).times(.5),e.s=r.s):t.s<0?(this.precision=a,this.rounding=1,e=this.atan(ke(r,t,a,1)),t=fa(this,a,1),this.precision=i,this.rounding=n,e=r.s<0?e.minus(t):e.plus(t)):e=this.atan(ke(r,t,a,1)),e}function cRt(r){return new this(r).cbrt()}function hRt(r){return wt(r=new this(r),r.e+1,2)}function fRt(r,t,e){return new this(r).clamp(t,e)}function dRt(r){if(!r||typeof r!="object")throw Error(Zm+"Object expected");var t,e,i,n=r.defaults===!0,a=["precision",1,qs,"rounding",0,8,"toExpNeg",-Qu,0,"toExpPos",0,Qu,"maxE",0,Qu,"minE",-Qu,0,"modulo",0,9];for(t=0;t<a.length;t+=3)if(e=a[t],n&&(this[e]=cC[e]),(i=r[e])!==void 0)if(hi(i)===i&&i>=a[t+1]&&i<=a[t+2])this[e]=i;else throw Error(Ds+e+": "+i);if(e="crypto",n&&(this[e]=cC[e]),(i=r[e])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[e]=!0;else throw Error(D7);else this[e]=!1;else throw Error(Ds+e+": "+i);return this}function vRt(r){return new this(r).cos()}function pRt(r){return new this(r).cosh()}function V7(r){var t,e,i;function n(a){var o,s,l,u=this;if(!(u instanceof n))return new n(a);if(u.constructor=n,cL(a)){u.s=a.s,$t?!a.d||a.e>n.maxE?(u.e=NaN,u.d=null):a.e<n.minE?(u.e=0,u.d=[0]):(u.e=a.e,u.d=a.d.slice()):(u.e=a.e,u.d=a.d?a.d.slice():a.d);return}if(l=typeof a,l==="number"){if(a===0){u.s=1/a<0?-1:1,u.e=0,u.d=[0];return}if(a<0?(a=-a,u.s=-1):u.s=1,a===~~a&&a<1e7){for(o=0,s=a;s>=10;s/=10)o++;$t?o>n.maxE?(u.e=NaN,u.d=null):o<n.minE?(u.e=0,u.d=[0]):(u.e=o,u.d=[a]):(u.e=o,u.d=[a]);return}else if(a*0!==0){a||(u.s=NaN),u.e=NaN,u.d=null;return}return dC(u,a.toString())}else if(l!=="string")throw Error(Ds+a);return(s=a.charCodeAt(0))===45?(a=a.slice(1),u.s=-1):(s===43&&(a=a.slice(1)),u.s=1),k7.test(a)?dC(u,a):Jwt(u,a)}if(n.prototype=rt,n.ROUND_UP=0,n.ROUND_DOWN=1,n.ROUND_CEIL=2,n.ROUND_FLOOR=3,n.ROUND_HALF_UP=4,n.ROUND_HALF_DOWN=5,n.ROUND_HALF_EVEN=6,n.ROUND_HALF_CEIL=7,n.ROUND_HALF_FLOOR=8,n.EUCLID=9,n.config=n.set=dRt,n.clone=V7,n.isDecimal=cL,n.abs=eRt,n.acos=rRt,n.acosh=iRt,n.add=nRt,n.asin=aRt,n.asinh=oRt,n.atan=sRt,n.atanh=lRt,n.atan2=uRt,n.cbrt=cRt,n.ceil=hRt,n.clamp=fRt,n.cos=vRt,n.cosh=pRt,n.div=gRt,n.exp=mRt,n.floor=yRt,n.hypot=_Rt,n.ln=xRt,n.log=CRt,n.log10=SRt,n.log2=ERt,n.max=ARt,n.min=TRt,n.mod=bRt,n.mul=wRt,n.pow=RRt,n.random=MRt,n.round=IRt,n.sign=LRt,n.sin=ORt,n.sinh=PRt,n.sqrt=FRt,n.sub=BRt,n.sum=DRt,n.tan=NRt,n.tanh=kRt,n.trunc=URt,r===void 0&&(r={}),r&&r.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<i.length;)r.hasOwnProperty(e=i[t++])||(r[e]=this[e]);return n.config(r),n}function gRt(r,t){return new this(r).div(t)}function mRt(r){return new this(r).exp()}function yRt(r){return wt(r=new this(r),r.e+1,3)}function _Rt(){var r,t,e=new this(0);for($t=!1,r=0;r<arguments.length;)if(t=new this(arguments[r++]),t.d)e.d&&(e=e.plus(t.times(t)));else{if(t.s)return $t=!0,new this(1/0);e=t}return $t=!0,e.sqrt()}function cL(r){return r instanceof Sa||r&&r.toStringTag===N7||!1}function xRt(r){return new this(r).ln()}function CRt(r,t){return new this(r).log(t)}function ERt(r){return new this(r).log(2)}function SRt(r){return new this(r).log(10)}function ARt(){return H7(this,arguments,"lt")}function TRt(){return H7(this,arguments,"gt")}function bRt(r,t){return new this(r).mod(t)}function wRt(r,t){return new this(r).mul(t)}function RRt(r,t){return new this(r).pow(t)}function MRt(r){var t,e,i,n,a=0,o=new this(1),s=[];if(r===void 0?r=this.precision:ji(r,1,qs),i=Math.ceil(r/Dt),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(i));a<i;)n=t[a],n>=429e7?t[a]=crypto.getRandomValues(new Uint32Array(1))[0]:s[a++]=n%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(i*=4);a<i;)n=t[a]+(t[a+1]<<8)+(t[a+2]<<16)+((t[a+3]&127)<<24),n>=214e7?crypto.randomBytes(4).copy(t,a):(s.push(n%1e7),a+=4);a=i/4}else throw Error(D7);else for(;a<i;)s[a++]=Math.random()*1e7|0;for(i=s[--a],r%=Dt,i&&r&&(n=xr(10,Dt-r),s[a]=(i/n|0)*n);s[a]===0;a--)s.pop();if(a<0)e=0,s=[0];else{for(e=-1;s[0]===0;e-=Dt)s.shift();for(i=1,n=s[0];n>=10;n/=10)i++;i<Dt&&(e-=Dt-i)}return o.e=e,o.d=s,o}function IRt(r){return wt(r=new this(r),r.e+1,this.rounding)}function LRt(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function ORt(r){return new this(r).sin()}function PRt(r){return new this(r).sinh()}function FRt(r){return new this(r).sqrt()}function BRt(r,t){return new this(r).sub(t)}function DRt(){var r=0,t=arguments,e=new this(t[r]);for($t=!1;e.s&&++r<t.length;)e=e.plus(t[r]);return $t=!0,wt(e,this.precision,this.rounding)}function NRt(r){return new this(r).tan()}function kRt(r){return new this(r).tanh()}function URt(r){return wt(r=new this(r),r.e+1,1)}rt[Symbol.for("nodejs.util.inspect.custom")]=rt.toString;rt[Symbol.toStringTag]="Decimal";var Sa=rt.constructor=V7(cC);y0=new Sa(y0);_0=new Sa(_0);var Pu,G7=function(r){return typeof r=="number"?Number.isNaN(r):r&&typeof r=="string"?Number.isNaN(Number(r)):!0},$A=function(r,t,e){return e===void 0&&(e=!1),r!=null&&r.length?r.reduce(function(i,n){var a=Nt(n,t),o=G7(a);if(e&&o)return i;var s=o?0:a;return i.push(new Sa(s)),i},[]):[]},X7=function(r,t){var e=$A(r,t);return e.length?Sa.sum.apply(Sa,ht([],tt(e),!1)).toNumber():0},hL=function(r,t,e){var i=$A(t,e,!0);if(i!=null&&i.length)return Sa[r].apply(Sa,ht([],tt(i),!1)).toNumber()},zRt=function(r,t){var e=$A(r,t);return e!=null&&e.length?Sa.sum.apply(Sa,ht([],tt(e),!1)).dividedBy(e.length).toNumber():0},HRt=(Pu={},Pu[Al.SUM]=X7,Pu[Al.MIN]=function(r,t){return hL("min",r,t)},Pu[Al.MAX]=function(r,t){return hL("max",r,t)},Pu[Al.AVG]=zRt,Pu),$Rt=function(r){return Oe(r)&&"values"in r},WRt=function(r){var t=r.spreadsheet,e=r.position,i=r.tooltipContainer,n=r.autoAdjustBoundary,a=t.getCanvasElement(),o=e.x+zI.x,s=e.y+zI.y;if(!n||!a)return{x:o,y:s};var l=n==="body",u=t.facet.panelBBox,c=u.maxX,h=u.maxY,f=t.options,d=f.width,v=f.height,p=a.getBoundingClientRect(),g=p.top,m=p.left,y=i.getBoundingClientRect(),_=y.width,x=y.height,C=document.body.getBoundingClientRect(),A=C.width,T=C.height,w=l?A:Math.min(d,c)+m,M=l?T:Math.min(v,h)+g;return o+_>=w&&(o=w-_),s+x>=M&&(s=M-x),{x:o,y:s}},VRt=function(r){return k({operator:{onClick:_m,menus:[]},enterable:!0,enableFormat:!0},r)},vC=function(r){return k(k({},r==null?void 0:r.colQuery),r==null?void 0:r.rowQuery)},_p=function(r,t){var e;if(r){var i=t.style,n=t.className,a=n===void 0?[]:n,o=t.visible;if(i&&Object.assign(r.style,i),a.length){var s=a.filter(Boolean);(e=r.classList).add.apply(e,ht([],tt(s),!1))}r.classList.toggle(kTt,o),r.classList.toggle(UTt,!o)}},GRt=function(r){var t=yi(r)&&Number.isNaN(r),e=r==="";return wr(r)||t||e?"-":r},WA=function(r,t){var e,i=(e=r==null?void 0:r.dataSet)===null||e===void 0?void 0:e.getFieldFormatter(t);return function(n,a){return GRt(i(n,a))}},sg=function(r,t){var e,i=t.data,n=t.field,a=t.valueField,o=t.useCompleteDataForFormatter,s=o===void 0?!0:o,l=(e=r==null?void 0:r.dataSet)===null||e===void 0?void 0:e.getFieldName(n),u=WA(r,n),c=Oe(i[n])?JSON.stringify(i[n]):i[n],h=u(a||c,s?i:void 0);return{name:l,value:h}},fL=function(r,t,e){var i=qo(Zu([],t),function(a){return a!==Zt&&e[a]}),n=se(i,function(a){return sg(r,{data:e,field:a,useCompleteDataForFormatter:!1})});return n},XRt=function(r,t,e){var i,n,a,o,s=(e||{}).isTotals,l=[],u=[];if(t){var c=(n=(i=r==null?void 0:r.dataSet)===null||i===void 0?void 0:i.fields)===null||n===void 0?void 0:n.columns,h=(o=(a=r==null?void 0:r.dataSet)===null||a===void 0?void 0:a.fields)===null||o===void 0?void 0:o.rows;l=fL(r,hh(c||[]),t),u=fL(r,h,t)}return at(l)&&at(u)&&s&&(l=[{value:Rr("总计")}]),{cols:l,rows:u}},YRt=function(r,t,e){if(t){var i=e.isTotals,n=t[Zt],a=t[n],o=[];if(i)o.push(sg(r,{data:t,field:n,valueField:Nt(t,$i)}));else if($Rt(a)&&r.getTooltipDataItemMappingCallback()){var s=y7(t,r.getTooltipDataItemMappingCallback());Ht(s,function(l,u){o.push(sg(r,{data:s,field:u}))})}else o.push(sg(r,{data:t,field:n}));return o}},jRt=function(r,t,e){var i;if(e)return Rr("总计");var n=(i=r==null?void 0:r.dataSet)===null||i===void 0?void 0:i.getFieldName(t);return n&&n!=="undefined"?n:""},dL=function(r,t,e){e===void 0&&(e=!0);var i=[];return Ht(t,function(n,a){Ht(r,function(o){!e&&o.colIndex!==-1?i.push([a,o.colIndex]):e&&o.rowIndex!==-1&&i.push([o.rowIndex,a])})}),i},ZRt=function(r,t){var e,i=t.rowLeafNodes,n=t.colLeafNodes,a=r.interaction.getState(),o=a.nodes,s=o===void 0?[]:o,l=a.cells,u=l===void 0?[]:l,c=(e=u==null?void 0:u[0])===null||e===void 0?void 0:e.type,h=s.filter(function(f){return f==null?void 0:f.isLeaf});return c===st.COL_CELL?dL(h,i,!1):c===st.ROW_CELL?dL(h,n):[]},qRt=function(r,t,e){var i,n=(i=r.facet)===null||i===void 0?void 0:i.layoutResult,a=function(l){var u=t==null?void 0:t.getMeta(),c=u==null?void 0:u.isTotals,h=(t==null?void 0:t.cellType)===st.COL_CELL,f=(t==null?void 0:t.cellType)===st.ROW_CELL;if(!h&&!f)return!1;var d=n.colNodes.find(function(g){return g.colIndex===l.colIndex}),v=n.rowNodes.find(function(g){return g.rowIndex===l.rowIndex}),p=h?v==null?void 0:v.isTotals:d==null?void 0:d.isTotals;return!c&&(l==null?void 0:l.isTotals)||c&&p};if(e){var o=ZRt(r,n);return ma(se(o,function(l){var u=tt(l,2),c=u[0],h=u[1],f=n.getCellMeta(c,h);if(!a(f))return(f==null?void 0:f.data)||vC(f)}))}var s=r.interaction.getCells();return s.filter(function(l){var u=n.getCellMeta(l.rowIndex,l.colIndex);return!a(u)}).map(function(l){var u=n.getCellMeta(l.rowIndex,l.colIndex);return(u==null?void 0:u.data)||vC(u)})},KRt=function(r){var t=r.spreadsheet,e=r.targetCell,i=r.options,n=i===void 0?{}:i,a=[],o={},s=t.isTableMode();if(s&&(n!=null&&n.showSingleTips)){var l=e.getMeta(),u=l!=null&&l.field?t.dataSet.getMultiData({field:l.field}):[t.dataSet.getRowData(l)];return[{selectedData:u,name:"",value:""}]}var c=qRt(t,e,n.showSingleTips);return Ht(c,function(h){var f;o[h==null?void 0:h[Zt]]?(f=o[h==null?void 0:h[Zt]])===null||f===void 0||f.push(h):o[h==null?void 0:h[Zt]]=[h]}),s6(o,function(h,f){var d,v=jRt(t,f,n==null?void 0:n.isTotals),p="",g="";if(Lm(h,function(C){return G7(Nt(C,$i))})){var m=t.options.placeholder,y=xu(o,m);p=y,g=y}else{var _=WA(t,f),x=X7(h,$i);g=x,p=(d=_==null?void 0:_(x,h))!==null&&d!==void 0?d:parseFloat(x.toPrecision(l4))}a.push({selectedData:h,name:v,value:p,originValue:g})}),a},QRt=function(r){if(r){var t=r.getMeta();if(!t.isTotals){var e=ci(t.spreadsheet.dataCfg.meta,{field:t.field||t.value||t.valueField}),i=e==null?void 0:e.field;return t.spreadsheet.dataSet.getFieldDescription(i)}}},JRt=function(r){var t=r.spreadsheet,e=r.cellInfos,i=e===void 0?[]:e,n=r.options,a=n===void 0?{}:n,o=r.targetCell,s=null,l=null,u=null,c=QRt(o),h=i[0]||{};if(!(a!=null&&a.hideSummary))s=KRt({spreadsheet:t,options:a,targetCell:o});else if(a.showSingleTips){var f=WA(t,h.valueField),d=f(h.value),v=a.enableFormat?t.dataSet.getFieldName(h.value)||d:t.dataSet.getFieldName(h.valueField);h.name=v||""}else l=XRt(t,h,a),u=YRt(t,h,a);var p=h||{},g=p.interpretation,m=p.infos,y=p.tips,_=p.name;return{summaries:s,interpretation:g,infos:m,tips:y,name:_,headInfo:l,details:u,description:c}},tMt=function(r){return se(r,function(t){var e=t.getMeta();return P4({},e.query||{},E6(e,["colIndex","rowIndex"]))})},VA=function(r){if(!r.interaction.isSelectedState())return[];var t=r.dataCfg.fields.valueInCols;return r.interaction.getCells().reduce(function(e,i){var n=r.facet.layoutResult.getCellMeta(i==null?void 0:i.rowIndex,i==null?void 0:i.colIndex),a=vC(n);if(at(n)||at(a))return[];var o=k(k({},a),{colIndex:t?n.colIndex:null,rowIndex:t?null:n.rowIndex}),s=e.find(function(l){return jr(o,l)});return s||e.push(o),e},[])},eMt=function(r,t){r===void 0&&(r={});var e=function(s){return Ba(r,s)},i=r.col,n=r.row,a=r.data,o=r.corner;return t===st.COL_CELL?e(i):t===st.ROW_CELL?e(n):t===st.DATA_CELL?e(a):t===st.CORNER_CELL?e(o):k({},r)},GA=function(r,t){var e;if(!(!t||!r)){var i=(e=r.getCellType)===null||e===void 0?void 0:e.call(r,t==null?void 0:t.target);return eMt(r.options.tooltip,i)}},Y7=function(r,t){var e=t.defaultMenus,i=e===void 0?[]:e,n=t.cell,a=function(s){return s===void 0&&(s=[]),s.filter(function(l){var u;return Zr(l.visible)?l.visible(n):(u=l.visible)!==null&&u!==void 0?u:!0}).map(function(l){return l.children&&(l.children=a(l.children)),l})},o=a(r.menus);return{onClick:r.onClick,menus:ma(ht(ht([],tt(i),!1),tt(o),!1))}},rMt=function(r,t){for(var e=!1,i=t;i&&i!==document.body;){if(r===i){e=!0;break}i=i.parentElement}return e},iMt=function(r){r.store.set(t0,ES)},nMt=function(r,t){var e=r.store.get(t0,ES);r.store.set(t0,k(k({},e),t))},aMt=function(r,t){var e=r.store.get(t0,ES);return e[t]},j7=function(){function r(t){var e=this;this.displayFormattedValueMap=new Map,this.getFieldMeta=mu(function(i,n){return ci(e.meta||n,function(a){return a.field===i})}),this.spreadsheet=t}return r.prototype.getFieldName=function(t){var e=Nt(this.getFieldMeta(t,this.meta),"name",t);return Ibt(e)},r.prototype.getFieldFormatter=function(t){return Nt(this.getFieldMeta(t,this.meta),"formatter",fi)},r.prototype.getFieldDescription=function(t){return Nt(this.getFieldMeta(t,this.meta),"description")},r.prototype.setDataCfg=function(t){this.getFieldMeta.cache.clear();var e=this.processDataCfg(t),i=e.fields,n=e.meta,a=e.data,o=e.totalData,s=e.sortParams,l=e.filterParams;this.fields=i,this.meta=n,this.originData=a,this.totalData=o,this.sortParams=s,this.filterParams=l,this.displayData=this.originData,this.indexesData={}},r.prototype.processMeta=function(t,e){var i,n;return t===void 0&&(t=[]),ht(ht([],tt(t),!1),[l2t(t,(n=(i=this.spreadsheet)===null||i===void 0?void 0:i.options)===null||n===void 0?void 0:n.cornerExtraFieldText,e)],!1)},r.prototype.getDisplayDataSet=function(){return this.displayData||[]},r.prototype.isEmpty=function(){return at(this.getDisplayDataSet())},r.prototype.getEmptyViewIndexes=function(){return[]},r.prototype.getValueRangeByField=function(t){var e,i=aMt(this.spreadsheet,t);if(i)return i;var n=ma(se(this.originData,function(o){var s=o[t];return wr(s)?null:Number.parseFloat(s)})),a={maxValue:Nc(n),minValue:lA(n)};return nMt(this.spreadsheet,(e={},e[t]=a,e)),a},r.prototype.moreThanOneValue=function(){var t,e;return((e=(t=this.fields)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.length)>1},r}(),pC=function(){function r(t){this.extraField=t}return r.createProxyData=function(t,e){return new Proxy(t,new r(e))},r.createProxyDataList=function(t,e){return e.map(function(i){return r.createProxyData(t,i)})},r.prototype.get=function(t,e){return e===xS?t:e===Zt?this.extraField:e===$i?t[this.extraField]:t[e]},r.prototype.has=function(t,e){return e===Zt||e===$i?!0:e in t},r.prototype.ownKeys=function(t){return Object.keys(t).concat(Zt,$i)},r.prototype.getOwnPropertyDescriptor=function(t,e){return e===Zt||e===$i?{configurable:!0,enumerable:!0}:Object.getOwnPropertyDescriptor(t,e)},r}(),gC=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.handleDimensionValuesSort=function(){Ht(e.sortParams,function(i){var n=i.sortFieldId,a=i.sortByMeasure;if(n){var o=ht([],tt(e.sortedDimensionValues[n]||[]),!1),s=Cwt({dataSet:e,sortParam:i,originValues:o,isSortByMeasure:!at(a)});e.sortedDimensionValues[n]=s,e.handlePivotMetaSort(n,s)}})},e.getTotalStatus=function(i){var n=e.fields,a=n.columns,o=n.rows,s=function(u,c){if(c){var h=ci(u,function(f){return!Vx(i,f)});return h&&h!==tu(u)}return Lm(u,function(f){return!Vx(i,f)})},l=function(u,c){return c?u.filter(function(h){return h!==Zt}):u};return{isRowTotal:s(l(o,!e.spreadsheet.isValueInCols())),isRowSubTotal:s(o,!0),isColTotal:s(l(a,e.spreadsheet.isValueInCols())),isColSubTotal:s(a,!0)}},e}return t.prototype.getExistValuesByDataItem=function(e,i){return c7(e,i)},t.prototype.setDataCfg=function(e){r.prototype.setDataCfg.call(this,e);var i=this.fields.rows;this.sortedDimensionValues={},this.rowPivotMeta=new Map,this.colPivotMeta=new Map,this.dimensionValuesCache=new Map,this.transformIndexesData(this.originData.concat(this.totalData),i),this.handleDimensionValuesSort()},t.prototype.transformIndexesData=function(e,i){var n=this,a=this.fields,o=a.columns,s=a.values,l=a.valueInCols,u;return Ha.getInstance().debugCallback(jTt,function(){u=s2t({rows:i,columns:o,values:s,valueInCols:l,data:e,indexesData:n.indexesData,sortedDimensionValues:n.sortedDimensionValues,rowPivotMeta:n.rowPivotMeta,colPivotMeta:n.colPivotMeta,getExistValuesByDataItem:n.getExistValuesByDataItem}),n.indexesData=u.indexesData,n.rowPivotMeta=u.rowPivotMeta,n.colPivotMeta=u.colPivotMeta,n.sortedDimensionValues=u.sortedDimensionValues}),u},t.prototype.transformDrillDownData=function(e,i,n){var a=this,o,s=Gr.getFieldPath(n,!0),l=ht(ht([],tt(s),!1),[e],!1),u=this.spreadsheet.store,c=n==null?void 0:n.id,h=(o=u.get("drillDownIdPathMap"))!==null&&o!==void 0?o:new Map;h.has(c)&&(Ht(h.get(c),function(d){Qx(a.indexesData,d)}),jI(this.rowPivotMeta,c));var f=this.transformIndexesData(i,l).paths;h.set(c,f),u.set("drillDownIdPathMap",h)},t.prototype.clearDrillDownData=function(e){var i=this,n=this.spreadsheet.store,a=n.get("drillDownIdPathMap");if(!a)return!1;var o=n.get("drillDownDataCache",[]);if(e){var s=a.get(e);s&&Ht(s,function(d){Qx(i.indexesData,d)}),jI(this.rowPivotMeta,e),a.delete(e);var l=qo(o,function(d){return a.has(d==null?void 0:d.rowId)});n.set("drillDownDataCache",l);var u=l.map(function(d){return d==null?void 0:d.drillLevel}),c=n.get("drillDownFieldInLevel",[]),h=c.filter(function(d){return Ei(u,d==null?void 0:d.drillLevel)});n.set("drillDownFieldInLevel",h)}else{a.clear();var f=this.spreadsheet.store.get("originalDataCfg");at(f)||this.spreadsheet.setDataCfg(f),this.spreadsheet.store.set("drillItemsNum",-1),this.spreadsheet.store.set("drillDownDataCache",[]),this.spreadsheet.store.set("drillDownFieldInLevel",[])}return n.set("drillDownIdPathMap",a),!0},t.prototype.handlePivotMetaSort=function(e,i){var n=this.fields,a=n.rows,o=n.columns;Ei(a,e)?this.rowPivotMeta=nL({pivotMeta:this.rowPivotMeta,dimensions:a,sortFieldId:e,sortedDimensionValues:i}):Ei(o,e)&&(this.colPivotMeta=nL({pivotMeta:this.colPivotMeta,dimensions:o,sortFieldId:e,sortedDimensionValues:i}))},t.prototype.processDataCfg=function(e){var i=e.data,n=e.meta,a=n===void 0?[]:n,o=e.fields,s=e.sortParams,l=s===void 0?[]:s,u=e.totalData,c=o.columns,h=o.rows,f=o.values,d=o.valueInCols,v=o.customValueOrder,p=c,g=h;d?p=this.isCustomMeasuresPosition(v)?this.handleCustomMeasuresOrder(v,p):So(ht(ht([],tt(c),!1),[Zt],!1)):g=this.isCustomMeasuresPosition(v)?this.handleCustomMeasuresOrder(v,g):So(ht(ht([],tt(h),!1),[Zt],!1));var m=this.processMeta(a,Rr("数值"));return{data:i,totalData:u,meta:m,fields:k(k({},o),{rows:g,columns:p,values:f}),sortParams:l}},t.prototype.getFieldsAndPivotMetaByField=function(e){var i=this.fields||{},n=i.rows,a=n===void 0?[]:n,o=i.columns,s=o===void 0?[]:o;return a.includes(e)?{dimensions:a,pivotMeta:this.rowPivotMeta}:s.includes(e)?{dimensions:s,pivotMeta:this.colPivotMeta}:{}},t.prototype.getDimensionValues=function(e,i){i===void 0&&(i={});var n=this.getFieldsAndPivotMetaByField(e),a=n.pivotMeta,o=n.dimensions;if(!a||!o)return[];var s=at(i);if(this.dimensionValuesCache.has(e)&&s)return this.dimensionValuesCache.get(e);var l=ml(i,o,eg),u=h7({pivotMeta:a,dimensionValues:l,fields:o,fieldIdx:Bm(o,e),queryType:Dn.DetailOnly,sortedDimensionValues:this.sortedDimensionValues}),c=So(u.map(function(h){return h.value}));return s&&this.dimensionValuesCache.set(e,c),c},t.prototype.getTotalValue=function(e,i){var n,a=this.spreadsheet.options,o=R6(i),s=o?i:this.getTotalStatus(e),l=a2t(s,a==null?void 0:a.totals)||{},u=l.aggregation,c=l.calcFunc,h=at(a==null?void 0:a.totals)&&!this.spreadsheet.isHierarchyTreeType()?Al.SUM:"",f=HRt[u||h];if(f||c){var d=this.getMultiData(e,{queryType:Dn.DetailOnly}),v=void 0;return c?v=c(e,d,this.spreadsheet):f&&(v=f(d,$i)),k(k({},e),(n={},n[$i]=v,n[e[Zt]]=v,n))}},t.prototype.getCellData=function(e){var i,n,a,o=e||{},s=o.query,l=s===void 0?{}:s,u=o.rowNode,c=o.isTotals,h=c===void 0?!1:c,f=o.totalStatus,d=this.fields,v=d.rows,p=d.columns,g=v,m=(i=this.spreadsheet)===null||i===void 0?void 0:i.store.get("drillDownIdPathMap"),y=Array.from((n=m==null?void 0:m.keys())!==null&&n!==void 0?n:[]).some(function(T){return u==null?void 0:u.id.startsWith(T)});u&&y&&(g=(a=Gr.getFieldPath(u,y))!==null&&a!==void 0?a:v);var _=ml(l,g),x=ml(l,p),C=p0({rowDimensionValues:_,colDimensionValues:x,rowPivotMeta:this.rowPivotMeta,colPivotMeta:this.colPivotMeta,rowFields:g,colFields:p,prefix:v0(g,p)}),A=Nt(this.indexesData,C);if(A)return pC.createProxyData(A,l[Zt]);if(h)return this.getTotalValue(l,f)},t.prototype.getQueryExtraFields=function(e){var i=this.fields.values,n=e[Zt];return n?Ei(i,n)?[n]:[]:i},t.prototype.getMultiData=function(e,i,n,a,o){var s,l,u,c;e===void 0&&(e={}),a===void 0&&(a=[]),o===void 0&&(o=!0),at(e)&&console.warn("query: ".concat(e,` shouldn't be empty, you can get all data from dataCfg if you're intended.
 you should use { EXTRA_FIELD: xxx} as least if you want query all specific value data`));var h=Oe(i)?i:{queryType:o?Dn.All:Dn.DetailOnly,drillDownFields:a},f=h.drillDownFields,d=f===void 0?[]:f,v=h.queryType,p=v===void 0?Dn.All:v,g=this.fields,m=g.rows,y=g.columns,_=at(d)?m:m.concat(d),x=ml(e,_,eg),C=ml(e,y,eg),A=c2t({rowDimensionValues:x,colDimensionValues:C,rowPivotMeta:this.rowPivotMeta,colPivotMeta:this.colPivotMeta,rowFields:_,colFields:y,sortedDimensionValues:this.sortedDimensionValues,queryType:p}),T=A.rowQueries,w=A.colQueries,M=v0(_,y),O=[];try{for(var P=Vn(T),D=P.next();!D.done;D=P.next()){var z=D.value;try{for(var Y=(u=void 0,Vn(w)),H=Y.next();!H.done;H=Y.next()){for(var N=H.value,W=p0({rowDimensionValues:z,colDimensionValues:N,rowPivotMeta:this.rowPivotMeta,colPivotMeta:this.colPivotMeta,rowFields:_,colFields:y,prefix:M}),Q=!1,q=this.indexesData,J=function(ct){var dt=W[ct];Q?hd(dt)?q=h2t(q,p):q=ma(se(q,function(Rt){return Rt==null?void 0:Rt[dt]})):hd(dt)?(Q=!0,q=ma([q]),ct--):q=q==null?void 0:q[dt],et=ct},et,ft=0;ft<W.length;ft++)J(ft),ft=et;It(q)?O.push.apply(O,ht([],tt(q),!1)):q&&O.push(q)}}catch(ct){u={error:ct}}finally{try{H&&!H.done&&(c=Y.return)&&c.call(Y)}finally{if(u)throw u.error}}}}catch(ct){s={error:ct}}finally{try{D&&!D.done&&(l=P.return)&&l.call(P)}finally{if(s)throw s.error}}var Ct=this.getQueryExtraFields(e);return Jd(So(O),function(ct){return ct?pC.createProxyDataList(ct,Ct):[]})},t.prototype.getFieldFormatter=function(e,i){return e===Ka?this.getFieldFormatterForTotalValue(i):r.prototype.getFieldFormatter.call(this,e)},t.prototype.getFieldFormatterForTotalValue=function(e){var i;return!this.spreadsheet.isValueInCols()&&e&&(i=Nt(e.rowQuery,Zt)),i=i??Nt(this.fields.values,0),r.prototype.getFieldFormatter.call(this,i)},t.prototype.handleCustomMeasuresOrder=function(e,i){var n=So(ht([],tt(i),!1));return i.length>=e?(n.splice(e,0,Zt),n):ht(ht([],tt(n),!1),[Zt],!1)},t.prototype.isCustomMeasuresPosition=function(e){return yi(e)},t.prototype.getRowData=function(e){return this.getMultiData(e.rowQuery)},t}(j7),oMt=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getCellData=function(e){var i=e.query,n=this.fields,a=n.rows,o=n.columns,s=ml(i,a),l=ml(i,o),u=p0({rowDimensionValues:s,colDimensionValues:l,rowPivotMeta:this.rowPivotMeta,colPivotMeta:this.colPivotMeta,rowFields:a,colFields:o,prefix:v0(a,o)}),c=Nt(this.indexesData,u);return c&&pC.createProxyData(c,i[Zt])},t.prototype.processDataCfg=function(e){var i=e.meta,n=this.processMeta(i,Rr("指标"));return k(k({},e),{meta:n,fields:k(k({},e.fields),{rows:[Zt],valueInCols:!1})})},t}(gC),sMt=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.handleDimensionValueFilter=function(){Ht(e.filterParams,function(i){var n=i.filterKey,a=i.filteredValues,o=i.customFilter,s=new Set(a),l=function(c){return!s.has(c[n])},u=qo(e.displayData,function(c){return o?o(c)&&l(c):l(c)});e.displayData=e.getDisplayData(u)})},e.handleDimensionValuesSort=function(){Ht(e.sortParams,function(i){var n,a=i.sortFieldId,o=i.sortBy,s=i.sortFunc,l=i.sortMethod,u=i.query;if(a){var c=e.displayData,h=[];if(u){var f=[];c.forEach(function(y){for(var _=Object.keys(u),x=!0,C=0;C<_.length;C++){var A=_[C];if(y[A]!==u[A]){x=!1,h.push(y);break}}x&&f.push(y)}),c=f}var d=c;if(s)d=s(k(k({},i),{data:c}));else if(o&&!Zr(o)){var v=ht([],tt(o),!1).reverse();d=c.sort(function(y,_){var x=v.indexOf(y[a]),C=v.indexOf(_[a]);return C-x})}else if(fh(l)||kA(l)){var p=xu(e.spreadsheet,(n=e.spreadsheet.options)===null||n===void 0?void 0:n.placeholder),g=Zr(o)?o:null,m=function(y){return y[a]===p?Number.MIN_VALUE:y[a]};d=fA(c,[g||m],[l.toLocaleLowerCase()])}h.length&&(d=ht(ht([],tt(d),!1),tt(h),!1)),e.displayData=e.getDisplayData(d)}})},e}return t.prototype.processDataCfg=function(e){return e},t.prototype.setDataCfg=function(e){r.prototype.setDataCfg.call(this,e),this.handleDimensionValueFilter(),this.handleDimensionValuesSort()},t.prototype.getStartFrozenRows=function(e){var i=(this.spreadsheet.options||{}).frozenRowCount;return i?e.slice(0,i):[]},t.prototype.getEndFrozenRows=function(e){var i=(this.spreadsheet.options||{}).frozenTrailingRowCount;return i?e.slice(-i):[]},t.prototype.getDisplayData=function(e){var i=this.getStartFrozenRows(e),n=this.getEndFrozenRows(e),a=e.slice(i.length||0,-n.length||void 0);return ht(ht(ht([],tt(i),!1),tt(a),!1),tt(n),!1)},t.prototype.getDimensionValues=function(){return[]},t.prototype.getCellData=function(e){var i=e.query;if(!(this.displayData.length===0&&i.rowIndex===0)){var n=this.displayData[i.rowIndex];return!Jl(i,"field")||!Oe(n)?n:n[i.field]}},t.prototype.getMultiData=function(e){if(!e)return this.displayData;var i=this.displayData[e.rowIndex]?[this.displayData[e.rowIndex]]:this.displayData;return Jl(e,"field")?i.map(function(n){return n[e.field]}):i},t.prototype.getRowData=function(e){return this.getCellData({query:{rowIndex:e.rowIndex}})},t}(j7);function XA(r,t,e){r.prototype=t.prototype=e,e.constructor=r}function Z7(r,t){var e=Object.create(r.prototype);for(var i in t)e[i]=t[i];return e}function uv(){}var gd=.7,C0=1/gd,dc="\\s*([+-]?\\d+)\\s*",md="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ja="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",lMt=/^#([0-9a-f]{3,8})$/,uMt=new RegExp("^rgb\\("+[dc,dc,dc]+"\\)$"),cMt=new RegExp("^rgb\\("+[ja,ja,ja]+"\\)$"),hMt=new RegExp("^rgba\\("+[dc,dc,dc,md]+"\\)$"),fMt=new RegExp("^rgba\\("+[ja,ja,ja,md]+"\\)$"),dMt=new RegExp("^hsl\\("+[md,ja,ja]+"\\)$"),vMt=new RegExp("^hsla\\("+[md,ja,ja,md]+"\\)$"),vL={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};XA(uv,yd,{copy:function(r){return Object.assign(new this.constructor,this,r)},displayable:function(){return this.rgb().displayable()},hex:pL,formatHex:pL,formatHsl:pMt,formatRgb:gL,toString:gL});function pL(){return this.rgb().formatHex()}function pMt(){return q7(this).formatHsl()}function gL(){return this.rgb().formatRgb()}function yd(r){var t,e;return r=(r+"").trim().toLowerCase(),(t=lMt.exec(r))?(e=t[1].length,t=parseInt(t[1],16),e===6?mL(t):e===3?new ln(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?xp(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?xp(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=uMt.exec(r))?new ln(t[1],t[2],t[3],1):(t=cMt.exec(r))?new ln(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=hMt.exec(r))?xp(t[1],t[2],t[3],t[4]):(t=fMt.exec(r))?xp(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=dMt.exec(r))?xL(t[1],t[2]/100,t[3]/100,1):(t=vMt.exec(r))?xL(t[1],t[2]/100,t[3]/100,t[4]):vL.hasOwnProperty(r)?mL(vL[r]):r==="transparent"?new ln(NaN,NaN,NaN,0):null}function mL(r){return new ln(r>>16&255,r>>8&255,r&255,1)}function xp(r,t,e,i){return i<=0&&(r=t=e=NaN),new ln(r,t,e,i)}function gMt(r){return r instanceof uv||(r=yd(r)),r?(r=r.rgb(),new ln(r.r,r.g,r.b,r.opacity)):new ln}function mC(r,t,e,i){return arguments.length===1?gMt(r):new ln(r,t,e,i??1)}function ln(r,t,e,i){this.r=+r,this.g=+t,this.b=+e,this.opacity=+i}XA(ln,mC,Z7(uv,{brighter:function(r){return r=r==null?C0:Math.pow(C0,r),new ln(this.r*r,this.g*r,this.b*r,this.opacity)},darker:function(r){return r=r==null?gd:Math.pow(gd,r),new ln(this.r*r,this.g*r,this.b*r,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:yL,formatHex:yL,formatRgb:_L,toString:_L}));function yL(){return"#"+w_(this.r)+w_(this.g)+w_(this.b)}function _L(){var r=this.opacity;return r=isNaN(r)?1:Math.max(0,Math.min(1,r)),(r===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(r===1?")":", "+r+")")}function w_(r){return r=Math.max(0,Math.min(255,Math.round(r)||0)),(r<16?"0":"")+r.toString(16)}function xL(r,t,e,i){return i<=0?r=t=e=NaN:e<=0||e>=1?r=t=NaN:t<=0&&(r=NaN),new ka(r,t,e,i)}function q7(r){if(r instanceof ka)return new ka(r.h,r.s,r.l,r.opacity);if(r instanceof uv||(r=yd(r)),!r)return new ka;if(r instanceof ka)return r;r=r.rgb();var t=r.r/255,e=r.g/255,i=r.b/255,n=Math.min(t,e,i),a=Math.max(t,e,i),o=NaN,s=a-n,l=(a+n)/2;return s?(t===a?o=(e-i)/s+(e<i)*6:e===a?o=(i-t)/s+2:o=(t-e)/s+4,s/=l<.5?a+n:2-a-n,o*=60):s=l>0&&l<1?0:o,new ka(o,s,l,r.opacity)}function mMt(r,t,e,i){return arguments.length===1?q7(r):new ka(r,t,e,i??1)}function ka(r,t,e,i){this.h=+r,this.s=+t,this.l=+e,this.opacity=+i}XA(ka,mMt,Z7(uv,{brighter:function(r){return r=r==null?C0:Math.pow(C0,r),new ka(this.h,this.s,this.l*r,this.opacity)},darker:function(r){return r=r==null?gd:Math.pow(gd,r),new ka(this.h,this.s,this.l*r,this.opacity)},rgb:function(){var r=this.h%360+(this.h<0)*360,t=isNaN(r)||isNaN(this.s)?0:this.s,e=this.l,i=e+(e<.5?e:1-e)*t,n=2*e-i;return new ln(R_(r>=240?r-240:r+120,n,i),R_(r,n,i),R_(r<120?r+240:r-120,n,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var r=this.opacity;return r=isNaN(r)?1:Math.max(0,Math.min(1,r)),(r===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(r===1?")":", "+r+")")}}));function R_(r,t,e){return(r<60?t+(e-t)*r/60:r<180?e:r<240?t+(e-t)*(240-r)/60:t)*255}function YA(r){return function(){return r}}function yMt(r,t){return function(e){return r+e*t}}function _Mt(r,t,e){return r=Math.pow(r,e),t=Math.pow(t,e)-r,e=1/e,function(i){return Math.pow(r+i*t,e)}}function xMt(r){return(r=+r)==1?K7:function(t,e){return e-t?_Mt(t,e,r):YA(isNaN(t)?e:t)}}function K7(r,t){var e=t-r;return e?yMt(r,e):YA(isNaN(r)?t:r)}var CL=function r(t){var e=xMt(t);function i(n,a){var o=e((n=mC(n)).r,(a=mC(a)).r),s=e(n.g,a.g),l=e(n.b,a.b),u=K7(n.opacity,a.opacity);return function(c){return n.r=o(c),n.g=s(c),n.b=l(c),n.opacity=u(c),n+""}}return i.gamma=r,i}(1);function Q7(r,t){t||(t=[]);var e=r?Math.min(t.length,r.length):0,i=t.slice(),n;return function(a){for(n=0;n<e;++n)i[n]=r[n]*(1-a)+t[n]*a;return i}}function J7(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function CMt(r,t){return(J7(t)?Q7:t8)(r,t)}function t8(r,t){var e=t?t.length:0,i=r?Math.min(e,r.length):0,n=new Array(i),a=new Array(e),o;for(o=0;o<i;++o)n[o]=e8(r[o],t[o]);for(;o<e;++o)a[o]=t[o];return function(s){for(o=0;o<i;++o)a[o]=n[o](s);return a}}function EMt(r,t){var e=new Date;return r=+r,t=+t,function(i){return e.setTime(r*(1-i)+t*i),e}}function yC(r,t){return r=+r,t=+t,function(e){return r*(1-e)+t*e}}function SMt(r,t){var e={},i={},n;(r===null||typeof r!="object")&&(r={}),(t===null||typeof t!="object")&&(t={});for(n in t)n in r?e[n]=e8(r[n],t[n]):i[n]=t[n];return function(a){for(n in e)i[n]=e[n](a);return i}}var _C=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,M_=new RegExp(_C.source,"g");function AMt(r){return function(){return r}}function TMt(r){return function(t){return r(t)+""}}function bMt(r,t){var e=_C.lastIndex=M_.lastIndex=0,i,n,a,o=-1,s=[],l=[];for(r=r+"",t=t+"";(i=_C.exec(r))&&(n=M_.exec(t));)(a=n.index)>e&&(a=t.slice(e,a),s[o]?s[o]+=a:s[++o]=a),(i=i[0])===(n=n[0])?s[o]?s[o]+=n:s[++o]=n:(s[++o]=null,l.push({i:o,x:yC(i,n)})),e=M_.lastIndex;return e<t.length&&(a=t.slice(e),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?TMt(l[0].x):AMt(t):(t=l.length,function(u){for(var c=0,h;c<t;++c)s[(h=l[c]).i]=h.x(u);return s.join("")})}function e8(r,t){var e=typeof t,i;return t==null||e==="boolean"?YA(t):(e==="number"?yC:e==="string"?(i=yd(t))?(t=i,CL):bMt:t instanceof yd?CL:t instanceof Date?EMt:J7(t)?Q7:Array.isArray(t)?t8:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?SMt:yC)(r,t)}var Dl;(function(r){r.ScrollChange="scroll-change",r.ScrollEnd="scroll-end"})(Dl||(Dl={}));var I_=function(r){gt(t,r);function t(e){var i=r.call(this,e)||this;i.isMobile=!1,i.eventHandlers=[],i.scrollFrameId=null,i.getCoordinatesName=function(){var d=i.isHorizontal?"x1":"y1",v=i.isHorizontal?"x2":"y2";return{from:d,to:v}},i.getCoordinatesWithBBoxExtraPadding=function(){var d=i.theme.size,v=i.isHorizontal?0:d/2,p=i.isHorizontal?d:d/2;return{start:i.thumbOffset+v,end:i.thumbOffset+i.thumbLen-p}},i.current=function(){var d=i.thumbLen/i.trackLen,v=i.thumbOffset/i.trackLen;return v/(1-d)},i.updateThumbLen=function(d){if(i.thumbLen!==d){i.thumbLen=d;var v=i.getCoordinatesName();i.thumbShape.attr(v.to,i.thumbOffset+d),i.emitScrollChange(i.thumbOffset/(i.trackLen-i.thumbLen)*i.scrollTargetMaxOffset,!1)}},i.updateThumbOffset=function(d,v){var p;v===void 0&&(v=!0);var g=i.validateRange(d),m=i.thumbOffset===g&&g!==0;if(!m){i.thumbOffset=g;var y=i.getCoordinatesName(),_=y.from,x=y.to,C=i.getCoordinatesWithBBoxExtraPadding(),A=C.start,T=C.end;i.thumbShape.attr((p={},p[_]=A,p[x]=T,p)),v&&i.emitScrollChange(g/(i.trackLen-i.thumbLen)*i.scrollTargetMaxOffset,!1)}},i.onlyUpdateThumbOffset=function(d){var v;i.updateThumbOffset(d,!1),(v=i.get("canvas"))===null||v===void 0||v.draw()},i.emitScrollChange=function(d,v){v===void 0&&(v=!0),cancelAnimationFrame(i.scrollFrameId),i.scrollFrameId=requestAnimationFrame(function(){i.emit(Dl.ScrollChange,{offset:d,updateThumbOffset:v})})},i.addEventListener=function(d,v,p){return d==null||d.addEventListener(v,p,!1),{remove:function(){d==null||d.removeEventListener(v,p,!1)}}},i.addEvent=function(d,v,p){d.on(v,p),i.eventHandlers.push({target:d,type:v,handler:p})},i.initScrollBar=function(){i.scrollBarGroup=i.createScrollBarGroup(),i.scrollBarGroup.move(i.position.x,i.position.y),i.bindEvents()},i.createScrollBarGroup=function(){var d=i.addGroup({className:i.isHorizontal?"horizontalBar":"verticalBar"});return i.trackShape=i.createTrackShape(d),i.thumbShape=i.createThumbShape(d),d},i.createTrackShape=function(d){var v=i.theme,p=v.lineCap,g=p===void 0?"round":p,m=v.trackColor,y=v.size,_={lineWidth:y,stroke:m,lineCap:g};return i.isHorizontal?d.addShape("line",{attrs:k(k({},_),{x1:0,y1:y/2,x2:i.trackLen,y2:y/2})}):d.addShape("line",{attrs:k(k({},_),{x1:y/2,y1:0,x2:y/2,y2:i.trackLen})})},i.createThumbShape=function(d){var v=i.theme,p=v.size,g=v.lineCap,m=g===void 0?"round":g,y=v.thumbColor,_={lineWidth:p,stroke:y,lineCap:m,cursor:"default"},x=i.getCoordinatesWithBBoxExtraPadding(),C=x.start,A=x.end;return i.isHorizontal?d.addShape("line",{attrs:k(k({},_),{x1:C,y1:p/2,x2:A,y2:p/2})}):d.addShape("line",{attrs:k(k({},_),{x1:p/2,y1:C,x2:p/2,y2:A})})},i.bindEvents=function(){i.on("mousedown",i.onStartEvent(!1)),i.on("mouseup",i.onMouseUp),i.on("touchstart",i.onStartEvent(!0)),i.on("touchend",i.onMouseUp),i.trackShape.on("click",i.onTrackClick),i.thumbShape.on("mouseover",i.onTrackMouseOver),i.thumbShape.on("mouseout",i.onTrackMouseOut)},i.onStartEvent=function(d){return function(v){v.preventDefault(),i.isMobile=d;var p=i.isMobile?Nt(v,"touches.0",v):v,g=p.clientX,m=p.clientY;i.startPos=i.isHorizontal?g:m,i.bindLaterEvent()}},i.bindLaterEvent=function(){var d=i.get("canvas"),v=document.body,p=[];i.isMobile?(p=[i.addEventListener(v,"touchmove",i.onMouseMove),i.addEventListener(v,"touchend",i.onMouseUp),i.addEventListener(v,"touchcancel",i.onMouseUp)],i.addEvent(d,"touchend",i.onMouseUp),i.addEvent(d,"touchcancel",i.onMouseUp)):(p=[i.addEventListener(v,"mousemove",i.onMouseMove),i.addEventListener(v,"mouseup",i.onMouseUp),i.addEventListener(v,"mouseleave",i.onMouseUp)],i.addEvent(d,"mouseup",i.onMouseUp)),i.clearEvents=function(){p.forEach(function(g){g==null||g.remove()}),Ht(i.eventHandlers,function(g){var m;(m=g.target)===null||m===void 0||m.off(g.type,g.handler)}),i.eventHandlers.length=0}},i.onTrackClick=function(d){var v=i.isHorizontal?d.x-i.position.x-i.thumbLen/2:d.y-i.position.y-i.thumbLen/2,p=i.validateRange(v);i.updateThumbOffset(p)},i.onMouseMove=function(d){d.preventDefault();var v=i.isMobile?Nt(d,"touches.0",d):d,p=v.clientX,g=v.clientY,m=i.isHorizontal?p:g,y=m-i.startPos;i.startPos=m,i.updateThumbOffset(i.thumbOffset+y)},i.onMouseUp=function(d){var v;i.emit(Dl.ScrollEnd,{}),d.preventDefault(),(v=i.clearEvents)===null||v===void 0||v.call(i)},i.onTrackMouseOver=function(){var d=i.theme,v=d.thumbHoverColor,p=d.hoverSize;i.thumbShape.attr("stroke",v),i.thumbShape.attr("lineWidth",p)},i.onTrackMouseOut=function(){var d=i.theme,v=d.thumbColor,p=d.size;i.thumbShape.attr("stroke",v),i.thumbShape.attr("lineWidth",p)},i.validateRange=function(d){var v=d;return d+i.thumbLen>i.trackLen?v=i.trackLen-i.thumbLen:d+i.thumbLen<i.thumbLen&&(v=0),v};var n=e.isHorizontal,a=n===void 0?!1:n,o=e.trackLen,s=e.thumbLen,l=e.position,u=e.thumbOffset,c=u===void 0?0:u,h=e.theme,f=e.scrollTargetMaxOffset;return i.isHorizontal=a,i.thumbOffset=c,i.trackLen=o,i.thumbLen=s,i.position=l,i.theme=h,i.scrollTargetMaxOffset=f,i.initScrollBar(),i}return t}(no),r8=function(r,t,e){if(e<=0)return{start:0,end:0};var i=Dc(r,function(a,o){var s=t;return s>=a&&s<r[o+1]},0);i=Math.max(i,0);var n=e===t?i:Dc(r,function(a,o){var s=e;return s>a&&s<=r[o+1]},i);return n=Math.min(n===-1?1/0:n,r.length-2),{start:i,end:n}},wMt=function(r,t){var e=t.width,i=t.originalWidth,n=Math.min(i-e,r);return n<0?0:n},L_=function(r,t,e){var i=Math.min(t-e,r);return i<0?0:i},Mf=function(r,t){if(r===void 0&&(r=[]),at(r))return[];var e=[];return r.forEach(function(i){if(i instanceof t&&e.push(i),i instanceof no){var n=i.getChildren();n.forEach(function(a){a instanceof t&&e.push(a)})}}),e},i8=function(r,t,e){return e.slice(r,t+1).map(function(i){return i.x+i.width})},Qm=function(r,t,e){for(var i=[],n=r;n<t+1;n++)i.push(e.getCellOffsetY(n+1));return i},RMt=function(r,t,e,i){var n=Qm(r,t,i),a=i.getCellOffsetY(r);return n.map(function(o){return o-a+e})},EL=function(r,t,e){var i=tt(e,4),n=i[0],a=i[1],o=i[2],s=i[3];return r>=n&&r<=a&&t>=o&&t<=s},SL=function(r){for(var t=tt(r,4),e=t[0],i=t[1],n=t[2],a=t[3],o=[],s=e;s<=i;s+=1)for(var l=n;l<=a;l+=1)o.push([s,l]);return o},MMt=function(r,t){var e=[],i=[];if(at(r))return at(t)?{add:e,remove:i}:{add:SL(t),remove:i};if(at(t))return{add:e,remove:SL(r)};for(var n=tt(r,4),a=n[0],o=n[1],s=n[2],l=n[3],u=tt(t,4),c=u[0],h=u[1],f=u[2],d=u[3],v=a;v<=o;v++)for(var p=s;p<=l;p++)EL(v,p,t)||i.push([v,p]);for(var v=c;v<=h;v+=1)for(var p=f;p<=d;p+=1)EL(v,p,r)||e.push([v,p]);return{add:e,remove:i}},IMt=function(r,t){var e=[],i=[];return Object.keys(t).forEach(function(n){var a=MMt((r==null?void 0:r[n])||[],t[n]),o=a.add,s=a.remove;e.push.apply(e,ht([],tt(o),!1)),i.push.apply(i,ht([],tt(s),!1))}),{add:e,remove:i}},n8=function(){function r(t,e){e===void 0&&(e=!1),this.x=0,this.y=0,this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.width=0,this.height=0,this.originalWidth=0,this.originalHeight=0,this.viewportHeight=0,this.viewportWidth=0,this.facet=t,this.spreadsheet=t.spreadsheet,this.layoutResult=t.layoutResult,e&&this.calculateBBox()}return r}(),a8=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.calculateBBox=function(){var e=this.getCornerBBoxWidth(),i=this.getCornerBBoxHeight();this.width=e,this.height=i,this.maxX=e,this.maxY=i},t.prototype.getCornerBBoxOriginalHeight=function(){var e=this.layoutResult.colsHierarchy,i=this.spreadsheet.options.style.colCfg;return e.sampleNodeForLastLevel?Math.floor(e.height):i==null?void 0:i.height},t.prototype.getCornerBBoxHeight=function(){return this.originalHeight=this.getCornerBBoxOriginalHeight(),this.originalHeight},t.prototype.getCornerBBoxWidth=function(){var e=this.layoutResult.rowsHierarchy;return this.originalWidth=Math.floor(e.width+this.facet.getSeriesNumberWidth()),this.spreadsheet.isScrollContainsRowHeader()?this.originalWidth:this.adjustCornerBBoxWidth()},t.prototype.adjustCornerBBoxWidth=function(){var e=this.layoutResult.colsHierarchy,i=this.spreadsheet.options.width,n=i*$ct,a=e==null?void 0:e.width,o=i-this.originalWidth;if(this.originalWidth<=n||a<=o)return this.originalWidth;var s=0,l=i-n;return a<=l?s=this.originalWidth-(a-o):s=n,Math.floor(s)},t}(n8),LMt=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.calculateBBox=function(){this.originalWidth=this.facet.getRealWidth(),this.originalHeight=this.facet.getRealHeight();var e=this.facet.cornerBBox,i={x:Math.floor(e.maxX),y:Math.floor(e.maxY)},n=this.spreadsheet.theme.scrollBar.size,a=this.spreadsheet.options,o=a.width,s=a.height,l=Math.max(0,o-i.x),u=Math.max(0,s-i.y-n);this.x=i.x,this.y=i.y,this.width=l,this.height=u,this.viewportHeight=Math.abs(Math.floor(Math.min(u,this.originalHeight))),this.viewportWidth=Math.abs(Math.floor(Math.min(l,this.originalWidth))),this.maxX=i.x+this.viewportWidth,this.maxY=i.y+this.viewportHeight,this.minX=i.x,this.minY=i.y;var c=this.spreadsheet.options,h=c.frozenTrailingColCount,f=c.frozenTrailingRowCount;h>0&&(this.viewportWidth=this.width,this.maxX=i.x+this.width),f>0&&(this.viewportHeight=this.height,this.maxY=i.y+this.height)},t}(n8),jA=function(r){gt(t,r);function t(e){var i=r.call(this,e)||this;return i.isHeaderCellInViewport=function(n,a,o,s){return n+a>=o&&o+s>=n},i.headerConfig=e,i}return t.prototype.getConfig=function(){return this.headerConfig},t.prototype.clearResizeAreaGroup=function(e){var i=this.get("parent"),n=i==null?void 0:i.findById(e);n==null||n.clear()},t.prototype.render=function(e){this.clearResizeAreaGroup(e),this.clear(),this.layout(),this.offset(),this.clip()},t.prototype.onScrollXY=function(e,i,n){this.headerConfig.scrollX=e,this.headerConfig.scrollY=i,this.render(n)},t.prototype.onRowScrollX=function(e,i){this.headerConfig.scrollX=e,this.render(i)},t.prototype.clear=function(){r.prototype.clear.call(this)},t}(no),ZA=function(r){gt(t,r);function t(e){var i=r.call(this,e)||this;return i.scrollGroup=i.addGroup({name:Dct,zIndex:J5}),i}return t.prototype.onColScroll=function(e,i){this.headerConfig.scrollX!==e&&(this.headerConfig.scrollX=e,this.render(i))},t.prototype.clip=function(){var e=this.headerConfig,i=e.width,n=e.height,a=e.scrollX,o=e.spreadsheet,s=o.isFrozenRowHeader();this.scrollGroup.setClip({type:"rect",attrs:{x:s?a:0,y:0,width:s?i:i+a,height:n}})},t.prototype.clear=function(){var e,i;(e=this.scrollGroup)===null||e===void 0||e.clear(),(i=this.background)===null||i===void 0||i.remove(!0)},t.prototype.getCellInstance=function(e,i,n){return new Xm(e,i,n)},t.prototype.getCellGroup=function(e){return this.scrollGroup},t.prototype.isColCellInRect=function(e){var i=this.headerConfig,n=i.spreadsheet,a=i.cornerWidth,o=i.width,s=i.scrollX;return o+s>e.x&&s-(n.isFrozenRowHeader()?0:a)<e.x+e.width},t.prototype.layout=function(){var e=this,i=this.headerConfig,n=i.data,a=i.spreadsheet,o=a.options.colCell;Ht(n,function(s){var l=s;if(e.isColCellInRect(l)){var u=(o==null?void 0:o(l,a,e.headerConfig))||e.getCellInstance(l,a,e.headerConfig);l.belongsCell=u;var c=e.getCellGroup(l);c.add(u)}})},t.prototype.offset=function(){var e=this.headerConfig,i=e.position,n=e.scrollX;Vm(this.scrollGroup,i.x-n)},t}(jA),OMt=function(r){gt(t,r);function t(e){return r.call(this,e)||this}return t.getCornerHeader=function(e,i,n,a,o,s){var l=e.width,u=e.height,c=i.originalWidth,h=i.originalHeight,f=i.width,d=i.height,v=this.getCornerNodes({x:i.x,y:i.y},c,h,a.rows,a.columns,o.rowsHierarchy,o.colsHierarchy,a.dataSet,n,s);return new t({data:v,position:{x:i.x,y:i.y},width:f,height:d,originalHeight:h,originalWidth:c,viewportWidth:l,viewportHeight:u,hierarchyType:a.hierarchyType,hierarchyCollapse:a.hierarchyCollapse,rows:a.rows,columns:a.columns,seriesNumberWidth:n,spreadsheet:s})},t.getCornerNodes=function(e,i,n,a,o,s,l,u,c,h){var f,d,v,p=[],g=h.options.style.colCfg,m=l==null?void 0:l.sampleNodeForLastLevel,y=(f=m==null?void 0:m.y)!==null&&f!==void 0?f:0,_=(v=(d=m==null?void 0:m.height)!==null&&d!==void 0?d:g==null?void 0:g.height)!==null&&v!==void 0?v:0;if(c){var x=new Gr({id:"",key:Hct,value:Rr("序号")});x.x=e==null?void 0:e.x,x.y=y,x.width=c,x.height=_,x.isPivotMode=!0,x.spreadsheet=h,x.cornerType=ua.Series,p.push(x)}if(h.isHierarchyTreeType()){var C=this.getTreeCornerText(h),A=new Gr({key:"",id:C,value:C});A.x=e.x+c,A.y=y,A.width=i-c,A.height=_,A.seriesNumberWidth=c,A.isPivotMode=!0,A.spreadsheet=h,A.cornerType=ua.Row,p.push(A)}else s.sampleNodesForAllLevels.forEach(function(T){var w=a[T.level],M=new Gr({key:w,id:w,value:u.getFieldName(w)});M.x=T.x+c,M.y=y,M.width=T.width,M.height=_,M.field=w,M.isPivotMode=!0,M.cornerType=ua.Row,M.spreadsheet=h,p.push(M)});return l.sampleNodesForAllLevels.forEach(function(T){if(T.level<l.maxLevel){var w=o[T.level],M=new Gr({key:w,id:w,value:u.getFieldName(w)});M.x=e.x,M.y=T.y,M.width=i,M.height=T.height,M.field=w,M.isPivotMode=!0,M.cornerType=ua.Col,M.spreadsheet=h,p.push(M)}}),p},t.getTreeCornerText=function(e){var i=e.dataSet.fields.rows,n=i===void 0?[]:i,a=e.options.cornerText;if(a)return a;var o=e.store.get("drillDownFieldInLevel",[]),s=o.map(function(u){return u.drillField}),l=n.filter(function(u){return!Ei(s,u)}).map(function(u){return e.dataSet.getFieldName(u)}).join("/");return l},t.prototype.onCorScroll=function(e,i){this.headerConfig.scrollX=e,this.render(i)},t.prototype.destroy=function(){r.prototype.destroy.call(this)},t.prototype.layout=function(){this.renderCells()},t.prototype.renderCells=function(){var e=this,i,n,a,o,s=this.headerConfig,l=s.data,u=s.spreadsheet,c=(n=(i=u==null?void 0:u.facet)===null||i===void 0?void 0:i.cfg)===null||n===void 0?void 0:n.cornerHeader,h=(o=(a=u==null?void 0:u.facet)===null||a===void 0?void 0:a.cfg)===null||o===void 0?void 0:o.cornerCell;if(c){c(this,u,this.headerConfig);return}l.forEach(function(f){var d;h&&(d=h(f,e.headerConfig.spreadsheet,e.headerConfig)),at(d)&&(d=new Ewt(f,e.headerConfig.spreadsheet,e.headerConfig)),e.add(d)})},t.prototype.offset=function(){var e=this.headerConfig.scrollX;Vm(this,-e)},t.prototype.clip=function(){var e=this.headerConfig,i=e.width,n=e.height,a=e.scrollX;this.setClip({type:"rect",attrs:{x:a,y:0,width:i,height:n}})},t.prototype.getNodes=function(){return this.headerConfig.data||[]},t}(jA),PMt=function(r){gt(t,r);function t(e){var i=r.call(this,e)||this;return i.render(),i}return t.prototype.layout=function(){this.addCornerBottomBorder(),this.addCornerRightBorder(),this.addSplitLineShadow()},t.prototype.render=function(){this.clear(),this.layout()},t.prototype.onBorderScroll=function(e){this.cfg.scrollX=e;var i=this.cfg.position;To(this,i.x-e,0),this.render()},t.prototype.onChangeShadowVisibility=function(e,i){this.cfg.showViewportLeftShadow=e>0,this.cfg.showViewportRightShadow=Math.floor(e)<Math.floor(i),this.render()},t.prototype.addCornerRightBorder=function(){var e,i=this.cfg,n=i.isPivotMode;if(n){var a=i.width,o=i.height,s=i.viewportHeight,l=i.position,u=i.spreadsheet,c=(e=u.theme)===null||e===void 0?void 0:e.splitLine,h=l.x+a,f=l.y,d=l.y+o+s;this.addShape("line",{attrs:{x1:h,y1:f,x2:h,y2:d,stroke:c.verticalBorderColor,lineWidth:c.verticalBorderWidth,opacity:c.verticalBorderColorOpacity,lineDash:c.borderDash}})}},t.prototype.addCornerBottomBorder=function(){var e,i=this.cfg,n=i.width,a=i.height,o=i.viewportWidth,s=i.position,l=i.scrollX,u=i.scrollContainsRowHeader,c=i.spreadsheet,h=(e=c.theme)===null||e===void 0?void 0:e.splitLine,f=s.x,d=f+n+o+(u?l:0),v=s.y+a-1;this.addShape("line",{attrs:{x1:f,y1:v,x2:d,y2:v,stroke:h.horizontalBorderColor,lineWidth:h.horizontalBorderWidth,opacity:h.horizontalBorderColorOpacity,lineDash:h.borderDash}})},t.prototype.addSplitLineShadow=function(){var e,i=this.cfg,n=i.isPivotMode,a=i.spreadsheet,o=(e=a.theme)===null||e===void 0?void 0:e.splitLine;!n||!o.showShadow||!a.isFrozenRowHeader()||(this.addSplitLineLeftShadow(),this.addSplitLineRightShadow())},t.prototype.addSplitLineLeftShadow=function(){var e,i,n;if(this.cfg.showViewportLeftShadow){var a=this.cfg,o=a.width,s=a.height,l=a.viewportHeight,u=a.position,c=a.spreadsheet,h=(e=c.theme)===null||e===void 0?void 0:e.splitLine,f=u.x+o,d=u.y;this.addShape("rect",{attrs:{x:f,y:d,width:h.shadowWidth,height:l+s,fill:"l (0) 0:".concat((i=h.shadowColors)===null||i===void 0?void 0:i.left," 1:").concat((n=h.shadowColors)===null||n===void 0?void 0:n.right)}})}},t.prototype.addSplitLineRightShadow=function(){var e,i,n;if(this.cfg.showViewportRightShadow){var a=this.cfg,o=a.width,s=a.height,l=a.viewportHeight,u=a.viewportWidth,c=a.position,h=a.spreadsheet,f=(e=h.theme)===null||e===void 0?void 0:e.splitLine,d=c.x+o+u-f.shadowWidth,v=c.y;this.addShape("rect",{attrs:{x:d,y:v,width:f.shadowWidth,height:l+s,fill:"l (0) 0:".concat((i=f.shadowColors)===null||i===void 0?void 0:i.right," 1:").concat((n=f.shadowColors)===null||n===void 0?void 0:n.left)}})}},t}(no),qA=function(r){gt(t,r);function t(e){return r.call(this,e)||this}return t.prototype.destroy=function(){r.prototype.destroy.call(this),this.gm&&this.gm.destroy()},t.prototype.rowCellInRect=function(e){var i=this.headerConfig,n=i.width,a=i.viewportHeight,o=i.seriesNumberWidth,s=i.scrollY,l=i.scrollX;return a+s>e.y&&s<e.y+e.height&&n-o+l>e.x&&l-o<e.x+e.width},t.prototype.createCellInstance=function(e){return new lv(e,this.headerConfig.spreadsheet,this.headerConfig)},t.prototype.getCellGroup=function(e){return this},t.prototype.getCustomRowCell=function(){var e,i,n=this.headerConfig.spreadsheet;return(i=(e=n==null?void 0:n.facet)===null||e===void 0?void 0:e.cfg)===null||i===void 0?void 0:i.rowCell},t.prototype.layout=function(){var e=this,i=this.headerConfig,n=i.data,a=i.spreadsheet,o=this.getCustomRowCell();Ht(n,function(s){if(e.rowCellInRect(s)&&s.height!==0){var l=void 0;o&&(l=o(s,a,e.headerConfig)),at(l)&&a.isPivotMode()&&(l=e.createCellInstance(s)),s.belongsCell=l;var u=e.getCellGroup(s);u.add(l)}})},t.prototype.offset=function(){var e=this.headerConfig,i=e.scrollX,n=e.scrollY,a=e.position,o=e.seriesNumberWidth;To(this,a.x-i+o,a.y-n)},t.prototype.clip=function(){var e=this.headerConfig,i=e.width,n=e.viewportHeight,a=e.scrollX,o=e.scrollY,s=e.seriesNumberWidth;this.setClip({type:"rect",attrs:{x:a-s,y:o,width:i,height:n}})},t}(jA),o8=function(r){gt(t,r);function t(e){var i=r.call(this,e)||this;i.scrollGroup=i.addGroup({name:Uct,zIndex:J5}),i.frozenHeadGroup=i.addGroup({name:zct,zIndex:td});var n=i.headerConfig,a=n.position,o=n.seriesNumberWidth;return To(i.frozenHeadGroup,a.x+o,a.y),i}return t.prototype.rowCellInRectXDir=function(e){var i=this.headerConfig,n=i.width,a=i.scrollX,o=i.seriesNumberWidth,s=e.x+o;return n+a>s&&a<s+e.width},t.prototype.rowCellInRectYDir=function(e){var i=this.headerConfig,n=i.viewportHeight,a=i.scrollY,o=e.y-this.getFrozenFirstRowHeight();return n+a>o&&a<o+e.height},t.prototype.rowCellInRect=function(e){var i=this.rowCellInRectXDir(e);return this.isFrozenRow(e)?i:i&&this.rowCellInRectYDir(e)},t.prototype.getCellGroup=function(e){return this.isFrozenRow(e)?this.frozenHeadGroup:this.scrollGroup},t.prototype.offset=function(){var e=this.headerConfig,i=e.scrollX,n=e.scrollY,a=e.position,o=e.seriesNumberWidth,s=a.x-i+o;To(this.scrollGroup,s,a.y-n),Vm(this.frozenHeadGroup,s)},t.prototype.clip=function(){var e=this.headerConfig,i=e.width,n=e.viewportHeight,a=e.scrollX,o=e.scrollY,s=e.seriesNumberWidth,l=a-s;this.scrollGroup.setClip({type:"rect",attrs:{x:l,y:o+this.getFrozenFirstRowHeight(),width:i,height:n}}),this.frozenHeadGroup.setClip({type:"rect",attrs:{x:l,y:0,width:this.headerConfig.width,height:this.getFrozenFirstRowHeight()}})},t.prototype.isFrozenRow=function(e){var i,n=this.headerConfig.spreadsheet,a=n.facet,o=Uc(n.options,(i=a.layoutResult)===null||i===void 0?void 0:i.rowNodes).frozenRowCount;return o>0&&e.rowIndex>=0&&e.rowIndex<o},t.prototype.getFrozenFirstRowHeight=function(){var e,i=this.headerConfig.spreadsheet,n=i.facet,a=Uc(i.options,(e=n.layoutResult)===null||e===void 0?void 0:e.rowNodes).frozenRowHeight;return a},t.prototype.clear=function(){this.frozenHeadGroup.clear(),this.scrollGroup.clear()},t}(qA),s8=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.getSeriesNumberHeader=function(e){var i,n=e.viewportBBox,a=e.seriesNumberWidth,o=e.leafNodes,s=e.spreadsheet,l=e.cornerWidth,u=n.height,c=n.viewportHeight,h=[],f=s.isHierarchyTreeType();o.forEach(function(y){var _=new Gr({id:"",key:"",value:"".concat(h.length+1)});_.x=y.x,_.y=y.y,_.height=f?y.getTotalHeightForTreeHierarchy():y.height,_.width=a,_.rowIndex=y.rowIndex,_.spreadsheet=s,_.isLeaf=!0,h.push(_)});var d=s.facet,v=Uc(s.options,(i=d.layoutResult)===null||i===void 0?void 0:i.rowNodes),p=v.frozenRowCount,g=v.frozenRowHeight,m=!!p;return new t({width:l,height:u,viewportWidth:l,viewportHeight:m?c-g:c,position:{x:0,y:n.y},data:h,spreadsheet:s,seriesNumberWidth:0,hierarchyType:s.options.hierarchyType,linkFields:[]})},t.prototype.createCellInstance=function(e){var i=this.isFrozenRow(e);return new L7(e,this.headerConfig.spreadsheet,k(k({},this.headerConfig),{scrollY:i?0:this.headerConfig.scrollY}),i)},t.prototype.getCustomRowCell=function(){return null},t}(o8),FMt=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.createCellInstance=function(e){var i=this.headerConfig,n=i.spreadsheet,a=i.scrollY,o=this.isFrozenRow(e);return new lv(e,n,k(k({},this.headerConfig),{scrollY:o?0:a}),o)},t}(o8),BMt=function(){function r(t){var e=this;this.scrollFrameId=null,this.hideScrollBar=function(){var i,n,a;(i=e.hRowScrollBar)===null||i===void 0||i.hide(),(n=e.hScrollBar)===null||n===void 0||n.hide(),(a=e.vScrollBar)===null||a===void 0||a.hide()},this.delayHideScrollBar=od(this.hideScrollBar,1e3),this.delayHideScrollbarOnMobile=function(){Or()&&e.delayHideScrollBar()},this.showVerticalScrollBar=function(){var i;(i=e.vScrollBar)===null||i===void 0||i.show()},this.showHorizontalScrollBar=function(){var i,n;(i=e.hRowScrollBar)===null||i===void 0||i.show(),(n=e.hScrollBar)===null||n===void 0||n.show()},this.onContainerWheelForMobileCompatibility=function(){var i=e.spreadsheet.getCanvasElement(),n,a;i.addEventListener("touchstart",function(o){n=o.touches[0].clientY}),i.addEventListener("touchend",function(o){a=o.changedTouches[0].clientY,a<n?e.scrollDirection=Lr.SCROLL_UP:a>n&&(e.scrollDirection=Lr.SCROLL_DOWN)})},this.onContainerWheel=function(){e.onContainerWheelForPc(),e.onContainerWheelForMobile()},this.getMobileWheelDeltaY=function(i){return e.scrollDirection===Lr.SCROLL_UP?Math.max(0,i):e.scrollDirection===Lr.SCROLL_DOWN?Math.min(0,i):i},this.onContainerWheelForPc=function(){var i=e.spreadsheet.getCanvasElement();i==null||i.addEventListener("wheel",e.onWheel)},this.onContainerWheelForMobile=function(){e.mobileWheel=new Uwt(e.spreadsheet.container),e.mobileWheel.on("wheel",function(i){e.spreadsheet.hideTooltip();var n=i.event,a=i.deltaX,o=i.deltaY,s=i.x,l=i.y,u=e.getMobileWheelDeltaY(o);e.onWheel(k(k({},n),{deltaX:a,deltaY:u,offsetX:s,offsetY:l}))}),e.onContainerWheelForMobileCompatibility()},this.bindEvents=function(){e.onContainerWheel(),e.emitPaginationEvent()},this.setScrollOffset=function(i){Object.keys(i).forEach(function(n){var a=i[n];Dm(a)||e.spreadsheet.store.set(n,Math.floor(a))})},this.getScrollOffset=function(){var i=e.spreadsheet.store;return{scrollX:i.get("scrollX",0),scrollY:i.get("scrollY",0),rowHeaderScrollX:i.get("rowHeaderScrollX",0)}},this.emitPaginationEvent=function(){var i=e.cfg.pagination;if(i){var n=i.current,a=n===void 0?tC:n,o=i.pageSize,s=e.viewCellHeights.getTotalLength(),l=Math.floor((s-1)/o)+1;e.cfg.spreadsheet.emit(G.LAYOUT_PAGINATION,{pageSize:o,pageCount:l,total:s,current:a})}},this.unbindEvents=function(){var i=e.spreadsheet.getCanvasElement();i==null||i.removeEventListener("wheel",e.onWheel),e.mobileWheel.destroy()},this.clipPanelGroup=function(){var i;e.foregroundGroup=e.spreadsheet.foregroundGroup,e.backgroundGroup=e.spreadsheet.backgroundGroup,e.panelGroup=e.spreadsheet.panelGroup;var n=e.panelBBox,a=n.width,o=n.height;(i=e.spreadsheet.panelScrollGroup)===null||i===void 0||i.setClip({type:"rect",attrs:{x:0,y:e.cornerBBox.height,width:a,height:o}})},this.calculateCellWidthHeight=function(){var i=e.layoutResult.colLeafNodes,n=km(i,function(a,o){return a.push(Pe(a)+o.width),a},[0]);e.viewCellWidths=n,e.viewCellHeights=e.getViewCellHeights(e.layoutResult)},this.getRealScrollX=function(i,n){return n===void 0&&(n=0),e.cfg.spreadsheet.isScrollContainsRowHeader()?i:n},this.calculatePanelBBox=function(){e.panelBBox=new LMt(e,!0)},this.getRealWidth=function(){return Pe(e.viewCellWidths)},this.getRealHeight=function(){var i=e.cfg.pagination,n=e.viewCellHeights;if(i){var a=e.getCellRange(),o=a.start,s=a.end;return n.getCellOffsetY(s+1)-n.getCellOffsetY(o)}return n.getTotalHeight()},this.clearAllGroup=function(){for(var i=e.panelGroup.getChildren()||[],n=i.length-1;n>=0;n--){var a=i[n];a instanceof no?a.set("children",[]):i[n].remove()}e.foregroundGroup.set("children",[]),e.backgroundGroup.set("children",[])},this.scrollWithAnimation=function(i,n,a){var o,s,l,u;i===void 0&&(i={}),n===void 0&&(n=200);var c=e.getAdjustedScrollOffset({scrollX:((o=i.offsetX)===null||o===void 0?void 0:o.value)||0,scrollY:((s=i.offsetY)===null||s===void 0?void 0:s.value)||0,rowHeaderScrollX:((l=i.rowHeaderOffsetX)===null||l===void 0?void 0:l.value)||0}),h=c.scrollX,f=c.scrollY,d=c.rowHeaderScrollX;(u=e.timer)===null||u===void 0||u.stop();var v=e.getScrollOffset(),p=[h??v.scrollX,f??v.scrollY,d??v.rowHeaderScrollX],g=CMt(Object.values(v),p);e.timer=oS(function(m){try{var y=Math.min(m/n,1),_=tt(g(y),3),x=_[0],C=_[1],A=_[2];e.setScrollOffset({rowHeaderScrollX:A,scrollX:x,scrollY:C}),e.startScroll(),m>n&&(e.timer.stop(),a==null||a())}catch(T){console.error(T),e.timer.stop()}})},this.scrollImmediately=function(i){var n,a,o;i===void 0&&(i={});var s=e.getAdjustedScrollOffset({scrollX:((n=i.offsetX)===null||n===void 0?void 0:n.value)||0,scrollY:((a=i.offsetY)===null||a===void 0?void 0:a.value)||0,rowHeaderScrollX:((o=i.rowHeaderOffsetX)===null||o===void 0?void 0:o.value)||0}),l=s.scrollX,u=s.scrollY,c=s.rowHeaderScrollX;e.setScrollOffset({scrollX:l,scrollY:u,rowHeaderScrollX:c}),e.startScroll()},this.startScroll=function(i){var n,a,o;i===void 0&&(i=!1);var s=e.getScrollOffset(),l=s.rowHeaderScrollX,u=s.scrollX,c=s.scrollY;(n=e.hRowScrollBar)===null||n===void 0||n.onlyUpdateThumbOffset(e.getScrollBarOffset(l,e.hRowScrollBar)),(a=e.hScrollBar)===null||a===void 0||a.onlyUpdateThumbOffset(e.getScrollBarOffset(u,e.hScrollBar)),(o=e.vScrollBar)===null||o===void 0||o.onlyUpdateThumbOffset(e.getScrollBarOffset(c,e.vScrollBar)),e.dynamicRenderCell(i)},this.getRendererHeight=function(){var i=e.getCellRange(),n=i.start,a=i.end;return e.viewCellHeights.getCellOffsetY(a+1)-e.viewCellHeights.getCellOffsetY(n)},this.getAdjustedScrollOffset=function(i){var n=i.scrollX,a=i.scrollY,o=i.rowHeaderScrollX;return{scrollX:L_(n,e.layoutResult.colsHierarchy.width,e.panelBBox.width),scrollY:L_(a,e.getRendererHeight(),e.panelBBox.height),rowHeaderScrollX:wMt(o,e.cornerBBox)}},this.renderRowScrollBar=function(i){if(!e.cfg.spreadsheet.isScrollContainsRowHeader()&&e.cornerBBox.width<e.cornerBBox.originalWidth){var n=e.cornerBBox.originalWidth-e.cornerBBox.width,a=e.getScrollbarPosition().maxY,o=e.spreadsheet.theme,s=o.splitLine,l=o.scrollBar,u=Math.max(e.cornerBBox.width*e.cornerBBox.width/e.cornerBBox.originalWidth,l==null?void 0:l.thumbHorizontalMinSize),c=u-(s==null?void 0:s.verticalBorderWidth);e.hRowScrollBar=new I_({isHorizontal:!0,trackLen:e.cornerBBox.width,thumbLen:c,position:{x:e.cornerBBox.minX+e.scrollBarSize/2,y:a},thumbOffset:i*(e.cornerBBox.width-u)/n,theme:e.scrollBarTheme,scrollTargetMaxOffset:n}),e.hRowScrollBar.on(Dl.ScrollChange,function(h){var f,d,v=h.offset,p=e.getValidScrollBarOffset(v,n),g=Math.floor(p);e.setScrollOffset({rowHeaderScrollX:g}),(f=e.rowHeader)===null||f===void 0||f.onRowScrollX(g,Fc),(d=e.rowIndexHeader)===null||d===void 0||d.onRowScrollX(g,C3),e.cornerHeader.onRowScrollX(g,Ix);var m=e.getScrollBarOffset(g,e.hRowScrollBar),y=e.getScrollOffset(),_=y.scrollX,x=y.scrollY,C={scrollX:_,scrollY:x,rowHeaderScrollX:m};e.hRowScrollBar.updateThumbOffset(m,!1),e.spreadsheet.emit(G.ROW_CELL_SCROLL,C),e.spreadsheet.emit(G.GLOBAL_SCROLL,C)}),e.foregroundGroup.add(e.hRowScrollBar)}},this.getValidScrollBarOffset=function(i,n){return s0(i,0,n)},this.renderHScrollBar=function(i,n,a){if(Math.floor(i)<Math.floor(n)){var o=e.scrollBarSize/2,s=e.getScrollbarPosition().maxY,l=i+(e.cfg.spreadsheet.isScrollContainsRowHeader()?Math.min(e.cornerBBox.width,e.getCanvasHW().width):0),u={x:e.panelBBox.minX+(e.cfg.spreadsheet.isScrollContainsRowHeader()?-e.cornerBBox.width+o:o),y:s},c=n+(e.cfg.spreadsheet.isScrollContainsRowHeader()?e.cornerBBox.width:0),h=e.spreadsheet.theme.scrollBar,f=c-l,d=Math.max(l/c*l,h==null?void 0:h.thumbHorizontalMinSize);e.hScrollBar=new I_({isHorizontal:!0,trackLen:l,thumbLen:d,position:u,thumbOffset:a*(l-d)/f,theme:e.scrollBarTheme,scrollTargetMaxOffset:f}),e.hScrollBar.on(Dl.ScrollChange,function(v){var p=v.offset,g=v.updateThumbOffset,m=e.getValidScrollBarOffset(p,f);g&&e.hScrollBar.updateThumbOffset(e.getScrollBarOffset(m,e.hScrollBar),!1),e.setScrollOffset({scrollX:m}),e.dynamicRenderCell()}),e.foregroundGroup.add(e.hScrollBar)}},this.getScrollbarPosition=function(){var i=e.panelBBox,n=i.maxX,a=i.maxY,o=e.getCanvasHW(),s=o.width,l=o.height,u=e.spreadsheet.options.interaction.scrollbarPosition===e0.CONTENT;return{maxX:(u?n:s)-e.scrollBarSize,maxY:u?a:l-e.scrollBarSize}},this.renderVScrollBar=function(i,n,a){if(i<n){var o=e.spreadsheet.theme.scrollBar,s=Math.max(i/n*i,o==null?void 0:o.thumbVerticalMinSize),l=n-i,u=e.getScrollbarPosition().maxX;e.vScrollBar=new I_({isHorizontal:!1,trackLen:i,thumbLen:s,thumbOffset:a*(i-s)/l,position:{x:u,y:e.panelBBox.minY},theme:e.scrollBarTheme,scrollTargetMaxOffset:l}),e.vScrollBar.on(Dl.ScrollChange,function(c){var h=c.offset,f=c.updateThumbOffset,d=e.getValidScrollBarOffset(h,l);f&&e.vScrollBar.updateThumbOffset(e.getScrollBarOffset(d,e.vScrollBar),!1),e.setScrollOffset({scrollY:d}),e.dynamicRenderCell()}),e.foregroundGroup.add(e.vScrollBar)}},this.getScrollBarOffset=function(i,n){var a=n.trackLen,o=n.thumbLen,s=n.scrollTargetMaxOffset;return i*(a-o)/s},this.isScrollOverThePanelArea=function(i){var n=i.offsetX,a=i.offsetY;return n>e.panelBBox.minX&&n<e.panelBBox.maxX&&a>e.panelBBox.minY&&a<e.panelBBox.maxY},this.isScrollOverTheCornerArea=function(i){var n=i.offsetX,a=i.offsetY;return n>e.cornerBBox.minX&&n<e.cornerBBox.maxX&&a>e.cornerBBox.minY&&a<e.cornerBBox.maxY+e.panelBBox.height},this.updateHorizontalRowScrollOffset=function(i){var n,a=i.offset,o=i.offsetX,s=i.offsetY;e.isScrollOverTheCornerArea({offsetX:o,offsetY:s})&&((n=e.hRowScrollBar)===null||n===void 0||n.emitScrollChange(a))},this.updateHorizontalScrollOffset=function(i){var n,a=i.offset,o=i.offsetX,s=i.offsetY;(!e.hRowScrollBar||e.isScrollOverThePanelArea({offsetX:o,offsetY:s}))&&((n=e.hScrollBar)===null||n===void 0||n.emitScrollChange(a))},this.isScrollToLeft=function(i){var n=i.deltaX,a=i.offsetX,o=i.offsetY;if(!e.hScrollBar&&!e.hRowScrollBar)return!0;var s=!e.hRowScrollBar||e.isScrollOverThePanelArea({offsetY:o,offsetX:a})||e.hRowScrollBar.thumbOffset<=0,l=!e.hScrollBar||e.hScrollBar.thumbOffset<=0;return n<=0&&l&&s},this.isScrollToRight=function(i){var n,a,o,s,l,u,c=i.deltaX,h=i.offsetX,f=i.offsetY;if(!e.hScrollBar&&!e.hRowScrollBar)return!0;var d=e.spreadsheet.isFrozenRowHeader()?(n=e.panelBBox)===null||n===void 0?void 0:n.width:(a=e.panelBBox)===null||a===void 0?void 0:a.maxX,v=!e.hRowScrollBar||e.isScrollOverThePanelArea({offsetY:f,offsetX:h})||((o=e.hRowScrollBar)===null||o===void 0?void 0:o.thumbOffset)+((s=e.hRowScrollBar)===null||s===void 0?void 0:s.thumbLen)>=e.cornerBBox.width,p=e.hRowScrollBar&&e.isScrollOverTheCornerArea({offsetX:h,offsetY:f})||((l=e.hScrollBar)===null||l===void 0?void 0:l.thumbOffset)+((u=e.hScrollBar)===null||u===void 0?void 0:u.thumbLen)>=d;return c>=0&&p&&v},this.isScrollToTop=function(i){var n;return e.vScrollBar?i<=0&&((n=e.vScrollBar)===null||n===void 0?void 0:n.thumbOffset)<=0:!0},this.isScrollToBottom=function(i){var n,a,o;return e.vScrollBar?i>=0&&((n=e.vScrollBar)===null||n===void 0?void 0:n.thumbOffset)+((a=e.vScrollBar)===null||a===void 0?void 0:a.thumbLen)>=((o=e.panelBBox)===null||o===void 0?void 0:o.height):!0},this.isVerticalScrollOverTheViewport=function(i){return!e.isScrollToTop(i)&&!e.isScrollToBottom(i)},this.isHorizontalScrollOverTheViewport=function(i){return!e.isScrollToLeft(i)&&!e.isScrollToRight(i)},this.isScrollOverTheViewport=function(i){var n=i.deltaY,a=i.deltaX,o=i.offsetY,s=o<=e.cornerBBox.maxY;return s?!1:n!==0?e.isVerticalScrollOverTheViewport(n):a!==0?e.isHorizontalScrollOverTheViewport(i):!1},this.cancelScrollFrame=function(){return Or()&&e.scrollFrameId?!1:(cancelAnimationFrame(e.scrollFrameId),!0)},this.clearScrollFrameIdOnMobile=function(){Or()&&(e.scrollFrameId=null)},this.stopScrollChainingIfNeeded=function(i){var n=e.spreadsheet.options.interaction;n.overscrollBehavior!=="auto"&&(e.cancelScrollFrame(),e.stopScrollChaining(i))},this.stopScrollChaining=function(i){var n,a;i!=null&&i.cancelable&&((n=i==null?void 0:i.preventDefault)===null||n===void 0||n.call(i));var o=i==null?void 0:i.originalEvent;o!=null&&o.cancelable&&((a=o==null?void 0:o.preventDefault)===null||a===void 0||a.call(o))},this.onWheel=function(i){var n=e.spreadsheet.options.interaction,a=i.deltaX,o=i.deltaY,s=i.offsetX,l=i.offsetY,u=i.shiftKey;u&&Y6()&&(s=s-a+o,a=o,l-=o,o=0);var c=tt(Cbt(a,o,n.scrollSpeedRatio),2),h=c[0],f=c[1];if(e.spreadsheet.hideTooltip(),e.spreadsheet.interaction.clearHoverTimer(),!e.isScrollOverTheViewport({deltaX:h,deltaY:f,offsetX:s,offsetY:l})){e.stopScrollChainingIfNeeded(i);return}e.stopScrollChaining(i),e.spreadsheet.interaction.addIntercepts([Vt.HOVER]),e.cancelScrollFrame()&&(e.scrollFrameId=requestAnimationFrame(function(){var d,v=e.getScrollOffset(),p=v.scrollX,g=v.scrollY,m=v.rowHeaderScrollX;h!==0&&(e.showHorizontalScrollBar(),e.updateHorizontalRowScrollOffset({offsetX:s,offsetY:l,offset:h+m}),e.updateHorizontalScrollOffset({offsetX:s,offsetY:l,offset:h+p})),f!==0&&(e.showVerticalScrollBar(),(d=e.vScrollBar)===null||d===void 0||d.emitScrollChange(f+g)),e.delayHideScrollbarOnMobile(),e.clearScrollFrameIdOnMobile()}))},this.addCell=function(i){var n=e.spreadsheet.panelScrollGroup;n==null||n.add(i)},this.realCellRender=function(i,n){var a=e.calculateXYIndexes(i,n);Ha.getInstance().logger("renderIndex:",e.preCellIndexes,a);var o=IMt(e.preCellIndexes,a),s=o.add,l=o.remove;Ha.getInstance().debugCallback(qTt,function(){Ht(s,function(c){var h=tt(c,2),f=h[0],d=h[1],v=e.layoutResult.getCellMeta(d,f);if(v){var p=e.cfg.dataCell(v);p.set("name","".concat(f,"-").concat(d)),e.addCell(p)}});var u=Mf(e.panelGroup.getChildren(),Zs);Ht(l,function(c){var h=tt(c,2),f=h[0],d=h[1],v=ci(u,function(p){return p.get("name")==="".concat(f,"-").concat(d)});v==null||v.remove(!0)}),Ha.getInstance().logger("Render Cell Panel: ".concat(u==null?void 0:u.length,", Add: ").concat(s==null?void 0:s.length,", Remove: ").concat(l==null?void 0:l.length))}),e.preCellIndexes=a,e.spreadsheet.emit(G.LAYOUT_AFTER_REAL_DATA_CELL_RENDER,{add:s,remove:l,spreadsheet:e.spreadsheet})},this.getGridInfo=function(){var i=tt(e.preCellIndexes.center,4),n=i[0],a=i[1],o=i[2],s=i[3],l=i8(n,a,e.layoutResult.colLeafNodes),u=Qm(o,s,e.viewCellHeights);return{cols:l,rows:u}},this.onAfterScroll=od(function(){var i=e.spreadsheet,n=i.interaction,a=i.container;if(!n.isSelectedState()&&(n.removeIntercepts([Vt.HOVER]),n.getHoverAfterScroll())){var o=n.eventController.canvasMousemoveEvent;if(o){var s=o.x,l=o.y,u=a.getShape(s,l);u&&a.emit(pi.MOUSE_MOVE,k(k({},o),{shape:u,target:u,timestamp:performance.now()}))}}},300),this.cfg=t,this.spreadsheet=t.spreadsheet,this.init()}return Object.defineProperty(r.prototype,"scrollBarTheme",{get:function(){return this.spreadsheet.theme.scrollBar},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"scrollBarSize",{get:function(){return this.scrollBarTheme.size},enumerable:!1,configurable:!0}),r.prototype.getCellCustomWidth=function(t,e){return Zr(e)?e==null?void 0:e(t):e},r.prototype.getCellDraggedWidth=function(t){var e=this.cfg.colCfg;return Nt(e==null?void 0:e.widthByFieldValue,"".concat(t.value))},r.prototype.render=function(){Mbt(this.spreadsheet.dataCfg.fields)||(this.adjustScrollOffset(),this.renderHeaders(),this.renderScrollBars(),this.renderBackground(),this.dynamicRenderCell(!0))},r.prototype.adjustScrollOffset=function(){var t=this.getAdjustedScrollOffset(this.getScrollOffset());this.setScrollOffset(t)},r.prototype.getSeriesNumberWidth=function(){var t=this.cfg.showSeriesNumber;return t?this.spreadsheet.theme.rowCell.seriesNumberWidth:0},r.prototype.getCanvasHW=function(){return{width:this.cfg.width,height:this.cfg.height}},r.prototype.updateScrollOffset=function(t){var e,i,n,a,o,s;if(((e=t.rowHeaderOffsetX)===null||e===void 0?void 0:e.value)!==void 0){!((i=t.rowHeaderOffsetX)===null||i===void 0)&&i.animate?this.scrollWithAnimation(t):this.scrollImmediately(t);return}if(((n=t.offsetX)===null||n===void 0?void 0:n.value)!==void 0){!((a=t.offsetX)===null||a===void 0)&&a.animate?this.scrollWithAnimation(t):this.scrollImmediately(t);return}((o=t.offsetY)===null||o===void 0?void 0:o.value)!==void 0&&(!((s=t.offsetY)===null||s===void 0)&&s.animate?this.scrollWithAnimation(t):this.scrollImmediately(t))},r.prototype.getPaginationScrollY=function(){var t=this.cfg.pagination;if(t){var e=t.current,i=e===void 0?tC:e,n=t.pageSize,a=this.viewCellHeights,o=Math.max((i-1)*n,0);return a.getCellOffsetY(o)}return 0},r.prototype.destroy=function(){this.unbindEvents(),this.clearAllGroup(),this.preCellIndexes=null,cancelAnimationFrame(this.scrollFrameId)},r.prototype.calculateXYIndexes=function(t,e){var i=this.panelBBox,n=i.viewportHeight,a=i.viewportWidth,o=MA(t,e,this.viewCellWidths,this.viewCellHeights,{width:a,height:n,x:0,y:0},this.getRealScrollX(this.cornerBBox.width));return{center:o}},r.prototype.calculateCornerBBox=function(){this.cornerBBox=new a8(this,!0)},r.prototype.getCellRange=function(){var t=this.cfg.pagination;return bbt(this.viewCellHeights,t)},r.prototype.panelScrollGroupClip=function(t,e){var i,n=this.spreadsheet.isFrozenRowHeader();(i=this.spreadsheet.panelScrollGroup)===null||i===void 0||i.setClip({type:"rect",attrs:{x:n?t:0,y:e,width:this.panelBBox.width+(n?0:t),height:this.panelBBox.height}})},r.prototype.clip=function(t,e){this.panelScrollGroupClip(t,e)},r.prototype.translateRelatedGroups=function(t,e,i){var n,a,o,s,l,u;To(this.spreadsheet.panelScrollGroup,this.cornerBBox.width-t,this.cornerBBox.height-e),(n=this.rowHeader)===null||n===void 0||n.onScrollXY(this.getRealScrollX(t,i),e,Fc),(a=this.rowIndexHeader)===null||a===void 0||a.onScrollXY(this.getRealScrollX(t,i),e,C3),(o=this.cornerHeader)===null||o===void 0||o.onCorScroll(this.getRealScrollX(t,i),Ix),(s=this.centerFrame)===null||s===void 0||s.onChangeShadowVisibility(t,this.getRealWidth()-this.panelBBox.width),(l=this.centerFrame)===null||l===void 0||l.onBorderScroll(this.getRealScrollX(t)),(u=this.columnHeader)===null||u===void 0||u.onColScroll(t,n4)},r.prototype.init=function(){var t=this;Ha.getInstance().debugCallback(ZTt,function(){t.layoutResult=t.doLayout(),t.saveInitColumnLeafNodes(t.layoutResult.colLeafNodes),t.spreadsheet.emit(G.LAYOUT_AFTER_HEADER_LAYOUT,t.layoutResult)}),this.calculateCellWidthHeight(),this.calculateCornerBBox(),this.calculatePanelBBox(),this.clipPanelGroup(),this.bindEvents()},r.prototype.renderBackground=function(){var t=this.getCanvasHW(),e=t.width,i=t.height,n=this.spreadsheet.theme.background,a=n.color,o=n.opacity;this.backgroundGroup.addShape("rect",{attrs:{fill:a,opacity:o,x:0,y:0,width:e,height:i}})},r.prototype.renderScrollBars=function(){var t=this.getScrollOffset(),e=t.scrollX,i=t.scrollY,n=t.rowHeaderScrollX,a=this.panelBBox,o=a.width,s=a.height,l=this.layoutResult.colsHierarchy.width,u=this.getRealHeight();this.renderRowScrollBar(n),this.renderHScrollBar(o,l,e),this.renderVScrollBar(s,u,i)},r.prototype.renderHeaders=function(){var t=this.getSeriesNumberWidth();this.rowHeader=this.getRowHeader(),this.columnHeader=this.getColHeader(),t>0&&!this.rowIndexHeader&&(this.rowIndexHeader=this.getSeriesNumberHeader()),this.cornerHeader=this.getCornerHeader(),this.centerFrame=this.getCenterFrame(),this.rowIndexHeader&&this.foregroundGroup.add(this.rowIndexHeader),this.rowHeader&&this.foregroundGroup.add(this.rowHeader),this.foregroundGroup.add(this.columnHeader),this.foregroundGroup.add(this.cornerHeader),this.foregroundGroup.add(this.centerFrame)},r.prototype.getRowHeaderCfg=function(){var t,e,i,n=this.panelBBox,a=n.y,o=n.viewportHeight,s=n.viewportWidth,l=n.height,u=this.getSeriesNumberWidth();return{width:this.cornerBBox.width,height:l,viewportWidth:s,viewportHeight:o,position:{x:0,y:a},data:this.layoutResult.rowNodes,hierarchyType:this.cfg.hierarchyType,linkFields:(i=(e=(t=this.cfg.spreadsheet.options)===null||t===void 0?void 0:t.interaction)===null||e===void 0?void 0:e.linkFields)!==null&&i!==void 0?i:[],seriesNumberWidth:u,spreadsheet:this.spreadsheet}},r.prototype.getRowHeader=function(){return this.rowHeader?this.rowHeader:new qA(this.getRowHeaderCfg())},r.prototype.getColHeader=function(){if(!this.columnHeader){var t=this.panelBBox,e=t.x,i=t.width,n=t.viewportHeight,a=t.viewportWidth;return new ZA({width:i,cornerWidth:this.cornerBBox.width,height:this.cornerBBox.height,viewportWidth:a,viewportHeight:n,position:{x:e,y:0},data:this.layoutResult.colNodes,scrollContainsRowHeader:this.cfg.spreadsheet.isScrollContainsRowHeader(),sortParam:this.cfg.spreadsheet.store.get("sortParam"),spreadsheet:this.spreadsheet})}return this.columnHeader},r.prototype.getCornerHeader=function(){return this.cornerHeader?this.cornerHeader:OMt.getCornerHeader(this.panelBBox,this.cornerBBox,this.getSeriesNumberWidth(),this.cfg,this.layoutResult,this.spreadsheet)},r.prototype.getSeriesNumberHeader=function(){return s8.getSeriesNumberHeader({viewportBBox:this.panelBBox,seriesNumberWidth:this.getSeriesNumberWidth(),leafNodes:this.layoutResult.rowsHierarchy.getNodes(0),spreadsheet:this.spreadsheet,cornerWidth:this.cornerBBox.width})},r.prototype.getCenterFrame=function(){var t;if(!this.centerFrame){var e=this.panelBBox,i=e.viewportWidth,n=e.viewportHeight,a=this.cornerBBox.width,o=this.cornerBBox.height,s=(t=this.cfg)===null||t===void 0?void 0:t.frame,l={position:{x:this.cornerBBox.x,y:this.cornerBBox.y},width:a,height:o,viewportWidth:i,viewportHeight:n,showViewportLeftShadow:!1,showViewportRightShadow:!1,scrollContainsRowHeader:this.cfg.spreadsheet.isScrollContainsRowHeader(),isPivotMode:this.cfg.spreadsheet.isPivotMode(),spreadsheet:this.cfg.spreadsheet};return s?s(l):new PMt(l)}return this.centerFrame},r.prototype.updatePanelScrollGroup=function(){this.gridInfo=this.getGridInfo(),this.spreadsheet.panelScrollGroup.update(this.gridInfo)},r.prototype.dynamicRenderCell=function(t){var e=this.getScrollOffset(),i=e.scrollX,n=e.scrollY,a=e.rowHeaderScrollX,o=n+this.getPaginationScrollY(),s=L_(o,this.viewCellHeights.getTotalHeight(),this.panelBBox.viewportHeight);this.spreadsheet.hideTooltip(),this.spreadsheet.interaction.clearHoverTimer(),this.realCellRender(i,s),this.updatePanelScrollGroup(),this.translateRelatedGroups(i,s,a),this.clip(i,s),t||this.emitScrollEvent({scrollX:i,scrollY:s,rowHeaderScrollX:a}),this.onAfterScroll()},r.prototype.emitScrollEvent=function(t){this.spreadsheet.emit(G.LAYOUT_CELL_SCROLL,t),this.spreadsheet.emit(G.GLOBAL_SCROLL,t)},r.prototype.saveInitColumnLeafNodes=function(t){t===void 0&&(t=[]);var e=this.spreadsheet,i=e.store,n=e.options,a=n.interaction.hiddenColumnFields,o=t.length+a.length,s=i.get("initColumnLeafNodes",[]);o!==s.length&&i.set("initColumnLeafNodes",t)},r.prototype.getHiddenColumnsInfo=function(t){var e=this.spreadsheet.store.get("hiddenColumnsDetail",[]);return at(e)?null:e.find(function(i){var n;return(n=i==null?void 0:i.hideColumnNodes)===null||n===void 0?void 0:n.some(function(a){return a.id===t.id})})},r.prototype.getCornerNodes=function(){var t;return((t=this.cornerHeader)===null||t===void 0?void 0:t.getNodes())||[]},r}(),l8=function(r){gt(t,r);function t(e){var i,n=r.call(this,e)||this;return n.frozenGroupInfo=(i={},i[Ln.FROZEN_COL]={width:0},i[Ln.FROZEN_ROW]={height:0},i[Ln.FROZEN_TRAILING_ROW]={height:0},i[Ln.FROZEN_TRAILING_COL]={width:0},i),n.panelScrollGroupIndexes=[],n.initFrozenGroupPosition=function(){var a=n.getScrollOffset(),o=a.scrollY,s=a.scrollX,l=n.getPaginationScrollY();To(n.spreadsheet.frozenRowGroup,n.cornerBBox.width-s,n.cornerBBox.height-l),To(n.spreadsheet.frozenColGroup,n.cornerBBox.width,n.cornerBBox.height-o-l),To(n.spreadsheet.frozenTrailingColGroup,n.cornerBBox.width,n.cornerBBox.height-o-l),To(n.spreadsheet.frozenTopGroup,n.cornerBBox.width,n.cornerBBox.height-l)},n.addCell=function(a){var o=n.getBizRevisedFrozenOptions(),s=o.frozenRowCount,l=o.frozenColCount,u=o.frozenTrailingRowCount,c=o.frozenTrailingColCount,h=n.layoutResult.colsHierarchy.getLeaves().length,f=n.getCellRange(),d=n.getRealFrozenColumns(l,c),v=d.colCount,p=d.trailingColCount,g=Sbt(a.getMeta(),{frozenRowCount:s,frozenColCount:v,frozenTrailingRowCount:u,frozenTrailingColCount:p},h,f),m=c4[g];m&&n.spreadsheet[m]&&n.spreadsheet[m].add(a)},n.renderFrozenGroupSplitLine=function(a,o){var s,l,u,c=n.panelBBox,h=c.width,f=c.height,d=c.viewportWidth,v=c.viewportHeight,p=n.cornerBBox.height,g=n.layoutResult.colNodes.filter(function(Ct){return $a(Ct)}),m=n.getCellRange(),y=m.end-m.start,_=Es(n.getBizRevisedFrozenOptions(),g.length,y),x=_.frozenRowCount,C=x===void 0?0:x,A=_.frozenColCount,T=A===void 0?0:A,w=_.frozenTrailingColCount,M=w===void 0?0:w,O=_.frozenTrailingRowCount,P=O===void 0?0:O,D=Math.floor(o-n.getPaginationScrollY()),z=Math.max(0,((s=Pe(n.viewCellWidths))!==null&&s!==void 0?s:0)-d),Y=Math.max(0,n.viewCellHeights.getCellOffsetY(m.end+1)-n.viewCellHeights.getCellOffsetY(m.start)-v);(l=n.foregroundGroup.findById(Jg))===null||l===void 0||l.remove();var H=Nt(n.cfg,"spreadsheet.theme.splitLine"),N=n.foregroundGroup.addGroup({id:Jg,zIndex:td}),W={lineWidth:H==null?void 0:H.verticalBorderWidth,stroke:H==null?void 0:H.verticalBorderColor,opacity:H==null?void 0:H.verticalBorderColorOpacity,lineDash:H==null?void 0:H.borderDash},Q={lineWidth:H==null?void 0:H.horizontalBorderWidth,stroke:H==null?void 0:H.horizontalBorderColor,opacity:H==null?void 0:H.horizontalBorderColorOpacity,lineDash:H==null?void 0:H.borderDash};if(T>0){var q=g.reduce(function(Ct,ct,dt){return dt<T?Ct+ct.width:Ct},0),J=P>0?f:v;Xr(N,{x1:q,x2:q,y1:p,y2:p+J},k({},W)),H.showShadow&&a>0&&N.addShape("rect",{attrs:{x:q,y:p,width:H.shadowWidth,height:J,fill:n.getShadowFill(0)}})}if(C>0){var et=p+n.getTotalHeightForRange(m.start,m.start+C-1),ft=M>0?h:d;Xr(N,{x1:0,x2:ft,y1:et,y2:et},k({},Q)),H.showShadow&&D>0&&N.addShape("rect",{attrs:{x:0,y:et,width:ft,height:H.shadowWidth,fill:n.getShadowFill(90)}})}if(M>0){var q=g[g.length-M].x,J=P?f:v;Xr(N,{x1:q,x2:q,y1:p,y2:p+J},k({},W)),H.showShadow&&Math.floor(a)<Math.floor(z)&&N.addShape("rect",{attrs:{x:q-((u=H.shadowWidth)!==null&&u!==void 0?u:0),y:p,width:H.shadowWidth,height:J,fill:n.getShadowFill(180)}})}if(P>0){var et=n.panelBBox.maxY-n.getTotalHeightForRange(m.end-P+1,m.end),ft=M>0?h:d;Xr(N,{x1:0,x2:ft,y1:et,y2:et},k({},Q)),H.showShadow&&D<Math.floor(Y)&&N.addShape("rect",{attrs:{x:0,y:et-H.shadowWidth,width:ft,height:H.shadowWidth,fill:n.getShadowFill(270)}})}n.foregroundGroup.sort()},n.getRealFrozenColumns=function(a,o){var s,l=a,u=o;if(a||o){var c=n.layoutResult.colsHierarchy.getNodes();c=c.filter(function(h){return $a(h)}),s=f0(c,a,o),l=s.colCount,u=s.trailingColCount}return{colCount:l,trailingColCount:u}},n.getTotalHeightForRange=function(a,o){if(a<0||o<0)return 0;if(n.rowOffsets)return n.rowOffsets[o+1]-n.rowOffsets[a];for(var s=0,l=a;l<o+1;l++){var u=n.getDefaultCellHeight();s+=u}return s},n.getShadowFill=function(a){var o,s,l=Nt(n.cfg,"spreadsheet.theme.splitLine");return"l (".concat(a,") 0:").concat((o=l.shadowColors)===null||o===void 0?void 0:o.left," 1:").concat((s=l.shadowColors)===null||s===void 0?void 0:s.right)},n}return t.prototype.calculateFrozenGroupInfo=function(){var e=this.getFrozenOptionsDirectly(),i=e.frozenColCount,n=e.frozenRowCount,a=e.frozenTrailingColCount,o=e.frozenTrailingRowCount,s=this.layoutResult.colNodes.filter(function(p){return $a(p)}),l=this.viewCellHeights,u=this.getCellRange(),c=this.frozenGroupInfo,h=c.frozenCol,f=c.frozenTrailingCol,d=c.frozenRow,v=c.frozenTrailingRow;i>0&&(h.width=s[i-1].x+s[i-1].width-0,h.range=[0,i-1]),n>0&&(d.height=l.getCellOffsetY(u.start+n)-l.getCellOffsetY(u.start),d.range=[u.start,u.start+n-1]),a>0&&(f.width=s[s.length-1].x-s[s.length-a].x+s[s.length-1].width,f.range=[s.length-a,s.length-1]),o>0&&(v.height=l.getCellOffsetY(u.end+1)-l.getCellOffsetY(u.end+1-o),v.range=[u.end-o+1,u.end])},t.prototype.calculateXYIndexes=function(e,i){var n,a,o,s=this.layoutResult.colLeafNodes.length,l=this.getCellRange(),u=this.panelBBox,c=u.viewportHeight,h=u.viewportWidth,f=this.getFrozenOptionsDirectly(),d=f.frozenColCount,v=d===void 0?0:d,p=f.frozenRowCount,g=p===void 0?0:p,m=f.frozenTrailingColCount,y=m===void 0?0:m,_=f.frozenTrailingRowCount,x=_===void 0?0:_,C={width:h,height:c,x:0,y:0};if(y>0||v>0){var A=this.frozenGroupInfo,T=A.frozenTrailingCol,w=A.frozenCol;C.width-=T.width+w.width,C.x+=(n=w.width)!==null&&n!==void 0?n:0}if(x>0||g>0){var M=this.frozenGroupInfo,O=M.frozenRow,P=M.frozenTrailingRow;C.height<O.height+P.height?(C.height=0,C.y=0):(C.height-=O.height+P.height,C.y+=O.height)}var D=this.spreadsheet.isTableMode()&&(!((o=(a=this.spreadsheet.dataSet)===null||a===void 0?void 0:a.isEmpty)===null||o===void 0)&&o.call(a))?this.spreadsheet.dataSet.getEmptyViewIndexes():MA(e,i,this.viewCellWidths,this.viewCellHeights,C,this.getRealScrollX(this.cornerBBox.width));this.panelScrollGroupIndexes=D;var z=this.getRealFrozenColumns(v,y),Y=z.colCount,H=z.trailingColCount;return Tbt(D,{frozenColCount:Y,frozenRowCount:g,frozenTrailingColCount:H,frozenTrailingRowCount:x},s,l)},t.prototype.updateFrozenGroupGrid=function(){var e=this;[Ln.FROZEN_COL,Ln.FROZEN_ROW,Ln.FROZEN_TRAILING_COL,Ln.FROZEN_TRAILING_ROW].forEach(function(i){if(e.frozenGroupInfo[i].range){var n=[],a=[];if(i.toLowerCase().includes("row")){var o=tt(e.frozenGroupInfo[i].range,2),s=o[0],l=o[1];if(n=e.gridInfo.cols,a=Qm(s,l,e.viewCellHeights),i===Ln.FROZEN_TRAILING_ROW){var u=e.spreadsheet.frozenTrailingRowGroup.getBBox().minY;a=RMt(s,l,Math.ceil(u),e.viewCellHeights)}}else{var c=tt(e.frozenGroupInfo[i].range,2),h=c[0],f=c[1],d=e.layoutResult.colNodes.filter(function(v){return $a(v)});n=i8(h,f,d),a=e.gridInfo.rows}e.spreadsheet["".concat(i,"Group")].updateGrid({cols:n,rows:a},"".concat(i,"Group"))}})},t.prototype.updatePanelScrollGroup=function(){r.prototype.updatePanelScrollGroup.call(this),this.updateFrozenGroupGrid()},t.prototype.translateRelatedGroups=function(e,i,n){var a=this,o=this.spreadsheet,s=o.frozenColGroup,l=o.frozenTrailingColGroup,u=o.frozenRowGroup,c=o.frozenTrailingRowGroup;[u,c].forEach(function(h){Vm(h,a.cornerBBox.width-e)}),[s,l].forEach(function(h){Ebt(h,a.cornerBBox.height-i)}),r.prototype.translateRelatedGroups.call(this,e,i,n),this.updateRowResizeArea(),this.renderFrozenGroupSplitLine(e,i)},t.prototype.updateRowResizeArea=function(){},t.prototype.clip=function(e,i){var n,a,o,s=this.getPaginationScrollY(),l=this.spreadsheet,u=l.frozenRowGroup,c=l.frozenColGroup,h=l.frozenTrailingColGroup,f=l.frozenTrailingRowGroup,d=l.panelScrollGroup,v=0,p=0,g=0;c&&(v=c.getBBox().width),u&&(p=u.getBBox().height);var m;h&&(m=h.getBBox()),f&&(g=f.getBBox().height);var y=this.panelBBox.width-v-((n=m==null?void 0:m.width)!==null&&n!==void 0?n:0),_=this.panelBBox.height-p-g;d.setClip({type:"rect",attrs:{x:e+v,y:i+p,width:y,height:_}}),u.setClip({type:"rect",attrs:{x:e+v,y:s,width:y,height:p}}),f==null||f.setClip({type:"rect",attrs:{x:e+v,y:f.getBBox().minY,width:y,height:g}});var x={y:i+p,height:_};c==null||c.setClip({type:"rect",attrs:k(k({},x),{x:0,width:v})}),h==null||h.setClip({type:"rect",attrs:k(k({},x),{x:(a=m==null?void 0:m.minX)!==null&&a!==void 0?a:0,width:(o=m==null?void 0:m.width)!==null&&o!==void 0?o:0})})},t.prototype.init=function(){r.prototype.init.call(this)},t.prototype.render=function(){this.calculateFrozenGroupInfo(),r.prototype.render.call(this),this.initFrozenGroupPosition()},t.prototype.getFrozenOptionsDirectly=function(){var e=this.layoutResult.colLeafNodes.length,i=this.getCellRange();return Es(this.getBizRevisedFrozenOptions(),e,i.end-i.start+1)},t.prototype.getBizRevisedFrozenOptions=function(){var e=this.cfg,i=e.frozenColCount,n=e.frozenRowCount,a=e.frozenTrailingColCount,o=e.frozenTrailingRowCount;return{frozenColCount:i,frozenRowCount:n,frozenTrailingColCount:a,frozenTrailingRowCount:o}},t.prototype.getDefaultCellHeight=function(){var e,i=this.cfg.cellCfg;return(e=i==null?void 0:i.height)!==null&&e!==void 0?e:0},t}(BMt),u8=function(r){var t,e,i,n=r.facetCfg,a=r.customTreeItems,o=a===void 0?[]:a,s=r.level,l=r.parentNode,u=r.hierarchy,c=n.spreadsheet,h=n.collapsedRows,f=n.hierarchyCollapse;try{for(var d=Vn(o),v=d.next();!v.done;v=d.next()){var p=v.value,g=p.key,m=p.title,y=p.collapsed,_=p.children,x=cm(p,["key","title","collapsed","children"]),C=(i={},i[Zt]=g,i),A=cd(l.id,m),T=y??!1,w=Nt(h,A),M=w??(f||T),O=new Gr({id:A,key:g,label:m,value:m,level:s,parent:l,field:g,isTotals:!1,isCollapsed:M,hierarchy:u,query:C,spreadsheet:c,extra:x});s>u.maxLevel&&(u.maxLevel=s),at(_)&&(O.isLeaf=!0);var P=wA(n,l,O,u);!at(_)&&!M&&P&&u8({facetCfg:n,parentNode:O,level:s+1,hierarchy:u,customTreeItems:_})}}catch(D){t={error:D}}finally{try{v&&!v.done&&(e=d.return)&&e.call(d)}finally{if(t)throw t.error}}},DMt=function(r,t,e){var i=r.getTotalsConfig(t);if(i.showGrandTotals){var n=i.reverseLayout?"unshift":"push";e[n](new kc({label:i.label,isSubTotals:!1,isGrandTotals:!0}))}},c8=function(r){var t,e,i,n,a,o,s=r.parentNode,l=r.currentField,u=r.level,c=r.facetCfg,h=r.hierarchy,f=r.pivotMeta,d=c.spreadsheet,v=c.collapsedRows,p=c.hierarchyCollapse,g=c.rowExpandDepth,m=s.query,y=s.id,_=((n=d.dataCfg.fields.rows)===null||n===void 0?void 0:n.length)<=u,x=r2t(Array.from(f.keys())),C=K6(x,c,s,l),A=d.store.get("drillItemsNum");_&&A>0&&(C=C.slice(0,A)),u===0&&DMt(d,l,C);try{for(var T=Vn(C),w=T.next();!w.done;w=T.next()){var M=w.value,O=M instanceof kc,P=O?null:f.get(M),D=void 0,z=m,Y=!1,H=!1;if(O){var N=M;Y=N.isGrandTotals,H=N.isSubTotals,D=Rr(M.label),z=m}else D=M,z=k(k({},m),(i={},i[l]=D,i));var W=cd(y,D),Q=v==null?void 0:v[W],q=yi(g)?u>g:null,J=(a=Q??q)!==null&&a!==void 0?a:p,et=new Gr({id:W,key:l,label:D,value:D,level:u,parent:s,field:l,isTotals:O,isGrandTotals:Y,isSubTotals:H,isCollapsed:J,hierarchy:h,query:z,spreadsheet:d});u>h.maxLevel&&(h.maxLevel=u);var ft=ht([],tt(((o=P==null?void 0:P.children)===null||o===void 0?void 0:o.keys())||[]),!1).filter(function(dt){return dt!==Ka}),Ct=at(ft);(Ct||O)&&(et.isLeaf=!0),Ct||(et.isTotals=!0);var ct=wA(c,s,et,h);!Ct&&!J&&!O&&ct&&c8({level:u+1,currentField:P.childField,pivotMeta:P.children,facetCfg:c,parentNode:et,hierarchy:h})}}catch(dt){t={error:dt}}finally{try{w&&!w.done&&(e=T.return)&&e.call(T)}finally{if(t)throw t.error}}},h8=function(r){var t=r.isValueInCols,e=r.moreThanOneValue,i=r.rootNode,n=r.facetCfg,a=r.hierarchy,o=r.fields,s=r.isRowHeader,l,u;s?(l=!t&&e,u=!t&&!e):(l=t&&e,u=t&&!e),t7({addTotalMeasureInTotal:l,addMeasureInTotalQuery:u,parentNode:i,currentField:o[0],fields:o,facetCfg:n,hierarchy:a})},NMt=function(r){var t=r.facetCfg,e=r.rootNode,i=r.hierarchy,n=t.dataSet.fields.customTreeItems;u8({customTreeItems:n,facetCfg:t,level:0,parentNode:e,hierarchy:i})},kMt=function(r){var t=r.facetCfg,e=r.rootNode,i=r.hierarchy,n=t.hierarchyType,a=t.rows,o=t.dataSet;n==="tree"?c8({level:0,currentField:a[0],pivotMeta:o.rowPivotMeta,facetCfg:t,parentNode:e,hierarchy:i}):NMt(r)},UMt=function(r){var t=r.spreadsheet;t.isHierarchyTreeType()?kMt(r):h8(r)},zMt=function(r){var t=r.isPivotMode,e=r.hierarchy,i=r.rootNode,n=r.facetCfg;t?h8(r):Lbt({parentNode:i,hierarchy:e,facetCfg:n})},xC=function(r){var t=r.isRowHeader,e=r.facetCfg,i=e.spreadsheet,n=e.rows,a=n===void 0?[]:n,o=e.columns,s=o===void 0?[]:o,l=i.dataCfg.fields.valueInCols,u=i.isPivotMode(),c=e.dataSet.moreThanOneValue(),h=Gr.rootNode(),f=new j6,d={isValueInCols:l,isPivotMode:u,moreThanOneValue:c,rootNode:h,hierarchy:f,spreadsheet:i,facetCfg:e,fields:t?a:s,isRowHeader:t};t?UMt(d):zMt(d);var v=function(){return t&&i.isHierarchyTreeType()?f.getNodes():f.getLeaves()};return{hierarchy:f,leafNodes:v()}},HMt=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.renderFrozenGroupSplitLine=function(i,n){var a;if((a=e.foregroundGroup.findById(Jg))===null||a===void 0||a.remove(),e.enableFrozenFirstRow()){var o=Math.floor(n-e.getPaginationScrollY()),s=e.foregroundGroup.addGroup({id:Jg,zIndex:td}),l=Nt(e.cfg,"spreadsheet.theme.splitLine"),u={lineWidth:l==null?void 0:l.horizontalBorderWidth,stroke:l==null?void 0:l.horizontalBorderColor,opacity:l==null?void 0:l.horizontalBorderColorOpacity},c=e.cornerBBox.height,h=e.getCellRange(),f=c+e.getTotalHeightForRange(h.start,h.start),d=e.panelBBox.viewportWidth+e.layoutResult.rowsHierarchy.width+e.getSeriesNumberWidth();Xr(s,{x1:0,x2:d,y1:f,y2:f},k({},u)),l.showShadow&&o>0&&s.addShape("rect",{attrs:{x:0,y:f,width:d,height:l.shadowWidth,fill:e.getShadowFill(90)}})}},e}return t.prototype.updateFrozenGroupGrid=function(){var e=this;[Ln.FROZEN_ROW].forEach(function(i){if(e.frozenGroupInfo[i].range){var n=[],a=[];if(i.toLowerCase().includes("row")){var o=tt(e.frozenGroupInfo[i].range,2),s=o[0],l=o[1];n=e.gridInfo.cols,a=Qm(s,l,e.viewCellHeights)}e.spreadsheet["".concat(i,"Group")].updateGrid({cols:n,rows:a},"".concat(i,"Group"))}})},t.prototype.getBizRevisedFrozenOptions=function(){return Uc(this.cfg,this.layoutResult.rowNodes)},t.prototype.clip=function(e,i){var n=this.spreadsheet,a=n.isFrozenRowHeader,o=n.frozenRowGroup;if(!a.call(this.spreadsheet)){if(this.panelScrollGroupClip(e,i),this.enableFrozenFirstRow()){var s=this.getPaginationScrollY();o.setClip({type:"rect",attrs:{x:0,y:s,width:this.panelBBox.width+e,height:o.getBBox().height}})}return}r.prototype.clip.call(this,e,i)},Object.defineProperty(t.prototype,"rowCellTheme",{get:function(){return this.spreadsheet.theme.rowCell.cell},enumerable:!1,configurable:!0}),t.prototype.getContentHeight=function(){var e=this.layoutResult,i=e.rowsHierarchy,n=e.colsHierarchy;return i.height+n.height},t.prototype.doLayout=function(){var e=this,i=xC({isRowHeader:!0,facetCfg:this.cfg}),n=i.leafNodes,a=i.hierarchy,o=xC({isRowHeader:!1,facetCfg:this.cfg}),s=o.leafNodes,l=o.hierarchy;this.calculateNodesCoordinate(n,a,s,l);var u=this.cfg,c=u.dataSet,h=u.spreadsheet,f=function(v,p){var g=v||0,m=p||0,y=n[g],_=s[m];if(!y||!_)return null;var x=y.query,C=_.query,A=y.isTotals||y.isTotalMeasure||_.isTotals||_.isTotalMeasure,T=e.getMeasureInfo(),w=u0({},x,C,T),M=Rf(y,_),O=c.getCellData({query:w,rowNode:y,isTotals:A,totalStatus:M}),P=w[Zt],D=Nt(O,$i,null);return{spreadsheet:h,x:_.x,y:y.y,width:_.width,height:y.height,data:O,rowIndex:g,colIndex:m,isTotals:A,valueField:P,fieldValue:D,rowQuery:x,colQuery:C,rowId:y.id,colId:_.id,id:ov(y.id,_.id)}},d={colNodes:l.getNodes(),colsHierarchy:l,rowNodes:a.getNodes(),rowsHierarchy:a,rowLeafNodes:n,colLeafNodes:s,getCellMeta:f,spreadsheet:h};return _bt(this.cfg,d)},t.prototype.getMeasureInfo=function(){var e,i,n,a=this.cfg,o=a.dataSet,s=a.spreadsheet,l=s.options.hierarchyType,u=(i=Nt(s,"facet.cfg.colCfg.hideMeasureColumn"))!==null&&i!==void 0?i:!1;return u&&l!=="customTree"?(e={},e[Zt]=(n=o.fields.values)===null||n===void 0?void 0:n[0],e):{}},t.prototype.calculateNodesCoordinate=function(e,i,n,a){this.calculateRowNodesCoordinate(e,i,n),this.calculateColNodesCoordinate(n,a,e,i.width)},t.prototype.calculateColNodesCoordinate=function(e,i,n,a){for(var o,s,l,u=Gr.blankNode(),c=i.getNodes(),h=i.sampleNodesForAllLevels,f=0;f<h.length;f++){var d=h[f];if(d.height=this.getColNodeHeight(d),i.height+=d.height,d.level===0)d.y=0;else{var v=h[f-1];d.y=(o=(v==null?void 0:v.y)+(v==null?void 0:v.height))!==null&&o!==void 0?o:0}}for(var p=0,g=function(_){var x=c[_];if(x.isLeaf&&(x.colIndex=p,p+=1,x.x=u.x+u.width,x.width=m.calculateColLeafNodesWidth(x,e,n,a),i.width+=x.width,u=x),x.level===0)x.y=0;else{var C=i.sampleNodesForAllLevels.find(function(A){return A.level===x.level-1});x.y=(s=(C==null?void 0:C.y)+(C==null?void 0:C.height))!==null&&s!==void 0?s:0}x.height=m.getColNodeHeight(x),rC(m.cfg,null,x)},m=this,y=0;y<c.length;y++)g(y);this.autoCalculateColNodeWidthAndX(e),at((l=this.spreadsheet.options.totals)===null||l===void 0?void 0:l.col)||(this.adjustTotalNodesCoordinate({hierarchy:i,isRowHeader:!1,isSubTotal:!0}),this.adjustTotalNodesCoordinate({hierarchy:i,isRowHeader:!1,isSubTotal:!1}))},t.prototype.autoCalculateColNodeWidthAndX=function(e){for(var i,n=null,a=0,o=e.slice(0);a<o.length;){var s=o[a++],l=s.parent;if(n!==l&&l){o.push(l);var u=(i=l.children)===null||i===void 0?void 0:i.find(function(f){return f.width}),c=u==null?void 0:u.x,h=O6(l.children,"width");l.x=c,l.width=h,n=l}}},t.prototype.calculateColLeafNodesWidth=function(e,i,n,a){var o,s,l,u,c,h=this.cfg,f=h.colCfg,d=h.dataSet,v=h.filterDisplayDataItem,p=this.getCellDraggedWidth(e);if(yi(p))return p;var g=this.getCellCustomWidth(e,f==null?void 0:f.width);if(yi(g))return g;if(this.spreadsheet.getLayoutWidthType()===Zl.Compact){for(var m=this.spreadsheet.theme.colCell,y=m.bolderText,_=m.cell,x=m.icon,C=this.spreadsheet.theme.dataCell.text,A=this.spreadsheet.dataSet.getFieldFormatter(e.field),T=(o=A==null?void 0:A(e.value))!==null&&o!==void 0?o:e.label,w=this.getExpectedCellIconWidth(st.COL_CELL,this.spreadsheet.isValueInCols()&&this.spreadsheet.options.showDefaultHeaderActionIcon,x),M=this.spreadsheet.measureTextWidth(T,y)+w,O=this.getMeasureInfo(),P=void 0,D=0,z=0,Y=0;Y<p_;Y++){var H=n[Y];if(H){var N=d.getCellData({query:k(k({},e.query),H.query),rowNode:H,isTotals:e.isTotals||e.isTotalMeasure||H.isTotals||H.isTotalMeasure,totalStatus:Rf(H,e)});if(N){var W=y7(N,v),Q=(l=(s=this.spreadsheet.dataSet.getFieldFormatter(N[Zt]))===null||s===void 0?void 0:s(W))!==null&&l!==void 0?l:W,q="".concat(Q),J=u0({},H.query,e.query,O),et=J[Zt],ft=n7(this.spreadsheet.options.conditions,this.spreadsheet.theme.dataCell.icon,et),Ct=ft.size,ct=ft.margin,dt=ct.left,Rt=ct.right,le=Ct+dt+Rt,me=this.spreadsheet.measureTextWidth(q,C)+le;me>D&&(P=q,D=me,z=le)}}}var We=M>D,Ri=We?T:P,tn=We?w:z;Ha.getInstance().logger("Max Label In Col:",e.field,Ri,D);var ea=this.spreadsheet.measureTextWidth(Ri,k(k({},y),{fontSize:Math.max(C.fontSize,y.fontSize)}));return ea+((u=_.padding)===null||u===void 0?void 0:u.left)+((c=_.padding)===null||c===void 0?void 0:c.right)+tn}return this.spreadsheet.isHierarchyTreeType()?this.getAdaptTreeColWidth(e,i,n):this.getAdaptGridColWidth(i,a)},t.prototype.getColNodeHeight=function(e){var i=this.cfg.colCfg,n=Nt(i,["heightByField",e.key]);return n??(i==null?void 0:i.height)},t.prototype.getExpectedCellIconWidth=function(e,i,n){var a,o=0;if(i)o=1;else{var s=NA(se(this.spreadsheet.options.headerActionIcons,function(l){return k(k({},l),{displayCondition:function(){return!0}})}),null,e);o=(a=s==null?void 0:s.iconNames.length)!==null&&a!==void 0?a:0}return o?o*(n.size+n.margin.left)+n.margin.right:0},t.prototype.calculateRowNodesCoordinate=function(e,i,n){var a,o,s,l,u,c,h,f,d,v,p=this.cfg,g=p.cellCfg,m=p.spreadsheet,y=m.isHierarchyTreeType(),_=Nt(m,"options.style.rowCfg.heightByField",{}),x=(s=i.sampleNodesForAllLevels)!==null&&s!==void 0?s:[];if(y)i.width=this.getTreeRowHeaderWidth();else try{for(var C=Vn(i.sampleNodesForAllLevels),A=C.next();!A.done;A=C.next()){var T=A.value;T.width=this.calculateGridRowNodesWidth(T,n),i.width+=T.width;var w=(l=x[T.level-1])!==null&&l!==void 0?l:{x:0,width:0};T.x=(w==null?void 0:w.x)+(w==null?void 0:w.width)}}catch(H){a={error:H}}finally{try{A&&!A.done&&(o=C.return)&&o.call(C)}finally{if(a)throw a.error}}for(var M=Gr.blankNode(),O=i.getNodes(),P=0;P<O.length;P++){var D=O[P],z=y||!y&&D.isLeaf;if(z&&((u=D.rowIndex)!==null&&u!==void 0||(D.rowIndex=P),(c=D.colIndex)!==null&&c!==void 0||(D.colIndex=P),D.y=M.y+M.height,D.height=((h=_==null?void 0:_[D.id])!==null&&h!==void 0?h:g==null?void 0:g.height)+((f=this.rowCellTheme.padding)===null||f===void 0?void 0:f.top)+((d=this.rowCellTheme.padding)===null||d===void 0?void 0:d.bottom),M=D,i.height+=D.height),y||D.level===0)D.x=0;else{var w=x[D.level-1];D.x=(w==null?void 0:w.x)+(w==null?void 0:w.width)}if(y)D.width=this.getTreeRowHeaderWidth();else{var Y=x[D.level];D.width=Y==null?void 0:Y.width}rC(this.cfg,D,null)}y||(this.autoCalculateRowNodeHeightAndY(e),at((v=m.options.totals)===null||v===void 0?void 0:v.row)||(this.adjustTotalNodesCoordinate({hierarchy:i,isRowHeader:!0,isSubTotal:!1}),this.adjustTotalNodesCoordinate({hierarchy:i,isRowHeader:!0,isSubTotal:!0})))},t.prototype.autoCalculateRowNodeHeightAndY=function(e){for(var i=null,n=0,a=e.slice(0);n<a.length;){var o=a[n++],s=o.parent;i!==s&&s&&(a.push(s),s.y=s.children[0].y,s.height=s.children.reduce(function(l,u){return l+u.height},0),i=s)}},t.prototype.getMultipleMap=function(e,i,n){for(var a=e.maxLevel,o=this.cfg,s=o.totals,l=o.dataSet,u=l.moreThanOneValue(),c=l.fields,h=c.rows,f=c.columns,d=i?h:f,v=i?s.row:s.col,p=n?v.subTotalsGroupDimensions||[]:v.totalsGroupDimensions||[],g=l.isEmpty()?[]:p,m=Array.from({length:a+1},function(){return 1}),y=a;y>0;y--){var _=d[y],x=_===Zt&&u;g.includes(_)||x||(m[y-1]+=m[y],m[y]=0)}return m},t.prototype.adjustTotalNodesCoordinate=function(e){var i=e.hierarchy,n=e.isRowHeader,a=e.isSubTotal,o=this.getMultipleMap(i,n,a),s=qo(i.getNodes(),function(u){return a?u.isSubTotals:u.isGrandTotals}),l=n?"width":"height";Ht(s,function(u){var c,h=o[u.level];if(!h&&a)for(var f=1;h<1;)h=o[u.level-f]-f,f++;for(var d=0,v=function(g){d+=((c=i.sampleNodesForAllLevels.find(function(m){return m.level===u.level+g}))===null||c===void 0?void 0:c[l])||0},p=0;p<h;p++)v(p);u[l]=d})},t.prototype.calculateGridRowNodesWidth=function(e,i){var n=this.cfg,a=n.rowCfg,o=n.spreadsheet,s=Nt(a,["widthByField",e.key]);if(yi(s))return s;var l=this.getCellCustomWidth(e,a==null?void 0:a.width);return yi(l)?l:o.getLayoutWidthType()!==Zl.Adaptive?this.getCompactGridRowWidth(e):this.getAdaptGridColWidth(i)},t.prototype.getAdaptTreeColWidth=function(e,i,n){var a=this.getCanvasHW().width,o=a-this.getSeriesNumberWidth(),s=Math.min(o/2,this.getTreeRowHeaderWidth()),l=Math.max(1,i.length),u=this.cfg.cellCfg;return Math.max(T_(u,this.getColLabelLength(e,n)),(o-s)/l)},t.prototype.getColLabelLength=function(e,i){var n,a=t2t(e==null?void 0:e.value);if(It(a))return a.length;for(var o=1,s=0;s<p_;s++){var l=i[s];if(!l)return o;for(var u=this.cfg.dataSet.getCellData({query:k(k({},e.query),l.query),rowNode:l,isTotals:e.isTotals||e.isTotalMeasure||l.isTotals||l.isTotalMeasure,totalStatus:Rf(l,e)}),c=ir(u==null?void 0:u[xS]),h=0;h<c.length;h++){var f=u[c[h]],d=qu((n=f==null?void 0:f.values)===null||n===void 0?void 0:n[0]);d>o&&(o=d)}}return o},t.prototype.getAdaptGridColWidth=function(e,i){var n=this.cfg,a=n.rows,o=n.cellCfg,s=a.length,l=e.length,u=this.getCanvasHW().width,c=u-this.getSeriesNumberWidth(),h=Math.max(1,s+l);return i?Math.max(T_(o),(c-i)/l):Math.max(T_(o),c/h)},t.prototype.getTreeRowHeaderWidth=function(){var e,i,n,a,o=this.cfg,s=o.rows,l=o.dataSet,u=o.rowCfg,c=o.treeRowsWidth,h=c??(u==null?void 0:u.treeRowsWidth);if(yi(h))return h;var f=this.getCellCustomWidth(null,u==null?void 0:u.width);if(yi(f))return f;var d=s.map(function(_){return l.getFieldName(_)}).join("/"),v=this.spreadsheet.theme.cornerCell,p=v.bolderText,g=v.icon,m=1+this.spreadsheet.measureTextWidth(d,p)+g.size*2+((e=g.margin)===null||e===void 0?void 0:e.left)+((i=g.margin)===null||i===void 0?void 0:i.right)+((n=this.rowCellTheme.padding)===null||n===void 0?void 0:n.left)+((a=this.rowCellTheme.padding)===null||a===void 0?void 0:a.right),y=Math.max(h??R3,m);return Number.isNaN(y)?R3:y},t.prototype.getCompactGridRowWidth=function(e){var i=this,n,a=this.cfg,o=a.dataSet,s=a.spreadsheet,l=s.theme.rowCell,u=l.bolderText,c=l.icon,h=l.cell,f=s.theme.cornerCell,d=f.bolderText,v=f.icon,p=f.cell,g=e.field,m=e.isLeaf,y=this.getExpectedCellIconWidth(st.ROW_CELL,!s.isValueInCols()&&m&&s.options.showDefaultHeaderActionIcon,c),_=(n=o.getDimensionValues(g))===null||n===void 0?void 0:n.slice(0,p_).map(function(M){var O,P;return(P=(O=i.spreadsheet.dataSet.getFieldFormatter(g))===null||O===void 0?void 0:O(M))!==null&&P!==void 0?P:M}),x=oA(_,function(M){return"".concat(M).length}),C=s.measureTextWidth(x,u)+y+h.padding.left+h.padding.right,A=o.getFieldName(g),T=this.getExpectedCellIconWidth(st.CORNER_CELL,!1,v),w=s.measureTextWidth(A,d)+T+p.padding.left+p.padding.right;return Ha.getInstance().logger("Max Label In Row:",g,C>w?x:A),Math.max(C,w)},t.prototype.getViewCellHeights=function(e){var i=e.rowLeafNodes,n=km(i,function(a,o){return a.push(Pe(a)+o.height),a},[0]);return{getTotalHeight:function(){return Pe(n)||0},getCellOffsetY:function(a){return n[a]||0},getTotalLength:function(){return n.length-1},getIndexRange:function(a,o){return r8(n,a,o)}}},t.prototype.getRowHeader=function(){if(!this.rowHeader){var e=this.getRowHeaderCfg(),i=e.viewportHeight,n=cm(e,["viewportHeight"]),a=Uc(this.cfg,this.layoutResult.rowNodes).frozenRowHeight;return new FMt(k(k({},n),{viewportHeight:i-a}))}},t.prototype.enableFrozenFirstRow=function(){return!!this.getBizRevisedFrozenOptions().frozenRowCount},t}(l8),$Mt=function(r){gt(t,r);function t(e){var i=this,n,a,o;i=r.call(this,e)||this,i.getScrollGroupClipBBox=function(){var v,p=i.headerConfig,g=p.width,m=p.height,y=p.scrollX,_=p.spreadsheet,x=_.options;if(!x.frozenColCount&&!x.frozenTrailingColCount)return{x:y,y:0,width:g,height:m};for(var C=(v=_.facet)===null||v===void 0?void 0:v.layoutResult.colLeafNodes,A=Es(_.options,C.length),T=A.frozenColCount,w=A.frozenTrailingColCount,M=0,O=0,P=0;P<T;P++)M+=C[P].width;for(var P=0;P<w;P++)O+=C[C.length-1-P].width;var D=g-M-O;return{x:y+M,y:0,width:D,height:m}};var s=(n=i.headerConfig.spreadsheet)===null||n===void 0?void 0:n.options,l=s.frozenColCount,u=s.frozenTrailingColCount,c=(o=(a=i.headerConfig.spreadsheet)===null||a===void 0?void 0:a.facet)===null||o===void 0?void 0:o.layoutResult.colNodes.filter(function(v){return $a(v)}),h=f0(c,l,u),f=h.colCount,d=h.trailingColCount;return i.finalColCount=f,i.finalTrailingColCount=d,f&&(i.frozenColGroup=i.addGroup({name:Nct,zIndex:td})),d&&(i.frozenTrailingColGroup=i.addGroup({name:kct,zIndex:td})),i}return t.prototype.isFrozenCell=function(e){var i=this.headerConfig.spreadsheet,n=i==null?void 0:i.options,a=n.frozenColCount,o=n.frozenTrailingColCount,s=e.colIndex,l=i==null?void 0:i.facet.layoutResult.colLeafNodes;return Fl(s,a)||Bl(s,o,l.length)},t.prototype.clear=function(){var e,i,n=this.headerConfig.spreadsheet;r.prototype.clear.call(this),(e=this.frozenTrailingColGroup)===null||e===void 0||e.clear(),(i=this.frozenColGroup)===null||i===void 0||i.clear();var a=n==null?void 0:n.foregroundGroup.findById(a4);a==null||a.clear()},t.prototype.getCellInstance=function(e,i,n){return e.field===jl?new Twt(e,i,n):new w7(e,i,n)},t.prototype.getCellGroup=function(e){var i,n=this.headerConfig.spreadsheet,a=iC(e).colIndex;return Fl(a,this.finalColCount)?this.frozenColGroup:Bl(a,this.finalTrailingColCount,(i=n==null?void 0:n.facet)===null||i===void 0?void 0:i.layoutResult.colLeafNodes.length)?this.frozenTrailingColGroup:this.scrollGroup},t.prototype.isColCellInRect=function(e){var i,n=this.headerConfig.spreadsheet,a=(i=n==null?void 0:n.facet)===null||i===void 0?void 0:i.layoutResult.colLeafNodes.length,o=iC(e).colIndex;return Fl(o,this.finalColCount)||Bl(o,this.finalTrailingColCount,a)?!0:r.prototype.isColCellInRect.call(this,e)},t.prototype.clip=function(){this.scrollGroup.setClip({type:"rect",attrs:this.getScrollGroupClipBBox()})},t}(ZA),WMt=function(r){gt(t,r);function t(e){var i=r.call(this,e)||this;i.onSortHandler=function(a){var o=i.spreadsheet,s=a;Array.isArray(a)||(s=[a]);var l=o.dataCfg.sortParams||[];s=s.map(function(c){var h,f,d=k(k({},c),{sortFieldId:(h=c.sortKey)!==null&&h!==void 0?h:c.sortFieldId}),v=(f=l.find(function(p){return p.sortFieldId===d.sortFieldId}))!==null&&f!==void 0?f:{};return k(k({},v),d)});var u=l.filter(function(c){var h=s.find(function(f){return f.sortFieldId===c.sortFieldId});return!h});sd(o.dataCfg,"sortParams",ht(ht([],tt(u),!1),tt(s),!1)),o.setDataCfg(o.dataCfg),o.render(!0),o.emit(G.RANGE_SORTED,o.dataSet.getDisplayDataSet())},i.onFilterHandler=function(a){var o=i.spreadsheet,s=!a.filteredValues||a.filteredValues.length===0,l=o.dataCfg.filterParams||[],u=l.findIndex(function(c){return c.filterKey===a.filterKey});u!==-1?s?l.splice(u,1):l[u]=a:l.push(a),sd(o.dataCfg,"filterParams",l),o.render(!0),o.emit(G.RANGE_FILTERED,o.dataSet.getDisplayDataSet())},i.renderFrozenPanelCornerGroup=function(){var a=i.layoutResult.colNodes.filter(function(g){return $a(g)}),o=i.getCellRange(),s=Es(i.spreadsheet.options,a.length,o.end-o.start+1),l=s.frozenRowCount,u=s.frozenColCount,c=s.frozenTrailingRowCount,h=s.frozenTrailingColCount,f=f0(a,u,h),d=f.colCount,v=f.trailingColCount,p=Abt({frozenRowCount:l,frozenColCount:d,frozenTrailingRowCount:c,frozenTrailingColCount:v},i.layoutResult.colLeafNodes.length,o);Object.keys(p).forEach(function(g){var m=p[g],y=i.spreadsheet[c4[g]];y&&m.forEach(function(_){i.addFrozenCell(_.x,_.y,y)})})},i.addFrozenCell=function(a,o,s){var l=i.layoutResult.getCellMeta(o,a);if(l.isFrozenCorner=!0,l){var u=i.cfg.dataCell(l);s.add(u)}};var n=i.spreadsheet;return n.on(G.RANGE_SORT,i.onSortHandler),n.on(G.RANGE_FILTER,i.onFilterHandler),i}return t.prototype.updateRowResizeArea=function(){var e=this.spreadsheet,i=e.foregroundGroup,n=e.options,a=Nt(n,"interaction.resize"),o=za(a)?a:a==null?void 0:a.rowCellVertical;if(o){var s=i.findById(Fc),l=i.findById(i4);s&&s.set("children",[]),l&&l.set("children",[]);var u=Mf(this.panelGroup.getChildren(),Ym).filter(function(c){return c.shouldDrawResizeArea()});u==null||u.forEach(function(c){c.drawResizeArea()})}},t.prototype.clip=function(e,i){r.prototype.clip.call(this,e,i),this.clipResizeAreaGroup()},t.prototype.clipResizeAreaGroup=function(){var e,i,n=this.spreadsheet.foregroundGroup.findById(Fc);if(n){var a=this.layoutResult.colLeafNodes,o=this.spreadsheet,s=o.frozenRowGroup,l=o.frozenTrailingRowGroup,u=0,c=0;s&&(u=s.getBBox().height),l&&(c=l.getBBox().height);var h=this.panelBBox.height-u-c;n.setClip({type:"rect",attrs:{x:0,y:u+this.cornerBBox.height,width:(i=(e=a==null?void 0:a[0])===null||e===void 0?void 0:e.width)!==null&&i!==void 0?i:0,height:h}})}},t.prototype.getContentHeight=function(){var e=this.getViewCellHeights().getTotalHeight,i=this.layoutResult.colsHierarchy;return e()+i.height},Object.defineProperty(t.prototype,"dataCellTheme",{get:function(){return this.spreadsheet.theme.dataCell.cell},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){var e=this.spreadsheet;e.off(G.RANGE_SORT,this.onSortHandler),e.off(G.RANGE_FILTER,this.onFilterHandler),r.prototype.destroy.call(this)},t.prototype.calculateCornerBBox=function(){var e=this.layoutResult.colsHierarchy,i=Math.floor(e.height);this.cornerBBox=new a8(this),this.cornerBBox.height=i,this.cornerBBox.maxY=i},t.prototype.doLayout=function(){var e=this,i=this.cfg,n=i.dataSet,a=i.spreadsheet,o=new j6,s=xC({isRowHeader:!1,facetCfg:this.cfg}),l=s.leafNodes,u=s.hierarchy;this.calculateColNodesCoordinate(l,u);var c=function(f,d){var v,p=e.cfg.showSeriesNumber,g=l[d],m=e.getCellHeight(f),y=e.getCellRange(),_=Es(e.cfg,l.length,y.end-y.start+1).frozenTrailingRowCount,x,C=g.x,A=e.viewCellHeights.getCellOffsetY(f);return nv(f,y.end,_)&&(A=e.panelBBox.maxY-e.getTotalHeightForRange(f,y.end)),p&&g.field===jl?x="".concat(f+1):x=n.getCellData({query:{field:g.field,rowIndex:f}}),{spreadsheet:a,x:C,y:A,width:g.width,height:m,data:(v={},v[g.field]=x,v),rowIndex:f,colIndex:d,isTotals:!1,colId:g.id,rowId:String(f),valueField:g.field,fieldValue:x,id:ov(String(f),g.id)}},h={colNodes:u.getNodes(),colsHierarchy:u,rowNodes:o.getNodes(),rowsHierarchy:o,rowLeafNodes:o.getLeaves(),colLeafNodes:l,getCellMeta:c,spreadsheet:a};return h},t.prototype.getAdaptiveColWidth=function(e){var i=this.cfg.cellCfg,n=this.cfg.showSeriesNumber;if(this.spreadsheet.getLayoutWidthType()!==Zl.Compact){var a=this.getSeriesNumberWidth(),o=e.length-(n?1:0),s=this.getCanvasHW().width-a;return Math.max(i==null?void 0:i.width,s/Math.max(1,o))}return i==null?void 0:i.width},t.prototype.getColNodeHeight=function(e,i){var n=this.cfg.colCfg,a=Ko(n==null?void 0:n.heightByField)[0],o=a||(n==null?void 0:n.height);if(!i||e.children&&e.children.length)return o;for(;e.parent;)i-=$a(e)?0:o,e=e.parent;return i},t.prototype.calculateColNodesCoordinate=function(e,i){var n,a,o,s,l,u,c=Gr.blankNode(),h=i.getNodes();try{for(var f=Vn(i.sampleNodesForAllLevels),d=f.next();!d.done;d=f.next()){var v=d.value;v.height=this.getColNodeHeight(v),i.height+=v.height}}catch(w){n={error:w}}finally{try{d&&!d.done&&(a=f.return)&&a.call(f)}finally{if(n)throw n.error}}for(var p=this.getAdaptiveColWidth(e),g=0,m=0;m<h.length;m++){var y=h[m];y.isLeaf&&(y.colIndex=g,g+=1,y.x=c.x+c.width,y.width=this.calculateColLeafNodesWidth(y,p),rC(this.cfg,null,y),i.width+=y.width,c=y),y.level===0?y.y=0:y.y=(l=((o=y.parent)===null||o===void 0?void 0:o.y)+((s=y.parent)===null||s===void 0?void 0:s.height))!==null&&l!==void 0?l:0,y.height=this.getColNodeHeight(y,i.height)}var _=h.filter(function(w){return $a(w)}),x=Es((u=this.spreadsheet)===null||u===void 0?void 0:u.options,_.length).frozenTrailingColCount;c=Gr.blankNode();var C=this.getCanvasHW().width;if(x>0)for(var A=f0(_,0,x).trailingColCount,T=h.filter(function(w){return w.isLeaf}),m=1;m<=A;m++){var y=T[T.length-m];m===1?y.x=C-y.width:y.x=c.x-y.width,c=y}this.autoCalculateColNodeWidthAndX(e)},t.prototype.autoCalculateColNodeWidthAndX=function(e){for(var i=null,n=e.slice(0);n.length;){var a=n.shift(),o=a.parent;i!==o&&o&&(n.push(o),o.x=o.children[0].x,o.width=o.children.map(function(s){return s.width}).reduce(function(s,l){return s+l},0),i=o)}},t.prototype.calculateColLeafNodesWidth=function(e,i){var n=this.cfg,a=n.colCfg,o=n.dataSet,s=n.spreadsheet,l=this.spreadsheet.getLayoutWidthType(),u=this.getCellDraggedWidth(e);if(yi(u))return u;var c=this.getCellCustomWidth(e,a==null?void 0:a.width);if(yi(c))return c;var h;if(l===Zl.Compact){var f=o.getDisplayDataSet(),d=o.getFieldFormatter(e.field),v=oA(f==null?void 0:f.slice(0,50).map(function(A){var T;return"".concat((T=d==null?void 0:d(A[e.field]))!==null&&T!==void 0?T:A[e.field])}),function(A){return s.measureTextWidthRoughly(A)});Ha.getInstance().logger("Max Label In Col:",e.field,v);var p=s.theme.colCell.bolderText,g=s.theme.dataCell,m=g.text,y=g.cell,_=1,x=s.measureTextWidth(v,m)+y.padding.left+y.padding.right+_,C=s.measureTextWidth(e.label,p)+Awt(this.spreadsheet,e,s.theme.colCell);h=Math.max(C,x)}else h=i;return e.field===jl&&(h=this.getSeriesNumberWidth()),h},t.prototype.initRowOffsets=function(){var e=this,i,n=this.cfg.dataSet,a=(((i=this.spreadsheet.options.style)===null||i===void 0?void 0:i.rowCfg)||{}).heightByField,o=a===void 0?{}:a;if(Object.keys(o).length){var s=n.getDisplayDataSet();this.rowOffsets=[0];var l=0;s.forEach(function(u,c){var h,f=(h=o==null?void 0:o[String(c)])!==null&&h!==void 0?h:e.getDefaultCellHeight(),d=l+f;e.rowOffsets.push(d),l=d})}},t.prototype.getCellHeight=function(e){var i;if(this.rowOffsets){var n=(((i=this.spreadsheet.options.style)===null||i===void 0?void 0:i.rowCfg)||{}).heightByField,a=n===void 0?{}:n,o=a==null?void 0:a[String(e)];if(yi(o))return o}return this.getDefaultCellHeight()},t.prototype.getViewCellHeights=function(){var e=this,i=this.cfg.dataSet,n=this.getDefaultCellHeight();return{getTotalHeight:function(){return e.rowOffsets?Pe(e.rowOffsets):n*i.getDisplayDataSet().length},getCellOffsetY:function(a){if(a<=0)return 0;if(e.rowOffsets)return e.rowOffsets[a];for(var o=0,s=0;s<a;s++)o+=n;return o},getTotalLength:function(){return i.getDisplayDataSet().length},getIndexRange:function(a,o){if(e.rowOffsets)return r8(e.rowOffsets,a,o);var s=Math.floor(a/n),l=o%n===0?o/n-1:Math.floor(o/n);return{start:Math.max(0,s),end:Math.max(0,l)}}}},t.prototype.init=function(){this.initRowOffsets(),r.prototype.init.call(this);var e=this.panelBBox,i=e.width,n=e.height;this.spreadsheet.panelGroup.setClip({type:"rect",attrs:{x:0,y:this.cornerBBox.height,width:i,height:n}})},t.prototype.getColHeader=function(){if(!this.columnHeader){var e=this.panelBBox,i=e.x,n=e.width,a=e.viewportHeight,o=e.viewportWidth;return new $Mt({width:n,height:this.cornerBBox.height,viewportWidth:o,viewportHeight:a,cornerWidth:this.cornerBBox.width,position:{x:i,y:0},data:this.layoutResult.colNodes,scrollContainsRowHeader:this.cfg.spreadsheet.isScrollContainsRowHeader(),sortParam:this.cfg.spreadsheet.store.get("sortParam"),spreadsheet:this.spreadsheet})}return this.columnHeader},t.prototype.render=function(){this.renderFrozenPanelCornerGroup(),r.prototype.render.call(this)},t.prototype.getRowHeader=function(){return null},t.prototype.getSeriesNumberHeader=function(){return null},t}(l8),f8=function(r){gt(t,r);function t(e){var i=r.call(this,e)||this;return i.gridInfo={cols:[],rows:[]},i.updateGrid=function(n,a){a===void 0&&(a=E3);var o=i.getBBox(),s=i.s2,l=s.theme,u=s.isTableMode,c=l.dataCell.cell,h=u()&&(a===E3||a===r4);(!i.gridGroup||!i.findById(a))&&(i.gridGroup=i.addGroup({id:a})),i.gridGroup.clear(),i.gridInfo=n,h&&i.gridInfo.cols.unshift(0);var f=c.verticalBorderWidth,d=c.verticalBorderWidth/2;i.gridInfo.cols.forEach(function(g){Xr(i.gridGroup,{x1:g,x2:g,y1:Math.ceil(o.minY+d),y2:Math.floor(o.maxY-d)},{stroke:c.verticalBorderColor,strokeOpacity:c.verticalBorderColorOpacity,lineWidth:f,lineCap:T3,lineDash:c.borderDash})});var v=c.horizontalBorderWidth,p=c.horizontalBorderWidth/2;i.gridInfo.rows.forEach(function(g){Xr(i.gridGroup,{x1:Math.ceil(o.minX+p),x2:Math.floor(o.maxX-p),y1:g,y2:g},{stroke:c.horizontalBorderColor,strokeOpacity:c.horizontalBorderColorOpacity,lineWidth:v,lineCap:T3,lineDash:c.borderDash})}),i.gridGroup.toFront()},i.s2=e.s2,i}return t}(no),d8=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t}(f8),VMt=function(r){gt(t,r);function t(e){var i=r.call(this,e)||this;return i.initMergedCellsGroup(),i}return t.prototype.initMergedCellsGroup=function(){this.mergedCellsGroup&&this.findById(x3)||(this.mergedCellsGroup=this.addGroup({id:x3}))},t.prototype.updateMergedCells=function(){this.initMergedCellsGroup(),lwt(this.s2,this.mergedCellsGroup),this.mergedCellsGroup.toFront()},t.prototype.addMergeCell=function(e){var i;(i=this.mergedCellsGroup)===null||i===void 0||i.add(e)},t.prototype.update=function(e){this.updateGrid(e),this.updateMergedCells()},t}(f8),Ia=function(){function r(t){var e=this;this.isLinkFieldText=function(i){var n=e.getCellAppendInfo(i);return n==null?void 0:n.isLinkFieldText},this.spreadsheet=t,this.bindEvents()}return r.prototype.getCellAppendInfo=function(t){var e,i;return((e=t==null?void 0:t.attr)===null||e===void 0?void 0:e.call(t,"appendInfo"))||((i=t==null?void 0:t.attrs)===null||i===void 0?void 0:i.appendInfo)||{}},r.prototype.reset=function(){},r}(),GMt=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.bindEvents=function(){this.bindDataCellClick()},t.prototype.bindDataCellClick=function(){var e=this;this.spreadsheet.on(G.DATA_CELL_CLICK,function(i){var n;i.stopPropagation();var a=e.spreadsheet.interaction;if(a.clearHoverTimer(),!a.hasIntercepts([Vt.CLICK])){if(e.isLinkFieldText(i.target)){e.emitLinkFieldClickEvent(i);return}var o=e.spreadsheet.getCell(i.target),s=o.getMeta();if(s){if(a.addIntercepts([Vt.HOVER]),a.isSelectedCell(o)){((n=i.originalEvent)===null||n===void 0?void 0:n.detail)===1&&(a.reset(),e.spreadsheet.emit(G.GLOBAL_SELECTED,a.getActiveCells()));return}a.changeState({cells:[Ya(o)],stateName:At.SELECTED,onUpdateCells:zA}),e.spreadsheet.emit(G.GLOBAL_SELECTED,[o]),e.showTooltip(i,s);var l=s.rowId,u=s.colId,c=s.spreadsheet,h=a.getSelectedCellHighlight(),f=h.colHeader,d=h.rowHeader;if(f&&m7(u,a.getAllColHeaderCells(),At.SELECTED),d&&l){var v=Wwt(s,c);Ht(v,function(p){p.updateByState(At.SELECTED)})}}}})},t.prototype.getTooltipOperator=function(e,i){var n=this,a=HTt(),o=this.spreadsheet.getCell(e.target),s=GA(this.spreadsheet,e).operation,l=s.trend&&k(k({},a),{onClick:function(){n.spreadsheet.emit(G.DATA_CELL_TREND_ICON_CLICK,k(k({},i),{record:n.spreadsheet.isTableMode()?n.spreadsheet.dataSet.getCellData({query:{rowIndex:i.rowIndex}}):void 0})),n.spreadsheet.hideTooltip()}});return Y7(s,{defaultMenus:[l],cell:o})},t.prototype.showTooltip=function(e,i){var n=i.data,a=i.isTotals,o=a===void 0?!1:a,s=i.value,l=i.fieldValue,u=i.field,c=i.valueField,h=n,f=this.spreadsheet.isTableMode(),d=f?k(k({},h),{value:s||l,valueField:u||c}):h,v=[d||k(k({},i.rowQuery),i.colQuery)],p=this.getTooltipOperator(e,i);this.spreadsheet.showTooltipWithInfo(e,v,{isTotals:o,operator:p,enterable:!0,hideSummary:!0,showSingleTips:f})},t.prototype.emitLinkFieldClickEvent=function(e){var i=this.getCellAppendInfo(e.target).cellData,n=i.valueField,a=i.data;this.spreadsheet.emit(G.GLOBAL_LINK_FIELD_JUMP,{key:n,cellData:i,record:Object.assign({rowIndex:i.rowIndex},a)})},t}(Ia),XMt=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.bindEvents=function(){this.bindDataCellClick()},t.prototype.bindDataCellClick=function(){var e=this;this.spreadsheet.on(G.MERGED_CELLS_CLICK,function(i){i.stopPropagation();var n=e.spreadsheet.interaction;n.hasIntercepts([Vt.CLICK])||n.addIntercepts([Vt.HOVER])})},t}(Ia),YMt=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isMultiSelection=!1,e.handleRowColClick=function(i){if(i.stopPropagation(),!e.isLinkFieldText(i.target)){var n=e.spreadsheet,a=n.interaction,o=n.options,s=e.spreadsheet.getCell(i.target),l=o.interaction.multiSelection,u=!!(l&&e.isMultiSelection),c=a.selectHeaderCell({cell:s,isMultiSelection:u});c&&e.showTooltip(i)}},e.getHideColumnField=function(i){return e.spreadsheet.isTableMode()?i.field:i.id},e}return t.prototype.bindEvents=function(){this.bindKeyboardDown(),this.bindKeyboardUp(),this.bindColCellClick(),this.bindRowCellClick(),this.bindTableColExpand(),this.bindMouseMove()},t.prototype.reset=function(){this.isMultiSelection=!1,this.spreadsheet.interaction.removeIntercepts([Vt.CLICK])},t.prototype.bindKeyboardDown=function(){var e=this;this.spreadsheet.on(G.GLOBAL_KEYBOARD_DOWN,function(i){m0(i)&&(e.isMultiSelection=!0)})},t.prototype.bindKeyboardUp=function(){var e=this;this.spreadsheet.on(G.GLOBAL_KEYBOARD_UP,function(i){m0(i)&&e.reset()})},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(G.GLOBAL_MOUSE_MOVE,function(i){e.isMultiSelection&&!O7(i)&&e.reset()})},t.prototype.bindRowCellClick=function(){var e=this;this.spreadsheet.on(G.ROW_CELL_CLICK,function(i){e.handleRowColClick(i)})},t.prototype.bindColCellClick=function(){var e=this;this.spreadsheet.on(G.COL_CELL_CLICK,function(i){e.handleRowColClick(i)})},t.prototype.showTooltip=function(e){var i=GA(this.spreadsheet,e),n=i.operation,a=i.showTooltip;if(a){var o=this.spreadsheet.interaction,s=o.isSelectedState()?tMt(o.getActiveCells()):[],l=this.getTooltipOperator(e,n);this.spreadsheet.showTooltipWithInfo(e,s,{showSingleTips:!0,operator:l})}},t.prototype.getTooltipOperator=function(e,i){var n=this,a=this.spreadsheet.getCell(e.target),o=a.getMeta(),s=a.cellType===st.COL_CELL,l=this.spreadsheet.getColumnLeafNodes().length===1,u=zTt(),c=s&&!l&&o.isLeaf&&i.hiddenColumns,h=c&&k(k({},u),{onClick:function(){n.hideSelectedColumns()}});return Y7(i,{defaultMenus:[h],cell:a})},t.prototype.bindTableColExpand=function(){var e=this;this.spreadsheet.on(G.LAYOUT_COLS_EXPANDED,function(i){e.handleExpandIconClick(i)})},t.prototype.hideSelectedColumns=function(){var e=this.spreadsheet.interaction,i=e.getActiveCells().map(function(a){return a.getMeta()}),n=i.map(this.getHideColumnField);BA(this.spreadsheet,n,!0)},t.prototype.handleExpandIconClick=function(e){var i=this.spreadsheet.store.get("hiddenColumnsDetail",[]),n=(Om(i,function(c){var h=c.displaySiblingNode;return sC(h,e.id)})||{}).hideColumnNodes,a=n===void 0?[]:n,o=this.spreadsheet.options.interaction.hiddenColumnFields,s=a.map(this.getHideColumnField),l=NN(o,s),u=i.filter(function(c){var h=c.displaySiblingNode;return!sC(h,e.id)});this.spreadsheet.setOptions({interaction:{hiddenColumnFields:l}}),this.spreadsheet.store.set("hiddenColumnsDetail",u),this.spreadsheet.interaction.reset(),this.spreadsheet.render(!1)},t}(Ia),jMt=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.getRowData=function(i){var n,a=i.getHeadLeafChild(),o=e.spreadsheet.dataSet.getMultiData(a==null?void 0:a.query)[0];return k(k({},o),{rowIndex:(n=i.rowIndex)!==null&&n!==void 0?n:a.rowIndex})},e}return t.prototype.bindEvents=function(){this.bindRowCellClick()},t.prototype.bindRowCellClick=function(){var e=this;this.spreadsheet.on(G.ROW_CELL_CLICK,function(i){if(!e.spreadsheet.interaction.hasIntercepts([Vt.CLICK])&&e.isLinkFieldText(i.target)){var n=e.getCellAppendInfo(i.target).cellData,a=n.key,o=e.getRowData(n);e.spreadsheet.emit(G.GLOBAL_LINK_FIELD_JUMP,{key:a,cellData:n,record:o})}})},t}(Ia),ZMt=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.bindEvents=function(){this.bindCornerCellClick()},t.prototype.bindCornerCellClick=function(){var e=this;this.spreadsheet.on(G.CORNER_CELL_CLICK,function(i){var n,a=e.spreadsheet.interaction,o=e.spreadsheet.getCell(i.target);if(o){var s=o.getMeta(),l=e.getRowNodesByField(s==null?void 0:s.field),u=(n=l[0])===null||n===void 0?void 0:n.belongsCell,c=e.getRowCells(l);if(u&&a.isSelectedCell(u)){a.reset(),e.spreadsheet.emit(G.GLOBAL_SELECTED,a.getActiveCells());return}at(l)||at(c)||(a.addIntercepts([Vt.HOVER]),a.changeState({cells:c,stateName:At.SELECTED}),a.highlightNodes(l),e.showTooltip(i),e.spreadsheet.emit(G.GLOBAL_SELECTED,a.getActiveCells()))}})},t.prototype.getRowNodesByField=function(e){return this.spreadsheet.getRowNodes().filter(function(i){return i.field===e})},t.prototype.getRowCells=function(e){return e.map(function(i){return{id:i.id,colIndex:-1,rowIndex:-1,type:st.ROW_CELL}})},t.prototype.showTooltip=function(e){var i=this.spreadsheet.interaction.getActiveCells();this.spreadsheet.showTooltipWithInfo(e,[],{data:{summaries:[{selectedData:i,name:"",value:null}]}})},t}(Ia),qMt=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.bindEvents=function(){this.bindCornerCellHover(),this.bindDataCellHover(),this.bindRowCellHover(),this.bindColCellHover()},t.prototype.updateRowColCells=function(e){var i=e.rowId,n=e.colId,a=this.spreadsheet.interaction,o=a.getHoverHighlight(),s=o.rowHeader,l=o.colHeader;if(l&&m7(n,a.getAllColHeaderCells(),At.HOVER),s&&i){var u=PA(i,a.getAllRowHeaderCells(),this.spreadsheet.isHierarchyTreeType());Ht(u,function(c){c.updateByState(At.HOVER)})}},t.prototype.changeStateToHoverFocus=function(e,i,n){var a=this,o,s=this.spreadsheet.interaction,l=this.spreadsheet.options.interaction,u=l.hoverFocus;s.clearHoverTimer();var c=function(){if(!s.hasIntercepts([Vt.HOVER])){s.changeState({cells:[Ya(e)],stateName:At.HOVER_FOCUS});var d=a.spreadsheet.isTableMode(),v={isTotals:n.isTotals,enterable:!0,hideSummary:!0,showSingleTips:d},p=s.getHoverHighlight(),g=p.rowHeader,m=p.colHeader;(g||m)&&a.updateRowColCells(n);var y=a.getCellData(n,d);a.spreadsheet.showTooltipWithInfo(i,y,v)}},h=Px;if(za(u)||(h=(o=u==null?void 0:u.duration)!==null&&o!==void 0?o:Px),h===0)c();else{var f=window.setTimeout(function(){return c()},h);s.setHoverTimer(f)}},t.prototype.handleHeaderHover=function(e){var i=this.spreadsheet.getCell(e.target);if(!at(i)){var n=this.spreadsheet.interaction;n.clearHoverTimer(),!n.isActiveCell(i)&&(n.changeState({cells:[Ya(i)],stateName:At.HOVER}),i.update(),this.showEllipsisTooltip(e,i))}},t.prototype.showEllipsisTooltip=function(e,i){if(!i||!i.isTextOverflowing()){this.spreadsheet.hideTooltip();return}var n=i.getMeta(),a=!0,o={isTotals:n.isTotals,enterable:!0,hideSummary:!0,showSingleTips:a,enableFormat:!0},s=this.getCellData(n,a);this.spreadsheet.showTooltipWithInfo(e,s,o)},t.prototype.getCellData=function(e,i){e===void 0&&(e={});var n=e.data,a=e.query,o=e.value,s=e.field,l=e.fieldValue,u=e.valueField,c=e.rowQuery,h=e.colQuery,f=n,d=i?[k(k({},a),{value:o||l,valueField:s||u})]:[f||k(k({},c),h)];return d},t.prototype.bindDataCellHover=function(){var e=this;this.spreadsheet.on(G.DATA_CELL_HOVER,function(i){var n=e.spreadsheet.getCell(i.target);if(!at(n)){var a=e.spreadsheet,o=a.interaction,s=a.options,l=s.interaction,u=n==null?void 0:n.getMeta();if(!o.isActiveCell(n)){o.changeState({cells:[Ya(n)],stateName:At.HOVER});var c=o.getHoverHighlight(),h=c.rowHeader,f=c.colHeader;(h||f)&&e.updateRowColCells(u),l.hoverFocus&&e.changeStateToHoverFocus(n,i,u)}}})},t.prototype.bindRowCellHover=function(){var e=this;this.spreadsheet.on(G.ROW_CELL_HOVER,function(i){e.handleHeaderHover(i)})},t.prototype.bindColCellHover=function(){var e=this;this.spreadsheet.on(G.COL_CELL_HOVER,function(i){e.handleHeaderHover(i)})},t.prototype.bindCornerCellHover=function(){var e=this;this.spreadsheet.on(G.CORNER_CELL_HOVER,function(i){e.handleHeaderHover(i)})},t}(Ia),KA=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.displayedCells=[],e.brushRangeCells=[],e.brushSelectionStage=ei.UN_DRAGGED,e.brushSelectionMinimumMoveDistance=5,e.scrollAnimationComplete=!0,e.mouseMoveDistanceFromCanvas=0,e.setMoveDistanceFromCanvas=function(i,n,a){var o=0;if(n&&(o=i.x),a){var s=i.y;n?o=Math.max(s,o):o=s}e.mouseMoveDistanceFromCanvas=Math.abs(o)},e.formatBrushPointForScroll=function(i,n){var a,o,s,l;n===void 0&&(n=!1);var u=i.x,c=i.y,h=e.spreadsheet.facet,f=n?h.cornerBBox:h.panelBBox,d=f.minX,v=f.maxX,p=h.panelBBox,g=p.minY,m=p.maxY,y=((a=e.endBrushPoint)===null||a===void 0?void 0:a.x)+u,_=((o=e.endBrushPoint)===null||o===void 0?void 0:o.y)+c,x=!0,C=!0,A=(l=(s=h.vScrollBar)===null||s===void 0?void 0:s.getBBox())===null||l===void 0?void 0:l.width,T=2;return y>v?y=v-A-T:y<d?y=d+T:x=!1,_>m?_=m-T:_<=g?_=g+T:C=!1,{x:{value:y,needScroll:x},y:{value:_,needScroll:C}}},e.rectanglesIntersect=function(i,n){return i.maxX>n.minX&&i.minX<n.maxX&&i.minY<n.maxY&&i.maxY>n.minY},e.autoScrollIntervalId=null,e.autoScrollConfig=Hx(w3),e.validateYIndex=function(i){var n,a,o=e.spreadsheet.facet,s=o.frozenGroupInfo,l=0,u=(n=s==null?void 0:s.frozenRow)===null||n===void 0?void 0:n.range;if(u&&(l=u[1]+1),i<l)return null;var c=o.getCellRange().end,h=(a=s==null?void 0:s.frozenTrailingRow)===null||a===void 0?void 0:a.range;return h&&(c=h[0]-1),i>c?null:i},e.validateXIndex=function(i){var n,a,o=e.spreadsheet.facet,s=o.frozenGroupInfo,l=0,u=(n=s==null?void 0:s.frozenCol)===null||n===void 0?void 0:n.range;if(u&&(l=u[1]+1),i<l)return null;var c=o.layoutResult.colLeafNodes.length-1,h=(a=s==null?void 0:s.frozenTrailingCol)===null||a===void 0?void 0:a.range;return h&&(c=h[0]-1),i>c?null:i},e.adjustNextColIndexWithFrozen=function(i,n){var a=e.spreadsheet,o=a.facet,s=a.dataSet,l=a.options,u=s.getDisplayDataSet().length,c=o.layoutResult.colLeafNodes.length,h=Es(l,c,u),f=h.frozenTrailingColCount,d=h.frozenColCount,v=o.panelScrollGroupIndexes;return f>0&&n===Lr.SCROLL_DOWN&&Bl(i,f,c)?v[1]:d>0&&n===Lr.SCROLL_UP&&Fl(i,d)?v[0]:i},e.adjustNextRowIndexWithFrozen=function(i,n){var a=e.spreadsheet,o=a.facet,s=a.dataSet,l=a.options,u=s.getDisplayDataSet().length,c=o.layoutResult.colLeafNodes.length,h=o.getCellRange(),f=Es(l,c,u),d=f.frozenTrailingRowCount,v=f.frozenRowCount,p=o.panelScrollGroupIndexes;return d>0&&n===Lr.SCROLL_DOWN&&nv(i,h.end,d)?p[3]:v>0&&n===Lr.SCROLL_UP&&Wm(i,h.start,v)?p[2]:i},e.getWillScrollRowIndexDiff=function(i){return i===Lr.SCROLL_DOWN?r0.SCROLL_DOWN:r0.SCROLL_UP},e.getDefaultWillScrollToRowIndex=function(i){var n=e.adjustNextRowIndexWithFrozen(e.endBrushPoint.rowIndex,i),a=n+e.getWillScrollRowIndexDiff(i);return e.validateYIndex(a)},e.getWillScrollToRowIndex=function(i){return e.getDefaultWillScrollToRowIndex(i)},e.getNextScrollDelta=function(i){var n=e.spreadsheet.facet.getScrollOffset(),a=n.scrollX,o=n.scrollY,s=0,l=0;if(i.y.scroll){var u=i.y.value>0?Lr.SCROLL_DOWN:Lr.SCROLL_UP,c=e.getWillScrollToRowIndex(u),h=Xwt(c,u,e.spreadsheet)-o,f=wr(c)||wr(h)||Number.isNaN(h);l=f?0:h}if(i.x.scroll){var u=i.x.value>0?Lr.SCROLL_DOWN:Lr.SCROLL_UP,d=e.adjustNextColIndexWithFrozen(e.endBrushPoint.colIndex,u),v=e.validateXIndex(d+(i.x.value>0?1:-1));s=wr(v)?0:Gwt(v,u,e.spreadsheet)-a}return{x:s,y:l}},e.onScrollAnimationComplete=function(){e.scrollAnimationComplete=!0,e.brushSelectionStage!==ei.UN_DRAGGED&&e.renderPrepareSelected(e.endBrushPoint)},e.autoScroll=function(i){if(i===void 0&&(i=!1),!(e.brushSelectionStage===ei.UN_DRAGGED||!e.scrollAnimationComplete)){var n=e.autoScrollConfig,a=e.spreadsheet.facet.getScrollOffset(),o=i?"rowHeaderOffsetX":"offsetX",s={rowHeaderOffsetX:{value:a.rowHeaderScrollX,animate:!0},offsetX:{value:a.scrollX,animate:!0},offsetY:{value:a.scrollY,animate:!0}},l=e.getNextScrollDelta(n),u=l.x,c=l.y;if(c===0&&u===0){e.clearAutoScroll();return}if(n.y.scroll&&(s.offsetY.value+=c),n.x.scroll){var h=s[o];h.value+=u,h.value<0&&(h.value=0)}e.scrollAnimationComplete=!1;var f=n.x.scroll?1:3,d=Math.max(16,300-e.mouseMoveDistanceFromCanvas*f);e.spreadsheet.facet.scrollWithAnimation(s,d,e.onScrollAnimationComplete)}},e.handleScroll=xA(function(i,n,a){if(a===void 0&&(a=!1),e.brushSelectionStage!==ei.UN_DRAGGED){var o=e.formatBrushPointForScroll({x:i,y:n},a),s=o.x,l=s.value,u=s.needScroll,c=o.y,h=c.value,f=c.needScroll,d=e.autoScrollConfig;f&&(d.y.value=n,d.y.scroll=!0),u&&(d.x.value=i,d.x.scroll=!0),e.setMoveDistanceFromCanvas({x:i,y:n},u,f),e.renderPrepareSelected({x:l,y:h}),(f||u)&&(e.clearAutoScroll(),e.autoScroll(a),e.autoScrollIntervalId=setInterval(function(){e.autoScroll(a)},16))}},30),e.clearAutoScroll=function(){e.autoScrollIntervalId&&(clearInterval(e.autoScrollIntervalId),e.autoScrollIntervalId=null,e.resetScrollDelta())},e.onUpdateCells=function(i,n){return n()},e.showPrepareSelectedCells=function(){e.brushRangeCells=e.getBrushRangeCells(),e.spreadsheet.interaction.changeState({cells:se(e.brushRangeCells,function(i){return Ya(i)}),stateName:At.PREPARE_SELECT,force:!0,onUpdateCells:e.onUpdateCells})},e.renderPrepareSelected=function(i){var n=i.x,a=i.y,o=e.spreadsheet.container.getShape(n,a),s=e.spreadsheet.getCell(o),l=s instanceof Zs||s instanceof lv||s instanceof Xm;if(!(!s||!l)){var u=s.getMeta(),c=u.rowIndex,h=u.colIndex;e.endBrushPoint={x:n,y:a,rowIndex:c,colIndex:h};var f=e.spreadsheet.interaction;f.addIntercepts([Vt.HOVER]),f.clearStyleIndependent(),e.isValidBrushSelection()&&(e.showPrepareSelectedCells(),e.updatePrepareSelectMask())}},e}return t.prototype.bindEvents=function(){this.bindMouseDown(),this.bindMouseMove(),this.bindMouseUp()},t.prototype.getPrepareSelectMaskTheme=function(){var e;return(e=this.spreadsheet.theme)===null||e===void 0?void 0:e.prepareSelectMask},t.prototype.initPrepareSelectMaskShape=function(){var e=this.spreadsheet.foregroundGroup;if(e){e.removeChild(this.prepareSelectMaskShape);var i=this.getPrepareSelectMaskTheme();this.prepareSelectMaskShape=e.addShape("rect",{visible:!1,attrs:{width:0,height:0,x:0,y:0,fill:i==null?void 0:i.backgroundColor,fillOpacity:i==null?void 0:i.backgroundOpacity,zIndex:Tct},capture:!1})}},t.prototype.setBrushSelectionStage=function(e){this.brushSelectionStage=e},t.prototype.isPointInCanvas=function(e){var i=this.spreadsheet.facet.getCanvasHW(),n=i.height,a=i.width,o=this.spreadsheet.facet.panelBBox,s=o.minX,l=o.minY;return e.x>s&&e.x<a&&e.y>l&&e.y<n},t.prototype.resetDrag=function(){this.hidePrepareSelectMaskShape(),this.setBrushSelectionStage(ei.UN_DRAGGED)},t.prototype.isValidBrushSelection=function(){var e=this.getBrushRange(),i=e.start,n=e.end,a=n.x-i.x>this.brushSelectionMinimumMoveDistance||n.y-i.y>this.brushSelectionMinimumMoveDistance;return a},t.prototype.setDisplayedCells=function(){this.displayedCells=this.spreadsheet.interaction.getPanelGroupAllDataCells()},t.prototype.updatePrepareSelectMask=function(){var e=this.getBrushRange(),i=this.getPrepareSelectMaskPosition(e),n=i.x,a=i.y;this.prepareSelectMaskShape.attr({x:n,y:a,width:e.width,height:e.height}),this.prepareSelectMaskShape.show()},t.prototype.hidePrepareSelectMaskShape=function(){var e;(e=this.prepareSelectMaskShape)===null||e===void 0||e.hide()},t.prototype.resetScrollDelta=function(){this.autoScrollConfig=Hx(w3)},t.prototype.getBrushPoint=function(e){var i=this.spreadsheet.facet.getScrollOffset(),n=i.scrollY,a=i.scrollX,o={x:e==null?void 0:e.x,y:e==null?void 0:e.y},s=this.spreadsheet.getCell(e.target),l=s.getMeta(),u=l.colIndex,c=l.rowIndex;return k(k({},o),{rowIndex:c,colIndex:u,scrollY:n,scrollX:a})},t.prototype.getBrushRange=function(){var e,i,n,a,o,s,l,u,c=this.spreadsheet.facet.getScrollOffset(),h=c.scrollX,f=c.scrollY,d=Math.min(this.startBrushPoint.rowIndex,(e=this.endBrushPoint)===null||e===void 0?void 0:e.rowIndex),v=Math.max(this.startBrushPoint.rowIndex,(i=this.endBrushPoint)===null||i===void 0?void 0:i.rowIndex),p=Math.min(this.startBrushPoint.colIndex,(n=this.endBrushPoint)===null||n===void 0?void 0:n.colIndex),g=Math.max(this.startBrushPoint.colIndex,(a=this.endBrushPoint)===null||a===void 0?void 0:a.colIndex),m=this.startBrushPoint.x+this.startBrushPoint.scrollX-h,y=this.startBrushPoint.y+this.startBrushPoint.scrollY-f,_=Math.min(m,(o=this.endBrushPoint)===null||o===void 0?void 0:o.x),x=Math.max(m,(s=this.endBrushPoint)===null||s===void 0?void 0:s.x),C=Math.min(y,(l=this.endBrushPoint)===null||l===void 0?void 0:l.y),A=Math.max(y,(u=this.endBrushPoint)===null||u===void 0?void 0:u.y);return{start:{rowIndex:d,colIndex:p,x:_,y:C},end:{rowIndex:v,colIndex:g,x,y:A},width:x-_,height:A-C}},t.prototype.getBrushRangeCells=function(){var e=this;return this.setDisplayedCells(),this.displayedCells.filter(function(i){var n=i.getMeta();return e.isInBrushRange(n)})},t.prototype.mouseDown=function(e){var i;(i=e==null?void 0:e.preventDefault)===null||i===void 0||i.call(e),!this.spreadsheet.interaction.hasIntercepts([Vt.CLICK])&&(this.setBrushSelectionStage(ei.CLICK),this.initPrepareSelectMaskShape(),this.setDisplayedCells(),this.startBrushPoint=this.getBrushPoint(e))},t.prototype.addBrushIntercepts=function(){this.spreadsheet.interaction.addIntercepts([Vt.BRUSH_SELECTION])},t.prototype.bindMouseUp=function(e){var i=this;e===void 0&&(e=!1),this.spreadsheet.on(G.GLOBAL_MOUSE_UP,function(n){if(i.brushSelectionStage!==ei.DRAGGED){i.resetDrag();return}if(e&&i.clearAutoScroll(),i.isValidBrushSelection()){i.addBrushIntercepts(),i.updateSelectedCells();var a=VA(i.spreadsheet);i.spreadsheet.showTooltipWithInfo(n,a)}i.spreadsheet.interaction.getCurrentStateName()===At.PREPARE_SELECT&&i.spreadsheet.interaction.reset(),i.resetDrag()}),this.spreadsheet.on(G.GLOBAL_CONTEXT_MENU,function(){i.brushSelectionStage!==ei.UN_DRAGGED&&(i.spreadsheet.interaction.removeIntercepts([Vt.HOVER]),i.resetDrag())})},t.prototype.autoBrushScroll=function(e,i){var n,a;if(i===void 0&&(i=!1),this.clearAutoScroll(),!this.isPointInCanvas(e)){var o=(e==null?void 0:e.x)-((n=this.endBrushPoint)===null||n===void 0?void 0:n.x),s=(e==null?void 0:e.y)-((a=this.endBrushPoint)===null||a===void 0?void 0:a.y);return this.handleScroll(o,s,i),!0}return!1},t.prototype.emitBrushSelectionEvent=function(e,i){this.spreadsheet.emit(e,i),this.spreadsheet.emit(G.GLOBAL_SELECTED,i),at(i)&&this.spreadsheet.interaction.removeIntercepts([Vt.HOVER])},t.prototype.getVisibleBrushRangeCells=function(e){return this.brushRangeCells.find(function(i){var n=i.getMeta();return(n==null?void 0:n.id)===e})},t.prototype.isInBrushRange=function(e){return!1},t.prototype.bindMouseDown=function(){},t.prototype.bindMouseMove=function(){},t.prototype.updateSelectedCells=function(){},t.prototype.getPrepareSelectMaskPosition=function(e){return{x:e.start.x,y:e.start.y}},t}(Ia),KMt=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.displayedCells=[],e.brushRangeCells=[],e.onUpdateCells=function(i){return i.updateCells(i.getAllColHeaderCells())},e}return t.prototype.bindEvents=function(){this.bindMouseDown(),this.bindMouseMove(),this.bindMouseUp()},t.prototype.bindMouseDown=function(){var e=this;this.spreadsheet.on(G.COL_CELL_MOUSE_DOWN,function(i){e.spreadsheet.interaction.getBrushSelection().col&&r.prototype.mouseDown.call(e,i)})},t.prototype.isPointInCanvas=function(e){var i=this.spreadsheet.facet.getCanvasHW().width,n=this.spreadsheet.facet.cornerBBox,a=n.width,o=n.minY,s=n.maxY;return e.x>=a&&e.x<=i&&e.y>=o&&e.y<=s},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(G.COL_CELL_MOUSE_MOVE,function(i){if(e.brushSelectionStage!==ei.UN_DRAGGED){e.setBrushSelectionStage(ei.DRAGGED);var n=e.spreadsheet.container.getPointByEvent(i.originalEvent);e.isPointInCanvas(n)&&e.renderPrepareSelected(n)}})},t.prototype.setDisplayedCells=function(){this.displayedCells=this.spreadsheet.interaction.getAllColHeaderCells()},t.prototype.isInBrushRange=function(e){var i=this.getBrushRange(),n=i.start,a=i.end,o=this.spreadsheet.facet.getScrollOffset().scrollX,s=this.spreadsheet.facet.cornerBBox,l=e.x,u=l===void 0?0:l,c=e.y,h=c===void 0?0:c,f=e.width,d=f===void 0?0:f,v=e.height,p=v===void 0?0:v;return this.rectanglesIntersect({minX:n.x-s.width+o,minY:n.y,maxX:a.x-s.width+o,maxY:a.y},{minX:u,maxX:u+d,minY:h,maxY:h+p})},t.prototype.updateSelectedCells=function(){var e=this.spreadsheet.interaction;e.changeState({cells:se(this.brushRangeCells,Ya),stateName:At.BRUSH_SELECTED,onUpdateCells:this.onUpdateCells}),this.spreadsheet.emit(G.COL_CELL_BRUSH_SELECTION,this.brushRangeCells),this.spreadsheet.emit(G.GLOBAL_SELECTED,this.brushRangeCells),at(this.brushRangeCells)&&e.removeIntercepts([Vt.HOVER])},t.prototype.addBrushIntercepts=function(){this.spreadsheet.interaction.addIntercepts([Vt.COL_BRUSH_SELECTION])},t}(KA),QMt=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.displayedCells=[],e.brushRangeCells=[],e.getSelectedCellMetas=function(i){var n=[],a=e.spreadsheet.facet.layoutResult,o=a.rowLeafNodes,s=o===void 0?[]:o,l=a.colLeafNodes,u=l===void 0?[]:l,c=fc(i.start.rowIndex,i.end.rowIndex+1),h=fc(i.start.colIndex,i.end.colIndex+1);return c.forEach(function(f){h.forEach(function(d){var v=String(u[d].id),p=at(s)?String(f):String(s[f].id);n.push({colIndex:d,rowIndex:f,id:ov(p,v),type:st.DATA_CELL,rowId:p,colId:v,spreadsheet:e.spreadsheet})})}),n},e}return t.prototype.bindMouseDown=function(){var e=this;this.spreadsheet.on(G.DATA_CELL_MOUSE_DOWN,function(i){e.spreadsheet.interaction.getBrushSelection().data&&(r.prototype.mouseDown.call(e,i),e.resetScrollDelta())})},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(G.GLOBAL_MOUSE_MOVE,function(i){if(e.brushSelectionStage!==ei.UN_DRAGGED){e.setBrushSelectionStage(ei.DRAGGED);var n=e.spreadsheet.container.getPointByEvent(i);e.autoBrushScroll(n)||e.renderPrepareSelected(n)}})},t.prototype.isInBrushRange=function(e){var i=this.getBrushRange(),n=i.start,a=i.end,o=e.rowIndex,s=e.colIndex;return o>=n.rowIndex&&o<=a.rowIndex&&s>=n.colIndex&&s<=a.colIndex},t.prototype.updateSelectedCells=function(){var e=this.getBrushRange(),i=this.getSelectedCellMetas(e);this.spreadsheet.interaction.changeState({cells:i,stateName:At.SELECTED,onUpdateCells:zA});var n=this.getScrollBrushRangeCells(i);this.emitBrushSelectionEvent(G.DATA_CELL_BRUSH_SELECTION,n)},t.prototype.getScrollBrushRangeCells=function(e){var i=this;return e.map(function(n){var a=i.getVisibleBrushRangeCells(n.id);if(a)return a;var o=i.spreadsheet.facet.layoutResult.getCellMeta(n.rowIndex,n.colIndex),s=i.spreadsheet.isTableMode()?Ym:Zs;return new s(o,i.spreadsheet)})},t.prototype.bindMouseUp=function(){r.prototype.bindMouseUp.call(this,!0)},t.prototype.getPrepareSelectMaskPosition=function(e){var i=this.spreadsheet.facet.panelBBox,n=i.minX,a=i.minY,o=Math.max(e.start.x,n),s=Math.max(e.start.y,a);return{x:o,y:s}},t}(KA),JMt=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isInBrushRange=function(i){var n=e.getBrushRange(),a=n.start,o=n.end,s=e.spreadsheet.facet.getScrollOffset(),l=s.scrollY,u=s.rowHeaderScrollX,c=e.spreadsheet.facet.cornerBBox,h=i.x,f=h===void 0?0:h,d=i.y,v=d===void 0?0:d,p=i.width,g=p===void 0?0:p,m=i.height,y=m===void 0?0:m;return e.rectanglesIntersect({minX:a.x+u,minY:a.y-c.height+l,maxX:o.x+u,maxY:o.y-c.height+l},{minX:f,maxX:f+g,minY:v,maxY:v+y})},e.onUpdateCells=function(i){return i.updateCells(i.getAllRowHeaderCells())},e.getSelectedRowNodes=function(){return e.spreadsheet.getRowNodes().filter(e.isInBrushRange)},e.getVisibleRowLeafCellByScrollDirection=function(i){var n=e.spreadsheet.interaction.getAllRowHeaderCells();return i===Lr.SCROLL_DOWN?Pe(n):n.find(function(a){var o=a.getMeta();return o.isLeaf})},e.getWillScrollToRowIndex=function(i){var n,a;if(!wr(e.endBrushPoint.rowIndex))return e.getDefaultWillScrollToRowIndex(i);var o=e.getVisibleRowLeafCellByScrollDirection(i),s=(a=(n=o==null?void 0:o.getMeta())===null||n===void 0?void 0:n.rowIndex)!==null&&a!==void 0?a:0,l=s+e.getWillScrollRowIndexDiff(i);return e.validateYIndex(l)},e}return t.prototype.bindMouseDown=function(){var e=this;this.spreadsheet.on(G.ROW_CELL_MOUSE_DOWN,function(i){e.spreadsheet.interaction.getBrushSelection().row&&r.prototype.mouseDown.call(e,i)})},t.prototype.isPointInCanvas=function(e){var i=this.spreadsheet.facet.getCanvasHW().height,n=this.spreadsheet.facet.cornerBBox,a=n.minX,o=n.height,s=n.maxX;return e.x>=a&&e.x<=s&&e.y>=o&&e.y<=i},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(G.GLOBAL_MOUSE_MOVE,function(i){if(e.brushSelectionStage!==ei.UN_DRAGGED){e.setBrushSelectionStage(ei.DRAGGED);var n=e.spreadsheet.container.getPointByEvent(i);e.autoBrushScroll(n,!0)||e.renderPrepareSelected(n)}})},t.prototype.setDisplayedCells=function(){this.displayedCells=this.spreadsheet.interaction.getAllRowHeaderCells()},t.prototype.updateSelectedCells=function(){var e=this.getSelectedRowNodes(),i=this.getScrollBrushRangeCells(e),n=se(i,Ya);this.spreadsheet.interaction.changeState({cells:n,stateName:At.BRUSH_SELECTED,onUpdateCells:this.onUpdateCells}),this.emitBrushSelectionEvent(G.ROW_CELL_BRUSH_SELECTION,i)},t.prototype.addBrushIntercepts=function(){this.spreadsheet.interaction.addIntercepts([Vt.ROW_BRUSH_SELECTION])},t.prototype.getScrollBrushRangeCells=function(e){var i=this;return e.map(function(n){var a=i.getVisibleBrushRangeCells(n.id);return a||i.spreadsheet.facet.rowHeader.createCellInstance(n)})},t.prototype.getPrepareSelectMaskPosition=function(e){var i=this.spreadsheet.facet.panelBBox.minY,n=e.start.x,a=Math.max(e.start.y,i);return{x:n,y:a}},t}(KA),t3t=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isMultiSelection=!1,e}return t.prototype.bindEvents=function(){this.bindKeyboardDown(),this.bindDataCellClick(),this.bindKeyboardUp(),this.bindMouseMove()},t.prototype.reset=function(){this.isMultiSelection=!1,this.spreadsheet.interaction.removeIntercepts([Vt.CLICK])},t.prototype.bindKeyboardDown=function(){var e=this;this.spreadsheet.on(G.GLOBAL_KEYBOARD_DOWN,function(i){m0(i)&&(e.isMultiSelection=!0,e.spreadsheet.interaction.addIntercepts([Vt.CLICK]))})},t.prototype.bindKeyboardUp=function(){var e=this;this.spreadsheet.on(G.GLOBAL_KEYBOARD_UP,function(i){m0(i)&&e.reset()})},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(G.GLOBAL_MOUSE_MOVE,function(i){e.isMultiSelection&&!O7(i)&&e.reset()})},t.prototype.getSelectedCells=function(e){var i=e.getMeta().id,n=this.spreadsheet.interaction,a=n.getCells([st.DATA_CELL]),o=[];return n.getCurrentStateName()!==At.SELECTED&&(a=[]),a.find(function(s){return s.id===i})?o=a.filter(function(s){return s.id!==i}):o=ht(ht([],tt(a),!1),[Ya(e)],!1),o},t.prototype.bindDataCellClick=function(){var e=this;this.spreadsheet.on(G.DATA_CELL_CLICK,function(i){i.stopPropagation();var n=e.spreadsheet.getCell(i.target),a=n.getMeta(),o=e.spreadsheet.interaction;if(e.isMultiSelection&&a){var s=e.getSelectedCells(n);if(at(s)){o.clearState(),e.spreadsheet.hideTooltip(),e.spreadsheet.emit(G.GLOBAL_SELECTED,o.getActiveCells());return}o.addIntercepts([Vt.CLICK,Vt.HOVER]),e.spreadsheet.hideTooltip(),o.changeState({cells:s,stateName:At.SELECTED,onUpdateCells:zA}),e.spreadsheet.emit(G.GLOBAL_SELECTED,o.getActiveCells()),e.spreadsheet.showTooltipWithInfo(i,VA(e.spreadsheet))}})},t}(Ia),e3t=function(){function r(t){var e=this;this.canvasEventHandlers=[],this.s2EventHandlers=[],this.domEventListeners=[],this.isCanvasEffect=!1,this.isGuiIconShape=function(i){return i instanceof yS&&i.attrs.type===ud.type},this.onCanvasMousedown=function(i){if(e.target=i.target,e.spreadsheet.interaction.clearHoverTimer(),e.isResizeArea(i)){e.spreadsheet.emit(G.LAYOUT_RESIZE_MOUSE_DOWN,i);var n=function(o){if(!e.spreadsheet.getCanvasElement())return!1;e.spreadsheet.getCanvasElement()!==o.target&&(i.clientX=o.clientX,i.clientY=o.clientY,i.originalEvent=o,e.spreadsheet.emit(G.LAYOUT_RESIZE_MOUSE_MOVE,i))};window.addEventListener("mousemove",n),window.addEventListener("mouseup",function(){window.removeEventListener("mousemove",n)},{once:!0});return}var a=e.spreadsheet.getCellType(i.target);switch(a){case st.DATA_CELL:e.spreadsheet.emit(G.DATA_CELL_MOUSE_DOWN,i);break;case st.ROW_CELL:e.spreadsheet.emit(G.ROW_CELL_MOUSE_DOWN,i);break;case st.COL_CELL:e.spreadsheet.emit(G.COL_CELL_MOUSE_DOWN,i);break;case st.CORNER_CELL:e.spreadsheet.emit(G.CORNER_CELL_MOUSE_DOWN,i);break;case st.MERGED_CELL:e.spreadsheet.emit(G.MERGED_CELLS_MOUSE_DOWN,i);break}},this.onCanvasMousemove=function(i){if(e.canvasMousemoveEvent=i,e.isResizeArea(i)){e.activeResizeArea(i),e.spreadsheet.emit(G.LAYOUT_RESIZE_MOUSE_MOVE,i);return}e.resetResizeArea();var n=e.spreadsheet.getCell(i.target);if(n){var a=n.cellType;switch(a){case st.DATA_CELL:e.spreadsheet.emit(G.DATA_CELL_MOUSE_MOVE,i);break;case st.ROW_CELL:e.spreadsheet.emit(G.ROW_CELL_MOUSE_MOVE,i);break;case st.COL_CELL:e.spreadsheet.emit(G.COL_CELL_MOUSE_MOVE,i);break;case st.CORNER_CELL:e.spreadsheet.emit(G.CORNER_CELL_MOUSE_MOVE,i);break;case st.MERGED_CELL:e.spreadsheet.emit(G.MERGED_CELLS_MOUSE_MOVE,i);break}if(!e.hasBrushSelectionIntercepts())switch(e.spreadsheet.emit(G.GLOBAL_HOVER,i),a){case st.DATA_CELL:e.spreadsheet.emit(G.DATA_CELL_HOVER,i);break;case st.ROW_CELL:e.spreadsheet.emit(G.ROW_CELL_HOVER,i);break;case st.COL_CELL:e.spreadsheet.emit(G.COL_CELL_HOVER,i);break;case st.CORNER_CELL:e.spreadsheet.emit(G.CORNER_CELL_HOVER,i);break;case st.MERGED_CELL:e.spreadsheet.emit(G.MERGED_CELLS_HOVER,i);break}}},this.onCanvasMouseup=function(i){if(e.isResizeArea(i)){e.spreadsheet.emit(G.LAYOUT_RESIZE_MOUSE_UP,i);return}var n=e.spreadsheet.getCell(i.target);if(n){var a=n.cellType;if(e.target===i.target){var o=e.isGuiIconShape(i.target);switch(a){case st.DATA_CELL:e.spreadsheet.emit(G.DATA_CELL_CLICK,i);break;case st.ROW_CELL:if(o)break;e.spreadsheet.emit(G.ROW_CELL_CLICK,i);break;case st.COL_CELL:if(o)break;e.spreadsheet.emit(G.COL_CELL_CLICK,i);break;case st.CORNER_CELL:if(o)break;e.spreadsheet.emit(G.CORNER_CELL_CLICK,i);break;case st.MERGED_CELL:e.spreadsheet.emit(G.MERGED_CELLS_CLICK,i);break}}switch(a){case st.DATA_CELL:e.spreadsheet.emit(G.DATA_CELL_MOUSE_UP,i);break;case st.ROW_CELL:e.spreadsheet.emit(G.ROW_CELL_MOUSE_UP,i);break;case st.COL_CELL:e.spreadsheet.emit(G.COL_CELL_MOUSE_UP,i);break;case st.CORNER_CELL:e.spreadsheet.emit(G.CORNER_CELL_MOUSE_UP,i);break;case st.MERGED_CELL:e.spreadsheet.emit(G.MERGED_CELLS_MOUSE_UP,i);break}}},this.onCanvasClick=function(i){e.spreadsheet.emit(G.GLOBAL_CLICK,i)},this.onCanvasDoubleClick=function(i){var n=e.spreadsheet;if(e.isResizeArea(i)){n.emit(G.LAYOUT_RESIZE_MOUSE_UP,i);return}n.emit(G.GLOBAL_DOUBLE_CLICK,i);var a=n.getCell(i.target);if(a){var o=a.cellType;if(e.target===i.target)switch(o){case st.DATA_CELL:n.emit(G.DATA_CELL_DOUBLE_CLICK,i);break;case st.ROW_CELL:n.emit(G.ROW_CELL_DOUBLE_CLICK,i);break;case st.COL_CELL:n.emit(G.COL_CELL_DOUBLE_CLICK,i);break;case st.CORNER_CELL:n.emit(G.CORNER_CELL_DOUBLE_CLICK,i);break;case st.MERGED_CELL:n.emit(G.MERGED_CELLS_DOUBLE_CLICK,i);break}}},this.onCanvasMouseout=function(i){if(!(!e.isAutoResetSheetStyle||i!=null&&i.shape)){var n=e.spreadsheet.interaction;!n.isSelectedState()&&!(n.intercepts.size>0)&&n.reset()}},this.onCanvasContextMenu=function(i){var n=e.spreadsheet;if(e.isResizeArea(i)){n.emit(G.LAYOUT_RESIZE_MOUSE_UP,i);return}n.emit(G.GLOBAL_CONTEXT_MENU,i);var a=e.spreadsheet.getCellType(i.target);switch(a){case st.DATA_CELL:e.spreadsheet.emit(G.DATA_CELL_CONTEXT_MENU,i);break;case st.ROW_CELL:e.spreadsheet.emit(G.ROW_CELL_CONTEXT_MENU,i);break;case st.COL_CELL:e.spreadsheet.emit(G.COL_CELL_CONTEXT_MENU,i);break;case st.CORNER_CELL:e.spreadsheet.emit(G.CORNER_CELL_CONTEXT_MENU,i);break;case st.MERGED_CELL:e.spreadsheet.emit(G.MERGED_CELLS_CONTEXT_MENU,i);break}},this.spreadsheet=t,this.bindEvents()}return Object.defineProperty(r.prototype,"canvasContainer",{get:function(){return this.spreadsheet.container},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isAutoResetSheetStyle",{get:function(){return this.spreadsheet.options.interaction.autoResetSheetStyle},enumerable:!1,configurable:!0}),r.prototype.bindEvents=function(){var t=this;this.clearAllEvents(),this.addCanvasEvent(pi.CLICK,this.onCanvasClick),this.addCanvasEvent(pi.MOUSE_DOWN,this.onCanvasMousedown),this.addCanvasEvent(pi.MOUSE_MOVE,this.onCanvasMousemove),this.addCanvasEvent(pi.MOUSE_OUT,this.onCanvasMouseout),this.addCanvasEvent(pi.MOUSE_UP,this.onCanvasMouseup),this.addCanvasEvent(pi.DOUBLE_CLICK,this.onCanvasDoubleClick),this.addCanvasEvent(pi.CONTEXT_MENU,this.onCanvasContextMenu),this.addS2Event(G.GLOBAL_ACTION_ICON_CLICK,function(){t.spreadsheet.interaction.addIntercepts([Vt.HOVER]),t.spreadsheet.interaction.clearState()}),this.addDomEventListener(window,pi.CLICK,function(e){t.resetSheetStyle(e),t.isCanvasEffect=t.isMouseOnTheCanvasContainer(e)}),this.addDomEventListener(window,pi.KEY_DOWN,function(e){t.onKeyboardCopy(e),t.onKeyboardEsc(e),t.spreadsheet.emit(G.GLOBAL_KEYBOARD_DOWN,e)}),this.addDomEventListener(window,pi.KEY_UP,function(e){t.spreadsheet.emit(G.GLOBAL_KEYBOARD_UP,e)}),this.addDomEventListener(window,pi.MOUSE_UP,function(e){t.spreadsheet.emit(G.GLOBAL_MOUSE_UP,e)}),this.addDomEventListener(window,pi.MOUSE_MOVE,function(e){t.spreadsheet.emit(G.GLOBAL_MOUSE_MOVE,e)})},r.prototype.onKeyboardCopy=function(t){if(this.isCanvasEffect&&this.spreadsheet.options.interaction.enableCopy&&qI(t.key,ni.COPY)&&(t.metaKey||t.ctrlKey)){var e=z2t(this.spreadsheet);wr(e)||this.spreadsheet.emit(G.GLOBAL_COPIED,e)}},r.prototype.onKeyboardEsc=function(t){this.isCanvasEffect&&qI(t.key,ni.ESC)&&this.resetSheetStyle(t)},r.prototype.resetSheetStyle=function(t){if(!(!this.isAutoResetSheetStyle||!this.spreadsheet)){var e=this.spreadsheet.interaction;if(e.hasIntercepts([Vt.BRUSH_SELECTION,Vt.COL_BRUSH_SELECTION,Vt.ROW_BRUSH_SELECTION])){e.removeIntercepts([Vt.BRUSH_SELECTION,Vt.ROW_BRUSH_SELECTION,Vt.COL_BRUSH_SELECTION]);return}this.isMouseOnTheTooltip(t)||this.isMouseOnTheCanvasContainer(t)||(e.reset(),this.spreadsheet.emit(G.GLOBAL_RESET,t),this.spreadsheet.emit(G.GLOBAL_SELECTED,e.getActiveCells()))}},r.prototype.isMouseEvent=function(t){return Jl(t,"clientX")&&Jl(t,"clientY")},r.prototype.isMouseOnTheCanvasContainer=function(t){if(this.isMouseEvent(t)){var e=this.spreadsheet.getCanvasElement();if(!e)return!1;if(this.spreadsheet.options.supportCSSTransform)return e.contains(t.target);var i=e.getBoundingClientRect()||{},n=i.x,a=i.y,o=this.getContainerRect(),s=o.width,l=o.height;return e.contains(t.target)&&t.clientX<=n+s&&t.clientY<=a+l}return!1},r.prototype.getContainerRect=function(){var t,e=this.spreadsheet,i=e.facet,n=e.options,a=(i==null?void 0:i.hRowScrollBar)||(i==null?void 0:i.hScrollBar),o=(i==null?void 0:i.panelBBox)||{},s=o.maxX,l=o.maxY,u=n.width,c=n.height,h=((t=a==null?void 0:a.theme)===null||t===void 0?void 0:t.size)||0;return{width:Math.min(u,s),height:Math.min(c,l+h)}},r.prototype.isMouseOnTheTooltip=function(t){var e,i,n,a,o=this.spreadsheet.tooltip;if(!(o!=null&&o.visible))return!1;var s=((n=(i=(e=this.spreadsheet.tooltip)===null||e===void 0?void 0:e.container)===null||i===void 0?void 0:i.getBoundingClientRect)===null||n===void 0?void 0:n.call(i))||{},l=s.x,u=s.y,c=s.width,h=s.height;return t.target instanceof Node?rMt((a=this.spreadsheet.tooltip)===null||a===void 0?void 0:a.container,t.target):this.isMouseEvent(t)?t.clientX>=l&&t.clientX<=l+c&&t.clientY>=u&&t.clientY<=u+h:!1},r.prototype.isResizeArea=function(t){var e=Nt(t.target,"attrs.appendInfo");return e==null?void 0:e.isResizeArea},r.prototype.activeResizeArea=function(t){this.resetResizeArea();var e=t.target;this.spreadsheet.store.set("activeResizeArea",e),e.attr(an.backgroundOpacity,this.spreadsheet.theme.resizeArea.interactionState.hover.backgroundOpacity)},r.prototype.resetResizeArea=function(){var t=this.spreadsheet.store.get("activeResizeArea");at(t)||t.attr(an.backgroundOpacity,this.spreadsheet.theme.resizeArea.backgroundOpacity),this.spreadsheet.store.set("activeResizeArea",t)},r.prototype.hasBrushSelectionIntercepts=function(){return this.spreadsheet.interaction.hasIntercepts([Vt.HOVER,Vt.BRUSH_SELECTION,Vt.ROW_BRUSH_SELECTION,Vt.COL_BRUSH_SELECTION])},r.prototype.clear=function(){this.unbindEvents()},r.prototype.unbindEvents=function(){this.clearAllEvents()},r.prototype.addCanvasEvent=function(t,e){var i;(i=this.canvasContainer)===null||i===void 0||i.on(t,e),this.canvasEventHandlers.push({type:t,handler:e})},r.prototype.addS2Event=function(t,e){this.spreadsheet.on(t,e),this.s2EventHandlers.push({type:t,handler:e})},r.prototype.addDomEventListener=function(t,e,i){if(t.addEventListener){var n=this.spreadsheet.options.interaction.eventListenerOptions;t.addEventListener(e,i,n),this.domEventListeners.push({target:t,type:e,handler:i,options:n})}else console.error("Please make sure ".concat(t," has addEventListener function"))},r.prototype.clearAllEvents=function(){var t=this;Ht(this.canvasEventHandlers,function(e){var i,n=e.type,a=e.handler;(i=t.canvasContainer)===null||i===void 0||i.off(n,a)}),Ht(this.s2EventHandlers,function(e){var i=e.type,n=e.handler;t.spreadsheet.off(i,n)}),Ht(this.domEventListeners,function(e){e.target.removeEventListener(e.type,e.handler,e.options)}),this.canvasEventHandlers=[],this.s2EventHandlers=[],this.domEventListeners=[]},r}(),r3t=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isRangeSelection=!1,e.handleColClick=function(i){i.stopPropagation();var n=e.spreadsheet.interaction,a=e.spreadsheet.getCell(i.target),o=a==null?void 0:a.getMeta();if(!wr(o==null?void 0:o.x)){n.addIntercepts([Vt.HOVER]);var s=[Ya(a)],l=e.spreadsheet.store.get("lastClickedCell");if(e.isRangeSelection&&l&&l.cellType===a.cellType&&l.getMeta().level===a.getMeta().level){var u=tt([e.spreadsheet.facet.layoutResult.rowsHierarchy.maxLevel,e.spreadsheet.facet.layoutResult.colsHierarchy.maxLevel],2),c=u[0],h=u[1],f=lC(l.getMeta(),a.getMeta()),d=f.start,v=f.end;a instanceof Zs?s=e.handleSeriesNumberRowSelected(d.rowIndex,v.rowIndex,a):a.cellType===st.ROW_CELL&&a.getMeta().level===c?s=e.handleRowSelected(d.rowIndex,v.rowIndex,a):a.cellType===st.COL_CELL&&a.getMeta().level===h&&(s=e.handleColSelected(d.colIndex,v.colIndex,a)),n.changeState({cells:s,stateName:At.SELECTED})}else at(n.getCells())&&n.removeIntercepts([Vt.HOVER]),e.spreadsheet.store.set("lastClickedCell",a);var p=s.map(function(g){var m=g.id;return m});n.updateCells(n.getRowColActiveCells(p)),e.spreadsheet.emit(G.GLOBAL_SELECTED,n.getActiveCells())}},e}return t.prototype.bindEvents=function(){this.bindKeyboardDown(),this.bindDataCellClick(),this.bindColCellClick(),this.bindKeyboardUp(),this.bindMouseMove()},t.prototype.reset=function(){this.isRangeSelection=!1,this.spreadsheet.interaction.removeIntercepts([Vt.CLICK])},t.prototype.bindKeyboardDown=function(){var e=this;this.spreadsheet.on(G.GLOBAL_KEYBOARD_DOWN,function(i){i.key===ni.SHIFT&&(e.isRangeSelection=!0,e.spreadsheet.interaction.addIntercepts([Vt.CLICK]))})},t.prototype.bindKeyboardUp=function(){var e=this;this.spreadsheet.on(G.GLOBAL_KEYBOARD_UP,function(i){i.key===ni.SHIFT&&e.reset()})},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(G.GLOBAL_MOUSE_MOVE,function(i){e.isRangeSelection&&!i.shiftKey&&e.reset()})},t.prototype.bindColCellClick=function(){var e=this;this.spreadsheet.isTableMode()&&this.spreadsheet.on(G.ROW_CELL_CLICK,function(i){e.handleColClick(i)}),this.spreadsheet.on(G.COL_CELL_CLICK,function(i){e.handleColClick(i)})},t.prototype.bindDataCellClick=function(){var e=this;this.spreadsheet.on(G.DATA_CELL_CLICK,function(i){i.stopPropagation();var n=e.spreadsheet.getCell(i.target),a=n.getMeta(),o=e.spreadsheet.interaction;if(a){var s=e.spreadsheet.store.get("lastClickedCell"),l=e.isRangeSelection&&(s==null?void 0:s.cellType)===n.cellType;if(!l){e.spreadsheet.store.set("lastClickedCell",n);return}var u=lC(s.getMeta(),n.getMeta()),c=u.start,h=u.end,f=fc(c.colIndex,h.colIndex+1).flatMap(function(d){var v=e.spreadsheet.facet.layoutResult.colLeafNodes[d].id;return fc(c.rowIndex,h.rowIndex+1).map(function(p){var g=e.spreadsheet.facet.getSeriesNumberWidth()||e.spreadsheet.isTableMode()?String(p):e.spreadsheet.facet.layoutResult.rowLeafNodes[p].id;return{id:g+"-"+v,colIndex:d,rowIndex:p,type:n.cellType}})});o.addIntercepts([Vt.CLICK,Vt.HOVER]),o.changeState({cells:f,stateName:At.SELECTED}),e.spreadsheet.showTooltipWithInfo(i,VA(e.spreadsheet)),e.spreadsheet.emit(G.GLOBAL_SELECTED,o.getActiveCells())}})},t.prototype.handleSeriesNumberRowSelected=function(e,i,n){var a=this.spreadsheet.facet.layoutResult.colLeafNodes[0].id;return fc(e,i+1).map(function(o){var s=String(o);return{id:s+"-"+a,colIndex:0,rowIndex:o,type:n.cellType}})},t.prototype.handleRowSelected=function(e,i,n){return this.spreadsheet.facet.layoutResult.rowNodes.filter(function(a){var o=a.rowIndex;return Gx(o,e,i+1)}).map(function(a){return{id:a.id,colIndex:a.colIndex,rowIndex:a.rowIndex,type:n.cellType}})},t.prototype.handleColSelected=function(e,i,n){return this.spreadsheet.facet.layoutResult.colLeafNodes.filter(function(a){var o=a.colIndex;return Gx(o,e,i+1)}).map(function(a){return{id:a.id,colIndex:a.colIndex,rowIndex:a.rowIndex,type:n.cellType}})},t}(Ia),i3t=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.resizeStartPosition={},e.resizeMouseMove=function(i){var n,a;if(!((n=e.resizeReferenceGroup)===null||n===void 0)&&n.get("visible")){(a=i==null?void 0:i.preventDefault)===null||a===void 0||a.call(i);var o=i.originalEvent,s=e.getResizeInfo(),l=e.resizeReferenceGroup.getChildren()||[];if(!at(l)){var u=tt(l,2),c=u[1],h=tt(qd(c.attr("path")),2),f=h[0],d=h[1];s.type===zn.Horizontal?e.updateHorizontalResizingEndGuideLinePosition(o,s,f,d):e.updateVerticalResizingEndGuideLinePosition(o,s,f,d),e.updateResizeGuideLineTheme(c),c.attr("path",[f,d])}}},e}return t.prototype.bindEvents=function(){this.bindMouseDown(),this.bindMouseMove(),this.bindMouseUp()},t.prototype.initResizeGroup=function(){if(!this.resizeReferenceGroup){this.resizeReferenceGroup=this.spreadsheet.foregroundGroup.addGroup();var e=this.spreadsheet.options,i=e.width,n=e.height,a=this.getResizeAreaTheme(),o=a.guideLineColor,s=a.guideLineDash,l=a.size,u={path:"",lineDash:s,stroke:o,lineWidth:l};this.resizeReferenceGroup.addShape("path",{id:Xct,attrs:u}),this.resizeReferenceGroup.addShape("path",{id:Yct,attrs:u}),this.resizeReferenceGroup.addShape("rect",{id:jct,attrs:{appendInfo:{isResizeArea:!0},x:0,y:0,width:i,height:n,fill:"transparent"}})}},t.prototype.getResizeAreaTheme=function(){return this.spreadsheet.theme.resizeArea},t.prototype.setResizeTarget=function(e){this.resizeTarget=e},t.prototype.getGuideLineWidthAndHeight=function(){var e=this.spreadsheet.options,i=e.width,n=e.height,a=this.spreadsheet.facet.panelBBox,o=a.maxY,s=a.maxX,l=Math.min(s,i),u=Math.min(o,n);return{width:l,height:u}},t.prototype.getResizeShapes=function(){var e;return((e=this.resizeReferenceGroup)===null||e===void 0?void 0:e.get("children"))||[]},t.prototype.setResizeMaskCursor=function(e){var i=tt(this.getResizeShapes(),3),n=i[2];n==null||n.attr("cursor",e)},t.prototype.updateResizeGuideLinePosition=function(e,i){var n=this.getResizeShapes();if(!at(n)){var a=tt(n,2),o=a[0],s=a[1],l=i.type,u=i.offsetX,c=i.offsetY,h=i.width,f=i.height,d=this.getGuideLineWidthAndHeight(),v=d.width,p=d.height;if(this.setResizeMaskCursor("".concat(l,"-resize")),l===zn.Horizontal){o.attr("path",[["M",u,c],["L",u,p]]),s.attr("path",[["M",u+h,c],["L",u+h,p]]),this.resizeStartPosition.offsetX=e.offsetX,this.resizeStartPosition.clientX=e.clientX;return}o.attr("path",[["M",u,c],["L",v,c]]),s.attr("path",[["M",u,c+f],["L",v,c+f]]),this.resizeStartPosition.offsetY=e.offsetY,this.resizeStartPosition.clientY=e.clientY}},t.prototype.bindMouseDown=function(){var e=this;this.spreadsheet.on(G.LAYOUT_RESIZE_MOUSE_DOWN,function(i){var n;(n=i==null?void 0:i.preventDefault)===null||n===void 0||n.call(i);var a=i.target,o=i.originalEvent,s=e.getCellAppendInfo(i.target);e.spreadsheet.store.set("resized",!1),s!=null&&s.isResizeArea&&(e.spreadsheet.interaction.reset(),e.spreadsheet.interaction.addIntercepts([Vt.RESIZE]),e.setResizeTarget(a),e.showResizeGroup(),e.updateResizeGuideLinePosition(o,s))})},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(G.LAYOUT_RESIZE_MOUSE_MOVE,function(i){xA(e.resizeMouseMove,33)(i)})},t.prototype.getResizeGuideLinePosition=function(){var e=tt(this.resizeReferenceGroup.getChildren()||[],2),i=e[0],n=e[1],a=(i==null?void 0:i.attr("path"))||[],o=(n==null?void 0:n.attr("path"))||[],s=tt(a[0]||[],3),l=s[1],u=l===void 0?0:l,c=s[2],h=c===void 0?0:c,f=tt(o[0]||[],3),d=f[1],v=d===void 0?0:d,p=f[2],g=p===void 0?0:p;return{start:{x:u,y:h},end:{x:v,y:g}}},t.prototype.getDisAllowResizeInfo=function(){var e,i=this.getResizeInfo(),n=this.spreadsheet.options.interaction.resize,a=i.width,o=i.height,s=i.resizedWidth,l=i.resizedHeight,u=(e=n==null?void 0:n.disable)===null||e===void 0?void 0:e.call(n,i),c=u?a:s,h=u?o:l;return{displayWidth:c,displayHeight:h,isDisabled:u}},t.prototype.getResizeWidthDetail=function(){var e,i,n=this.getResizeInfo(),a=this.getDisAllowResizeInfo().displayWidth;switch(n.effect){case mi.Field:return{eventType:G.LAYOUT_RESIZE_ROW_WIDTH,style:{rowCfg:{widthByField:(e={},e[n.id]=a,e)}}};case mi.Tree:return{eventType:G.LAYOUT_RESIZE_TREE_WIDTH,style:{treeRowsWidth:a,rowCfg:{treeRowsWidth:a}}};case mi.Cell:return{eventType:G.LAYOUT_RESIZE_COL_WIDTH,style:{colCfg:{widthByFieldValue:(i={},i[n.id]=a,i)}}};case mi.Series:return{eventType:G.LAYOUT_RESIZE_SERIES_WIDTH,seriesNumberWidth:a};default:return null}},t.prototype.getResizeHeightDetail=function(){var e,i,n=this.spreadsheet.options,a=n.interaction.resize,o=n.style.rowCfg.heightByField,s=this.spreadsheet.theme.rowCell.cell.padding,l=this.getResizeInfo(),u=this.getDisAllowResizeInfo().displayHeight,c=this.spreadsheet.isPivotMode()?u-s.top-s.bottom:u,h;switch(l.effect){case mi.Field:return{eventType:G.LAYOUT_RESIZE_COL_HEIGHT,style:{colCfg:{heightByField:(e={},e[l.id]=u,e)}}};case mi.Cell:return o!=null&&o[String(l.id)]||(a==null?void 0:a.rowResizeType)===i0.CURRENT?h={rowCfg:{heightByField:(i={},i[l.id]=c,i)}}:h={cellCfg:{height:c}},{eventType:G.LAYOUT_RESIZE_ROW_HEIGHT,style:h};default:return null}},t.prototype.getResizeDetail=function(){var e=this.getResizeInfo();return e.type===zn.Horizontal?this.getResizeWidthDetail():this.getResizeHeightDetail()},t.prototype.showResizeGroup=function(){this.initResizeGroup(),this.resizeReferenceGroup.set("visible",!0)},t.prototype.hideResizeGroup=function(){this.resizeReferenceGroup.set("visible",!1)},t.prototype.bindMouseUp=function(){var e=this;this.spreadsheet.on(G.GLOBAL_MOUSE_UP,function(){var i;e.setResizeMaskCursor("default"),!(!e.resizeReferenceGroup||at((i=e.resizeReferenceGroup)===null||i===void 0?void 0:i.getChildren()))&&(e.hideResizeGroup(),e.renderResizedResult())})},t.prototype.updateResizeGuideLineTheme=function(e){var i=this.getResizeAreaTheme(),n=i.guideLineColor,a=i.guideLineDisableColor,o=this.getDisAllowResizeInfo().isDisabled;e.attr("stroke",o?a:n),this.setResizeMaskCursor(o?"no-drop":"default")},t.prototype.updateHorizontalResizingEndGuideLinePosition=function(e,i,n,a){var o=e.clientX-this.resizeStartPosition.clientX;i.width+o<S3&&(o=-(i.width-S3));var s=i.offsetX+i.width+o;n[1]=s,a[1]=s,this.resizeTarget.attr({x:s-i.size/2})},t.prototype.updateVerticalResizingEndGuideLinePosition=function(e,i,n,a){var o=e.clientY-this.resizeStartPosition.clientY;i.height+o<A3&&(o=-(i.height-A3));var s=i.offsetY+i.height+o;n[2]=s,a[2]=s,this.resizeTarget.attr({y:s-i.size/2})},t.prototype.renderResizedResult=function(){var e=this.getResizeInfo(),i=this.getResizeDetail()||{},n=i.style,a=i.seriesNumberWidth,o=i.eventType,s={info:e,style:n};this.spreadsheet.emit(G.LAYOUT_RESIZE,s),this.spreadsheet.emit(o,s),n&&this.spreadsheet.setOptions({style:n}),a&&this.spreadsheet.setTheme({rowCell:{seriesNumberWidth:a}}),this.spreadsheet.store.set("resized",!0),this.render()},t.prototype.getResizeInfo=function(){var e=this.getCellAppendInfo(this.resizeTarget),i=this.getResizeGuideLinePosition(),n=i.start,a=i.end,o=Math.floor(a.x-n.x),s=Math.floor(a.y-n.y);return k(k({},e),{resizedWidth:o,resizedHeight:s})},t.prototype.render=function(){this.resizeStartPosition={},this.resizeTarget=null,this.resizeReferenceGroup=null,this.spreadsheet.render(!1)},t}(Ia),n3t=[ni.ARROW_LEFT,ni.ARROW_RIGHT,ni.ARROW_UP,ni.ARROW_DOWN],a3t=function(r){gt(t,r);function t(e){return r.call(this,e)||this}return t.prototype.isCanvasEffect=function(){return this.spreadsheet.interaction.eventController.isCanvasEffect},t.prototype.bindEvents=function(){var e=this;this.spreadsheet.on(G.GLOBAL_KEYBOARD_DOWN,function(i){if(e.isCanvasEffect()){var n=i.shiftKey,a=i.metaKey,o=n3t.includes(i.key),s=!1,l=!1,u=!1;o&&(a&&n?(s=!1,l=!0,u=!1):a?(s=!0,l=!0,u=!0):n?(s=!1,l=!1,u=!1):(s=!0,l=!1,u=!0),e.handleMove({event:i,changeStartCell:s,isJumpMode:l,isSingleSelection:u}))}}),this.spreadsheet.on(G.DATA_CELL_CLICK,function(i){var n=e.spreadsheet.getCell(i.target).getMeta();n&&(e.startCell=e.getCellMetaFromViewMeta(n),e.endCell=e.startCell)})},t.prototype.getCellMetaFromViewMeta=function(e){return{rowIndex:e.rowIndex,colIndex:e.colIndex,id:e.id,type:st.DATA_CELL}},t.prototype.handleMove=function(e){var i=e.event,n=e.changeStartCell,a=e.isJumpMode,o=e.isSingleSelection,s=this,l=s.spreadsheet,u=s.startCell,c=s.endCell,h=n?u:c,f=this.getMoveInfo(i.key,h,a);if(f){var d=tt([f.row,f.col],2),v=d[0],p=d[1];this.scrollToActiveCell(l,v,p);var g=this.generateCellMeta(l,v,p),m=o?[g]:this.getRangeCells(l,u,g);$wt(l,m),n&&(this.startCell=g),this.endCell=g,this.spreadsheet.emit(G.DATA_CELL_SELECT_MOVE,m)}},t.prototype.generateCellMeta=function(e,i,n){var a=e.isTableMode,o=e.facet.layoutResult,s=o.colLeafNodes,l=o.rowLeafNodes,u=a()?String(i):l[i].id,c=s[n].id;return{rowIndex:i,colIndex:n,id:ov(u,c),type:st.DATA_CELL}},t.prototype.getRangeCells=function(e,i,n){for(var a=lC(i,n),o=a.start,s=o.rowIndex,l=o.colIndex,u=a.end,c=u.rowIndex,h=u.colIndex,f=[],d=s;d<=c;d++)for(var v=l;v<=h;v++)f.push(this.generateCellMeta(e,d,v));return f},t.prototype.getMoveInfo=function(e,i,n){var a=this.spreadsheet,o=a.options,s=o.frozenColCount,l=s===void 0?0:s,u=o.frozenRowCount,c=u===void 0?0:u,h=o.frozenTrailingColCount,f=h===void 0?0:h,d=o.frozenTrailingRowCount,v=d===void 0?0:d,p=a.facet.layoutResult,g=p.rowLeafNodes,m=p.colLeafNodes,y=tt([0+l,m.length-f-1],2),_=y[0],x=y[1],C=tt([0+c,(a.isTableMode()?a.dataSet.getDisplayDataSet().length:g.length)-v-1],2),A=C[0],T=C[1];if(i)switch(e){case ni.ARROW_RIGHT:return i.colIndex+1>x?void 0:{row:i.rowIndex,col:n?x:i.colIndex+1};case ni.ARROW_LEFT:return i.colIndex-1<_?void 0:{row:i.rowIndex,col:n?_:i.colIndex-1};case ni.ARROW_UP:return i.rowIndex-1<A?void 0:{row:n?A:i.rowIndex-1,col:i.colIndex};case ni.ARROW_DOWN:return i.rowIndex+1>T?void 0:{row:n?T:i.rowIndex+1,col:i.colIndex}}},t.prototype.calculateOffset=function(e,i,n){var a=e.options,o=a.frozenRowCount,s=o===void 0?0:o,l=a.frozenTrailingRowCount,u=l===void 0?0:l,c=e.facet,h=e.frozenColGroup,f=e.frozenTrailingColGroup,d=e.frozenRowGroup,v=e.frozenTrailingRowGroup,p=c.layoutResult.colLeafNodes,g=c.getScrollOffset(),m=g.scrollX,y=g.scrollY,_=c.panelBBox,x=_.viewportHeight,C=_.viewportWidth,A=Nt(e,"theme.splitLine"),T=h?Math.floor(h.getBBox().width-A.verticalBorderWidth/2):0,w=f?Math.floor(f.getBBox().width):0,M=d?Math.floor(d.getBBox().height-A.horizontalBorderWidth/2):0,O=v?Math.floor(v.getBBox().height):0,P=MA(m,y,c.viewCellWidths,c.viewCellHeights,{width:C-T-w,height:x-M-O,x:T,y:M},c.getRealScrollX(c.cornerBBox.width)),D=-1,z=-1,Y=p.find(function(N){return N.colIndex===n});if(n<=P[0]?D=Y.x-T:n>=P[1]&&n<p.length-u&&(D=Y.x+Y.width-C+w),i<=P[2])z=c.viewCellHeights.getCellOffsetY(i-s);else if(i>=P[3]){var H=c.viewCellHeights.getCellOffsetY(i+1);z=H+O-x}return{offsetX:D,offsetY:z}},t.prototype.scrollToActiveCell=function(e,i,n){var a=this.calculateOffset(e,i,n),o=a.offsetX,s=a.offsetY,l=e.facet,u=e.facet.getScrollOffset(),c=u.scrollX,h=u.scrollY;l.scrollWithAnimation({offsetX:{value:o>-1?o:c},offsetY:{value:s>-1?s:h}})},t}(Ia),o3t=function(){function r(t){var e=this;this.interactions=new Map,this.intercepts=new Set,this.hoverTimer=null,this.defaultState={cells:[],force:!1},this.onTriggerInteractionsResetEffect=function(){e.interactions.forEach(function(i){i.reset()})},this.selectAll=function(){e.changeState({stateName:At.ALL_SELECTED})},this.getCellChildrenNodes=function(i){var n,a=(n=i==null?void 0:i.getMeta)===null||n===void 0?void 0:n.call(i),o=(i==null?void 0:i.cellType)===st.ROW_CELL,s=e.spreadsheet.isHierarchyTreeType();return s&&o?Gr.getAllLeaveNodes(a).filter(function(l){return l.rowIndex===a.rowIndex}):Gr.getAllChildrenNodes(a)},this.selectHeaderCell=function(i){var n;i===void 0&&(i={});var a=i.cell;if(!at(a)){var o=(n=a==null?void 0:a.getMeta)===null||n===void 0?void 0:n.call(a);if(!(!o||wr(o==null?void 0:o.x))){e.addIntercepts([Vt.HOVER]);var s=e.spreadsheet.isHierarchyTreeType(),l=(a==null?void 0:a.cellType)===st.COL_CELL,u=e.getState(),c=e.isSelectedCell(a),h=(i==null?void 0:i.isMultiSelection)&&e.isSelectedState(),f=c?[]:e.getCellChildrenNodes(a),d=c?[]:[Ya(a)];if(h&&(d=Zu(u==null?void 0:u.cells,d),f=Zu(u==null?void 0:u.nodes,f),c&&(d=d.filter(function(p){var g=p.id;return g!==o.id}),f=f.filter(function(p){return!(p!=null&&p.id.includes(o.id))}))),at(d)){e.reset(),e.spreadsheet.emit(G.GLOBAL_SELECTED,e.getActiveCells());return}e.changeState({cells:d,nodes:f,stateName:At.SELECTED});var v=d.map(function(p){var g=p.id;return g});return e.updateCells(e.getRowColActiveCells(v)),(!s||l)&&e.highlightNodes(f),e.spreadsheet.emit(G.GLOBAL_SELECTED,e.getActiveCells()),!0}}},this.highlightNodes=function(i){i===void 0&&(i=[]),i.forEach(function(n){var a;(a=n==null?void 0:n.belongsCell)===null||a===void 0||a.updateByState(At.SELECTED,n.belongsCell)})},this.mergeCells=function(i,n){nwt(e.spreadsheet,i,n)},this.unmergeCell=function(i){owt(e.spreadsheet,i)},this.spreadsheet=t,this.registerEventController(),this.registerInteractions(),window.addEventListener("visibilitychange",this.onTriggerInteractionsResetEffect)}return r.prototype.destroy=function(){this.interactions.clear(),this.intercepts.clear(),this.eventController.clear(),this.clearHoverTimer(),this.resetState(),window.removeEventListener("visibilitychange",this.onTriggerInteractionsResetEffect)},r.prototype.reset=function(){this.clearState(),this.clearHoverTimer(),this.intercepts.clear(),this.spreadsheet.hideTooltip()},r.prototype.setState=function(t){Vwt(this.spreadsheet,t)},r.prototype.getState=function(){return this.spreadsheet.store.get(Fx)||this.defaultState},r.prototype.setInteractedCells=function(t){var e=this.getInteractedCells().concat([t]),i=this.getState();i.interactedCells=e,this.setState(i)},r.prototype.getInteractedCells=function(){var t=this.getState();return(t==null?void 0:t.interactedCells)||[]},r.prototype.resetState=function(){this.spreadsheet.store.set(Fx,this.defaultState)},r.prototype.getCurrentStateName=function(){return this.getState().stateName},r.prototype.isEqualStateName=function(t){return this.getCurrentStateName()===t},r.prototype.isStateOf=function(t){var e=this.getState();return(e==null?void 0:e.stateName)===t},r.prototype.isSelectedState=function(){return this.isStateOf(At.SELECTED)||this.isStateOf(At.BRUSH_SELECTED)},r.prototype.isAllSelectedState=function(){return this.isStateOf(At.ALL_SELECTED)},r.prototype.isHoverFocusState=function(){return this.isStateOf(At.HOVER_FOCUS)},r.prototype.isHoverState=function(){return this.isStateOf(At.HOVER)},r.prototype.isActiveCell=function(t){return!!this.getCells().find(function(e){return t.getMeta().id===e.id})},r.prototype.isSelectedCell=function(t){return this.isSelectedState()&&this.isActiveCell(t)},r.prototype.getCells=function(t){var e=this.getState(),i=(e==null?void 0:e.cells)||[];return wr(t)?i:i.filter(function(n){return t.includes(n.type)})},r.prototype.getActiveCells=function(){var t=this.getCells().map(function(i){return i.id}),e=this.getAllCells();return se(t,function(i){return ci(e,function(n){var a;return((a=n==null?void 0:n.getMeta())===null||a===void 0?void 0:a.id)===i})}).filter(function(i){return i})},r.prototype.clearStyleIndependent=function(){!this.isSelectedState()&&!this.isHoverState()&&!this.isAllSelectedState()||this.getPanelGroupAllDataCells().forEach(function(t){t.hideInteractionShape()})},r.prototype.getPanelGroupAllUnSelectedDataCells=function(){var t=this;return this.getPanelGroupAllDataCells().filter(function(e){return!t.isActiveCell(e)})},r.prototype.getPanelGroupAllDataCells=function(){var t;return Mf((t=this.spreadsheet.panelGroup)===null||t===void 0?void 0:t.getChildren(),Zs)},r.prototype.getAllRowHeaderCells=function(){var t,e,i=((t=this.spreadsheet.foregroundGroup)===null||t===void 0?void 0:t.getChildren())||[],n=i.find(function(o){return o instanceof qA&&!(o instanceof s8)}),a=((e=n==null?void 0:n.cfg)===null||e===void 0?void 0:e.children)||[];return Mf(a,lv).filter(function(o){return o.cellType===st.ROW_CELL})},r.prototype.getAllColHeaderCells=function(){var t,e,i=((t=this.spreadsheet.foregroundGroup)===null||t===void 0?void 0:t.getChildren())||[],n=i.find(function(o){return o instanceof ZA}),a=((e=n==null?void 0:n.cfg)===null||e===void 0?void 0:e.children)||[];return Mf(a,Xm).filter(function(o){return o.cellType===st.COL_CELL})},r.prototype.getRowColActiveCells=function(t){return Zu(this.getAllRowHeaderCells(),this.getAllColHeaderCells()).filter(function(e){return t.includes(e.getMeta().id)})},r.prototype.getAllCells=function(){return Zu(this.getPanelGroupAllDataCells(),this.getAllRowHeaderCells(),this.getAllColHeaderCells())},r.prototype.hideColumns=function(t,e){t===void 0&&(t=[]),e===void 0&&(e=!0),BA(this.spreadsheet,t,e)},r.prototype.getBrushSelectionInfo=function(t){var e,i,n;return za(t)?{dataBrushSelection:t,rowBrushSelection:t,colBrushSelection:t}:{dataBrushSelection:(e=t==null?void 0:t.data)!==null&&e!==void 0?e:!1,rowBrushSelection:(i=t==null?void 0:t.row)!==null&&i!==void 0?i:!1,colBrushSelection:(n=t==null?void 0:t.col)!==null&&n!==void 0?n:!1}},r.prototype.getDefaultInteractions=function(){var t=this.spreadsheet.options.interaction,e=t.resize,i=t.brushSelection,n=t.multiSelection,a=t.rangeSelection,o=t.selectedCellMove,s=this.getBrushSelectionInfo(i),l=s.dataBrushSelection,u=s.rowBrushSelection,c=s.colBrushSelection;return[{key:vi.CORNER_CELL_CLICK,interaction:ZMt},{key:vi.DATA_CELL_CLICK,interaction:GMt},{key:vi.ROW_COLUMN_CLICK,interaction:YMt},{key:vi.ROW_TEXT_CLICK,interaction:jMt},{key:vi.MERGED_CELLS_CLICK,interaction:XMt},{key:vi.HOVER,interaction:qMt,enable:!Or()},{key:vi.BRUSH_SELECTION,interaction:QMt,enable:!Or()&&l},{key:vi.ROW_BRUSH_SELECTION,interaction:JMt,enable:!Or()&&u},{key:vi.COL_BRUSH_SELECTION,interaction:KMt,enable:!Or()&&c},{key:vi.COL_ROW_RESIZE,interaction:i3t,enable:!Or()&&e},{key:vi.DATA_CELL_MULTI_SELECTION,interaction:t3t,enable:!Or()&&n},{key:vi.RANGE_SELECTION,interaction:r3t,enable:!Or()&&a},{key:vi.SELECTED_CELL_MOVE,interaction:a3t,enable:!Or()&&o}]},r.prototype.registerInteractions=function(){var t=this,e=this.spreadsheet.options.interaction.customInteractions;this.interactions.clear();var i=this.getDefaultInteractions();i.forEach(function(n){var a=n.key,o=n.interaction,s=n.enable;s!==!1&&t.interactions.set(a,new o(t.spreadsheet))}),at(e)||Ht(e,function(n){var a=n.interaction;t.interactions.set(n.key,new a(t.spreadsheet))})},r.prototype.registerEventController=function(){this.eventController=new e3t(this.spreadsheet)},r.prototype.draw=function(){this.spreadsheet.container.draw()},r.prototype.clearState=function(){P7(this.spreadsheet)&&this.draw()},r.prototype.changeState=function(t){var e=this,i=this.spreadsheet.interaction,n=t.cells,a=n===void 0?[]:n,o=t.force,s=t.stateName,l=t.onUpdateCells;if(at(a)&&s===At.SELECTED){o&&i.changeState({cells:[],stateName:At.UNSELECTED});return}this.getCurrentStateName()===At.ALL_SELECTED&&this.clearStyleIndependent(),this.clearState(),this.setState(t);var u=function(){e.updatePanelGroupAllDataCells()};l?l(this,u):u(),this.draw()},r.prototype.updatePanelGroupAllDataCells=function(){this.updateCells(this.getPanelGroupAllDataCells())},r.prototype.updateCells=function(t){t===void 0&&(t=[]),t.forEach(function(e){e.update()})},r.prototype.addIntercepts=function(t){var e=this;t===void 0&&(t=[]),t.forEach(function(i){e.intercepts.add(i)})},r.prototype.hasIntercepts=function(t){var e=this;return t===void 0&&(t=[]),t.some(function(i){return e.intercepts.has(i)})},r.prototype.removeIntercepts=function(t){var e=this;t===void 0&&(t=[]),t.forEach(function(i){e.intercepts.delete(i)})},r.prototype.clearHoverTimer=function(){clearTimeout(this.hoverTimer)},r.prototype.setHoverTimer=function(t){this.hoverTimer=t},r.prototype.getHoverTimer=function(){return this.hoverTimer},r.prototype.getSelectedCellHighlight=function(){var t=this.spreadsheet.options.interaction.selectedCellHighlight;if(za(t))return{rowHeader:t,colHeader:t,currentRow:!1,currentCol:!1};var e=t??{},i=e.rowHeader,n=i===void 0?!1:i,a=e.colHeader,o=a===void 0?!1:a,s=e.currentRow,l=s===void 0?!1:s,u=e.currentCol,c=u===void 0?!1:u;return{rowHeader:n,colHeader:o,currentRow:l,currentCol:c}},r.prototype.getHoverAfterScroll=function(){return this.spreadsheet.options.interaction.hoverAfterScroll},r.prototype.getHoverHighlight=function(){var t=this.spreadsheet.options.interaction.hoverHighlight;if(za(t))return{rowHeader:t,colHeader:t,currentRow:t,currentCol:t};var e=t??{},i=e.rowHeader,n=i===void 0?!1:i,a=e.colHeader,o=a===void 0?!1:a,s=e.currentRow,l=s===void 0?!1:s,u=e.currentCol,c=u===void 0?!1:u;return{rowHeader:n,colHeader:o,currentRow:l,currentCol:c}},r.prototype.getBrushSelection=function(){var t=this.spreadsheet.options.interaction.brushSelection;if(za(t))return{data:t,row:t,col:t};var e=t??{},i=e.data,n=i===void 0?!1:i,a=e.row,o=a===void 0?!1:a,s=e.col,l=s===void 0?!1:s;return{data:n,row:o,col:l}},r}(),s3t=function(){function r(t){var e=this;this.viewport=window,this.isDevicePixelRatioChange=!1,this.init=function(){e.initDevicePixelRatioListener(),e.initDeviceZoomListener()},this.destroy=function(){e.removeDevicePixelRatioListener(),e.removeDeviceZoomListener()},this.removeDevicePixelRatioListener=function(){var i;!((i=e.devicePixelRatioMedia)===null||i===void 0)&&i.removeEventListener?e.devicePixelRatioMedia.removeEventListener("change",e.renderByDevicePixelRatioChanged):e.devicePixelRatioMedia.removeListener(e.renderByDevicePixelRatioChanged)},this.initDeviceZoomListener=function(){var i,n;Or()||(n=(i=e.viewport)===null||i===void 0?void 0:i.visualViewport)===null||n===void 0||n.addEventListener("resize",e.renderByZoomScaleWithoutResizeEffect)},this.removeDeviceZoomListener=function(){var i,n;Or()||(n=(i=e.viewport)===null||i===void 0?void 0:i.visualViewport)===null||n===void 0||n.removeEventListener("resize",e.renderByZoomScaleWithoutResizeEffect)},this.renderByZoomScaleWithoutResizeEffect=function(i){e.isDevicePixelRatioChange=!1,e.renderByZoomScale(i)},this.renderByDevicePixelRatioChanged=function(){e.isDevicePixelRatioChange=!0,e.renderByDevicePixelRatio()},this.renderByDevicePixelRatio=function(i){i===void 0&&(i=window.devicePixelRatio);var n=e.spreadsheet,a=n.container,o=n.options,s=o.width,l=o.height,u=o.devicePixelRatio,c=e.spreadsheet.getCanvasElement(),h=a.get("pixelRatio");if(!(h===i||!c)){var f=Math.max(i,u,h4);a.set("pixelRatio",f),a.changeSize(s,l),e.spreadsheet.render(!1)}},this.renderByZoomScale=od(function(i){var n=Math.ceil(i.target.scale);n>=1&&!e.isDevicePixelRatioChange&&e.renderByDevicePixelRatio(n)},350),this.spreadsheet=t}return r.prototype.initDevicePixelRatioListener=function(){var t;this.devicePixelRatioMedia=window.matchMedia("(resolution: ".concat(window.devicePixelRatio,"dppx)")),!((t=this.devicePixelRatioMedia)===null||t===void 0)&&t.addEventListener?this.devicePixelRatioMedia.addEventListener("change",this.renderByDevicePixelRatioChanged):this.devicePixelRatioMedia.addListener(this.renderByDevicePixelRatioChanged)},r}(),AL=function(){function r(t){this.visible=!1,this.position={x:0,y:0},this.spreadsheet=t}return r.prototype.show=function(t){var e,i,n,a=t.position,o=t.options,s=t.content,l=t.event,u=VRt(o).enterable,c=this.spreadsheet.options.tooltip||{},h=c.autoAdjustBoundary,f=c.adjustPosition;this.visible=!0,this.options=t;var d=this.getContainer();this.renderContent(s);var v=WRt({spreadsheet:this.spreadsheet,position:a,tooltipContainer:d,autoAdjustBoundary:h}),p=v.x,g=v.y;this.position=(e=f==null?void 0:f({position:{x:p,y:g},event:l}))!==null&&e!==void 0?e:{x:p,y:g},_p(d,{style:{left:"".concat((i=this.position)===null||i===void 0?void 0:i.x,"px"),top:"".concat((n=this.position)===null||n===void 0?void 0:n.y,"px"),pointerEvents:u?"all":"none"},visible:!0})},r.prototype.hide=function(){this.visible=!1,this.container&&(_p(this.container,{style:{pointerEvents:"none"},visible:!1}),this.resetPosition())},r.prototype.destroy=function(){var t,e;this.visible=!1,this.container&&(this.resetPosition(),(e=(t=this.container).remove)===null||e===void 0||e.call(t),this.container=null)},r.prototype.renderContent=function(t){if(this.container){this.clearContent();var e=(this.spreadsheet.options.tooltip||{}).content,i=t??e;if(!wr(i)){if(typeof i=="string"){this.container.innerHTML=i;return}i instanceof Element&&this.container.appendChild(i)}}},r.prototype.clearContent=function(){this.container&&(this.container.innerHTML="")},r.prototype.disablePointerEvent=function(){this.container&&this.container.style.pointerEvents!=="none"&&_p(this.container,{style:{pointerEvents:"none"}})},r.prototype.resetPosition=function(){this.position={x:0,y:0}},r.prototype.getContainer=function(){var t;if(!this.container){var e=this.spreadsheet.options.tooltip,i=((t=e.getContainer)===null||t===void 0?void 0:t.call(e))||document.body,n=document.createElement("div");return _p(n,{style:e.style,className:[bA].concat(e.className)}),i.appendChild(n),this.container=n,this.container}return this.container},r}(),v8=function(r){gt(t,r);function t(e,i,n){var a=r.call(this)||this;return a.store=new ybt,a.untypedOn=a.on,a.untypedEmit=a.emit,a.on=function(o,s){return a.untypedOn(o,s)},a.emit=function(o){for(var s=[],l=1;l<arguments.length;l++)s[l-1]=arguments[l];return a.untypedEmit.apply(a,ht([o],tt(s),!1))},a.initHiddenColumnsDetail=function(){var o=a.options.interaction.hiddenColumnFields,s=a.store.get("hiddenColumnsDetail");at(o)&&at(s)||BA(a,o,!0)},a.measureText=mu(function(o,s){var l;if(o===void 0&&(o=""),!s)return null;var u=(l=a.getCanvasElement())===null||l===void 0?void 0:l.getContext("2d"),c=s,h=c.fontSize,f=c.fontFamily,d=c.fontWeight,v=c.fontStyle,p=c.fontVariant;return u.font=[v,p,d,"".concat(h,"px"),f].join(" ").trim(),u.measureText(String(o))},function(o,s){return ht([o],tt(Ko(s)),!1).join("")}),a.measureTextWidth=function(o,s){o===void 0&&(o="");var l=a.measureText(o,s);return(l==null?void 0:l.width)||0},a.measureTextHeight=function(o,s){o===void 0&&(o="");var l=a.measureText(o,s);return l?l.actualBoundingBoxAscent+l.actualBoundingBoxDescent:0},a.measureTextWidthRoughly=function(o,s){var l,u;s===void 0&&(s={});var c=a.measureTextWidth("a",s),h=a.measureTextWidth("蚂",s),f=0;if(!o)return f;try{for(var d=Vn(o),v=d.next();!v.done;v=d.next()){var p=v.value,g=p.charCodeAt(0);f+=g>=0&&g<=255?c:h}}catch(m){l={error:m}}finally{try{v&&!v.done&&(u=d.return)&&u.call(d)}finally{if(l)throw l.error}}return f},a.dataCfg=b_(i),a.options=QI(n),a.dataSet=a.getDataSet(a.options),a.setDebug(),a.initTooltip(),a.initGroups(e),a.bindEvents(),a.initInteraction(),a.initTheme(),a.initHdAdapter(),a.registerIcons(),a.setOverscrollBehavior(),a.mountSheetInstance(),a}return t.prototype.setOverscrollBehavior=function(){var e=this.options.interaction.overscrollBehavior,i=window.getComputedStyle(document.body).getPropertyValue("overscroll-behavior"),n=i&&i!=="auto";n?this.store.set("initOverscrollBehavior",i):e&&(document.body.style.overscrollBehavior=e)},t.prototype.restoreOverscrollBehavior=function(){document.body.style.overscrollBehavior=this.store.get("initOverscrollBehavior")||""},t.prototype.setDebug=function(){Ha.getInstance().setDebug(this.options.debug)},t.prototype.initTheme=function(){this.setThemeCfg({name:"default"})},t.prototype.getMountContainer=function(e){var i=uh(e)?document.querySelector(e):e;if(!i)throw new Error("Target mount container is not a DOM element");return i},t.prototype.initHdAdapter=function(){this.options.hdAdapter&&(this.hdAdapter=new s3t(this),this.hdAdapter.init())},t.prototype.initInteraction=function(){var e,i;(i=(e=this.interaction)===null||e===void 0?void 0:e.destroy)===null||i===void 0||i.call(e),this.interaction=new o3t(this)},t.prototype.initTooltip=function(){var e,i,n,a;(i=(e=this.tooltip)===null||e===void 0?void 0:e.destroy)===null||i===void 0||i.call(e),this.tooltip=this.renderTooltip(),this.tooltip instanceof AL||console.warn("[Custom Tooltip]: ".concat((a=(n=this.tooltip)===null||n===void 0?void 0:n.constructor)===null||a===void 0?void 0:a.toString()," should be extends from BaseTooltip"))},t.prototype.renderTooltip=function(){var e,i;return((i=(e=this.options.tooltip)===null||e===void 0?void 0:e.renderTooltip)===null||i===void 0?void 0:i.call(e,this))||new AL(this)},t.prototype.showTooltip=function(e){var i,n,a=e.content,o=e.event,s=this.getCell(o==null?void 0:o.target),l=Zr(a)?a(s,e):a;(n=(i=this.tooltip).show)===null||n===void 0||n.call(i,k(k({},e),{content:l}))},t.prototype.showTooltipWithInfo=function(e,i,n){var a,o=GA(this,e),s=o.showTooltip,l=o.content;if(s){var u=this.getCell(e==null?void 0:e.target),c=(a=n==null?void 0:n.data)!==null&&a!==void 0?a:JRt({spreadsheet:this,cellInfos:i,targetCell:u,options:k({enableFormat:!0},n)});this.showTooltip({data:c,position:{x:e.clientX,y:e.clientY},options:k({enterable:!0},n),event:e,content:l})}},t.prototype.hideTooltip=function(){var e,i;(i=(e=this.tooltip).hide)===null||i===void 0||i.call(e)},t.prototype.destroyTooltip=function(){var e,i;(i=(e=this.tooltip).destroy)===null||i===void 0||i.call(e)},t.prototype.registerIcons=function(){var e=this.options.customSVGIcons;at(e)||Ht(e,function(i){q6(i.name,i.svg)})},t.prototype.setDataCfg=function(e,i){this.store.set("originalDataCfg",e),i?this.dataCfg=b_(e):this.dataCfg=b_(this.dataCfg,e),iMt(this)},t.prototype.setOptions=function(e,i){var n;this.hideTooltip(),i?this.options=QI(e):this.options=Ba(this.options,e),(i||!((n=e.tooltip)===null||n===void 0)&&n.renderTooltip)&&this.initTooltip(),this.resetHiddenColumnsDetailInfoIfNeeded(),this.registerIcons()},t.prototype.resetHiddenColumnsDetailInfoIfNeeded=function(){var e;at((e=this.options.interaction)===null||e===void 0?void 0:e.hiddenColumnFields)||this.store.set("hiddenColumnsDetail",[])},t.prototype.render=function(e,i){if(e===void 0&&(e=!0),i===void 0&&(i={}),!!this.getCanvasElement()){var n=i.reBuildDataSet,a=n===void 0?!1:n,o=i.reBuildHiddenColumnsDetail,s=o===void 0?!0:o;this.emit(G.LAYOUT_BEFORE_RENDER),a&&(this.dataSet=this.getDataSet(this.options)),e&&(this.clearDrillDownData("",!0),this.dataSet.setDataCfg(this.dataCfg)),this.buildFacet(),s&&this.initHiddenColumnsDetail(),this.emit(G.LAYOUT_AFTER_RENDER)}},t.prototype.mountSheetInstance=function(){var e=this.getCanvasElement();e&&(e.__s2_instance__=this)},t.prototype.unmountSheetInstance=function(){var e=this.getCanvasElement();e&&delete e.__s2_instance__},t.prototype.destroy=function(){var e,i,n,a,o;this.restoreOverscrollBehavior(),this.emit(G.LAYOUT_DESTROY),(e=this.facet)===null||e===void 0||e.destroy(),(i=this.hdAdapter)===null||i===void 0||i.destroy(),(n=this.interaction)===null||n===void 0||n.destroy(),(a=this.store)===null||a===void 0||a.clear(),this.destroyTooltip(),this.clearCanvasEvent(),this.unmountSheetInstance(),(o=this.container)===null||o===void 0||o.destroy(),Nbt()},t.prototype.setThemeCfg=function(e){e===void 0&&(e={});var i=(e==null?void 0:e.theme)||{},n=XTt(k(k({},e),{spreadsheet:this}));this.theme=Ba(n,i)},t.prototype.setTheme=function(e){this.theme=Ba(this.theme,e)},t.prototype.updatePagination=function(e){this.options=Ba(this.options,{pagination:e}),this.store.set("scrollX",0),this.store.set("scrollY",0)},t.prototype.getContentHeight=function(){return this.facet.getContentHeight()},t.prototype.changeSize=function(e,i){e===void 0&&(e=this.options.width),i===void 0&&(i=this.options.height),this.changeSheetSize(e,i)},t.prototype.changeSheetSize=function(e,i){e===void 0&&(e=this.options.width),i===void 0&&(i=this.options.height);var n=this.getCanvasElement(),a=this.container.get("width"),o=this.container.get("height"),s=e!==a||i!==o;!s||!n||(this.options=Ba(this.options,{width:e,height:i}),this.container.changeSize(e,i))},t.prototype.getCanvasElement=function(){return this.container.get("el")},t.prototype.getLayoutWidthType=function(){return this.options.style.layoutWidthType},t.prototype.getRowNodes=function(e){return e===void 0&&(e=-1),e===-1?this.facet.layoutResult.rowNodes:this.facet.layoutResult.rowNodes.filter(function(i){return i.level===e})},t.prototype.getRowLeafNodes=function(){var e;return((e=this.facet)===null||e===void 0?void 0:e.layoutResult.rowLeafNodes)||[]},t.prototype.getColumnNodes=function(e){var i;e===void 0&&(e=-1);var n=((i=this.facet)===null||i===void 0?void 0:i.layoutResult.colNodes)||[];return e===-1?n:n.filter(function(a){return a.level===e})},t.prototype.getColumnLeafNodes=function(){var e;return((e=this.facet)===null||e===void 0?void 0:e.layoutResult.colLeafNodes)||[]},t.prototype.updateScrollOffset=function(e){var i={offsetX:{value:void 0,animate:!1},offsetY:{value:void 0,animate:!1},rowHeaderOffsetX:{value:void 0,animate:!1}};this.facet.updateScrollOffset(Ba(i,e))},t.prototype.getTooltipDataItemMappingCallback=function(){var e;return(e=this.options)===null||e===void 0?void 0:e.mappingDisplayDataItem},t.prototype.isCellType=function(e){return e instanceof Gm},t.prototype.getCell=function(e){for(var i,n=e;n&&!(n instanceof y3);){if(this.isCellType(n))return n;n=(i=n.get)===null||i===void 0?void 0:i.call(n,"parent")}return null},t.prototype.getCellType=function(e){var i=this.getCell(e);return i==null?void 0:i.cellType},t.prototype.getTotalsConfig=function(e){var i=this.options.totals,n=this.dataSet.fields.rows,a=Nt(i,Ei(n,e)?"row":"col",{}),o=a.showSubTotals&&Ei(a.subTotalsDimensions,e)?a.showSubTotals:!1;return k(k({label:Rr("总计"),subLabel:Rr("小计"),totalsGroupDimensions:[],subTotalsGroupDimensions:[]},a),{showSubTotals:o})},t.prototype.initGroups=function(e){var i=this.options,n=i.width,a=i.height,o=i.supportCSSTransform,s=i.devicePixelRatio;this.container=new y3({container:this.getMountContainer(e),width:n,height:a,localRefresh:!1,supportCSSTransform:o,pixelRatio:Math.max(s,h4)}),this.backgroundGroup=this.container.addGroup({name:Rct,zIndex:Ect}),this.panelGroup=this.container.addGroup({name:Ict,zIndex:bct}),this.foregroundGroup=this.container.addGroup({name:Mct,zIndex:Sct}),this.initPanelGroupChildren(),this.updateContainerStyle()},t.prototype.updateContainerStyle=function(){var e=this.getCanvasElement();e&&(e.style.display="block")},t.prototype.initPanelGroupChildren=function(){this.panelScrollGroup=new VMt({name:Lct,zIndex:wct,s2:this}),this.panelGroup.add(this.panelScrollGroup)},t.prototype.getInitColumnLeafNodes=function(){return this.store.get("initColumnLeafNodes",[])},t.prototype.clearColumnLeafNodes=function(){this.clearInitColumnLeafNodes()},t.prototype.clearInitColumnLeafNodes=function(){this.store.set("initColumnLeafNodes",void 0)},t.prototype.clearCanvasEvent=function(){var e=this,i=this.getEvents();JN(i,function(n,a){e.off(a)})},t.prototype.updateSortMethodMap=function(e,i,n){var a;n===void 0&&(n=!1);var o=n?null:this.store.get("sortMethodMap");this.store.set("sortMethodMap",k(k({},o),(a={},a[e]=i,a)))},t.prototype.getMenuDefaultSelectedKeys=function(e){var i=this.store.get("sortMethodMap"),n=Nt(i,e);return n?[n]:[]},t}(fm),wzt=function(r){gt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDataSet=function(e){var i=e.dataSet,n=e.hierarchyType;if(i)return i(this);var a=n==="customTree"?new oMt(this):new gC(this);return a},t.prototype.getContentHeight=function(){return this.facet.getContentHeight()},t.prototype.isPivotMode=function(){return!0},t.prototype.isTableMode=function(){return!1},t.prototype.isHierarchyTreeType=function(){var e=this.options.hierarchyType;return e==="tree"||e==="customTree"},t.prototype.isScrollContainsRowHeader=function(){return!this.isFrozenRowHeader()},t.prototype.isFrozenRowHeader=function(){var e;return(e=this.options)===null||e===void 0?void 0:e.frozenRowHeader},t.prototype.isValueInCols=function(){var e,i;return(i=(e=this.dataSet)===null||e===void 0?void 0:e.fields)===null||i===void 0?void 0:i.valueInCols},t.prototype.clearDrillDownData=function(e,i){if(this.dataSet instanceof gC){var n=this.dataSet.clearDrillDownData(e);n&&!i&&(this.interaction.reset(),this.render(!1))}},t.prototype.getFacetCfgFromDataSetAndOptions=function(){var e=this,i=this.dataSet,n=i.fields,a=i.meta,o=this.options,s=o.style,l=o.dataCell,u=function(c){return new Zs(c,e)};return k(k(k(k({},this.options),n),s),{meta:a,spreadsheet:this,dataSet:this.dataSet,dataCell:l??u})},t.prototype.buildFacet=function(){var e,i=this.getFacetCfgFromDataSetAndOptions();(e=this.facet)===null||e===void 0||e.destroy(),this.facet=new HMt(i),this.facet.render()},t.prototype.bindEvents=function(){this.off(G.ROW_CELL_COLLAPSE_TREE_ROWS),this.off(G.LAYOUT_TREE_ROWS_COLLAPSE_ALL),this.on(G.ROW_CELL_COLLAPSE_TREE_ROWS,this.handleRowCellCollapseTreeRows),this.on(G.LAYOUT_TREE_ROWS_COLLAPSE_ALL,this.handleTreeRowsCollapseAll)},t.prototype.handleRowCellCollapseTreeRows=function(e){var i,n=e.id,a=e.isCollapsed,o={style:{collapsedRows:(i={},i[n]=a,i)}};this.emit(G.LAYOUT_COLLAPSE_ROWS,{collapsedRows:o.style.collapsedRows,meta:e==null?void 0:e.node}),this.setOptions(o),this.render(!1),this.emit(G.LAYOUT_AFTER_COLLAPSE_ROWS,{collapsedRows:o.style.collapsedRows,meta:e==null?void 0:e.node})},t.prototype.handleTreeRowsCollapseAll=function(e){var i={style:{hierarchyCollapse:!e,collapsedRows:null,rowExpandDepth:null}};this.setOptions(i),this.render(!1)},t.prototype.groupSortByMethod=function(e,i){var n=this.dataCfg.fields,a=n.rows,o=n.columns,s=this.options.style.colCfg.hideMeasureColumn,l=this.isValueInCols()?Pe(a):Pe(o),u=i.query,c=i.value,h=qd(u),f=c;s&&this.isValueInCols()&&(f=this.dataSet.fields.values[0],h[Zt]=f);var d={sortFieldId:l,sortMethod:e,sortByMeasure:f,query:h},v=this.dataCfg.sortParams.filter(function(g){return(g==null?void 0:g.sortFieldId)!==l});this.updateSortMethodMap(i.id,e,!0);var p=ht(ht([],tt(v),!1),[d],!1);this.emit(G.RANGE_SORT,p),this.setDataCfg(k(k({},this.dataCfg),{sortParams:p})),this.render()},t.prototype.handleGroupSort=function(e,i){var n=this;e.stopPropagation(),this.interaction.addIntercepts([Vt.HOVER]);var a=this.getMenuDefaultSelectedKeys(i==null?void 0:i.id),o={onClick:function(s){var l=s.key,u=l;n.groupSortByMethod(u,i),n.emit(G.RANGE_SORTED,e)},menus:$Tt(),defaultSelectedKeys:a};this.showTooltipWithInfo(e,[],{operator:o,onlyMenu:!0,forceRender:!0})},t.prototype.initPanelGroupChildren=function(){r.prototype.initPanelGroupChildren.call(this);var e={zIndex:t4,s2:this};this.frozenRowGroup=new d8(k({KEY_GROUP_PANEL_FROZEN_ROW:e4},e)),this.panelGroup.add(this.frozenRowGroup)},t.prototype.isCellType=function(e){return e instanceof Gm&&!(e instanceof L7)},t}(v8),Rzt=function(r){gt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.onSortTooltipClick=function(i,n){var a=i.key,o=n.field,s={sortFieldId:o,sortMethod:a};e.updateSortMethodMap(n.id,a),e.emit(G.RANGE_SORT,[s])},e}return t.prototype.getDataSet=function(e){var i=e.dataSet;return i?i(this):new sMt(this)},t.prototype.isPivotMode=function(){return!1},t.prototype.isTableMode=function(){return!0},t.prototype.isHierarchyTreeType=function(){return!1},t.prototype.isScrollContainsRowHeader=function(){return!1},t.prototype.isFrozenRowHeader=function(){return!1},t.prototype.clearDrillDownData=function(){},t.prototype.isValueInCols=function(){return!1},t.prototype.bindEvents=function(){},t.prototype.initPanelGroupChildren=function(){var e,i=this;r.prototype.initPanelGroupChildren.call(this);var n={zIndex:t4,s2:this};e=tt([e4,r4,Oct,Pct,Fct,Bct].map(function(a){var o=new d8(k({name:a},n));return i.panelGroup.add(o),o}),6),this.frozenRowGroup=e[0],this.frozenColGroup=e[1],this.frozenTrailingRowGroup=e[2],this.frozenTrailingColGroup=e[3],this.frozenTopGroup=e[4],this.frozenBottomGroup=e[5]},t.prototype.getFacetCfgFromDataSetAndOptions=function(){var e=this,i=this.dataSet,n=i.fields,a=i.meta,o=this.options,s=o.style,l=o.dataCell,u=function(c){return e.options.showSeriesNumber&&c.colIndex===0?new R7(c,e):new Ym(c,e)};return k(k(k(k({},this.options),n),s),{meta:a,spreadsheet:this,dataSet:this.dataSet,dataCell:l??u})},t.prototype.buildFacet=function(){var e,i=this.getFacetCfgFromDataSetAndOptions();(e=this.facet)===null||e===void 0||e.destroy(),this.facet=new WMt(i),this.facet.render()},t.prototype.clearFrozenGroups=function(){this.frozenRowGroup.set("children",[]),this.frozenColGroup.set("children",[]),this.frozenTrailingRowGroup.set("children",[]),this.frozenTrailingColGroup.set("children",[]),this.frozenTopGroup.set("children",[]),this.frozenBottomGroup.set("children",[])},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.clearFrozenGroups(),this.off(G.RANGE_SORT),this.off(G.RANGE_FILTER)},t.prototype.handleGroupSort=function(e,i){var n=this;e.stopPropagation(),this.interaction.addIntercepts([Vt.HOVER]);var a=this.getMenuDefaultSelectedKeys(i==null?void 0:i.id),o={onClick:function(s){var l=s.key,u=l;n.onSortTooltipClick({key:u},i)},menus:WTt(),defaultSelectedKeys:a};this.showTooltipWithInfo(e,[],{operator:o,onlyMenu:!0,forceRender:!0})},t}(v8),rr;(function(r){r.FORE="fore",r.MID="mid",r.BG="bg"})(rr||(rr={}));var it;(function(r){r.TOP="top",r.TOP_LEFT="top-left",r.TOP_RIGHT="top-right",r.RIGHT="right",r.RIGHT_TOP="right-top",r.RIGHT_BOTTOM="right-bottom",r.LEFT="left",r.LEFT_TOP="left-top",r.LEFT_BOTTOM="left-bottom",r.BOTTOM="bottom",r.BOTTOM_LEFT="bottom-left",r.BOTTOM_RIGHT="bottom-right",r.RADIUS="radius",r.CIRCLE="circle",r.NONE="none"})(it||(it={}));var Er;(function(r){r.AXIS="axis",r.GRID="grid",r.LEGEND="legend",r.TOOLTIP="tooltip",r.ANNOTATION="annotation",r.SLIDER="slider",r.SCROLLBAR="scrollbar",r.OTHER="other"})(Er||(Er={}));var vc={FORE:3,MID:2,BG:1},kt;(function(r){r.BEFORE_RENDER="beforerender",r.AFTER_RENDER="afterrender",r.BEFORE_PAINT="beforepaint",r.AFTER_PAINT="afterpaint",r.BEFORE_CHANGE_DATA="beforechangedata",r.AFTER_CHANGE_DATA="afterchangedata",r.BEFORE_CLEAR="beforeclear",r.AFTER_CLEAR="afterclear",r.BEFORE_DESTROY="beforedestroy",r.BEFORE_CHANGE_SIZE="beforechangesize",r.AFTER_CHANGE_SIZE="afterchangesize"})(kt||(kt={}));var As;(function(r){r.BEFORE_DRAW_ANIMATE="beforeanimate",r.AFTER_DRAW_ANIMATE="afteranimate",r.BEFORE_RENDER_LABEL="beforerenderlabel",r.AFTER_RENDER_LABEL="afterrenderlabel"})(As||(As={}));var Mi;(function(r){r.MOUSE_ENTER="plot:mouseenter",r.MOUSE_DOWN="plot:mousedown",r.MOUSE_MOVE="plot:mousemove",r.MOUSE_UP="plot:mouseup",r.MOUSE_LEAVE="plot:mouseleave",r.TOUCH_START="plot:touchstart",r.TOUCH_MOVE="plot:touchmove",r.TOUCH_END="plot:touchend",r.TOUCH_CANCEL="plot:touchcancel",r.CLICK="plot:click",r.DBLCLICK="plot:dblclick",r.CONTEXTMENU="plot:contextmenu",r.LEAVE="plot:leave",r.ENTER="plot:enter"})(Mi||(Mi={}));var E0;(function(r){r.ACTIVE="active",r.INACTIVE="inactive",r.SELECTED="selected",r.DEFAULT="default"})(E0||(E0={}));var Ju=["color","shape","size"],Ee="_origin",TL=1,bL=1,wL=.25,p8={};function l3t(r){var t=p8[r];if(!t)throw new Error("G engine '".concat(r,"' is not exist, please register it at first."));return t}function g8(r,t){p8[r]=t}function u3t(r){var t=getComputedStyle(r);return{width:(r.clientWidth||parseInt(t.width,10))-parseInt(t.paddingLeft,10)-parseInt(t.paddingRight,10),height:(r.clientHeight||parseInt(t.height,10))-parseInt(t.paddingTop,10)-parseInt(t.paddingBottom,10)}}function RL(r){return typeof r=="number"&&!isNaN(r)}function ML(r,t,e,i){var n=e,a=i;if(t){var o=u3t(r);n=o.width?o.width:n,a=o.height?o.height:a}return{width:Math.max(RL(n)?n:TL,TL),height:Math.max(RL(a)?a:bL,bL)}}function c3t(r){var t=r.parentNode;t&&t.removeChild(r)}var QA=function(r){B(t,r);function t(e){var i=r.call(this)||this;i.destroyed=!1;var n=e.visible,a=n===void 0?!0:n;return i.visible=a,i}return t.prototype.show=function(){var e=this.visible;e||this.changeVisible(!0)},t.prototype.hide=function(){var e=this.visible;e&&this.changeVisible(!1)},t.prototype.destroy=function(){this.off(),this.destroyed=!0},t.prototype.changeVisible=function(e){this.visible!==e&&(this.visible=e)},t}(du),IL=0,h3t=1/2,f3t=1/2,d3t=.05,Jm=function(){function r(t){var e=t.xField,i=t.yField,n=t.adjustNames,a=n===void 0?["x","y"]:n,o=t.dimValuesMap;this.adjustNames=a,this.xField=e,this.yField=i,this.dimValuesMap=o}return r.prototype.isAdjust=function(t){return this.adjustNames.indexOf(t)>=0},r.prototype.getAdjustRange=function(t,e,i){var n=this.yField,a=i.indexOf(e),o=i.length,s,l;return!n&&this.isAdjust("y")?(s=0,l=1):o>1?(s=i[a===0?0:a-1],l=i[a===o-1?o-1:a+1],a!==0?s+=(e-s)/2:s-=(l-e)/2,a!==o-1?l-=(l-e)/2:l+=(e-i[o-2])/2):(s=e===0?0:e-.5,l=e===0?1:e+.5),{pre:s,next:l}},r.prototype.adjustData=function(t,e){var i=this,n=this.getDimValues(e);R(t,function(a,o){R(n,function(s,l){i.adjustDim(l,s,a,o)})})},r.prototype.groupData=function(t,e){return R(t,function(i){i[e]===void 0&&(i[e]=IL)}),cn(t,e)},r.prototype.adjustDim=function(t,e,i,n){},r.prototype.getDimValues=function(t){var e=this,i=e.xField,n=e.yField,a=ye({},this.dimValuesMap),o=[];if(i&&this.isAdjust("x")&&o.push(i),n&&this.isAdjust("y")&&o.push(n),o.forEach(function(l){a&&a[l]||(a[l]=xa(t,l).sort(function(u,c){return u-c}))}),!n&&this.isAdjust("y")){var s="y";a[s]=[IL,1]}return a},r}(),m8={},y8=function(r){return m8[r.toLowerCase()]},ty=function(r,t){if(y8(r))throw new Error("Adjust type '"+r+"' existed.");m8[r.toLowerCase()]=t};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var CC=function(r,t){return CC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},CC(r,t)};function ey(r,t){CC(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Wa=function(){return Wa=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},Wa.apply(this,arguments)},v3t=function(r){ey(t,r);function t(e){var i=r.call(this,e)||this;i.cacheMap={},i.adjustDataArray=[],i.mergeData=[];var n=e.marginRatio,a=n===void 0?h3t:n,o=e.dodgeRatio,s=o===void 0?f3t:o,l=e.dodgeBy,u=e.intervalPadding,c=e.dodgePadding,h=e.xDimensionLength,f=e.groupNum,d=e.defaultSize,v=e.maxColumnWidth,p=e.minColumnWidth,g=e.columnWidthRatio,m=e.customOffset;return i.marginRatio=a,i.dodgeRatio=s,i.dodgeBy=l,i.intervalPadding=u,i.dodgePadding=c,i.xDimensionLegenth=h,i.groupNum=f,i.defaultSize=d,i.maxColumnWidth=v,i.minColumnWidth=p,i.columnWidthRatio=g,i.customOffset=m,i}return t.prototype.process=function(e){var i=Dr(e),n=vn(i),a=this.dodgeBy,o=a?uit(n,a):i;return this.cacheMap={},this.adjustDataArray=o,this.mergeData=n,this.adjustData(o,n),this.adjustDataArray=[],this.mergeData=[],i},t.prototype.adjustDim=function(e,i,n,a){var o=this,s=this.customOffset,l=this.getDistribution(e),u=this.groupData(n,e);return R(u,function(c,h){var f;i.length===1?f={pre:i[0]-1,next:i[0]+1}:f=o.getAdjustRange(e,parseFloat(h),i),R(c,function(d){var v=d[e],p=l[v],g=p.indexOf(a);if(j(s))d[e]=o.getDodgeOffset(f,g,p.length);else{var m=f.pre,y=f.next;d[e]=ut(s)?s(d,f):(m+y)/2+s}})}),[]},t.prototype.getDodgeOffset=function(e,i,n){var a=this,o=a.dodgeRatio,s=a.marginRatio,l=a.intervalPadding,u=a.dodgePadding,c=e.pre,h=e.next,f=h-c,d;if(!j(l)&&j(u)&&l>=0){var v=this.getIntervalOnlyOffset(n,i);d=c+v}else if(!j(u)&&j(l)&&u>=0){var v=this.getDodgeOnlyOffset(n,i);d=c+v}else if(!j(l)&&!j(u)&&l>=0&&u>=0){var v=this.getIntervalAndDodgeOffset(n,i);d=c+v}else{var p=f*o/n,g=s*p,v=1/2*(f-n*p-(n-1)*g)+((i+1)*p+i*g)-1/2*p-1/2*f;d=(c+h)/2+v}return d},t.prototype.getIntervalOnlyOffset=function(e,i){var n=this,a=n.defaultSize,o=n.intervalPadding,s=n.xDimensionLegenth,l=n.groupNum,u=n.dodgeRatio,c=n.maxColumnWidth,h=n.minColumnWidth,f=n.columnWidthRatio,d=o/s,v=(1-(l-1)*d)/l*u/(e-1),p=((1-d*(l-1))/l-v*(e-1))/e;if(p=j(f)?p:1/l/e*f,!j(c)){var g=c/s;p=Math.min(p,g)}if(!j(h)){var m=h/s;p=Math.max(p,m)}p=a?a/s:p,v=((1-(l-1)*d)/l-e*p)/(e-1);var y=((1/2+i)*p+i*v+1/2*d)*l-d/2;return y},t.prototype.getDodgeOnlyOffset=function(e,i){var n=this,a=n.defaultSize,o=n.dodgePadding,s=n.xDimensionLegenth,l=n.groupNum,u=n.marginRatio,c=n.maxColumnWidth,h=n.minColumnWidth,f=n.columnWidthRatio,d=o/s,v=1*u/(l-1),p=((1-v*(l-1))/l-d*(e-1))/e;if(p=f?1/l/e*f:p,!j(c)){var g=c/s;p=Math.min(p,g)}if(!j(h)){var m=h/s;p=Math.max(p,m)}p=a?a/s:p,v=(1-(p*e+d*(e-1))*l)/(l-1);var y=((1/2+i)*p+i*d+1/2*v)*l-v/2;return y},t.prototype.getIntervalAndDodgeOffset=function(e,i){var n=this,a=n.intervalPadding,o=n.dodgePadding,s=n.xDimensionLegenth,l=n.groupNum,u=a/s,c=o/s,h=((1-u*(l-1))/l-c*(e-1))/e,f=((1/2+i)*h+i*c+1/2*u)*l-u/2;return f},t.prototype.getDistribution=function(e){var i=this.adjustDataArray,n=this.cacheMap,a=n[e];return a||(a={},R(i,function(o,s){var l=xa(o,e);l.length||l.push(0),R(l,function(u){a[u]||(a[u]=[]),a[u].push(s)})}),n[e]=a),a},t}(Jm);function p3t(r,t){return(t-r)*Math.random()+r}var g3t=function(r){ey(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.process=function(e){var i=Dr(e),n=vn(i);return this.adjustData(i,n),i},t.prototype.adjustDim=function(e,i,n){var a=this,o=this.groupData(n,e);return R(o,function(s,l){return a.adjustGroup(s,e,parseFloat(l),i)})},t.prototype.getAdjustOffset=function(e){var i=e.pre,n=e.next,a=(n-i)*d3t;return p3t(i+a,n-a)},t.prototype.adjustGroup=function(e,i,n,a){var o=this,s=this.getAdjustRange(i,n,a);return R(e,function(l){l[i]=o.getAdjustOffset(s)}),e},t}(Jm),O_=wit,m3t=function(r){ey(t,r);function t(e){var i=r.call(this,e)||this,n=e.adjustNames,a=n===void 0?["y"]:n,o=e.height,s=o===void 0?NaN:o,l=e.size,u=l===void 0?10:l,c=e.reverseOrder,h=c===void 0?!1:c;return i.adjustNames=a,i.height=s,i.size=u,i.reverseOrder=h,i}return t.prototype.process=function(e){var i=this,n=i.yField,a=i.reverseOrder,o=n?this.processStack(e):this.processOneDimStack(e);return a?this.reverse(o):o},t.prototype.reverse=function(e){return e.slice(0).reverse()},t.prototype.processStack=function(e){var i=this,n=i.xField,a=i.yField,o=i.reverseOrder,s=o?this.reverse(e):e,l=new O_,u=new O_;return s.map(function(c){return c.map(function(h){var f,d=L(h,n,0),v=L(h,[a]),p=d.toString();if(v=Z(v)?v[1]:v,!j(v)){var g=v>=0?l:u;g.has(p)||g.set(p,0);var m=g.get(p),y=v+m;return g.set(p,y),Wa(Wa({},h),(f={},f[a]=[m,y],f))}return h})})},t.prototype.processOneDimStack=function(e){var i=this,n=this,a=n.xField,o=n.height,s=n.reverseOrder,l="y",u=s?this.reverse(e):e,c=new O_;return u.map(function(h){return h.map(function(f){var d,v=i.size,p=f[a],g=v*2/o;c.has(p)||c.set(p,g/2);var m=c.get(p);return c.set(p,m+g),Wa(Wa({},f),(d={},d[l]=m,d))})})},t}(Jm),y3t=function(r){ey(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.process=function(e){var i=vn(e),n=this,a=n.xField,o=n.yField,s=this.getXValuesMaxMap(i),l=Math.max.apply(Math,Object.keys(s).map(function(u){return s[u]}));return Ne(e,function(u){return Ne(u,function(c){var h,f,d=c[o],v=c[a];if(Z(d)){var p=(l-s[v])/2;return Wa(Wa({},c),(h={},h[o]=Ne(d,function(m){return p+m}),h))}var g=(l-d)/2;return Wa(Wa({},c),(f={},f[o]=[g,d+g],f))})})},t.prototype.getXValuesMaxMap=function(e){var i=this,n=this,a=n.xField,o=n.yField,s=cn(e,function(l){return l[a]});return Sit(s,function(l){return i.getDimMaxValue(l,o)})},t.prototype.getDimMaxValue=function(e,i){var n=Ne(e,function(o){return L(o,i,[])}),a=vn(n);return Math.max.apply(Math,a)},t}(Jm);ty("Dodge",v3t);ty("Jitter",g3t);ty("Stack",m3t);ty("Symmetric",y3t);var LL=function(r,t){return mt(t)?t:r.invert(r.scale(t))},cv=function(){function r(t){this.names=[],this.scales=[],this.linear=!1,this.values=[],this.callback=function(){return[]},this._parseCfg(t)}return r.prototype.mapping=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=e.map(function(a,o){return t._toOriginParam(a,t.scales[o])});return this.callback.apply(this,n)},r.prototype.getLinearValue=function(t){var e=this.values.length-1,i=Math.floor(e*t),n=e*t-i,a=this.values[i],o=i===e?a:this.values[i+1];return a+(o-a)*n},r.prototype.getNames=function(){for(var t=this.scales,e=this.names,i=Math.min(t.length,e.length),n=[],a=0;a<i;a+=1)n.push(e[a]);return n},r.prototype.getFields=function(){return this.scales.map(function(t){return t.field})},r.prototype.getScale=function(t){return this.scales[this.names.indexOf(t)]},r.prototype.defaultCallback=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e.length===0?this.values:e.map(function(n,a){var o=t.scales[a];return o.type==="identity"?o.values[0]:t._getAttributeValue(o,n)})},r.prototype._parseCfg=function(t){var e=this,i=t.type,n=i===void 0?"base":i,a=t.names,o=a===void 0?[]:a,s=t.scales,l=s===void 0?[]:s,u=t.values,c=u===void 0?[]:u,h=t.callback;this.type=n,this.scales=l,this.values=c,this.names=o,this.callback=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];if(h){var v=h.apply(void 0,f);if(!j(v))return[v]}return e.defaultCallback.apply(e,f)}},r.prototype._getAttributeValue=function(t,e){if(t.isCategory&&!this.linear){var i=t.translate(e);return this.values[i%this.values.length]}var n=t.scale(e);return this.getLinearValue(n)},r.prototype._toOriginParam=function(t,e){return e.isLinear?t:Z(t)?t.map(function(i){return LL(e,i)}):LL(e,t)},r}(),_3t=/rgba?\(([\s.,0-9]+)\)/,x3t=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,C3t=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,E3t=/[\d.]+:(#[^\s]+|[^\)]+\))/gi,S3t=function(r){return/^[r,R,L,l]{1}[\s]*\(/.test(r)},A3t=function(){var r=document.createElement("i");return r.title="Web Colour Picker",r.style.display="none",document.body.appendChild(r),r},P_=function(r,t,e,i){return r[i]+(t[i]-r[i])*e};function _8(r){return"#"+F_(r[0])+F_(r[1])+F_(r[2])}var x8=function(r){return[parseInt(r.substr(1,2),16),parseInt(r.substr(3,2),16),parseInt(r.substr(5,2),16)]},F_=function(r){var t=Math.round(r).toString(16);return t.length===1?"0"+t:t},T3t=function(r,t){var e=isNaN(Number(t))||t<0?0:t>1?1:Number(t),i=r.length-1,n=Math.floor(i*e),a=i*e-n,o=r[n],s=n===i?o:r[n+1];return _8([P_(o,s,a,0),P_(o,s,a,1),P_(o,s,a,2)])},Cp,C8=function(r){if(r[0]==="#"&&r.length===7)return r;Cp||(Cp=A3t()),Cp.style.color=r;var t=document.defaultView.getComputedStyle(Cp,"").getPropertyValue("color"),e=_3t.exec(t),i=e[1].split(/\s*,\s*/).map(function(n){return Number(n)});return t=_8(i),t},b3t=function(r){var t=mt(r)?r.split("-"):r,e=Ne(t,function(i){return x8(i.indexOf("#")===-1?C8(i):i)});return function(i){return T3t(e,i)}},w3t=function(r){if(S3t(r)){var t,e=void 0;if(r[0]==="l"){var i=x3t.exec(r),n=+i[1]+90;e=i[2],t="linear-gradient("+n+"deg, "}else if(r[0]==="r"){t="radial-gradient(";var i=C3t.exec(r);e=i[4]}var a=e.match(E3t);return R(a,function(o,s){var l=o.split(":");t+=l[1]+" "+l[0]*100+"%",s!==a.length-1&&(t+=", ")}),t+=")",t}return r};const Ts={rgb2arr:x8,gradient:b3t,toRGB:Qc(C8),toCSSGradient:w3t};var R3t=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.type="color",i.names=["color"],mt(i.values)&&(i.linear=!0),i.gradient=Ts.gradient(i.values),i}return t.prototype.getLinearValue=function(e){return this.gradient(e)},t}(cv),M3t=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.type="opacity",i.names=["opacity"],i}return t}(cv),I3t=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.names=["x","y"],i.type="position",i}return t.prototype.mapping=function(e,i){var n=this.scales,a=n[0],o=n[1];return j(e)||j(i)?[]:[Z(e)?e.map(function(s){return a.scale(s)}):a.scale(e),Z(i)?i.map(function(s){return o.scale(s)}):o.scale(i)]},t}(cv),L3t=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.type="shape",i.names=["shape"],i}return t.prototype.getLinearValue=function(e){var i=Math.round((this.values.length-1)*e);return this.values[i]},t}(cv),O3t=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.type="size",i.names=["size"],i}return t}(cv),E8={};function P3t(r){return E8[r]}function co(r,t){E8[r]=t}var JA=function(){function r(t){this.type="base",this.isCategory=!1,this.isLinear=!1,this.isContinuous=!1,this.isIdentity=!1,this.values=[],this.range=[0,1],this.ticks=[],this.__cfg__=t,this.initCfg(),this.init()}return r.prototype.translate=function(t){return t},r.prototype.change=function(t){ye(this.__cfg__,t),this.init()},r.prototype.clone=function(){return this.constructor(this.__cfg__)},r.prototype.getTicks=function(){var t=this;return Ne(this.ticks,function(e,i){return re(e)?e:{text:t.getText(e,i),tickValue:e,value:t.scale(e)}})},r.prototype.getText=function(t,e){var i=this.formatter,n=i?i(t,e):t;return j(n)||!ut(n.toString)?"":n.toString()},r.prototype.getConfig=function(t){return this.__cfg__[t]},r.prototype.init=function(){ye(this,this.__cfg__),this.setDomain(),Gi(this.getConfig("ticks"))&&(this.ticks=this.calculateTicks())},r.prototype.initCfg=function(){},r.prototype.setDomain=function(){},r.prototype.calculateTicks=function(){var t=this.tickMethod,e=[];if(mt(t)){var i=P3t(t);if(!i)throw new Error("There is no method to to calculate ticks!");e=i(this)}else ut(t)&&(e=t(this));return e},r.prototype.rangeMin=function(){return this.range[0]},r.prototype.rangeMax=function(){return this.range[1]},r.prototype.calcPercent=function(t,e,i){return Mt(t)?(t-e)/(i-e):NaN},r.prototype.calcValue=function(t,e,i){return e+t*(i-e)},r}(),ry=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="cat",e.isCategory=!0,e}return t.prototype.buildIndexMap=function(){if(!this.translateIndexMap){this.translateIndexMap=new Map;for(var e=0;e<this.values.length;e++)this.translateIndexMap.set(this.values[e],e)}},t.prototype.translate=function(e){this.buildIndexMap();var i=this.translateIndexMap.get(e);return i===void 0&&(i=Mt(e)?e:NaN),i},t.prototype.scale=function(e){var i=this.translate(e),n=this.calcPercent(i,this.min,this.max);return this.calcValue(n,this.rangeMin(),this.rangeMax())},t.prototype.invert=function(e){var i=this.max-this.min,n=this.calcPercent(e,this.rangeMin(),this.rangeMax()),a=Math.round(i*n)+this.min;return a<this.min||a>this.max?NaN:this.values[a]},t.prototype.getText=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var a=e;return Mt(e)&&!this.values.includes(e)&&(a=this.values[a]),r.prototype.getText.apply(this,kf([a],i))},t.prototype.initCfg=function(){this.tickMethod="cat"},t.prototype.setDomain=function(){if(j(this.getConfig("min"))&&(this.min=0),j(this.getConfig("max"))){var e=this.values.length;this.max=e>1?e-1:e}this.translateIndexMap&&(this.translateIndexMap=void 0)},t}(JA);function F3t(r){return function(t,e,i,n){for(var a=j(i)?0:i,o=j(n)?t.length:n;a<o;){var s=a+o>>>1;r(t[s])>e?o=s:a=s+1}return a}}var OL="format";function S8(r,t){var e=DH[OL]||NH[OL];return e(r,t)}function S0(r){return mt(r)&&(r.indexOf("T")>0?r=new Date(r).getTime():r=new Date(r.replace(/-/gi,"/")).getTime()),HB(r)&&(r=r.getTime()),r}var oa=1e3,Nl=60*oa,kl=60*Nl,wo=24*kl,If=wo*31,PL=wo*365,Wh=[["HH:mm:ss",oa],["HH:mm:ss",oa*10],["HH:mm:ss",oa*30],["HH:mm",Nl],["HH:mm",Nl*10],["HH:mm",Nl*30],["HH",kl],["HH",kl*6],["HH",kl*12],["YYYY-MM-DD",wo],["YYYY-MM-DD",wo*4],["YYYY-WW",wo*7],["YYYY-MM",If],["YYYY-MM",If*4],["YYYY-MM",If*6],["YYYY",wo*380]];function B3t(r,t,e){var i=(t-r)/e,n=F3t(function(o){return o[1]})(Wh,i)-1,a=Wh[n];return n<0?a=Wh[0]:n>=Wh.length&&(a=fr(Wh)),a}var D3t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="timeCat",e}return t.prototype.translate=function(e){e=S0(e);var i=this.values.indexOf(e);return i===-1&&(Mt(e)&&e<this.values.length?i=e:i=NaN),i},t.prototype.getText=function(e,i){var n=this.translate(e);if(n>-1){var a=this.values[n],o=this.formatter;return a=o?o(a,i):S8(a,this.mask),a}return e},t.prototype.initCfg=function(){this.tickMethod="time-cat",this.mask="YYYY-MM-DD",this.tickCount=7},t.prototype.setDomain=function(){var e=this.values;R(e,function(i,n){e[n]=S0(i)}),e.sort(function(i,n){return i-n}),r.prototype.setDomain.call(this)},t}(ry),iy=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isContinuous=!0,e}return t.prototype.scale=function(e){if(j(e))return NaN;var i=this.rangeMin(),n=this.rangeMax(),a=this.max,o=this.min;if(a===o)return i;var s=this.getScalePercent(e);return i+s*(n-i)},t.prototype.init=function(){r.prototype.init.call(this);var e=this.ticks,i=un(e),n=fr(e);i<this.min&&(this.min=i),n>this.max&&(this.max=n),j(this.minLimit)||(this.min=i),j(this.maxLimit)||(this.max=n)},t.prototype.setDomain=function(){var e=kB(this.values),i=e.min,n=e.max;j(this.min)&&(this.min=i),j(this.max)&&(this.max=n),this.min>this.max&&(this.min=i,this.max=n)},t.prototype.calculateTicks=function(){var e=this,i=r.prototype.calculateTicks.call(this);return this.nice||(i=Ur(i,function(n){return n>=e.min&&n<=e.max})),i},t.prototype.getScalePercent=function(e){var i=this.max,n=this.min;return(e-n)/(i-n)},t.prototype.getInvertPercent=function(e){return(e-this.rangeMin())/(this.rangeMax()-this.rangeMin())},t}(JA),ny=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="linear",e.isLinear=!0,e}return t.prototype.invert=function(e){var i=this.getInvertPercent(e);return this.min+i*(this.max-this.min)},t.prototype.initCfg=function(){this.tickMethod="wilkinson-extended",this.nice=!1},t}(iy);function ds(r,t){var e=Math.E,i;return t>=0?i=Math.pow(e,Math.log(t)/r):i=Math.pow(e,Math.log(-t)/r)*-1,i}function On(r,t){return r===1?1:Math.log(t)/Math.log(r)}function A8(r,t,e){j(e)&&(e=Math.max.apply(null,r));var i=e;return R(r,function(n){n>0&&n<i&&(i=n)}),i===e&&(i=e/t),i>1&&(i=1),i}var N3t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="log",e}return t.prototype.invert=function(e){var i=this.base,n=On(i,this.max),a=this.rangeMin(),o=this.rangeMax()-a,s,l=this.positiveMin;if(l){if(e===0)return 0;s=On(i,l/i);var u=1/(n-s)*o;if(e<u)return e/u*l}else s=On(i,this.min);var c=(e-a)/o,h=c*(n-s)+s;return Math.pow(i,h)},t.prototype.initCfg=function(){this.tickMethod="log",this.base=10,this.tickCount=6,this.nice=!0},t.prototype.setDomain=function(){r.prototype.setDomain.call(this);var e=this.min;if(e<0)throw new Error("When you use log scale, the minimum value must be greater than zero!");e===0&&(this.positiveMin=A8(this.values,this.base,this.max))},t.prototype.getScalePercent=function(e){var i=this.max,n=this.min;if(i===n||e<=0)return 0;var a=this.base,o=this.positiveMin;o&&(n=o*1/a);var s;return e<o?s=e/o/(On(a,i)-On(a,n)):s=(On(a,e)-On(a,n))/(On(a,i)-On(a,n)),s},t}(iy),k3t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="pow",e}return t.prototype.invert=function(e){var i=this.getInvertPercent(e),n=this.exponent,a=ds(n,this.max),o=ds(n,this.min),s=i*(a-o)+o,l=s>=0?1:-1;return Math.pow(s,n)*l},t.prototype.initCfg=function(){this.tickMethod="pow",this.exponent=2,this.tickCount=5,this.nice=!0},t.prototype.getScalePercent=function(e){var i=this.max,n=this.min;if(i===n)return 0;var a=this.exponent,o=(ds(a,e)-ds(a,n))/(ds(a,i)-ds(a,n));return o},t}(iy),U3t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="time",e}return t.prototype.getText=function(e,i){var n=this.translate(e),a=this.formatter;return a?a(n,i):S8(n,this.mask)},t.prototype.scale=function(e){var i=e;return(mt(i)||HB(i))&&(i=this.translate(i)),r.prototype.scale.call(this,i)},t.prototype.translate=function(e){return S0(e)},t.prototype.initCfg=function(){this.tickMethod="time-pretty",this.mask="YYYY-MM-DD",this.tickCount=7,this.nice=!1},t.prototype.setDomain=function(){var e=this.values,i=this.getConfig("min"),n=this.getConfig("max");if((!j(i)||!Mt(i))&&(this.min=this.translate(this.min)),(!j(n)||!Mt(n))&&(this.max=this.translate(this.max)),e&&e.length){var a=[],o=1/0,s=o,l=0;R(e,function(u){var c=S0(u);if(isNaN(c))throw new TypeError("Invalid Time: "+u+" in time scale!");o>c?(s=o,o=c):s>c&&(s=c),l<c&&(l=c),a.push(c)}),e.length>1&&(this.minTickInterval=s-o),j(i)&&(this.min=o),j(n)&&(this.max=l)}},t}(ny),T8=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="quantize",e}return t.prototype.invert=function(e){var i=this.ticks,n=i.length,a=this.getInvertPercent(e),o=Math.floor(a*(n-1));if(o>=n-1)return fr(i);if(o<0)return un(i);var s=i[o],l=i[o+1],u=o/(n-1),c=(o+1)/(n-1);return s+(a-u)/(c-u)*(l-s)},t.prototype.initCfg=function(){this.tickMethod="r-pretty",this.tickCount=5,this.nice=!0},t.prototype.calculateTicks=function(){var e=r.prototype.calculateTicks.call(this);return this.nice||(fr(e)!==this.max&&e.push(this.max),un(e)!==this.min&&e.unshift(this.min)),e},t.prototype.getScalePercent=function(e){var i=this.ticks;if(e<un(i))return 0;if(e>fr(i))return 1;var n=0;return R(i,function(a,o){if(e>=a)n=o;else return!1}),n/(i.length-1)},t}(iy),z3t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="quantile",e}return t.prototype.initCfg=function(){this.tickMethod="quantile",this.tickCount=5,this.nice=!0},t}(T8),b8={};function EC(r){return b8[r]}function ho(r,t){if(EC(r))throw new Error("type '"+r+"' existed.");b8[r]=t}var H3t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="identity",e.isIdentity=!0,e}return t.prototype.calculateTicks=function(){return this.values},t.prototype.scale=function(e){return this.values[0]!==e&&Mt(e)?e:this.range[0]},t.prototype.invert=function(e){var i=this.range;return e<i[0]||e>i[1]?NaN:this.values[0]},t}(JA);function w8(r){var t=r.values,e=r.tickInterval,i=r.tickCount,n=r.showLast;if(Mt(e)){var a=Ur(t,function(v,p){return p%e===0}),o=fr(t);return n&&fr(a)!==o&&a.push(o),a}var s=t.length,l=r.min,u=r.max;if(j(l)&&(l=0),j(u)&&(u=t.length-1),!Mt(i)||i>=s)return t.slice(l,u+1);if(i<=0||u<=0)return[];for(var c=i===1?s:Math.floor(s/(i-1)),h=[],f=l,d=0;d<i&&!(f>=u);d++)f=Math.min(l+d*c,u),d===i-1&&n?h.push(t[u]):h.push(t[f]);return h}function $3t(r){var t=r.min,e=r.max,i=r.nice,n=r.tickCount,a=new W3t;return a.domain([t,e]),i&&a.nice(n),a.ticks(n)}var B_=5,FL=Math.sqrt(50),BL=Math.sqrt(10),DL=Math.sqrt(2),W3t=function(){function r(){this._domain=[0,1]}return r.prototype.domain=function(t){return t?(this._domain=Array.from(t,Number),this):this._domain.slice()},r.prototype.nice=function(t){var e,i;t===void 0&&(t=B_);var n=this._domain.slice(),a=0,o=this._domain.length-1,s=this._domain[a],l=this._domain[o],u;return l<s&&(e=[l,s],s=e[0],l=e[1],i=[o,a],a=i[0],o=i[1]),u=lg(s,l,t),u>0?(s=Math.floor(s/u)*u,l=Math.ceil(l/u)*u,u=lg(s,l,t)):u<0&&(s=Math.ceil(s*u)/u,l=Math.floor(l*u)/u,u=lg(s,l,t)),u>0?(n[a]=Math.floor(s/u)*u,n[o]=Math.ceil(l/u)*u,this.domain(n)):u<0&&(n[a]=Math.ceil(s*u)/u,n[o]=Math.floor(l*u)/u,this.domain(n)),this},r.prototype.ticks=function(t){return t===void 0&&(t=B_),V3t(this._domain[0],this._domain[this._domain.length-1],t||B_)},r}();function V3t(r,t,e){var i,n=-1,a,o,s;if(t=+t,r=+r,e=+e,r===t&&e>0)return[r];if((i=t<r)&&(a=r,r=t,t=a),(s=lg(r,t,e))===0||!isFinite(s))return[];if(s>0)for(r=Math.ceil(r/s),t=Math.floor(t/s),o=new Array(a=Math.ceil(t-r+1));++n<a;)o[n]=(r+n)*s;else for(r=Math.floor(r*s),t=Math.ceil(t*s),o=new Array(a=Math.ceil(r-t+1));++n<a;)o[n]=(r-n)/s;return i&&o.reverse(),o}function lg(r,t,e){var i=(t-r)/Math.max(0,e),n=Math.floor(Math.log(i)/Math.LN10),a=i/Math.pow(10,n);return n>=0?(a>=FL?10:a>=BL?5:a>=DL?2:1)*Math.pow(10,n):-Math.pow(10,-n)/(a>=FL?10:a>=BL?5:a>=DL?2:1)}function NL(r,t,e){var i;return e==="ceil"?i=Math.ceil(r/t):e==="floor"?i=Math.floor(r/t):i=Math.round(r/t),i*t}function tT(r,t,e){var i=NL(r,e,"floor"),n=NL(t,e,"ceil");i=t_(i,e),n=t_(n,e);for(var a=[],o=Math.max((n-i)/(Math.pow(2,12)-1),e),s=i;s<=n;s=s+o){var l=t_(s,o);a.push(l)}return{min:i,max:n,ticks:a}}function eT(r,t,e){var i,n=r.minLimit,a=r.maxLimit,o=r.min,s=r.max,l=r.tickCount,u=l===void 0?5:l,c=j(n)?j(t)?o:t:n,h=j(a)?j(e)?s:e:a;if(c>h&&(i=[c,h],h=i[0],c=i[1]),u<=2)return[c,h];for(var f=(h-c)/(u-1),d=[],v=0;v<u;v++)d.push(c+f*v);return d}function G3t(r){var t=r.min,e=r.max,i=r.tickInterval,n=r.minLimit,a=r.maxLimit,o=$3t(r);return!j(n)||!j(a)?eT(r,un(o),fr(o)):i?tT(t,e,i).ticks:o}function fl(r){return Math.abs(r)<1e-15?r:parseFloat(r.toFixed(15))}var X3t=[1,5,2,2.5,4,3],kL=Number.EPSILON*100;function Y3t(r,t){return(r%t+t)%t}function j3t(r){return Math.round(r*1e12)/1e12}function Z3t(r,t,e,i,n,a){var o=Tr(t),s=GB(t,r),l=0,u=Y3t(i,a);return(u<kL||a-u<kL)&&i<=0&&n>=0&&(l=1),1-s/(o-1)-e+l}function q3t(r,t,e){var i=Tr(t),n=GB(t,r),a=1;return 1-n/(i-1)-e+a}function K3t(r,t,e,i,n,a){var o=(r-1)/(a-n),s=(t-1)/(Math.max(a,i)-Math.min(e,n));return 2-Math.max(o/s,s/o)}function Q3t(r,t){return r>=t?2-(r-1)/(t-1):1}function J3t(r,t,e,i){var n=t-r;return 1-.5*(Math.pow(t-i,2)+Math.pow(r-e,2))/Math.pow(.1*n,2)}function tIt(r,t,e){var i=t-r;if(e>i){var n=(e-i)/2;return 1-Math.pow(n,2)/Math.pow(.1*i,2)}return 1}function eIt(){return 1}function rIt(r,t,e,i,n,a){e===void 0&&(e=5),i===void 0&&(i=!0),n===void 0&&(n=X3t),a===void 0&&(a=[.25,.2,.5,.05]);var o=e<0?0:Math.round(e);if(Number.isNaN(r)||Number.isNaN(t)||typeof r!="number"||typeof t!="number"||!o)return{min:0,max:0,ticks:[]};if(t-r<1e-15||o===1)return{min:r,max:t,ticks:[r]};if(t-r>1e148){var s=e||5,l=(t-r)/s;return{min:r,max:t,ticks:Array(s).fill(null).map(function(et,ft){return fl(r+l*ft)})}}for(var u={score:-2,lmin:0,lmax:0,lstep:0},c=1;c<1/0;){for(var h=0;h<n.length;h+=1){var f=n[h],d=q3t(f,n,c);if(a[0]*d+a[1]+a[2]+a[3]<u.score){c=1/0;break}for(var v=2;v<1/0;){var p=Q3t(v,o);if(a[0]*d+a[1]+a[2]*p+a[3]<u.score)break;for(var g=(t-r)/(v+1)/c/f,m=Math.ceil(Math.log10(g));m<1/0;){var y=c*f*Math.pow(10,m),_=tIt(r,t,y*(v-1));if(a[0]*d+a[1]*_+a[2]*p+a[3]<u.score)break;var x=Math.floor(t/y)*c-(v-1)*c,C=Math.ceil(r/y)*c;if(x<=C)for(var s=C-x,A=0;A<=s;A+=1){var T=x+A,w=T*(y/c),M=w+y*(v-1),O=y,P=Z3t(f,n,c,w,M,O),D=J3t(r,t,w,M),z=K3t(v,o,r,t,w,M),Y=eIt(),H=a[0]*P+a[1]*D+a[2]*z+a[3]*Y;H>u.score&&(!i||w<=r&&M>=t)&&(u.lmin=w,u.lmax=M,u.lstep=O,u.score=H)}m+=1}v+=1}}c+=1}var N=fl(u.lmax),W=fl(u.lmin),Q=fl(u.lstep),q=Math.floor(j3t((N-W)/Q))+1,J=new Array(q);J[0]=fl(W);for(var h=1;h<q;h++)J[h]=fl(J[h-1]+Q);return{min:Math.min(r,un(J)),max:Math.max(t,fr(J)),ticks:J}}function iIt(r){var t=r.min,e=r.max,i=r.tickCount,n=r.nice,a=r.tickInterval,o=r.minLimit,s=r.maxLimit,l=rIt(t,e,i,n).ticks;return!j(o)||!j(s)?eT(r,un(l),fr(l)):a?tT(t,e,a).ticks:l}function nIt(r){var t=r.base,e=r.tickCount,i=r.min,n=r.max,a=r.values,o,s=On(t,n);if(i>0)o=Math.floor(On(t,i));else{var l=A8(a,t,n);o=Math.floor(On(t,l))}for(var u=s-o,c=Math.ceil(u/e),h=[],f=o;f<s+c;f=f+c)h.push(Math.pow(t,f));return i<=0&&h.unshift(0),h}function R8(r,t,e){if(e===void 0&&(e=5),r===t)return{max:t,min:r,ticks:[r]};var i=e<0?0:Math.round(e);if(i===0)return{max:t,min:r,ticks:[]};var n=1.5,a=.5+1.5*n,o=t-r,s=o/i,l=Math.pow(10,Math.floor(Math.log10(s))),u=l;2*l-s<n*(s-u)&&(u=2*l,5*l-s<a*(s-u)&&(u=5*l,10*l-s<n*(s-u)&&(u=10*l)));for(var c=Math.ceil(t/u),h=Math.floor(r/u),f=Math.max(c*u,t),d=Math.min(h*u,r),v=Math.floor((f-d)/u)+1,p=new Array(v),g=0;g<v;g++)p[g]=fl(d+g*u);return{min:d,max:f,ticks:p}}function aIt(r){var t=r.exponent,e=r.tickCount,i=Math.ceil(ds(t,r.max)),n=Math.floor(ds(t,r.min)),a=R8(n,i,e).ticks;return a.map(function(o){var s=o>=0?1:-1;return Math.pow(o,t)*s})}function oIt(r,t){var e=r.length*t;return t===1?r[r.length-1]:t===0?r[0]:e%1!==0?r[Math.ceil(e)-1]:r.length%2===0?(r[e-1]+r[e])/2:r[e]}function sIt(r){var t=r.tickCount,e=r.values;if(!e||!e.length)return[];for(var i=e.slice().sort(function(s,l){return s-l}),n=[],a=0;a<t;a++){var o=a/(t-1);n.push(oIt(i,o))}return n}function lIt(r){var t=r.min,e=r.max,i=r.tickCount,n=r.tickInterval,a=r.minLimit,o=r.maxLimit,s=R8(t,e,i).ticks;return!j(a)||!j(o)?eT(r,un(s),fr(s)):n?tT(t,e,n).ticks:s}function uIt(r){var t=r.min,e=r.max,i=r.minTickInterval,n=r.tickInterval,a=r.tickCount;if(n)a=Math.ceil((e-t)/n);else{n=B3t(t,e,a)[1];var o=(e-t)/n,s=o/a;s>1&&(n=n*Math.ceil(s)),i&&n<i&&(n=i)}n=Math.max(Math.floor((e-t)/(Math.pow(2,12)-1)),n);for(var l=[],u=t;u<e+n;u+=n)l.push(u);return l}function cIt(r){var t=w8(S({showLast:!0},r));return t}function A0(r){return new Date(r).getFullYear()}function hIt(r){return new Date(r,0,1).getTime()}function SC(r){return new Date(r).getMonth()}function fIt(r,t){var e=A0(r),i=A0(t),n=SC(r),a=SC(t);return(i-e)*12+(a-n)%12}function dIt(r,t){return new Date(r,t,1).getTime()}function vIt(r,t){return Math.ceil((t-r)/wo)}function pIt(r,t){return Math.ceil((t-r)/kl)}function gIt(r,t){return Math.ceil((t-r)/(60*1e3))}function mIt(r){var t=r.min,e=r.max,i=r.minTickInterval,n=r.tickCount,a=r.tickInterval,o=[];a||(a=(e-t)/n,i&&a<i&&(a=i)),a=Math.max(Math.floor((e-t)/(Math.pow(2,12)-1)),a);var s=A0(t);if(a>PL)for(var l=A0(e),u=Math.ceil(a/PL),c=s;c<=l+u;c=c+u)o.push(hIt(c));else if(a>If)for(var h=Math.ceil(a/If),f=SC(t),d=fIt(t,e),c=0;c<=d+h;c=c+h)o.push(dIt(s,c+f));else if(a>wo)for(var v=new Date(t),p=v.getFullYear(),g=v.getMonth(),m=v.getDate(),y=Math.ceil(a/wo),_=vIt(t,e),c=0;c<_+y;c=c+y)o.push(new Date(p,g,m+c).getTime());else if(a>kl)for(var v=new Date(t),p=v.getFullYear(),g=v.getMonth(),y=v.getDate(),x=v.getHours(),C=Math.ceil(a/kl),A=pIt(t,e),c=0;c<=A+C;c=c+C)o.push(new Date(p,g,y,x+c).getTime());else if(a>Nl)for(var T=gIt(t,e),w=Math.ceil(a/Nl),c=0;c<=T+w;c=c+w)o.push(t+c*Nl);else{var M=a;M<oa&&(M=oa);for(var O=Math.floor(t/oa)*oa,P=Math.ceil((e-t)/oa),D=Math.ceil(M/oa),c=0;c<P+D;c=c+D)o.push(O+c*oa)}return o.length>=512&&console.warn("Notice: current ticks length("+o.length+') >= 512, may cause performance issues, even out of memory. Because of the configure "tickInterval"(in milliseconds, current is '+a+") is too small, increase the value to solve the problem!"),o}co("cat",w8);co("time-cat",cIt);co("wilkinson-extended",iIt);co("r-pretty",lIt);co("time",uIt);co("time-pretty",mIt);co("log",nIt);co("pow",aIt);co("quantile",sIt);co("d3-linear",G3t);ho("cat",ry);ho("category",ry);ho("identity",H3t);ho("linear",ny);ho("log",N3t);ho("pow",k3t);ho("time",U3t);ho("timeCat",D3t);ho("quantize",T8);ho("quantile",z3t);var M8={},I8=function(r){return M8[r.toLowerCase()]},hv=function(r,t){if(I8(r))throw new Error("Attribute type '".concat(r,"' existed."));M8[r.toLowerCase()]=t};hv("Color",R3t);hv("Opacity",M3t);hv("Position",I3t);hv("Shape",L3t);hv("Size",O3t);var rT=function(){function r(t){this.type="coordinate",this.isRect=!1,this.isHelix=!1,this.isPolar=!1,this.isReflectX=!1,this.isReflectY=!1;var e=t.start,i=t.end,n=t.matrix,a=n===void 0?[1,0,0,0,1,0,0,0,1]:n,o=t.isTransposed,s=o===void 0?!1:o;this.start=e,this.end=i,this.matrix=a,this.originalMatrix=_t([],a),this.isTransposed=s}return r.prototype.initial=function(){this.center={x:(this.start.x+this.end.x)/2,y:(this.start.y+this.end.y)/2},this.width=Math.abs(this.end.x-this.start.x),this.height=Math.abs(this.end.y-this.start.y)},r.prototype.update=function(t){ye(this,t),this.initial()},r.prototype.convertDim=function(t,e){var i,n=this[e],a=n.start,o=n.end;return this.isReflect(e)&&(i=[o,a],a=i[0],o=i[1]),a+t*(o-a)},r.prototype.invertDim=function(t,e){var i,n=this[e],a=n.start,o=n.end;return this.isReflect(e)&&(i=[o,a],a=i[0],o=i[1]),(t-a)/(o-a)},r.prototype.applyMatrix=function(t,e,i){i===void 0&&(i=0);var n=this.matrix,a=[t,e,i];return Nf(a,a,n),a},r.prototype.invertMatrix=function(t,e,i){i===void 0&&(i=0);var n=this.matrix,a=aH([0,0,0,0,0,0,0,0,0],n),o=[t,e,i];return a&&Nf(o,o,a),o},r.prototype.convert=function(t){var e=this.convertPoint(t),i=e.x,n=e.y,a=this.applyMatrix(i,n,1);return{x:a[0],y:a[1]}},r.prototype.invert=function(t){var e=this.invertMatrix(t.x,t.y,1);return this.invertPoint({x:e[0],y:e[1]})},r.prototype.rotate=function(t){var e=this.matrix,i=this.center;return ku(e,e,[-i.x,-i.y]),UE(e,e,t),ku(e,e,[i.x,i.y]),this},r.prototype.reflect=function(t){return t==="x"?this.isReflectX=!this.isReflectX:this.isReflectY=!this.isReflectY,this},r.prototype.scale=function(t,e){var i=this.matrix,n=this.center;return ku(i,i,[-n.x,-n.y]),JB(i,i,[t,e]),ku(i,i,[n.x,n.y]),this},r.prototype.translate=function(t,e){var i=this.matrix;return ku(i,i,[t,e]),this},r.prototype.transpose=function(){return this.isTransposed=!this.isTransposed,this},r.prototype.getCenter=function(){return this.center},r.prototype.getWidth=function(){return this.width},r.prototype.getHeight=function(){return this.height},r.prototype.getRadius=function(){return this.radius},r.prototype.isReflect=function(t){return t==="x"?this.isReflectX:this.isReflectY},r.prototype.resetMatrix=function(t){this.matrix=t||_t([],this.originalMatrix)},r}(),L8=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.isRect=!0,i.type="cartesian",i.initial(),i}return t.prototype.initial=function(){r.prototype.initial.call(this);var e=this.start,i=this.end;this.x={start:e.x,end:i.x},this.y={start:e.y,end:i.y}},t.prototype.convertPoint=function(e){var i,n=e.x,a=e.y;return this.isTransposed&&(i=[a,n],n=i[0],a=i[1]),{x:this.convertDim(n,"x"),y:this.convertDim(a,"y")}},t.prototype.invertPoint=function(e){var i,n=this.invertDim(e.x,"x"),a=this.invertDim(e.y,"y");return this.isTransposed&&(i=[a,n],n=i[0],a=i[1]),{x:n,y:a}},t}(rT),yIt=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;i.isHelix=!0,i.type="helix";var n=e.startAngle,a=n===void 0?1.25*Math.PI:n,o=e.endAngle,s=o===void 0?7.25*Math.PI:o,l=e.innerRadius,u=l===void 0?0:l,c=e.radius;return i.startAngle=a,i.endAngle=s,i.innerRadius=u,i.radius=c,i.initial(),i}return t.prototype.initial=function(){r.prototype.initial.call(this);var e=(this.endAngle-this.startAngle)/(2*Math.PI)+1,i=Math.min(this.width,this.height)/2;this.radius&&this.radius>=0&&this.radius<=1&&(i=i*this.radius),this.d=Math.floor(i*(1-this.innerRadius)/e),this.a=this.d/(Math.PI*2),this.x={start:this.startAngle,end:this.endAngle},this.y={start:this.innerRadius*i,end:this.innerRadius*i+this.d*.99}},t.prototype.convertPoint=function(e){var i,n=e.x,a=e.y;this.isTransposed&&(i=[a,n],n=i[0],a=i[1]);var o=this.convertDim(n,"x"),s=this.a*o,l=this.convertDim(a,"y");return{x:this.center.x+Math.cos(o)*(s+l),y:this.center.y+Math.sin(o)*(s+l)}},t.prototype.invertPoint=function(e){var i,n=this.d+this.y.start,a=s1([0,0],[e.x,e.y],[this.center.x,this.center.y]),o=zE(a,[1,0],!0),s=o*this.a;$u(a)<s&&(s=$u(a));var l=Math.floor(($u(a)-s)/n);o=2*l*Math.PI+o;var u=this.a*o,c=$u(a)-u;c=Br(c,0)?0:c;var h=this.invertDim(o,"x"),f=this.invertDim(c,"y");return h=Br(h,0)?0:h,f=Br(f,0)?0:f,this.isTransposed&&(i=[f,h],h=i[0],f=i[1]),{x:h,y:f}},t}(rT),_It=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;i.isPolar=!0,i.type="polar";var n=e.startAngle,a=n===void 0?-Math.PI/2:n,o=e.endAngle,s=o===void 0?Math.PI*3/2:o,l=e.innerRadius,u=l===void 0?0:l,c=e.radius;return i.startAngle=a,i.endAngle=s,i.innerRadius=u,i.radius=c,i.initial(),i}return t.prototype.initial=function(){for(r.prototype.initial.call(this);this.endAngle<this.startAngle;)this.endAngle+=Math.PI*2;var e=this.getOneBox(),i=e.maxX-e.minX,n=e.maxY-e.minY,a=Math.abs(e.minX)/i,o=Math.abs(e.minY)/n,s;this.height/n>this.width/i?(s=this.width/i,this.circleCenter={x:this.center.x-(.5-a)*this.width,y:this.center.y-(.5-o)*s*n}):(s=this.height/n,this.circleCenter={x:this.center.x-(.5-a)*s*i,y:this.center.y-(.5-o)*this.height}),this.polarRadius=this.radius,this.radius?this.radius>0&&this.radius<=1?this.polarRadius=s*this.radius:(this.radius<=0||this.radius>s)&&(this.polarRadius=s):this.polarRadius=s,this.x={start:this.startAngle,end:this.endAngle},this.y={start:this.innerRadius*this.polarRadius,end:this.polarRadius}},t.prototype.getRadius=function(){return this.polarRadius},t.prototype.convertPoint=function(e){var i,n=this.getCenter(),a=e.x,o=e.y;return this.isTransposed&&(i=[o,a],a=i[0],o=i[1]),a=this.convertDim(a,"x"),o=this.convertDim(o,"y"),{x:n.x+Math.cos(a)*o,y:n.y+Math.sin(a)*o}},t.prototype.invertPoint=function(e){var i,n=this.getCenter(),a=[e.x-n.x,e.y-n.y],o=this,s=o.startAngle,l=o.endAngle;this.isReflect("x")&&(i=[l,s],s=i[0],l=i[1]);var u=[1,0,0,0,1,0,0,0,1];UE(u,u,s);var c=[1,0,0];Nf(c,c,u);var h=[c[0],c[1]],f=zE(h,a,l<s);Br(f,Math.PI*2)&&(f=0);var d=$u(a),v=f/(l-s);v=l-s>0?v:-v;var p=this.invertDim(d,"y"),g={x:0,y:0};return g.x=this.isTransposed?p:v,g.y=this.isTransposed?v:p,g},t.prototype.getCenter=function(){return this.circleCenter},t.prototype.getOneBox=function(){var e=this.startAngle,i=this.endAngle;if(Math.abs(i-e)>=Math.PI*2)return{minX:-1,maxX:1,minY:-1,maxY:1};for(var n=[0,Math.cos(e),Math.cos(i)],a=[0,Math.sin(e),Math.sin(i)],o=Math.min(e,i);o<Math.max(e,i);o+=Math.PI/18)n.push(Math.cos(o)),a.push(Math.sin(o));return{minX:Math.min.apply(Math,n),maxX:Math.max.apply(Math,n),minY:Math.min.apply(Math,a),maxY:Math.max.apply(Math,a)}},t}(rT),O8={},xIt=function(r){return O8[r.toLowerCase()]},ay=function(r,t){O8[r.toLowerCase()]=t};ay("rect",L8);ay("cartesian",L8);ay("polar",_It);ay("helix",yIt);function P8(r,t,e){var i=new Gd(t,e);i.target=r,i.propagationPath.push(r),r.emitDelegation(t,i);for(var n=r.getParent();n;)n.emitDelegation(t,i),i.propagationPath.push(n),n=n.getParent()}var F8=[1,0,0,0,1,0,0,0,1];function iu(r,t,e){if(e===void 0&&(e=F8),!t)return null;var i=hr(e,[["t",-r.x,-r.y],["r",t],["t",r.x,r.y]]);return i}function iT(r,t){return!r.x&&!r.y?null:hr(t||F8,[["t",r.x,r.y]])}function CIt(r){var t=[1,0,0],e=[0,0,0];return Nf(e,t,r),Math.atan2(e[1],e[0])}function Ep(r,t){var e=[0,0];return oH(e,t,r),e}function EIt(r,t){var e=Ep(r,[t.minX,t.minY]),i=Ep(r,[t.maxX,t.minY]),n=Ep(r,[t.minX,t.maxY]),a=Ep(r,[t.maxX,t.maxY]),o=Math.min(e[0],i[0],n[0],a[0]),s=Math.max(e[0],i[0],n[0],a[0]),l=Math.min(e[1],i[1],n[1],a[1]),u=Math.max(e[1],i[1],n[1],a[1]);return{x:o,y:l,minX:o,minY:l,maxX:s,maxY:u,width:s-o,height:u-l}}function B8(r,t,e,i){if(t){var n=iu({x:e,y:i},t,r.getMatrix());r.setMatrix(n)}}function nT(r,t,e){var i=iT({x:t,y:e});r.attr("matrix",i)}function T0(r){var t=0,e=0,i=0,n=0;return Mt(r)?t=e=i=n=r:Z(r)&&(t=r[0],i=j(r[1])?r[0]:r[1],n=j(r[2])?r[0]:r[2],e=j(r[3])?i:r[3]),[t,i,n,e]}function aT(r){for(var t=r.childNodes,e=t.length,i=e-1;i>=0;i--)r.removeChild(t[i])}function SIt(r,t){return!!r.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function _d(r){var t=r.start,e=r.end,i=Math.min(t.x,e.x),n=Math.min(t.y,e.y),a=Math.max(t.x,e.x),o=Math.max(t.y,e.y);return{x:i,y:n,minX:i,minY:n,maxX:a,maxY:o,width:a-i,height:o-n}}function AIt(r){var t=r.map(function(s){return s.x}),e=r.map(function(s){return s.y}),i=Math.min.apply(Math,t),n=Math.min.apply(Math,e),a=Math.max.apply(Math,t),o=Math.max.apply(Math,e);return{x:i,y:n,minX:i,minY:n,maxX:a,maxY:o,width:a-i,height:o-n}}function oy(r,t,e,i){var n=r+e,a=t+i;return{x:r,y:t,width:e,height:i,minX:r,minY:t,maxX:isNaN(n)?0:n,maxY:isNaN(a)?0:a}}function Ul(r,t,e){return(1-e)*r+t*e}function pc(r,t,e){return{x:r.x+Math.cos(e)*t,y:r.y+Math.sin(e)*t}}function TIt(r,t){var e=t.x-r.x,i=t.y-r.y;return Math.sqrt(e*e+i*i)}var b0=function(r,t,e){return e===void 0&&(e=Math.pow(Number.EPSILON,.5)),[r,t].includes(1/0)?Math.abs(r)===Math.abs(t):Math.abs(r-t)<e};function bIt(r,t){var e=Math.max(r.minX,t.minX),i=Math.max(r.minY,t.minY),n=Math.min(r.maxX,t.maxX),a=Math.min(r.maxY,t.maxY);return oy(e,i,n-e,a-i)}function D8(r){var t=r.getClip(),e=t&&t.getBBox(),i;if(!r.isGroup())i=r.getBBox();else{var n=1/0,a=-1/0,o=1/0,s=-1/0,l=r.getChildren();l.length>0?R(l,function(u){if(u.get("visible")){if(u.isGroup()&&u.get("children").length===0)return!0;var c=D8(u),h=u.applyToMatrix([c.minX,c.minY,1]),f=u.applyToMatrix([c.minX,c.maxY,1]),d=u.applyToMatrix([c.maxX,c.minY,1]),v=u.applyToMatrix([c.maxX,c.maxY,1]),p=Math.min(h[0],f[0],d[0],v[0]),g=Math.max(h[0],f[0],d[0],v[0]),m=Math.min(h[1],f[1],d[1],v[1]),y=Math.max(h[1],f[1],d[1],v[1]);p<n&&(n=p),g>a&&(a=g),m<o&&(o=m),y>s&&(s=y)}}):(n=0,a=0,o=0,s=0),i=oy(n,o,a-n,s-o)}return e?bIt(i,e):i}function wIt(r,t){if(!(!r.getClip()&&!t.getClip())){var e=t.getClip();if(!e){r.setClip(null);return}var i={type:e.get("type"),attrs:e.attr()};r.setClip(i)}}function Bi(r){return r+"px"}function N8(r,t,e,i){var n=TIt(r,t),a=i/n,o=0;return e==="start"?o=0-a:e==="end"&&(o=1+a),{x:Ul(r.x,t.x,o),y:Ul(r.y,t.y,o)}}var RIt={none:[],point:["x","y"],region:["start","end"],points:["points"],circle:["center","radius","startAngle","endAngle"]},k8=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.initCfg(),i}return t.prototype.getDefaultCfg=function(){return{id:"",name:"",type:"",locationType:"none",offsetX:0,offsetY:0,animate:!1,capture:!0,updateAutoRender:!1,animateOption:{appear:null,update:{duration:400,easing:"easeQuadInOut"},enter:{duration:400,easing:"easeQuadInOut"},leave:{duration:350,easing:"easeQuadIn"}},events:null,defaultCfg:{},visible:!0}},t.prototype.clear=function(){},t.prototype.update=function(e){var i=this,n=this.get("defaultCfg")||{};R(e,function(a,o){var s=i.get(o),l=a;s!==a&&(re(a)&&n[o]&&(l=nt({},n[o],a)),i.set(o,l))}),this.updateInner(e),this.afterUpdate(e)},t.prototype.updateInner=function(e){},t.prototype.afterUpdate=function(e){ws(e,"visible")&&(e.visible?this.show():this.hide()),ws(e,"capture")&&this.setCapture(e.capture)},t.prototype.getLayoutBBox=function(){return this.getBBox()},t.prototype.getLocationType=function(){return this.get("locationType")},t.prototype.getOffset=function(){return{offsetX:this.get("offsetX"),offsetY:this.get("offsetY")}},t.prototype.setOffset=function(e,i){this.update({offsetX:e,offsetY:i})},t.prototype.setLocation=function(e){var i=S({},e);this.update(i)},t.prototype.getLocation=function(){var e=this,i={},n=this.get("locationType"),a=RIt[n];return R(a,function(o){i[o]=e.get(o)}),i},t.prototype.isList=function(){return!1},t.prototype.isSlider=function(){return!1},t.prototype.init=function(){},t.prototype.initCfg=function(){var e=this,i=this.get("defaultCfg");R(i,function(n,a){var o=e.get(a);if(re(o)){var s=nt({},n,o);e.set(a,s)}})},t}(J0),sl="update_status",MIt=["visible","tip","delegateObject"],IIt=["container","group","shapesMap","isRegister","isUpdating","destroyed"],Jr=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{container:null,shapesMap:{},group:null,capture:!0,isRegister:!1,isUpdating:!1,isInit:!0})},t.prototype.remove=function(){this.clear();var e=this.get("group");e.remove()},t.prototype.clear=function(){var e=this.get("group");e.clear(),this.set("shapesMap",{}),this.clearOffScreenCache(),this.set("isInit",!0)},t.prototype.getChildComponentById=function(e){var i=this.getElementById(e),n=i&&i.get("component");return n},t.prototype.getElementById=function(e){return this.get("shapesMap")[e]},t.prototype.getElementByLocalId=function(e){var i=this.getElementId(e);return this.getElementById(i)},t.prototype.getElementsByName=function(e){var i=[];return R(this.get("shapesMap"),function(n){n.get("name")===e&&i.push(n)}),i},t.prototype.getContainer=function(){return this.get("container")},t.prototype.updateInner=function(e){this.offScreenRender(),this.get("updateAutoRender")&&this.render()},t.prototype.render=function(){var e=this.get("offScreenGroup");e||(e=this.offScreenRender());var i=this.get("group");this.updateElements(e,i),this.deleteElements(),this.applyOffset(),this.get("eventInitted")||(this.initEvent(),this.set("eventInitted",!0)),this.set("isInit",!1)},t.prototype.show=function(){var e=this.get("group");e.show(),this.set("visible",!0)},t.prototype.hide=function(){var e=this.get("group");e.hide(),this.set("visible",!1)},t.prototype.setCapture=function(e){var i=this.get("group");i.set("capture",e),this.set("capture",e)},t.prototype.destroy=function(){this.removeEvent(),this.remove(),r.prototype.destroy.call(this)},t.prototype.getBBox=function(){return this.get("group").getCanvasBBox()},t.prototype.getLayoutBBox=function(){var e=this.get("group"),i=this.getInnerLayoutBBox(),n=e.getTotalMatrix();return n&&(i=EIt(n,i)),i},t.prototype.on=function(e,i,n){var a=this.get("group");return a.on(e,i,n),this},t.prototype.off=function(e,i){var n=this.get("group");return n&&n.off(e,i),this},t.prototype.emit=function(e,i){var n=this.get("group");n.emit(e,i)},t.prototype.init=function(){r.prototype.init.call(this),this.get("group")||this.initGroup(),this.offScreenRender()},t.prototype.getInnerLayoutBBox=function(){return this.get("offScreenBBox")||this.get("group").getBBox()},t.prototype.delegateEmit=function(e,i){var n=this.get("group");i.target=n,n.emit(e,i),P8(n,e,i)},t.prototype.createOffScreenGroup=function(){var e=this.get("group"),i=e.getGroupBase(),n=new i({delegateObject:this.getDelegateObject()});return n},t.prototype.applyOffset=function(){var e=this.get("offsetX"),i=this.get("offsetY");this.moveElementTo(this.get("group"),{x:e,y:i})},t.prototype.initGroup=function(){var e=this.get("container");this.set("group",e.addGroup({id:this.get("id"),name:this.get("name"),capture:this.get("capture"),visible:this.get("visible"),isComponent:!0,component:this,delegateObject:this.getDelegateObject()}))},t.prototype.offScreenRender=function(){this.clearOffScreenCache();var e=this.createOffScreenGroup();return this.renderInner(e),this.set("offScreenGroup",e),this.set("offScreenBBox",D8(e)),e},t.prototype.addGroup=function(e,i){this.appendDelegateObject(e,i);var n=e.addGroup(i);return this.get("isRegister")&&this.registerElement(n),n},t.prototype.addShape=function(e,i){this.appendDelegateObject(e,i);var n=e.addShape(i);return this.get("isRegister")&&this.registerElement(n),n},t.prototype.addComponent=function(e,i){var n=i.id,a=i.component,o=Ut(i,["id","component"]),s=new a(S(S({},o),{id:n,container:e,updateAutoRender:this.get("updateAutoRender")}));return s.init(),s.render(),this.get("isRegister")&&this.registerElement(s.get("group")),s},t.prototype.initEvent=function(){},t.prototype.removeEvent=function(){var e=this.get("group");e.off()},t.prototype.getElementId=function(e){var i=this.get("id"),n=this.get("name");return i+"-"+n+"-"+e},t.prototype.registerElement=function(e){var i=e.get("id");this.get("shapesMap")[i]=e},t.prototype.unregisterElement=function(e){var i=e.get("id");delete this.get("shapesMap")[i]},t.prototype.moveElementTo=function(e,i){var n=iT(i);e.attr("matrix",n)},t.prototype.addAnimation=function(e,i,n){var a=i.attr("opacity");j(a)&&(a=1),i.attr("opacity",0),i.animate({opacity:a},n)},t.prototype.removeAnimation=function(e,i,n){i.animate({opacity:0},n)},t.prototype.updateAnimation=function(e,i,n,a){i.animate(n,a)},t.prototype.updateElements=function(e,i){var n=this,a=this.get("animate"),o=this.get("animateOption"),s=e.getChildren().slice(0),l;R(s,function(u){var c=u.get("id"),h=n.getElementById(c),f=u.get("name");if(h)if(u.get("isComponent")){var d=u.get("component"),v=h.get("component"),p=Ga(d.cfg,eit(Kc(d.cfg),IIt));v.update(p),h.set(sl,"update")}else{var g=n.getReplaceAttrs(h,u);a&&o.update?n.updateAnimation(f,h,g,o.update):h.attr(g),u.isGroup()&&n.updateElements(u,h),R(MIt,function(x){h.set(x,u.get(x))}),wIt(h,u),l=h,h.set(sl,"update")}else{i.add(u);var m=i.getChildren();if(m.splice(m.length-1,1),l){var y=m.indexOf(l);m.splice(y+1,0,u)}else m.unshift(u);if(n.registerElement(u),u.set(sl,"add"),u.get("isComponent")){var d=u.get("component");d.set("container",i)}else u.isGroup()&&n.registerNewGroup(u);if(l=u,a){var _=n.get("isInit")?o.appear:o.enter;_&&n.addAnimation(f,u,_)}}})},t.prototype.clearUpdateStatus=function(e){var i=e.getChildren();R(i,function(n){n.set(sl,null)})},t.prototype.clearOffScreenCache=function(){var e=this.get("offScreenGroup");e&&e.destroy(),this.set("offScreenGroup",null),this.set("offScreenBBox",null)},t.prototype.getDelegateObject=function(){var e,i=this.get("name"),n=(e={},e[i]=this,e.component=this,e);return n},t.prototype.appendDelegateObject=function(e,i){var n=e.get("delegateObject");i.delegateObject||(i.delegateObject={}),ye(i.delegateObject,n)},t.prototype.getReplaceAttrs=function(e,i){var n=e.attr(),a=i.attr();return R(n,function(o,s){a[s]===void 0&&(a[s]=void 0)}),a},t.prototype.registerNewGroup=function(e){var i=this,n=e.getChildren();R(n,function(a){i.registerElement(a),a.set(sl,"add"),a.isGroup()&&i.registerNewGroup(a)})},t.prototype.deleteElements=function(){var e=this,i=this.get("shapesMap"),n=[];R(i,function(s,l){!s.get(sl)||s.destroyed?n.push([l,s]):s.set(sl,null)});var a=this.get("animate"),o=this.get("animateOption");R(n,function(s){var l=s[0],u=s[1];if(!u.destroyed){var c=u.get("name");if(a&&o.leave){var h=ye({callback:function(){e.removeElement(u)}},o.leave);e.removeAnimation(c,u,h)}else e.removeElement(u)}delete i[l]})},t.prototype.removeElement=function(e){if(e.get("isGroup")){var i=e.get("component");i&&i.destroy()}e.remove()},t}(k8),D_="…";function LIt(r){for(var t=0,e=0;e<r.length;e++)t+=dl(r,e);return t}function dl(r,t){return r.charCodeAt(t)>0&&r.charCodeAt(t)<128?1:2}function OIt(r,t,e){e===void 0&&(e="tail");var i=r.length,n="";if(e==="tail"){for(var a=0,o=0;a<t;){var s=dl(r,o);if(a+s<=t)n+=r[o],a+=dl(r,o),o++;else break}n+=D_}else if(e==="head"){for(var a=0,o=i-1;a<t;){var s=dl(r,o);if(a+s<=t)n+=r[o],a+=dl(r,o),o--;else break}n=D_+n}else{for(var l="",u="",a=0,c=0,h=i-1;a<t;){var f=dl(r,c),d=!1;f+a<=t&&(l+=r[c],c++,a+=f,d=!0);var v=dl(r,h);if(v+a<=t&&(u=r[h]+u,a+=v,h--,d=!0),!d)break}n=l+D_+u}return n}var PIt="…",FIt=2,BIt=400;function DIt(r){for(var t=r.map(function(l){var u=l.attr("text");return j(u)?"":""+u}),e=0,i=0,n=0;n<t.length;n+=1){for(var a=0,o=0;o<=t[n].length;o+=1){var s=t[n].charCodeAt(o);s>=19968&&s<=40869?a+=2:a+=1}a>e&&(e=a,i=n)}return r[i].getBBox().width}function AC(r){if(r.length>BIt)return DIt(r);var t=0;return R(r,function(e){var i=e.getBBox(),n=i.width;t<n&&(t=n)}),t}function NIt(r,t){var e=t.getCanvasBBox();return r?e.width:e.height}function Lf(r,t,e,i){var n;i===void 0&&(i="tail");var a=(n=t.attr("text"))!==null&&n!==void 0?n:"";if(i==="tail"){var o=Ga(t.attr(),["fontSize","fontFamily","fontWeight","fontStyle","fontVariant"]),s=bit(a,e,o,"…");return a!==s?(t.attr("text",s),t.set("tip",a),!0):(t.set("tip",null),!1)}var l=NIt(r,t),u=LIt(a),c=!1;if(e<l){var h=Math.floor(e/l*u)-FIt,f=void 0;h>=0?f=OIt(a,h,i):f=PIt,f&&(t.attr("text",f),c=!0)}return c?t.set("tip",a):t.set("tip",null),c}function sy(r,t){var e=t.x,i=t.y,n=t.content,a=t.style,o=t.id,s=t.name,l=t.rotate,u=t.maxLength,c=t.autoEllipsis,h=t.isVertical,f=t.ellipsisPosition,d=t.background,v=r.addGroup({id:o+"-group",name:s+"-group",attrs:{x:e,y:i}}),p=v.addShape({type:"text",id:o,name:s,attrs:S({x:0,y:0,text:n},a)}),g=T0(L(d,"padding",0));if(u&&c){var m=u-(g[1]+g[3]);Lf(!h,p,m,f)}if(d){var y=L(d,"style",{}),_=p.getCanvasBBox(),x=_.minX,C=_.minY,A=_.width,T=_.height,w=v.addShape("rect",{id:o+"-bg",name:o+"-bg",attrs:S({x:x-g[3],y:C-g[0],width:A+g[1]+g[3],height:T+g[0]+g[2]},y)});w.toBack()}nT(v,e,i),B8(v,l,e,i)}const Gt={fontFamily:`
  BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",
  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
  SimSun, "sans-serif"`,textColor:"#2C3542",activeTextColor:"#333333",uncheckedColor:"#D8D8D8",lineColor:"#416180",regionColor:"#CCD7EB",verticalAxisRotate:-Math.PI/4,horizontalAxisRotate:Math.PI/4,descriptionIconStroke:"#fff",descriptionIconFill:"rgba(58, 73, 101, .25)"};var kIt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"line",locationType:"region",start:null,end:null,style:{},text:null,defaultCfg:{style:{fill:Gt.textColor,fontSize:12,textAlign:"center",textBaseline:"bottom",fontFamily:Gt.fontFamily},text:{position:"center",autoRotate:!0,content:null,offsetX:0,offsetY:0,style:{stroke:Gt.lineColor,lineWidth:1}}}})},t.prototype.renderInner=function(e){this.renderLine(e),this.get("text")&&this.renderLabel(e)},t.prototype.renderLine=function(e){var i=this.get("start"),n=this.get("end"),a=this.get("style");this.addShape(e,{type:"line",id:this.getElementId("line"),name:"annotation-line",attrs:S({x1:i.x,y1:i.y,x2:n.x,y2:n.y},a)})},t.prototype.getLabelPoint=function(e,i,n){var a;return n==="start"?a=0:n==="center"?a=.5:mt(n)&&n.indexOf("%")!==-1?a=parseInt(n,10)/100:Mt(n)?a=n:a=1,(a>1||a<0)&&(a=1),{x:Ul(e.x,i.x,a),y:Ul(e.y,i.y,a)}},t.prototype.renderLabel=function(e){var i=this.get("text"),n=this.get("start"),a=this.get("end"),o=i.position,s=i.content,l=i.style,u=i.offsetX,c=i.offsetY,h=i.autoRotate,f=i.maxLength,d=i.autoEllipsis,v=i.ellipsisPosition,p=i.background,g=i.isVertical,m=g===void 0?!1:g,y=this.getLabelPoint(n,a,o),_=y.x+u,x=y.y+c,C={id:this.getElementId("line-text"),name:"annotation-line-text",x:_,y:x,content:s,style:l,maxLength:f,autoEllipsis:d,ellipsisPosition:v,background:p,isVertical:m};if(h){var A=[a.x-n.x,a.y-n.y];C.rotate=Math.atan2(A[1],A[0])}sy(e,C)},t}(Jr),UIt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"text",locationType:"point",x:0,y:0,content:"",rotate:null,style:{},background:null,maxLength:null,autoEllipsis:!0,isVertical:!1,ellipsisPosition:"tail",defaultCfg:{style:{fill:Gt.textColor,fontSize:12,textAlign:"center",textBaseline:"middle",fontFamily:Gt.fontFamily}}})},t.prototype.setLocation=function(e){this.set("x",e.x),this.set("y",e.y),this.resetLocation()},t.prototype.renderInner=function(e){var i=this.getLocation(),n=i.x,a=i.y,o=this.get("content"),s=this.get("style"),l=this.getElementId("text"),u=this.get("name")+"-text",c=this.get("maxLength"),h=this.get("autoEllipsis"),f=this.get("isVertical"),d=this.get("ellipsisPosition"),v=this.get("background"),p=this.get("rotate"),g={id:l,name:u,x:n,y:a,content:o,style:s,maxLength:c,autoEllipsis:h,isVertical:f,ellipsisPosition:d,background:v,rotate:p};sy(e,g)},t.prototype.resetLocation=function(){var e=this.getElementByLocalId("text-group");if(e){var i=this.getLocation(),n=i.x,a=i.y,o=this.get("rotate");nT(e,n,a),B8(e,o,n,a)}},t}(Jr),zIt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"arc",locationType:"circle",center:null,radius:100,startAngle:-Math.PI/2,endAngle:Math.PI*3/2,style:{stroke:"#999",lineWidth:1}})},t.prototype.renderInner=function(e){this.renderArc(e)},t.prototype.getArcPath=function(){var e=this.getLocation(),i=e.center,n=e.radius,a=e.startAngle,o=e.endAngle,s=pc(i,n,a),l=pc(i,n,o),u=o-a>Math.PI?1:0,c=[["M",s.x,s.y]];if(o-a===Math.PI*2){var h=pc(i,n,a+Math.PI);c.push(["A",n,n,0,u,1,h.x,h.y]),c.push(["A",n,n,0,u,1,l.x,l.y])}else c.push(["A",n,n,0,u,1,l.x,l.y]);return c},t.prototype.renderArc=function(e){var i=this.getArcPath(),n=this.get("style");this.addShape(e,{type:"path",id:this.getElementId("arc"),name:"annotation-arc",attrs:S({path:i},n)})},t}(Jr),HIt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"region",locationType:"region",start:null,end:null,style:{},defaultCfg:{style:{lineWidth:0,fill:Gt.regionColor,opacity:.4}}})},t.prototype.renderInner=function(e){this.renderRegion(e)},t.prototype.renderRegion=function(e){var i=this.get("start"),n=this.get("end"),a=this.get("style"),o=_d({start:i,end:n});this.addShape(e,{type:"rect",id:this.getElementId("region"),name:"annotation-region",attrs:S({x:o.x,y:o.y,width:o.width,height:o.height},a)})},t}(Jr),$It=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"image",locationType:"region",start:null,end:null,src:null,style:{}})},t.prototype.renderInner=function(e){this.renderImage(e)},t.prototype.getImageAttrs=function(){var e=this.get("start"),i=this.get("end"),n=this.get("style"),a=_d({start:e,end:i}),o=this.get("src");return S({x:a.x,y:a.y,img:o,width:a.width,height:a.height},n)},t.prototype.renderImage=function(e){this.addShape(e,{type:"image",id:this.getElementId("image"),name:"annotation-image",attrs:this.getImageAttrs()})},t}(Jr),WIt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"dataMarker",locationType:"point",x:0,y:0,point:{},line:{},text:{},direction:"upward",autoAdjust:!0,coordinateBBox:null,defaultCfg:{point:{display:!0,style:{r:3,fill:"#FFFFFF",stroke:"#1890FF",lineWidth:2}},line:{display:!0,length:20,style:{stroke:Gt.lineColor,lineWidth:1}},text:{content:"",display:!0,style:{fill:Gt.textColor,opacity:.65,fontSize:12,textAlign:"start",fontFamily:Gt.fontFamily}}}})},t.prototype.renderInner=function(e){L(this.get("line"),"display")&&this.renderLine(e),L(this.get("text"),"display")&&this.renderText(e),L(this.get("point"),"display")&&this.renderPoint(e),this.get("autoAdjust")&&this.autoAdjust(e)},t.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x")+this.get("offsetX"),y:this.get("y")+this.get("offsetY")})},t.prototype.renderPoint=function(e){var i=this.getShapeAttrs().point;this.addShape(e,{type:"circle",id:this.getElementId("point"),name:"annotation-point",attrs:i})},t.prototype.renderLine=function(e){var i=this.getShapeAttrs().line;this.addShape(e,{type:"path",id:this.getElementId("line"),name:"annotation-line",attrs:i})},t.prototype.renderText=function(e){var i=this.getShapeAttrs().text,n=i.x,a=i.y,o=i.text,s=Ut(i,["x","y","text"]),l=this.get("text"),u=l.background,c=l.maxLength,h=l.autoEllipsis,f=l.isVertival,d=l.ellipsisPosition,v={x:n,y:a,id:this.getElementId("text"),name:"annotation-text",content:o,style:s,background:u,maxLength:c,autoEllipsis:h,isVertival:f,ellipsisPosition:d};sy(e,v)},t.prototype.autoAdjust=function(e){var i=this.get("direction"),n=this.get("x"),a=this.get("y"),o=L(this.get("line"),"length",0),s=this.get("coordinateBBox"),l=e.getBBox(),u=l.minX,c=l.maxX,h=l.minY,f=l.maxY,d=e.findById(this.getElementId("text-group")),v=e.findById(this.getElementId("text")),p=e.findById(this.getElementId("line"));if(s&&d){var g=d.attr("x"),m=d.attr("y"),y=v.getCanvasBBox(),_=y.width,x=y.height,C=0,A=0;if(n+u<=s.minX)if(i==="leftward")C=1;else{var T=s.minX-(n+u);g=d.attr("x")+T}else if(n+c>=s.maxX)if(i==="rightward")C=-1;else{var T=n+c-s.maxX;g=d.attr("x")-T}if(C&&(p&&p.attr("path",[["M",0,0],["L",o*C,0]]),g=(o+2+_)*C),a+h<=s.minY)if(i==="upward")A=1;else{var T=s.minY-(a+h);m=d.attr("y")+T}else if(a+f>=s.maxY)if(i==="downward")A=-1;else{var T=a+f-s.maxY;m=d.attr("y")-T}A&&(p&&p.attr("path",[["M",0,0],["L",0,o*A]]),m=(o+2+x)*A),(g!==d.attr("x")||m!==d.attr("y"))&&nT(d,g,m)}},t.prototype.getShapeAttrs=function(){var e=L(this.get("line"),"display"),i=L(this.get("point"),"style",{}),n=L(this.get("line"),"style",{}),a=L(this.get("text"),"style",{}),o=this.get("direction"),s=e?L(this.get("line"),"length",0):0,l=0,u=0,c="top",h="start";switch(o){case"upward":u=-1,c="bottom";break;case"downward":u=1,c="top";break;case"leftward":l=-1,h="end";break;case"rightward":l=1,h="start";break}return{point:S({x:0,y:0},i),line:S({path:[["M",0,0],["L",s*l,s*u]]},n),text:S({x:(s+2)*l,y:(s+2)*u,text:L(this.get("text"),"content",""),textBaseline:c,textAlign:h},a)}},t}(Jr),VIt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"dataRegion",locationType:"points",points:[],lineLength:0,region:{},text:{},defaultCfg:{region:{style:{lineWidth:0,fill:Gt.regionColor,opacity:.4}},text:{content:"",style:{textAlign:"center",textBaseline:"bottom",fontSize:12,fill:Gt.textColor,fontFamily:Gt.fontFamily}}}})},t.prototype.renderInner=function(e){var i=L(this.get("region"),"style",{});L(this.get("text"),"style",{});var n=this.get("lineLength")||0,a=this.get("points");if(a.length){var o=AIt(a),s=[];s.push(["M",a[0].x,o.minY-n]),a.forEach(function(u){s.push(["L",u.x,u.y])}),s.push(["L",a[a.length-1].x,a[a.length-1].y-n]),this.addShape(e,{type:"path",id:this.getElementId("region"),name:"annotation-region",attrs:S({path:s},i)});var l=S({id:this.getElementId("text"),name:"annotation-text",x:(o.minX+o.maxX)/2,y:o.minY-n},this.get("text"));sy(e,l)}},t}(Jr),GIt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"regionFilter",locationType:"region",start:null,end:null,color:null,shape:[]})},t.prototype.renderInner=function(e){var i=this,n=this.get("start"),a=this.get("end"),o=this.addGroup(e,{id:this.getElementId("region-filter"),capture:!1});R(this.get("shapes"),function(l,u){var c=l.get("type"),h=Dr(l.attr());i.adjustShapeAttrs(h),i.addShape(o,{id:i.getElementId("shape-"+c+"-"+u),capture:!1,type:c,attrs:h})});var s=_d({start:n,end:a});o.setClip({type:"rect",attrs:{x:s.minX,y:s.minY,width:s.width,height:s.height}})},t.prototype.adjustShapeAttrs=function(e){var i=this.get("color");e.fill&&(e.fill=e.fillStyle=i),e.stroke=e.strokeStyle=i},t}(Jr),XIt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"shape",draw:ms})},t.prototype.renderInner=function(e){var i=this.get("render");ut(i)&&i(e)},t}(Jr),oT=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{container:null,containerTpl:"<div></div>",updateAutoRender:!0,containerClassName:"",parent:null})},t.prototype.getContainer=function(){return this.get("container")},t.prototype.show=function(){var e=this.get("container");e.style.display="",this.set("visible",!0)},t.prototype.hide=function(){var e=this.get("container");e.style.display="none",this.set("visible",!1)},t.prototype.setCapture=function(e){var i=this.getContainer(),n=e?"auto":"none";i.style.pointerEvents=n,this.set("capture",e)},t.prototype.getBBox=function(){var e=this.getContainer(),i=parseFloat(e.style.left)||0,n=parseFloat(e.style.top)||0;return oy(i,n,e.clientWidth,e.clientHeight)},t.prototype.clear=function(){var e=this.get("container");aT(e)},t.prototype.destroy=function(){this.removeEvent(),this.removeDom(),r.prototype.destroy.call(this)},t.prototype.init=function(){r.prototype.init.call(this),this.initContainer(),this.initDom(),this.resetStyles(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible()},t.prototype.initCapture=function(){this.setCapture(this.get("capture"))},t.prototype.initVisible=function(){this.get("visible")?this.show():this.hide()},t.prototype.initDom=function(){},t.prototype.initContainer=function(){var e=this.get("container");if(j(e)){e=this.createDom();var i=this.get("parent");mt(i)&&(i=document.getElementById(i),this.set("parent",i)),i.appendChild(e),this.get("containerId")&&e.setAttribute("id",this.get("containerId")),this.set("container",e)}else mt(e)&&(e=document.getElementById(e),this.set("container",e));this.get("parent")||this.set("parent",e.parentNode)},t.prototype.resetStyles=function(){var e=this.get("domStyles"),i=this.get("defaultStyles");e?e=nt({},i,e):e=i,this.set("domStyles",e)},t.prototype.applyStyles=function(){var e=this.get("domStyles");if(e){var i=this.getContainer();this.applyChildrenStyles(i,e);var n=this.get("containerClassName");if(n&&SIt(i,n)){var a=e[n];Te(i,a)}}},t.prototype.applyChildrenStyles=function(e,i){R(i,function(n,a){var o=e.getElementsByClassName(a);R(o,function(s){Te(s,n)})})},t.prototype.applyStyle=function(e,i){var n=this.get("domStyles");Te(i,n[e])},t.prototype.createDom=function(){var e=this.get("containerTpl");return Lo(e)},t.prototype.initEvent=function(){},t.prototype.removeDom=function(){var e=this.get("container");e&&e.parentNode&&e.parentNode.removeChild(e)},t.prototype.removeEvent=function(){},t.prototype.updateInner=function(e){ws(e,"domStyles")&&(this.resetStyles(),this.applyStyles()),this.resetPosition()},t.prototype.resetPosition=function(){},t}(k8),YIt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"html",locationType:"point",x:0,y:0,containerTpl:'<div class="g2-html-annotation" style="position:absolute"></div>',alignX:"left",alignY:"top",html:"",zIndex:7})},t.prototype.render=function(){var e=this.getContainer(),i=this.get("html");aT(e);var n=ut(i)?i(e):i;if($B(n))e.appendChild(n);else if(mt(n)||Mt(n)){var a=Lo(""+n);a&&e.appendChild(a)}this.resetPosition()},t.prototype.resetPosition=function(){var e=this.getContainer(),i=this.getLocation(),n=i.x,a=i.y,o=this.get("alignX"),s=this.get("alignY"),l=this.get("offsetX"),u=this.get("offsetY"),c=Bat(e),h=Pat(e),f={x:n,y:a};o==="middle"?f.x-=Math.round(c/2):o==="right"&&(f.x-=Math.round(c)),s==="middle"?f.y-=Math.round(h/2):s==="bottom"&&(f.y-=Math.round(h)),l&&(f.x+=l),u&&(f.y+=u),Te(e,{position:"absolute",left:f.x+"px",top:f.y+"px",zIndex:this.get("zIndex")})},t}(oT);const jIt=Object.freeze(Object.defineProperty({__proto__:null,Arc:zIt,DataMarker:WIt,DataRegion:VIt,Html:YIt,Image:$It,Line:kIt,Region:HIt,RegionFilter:GIt,Shape:XIt,Text:UIt},Symbol.toStringTag,{value:"Module"}));function cf(r,t,e){var i=t+"Style",n=null;return R(e,function(a,o){r[o]&&a[i]&&(n||(n={}),ye(n,a[i]))}),n}var U8=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"axis",ticks:[],line:{},tickLine:{},subTickLine:null,title:null,label:{},verticalFactor:1,verticalLimitLength:null,overlapOrder:["autoRotate","autoEllipsis","autoHide"],tickStates:{},optimize:{},defaultCfg:{line:{style:{lineWidth:1,stroke:Gt.lineColor}},tickLine:{style:{lineWidth:1,stroke:Gt.lineColor},alignTick:!0,length:5,displayWithLabel:!0},subTickLine:{style:{lineWidth:1,stroke:Gt.lineColor},count:4,length:2},label:{autoRotate:!0,autoHide:!1,autoEllipsis:!1,style:{fontSize:12,fill:Gt.textColor,fontFamily:Gt.fontFamily,fontWeight:"normal"},offset:10,offsetX:0,offsetY:0},title:{autoRotate:!0,spacing:5,position:"center",style:{fontSize:12,fill:Gt.textColor,textBaseline:"middle",fontFamily:Gt.fontFamily,textAlign:"center"},iconStyle:{fill:Gt.descriptionIconFill,stroke:Gt.descriptionIconStroke},description:""},tickStates:{active:{labelStyle:{fontWeight:500},tickLineStyle:{lineWidth:2}},inactive:{labelStyle:{fill:Gt.uncheckedColor}}},optimize:{enable:!0,threshold:400}},theme:{}})},t.prototype.renderInner=function(e){this.get("line")&&this.drawLine(e),this.drawTicks(e),this.get("title")&&this.drawTitle(e)},t.prototype.isList=function(){return!0},t.prototype.getItems=function(){return this.get("ticks")},t.prototype.setItems=function(e){this.update({ticks:e})},t.prototype.updateItem=function(e,i){ye(e,i),this.clear(),this.render()},t.prototype.clearItems=function(){var e=this.getElementByLocalId("label-group");e&&e.clear()},t.prototype.setItemState=function(e,i,n){e[i]=n,this.updateTickStates(e)},t.prototype.hasState=function(e,i){return!!e[i]},t.prototype.getItemStates=function(e){var i=this.get("tickStates"),n=[];return R(i,function(a,o){e[o]&&n.push(o)}),n},t.prototype.clearItemsState=function(e){var i=this,n=this.getItemsByState(e);R(n,function(a){i.setItemState(a,e,!1)})},t.prototype.getItemsByState=function(e){var i=this,n=this.getItems();return Ur(n,function(a){return i.hasState(a,e)})},t.prototype.getSidePoint=function(e,i){var n=this,a=n.getSideVector(i,e);return{x:e.x+a[0],y:e.y+a[1]}},t.prototype.getTextAnchor=function(e){var i;return Br(e[0],0)?i="center":e[0]>0?i="start":e[0]<0&&(i="end"),i},t.prototype.getTextBaseline=function(e){var i;return Br(e[1],0)?i="middle":e[1]>0?i="top":e[1]<0&&(i="bottom"),i},t.prototype.processOverlap=function(e){},t.prototype.drawLine=function(e){var i=this.getLinePath(),n=this.get("line");this.addShape(e,{type:"path",id:this.getElementId("line"),name:"axis-line",attrs:ye({path:i},n.style)})},t.prototype.getTickLineItems=function(e){var i=this,n=[],a=this.get("tickLine"),o=a.alignTick,s=a.length,l=1,u=e.length;return u>=2&&(l=e[1].value-e[0].value),R(e,function(c){var h=c.point;o||(h=i.getTickPoint(c.value-l/2));var f=i.getSidePoint(h,s);n.push({startPoint:h,tickValue:c.value,endPoint:f,tickId:c.id,id:"tickline-"+c.id})}),n},t.prototype.getSubTickLineItems=function(e){var i=[],n=this.get("subTickLine"),a=n.count,o=e.length;if(o>=2)for(var s=0;s<o-1;s++)for(var l=e[s],u=e[s+1],c=0;c<a;c++){var h=(c+1)/(a+1),f=(1-h)*l.tickValue+h*u.tickValue,d=this.getTickPoint(f),v=this.getSidePoint(d,n.length);i.push({startPoint:d,endPoint:v,tickValue:f,id:"sub-"+l.id+"-"+c})}return i},t.prototype.getTickLineAttrs=function(e,i,n,a){var o=this.get(i).style,s={points:[e.startPoint,e.endPoint]},l=L(this.get("theme"),["tickLine","style"],{});o=ut(o)?ye({},l,o(s,n,a)):o;var u=e.startPoint,c=e.endPoint;return S({x1:u.x,y1:u.y,x2:c.x,y2:c.y},o)},t.prototype.drawTick=function(e,i,n,a,o){this.addShape(i,{type:"line",id:this.getElementId(e.id),name:"axis-"+n,attrs:this.getTickLineAttrs(e,n,a,o)})},t.prototype.drawTickLines=function(e){var i=this,n=this.get("ticks"),a=this.get("subTickLine"),o=this.getTickLineItems(n),s=this.addGroup(e,{name:"axis-tickline-group",id:this.getElementId("tickline-group")}),l=this.get("tickLine");if(R(o,function(c,h){if(l.displayWithLabel){var f=i.getElementId("label-"+c.tickId);e.findById(f)&&i.drawTick(c,s,"tickLine",h,o)}else i.drawTick(c,s,"tickLine",h,o)}),a){var u=this.getSubTickLineItems(o);R(u,function(c,h){i.drawTick(c,s,"subTickLine",h,u)})}},t.prototype.processTicks=function(){var e=this,i=this.get("ticks");R(i,function(n){n.point=e.getTickPoint(n.value),j(n.id)&&(n.id=n.name)})},t.prototype.drawTicks=function(e){var i=this;this.optimizeTicks(),this.processTicks(),this.get("label")&&this.drawLabels(e),this.get("tickLine")&&this.drawTickLines(e);var n=this.get("ticks");R(n,function(a){i.applyTickStates(a,e)})},t.prototype.optimizeTicks=function(){var e=this.get("optimize"),i=this.get("ticks");if(e&&e.enable&&e.threshold>0){var n=Tr(i);if(n>e.threshold){var a=Math.ceil(n/e.threshold),o=i.filter(function(s,l){return l%a===0});this.set("ticks",o),this.set("originalTicks",i)}}},t.prototype.getLabelAttrs=function(e,i,n){var a=this.get("label"),o=a.offset,s=a.offsetX,l=a.offsetY,u=a.rotate,c=a.formatter,h=this.getSidePoint(e.point,o),f=this.getSideVector(o,h),d=c?c(e.name,e,i):e.name,v=a.style;v=ut(v)?L(this.get("theme"),["label","style"],{}):v;var p=ye({x:h.x+s,y:h.y+l,text:d,textAlign:this.getTextAnchor(f),textBaseline:this.getTextBaseline(f)},v);return u&&(p.matrix=iu(h,u)),p},t.prototype.drawLabels=function(e){var i=this,n=this.get("ticks"),a=this.addGroup(e,{name:"axis-label-group",id:this.getElementId("label-group")});R(n,function(f,d){i.addShape(a,{type:"text",name:"axis-label",id:i.getElementId("label-"+f.id),attrs:i.getLabelAttrs(f,d,n),delegateObject:{tick:f,item:f,index:d}})}),this.processOverlap(a);var o=a.getChildren(),s=L(this.get("theme"),["label","style"],{}),l=this.get("label"),u=l.style,c=l.formatter;if(ut(u)){var h=o.map(function(f){return L(f.get("delegateObject"),"tick")});R(o,function(f,d){var v=f.get("delegateObject").tick,p=c?c(v.name,v,d):v.name,g=ye({},s,u(p,d,h));f.attr(g)})}},t.prototype.getTitleAttrs=function(){var e=this.get("title"),i=e.style,n=e.position,a=e.offset,o=e.spacing,s=o===void 0?0:o,l=e.autoRotate,u=i.fontSize,c=.5;n==="start"?c=0:n==="end"&&(c=1);var h=this.getTickPoint(c),f=this.getSidePoint(h,a||s+u/2),d=ye({x:f.x,y:f.y,text:e.text},i),v=e.rotate,p=v;if(j(v)&&l){var g=this.getAxisVector(h),m=[1,0];p=zE(g,m,!0)}if(p){var y=iu(f,p);d.matrix=y}return d},t.prototype.drawTitle=function(e){var i,n=this.getTitleAttrs(),a=this.addShape(e,{type:"text",id:this.getElementId("title"),name:"axis-title",attrs:n});!((i=this.get("title"))===null||i===void 0)&&i.description&&this.drawDescriptionIcon(e,a,n.matrix)},t.prototype.drawDescriptionIcon=function(e,i,n){var a=this.addGroup(e,{name:"axis-description",id:this.getElementById("description")}),o=i.getBBox(),s=o.maxX,l=o.maxY,u=o.height,c=this.get("title").iconStyle,h=4,f=u/2,d=f/6,v=s+h,p=l-u/2,g=[v+f,p-f],m=g[0],y=g[1],_=[m+f,y+f],x=_[0],C=_[1],A=[m,C+f],T=A[0],w=A[1],M=[v,y+f],O=M[0],P=M[1],D=[v+f,p-u/4],z=D[0],Y=D[1],H=[z,Y+d],N=H[0],W=H[1],Q=[N,W+d],q=Q[0],J=Q[1],et=[q,J+f*3/4],ft=et[0],Ct=et[1];this.addShape(a,{type:"path",id:this.getElementId("title-description-icon"),name:"axis-title-description-icon",attrs:S({path:[["M",m,y],["A",f,f,0,0,1,x,C],["A",f,f,0,0,1,T,w],["A",f,f,0,0,1,O,P],["A",f,f,0,0,1,m,y],["M",z,Y],["L",N,W],["M",q,J],["L",ft,Ct]],lineWidth:d,matrix:n},c)}),this.addShape(a,{type:"rect",id:this.getElementId("title-description-rect"),name:"axis-title-description-rect",attrs:{x:v,y:p-u/2,width:u,height:u,stroke:"#000",fill:"#000",opacity:0,matrix:n,cursor:"pointer"}})},t.prototype.applyTickStates=function(e,i){var n=this.getItemStates(e);if(n.length){var a=this.get("tickStates"),o=this.getElementId("label-"+e.id),s=i.findById(o);if(s){var l=cf(e,"label",a);l&&s.attr(l)}var u=this.getElementId("tickline-"+e.id),c=i.findById(u);if(c){var h=cf(e,"tickLine",a);h&&c.attr(h)}}},t.prototype.updateTickStates=function(e){var i=this.getItemStates(e),n=this.get("tickStates"),a=this.get("label"),o=this.getElementByLocalId("label-"+e.id),s=this.get("tickLine"),l=this.getElementByLocalId("tickline-"+e.id);if(i.length){if(o){var u=cf(e,"label",n);u&&o.attr(u)}if(l){var c=cf(e,"tickLine",n);c&&l.attr(c)}}else o&&o.attr(a.style),l&&l.attr(s.style)},t}(Jr);function sT(r,t,e,i){var n=t.getChildren(),a=!1;return R(n,function(o){var s=Lf(r,o,e,i);a=a||s}),a}function ZIt(){return z8}function qIt(r,t,e){return sT(r,t,e,"head")}function z8(r,t,e){return sT(r,t,e,"tail")}function KIt(r,t,e){return sT(r,t,e,"middle")}const QIt=Object.freeze(Object.defineProperty({__proto__:null,ellipsisHead:qIt,ellipsisMiddle:KIt,ellipsisTail:z8,getDefault:ZIt},Symbol.toStringTag,{value:"Module"}));function JIt(r){var t=r.attr("matrix");return t&&t[0]!==1}function H8(r){var t=JIt(r)?CIt(r.attr("matrix")):0;return t%360}function TC(r,t,e,i){var n=!1,a=H8(t),o=Math.abs(r?e.attr("y")-t.attr("y"):e.attr("x")-t.attr("x")),s=(r?e.attr("y")>t.attr("y"):e.attr("x")>t.attr("x"))?t.getBBox():e.getBBox();if(r){var l=Math.abs(Math.cos(a));b0(l,0,Math.PI/180)?n=s.width+i>o:n=s.height/l+i>o}else{var l=Math.abs(Math.sin(a));b0(l,0,Math.PI/180)?n=s.width+i>o:n=s.height/l+i>o}return n}function xd(r,t,e,i){var n=(i==null?void 0:i.minGap)||0,a=t.getChildren().slice().filter(function(d){return d.get("visible")});if(!a.length)return!1;var o=!1;e&&a.reverse();for(var s=a.length,l=a[0],u=l,c=1;c<s;c++){var h=a[c];h.getBBox();var f=TC(r,u,h,n);f?(h.hide(),o=!0):u=h}return o}function $8(r,t,e){var i=(e==null?void 0:e.minGap)||0,n=t.getChildren().slice();if(n.length<2)return!1;var a=!1,o=n[0],s=o.getBBox(),l=n[1],u=n.length,c=H8(o),h=Math.abs(r?l.attr("y")-o.attr("y"):l.attr("x")-o.attr("x")),f=0;if(r){var d=Math.abs(Math.cos(c));if(b0(d,0,Math.PI/180)){var v=AC(n);f=(v+i)/h}else f=(s.height/d+i)/h}else{var d=Math.abs(Math.sin(c));if(b0(d,0,Math.PI/180)){var v=AC(n);f=(v+i)/h}else f=(s.height/d+i)/h}if(f>1){f=Math.ceil(f);for(var p=0;p<u;p++)p%f!==0&&(n[p].hide(),a=!0)}return a}function tLt(){return W8}function eLt(r,t,e,i){return xd(r,t,!1,i)}function rLt(r,t,e,i){return xd(r,t,!0,i)}function iLt(r,t,e,i){var n=(i==null?void 0:i.minGap)||0,a=t.getChildren().slice();if(a.length<=2)return!1;for(var o=!1,s=a.length,l=a[0],u=a[s-1],c=l,h=1;h<s-1;h++){var f=a[h];f.getBBox();var d=TC(r,c,f,n);d?(f.hide(),o=!0):c=f}var v=TC(r,c,u,n);return v&&(c.hide(),o=!0),o}function W8(r,t,e,i){var n=$8(r,t,i);return xd(r,t,!1)&&(n=!0),n}function nLt(r,t,e,i){var n=t.getChildren().slice(),a=$8(r,t,i);if(n.length>2){var o=n[0],s=n[n.length-1];o.get("visible")||(o.show(),xd(r,t,!1,i)&&(a=!0)),s.get("visible")||(s.show(),xd(r,t,!0,i)&&(a=!0))}return a}const aLt=Object.freeze(Object.defineProperty({__proto__:null,equidistance:W8,equidistanceWithReverseBoth:nLt,getDefault:tLt,reserveBoth:iLt,reserveFirst:eLt,reserveLast:rLt},Symbol.toStringTag,{value:"Module"}));function oLt(r,t){R(r,function(e){var i=e.attr("x"),n=e.attr("y"),a=iu({x:i,y:n},t);e.attr("matrix",a)})}function V8(r,t,e,i){var n=t.getChildren();if(!n.length||!r&&n.length<2)return!1;var a=AC(n),o=!1;if(r)o=!!e&&a>e;else{var s=Math.abs(n[1].attr("x")-n[0].attr("x"));o=a>s}if(o){var l=i(e,a);oLt(n,l)}return o}function sLt(){return G8}function G8(r,t,e,i){return V8(r,t,e,function(){return Mt(i)?i:r?Gt.verticalAxisRotate:Gt.horizontalAxisRotate})}function lLt(r,t,e){return V8(r,t,e,function(i,n){if(!i)return r?Gt.verticalAxisRotate:Gt.horizontalAxisRotate;if(r)return-Math.acos(i/n);var a=0;return i>n?a=Math.PI/4:(a=Math.asin(i/n),a>Math.PI/4&&(a=Math.PI/4)),a})}const uLt=Object.freeze(Object.defineProperty({__proto__:null,fixedAngle:G8,getDefault:sLt,unfixedAngle:lLt},Symbol.toStringTag,{value:"Module"})),X8=Object.freeze(Object.defineProperty({__proto__:null,autoEllipsis:QIt,autoHide:aLt,autoRotate:uLt},Symbol.toStringTag,{value:"Module"}));var cLt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"line",locationType:"region",start:null,end:null})},t.prototype.getLinePath=function(){var e=this.get("start"),i=this.get("end"),n=[];return n.push(["M",e.x,e.y]),n.push(["L",i.x,i.y]),n},t.prototype.getInnerLayoutBBox=function(){var e=this.get("start"),i=this.get("end"),n=r.prototype.getInnerLayoutBBox.call(this),a=Math.min(e.x,i.x,n.x),o=Math.min(e.y,i.y,n.y),s=Math.max(e.x,i.x,n.maxX),l=Math.max(e.y,i.y,n.maxY);return{x:a,y:o,minX:a,minY:o,maxX:s,maxY:l,width:s-a,height:l-o}},t.prototype.isVertical=function(){var e=this.get("start"),i=this.get("end");return Br(e.x,i.x)},t.prototype.isHorizontal=function(){var e=this.get("start"),i=this.get("end");return Br(e.y,i.y)},t.prototype.getTickPoint=function(e){var i=this,n=i.get("start"),a=i.get("end"),o=a.x-n.x,s=a.y-n.y;return{x:n.x+o*e,y:n.y+s*e}},t.prototype.getSideVector=function(e){var i=this.getAxisVector(),n=yc([0,0],i),a=this.get("verticalFactor"),o=[n[1],n[0]*-1];return _i([0,0],o,e*a)},t.prototype.getAxisVector=function(){var e=this.get("start"),i=this.get("end");return[i.x-e.x,i.y-e.y]},t.prototype.processOverlap=function(e){var i=this,n=this.isVertical(),a=this.isHorizontal();if(!(!n&&!a)){var o=this.get("label"),s=this.get("title"),l=this.get("verticalLimitLength"),u=o.offset,c=l,h=0,f=0;s&&(h=s.style.fontSize,f=s.spacing),c&&(c=c-u-f-h);var d=this.get("overlapOrder");if(R(d,function(g){o[g]&&i.canProcessOverlap(g)&&i.autoProcessOverlap(g,o[g],e,c)}),s&&j(s.offset)){var v=e.getCanvasBBox(),p=n?v.width:v.height;s.offset=u+p+f+h/2}}},t.prototype.canProcessOverlap=function(e){var i=this.get("label");return e==="autoRotate"?j(i.rotate):!0},t.prototype.autoProcessOverlap=function(e,i,n,a){var o=this,s=this.isVertical(),l=!1,u=X8[e];if(i===!0)this.get("label"),l=u.getDefault()(s,n,a);else if(ut(i))l=i(s,n,a);else if(re(i)){var c=i;u[c.type]&&(l=u[c.type](s,n,a,c.cfg))}else u[i]&&(l=u[i](s,n,a));if(e==="autoRotate"){if(l){var h=n.getChildren(),f=this.get("verticalFactor");R(h,function(v){var p=v.attr("textAlign");if(p==="center"){var g=f>0?"end":"start";v.attr("textAlign",g)}})}}else if(e==="autoHide"){var d=n.getChildren().slice(0);R(d,function(v){v.get("visible")||(o.get("isRegister")&&o.unregisterElement(v),v.remove())})}},t}(U8),hLt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"circle",locationType:"circle",center:null,radius:null,startAngle:-Math.PI/2,endAngle:Math.PI*3/2})},t.prototype.getLinePath=function(){var e=this.get("center"),i=e.x,n=e.y,a=this.get("radius"),o=a,s=this.get("startAngle"),l=this.get("endAngle"),u=[];if(Math.abs(l-s)===Math.PI*2)u=[["M",i,n-o],["A",a,o,0,1,1,i,n+o],["A",a,o,0,1,1,i,n-o],["Z"]];else{var c=this.getCirclePoint(s),h=this.getCirclePoint(l),f=Math.abs(l-s)>Math.PI?1:0,d=s>l?0:1;u=[["M",i,n],["L",c.x,c.y],["A",a,o,0,f,d,h.x,h.y],["L",i,n]]}return u},t.prototype.getTickPoint=function(e){var i=this.get("startAngle"),n=this.get("endAngle"),a=i+(n-i)*e;return this.getCirclePoint(a)},t.prototype.getSideVector=function(e,i){var n=this.get("center"),a=[i.x-n.x,i.y-n.y],o=this.get("verticalFactor"),s=$u(a);return _i(a,a,o*e/s),a},t.prototype.getAxisVector=function(e){var i=this.get("center"),n=[e.x-i.x,e.y-i.y];return[n[1],-1*n[0]]},t.prototype.getCirclePoint=function(e,i){var n=this.get("center");return i=i||this.get("radius"),{x:n.x+Math.cos(e)*i,y:n.y+Math.sin(e)*i}},t.prototype.canProcessOverlap=function(e){var i=this.get("label");return e==="autoRotate"?j(i.rotate):!0},t.prototype.processOverlap=function(e){var i=this,n=this.get("label"),a=this.get("title"),o=this.get("verticalLimitLength"),s=n.offset,l=o,u=0,c=0;a&&(u=a.style.fontSize,c=a.spacing),l&&(l=l-s-c-u);var h=this.get("overlapOrder");if(R(h,function(d){n[d]&&i.canProcessOverlap(d)&&i.autoProcessOverlap(d,n[d],e,l)}),a&&j(a.offset)){var f=e.getCanvasBBox().height;a.offset=s+f+c+u/2}},t.prototype.autoProcessOverlap=function(e,i,n,a){var o=this,s=!1,l=X8[e];if(a>0)if(i===!0)s=l.getDefault()(!1,n,a);else if(ut(i))s=i(!1,n,a);else if(re(i)){var u=i;l[u.type]&&(s=l[u.type](!1,n,a,u.cfg))}else l[i]&&(s=l[i](!1,n,a));if(e==="autoRotate"){if(s){var c=n.getChildren(),h=this.get("verticalFactor");R(c,function(d){var v=d.attr("textAlign");if(v==="center"){var p=h>0?"end":"start";d.attr("textAlign",p)}})}}else if(e==="autoHide"){var f=n.getChildren().slice(0);R(f,function(d){d.get("visible")||(o.get("isRegister")&&o.unregisterElement(d),d.remove())})}},t}(U8),lT=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"crosshair",type:"base",line:{},text:null,textBackground:{},capture:!1,defaultCfg:{line:{style:{lineWidth:1,stroke:Gt.lineColor}},text:{position:"start",offset:10,autoRotate:!1,content:null,style:{fill:Gt.textColor,textAlign:"center",textBaseline:"middle",fontFamily:Gt.fontFamily}},textBackground:{padding:5,style:{stroke:Gt.lineColor}}}})},t.prototype.renderInner=function(e){this.get("line")&&this.renderLine(e),this.get("text")&&(this.renderText(e),this.renderBackground(e))},t.prototype.renderText=function(e){var i=this.get("text"),n=i.style,a=i.autoRotate,o=i.content;if(!j(o)){var s=this.getTextPoint(),l=null;if(a){var u=this.getRotateAngle();l=iu(s,u)}this.addShape(e,{type:"text",name:"crosshair-text",id:this.getElementId("text"),attrs:S(S(S({},s),{text:o,matrix:l}),n)})}},t.prototype.renderLine=function(e){var i=this.getLinePath(),n=this.get("line"),a=n.style;this.addShape(e,{type:"path",name:"crosshair-line",id:this.getElementId("line"),attrs:S({path:i},a)})},t.prototype.renderBackground=function(e){var i=this.getElementId("text"),n=e.findById(i),a=this.get("textBackground");if(a&&n){var o=n.getBBox(),s=T0(a.padding),l=a.style,u=this.addShape(e,{type:"rect",name:"crosshair-text-background",id:this.getElementId("text-background"),attrs:S({x:o.x-s[3],y:o.y-s[0],width:o.width+s[1]+s[3],height:o.height+s[0]+s[2],matrix:n.attr("matrix")},l)});u.toBack()}},t}(Jr),Y8=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"line",locationType:"region",start:null,end:null})},t.prototype.getRotateAngle=function(){var e=this.getLocation(),i=e.start,n=e.end,a=this.get("text").position,o=Math.atan2(n.y-i.y,n.x-i.x),s=a==="start"?o-Math.PI/2:o+Math.PI/2;return s},t.prototype.getTextPoint=function(){var e=this.getLocation(),i=e.start,n=e.end,a=this.get("text"),o=a.position,s=a.offset;return N8(i,n,o,s)},t.prototype.getLinePath=function(){var e=this.getLocation(),i=e.start,n=e.end;return[["M",i.x,i.y],["L",n.x,n.y]]},t}(lT),fLt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"circle",locationType:"circle",center:null,radius:100,startAngle:-Math.PI/2,endAngle:Math.PI*3/2})},t.prototype.getRotateAngle=function(){var e=this.getLocation(),i=e.startAngle,n=e.endAngle,a=this.get("text").position,o=a==="start"?i+Math.PI/2:n-Math.PI/2;return o},t.prototype.getTextPoint=function(){var e=this.get("text"),i=e.position,n=e.offset,a=this.getLocation(),o=a.center,s=a.radius,l=a.startAngle,u=a.endAngle,c=i==="start"?l:u,h=this.getRotateAngle()-Math.PI,f=pc(o,s,c),d=Math.cos(h)*n,v=Math.sin(h)*n;return{x:f.x+d,y:f.y+v}},t.prototype.getLinePath=function(){var e=this.getLocation(),i=e.center,n=e.radius,a=e.startAngle,o=e.endAngle,s=null;if(o-a===Math.PI*2){var l=i.x,u=i.y;s=[["M",l,u-n],["A",n,n,0,1,1,l,u+n],["A",n,n,0,1,1,l,u-n],["Z"]]}else{var c=pc(i,n,a),h=pc(i,n,o),f=Math.abs(o-a)>Math.PI?1:0,d=a>o?0:1;s=[["M",c.x,c.y],["A",n,n,0,f,d,h.x,h.y]]}return s},t}(lT),Cd="g2-crosshair",bC=Cd+"-line",wC=Cd+"-text",Vh;const dLt=(Vh={},Vh[""+Cd]={position:"relative"},Vh[""+bC]={position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.25)"},Vh[""+wC]={position:"absolute",color:Gt.textColor,fontFamily:Gt.fontFamily},Vh);var vLt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"crosshair",type:"html",locationType:"region",start:{x:0,y:0},end:{x:0,y:0},capture:!1,text:null,containerTpl:'<div class="'+Cd+'"></div>',crosshairTpl:'<div class="'+bC+'"></div>',textTpl:'<span class="'+wC+'">{content}</span>',domStyles:null,containerClassName:Cd,defaultStyles:dLt,defaultCfg:{text:{position:"start",content:null,align:"center",offset:10}}})},t.prototype.render=function(){this.resetText(),this.resetPosition()},t.prototype.initCrossHair=function(){var e=this.getContainer(),i=this.get("crosshairTpl"),n=Lo(i);e.appendChild(n),this.applyStyle(bC,n),this.set("crosshairEl",n)},t.prototype.getTextPoint=function(){var e=this.getLocation(),i=e.start,n=e.end,a=this.get("text"),o=a.position,s=a.offset;return N8(i,n,o,s)},t.prototype.resetText=function(){var e=this.get("text"),i=this.get("textEl");if(e){var n=e.content;if(!i){var a=this.getContainer(),o=Nd(this.get("textTpl"),e);i=Lo(o),a.appendChild(i),this.applyStyle(wC,i),this.set("textEl",i)}i.innerHTML=n}else i&&i.remove()},t.prototype.isVertical=function(e,i){return e.x===i.x},t.prototype.resetPosition=function(){var e=this.get("crosshairEl");e||(this.initCrossHair(),e=this.get("crosshairEl"));var i=this.get("start"),n=this.get("end"),a=Math.min(i.x,n.x),o=Math.min(i.y,n.y);this.isVertical(i,n)?Te(e,{width:"1px",height:Bi(Math.abs(n.y-i.y))}):Te(e,{height:"1px",width:Bi(Math.abs(n.x-i.x))}),Te(e,{top:Bi(o),left:Bi(a)}),this.alignText()},t.prototype.alignText=function(){var e=this.get("textEl");if(e){var i=this.get("text").align,n=e.clientWidth,a=this.getTextPoint();switch(i){case"center":a.x=a.x-n/2;break;case"right":a.x=a.x-n}Te(e,{top:Bi(a.y),left:Bi(a.x)})}},t.prototype.updateInner=function(e){ws(e,"text")&&this.resetText(),r.prototype.updateInner.call(this,e)},t}(oT);const UL=Object.freeze(Object.defineProperty({__proto__:null,Base:lT,Circle:fLt,Html:vLt,Line:Y8},Symbol.toStringTag,{value:"Module"}));var j8=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"grid",line:{},alternateColor:null,capture:!1,items:[],closed:!1,defaultCfg:{line:{type:"line",style:{lineWidth:1,stroke:Gt.lineColor}}}})},t.prototype.getLineType=function(){var e=this.get("line")||this.get("defaultCfg").line;return e.type},t.prototype.renderInner=function(e){this.drawGrid(e)},t.prototype.getAlternatePath=function(e,i){var n=this.getGridPath(e),a=i.slice(0).reverse(),o=this.getGridPath(a,!0),s=this.get("closed");return s?n=n.concat(o):(o[0][0]="L",n=n.concat(o),n.push(["Z"])),n},t.prototype.getPathStyle=function(){return this.get("line").style},t.prototype.drawGrid=function(e){var i=this,n=this.get("line"),a=this.get("items"),o=this.get("alternateColor"),s=null;R(a,function(l,u){var c=l.id||u;if(n){var h=i.getPathStyle();h=ut(h)?h(l,u,a):h;var f=i.getElementId("line-"+c),d=i.getGridPath(l.points);i.addShape(e,{type:"path",name:"grid-line",id:f,attrs:ye({path:d},h)})}if(o&&u>0){var v=i.getElementId("region-"+c),p=u%2===0;if(mt(o))p&&i.drawAlternateRegion(v,e,s.points,l.points,o);else{var g=p?o[1]:o[0];i.drawAlternateRegion(v,e,s.points,l.points,g)}}s=l})},t.prototype.drawAlternateRegion=function(e,i,n,a,o){var s=this.getAlternatePath(n,a);this.addShape(i,{type:"path",id:e,name:"grid-region",attrs:{path:s,fill:o}})},t}(Jr);function pLt(r,t,e,i){var n=e-r,a=i-t;return Math.sqrt(n*n+a*a)}var gLt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"circle",center:null,closed:!0})},t.prototype.getGridPath=function(e,i){var n=this.getLineType(),a=this.get("closed"),o=[];if(e.length)if(n==="circle"){var s=this.get("center"),l=e[0],u=pLt(s.x,s.y,l.x,l.y),c=i?0:1;a?(o.push(["M",s.x,s.y-u]),o.push(["A",u,u,0,0,c,s.x,s.y+u]),o.push(["A",u,u,0,0,c,s.x,s.y-u]),o.push(["Z"])):R(e,function(h,f){f===0?o.push(["M",h.x,h.y]):o.push(["A",u,u,0,0,c,h.x,h.y])})}else R(e,function(h,f){f===0?o.push(["M",h.x,h.y]):o.push(["L",h.x,h.y])}),a&&o.push(["Z"]);return o},t}(j8),mLt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"line"})},t.prototype.getGridPath=function(e){var i=[];return R(e,function(n,a){a===0?i.push(["M",n.x,n.y]):i.push(["L",n.x,n.y])}),i},t}(j8),Z8=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"legend",layout:"horizontal",locationType:"point",x:0,y:0,offsetX:0,offsetY:0,title:null,background:null})},t.prototype.getLayoutBBox=function(){var e=r.prototype.getLayoutBBox.call(this),i=this.get("maxWidth"),n=this.get("maxHeight"),a=e.width,o=e.height;return i&&(a=Math.min(a,i)),n&&(o=Math.min(o,n)),oy(e.minX,e.minY,a,o)},t.prototype.setLocation=function(e){this.set("x",e.x),this.set("y",e.y),this.resetLocation()},t.prototype.resetLocation=function(){var e=this.get("x"),i=this.get("y"),n=this.get("offsetX"),a=this.get("offsetY");this.moveElementTo(this.get("group"),{x:e+n,y:i+a})},t.prototype.applyOffset=function(){this.resetLocation()},t.prototype.getDrawPoint=function(){return this.get("currentPoint")},t.prototype.setDrawPoint=function(e){return this.set("currentPoint",e)},t.prototype.renderInner=function(e){this.resetDraw(),this.get("title")&&this.drawTitle(e),this.drawLegendContent(e),this.get("background")&&this.drawBackground(e)},t.prototype.drawBackground=function(e){var i=this.get("background"),n=e.getBBox(),a=T0(i.padding),o=S({x:0,y:0,width:n.width+a[1]+a[3],height:n.height+a[0]+a[2]},i.style),s=this.addShape(e,{type:"rect",id:this.getElementId("background"),name:"legend-background",attrs:o});s.toBack()},t.prototype.drawTitle=function(e){var i=this.get("currentPoint"),n=this.get("title"),a=n.spacing,o=n.style,s=n.text,l=this.addShape(e,{type:"text",id:this.getElementId("title"),name:"legend-title",attrs:S({text:s,x:i.x,y:i.y},o)}),u=l.getBBox();this.set("currentPoint",{x:i.x,y:u.maxY+a})},t.prototype.resetDraw=function(){var e=this.get("background"),i={x:0,y:0};if(e){var n=T0(e.padding);i.x=n[3],i.y=n[0]}this.set("currentPoint",i)},t}(Jr),N_={marker:{style:{inactiveFill:"#000",inactiveOpacity:.45,fill:"#000",opacity:1,size:12}},text:{style:{fill:"#ccc",fontSize:12}}},Sp={fill:Gt.textColor,fontSize:12,textAlign:"start",textBaseline:"middle",fontFamily:Gt.fontFamily,fontWeight:"normal",lineHeight:12},k_="navigation-arrow-right",U_="navigation-arrow-left",zL={right:90*Math.PI/180,left:(360-90)*Math.PI/180,up:0,down:180*Math.PI/180},yLt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.currentPageIndex=1,e.totalPagesCnt=1,e.pageWidth=0,e.pageHeight=0,e.startX=0,e.startY=0,e.onNavigationBack=function(){var i=e.getElementByLocalId("item-group");if(e.currentPageIndex>1){e.currentPageIndex-=1,e.updateNavigation();var n=e.getCurrentNavigationMatrix();e.get("animate")?i.animate({matrix:n},100):i.attr({matrix:n})}},e.onNavigationAfter=function(){var i=e.getElementByLocalId("item-group");if(e.currentPageIndex<e.totalPagesCnt){e.currentPageIndex+=1,e.updateNavigation();var n=e.getCurrentNavigationMatrix();e.get("animate")?i.animate({matrix:n},100):i.attr({matrix:n})}},e}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"legend",type:"category",itemSpacing:24,itemMarginBottom:8,maxItemWidth:null,itemWidth:null,itemHeight:null,itemName:{},itemValue:null,maxWidth:null,maxHeight:null,marker:{},radio:null,items:[],itemStates:{},itemBackground:{},pageNavigator:{},defaultCfg:{title:{spacing:5,style:{fill:Gt.textColor,fontSize:12,textAlign:"start",textBaseline:"top"}},background:{padding:5,style:{stroke:Gt.lineColor}},itemBackground:{style:{opacity:0,fill:"#fff"}},pageNavigator:N_,itemName:{spacing:16,style:Sp},marker:{spacing:8,style:{r:6,symbol:"circle"}},itemValue:{alignRight:!1,formatter:null,style:Sp,spacing:6},itemStates:{active:{nameStyle:{opacity:.8}},unchecked:{nameStyle:{fill:Gt.uncheckedColor},markerStyle:{fill:Gt.uncheckedColor,stroke:Gt.uncheckedColor}},inactive:{nameStyle:{fill:Gt.uncheckedColor},markerStyle:{opacity:.2}}}}})},t.prototype.isList=function(){return!0},t.prototype.getItems=function(){return this.get("items")},t.prototype.setItems=function(e){this.update({items:e})},t.prototype.updateItem=function(e,i){ye(e,i),this.clear(),this.render()},t.prototype.clearItems=function(){var e=this.getElementByLocalId("item-group");e&&e.clear()},t.prototype.setItemState=function(e,i,n){e[i]=n;var a=this.getElementByLocalId("item-"+e.id);if(a){var o=this.getItems(),s=o.indexOf(e),l=this.createOffScreenGroup(),u=this.drawItem(e,s,this.getItemHeight(),l);this.updateElements(u,a),this.clearUpdateStatus(a)}},t.prototype.hasState=function(e,i){return!!e[i]},t.prototype.getItemStates=function(e){var i=this.get("itemStates"),n=[];return R(i,function(a,o){e[o]&&n.push(o)}),n},t.prototype.clearItemsState=function(e){var i=this,n=this.getItemsByState(e);R(n,function(a){i.setItemState(a,e,!1)})},t.prototype.getItemsByState=function(e){var i=this,n=this.getItems();return Ur(n,function(a){return i.hasState(a,e)})},t.prototype.drawLegendContent=function(e){this.processItems(),this.drawItems(e)},t.prototype.processItems=function(){var e=this.get("items");R(e,function(i){i.id||(i.id=i.name)})},t.prototype.drawItems=function(e){var i=this,n=this.addGroup(e,{id:this.getElementId("item-container-group"),name:"legend-item-container-group"}),a=this.addGroup(n,{id:this.getElementId("item-group"),name:"legend-item-group"}),o=this.getItemHeight(),s=this.get("itemWidth"),l=this.get("itemSpacing"),u=this.get("itemMarginBottom"),c=this.get("currentPoint"),h=c.x,f=c.y,d=this.get("layout"),v=this.get("items"),p=!1,g=0,m=this.get("maxWidth"),y=this.get("maxHeight");R(v,function(_,x){var C=i.drawItem(_,x,o,a),A=C.getBBox(),T=s||A.width;T>g&&(g=T),d==="horizontal"?(m&&m<c.x+T-h&&(p=!0,c.x=h,c.y+=o+u),i.moveElementTo(C,c),c.x+=T+l):(y&&y<c.y+o+u-f&&(p=!0,c.x+=g+l,c.y=f,g=0),i.moveElementTo(C,c),c.y+=o+u)}),p&&this.get("flipPage")&&(this.pageHeight=0,this.pageWidth=0,this.totalPagesCnt=1,this.startX=h,this.startY=f,this.adjustNavigation(e,a))},t.prototype.getItemHeight=function(){var e=this.get("itemHeight");if(!e){var i=(this.get("itemName")||{}).style;if(ut(i)){var n=this.getItems();n.forEach(function(a,o){var s=S(S({},Sp),i(a,o,n)).fontSize;e<s&&(e=s)})}else i&&(e=i.fontSize)}return e},t.prototype.drawMarker=function(e,i,n,a){var o=S(S(S({x:0,y:a/2},i.style),{symbol:L(n.marker,"symbol","circle")}),L(n.marker,"style",{})),s=this.addShape(e,{type:"marker",id:this.getElementId("item-"+n.id+"-marker"),name:"legend-item-marker",attrs:o}),l=s.getBBox();s.attr("x",l.width/2);var u=s.attr(),c=u.stroke,h=u.fill;return c&&s.set("isStroke",!0),h&&s.set("isFill",!0),s},t.prototype.drawItemText=function(e,i,n,a,o,s,l){var u=n.formatter,c=n.style,h=S(S({x:s,y:o/2,text:u?u(a[i],a,l):a[i]},Sp),ut(c)?c(a,l,this.getItems()):c);return this.addShape(e,{type:"text",id:this.getElementId("item-"+a.id+"-"+i),name:"legend-item-"+i,attrs:h})},t.prototype.drawRadio=function(e,i,n,a,o){var s,l,u=i.style||{},c=(s=u.r)!==null&&s!==void 0?s:a/2,h=c*3.6/8,f=[o+c,a/2-c],d=f[0],v=f[1],p=[d+c,v+c],g=p[0],m=p[1],y=[d,m+c],_=y[0],x=y[1],C=[o,v+c],A=C[0],T=C[1],w=n.showRadio,M=S(S({path:[["M",d,v],["A",c,c,0,0,1,g,m],["L",g-h,m],["L",g,m],["A",c,c,0,0,1,_,x],["L",_,x-h],["L",_,x],["A",c,c,0,0,1,A,T],["L",A+h,T],["L",A,T],["A",c,c,0,0,1,d,v],["L",d,v+h]],stroke:"#000000",fill:"#ffffff"},u),{opacity:w?(l=u==null?void 0:u.opacity)!==null&&l!==void 0?l:.45:0}),O=this.addShape(e,{type:"path",id:this.getElementId("item-"+n.id+"-radio"),name:"legend-item-radio",attrs:M});return O.set("tip",i.tip),O},t.prototype.drawItem=function(e,i,n,a){var o="item-"+e.id,s=this.addGroup(a,{name:"legend-item-container",id:this.getElementId("item-container-"+o),delegateObject:{item:e,index:i}}),l=this.addGroup(s,{name:"legend-item",id:this.getElementId(o),delegateObject:{item:e,index:i}}),u=this.get("marker"),c=this.get("itemName"),h=this.get("itemValue"),f=this.get("itemBackground"),d=this.get("radio"),v=this.getLimitItemWidth(),p=0;if(u){var g=this.drawMarker(l,u,e,n),m=u.spacing,y=L(e,["marker","spacing"]);Mt(y)&&(m=y),p=g.getBBox().maxX+m}if(c){var _=this.drawItemText(l,"name",c,e,n,p,i);v&&Lf(!0,_,Be(v-p,0,v)),p=_.getBBox().maxX+c.spacing}if(h){var x=this.drawItemText(l,"value",h,e,n,p,i);v&&(h.alignRight?(x.attr({textAlign:"right",x:v}),Lf(!0,x,Be(v-p,0,v),"head")):Lf(!0,x,Be(v-p,0,v))),p=x.getBBox().maxX+h.spacing}if(d&&this.drawRadio(l,d,e,n,p),f){var C=l.getBBox(),A=this.addShape(l,{type:"rect",name:"legend-item-background",id:this.getElementId(o+"-background"),attrs:S({x:0,y:0,width:C.width,height:n},f.style)});A.toBack()}return this.applyItemStates(e,l),l},t.prototype.adjustNavigation=function(e,i){var n=this,a=this.startX,o=this.startY,s=this.get("layout"),l=i.findAll(function(D){return D.get("name")==="legend-item"}),u=this.get("maxWidth"),c=this.get("maxHeight"),h=this.get("itemWidth"),f=this.get("itemSpacing"),d=this.getItemHeight(),v=nt({},N_,this.get("pageNavigator")),p=this.drawNavigation(e,s,"00/00",v),g=p.getBBox(),m={x:a,y:o},y=1,_=0,x=0,C=0,A=this.get("itemMarginBottom");function T(D,z){var Y=D.getBBox(),H=h||Y.width,N=z.x+H+f+g.width;return N>u}if(s==="horizontal"){var w=this.get("maxRow")||1,M=d+(w===1?0:A),O=u-f-g.width-g.minX;this.pageHeight=M*w,this.pageWidth=O,R(l,function(D){var z=D.getBBox(),Y=h||z.width;(_&&_<m.x+Y+f||T(D,m))&&(y===1&&(_=m.x+f,n.moveElementTo(p,{x:O,y:m.y+d/2-g.height/2-g.minY})),y+=1,m.x=a,m.y+=M),n.moveElementTo(D,m),D.getParent().setClip({type:"rect",attrs:{x:m.x,y:m.y,width:Y+f,height:d}}),m.x+=Y+f})}else{R(l,function(D){var z=D.getBBox();z.width>x&&(x=z.width)}),C=x,x+=f,u&&(x=Math.min(u,x),C=Math.min(u,C)),this.pageWidth=x,this.pageHeight=c-Math.max(g.height,d+A);var P=Math.floor(this.pageHeight/(d+A));R(l,function(D,z){z!==0&&z%P===0&&(y+=1,m.x+=x,m.y=o),n.moveElementTo(D,m),D.getParent().setClip({type:"rect",attrs:{x:m.x,y:m.y,width:x,height:d}}),m.y+=d+A}),this.totalPagesCnt=y,this.moveElementTo(p,{x:a+C/2-g.width/2-g.minX,y:c-g.height-g.minY})}this.pageHeight&&this.pageWidth&&i.getParent().setClip({type:"rect",attrs:{x:this.startX,y:this.startY,width:this.pageWidth,height:this.pageHeight}}),s==="horizontal"&&this.get("maxRow")?this.totalPagesCnt=Math.ceil(y/this.get("maxRow")):this.totalPagesCnt=y,this.currentPageIndex>this.totalPagesCnt&&(this.currentPageIndex=1),this.updateNavigation(p),i.attr("matrix",this.getCurrentNavigationMatrix())},t.prototype.drawNavigation=function(e,i,n,a){var o={x:0,y:0},s=this.addGroup(e,{id:this.getElementId("navigation-group"),name:"legend-navigation"}),l=L(a.marker,"style",{}),u=l.size,c=u===void 0?12:u,h=Ut(l,["size"]),f=this.drawArrow(s,o,U_,i==="horizontal"?"up":"left",c,h);f.on("click",this.onNavigationBack);var d=f.getBBox();o.x+=d.width+2;var v=this.addShape(s,{type:"text",id:this.getElementId("navigation-text"),name:"navigation-text",attrs:S({x:o.x,y:o.y+c/2,text:n,textBaseline:"middle"},L(a.text,"style"))}),p=v.getBBox();o.x+=p.width+2;var g=this.drawArrow(s,o,k_,i==="horizontal"?"down":"right",c,h);return g.on("click",this.onNavigationAfter),s},t.prototype.updateNavigation=function(e){var i=nt({},N_,this.get("pageNavigator")),n=i.marker.style,a=n.fill,o=n.opacity,s=n.inactiveFill,l=n.inactiveOpacity,u=this.currentPageIndex+"/"+this.totalPagesCnt,c=e?e.getChildren()[1]:this.getElementByLocalId("navigation-text"),h=e?e.findById(this.getElementId(U_)):this.getElementByLocalId(U_),f=e?e.findById(this.getElementId(k_)):this.getElementByLocalId(k_);c.attr("text",u),h.attr("opacity",this.currentPageIndex===1?l:o),h.attr("fill",this.currentPageIndex===1?s:a),h.attr("cursor",this.currentPageIndex===1?"not-allowed":"pointer"),f.attr("opacity",this.currentPageIndex===this.totalPagesCnt?l:o),f.attr("fill",this.currentPageIndex===this.totalPagesCnt?s:a),f.attr("cursor",this.currentPageIndex===this.totalPagesCnt?"not-allowed":"pointer");var d=h.getBBox().maxX+2;c.attr("x",d),d+=c.getBBox().width+2,this.updateArrowPath(f,{x:d,y:0})},t.prototype.drawArrow=function(e,i,n,a,o,s){var l=i.x,u=i.y,c=this.addShape(e,{type:"path",id:this.getElementId(n),name:n,attrs:S({size:o,direction:a,path:[["M",l+o/2,u],["L",l,u+o],["L",l+o,u+o],["Z"]],cursor:"pointer"},s)});return c.attr("matrix",iu({x:l+o/2,y:u+o/2},zL[a])),c},t.prototype.updateArrowPath=function(e,i){var n=i.x,a=i.y,o=e.attr(),s=o.size,l=o.direction,u=iu({x:n+s/2,y:a+s/2},zL[l]);e.attr("path",[["M",n+s/2,a],["L",n,a+s],["L",n+s,a+s],["Z"]]),e.attr("matrix",u)},t.prototype.getCurrentNavigationMatrix=function(){var e=this,i=e.currentPageIndex,n=e.pageWidth,a=e.pageHeight,o=this.get("layout"),s=o==="horizontal"?{x:0,y:a*(1-i)}:{x:n*(1-i),y:0};return iT(s)},t.prototype.applyItemStates=function(e,i){var n=this.getItemStates(e),a=n.length>0;if(a){var o=i.getChildren(),s=this.get("itemStates");R(o,function(l){var u=l.get("name"),c=u.split("-")[2],h=cf(e,c,s);h&&(l.attr(h),c==="marker"&&!(l.get("isStroke")&&l.get("isFill"))&&(l.get("isStroke")&&l.attr("fill",null),l.get("isFill")&&l.attr("stroke",null)))})}},t.prototype.getLimitItemWidth=function(){var e=this.get("itemWidth"),i=this.get("maxItemWidth");return i?e&&(i=e<=i?e:i):e&&(i=e),i},t}(Z8),_Lt=1.4,HL=.4,xLt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"continue",min:0,max:100,value:null,colors:[],track:{},rail:{},label:{},handler:{},slidable:!0,tip:null,step:null,maxWidth:null,maxHeight:null,defaultCfg:{label:{align:"rail",spacing:5,formatter:null,style:{fontSize:12,fill:Gt.textColor,textBaseline:"middle",fontFamily:Gt.fontFamily}},handler:{size:10,style:{fill:"#fff",stroke:"#333"}},track:{},rail:{type:"color",size:20,defaultLength:100,style:{fill:"#DCDEE2"}},title:{spacing:5,style:{fill:Gt.textColor,fontSize:12,textAlign:"start",textBaseline:"top"}}}})},t.prototype.isSlider=function(){return!0},t.prototype.getValue=function(){return this.getCurrentValue()},t.prototype.getRange=function(){return{min:this.get("min"),max:this.get("max")}},t.prototype.setRange=function(e,i){this.update({min:e,max:i})},t.prototype.setValue=function(e){var i=this.getValue();this.set("value",e);var n=this.get("group");this.resetTrackClip(),this.get("slidable")&&this.resetHandlers(n),this.delegateEmit("valuechanged",{originValue:i,value:e})},t.prototype.initEvent=function(){var e=this.get("group");this.bindSliderEvent(e),this.bindRailEvent(e),this.bindTrackEvent(e)},t.prototype.drawLegendContent=function(e){this.drawRail(e),this.drawLabels(e),this.fixedElements(e),this.resetTrack(e),this.resetTrackClip(e),this.get("slidable")&&this.resetHandlers(e)},t.prototype.bindSliderEvent=function(e){this.bindHandlersEvent(e)},t.prototype.bindHandlersEvent=function(e){var i=this;e.on("legend-handler-min:drag",function(n){var a=i.getValueByCanvasPoint(n.x,n.y),o=i.getCurrentValue(),s=o[1];s<a&&(s=a),i.setValue([a,s])}),e.on("legend-handler-max:drag",function(n){var a=i.getValueByCanvasPoint(n.x,n.y),o=i.getCurrentValue(),s=o[0];s>a&&(s=a),i.setValue([s,a])})},t.prototype.bindRailEvent=function(e){},t.prototype.bindTrackEvent=function(e){var i=this,n=null;e.on("legend-track:dragstart",function(a){n={x:a.x,y:a.y}}),e.on("legend-track:drag",function(a){if(n){var o=i.getValueByCanvasPoint(n.x,n.y),s=i.getValueByCanvasPoint(a.x,a.y),l=i.getCurrentValue(),u=l[1]-l[0],c=i.getRange(),h=s-o;h<0?l[0]+h>c.min?i.setValue([l[0]+h,l[1]+h]):i.setValue([c.min,c.min+u]):h>0&&(h>0&&l[1]+h<c.max?i.setValue([l[0]+h,l[1]+h]):i.setValue([c.max-u,c.max])),n={x:a.x,y:a.y}}}),e.on("legend-track:dragend",function(a){n=null})},t.prototype.drawLabels=function(e){this.drawLabel("min",e),this.drawLabel("max",e)},t.prototype.drawLabel=function(e,i){var n=this.get("label"),a=n.style,o=n.align,s=n.formatter,l=this.get(e),u=this.getLabelAlignAttrs(e,o),c="label-"+e;this.addShape(i,{type:"text",id:this.getElementId(c),name:"legend-label-"+e,attrs:S(S({x:0,y:0,text:ut(s)?s(l):l},a),u)})},t.prototype.getLabelAlignAttrs=function(e,i){var n=this.isVertical(),a="center",o="middle";return n?(a="start",i!=="rail"?e==="min"?o="top":o="bottom":o="top"):i!=="rail"?(o="top",e==="min"?a="start":a="end"):(a="start",o="middle"),{textAlign:a,textBaseline:o}},t.prototype.getRailPath=function(e,i,n,a){var o=this.get("rail"),s=o.size,l=o.defaultLength,u=o.type,c=this.isVertical(),h=l,f=n,d=a;f||(f=c?s:h),d||(d=c?h:s);var v=[];return u==="color"?(v.push(["M",e,i]),v.push(["L",e+f,i]),v.push(["L",e+f,i+d]),v.push(["L",e,i+d]),v.push(["Z"])):(v.push(["M",e+f,i]),v.push(["L",e+f,i+d]),v.push(["L",e,i+d]),v.push(["Z"])),v},t.prototype.drawRail=function(e){var i=this.get("rail"),n=i.style;this.addShape(e,{type:"path",id:this.getElementId("rail"),name:"legend-rail",attrs:S({path:this.getRailPath(0,0)},n)})},t.prototype.getTrackColor=function(e){var i=e.length;if(!i)return null;if(i===1)return e[0];var n;this.isVertical()?n="l(90)":n="l(0)";for(var a=0;a<i;a++){var o=a/(i-1);n+=" "+o+":"+e[a]}return n},t.prototype.getTrackPath=function(e){var i=this.getRailShape(e),n=i.attr("path");return Dr(n)},t.prototype.getClipTrackAttrs=function(e){var i=this.getCurrentValue(),n=i[0],a=i[1],o=this.getRailBBox(e),s=this.getPointByValue(n,e),l=this.getPointByValue(a,e),u=this.isVertical(),c,h,f,d;return u?(c=o.minX,h=s.y,f=o.width,d=l.y-s.y):(c=s.x,h=o.minY,f=l.x-s.x,d=o.height),{x:c,y:h,width:f,height:d}},t.prototype.getTrackAttrs=function(e){var i=this.get("track"),n=this.get("colors"),a=this.getTrackPath(e);return ye({path:a,fill:this.getTrackColor(n)},i.style)},t.prototype.resetTrackClip=function(e){var i=e||this.get("group"),n=this.getElementId("track"),a=i.findById(n),o=a.getClip(),s=this.getClipTrackAttrs(e);o?o.attr(s):a.setClip({type:"rect",attrs:s})},t.prototype.resetTrack=function(e){var i=this.getElementId("track"),n=e.findById(i),a=this.getTrackAttrs(e);n?n.attr(a):this.addShape(e,{type:"path",id:i,draggable:this.get("slidable"),name:"legend-track",attrs:a})},t.prototype.getPointByValue=function(e,i){var n=this.getRange(),a=n.min,o=n.max,s=(e-a)/(o-a),l=this.getRailBBox(i),u=this.isVertical(),c={x:0,y:0};return u?(c.x=l.minX+l.width/2,c.y=Ul(l.minY,l.maxY,s)):(c.x=Ul(l.minX,l.maxX,s),c.y=l.minY+l.height/2),c},t.prototype.getRailShape=function(e){var i=e||this.get("group");return i.findById(this.getElementId("rail"))},t.prototype.getRailBBox=function(e){var i=this.getRailShape(e),n=i.getBBox();return n},t.prototype.getRailCanvasBBox=function(){var e=this.get("group"),i=e.findById(this.getElementId("rail")),n=i.getCanvasBBox();return n},t.prototype.isVertical=function(){return this.get("layout")==="vertical"},t.prototype.getValueByCanvasPoint=function(e,i){var n=this.getRange(),a=n.min,o=n.max,s=this.getRailCanvasBBox(),l=this.isVertical(),u=this.get("step"),c;l?c=(i-s.minY)/s.height:c=(e-s.minX)/s.width;var h=Ul(a,o,c);if(u){var f=Math.round((h-a)/u);h=a+f*u}return h>o&&(h=o),h<a&&(h=a),h},t.prototype.getCurrentValue=function(){var e=this.get("value");if(!e){var i=this.get("values");return i?[Math.max(Math.min.apply(Math,kf(i,[this.get("max")])),this.get("min")),Math.min(Math.max.apply(Math,kf(i,[this.get("min")])),this.get("max"))]:[this.get("min"),this.get("max")]}return e},t.prototype.resetHandlers=function(e){var i=this.getCurrentValue(),n=i[0],a=i[1];this.resetHandler(e,"min",n),this.resetHandler(e,"max",a)},t.prototype.getHandlerPath=function(e,i){var n=this.isVertical(),a=[],o=e.size,s=i.x,l=i.y,u=o*_Lt,c=o/2,h=o/6;if(n){var f=s+u*HL;a.push(["M",s,l]),a.push(["L",f,l+c]),a.push(["L",s+u,l+c]),a.push(["L",s+u,l-c]),a.push(["L",f,l-c]),a.push(["Z"]),a.push(["M",f,l+h]),a.push(["L",s+u-2,l+h]),a.push(["M",f,l-h]),a.push(["L",s+u-2,l-h])}else{var d=l+u*HL;a.push(["M",s,l]),a.push(["L",s-c,d]),a.push(["L",s-c,l+u]),a.push(["L",s+c,l+u]),a.push(["L",s+c,d]),a.push(["Z"]),a.push(["M",s-h,d]),a.push(["L",s-h,l+u-2]),a.push(["M",s+h,d]),a.push(["L",s+h,l+u-2])}return a},t.prototype.resetHandler=function(e,i,n){var a=this.getPointByValue(n,e),o=this.get("handler"),s=this.getHandlerPath(o,a),l=this.getElementId("handler-"+i),u=e.findById(l),c=this.isVertical();u?u.attr("path",s):this.addShape(e,{type:"path",name:"legend-handler-"+i,draggable:!0,id:l,attrs:S(S({path:s},o.style),{cursor:c?"ns-resize":"ew-resize"})})},t.prototype.fixedElements=function(e){var i=e.findById(this.getElementId("rail")),n=e.findById(this.getElementId("label-min")),a=e.findById(this.getElementId("label-max")),o=this.getDrawPoint();this.isVertical()?this.fixedVertail(n,a,i,o):this.fixedHorizontal(n,a,i,o)},t.prototype.fitRailLength=function(e,i,n,a){var o=this.isVertical(),s=o?"height":"width",l=this.get("label"),u=l.align,c=l.spacing,h=this.get("max"+fu(s));if(h){var f=u==="rail"?n[s]+e[s]+i[s]+c*2:n[s],d=f-h;d>0&&this.changeRailLength(a,s,n[s]-d)}},t.prototype.changeRailLength=function(e,i,n){var a=e.getBBox(),o;i==="height"?o=this.getRailPath(a.x,a.y,a.width,n):o=this.getRailPath(a.x,a.y,n,a.height),e.attr("path",o)},t.prototype.changeRailPosition=function(e,i,n){var a=e.getBBox(),o=this.getRailPath(i,n,a.width,a.height);e.attr("path",o)},t.prototype.fixedHorizontal=function(e,i,n,a){var o=this.get("label"),s=o.align,l=o.spacing,u=n.getBBox(),c=e.getBBox(),h=i.getBBox(),f=u.height;this.fitRailLength(c,h,u,n),u=n.getBBox(),s==="rail"?(e.attr({x:a.x,y:a.y+f/2}),this.changeRailPosition(n,a.x+c.width+l,a.y),i.attr({x:a.x+c.width+u.width+l*2,y:a.y+f/2})):s==="top"?(e.attr({x:a.x,y:a.y}),i.attr({x:a.x+u.width,y:a.y}),this.changeRailPosition(n,a.x,a.y+c.height+l)):(this.changeRailPosition(n,a.x,a.y),e.attr({x:a.x,y:a.y+u.height+l}),i.attr({x:a.x+u.width,y:a.y+u.height+l}))},t.prototype.fixedVertail=function(e,i,n,a){var o=this.get("label"),s=o.align,l=o.spacing,u=n.getBBox(),c=e.getBBox(),h=i.getBBox();if(this.fitRailLength(c,h,u,n),u=n.getBBox(),s==="rail")e.attr({x:a.x,y:a.y}),this.changeRailPosition(n,a.x,a.y+c.height+l),i.attr({x:a.x,y:a.y+c.height+u.height+l*2});else if(s==="right")e.attr({x:a.x+u.width+l,y:a.y}),this.changeRailPosition(n,a.x,a.y),i.attr({x:a.x+u.width+l,y:a.y+u.height});else{var f=Math.max(c.width,h.width);e.attr({x:a.x,y:a.y}),this.changeRailPosition(n,a.x+f+l,a.y),i.attr({x:a.x,y:a.y+u.height})}},t}(Z8),Uo="g2-tooltip",zo="g2-tooltip-title",Ed="g2-tooltip-list",ly="g2-tooltip-list-item",uy="g2-tooltip-marker",cy="g2-tooltip-value",q8="g2-tooltip-name",uT="g2-tooltip-crosshair-x",cT="g2-tooltip-crosshair-y";const CLt=Object.freeze(Object.defineProperty({__proto__:null,CONTAINER_CLASS:Uo,CROSSHAIR_X:uT,CROSSHAIR_Y:cT,LIST_CLASS:Ed,LIST_ITEM_CLASS:ly,MARKER_CLASS:uy,NAME_CLASS:q8,TITLE_CLASS:zo,VALUE_CLASS:cy},Symbol.toStringTag,{value:"Module"}));var Oa;const ELt=(Oa={},Oa[""+Uo]={position:"absolute",visibility:"visible",zIndex:8,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"0px 0px 10px #aeaeae",borderRadius:"3px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:Gt.fontFamily,lineHeight:"20px",padding:"10px 10px 6px 10px"},Oa[""+zo]={marginBottom:"4px"},Oa[""+Ed]={margin:"0px",listStyleType:"none",padding:"0px"},Oa[""+ly]={listStyleType:"none",marginBottom:"4px"},Oa[""+uy]={width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"8px"},Oa[""+cy]={display:"inline-block",float:"right",marginLeft:"30px"},Oa[""+uT]={position:"absolute",width:"1px",backgroundColor:"rgba(0, 0, 0, 0.25)"},Oa[""+cT]={position:"absolute",height:"1px",backgroundColor:"rgba(0, 0, 0, 0.25)"},Oa);function SLt(r,t,e,i,n){var a={left:r<n.x,right:r+e>n.x+n.width,top:t<n.y,bottom:t+i>n.y+n.height};return a}function ALt(r,t,e,i,n,a){var o=r,s=t;switch(a){case"left":o=r-i-e,s=t-n/2;break;case"right":o=r+e,s=t-n/2;break;case"top":o=r-i/2,s=t-n-e;break;case"bottom":o=r-i/2,s=t+e;break;default:o=r+e,s=t-n-e;break}return{x:o,y:s}}function TLt(r,t,e,i,n,a,o){var s=ALt(r,t,e,i,n,a);if(o){var l=SLt(s.x,s.y,i,n,o);a==="auto"?(l.right&&(s.x=Math.max(0,r-i-e)),l.top&&(s.y=Math.max(0,t-n-e))):a==="top"||a==="bottom"?(l.left&&(s.x=o.x),l.right&&(s.x=o.x+o.width-i),a==="top"&&l.top&&(s.y=t+e),a==="bottom"&&l.bottom&&(s.y=t-n-e)):(l.top&&(s.y=o.y),l.bottom&&(s.y=o.y+o.height-n),a==="left"&&l.left&&(s.x=r+e),a==="right"&&l.right&&(s.x=r-i-e))}return s}function bLt(r,t){var e=!1;return R(t,function(i){if(ws(r,i))return e=!0,!1}),e}var wLt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"tooltip",type:"html",x:0,y:0,items:[],customContent:null,containerTpl:'<div class="'+Uo+'"><div class="'+zo+'"></div><ul class="'+Ed+'"></ul></div>',itemTpl:'<li class="'+ly+`" data-index={index}>
          <span class="`+uy+`" style="background:{color}"></span>
          <span class="`+q8+`">{name}</span>:
          <span class="`+cy+`">{value}</span>
        </li>`,xCrosshairTpl:'<div class="'+uT+'"></div>',yCrosshairTpl:'<div class="'+cT+'"></div>',title:null,showTitle:!0,region:null,crosshairsRegion:null,containerClassName:Uo,crosshairs:null,offset:10,position:"right",domStyles:null,defaultStyles:ELt})},t.prototype.render=function(){this.get("customContent")?this.renderCustomContent():(this.resetTitle(),this.renderItems()),this.resetPosition()},t.prototype.clear=function(){this.clearCrosshairs(),this.setTitle(""),this.clearItemDoms()},t.prototype.show=function(){var e=this.getContainer();!e||this.destroyed||(this.set("visible",!0),Te(e,{visibility:"visible"}),this.setCrossHairsVisible(!0))},t.prototype.hide=function(){var e=this.getContainer();!e||this.destroyed||(this.set("visible",!1),Te(e,{visibility:"hidden"}),this.setCrossHairsVisible(!1))},t.prototype.getLocation=function(){return{x:this.get("x"),y:this.get("y")}},t.prototype.setLocation=function(e){this.set("x",e.x),this.set("y",e.y),this.resetPosition()},t.prototype.setCrossHairsVisible=function(e){var i=e?"":"none",n=this.get("xCrosshairDom"),a=this.get("yCrosshairDom");n&&Te(n,{display:i}),a&&Te(a,{display:i})},t.prototype.initContainer=function(){if(r.prototype.initContainer.call(this),this.get("customContent")){this.get("container")&&this.get("container").remove();var e=this.getHtmlContentNode();this.get("parent").appendChild(e),this.set("container",e),this.resetStyles(),this.applyStyles()}},t.prototype.updateInner=function(e){this.get("customContent")?this.renderCustomContent():(bLt(e,["title","showTitle"])&&this.resetTitle(),ws(e,"items")&&this.renderItems()),r.prototype.updateInner.call(this,e)},t.prototype.initDom=function(){this.cacheDoms()},t.prototype.removeDom=function(){r.prototype.removeDom.call(this),this.clearCrosshairs()},t.prototype.resetPosition=function(){var e=this.get("x"),i=this.get("y"),n=this.get("offset"),a=this.getOffset(),o=a.offsetX,s=a.offsetY,l=this.get("position"),u=this.get("region"),c=this.getContainer(),h=this.getBBox(),f=h.width,d=h.height,v;u&&(v=_d(u));var p=TLt(e,i,n,f,d,l,v);Te(c,{left:Bi(p.x+o),top:Bi(p.y+s)}),this.resetCrosshairs()},t.prototype.renderCustomContent=function(){var e=this.getHtmlContentNode(),i=this.get("parent"),n=this.get("container");n&&n.parentNode===i?i.replaceChild(e,n):i.appendChild(e),this.set("container",e),this.resetStyles(),this.applyStyles()},t.prototype.getHtmlContentNode=function(){var e,i=this.get("customContent");if(i){var n=i(this.get("title"),this.get("items"));$B(n)?e=n:e=Lo(n)}return e},t.prototype.cacheDoms=function(){var e=this.getContainer(),i=e.getElementsByClassName(zo)[0],n=e.getElementsByClassName(Ed)[0];this.set("titleDom",i),this.set("listDom",n)},t.prototype.resetTitle=function(){var e=this.get("title"),i=this.get("showTitle");i&&e?this.setTitle(e):this.setTitle("")},t.prototype.setTitle=function(e){var i=this.get("titleDom");i&&(i.innerText=e)},t.prototype.resetCrosshairs=function(){var e=this.get("crosshairsRegion"),i=this.get("crosshairs");if(!e||!i)this.clearCrosshairs();else{var n=_d(e),a=this.get("xCrosshairDom"),o=this.get("yCrosshairDom");i==="x"?(this.resetCrosshair("x",n),o&&(o.remove(),this.set("yCrosshairDom",null))):i==="y"?(this.resetCrosshair("y",n),a&&(a.remove(),this.set("xCrosshairDom",null))):(this.resetCrosshair("x",n),this.resetCrosshair("y",n)),this.setCrossHairsVisible(this.get("visible"))}},t.prototype.resetCrosshair=function(e,i){var n=this.checkCrosshair(e),a=this.get(e);e==="x"?Te(n,{left:Bi(a),top:Bi(i.y),height:Bi(i.height)}):Te(n,{top:Bi(a),left:Bi(i.x),width:Bi(i.width)})},t.prototype.checkCrosshair=function(e){var i=e+"CrosshairDom",n=e+"CrosshairTpl",a="CROSSHAIR_"+e.toUpperCase(),o=CLt[a],s=this.get(i),l=this.get("parent");return s||(s=Lo(this.get(n)),this.applyStyle(o,s),l.appendChild(s),this.set(i,s)),s},t.prototype.renderItems=function(){this.clearItemDoms();var e=this.get("items"),i=this.get("itemTpl"),n=this.get("listDom");n&&(R(e,function(a){var o=Ts.toCSSGradient(a.color),s=S(S({},a),{color:o}),l=Nd(i,s),u=Lo(l);n.appendChild(u)}),this.applyChildrenStyles(n,this.get("domStyles")))},t.prototype.clearItemDoms=function(){this.get("listDom")&&aT(this.get("listDom"))},t.prototype.clearCrosshairs=function(){var e=this.get("xCrosshairDom"),i=this.get("yCrosshairDom");e&&e.remove(),i&&i.remove(),this.set("xCrosshairDom",null),this.set("yCrosshairDom",null)},t}(oT),RLt={opacity:0},MLt={stroke:"#C5C5C5",strokeOpacity:.85},ILt={fill:"#CACED4",opacity:.85};function LLt(r,t,e,i){var n=[],a=!!i,o,s,l,u,c,h,f;if(a){l=i[0],u=i[1];for(var d=0,v=r.length;d<v;d+=1){var p=r[d];l=Pr([0,0],l,p),u=Fr([0,0],u,p)}}for(var d=0,g=r.length;d<g;d+=1){var p=r[d];if(d===0&&!e)f=p;else if(d===g-1&&!e)h=p,n.push(f),n.push(h);else{var m=[d?d-1:g-1,d-1][e?0:1];o=r[m],s=r[e?(d+1)%g:d+1];var y=[0,0];y=Io(y,s,o),y=_i(y,y,t);var _=_c(p,o),x=_c(p,s),C=_+x;C!==0&&(_/=C,x/=C);var A=_i([0,0],y,-_),T=_i([0,0],y,x);h=ri([0,0],p,A),c=ri([0,0],p,T),c=Pr([0,0],c,Fr([0,0],s,p)),c=Fr([0,0],c,Pr([0,0],s,p)),A=Io([0,0],c,p),A=_i([0,0],A,-_/x),h=ri([0,0],p,A),h=Pr([0,0],h,Fr([0,0],o,p)),h=Fr([0,0],h,Pr([0,0],o,p)),T=Io([0,0],p,h),T=_i([0,0],T,x/_),c=ri([0,0],p,T),a&&(h=Fr([0,0],h,l),h=Pr([0,0],h,u),c=Fr([0,0],c,l),c=Pr([0,0],c,u)),n.push(f),n.push(h),f=c}}return e&&n.push(n.shift()),n}function OLt(r,t,e){t===void 0&&(t=!1),e===void 0&&(e=[[0,0],[1,1]]);for(var i=!!t,n=[],a=0,o=r.length;a<o;a+=2)n.push([r[a],r[a+1]]);for(var s=LLt(n,.4,i,e),l=n.length,u=[],c,h,f,a=0;a<l-1;a+=1)c=s[a*2],h=s[a*2+1],f=n[a+1],u.push(["C",c[0],c[1],h[0],h[1],f[0],f[1]]);return i&&(c=s[l],h=s[l+1],f=n[0],u.push(["C",c[0],c[1],h[0],h[1],f[0],f[1]])),u}function PLt(r){return Ne(r,function(t,e){var i=e===0?"M":"L",n=t[0],a=t[1];return[i,n,a]})}function K8(r){return PLt(r)}function FLt(r){if(r.length<=2)return K8(r);var t=[];R(r,function(o){Jt(o,t.slice(t.length-2))||t.push(o[0],o[1])});var e=OLt(t,!1),i=un(r),n=i[0],a=i[1];return e.unshift(["M",n,a]),e}function BLt(r,t,e,i){i===void 0&&(i=!0);var n=new ny({values:r}),a=new ry({values:Ne(r,function(s,l){return l})}),o=Ne(r,function(s,l){return[a.scale(l)*t,e-n.scale(s)*e]});return i?FLt(o):K8(o)}function DLt(r,t){var e=new ny({values:r}),i=e.max<0?e.max:Math.max(0,e.min);return t-e.scale(i)*t}function NLt(r,t,e,i){var n=kf(r),a=DLt(i,e);return n.push(["L",t,a]),n.push(["L",0,a]),n.push(["Z"]),n}var kLt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"trend",x:0,y:0,width:200,height:16,smooth:!0,isArea:!1,data:[],backgroundStyle:RLt,lineStyle:MLt,areaStyle:ILt})},t.prototype.renderInner=function(e){var i=this.cfg,n=i.width,a=i.height,o=i.data,s=i.smooth,l=i.isArea,u=i.backgroundStyle,c=i.lineStyle,h=i.areaStyle;this.addShape(e,{id:this.getElementId("background"),type:"rect",attrs:S({x:0,y:0,width:n,height:a},u)});var f=BLt(o,n,a,s);if(this.addShape(e,{id:this.getElementId("line"),type:"path",attrs:S({path:f},c)}),l){var d=NLt(f,n,a,o);this.addShape(e,{id:this.getElementId("area"),type:"path",attrs:S({path:d},h)})}},t.prototype.applyOffset=function(){var e=this.cfg,i=e.x,n=e.y;this.moveElementTo(this.get("group"),{x:i,y:n})},t}(Jr),Q8={fill:"#F7F7F7",stroke:"#BFBFBF",radius:2,opacity:1,cursor:"ew-resize",highLightFill:"#FFF"},$L=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"handler",x:0,y:0,width:10,height:24,style:Q8})},t.prototype.renderInner=function(e){var i=this.cfg,n=i.width,a=i.height,o=i.style,s=o.fill,l=o.stroke,u=o.radius,c=o.opacity,h=o.cursor;this.addShape(e,{type:"rect",id:this.getElementId("background"),attrs:{x:0,y:0,width:n,height:a,fill:s,stroke:l,radius:u,opacity:c,cursor:h}});var f=1/3*n,d=2/3*n,v=1/4*a,p=3/4*a;this.addShape(e,{id:this.getElementId("line-left"),type:"line",attrs:{x1:f,y1:v,x2:f,y2:p,stroke:l,cursor:h}}),this.addShape(e,{id:this.getElementId("line-right"),type:"line",attrs:{x1:d,y1:v,x2:d,y2:p,stroke:l,cursor:h}})},t.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},t.prototype.initEvent=function(){this.bindEvents()},t.prototype.bindEvents=function(){var e=this;this.get("group").on("mouseenter",function(){var i=e.get("style").highLightFill;e.getElementByLocalId("background").attr("fill",i),e.draw()}),this.get("group").on("mouseleave",function(){var i=e.get("style").fill;e.getElementByLocalId("background").attr("fill",i),e.draw()})},t.prototype.draw=function(){var e=this.get("container").get("canvas");e&&e.draw()},t}(Jr),ULt={fill:"#416180",opacity:.05},zLt={fill:"#5B8FF9",opacity:.15,cursor:"move"},ug=10,HLt={width:ug,height:24},$Lt={textBaseline:"middle",fill:"#000",opacity:.45},WLt="sliderchange",VLt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.onMouseDown=function(i){return function(n){e.currentTarget=i;var a=n.originalEvent;a.stopPropagation(),a.preventDefault(),e.prevX=L(a,"touches.0.pageX",a.pageX),e.prevY=L(a,"touches.0.pageY",a.pageY);var o=e.getContainerDOM();o.addEventListener("mousemove",e.onMouseMove),o.addEventListener("mouseup",e.onMouseUp),o.addEventListener("mouseleave",e.onMouseUp),o.addEventListener("touchmove",e.onMouseMove),o.addEventListener("touchend",e.onMouseUp),o.addEventListener("touchcancel",e.onMouseUp)}},e.onMouseMove=function(i){var n=e.cfg.width,a=[e.get("start"),e.get("end")];i.stopPropagation(),i.preventDefault();var o=L(i,"touches.0.pageX",i.pageX),s=L(i,"touches.0.pageY",i.pageY),l=o-e.prevX,u=e.adjustOffsetRange(l/n);e.updateStartEnd(u),e.updateUI(e.getElementByLocalId("foreground"),e.getElementByLocalId("minText"),e.getElementByLocalId("maxText")),e.prevX=o,e.prevY=s,e.draw(),e.emit(WLt,[e.get("start"),e.get("end")].sort()),e.delegateEmit("valuechanged",{originValue:a,value:[e.get("start"),e.get("end")]})},e.onMouseUp=function(){e.currentTarget&&(e.currentTarget=void 0);var i=e.getContainerDOM();i&&(i.removeEventListener("mousemove",e.onMouseMove),i.removeEventListener("mouseup",e.onMouseUp),i.removeEventListener("mouseleave",e.onMouseUp),i.removeEventListener("touchmove",e.onMouseMove),i.removeEventListener("touchend",e.onMouseUp),i.removeEventListener("touchcancel",e.onMouseUp))},e}return t.prototype.setRange=function(e,i){this.set("minLimit",e),this.set("maxLimit",i);var n=this.get("start"),a=this.get("end"),o=Be(n,e,i),s=Be(a,e,i);!this.get("isInit")&&(n!==o||a!==s)&&this.setValue([o,s])},t.prototype.getRange=function(){return{min:this.get("minLimit")||0,max:this.get("maxLimit")||1}},t.prototype.setValue=function(e){var i=this.getRange();if(Z(e)&&e.length===2){var n=[this.get("start"),this.get("end")];this.update({start:Be(e[0],i.min,i.max),end:Be(e[1],i.min,i.max)}),this.get("updateAutoRender")||this.render(),this.delegateEmit("valuechanged",{originValue:n,value:e})}},t.prototype.getValue=function(){return[this.get("start"),this.get("end")]},t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"slider",x:0,y:0,width:100,height:16,backgroundStyle:{},foregroundStyle:{},handlerStyle:{},textStyle:{},defaultCfg:{backgroundStyle:ULt,foregroundStyle:zLt,handlerStyle:HLt,textStyle:$Lt}})},t.prototype.update=function(e){var i=e.start,n=e.end,a=S({},e);j(i)||(a.start=Be(i,0,1)),j(n)||(a.end=Be(n,0,1)),r.prototype.update.call(this,a),this.minHandler=this.getChildComponentById(this.getElementId("minHandler")),this.maxHandler=this.getChildComponentById(this.getElementId("maxHandler")),this.trend=this.getChildComponentById(this.getElementId("trend"))},t.prototype.init=function(){this.set("start",Be(this.get("start"),0,1)),this.set("end",Be(this.get("end"),0,1)),r.prototype.init.call(this)},t.prototype.render=function(){r.prototype.render.call(this),this.updateUI(this.getElementByLocalId("foreground"),this.getElementByLocalId("minText"),this.getElementByLocalId("maxText"))},t.prototype.renderInner=function(e){var i=this.cfg;i.start,i.end;var n=i.width,a=i.height,o=i.trendCfg,s=o===void 0?{}:o,l=i.minText,u=i.maxText,c=i.backgroundStyle,h=c===void 0?{}:c,f=i.foregroundStyle,d=f===void 0?{}:f,v=i.textStyle,p=v===void 0?{}:v,g=nt({},Q8,this.cfg.handlerStyle);Tr(L(s,"data"))&&(this.trend=this.addComponent(e,S({component:kLt,id:this.getElementId("trend"),x:0,y:0,width:n,height:a},s))),this.addShape(e,{id:this.getElementId("background"),type:"rect",attrs:S({x:0,y:0,width:n,height:a},h)}),this.addShape(e,{id:this.getElementId("minText"),type:"text",attrs:S({y:a/2,textAlign:"right",text:l,silent:!1},p)}),this.addShape(e,{id:this.getElementId("maxText"),type:"text",attrs:S({y:a/2,textAlign:"left",text:u,silent:!1},p)}),this.addShape(e,{id:this.getElementId("foreground"),name:"foreground",type:"rect",attrs:S({y:0,height:a},d)});var m=L(g,"width",ug),y=L(g,"height",24);this.minHandler=this.addComponent(e,{component:$L,id:this.getElementId("minHandler"),name:"handler-min",x:0,y:(a-y)/2,width:m,height:y,cursor:"ew-resize",style:g}),this.maxHandler=this.addComponent(e,{component:$L,id:this.getElementId("maxHandler"),name:"handler-max",x:0,y:(a-y)/2,width:m,height:y,cursor:"ew-resize",style:g})},t.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},t.prototype.initEvent=function(){this.bindEvents()},t.prototype.updateUI=function(e,i,n){var a=this.cfg,o=a.start,s=a.end,l=a.width,u=a.minText,c=a.maxText,h=a.handlerStyle,f=a.height,d=o*l,v=s*l;this.trend&&(this.trend.update({width:l,height:f}),this.get("updateAutoRender")||this.trend.render()),e.attr("x",d),e.attr("width",v-d);var p=L(h,"width",ug);i.attr("text",u),n.attr("text",c);var g=this._dodgeText([d,v],i,n),m=g[0],y=g[1];this.minHandler&&(this.minHandler.update({x:d-p/2}),this.get("updateAutoRender")||this.minHandler.render()),R(m,function(_,x){return i.attr(x,_)}),this.maxHandler&&(this.maxHandler.update({x:v-p/2}),this.get("updateAutoRender")||this.maxHandler.render()),R(y,function(_,x){return n.attr(x,_)})},t.prototype.bindEvents=function(){var e=this.get("group");e.on("handler-min:mousedown",this.onMouseDown("minHandler")),e.on("handler-min:touchstart",this.onMouseDown("minHandler")),e.on("handler-max:mousedown",this.onMouseDown("maxHandler")),e.on("handler-max:touchstart",this.onMouseDown("maxHandler"));var i=e.findById(this.getElementId("foreground"));i.on("mousedown",this.onMouseDown("foreground")),i.on("touchstart",this.onMouseDown("foreground"))},t.prototype.adjustOffsetRange=function(e){var i=this.cfg,n=i.start,a=i.end;switch(this.currentTarget){case"minHandler":{var o=0-n,s=1-n;return Math.min(s,Math.max(o,e))}case"maxHandler":{var o=0-a,s=1-a;return Math.min(s,Math.max(o,e))}case"foreground":{var o=0-n,s=1-a;return Math.min(s,Math.max(o,e))}}},t.prototype.updateStartEnd=function(e){var i=this.cfg,n=i.start,a=i.end;switch(this.currentTarget){case"minHandler":n+=e;break;case"maxHandler":a+=e;break;case"foreground":n+=e,a+=e;break}this.set("start",n),this.set("end",a)},t.prototype._dodgeText=function(e,i,n){var a,o,s=this.cfg,l=s.handlerStyle,u=s.width,c=2,h=L(l,"width",ug),f=e[0],d=e[1],v=!1;f>d&&(a=[d,f],f=a[0],d=a[1],o=[n,i],i=o[0],n=o[1],v=!0);var p=i.getBBox(),g=n.getBBox(),m=p.width>f-c?{x:f+h/2+c,textAlign:"left"}:{x:f-h/2-c,textAlign:"right"},y=g.width>u-d-c?{x:d-h/2-c,textAlign:"right"}:{x:d+h/2+c,textAlign:"left"};return v?[y,m]:[m,y]},t.prototype.draw=function(){var e=this.get("container"),i=e&&e.get("canvas");i&&i.draw()},t.prototype.getContainerDOM=function(){var e=this.get("container"),i=e&&e.get("canvas");return i&&i.get("container")},t}(Jr),GLt={trackColor:"rgba(0,0,0,0)",thumbColor:"rgba(0,0,0,0.15)",size:8,lineCap:"round"},z_={default:GLt,hover:{thumbColor:"rgba(0,0,0,0.2)"}},XLt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.clearEvents=ms,e.onStartEvent=function(i){return function(n){e.isMobile=i,n.originalEvent.preventDefault();var a=i?L(n.originalEvent,"touches.0.clientX"):n.clientX,o=i?L(n.originalEvent,"touches.0.clientY"):n.clientY;e.startPos=e.cfg.isHorizontal?a:o,e.bindLaterEvent()}},e.bindLaterEvent=function(){var i=e.getContainerDOM(),n=[];e.isMobile?n=[Lu(i,"touchmove",e.onMouseMove),Lu(i,"touchend",e.onMouseUp),Lu(i,"touchcancel",e.onMouseUp)]:n=[Lu(i,"mousemove",e.onMouseMove),Lu(i,"mouseup",e.onMouseUp),Lu(i,"mouseleave",e.onMouseUp)],e.clearEvents=function(){n.forEach(function(a){a.remove()})}},e.onMouseMove=function(i){var n=e.cfg,a=n.isHorizontal,o=n.thumbOffset;i.preventDefault();var s=e.isMobile?L(i,"touches.0.clientX"):i.clientX,l=e.isMobile?L(i,"touches.0.clientY"):i.clientY,u=a?s:l,c=u-e.startPos;e.startPos=u,e.updateThumbOffset(o+c)},e.onMouseUp=function(i){i.preventDefault(),e.clearEvents()},e.onTrackClick=function(i){var n=e.cfg,a=n.isHorizontal,o=n.x,s=n.y,l=n.thumbLen,u=e.getContainerDOM(),c=u.getBoundingClientRect(),h=i.clientX,f=i.clientY,d=a?h-c.left-o-l/2:f-c.top-s-l/2,v=e.validateRange(d);e.updateThumbOffset(v)},e.onThumbMouseOver=function(){var i=e.cfg.theme.hover.thumbColor;e.getElementByLocalId("thumb").attr("stroke",i),e.draw()},e.onThumbMouseOut=function(){var i=e.cfg.theme.default.thumbColor;e.getElementByLocalId("thumb").attr("stroke",i),e.draw()},e}return t.prototype.setRange=function(e,i){this.set("minLimit",e),this.set("maxLimit",i);var n=this.getValue(),a=Be(n,e,i);n!==a&&!this.get("isInit")&&this.setValue(a)},t.prototype.getRange=function(){var e=this.get("minLimit")||0,i=this.get("maxLimit")||1;return{min:e,max:i}},t.prototype.setValue=function(e){var i=this.getRange(),n=this.getValue();this.update({thumbOffset:(this.get("trackLen")-this.get("thumbLen"))*Be(e,i.min,i.max)}),this.delegateEmit("valuechange",{originalValue:n,value:this.getValue()})},t.prototype.getValue=function(){return Be(this.get("thumbOffset")/(this.get("trackLen")-this.get("thumbLen")),0,1)},t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"scrollbar",isHorizontal:!0,minThumbLen:20,thumbOffset:0,theme:z_})},t.prototype.renderInner=function(e){this.renderTrackShape(e),this.renderThumbShape(e)},t.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},t.prototype.initEvent=function(){this.bindEvents()},t.prototype.renderTrackShape=function(e){var i=this.cfg,n=i.trackLen,a=i.theme,o=a===void 0?{default:{}}:a,s=nt({},z_,o).default,l=s.lineCap,u=s.trackColor,c=s.size,h=L(this.cfg,"size",c),f=this.get("isHorizontal")?{x1:0+h/2,y1:h/2,x2:n-h/2,y2:h/2,lineWidth:h,stroke:u,lineCap:l}:{x1:h/2,y1:0+h/2,x2:h/2,y2:n-h/2,lineWidth:h,stroke:u,lineCap:l};return this.addShape(e,{id:this.getElementId("track"),name:"track",type:"line",attrs:f})},t.prototype.renderThumbShape=function(e){var i=this.cfg,n=i.thumbOffset,a=i.thumbLen,o=i.theme,s=nt({},z_,o).default,l=s.size,u=s.lineCap,c=s.thumbColor,h=L(this.cfg,"size",l),f=this.get("isHorizontal")?{x1:n+h/2,y1:h/2,x2:n+a-h/2,y2:h/2,lineWidth:h,stroke:c,lineCap:u,cursor:"default"}:{x1:h/2,y1:n+h/2,x2:h/2,y2:n+a-h/2,lineWidth:h,stroke:c,lineCap:u,cursor:"default"};return this.addShape(e,{id:this.getElementId("thumb"),name:"thumb",type:"line",attrs:f})},t.prototype.bindEvents=function(){var e=this.get("group");e.on("mousedown",this.onStartEvent(!1)),e.on("mouseup",this.onMouseUp),e.on("touchstart",this.onStartEvent(!0)),e.on("touchend",this.onMouseUp);var i=e.findById(this.getElementId("track"));i.on("click",this.onTrackClick);var n=e.findById(this.getElementId("thumb"));n.on("mouseover",this.onThumbMouseOver),n.on("mouseout",this.onThumbMouseOut)},t.prototype.getContainerDOM=function(){var e=this.get("container"),i=e&&e.get("canvas");return i&&i.get("container")},t.prototype.validateRange=function(e){var i=this.cfg,n=i.thumbLen,a=i.trackLen,o=e;return e+n>a?o=a-n:e+n<n&&(o=0),o},t.prototype.draw=function(){var e=this.get("container"),i=e&&e.get("canvas");i&&i.draw()},t.prototype.updateThumbOffset=function(e){var i=this.cfg,n=i.thumbOffset,a=i.isHorizontal,o=i.thumbLen,s=i.size,l=this.validateRange(e);if(l!==n){var u=this.getElementByLocalId("thumb");a?u.attr({x1:l+s/2,x2:l+o-s/2}):u.attr({y1:l+s/2,y2:l+o-s/2}),this.emitOffsetChange(l)}},t.prototype.emitOffsetChange=function(e){var i=this.cfg,n=i.thumbOffset,a=i.trackLen,o=i.thumbLen;this.cfg.thumbOffset=e,this.emit("scrollchange",{thumbOffset:e,ratio:Be(e/(a-o),0,1)}),this.delegateEmit("valuechange",{originalValue:n,value:e})},t}(Jr),YLt=cLt,jLt=hLt,ZLt=mLt,qLt=gLt,WL=yLt,KLt=xLt,hy=wLt;function QLt(r){if(Gi(r))return null;var t=r[0].x,e=r[0].x,i=r[0].y,n=r[0].y;return R(r,function(a){t=t>a.x?a.x:t,e=e<a.x?a.x:e,i=i>a.y?a.y:i,n=n<a.y?a.y:n}),{minX:t,maxX:e,minY:i,maxY:n,centerX:(t+e)/2,centerY:(i+n)/2}}function VL(r){return Array.from(new Set(r)).length===1}function GL(r){return(Wn(r)+pn(r))/2}function sr(r,t,e,i){return{x:r+e*Math.cos(i),y:t+e*Math.sin(i)}}function bs(r,t,e,i,n,a){a===void 0&&(a=0);var o=sr(r,t,e,i),s=sr(r,t,e,n),l=sr(r,t,a,i),u=sr(r,t,a,n);if(n-i===Math.PI*2){var c=sr(r,t,e,i+Math.PI),h=sr(r,t,a,i+Math.PI),f=[["M",o.x,o.y],["A",e,e,0,1,1,c.x,c.y],["A",e,e,0,1,1,s.x,s.y],["M",l.x,l.y]];return a&&(f.push(["A",a,a,0,1,0,h.x,h.y]),f.push(["A",a,a,0,1,0,u.x,u.y])),f.push(["M",o.x,o.y]),f.push(["Z"]),f}var d=n-i<=Math.PI?0:1,v=[["M",o.x,o.y],["A",e,e,0,d,1,s.x,s.y],["L",u.x,u.y]];return a&&v.push(["A",a,a,0,d,0,l.x,l.y]),v.push(["L",o.x,o.y]),v.push(["Z"]),v}function J8(r,t,e,i,n){var a=sr(r,t,e,i),o=sr(r,t,e,n);if(Br(n-i,Math.PI*2)){var s=sr(r,t,e,i+Math.PI);return[["M",a.x,a.y],["A",e,e,0,1,1,s.x,s.y],["A",e,e,0,1,1,a.x,a.y],["A",e,e,0,1,0,s.x,s.y],["A",e,e,0,1,0,a.x,a.y],["Z"]]}var l=n-i<=Math.PI?0:1;return[["M",a.x,a.y],["A",e,e,0,l,1,o.x,o.y]]}function Sd(r,t){var e=r.points,i=QLt(e),n,a,o=t.startAngle,s=t.endAngle,l=s-o;return t.isTransposed?(n=i.maxY*l,a=i.minY*l):(n=i.maxX*l,a=i.minX*l),n+=o,a+=o,{startAngle:a,endAngle:n}}function JLt(r,t){if(Mt(r)&&Mt(t))return[r,t];if(r=r,t=t,VL(r)||VL(t))return[GL(r),GL(t)];for(var e=-1,i=0,n=0,a,o=r.length-1,s,l=0;++e<r.length;)a=o,o=e,l+=s=r[a]*t[o]-r[o]*t[a],i+=(r[a]+r[o])*s,n+=(t[a]+t[o])*s;return l*=3,[i/l,n/l]}function tk(r,t){var e=r.attr(),i=t.attr();return R(e,function(n,a){i[a]===void 0&&(i[a]=void 0)}),i}function tc(r,t,e){var i=Math.min(t,e),n=Math.max(t,e);return r>=i&&r<=n}function tOt(r,t,e){if(mt(r))return r.padEnd(t,e);if(Z(r)){var i=r.length;if(i<t)for(var n=t-i,a=0;a<n;a++)r.push(e)}return r}function Di(r,t){return typeof r=="object"&&t.forEach(function(e){delete r[e]}),r}function vs(r,t,e){var i,n;t===void 0&&(t=[]),e===void 0&&(e=new Map);try{for(var a=qt(r),o=a.next();!o.done;o=a.next()){var s=o.value;e.has(s)||(t.push(s),e.set(s,!0))}}catch(l){i={error:l}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return t}var Si=function(){function r(t,e,i,n){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=0),this.x=t,this.y=e,this.height=n,this.width=i}return r.fromRange=function(t,e,i,n){return new r(t,e,i-t,n-e)},r.fromObject=function(t){return new r(t.minX,t.minY,t.width,t.height)},Object.defineProperty(r.prototype,"minX",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxX",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minY",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxY",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tl",{get:function(){return{x:this.x,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tr",{get:function(){return{x:this.maxX,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bl",{get:function(){return{x:this.x,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"br",{get:function(){return{x:this.maxX,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return{x:this.x+this.width/2,y:this.minY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return{x:this.maxX,y:this.y+this.height/2}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return{x:this.x+this.width/2,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return{x:this.minX,y:this.y+this.height/2}},enumerable:!1,configurable:!0}),r.prototype.isEqual=function(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},r.prototype.contains=function(t){return t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.clone();return R(t,function(n){i.x=Math.min(n.x,i.x),i.y=Math.min(n.y,i.y),i.width=Math.max(n.maxX,i.maxX)-i.x,i.height=Math.max(n.maxY,i.maxY)-i.y}),i},r.prototype.merge=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.clone();return R(t,function(n){i.x=Math.max(n.x,i.x),i.y=Math.max(n.y,i.y),i.width=Math.min(n.maxX,i.maxX)-i.x,i.height=Math.min(n.maxY,i.maxY)-i.y}),i},r.prototype.cut=function(t,e){var i=t.width,n=t.height;switch(e){case it.TOP:case it.TOP_LEFT:case it.TOP_RIGHT:return r.fromRange(this.minX,this.minY+n,this.maxX,this.maxY);case it.RIGHT:case it.RIGHT_TOP:case it.RIGHT_BOTTOM:return r.fromRange(this.minX,this.minY,this.maxX-i,this.maxY);case it.BOTTOM:case it.BOTTOM_LEFT:case it.BOTTOM_RIGHT:return r.fromRange(this.minX,this.minY,this.maxX,this.maxY-n);case it.LEFT:case it.LEFT_TOP:case it.LEFT_BOTTOM:return r.fromRange(this.minX+i,this.minY,this.maxX,this.maxY);default:return this}},r.prototype.shrink=function(t){var e=lt(t,4),i=e[0],n=e[1],a=e[2],o=e[3];return new r(this.x+o,this.y+i,this.width-o-n,this.height-i-a)},r.prototype.expand=function(t){var e=lt(t,4),i=e[0],n=e[1],a=e[2],o=e[3];return new r(this.x-o,this.y-i,this.width+o+n,this.height+i+a)},r.prototype.exceed=function(t){return[Math.max(-this.minY+t.minY,0),Math.max(this.maxX-t.maxX,0),Math.max(this.maxY-t.maxY,0),Math.max(-this.minX+t.minX,0)]},r.prototype.collide=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},r.prototype.size=function(){return this.width*this.height},r.prototype.isPointIn=function(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY},r}();function eOt(r){return[[r.minX,r.minY],[r.maxX,r.minY],[r.maxX,r.maxY],[r.minX,r.maxY]]}function fv(r){if(r.isPolar&&!r.isTransposed)return(r.endAngle-r.startAngle)*r.getRadius();var t=r.convert({x:0,y:0}),e=r.convert({x:1,y:0});return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function rOt(r){if(r.isPolar){var t=r.startAngle,e=r.endAngle;return e-t===Math.PI*2}return!1}function fy(r,t){var e=r.getCenter();return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function iOt(r,t){var e=!1;if(r)if(r.type==="theta"){var i=r.start,n=r.end;e=tc(t.x,i.x,n.x)&&tc(t.y,i.y,n.y)}else{var a=r.invert(t);e=tc(a.x,0,1)&&tc(a.y,0,1)}return e}function $c(r,t){var e=r.getCenter();return Math.atan2(t.y-e.y,t.x-e.x)}function hT(r,t){t===void 0&&(t=0);var e=r.start,i=r.end,n=r.getWidth(),a=r.getHeight();if(r.isPolar){var o=r.startAngle,s=r.endAngle,l=r.getCenter(),u=r.getRadius();return{type:"path",startState:{path:bs(l.x,l.y,u+t,o,o)},endState:function(h){var f=(s-o)*h+o,d=bs(l.x,l.y,u+t,o,f);return{path:d}},attrs:{path:bs(l.x,l.y,u+t,o,s)}}}var c;return r.isTransposed?c={height:a+t*2}:c={width:n+t*2},{type:"rect",startState:{x:e.x-t,y:i.y-t,width:r.isTransposed?n+t*2:0,height:r.isTransposed?0:a+t*2},endState:c,attrs:{x:e.x-t,y:i.y-t,width:n+t*2,height:a+t*2}}}function nOt(r,t){t===void 0&&(t=0);var e=r.start,i=r.end,n=r.getWidth(),a=r.getHeight(),o=Math.min(e.x,i.x),s=Math.min(e.y,i.y);return Si.fromRange(o-t,s-t,o+n+t,s+a+t)}var aOt=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]+)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/;function oOt(r){var t="linear";return aOt.test(r)?t="timeCat":mt(r)&&(t="cat"),t}function ek(r,t,e,i){return t===void 0&&(t={}),t.type?t.type:r.type!=="identity"&&Ju.includes(e)&&["interval"].includes(i)||r.isCategory?"cat":r.type}function sOt(r,t,e){var i=t||[];if(Mt(r)||j(iit(i,r))&&Gi(e)){var n=EC("identity");return new n({field:r.toString(),values:[r]})}var a=xa(i,r),o=L(e,"type",oOt(a[0])),s=EC(o);return new s(S({field:r,values:a},e))}function lOt(r,t){if(r.type!=="identity"&&t.type!=="identity"){var e={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);r.change(e)}}function Ad(r){return r.alias||r.field}function rk(r,t,e){var i=r.values,n=i.length,a;if(n===1)a=[.5,1];else{var o=1,s=0;rOt(t)?t.isTransposed?(o=L(e,"widthRatio.multiplePie",1/1.3),s=1/n*o,a=[s/2,1-s/2]):a=[0,1-1/n]:(s=1/n/2,a=[s,1-s])}return a}function uOt(r){var t=r.values.filter(function(e){return!j(e)&&!isNaN(e)});return Math.max.apply(Math,_t(_t([],lt(t),!1),[j(r.max)?-1/0:r.max],!1))}function cOt(r){var t,e;switch(r){case it.TOP:t={x:0,y:1},e={x:1,y:1};break;case it.RIGHT:t={x:1,y:0},e={x:1,y:1};break;case it.BOTTOM:t={x:0,y:0},e={x:1,y:0};break;case it.LEFT:t={x:0,y:0},e={x:0,y:1};break;default:t=e={x:0,y:0}}return{start:t,end:e}}function hOt(r){var t,e;return r.isTransposed?(t={x:0,y:0},e={x:1,y:0}):(t={x:0,y:0},e={x:0,y:1}),{start:t,end:e}}function Ap(r,t){var e={start:{x:0,y:0},end:{x:0,y:0}};r.isRect?e=cOt(t):r.isPolar&&(e=hOt(r));var i=e.start,n=e.end;return{start:r.convert(i),end:r.convert(n)}}function ik(r){var t=r.start,e=r.end;return t.x===e.x}function XL(r,t){var e=r.start,i=r.end,n=ik(r);return n?(e.y-i.y)*(t.x-e.x)>0?1:-1:(i.x-e.x)*(e.y-t.y)>0?-1:1}function Tp(r,t){var e=L(r,["components","axis"],{});return nt({},L(e,["common"],{}),nt({},L(e,[t],{})))}function YL(r,t,e){var i=L(r,["components","axis"],{});return nt({},L(i,["common","title"],{}),nt({},L(i,[t,"title"],{})),e)}function H_(r){var t=r.x,e=r.y,i=r.circleCenter,n=e.start>e.end,a=r.isTransposed?r.convert({x:n?0:1,y:0}):r.convert({x:0,y:n?0:1}),o=[a.x-i.x,a.y-i.y],s=[1,0],l=a.y>i.y?l1(o,s):l1(o,s)*-1,u=l+(t.end-t.start),c=Math.sqrt(Math.pow(a.x-i.x,2)+Math.pow(a.y-i.y,2));return{center:i,radius:c,startAngle:l,endAngle:u}}function w0(r,t){return Rs(r)?r===!1?!1:{}:L(r,[t])}function jL(r,t){return L(r,"position",t)}function ZL(r,t){return L(t,["title","text"],Ad(r))}var dh=function(){function r(t,e){this.destroyed=!1,this.facets=[],this.view=t,this.cfg=nt({},this.getDefaultCfg(),e)}return r.prototype.init=function(){this.container||(this.container=this.createContainer());var t=this.view.getData();this.facets=this.generateFacets(t)},r.prototype.render=function(){this.renderViews()},r.prototype.update=function(){},r.prototype.clear=function(){this.clearFacetViews()},r.prototype.destroy=function(){this.clear(),this.container&&(this.container.remove(!0),this.container=void 0),this.destroyed=!0,this.view=void 0,this.facets=[]},r.prototype.facetToView=function(t){var e=t.region,i=t.data,n=t.padding,a=n===void 0?this.cfg.padding:n,o=this.view.createView({region:e,padding:a});o.data(i||[]),t.view=o,this.beforeEachView(o,t);var s=this.cfg.eachView;return s&&s(o,t),this.afterEachView(o,t),o},r.prototype.createContainer=function(){var t=this.view.getLayer(rr.FORE);return t.addGroup()},r.prototype.renderViews=function(){this.createFacetViews()},r.prototype.createFacetViews=function(){var t=this;return this.facets.map(function(e){return t.facetToView(e)})},r.prototype.clearFacetViews=function(){var t=this;R(this.facets,function(e){e.view&&(t.view.removeView(e.view),e.view=void 0)})},r.prototype.parseSpacing=function(){var t=this.view.viewBBox,e=t.width,i=t.height,n=this.cfg.spacing;return n.map(function(a,o){return Mt(a)?a/(o===0?e:i):parseFloat(a)/100})},r.prototype.getFieldValues=function(t,e){var i=[],n={};return R(t,function(a){var o=a[e];!j(o)&&!n[o]&&(i.push(o),n[o]=!0)}),i},r.prototype.getRegion=function(t,e,i,n){var a=lt(this.parseSpacing(),2),o=a[0],s=a[1],l=(1+o)/(e===0?1:e)-o,u=(1+s)/(t===0?1:t)-s,c={x:(l+o)*i,y:(u+s)*n},h={x:c.x+l,y:c.y+u};return{start:c,end:h}},r.prototype.getDefaultCfg=function(){return{eachView:void 0,showTitle:!0,spacing:[0,0],padding:10,fields:[]}},r.prototype.getDefaultTitleCfg=function(){var t=this.view.getTheme().fontFamily;return{style:{fontSize:14,fill:"#666",fontFamily:t}}},r.prototype.processAxis=function(t,e){var i=t.getOptions(),n=i.coordinate,a=t.geometries,o=L(n,"type","rect");if(o==="rect"&&a.length){j(i.axes)&&(i.axes={});var s=i.axes,l=lt(a[0].getXYFields(),2),u=l[0],c=l[1],h=w0(s,u),f=w0(s,c);h!==!1&&(i.axes[u]=this.getXAxisOption(u,s,h,e)),f!==!1&&(i.axes[c]=this.getYAxisOption(c,s,f,e))}},r.prototype.getFacetDataFilter=function(t){return function(e){return DE(t,function(i){var n=i.field,a=i.value;return!j(a)&&n?e[n]===a:!0})}},r}(),nk={},fOt=function(r){return nk[hu(r)]},vh=function(r,t){nk[hu(r)]=t},Fe=function(){function r(t,e){this.context=t,this.cfg=e,t.addAction(this)}return r.prototype.applyCfg=function(t){ye(this,t)},r.prototype.init=function(){this.applyCfg(this.cfg)},r.prototype.destroy=function(){this.context.removeAction(this),this.context=null},r}(),dOt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.execute=function(){this.callback&&this.callback(this.context)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.callback=null},t}(Fe),fT={};function vOt(r,t){var e=fT[r],i=null;if(e){var n=e.ActionClass,a=e.cfg;i=new n(t,a),i.name=r,i.init()}return i}function dy(r){var t=fT[r];return L(t,"ActionClass")}function xt(r,t,e){fT[r]={ActionClass:t,cfg:e}}function pOt(r,t){var e=new dOt(t);return e.callback=r,e.name="callback",e}function gOt(r,t){var e=[];if(r.length){e.push(["M",r[0].x,r[0].y]);for(var i=1,n=r.length;i<n;i+=1){var a=r[i];e.push(["L",a.x,a.y])}t&&e.push(["Z"])}return e}function RC(r,t){for(var e=[r[0]],i=1,n=r.length;i<n;i=i+2){var a=t.convert({x:r[i],y:r[i+1]});e.push(a.x,a.y)}return e}function ak(r,t){var e=t.isTransposed,i=r[1],n=r[6],a=r[7],o=t.convert({x:n,y:a}),s=e?0:1;return["A",i,i,0,0,s,o.x,o.y]}function mOt(r,t,e){var i=e.isTransposed,n=e.startAngle,a=e.endAngle,o=r[0].toLowerCase()==="a"?{x:r[6],y:r[7]}:{x:r[1],y:r[2]},s={x:t[1],y:t[2]},l=[],u=i?"y":"x",c=Math.abs(s[u]-o[u])*(a-n),h=s[u]>=o[u]?1:0,f=c>Math.PI?1:0,d=e.convert(s),v=fy(e,d);if(v>=.5)if(c===Math.PI*2){var p={x:(s.x+o.x)/2,y:(s.y+o.y)/2},g=e.convert(p);l.push(["A",v,v,0,f,h,g.x,g.y]),l.push(["A",v,v,0,f,h,d.x,d.y])}else l.push(["A",v,v,0,f,h,d.x,d.y]);return l}function yOt(r){R(r,function(t,e){var i=t;if(i[0].toLowerCase()==="a"){var n=r[e-1],a=r[e+1];a&&a[0].toLowerCase()==="a"?n&&n[0].toLowerCase()==="l"&&(n[0]="M"):n&&n[0].toLowerCase()==="a"&&a&&a[0].toLowerCase()==="l"&&(a[0]="M")}})}var _Ot=function(r,t,e,i){var n,a=[],o=!!i,s,l,u,c,h,f,d;if(o){n=lt(i,2),u=n[0],c=n[1];for(var v=0,p=r.length;v<p;v++){var g=r[v];u=Pr([0,0],u,g),c=Fr([0,0],c,g)}}for(var v=0,m=r.length;v<m;v++){var g=r[v];if(v===0&&!e)d=g;else if(v===m-1&&!e)f=g,a.push(d),a.push(f);else{s=r[e?v?v-1:m-1:v-1],l=r[e?(v+1)%m:v+1];var y=[0,0];y=Io(y,l,s),y=_i(y,y,t);var _=_c(g,s),x=_c(g,l),C=_+x;C!==0&&(_/=C,x/=C);var A=_i([0,0],y,-_),T=_i([0,0],y,x);f=ri([0,0],g,A),h=ri([0,0],g,T),h=Pr([0,0],h,Fr([0,0],l,g)),h=Fr([0,0],h,Pr([0,0],l,g)),A=Io([0,0],h,g),A=_i([0,0],A,-_/x),f=ri([0,0],g,A),f=Pr([0,0],f,Fr([0,0],s,g)),f=Fr([0,0],f,Pr([0,0],s,g)),T=Io([0,0],g,f),T=_i([0,0],T,x/_),h=ri([0,0],g,T),o&&(f=Fr([0,0],f,u),f=Pr([0,0],f,c),h=Fr([0,0],h,u),h=Pr([0,0],h,c)),a.push(d),a.push(f),d=h}}return e&&a.push(a.shift()),a};function ok(r,t,e){for(var i=!!t,n=[],a=0,o=r.length;a<o;a+=2)n.push([r[a],r[a+1]]);for(var s=_Ot(n,.4,i,e),l=n.length,u=[],c,h,f,a=0;a<l-1;a++)c=s[a*2],h=s[a*2+1],f=n[a+1],u.push(["C",c[0],c[1],h[0],h[1],f[0],f[1]]);return i&&(c=s[l],h=s[l+1],f=n[0],u.push(["C",c[0],c[1],h[0],h[1],f[0],f[1]])),u}function dv(r,t){return gOt(r,t)}function R0(r,t,e){var i=[],n=r[0],a=null;if(r.length<=2)return dv(r,t);for(var o=0,s=r.length;o<s;o++){var l=r[o];(!a||!(a.x===l.x&&a.y===l.y))&&(i.push(l.x),i.push(l.y),a=l)}var u=e||[[0,0],[1,1]],c=ok(i,t,u);return c.unshift(["M",n.x,n.y]),c}function xOt(r,t){var e=[];return R(t,function(i){var n=i[0];switch(n.toLowerCase()){case"m":case"l":case"c":e.push(RC(i,r));break;case"a":e.push(ak(i,r));break;case"z":default:e.push(i);break}}),e}function COt(r,t){var e=[],i,n,a,o;return R(t,function(s,l){var u=s[0];switch(u.toLowerCase()){case"m":case"c":case"q":e.push(RC(s,r));break;case"l":i=t[l-1],n=s,a=r.isTransposed,o=a?i[i.length-2]===n[1]:i[i.length-1]===n[2],o?e=e.concat(mOt(i,n,r)):e.push(RC(s,r));break;case"a":e.push(ak(s,r));break;case"z":default:e.push(s);break}}),yOt(e),e}var Of=`	
\v\f\r   ᠎             　\u2028\u2029`,EOt=new RegExp("([a-z])["+Of+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+Of+"]*,?["+Of+"]*)+)","ig"),SOt=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+Of+"]*,?["+Of+"]*","ig");function AOt(r){if(!r)return null;if(Z(r))return r;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(r).replace(EOt,function(i,n,a){var o=[],s=n.toLowerCase();if(a.replace(SOt,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(e.push([n].concat(o.splice(0,2))),s="l",n=n==="m"?"l":"L"),s==="o"&&o.length===1&&e.push([n,o[0]]),s==="r")e.push([n].concat(o));else for(;o.length>=t[s]&&(e.push([n].concat(o.splice(0,t[s]))),!!t[s]););return""}),e}var qL=function(r,t,e){return r>=t&&r<=e};function TOt(r,t,e,i){var n=.001,a={x:e.x-r.x,y:e.y-r.y},o={x:t.x-r.x,y:t.y-r.y},s={x:i.x-e.x,y:i.y-e.y},l=o.x*s.y-o.y*s.x,u=l*l,c=o.x*o.x+o.y*o.y,h=s.x*s.x+s.y*s.y,f=null;if(u>n*c*h){var d=(a.x*s.y-a.y*s.x)/l,v=(a.x*o.y-a.y*o.x)/l;qL(d,0,1)&&qL(v,0,1)&&(f={x:r.x+d*o.x,y:r.y+d*o.y})}return f}var bOt=1e-6;function $_(r){return Math.abs(r)<bOt?0:r<0?-1:1}function wOt(r,t,e){return(e[0]-r[0])*(t[1]-r[1])===(t[0]-r[0])*(e[1]-r[1])&&Math.min(r[0],t[0])<=e[0]&&e[0]<=Math.max(r[0],t[0])&&Math.min(r[1],t[1])<=e[1]&&e[1]<=Math.max(r[1],t[1])}function KL(r,t,e){var i=!1,n=r.length;if(n<=2)return!1;for(var a=0;a<n;a++){var o=r[a],s=r[(a+1)%n];if(wOt(o,s,[t,e]))return!0;$_(o[1]-e)>0!=$_(s[1]-e)>0&&$_(t-(e-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(i=!i)}return i}function QL(r){for(var t=[],e=r.length,i=0;i<e-1;i++){var n=r[i],a=r[i+1];t.push({from:{x:n[0],y:n[1]},to:{x:a[0],y:a[1]}})}if(t.length>1){var o=r[0],s=r[e-1];t.push({from:{x:s[0],y:s[1]},to:{x:o[0],y:o[1]}})}return t}function ROt(r,t){var e=!1;return R(r,function(i){if(TOt(i.from,i.to,t.from,t.to))return e=!0,!1}),e}function JL(r){var t=r.map(function(i){return i[0]}),e=r.map(function(i){return i[1]});return{minX:Math.min.apply(null,t),maxX:Math.max.apply(null,t),minY:Math.min.apply(null,e),maxY:Math.max.apply(null,e)}}function MOt(r,t){return!(t.minX>r.maxX||t.maxX<r.minX||t.minY>r.maxY||t.maxY<r.minY)}function IOt(r,t){if(r.length<2||t.length<2)return!1;var e=JL(r),i=JL(t);if(!MOt(e,i))return!1;var n=!1;if(R(t,function(l){if(KL(r,l[0],l[1]))return n=!0,!1}),n||(R(r,function(l){if(KL(t,l[0],l[1]))return n=!0,!1}),n))return!0;var a=QL(r),o=QL(t),s=!1;return R(o,function(l){if(ROt(a,l))return s=!0,!1}),s}function sk(r,t){var e=r.event,i=e.target;return uk(i,t)}function lk(r,t){var e=r.getCanvasBBox(),i=e.width,n=e.height;return i>0&&n>0&&(i>=t||n>=t)}function uk(r,t){var e=r.getCanvasBBox();return lk(r,t)?e:null}function ck(r,t){var e=r.event.maskShapes;return e.map(function(i){return uk(i,t)}).filter(function(i){return!!i})}function LOt(r,t){var e=r.event,i=e.target;return hk(i,t)}function hk(r,t){return lk(r,t)?r.attr("path"):null}function OOt(r,t){var e=r.event.maskShapes;return e.map(function(i){return hk(i,t)})}function Ns(r){var t=r.event,e,i=t.target;return i&&(e=i.get("element")),e}function nu(r){var t=r.event,e=t.target,i;return e&&(i=e.get("delegateObject")),i}function fk(r){var t=r.event.gEvent;return!(t&&t.fromShape&&t.toShape&&t.fromShape.get("element")===t.toShape.get("element"))}function Td(r){return r&&r.component&&r.component.isList()}function dk(r){return r&&r.component&&r.component.isSlider()}function bd(r){var t=r.event,e=t.target;return e&&(e==null?void 0:e.get("name"))==="mask"||vy(r)}function vy(r){var t;return((t=r.event.target)===null||t===void 0?void 0:t.get("name"))==="multi-mask"}function dT(r,t){var e=r.event.target;if(vy(r))return POt(r,t);if(e.get("type")==="path"){var i=LOt(r,t);return i?mk(r.view,i):void 0}var n=sk(r,t);return n?py(r.view,n):null}function POt(r,t){var e=r.event.target;if(e.get("type")==="path"){var i=OOt(r,t);return i.length>0?i.flatMap(function(a){return mk(r.view,a)}):null}var n=ck(r,t);return n.length>0?n.flatMap(function(a){return py(r.view,a)}):null}function vk(r,t,e){if(vy(r))return FOt(r,t,e);var i=sk(r,e);return i?pk(i,r,t):null}function pk(r,t,e){var i=t.view,n=MC(i,e,{x:r.x,y:r.y}),a=MC(i,e,{x:r.maxX,y:r.maxY}),o={minX:n.x,minY:n.y,maxX:a.x,maxY:a.y};return py(e,o)}function FOt(r,t,e){var i=ck(r,e);return i.length>0?i.flatMap(function(n){return pk(n,r,t)}):null}function kr(r){var t=r.geometries,e=[];return R(t,function(i){var n=i.elements;e=e.concat(n)}),r.views&&r.views.length&&R(r.views,function(i){e=e.concat(kr(i))}),e}function BOt(r,t,e){var i=kr(r);return i.filter(function(n){return Aa(n,t)===e})}function gk(r,t){var e=r.geometries,i=[];return R(e,function(n){var a=n.getElementsBy(function(o){return o.hasState(t)});i=i.concat(a)}),i}function Aa(r,t){var e=r.getModel(),i=e.data,n;return Z(i)?n=i[0][t]:n=i[t],n}function DOt(r,t){return!(t.minX>r.maxX||t.maxX<r.minX||t.minY>r.maxY||t.maxY<r.minY)}function py(r,t){var e=kr(r),i=[];return R(e,function(n){var a=n.shape,o=a.getCanvasBBox();DOt(t,o)&&i.push(n)}),i}function tO(r){var t=[];return R(r,function(e){var i=e[0];if(i!=="A")for(var n=1;n<e.length;n=n+2)t.push([e[n],e[n+1]]);else{var a=e.length;t.push([e[a-2],e[a-1]])}}),t}function mk(r,t){var e=kr(r),i=tO(t),n=e.filter(function(a){var o=a.shape,s;if(o.get("type")==="path")s=tO(o.attr("path"));else{var l=o.getCanvasBBox();s=eOt(l)}return IOt(i,s)});return n}function yk(r){return r.getComponents().map(function(t){return t.component})}function vT(r,t){var e=t.x-r.x,i=t.y-r.y;return Math.sqrt(e*e+i*i)}function NOt(r,t){if(r.length<=2)return dv(r,!1);var e=r[0],i=[];R(r,function(a){i.push(a.x),i.push(a.y)});var n=ok(i,t,null);return n.unshift(["M",e.x,e.y]),n}function eO(r,t){return r.x<=t.x&&r.maxX>=t.x&&r.y<=t.y&&r.maxY>t.y}function Za(r){var t=r.parent,e=null;return t&&(e=t.views.filter(function(i){return i!==r})),e}function kOt(r,t){var e=r.getCoordinate();return e.invert(t)}function MC(r,t,e){var i=kOt(r,e);return t.getCoordinate().convert(i)}function _k(r,t,e,i){var n=!1;return R(r,function(a){if(a[e]===t[e]&&a[i]===t[i])return n=!0,!1}),n}function Wc(r,t){var e=r.getScaleByField(t);return!e&&r.views&&R(r.views,function(i){if(e=Wc(i,t),e)return!1}),e}var UOt=function(){function r(t){this.actions=[],this.event=null,this.cacheMap={},this.view=t}return r.prototype.cache=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t.length===1)return this.cacheMap[t[0]];t.length===2&&(this.cacheMap[t[0]]=t[1])},r.prototype.getAction=function(t){return this.actions.find(function(e){return e.name===t})},r.prototype.addAction=function(t){this.actions.push(t)},r.prototype.removeAction=function(t){var e=this.actions,i=this.actions.indexOf(t);i>=0&&e.splice(i,1)},r.prototype.getCurrentPoint=function(){var t=this.event;if(t)if(t.target instanceof HTMLElement){var e=this.view.getCanvas(),i=e.getPointByClient(t.clientX,t.clientY);return i}else return{x:t.x,y:t.y};return null},r.prototype.getCurrentShape=function(){return L(this.event,["gEvent","shape"])},r.prototype.isInPlot=function(){var t=this.getCurrentPoint();return t?this.view.isPointInPlot(t):!1},r.prototype.isInShape=function(t){var e=this.getCurrentShape();return e?e.get("name")===t:!1},r.prototype.isInComponent=function(t){var e=yk(this.view),i=this.getCurrentPoint();return i?!!e.find(function(n){var a=n.getBBox();return t?n.get("name")===t&&eO(a,i):eO(a,i)}):!1},r.prototype.destroy=function(){R(this.actions.slice(),function(t){t.destroy()}),this.view=null,this.event=null,this.actions=null,this.cacheMap=null},r}(),zOt=function(){function r(t,e){this.view=t,this.cfg=e}return r.prototype.init=function(){this.initEvents()},r.prototype.initEvents=function(){},r.prototype.clearEvents=function(){},r.prototype.destroy=function(){this.clearEvents()},r}();function rO(r,t,e){var i=r.split(":"),n=i[0],a=t.getAction(n)||vOt(n,t);if(!a)throw new Error("There is no action named ".concat(n));var o=i[1];return{action:a,methodName:o,arg:e}}function iO(r){var t=r.action,e=r.methodName,i=r.arg;if(t[e])t[e](i);else throw new Error("Action(".concat(t.name,") doesn't have a method called ").concat(e))}var rn={START:"start",SHOW_ENABLE:"showEnable",END:"end",ROLLBACK:"rollback",PROCESSING:"processing"},HOt=function(r){B(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.callbackCaches={},n.emitCaches={},n.steps=i,n}return t.prototype.init=function(){this.initContext(),r.prototype.init.call(this)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.steps=null,this.context&&(this.context.destroy(),this.context=null),this.callbackCaches=null,this.view=null},t.prototype.initEvents=function(){var e=this;R(this.steps,function(i,n){R(i,function(a){var o=e.getActionCallback(n,a);o&&e.bindEvent(a.trigger,o)})})},t.prototype.clearEvents=function(){var e=this;R(this.steps,function(i,n){R(i,function(a){var o=e.getActionCallback(n,a);o&&e.offEvent(a.trigger,o)})})},t.prototype.initContext=function(){var e=this.view,i=new UOt(e);this.context=i;var n=this.steps;R(n,function(a){R(a,function(o){if(ut(o.action))o.actionObject={action:pOt(o.action,i),methodName:"execute"};else if(mt(o.action))o.actionObject=rO(o.action,i,o.arg);else if(Z(o.action)){var s=o.action,l=Z(o.arg)?o.arg:[o.arg];o.actionObject=[],R(s,function(u,c){o.actionObject.push(rO(u,i,l[c]))})}})})},t.prototype.isAllowStep=function(e){var i=this.currentStepName,n=this.steps;if(i===e||e===rn.SHOW_ENABLE)return!0;if(e===rn.PROCESSING)return i===rn.START;if(e===rn.START)return i!==rn.PROCESSING;if(e===rn.END)return i===rn.PROCESSING||i===rn.START;if(e===rn.ROLLBACK){if(n[rn.END])return i===rn.END;if(i===rn.START)return!0}return!1},t.prototype.isAllowExecute=function(e,i){if(this.isAllowStep(e)){var n=this.getKey(e,i);return i.once&&this.emitCaches[n]?!1:i.isEnable?i.isEnable(this.context):!0}return!1},t.prototype.enterStep=function(e){this.currentStepName=e,this.emitCaches={}},t.prototype.afterExecute=function(e,i){e!==rn.SHOW_ENABLE&&this.currentStepName!==e&&this.enterStep(e);var n=this.getKey(e,i);this.emitCaches[n]=!0},t.prototype.getKey=function(e,i){return e+i.trigger+i.action},t.prototype.getActionCallback=function(e,i){var n=this,a=this.context,o=this.callbackCaches,s=i.actionObject;if(i.action&&s){var l=this.getKey(e,i);if(!o[l]){var u=function(c){a.event=c,n.isAllowExecute(e,i)?(Z(s)?R(s,function(h){a.event=c,iO(h)}):(a.event=c,iO(s)),n.afterExecute(e,i),i.callback&&(a.event=c,i.callback(a))):a.event=null};i.debounce?o[l]=WB(u,i.debounce.wait,i.debounce.immediate):i.throttle?o[l]=NE(u,i.throttle.wait,{leading:i.throttle.leading,trailing:i.throttle.trailing}):o[l]=u}return o[l]}return null},t.prototype.bindEvent=function(e,i){var n=e.split(":");n[0]==="window"?window.addEventListener(n[1],i):n[0]==="document"?document.addEventListener(n[1],i):this.view.on(e,i)},t.prototype.offEvent=function(e,i){var n=e.split(":");n[0]==="window"?window.removeEventListener(n[1],i):n[0]==="document"?document.removeEventListener(n[1],i):this.view.off(e,i)},t}(zOt),xk={};function $Ot(r){return xk[hu(r)]}function Ot(r,t){xk[hu(r)]=t}function WOt(r,t,e){var i=$Ot(r);if(!i)return null;if(Va(i)){var n=ye(Dr(i),e);return new HOt(t,n)}else{var a=i;return new a(t,e)}}function VOt(r){return{title:{autoRotate:!0,position:"center",spacing:r.axisTitleSpacing,style:{fill:r.axisTitleTextFillColor,fontSize:r.axisTitleTextFontSize,lineHeight:r.axisTitleTextLineHeight,textBaseline:"middle",fontFamily:r.fontFamily},iconStyle:{fill:r.axisDescriptionIconFillColor}},label:{autoRotate:!1,autoEllipsis:!1,autoHide:{type:"equidistance",cfg:{minGap:6}},offset:r.axisLabelOffset,style:{fill:r.axisLabelFillColor,fontSize:r.axisLabelFontSize,lineHeight:r.axisLabelLineHeight,fontFamily:r.fontFamily}},line:{style:{lineWidth:r.axisLineBorder,stroke:r.axisLineBorderColor}},grid:{line:{type:"line",style:{stroke:r.axisGridBorderColor,lineWidth:r.axisGridBorder,lineDash:r.axisGridLineDash}},alignTick:!0,animate:!0},tickLine:{style:{lineWidth:r.axisTickLineBorder,stroke:r.axisTickLineBorderColor},alignTick:!0,length:r.axisTickLineLength},subTickLine:null,animate:!0}}function GOt(r){return{title:null,marker:{symbol:"circle",spacing:r.legendMarkerSpacing,style:{r:r.legendCircleMarkerSize,fill:r.legendMarkerColor}},itemName:{spacing:5,style:{fill:r.legendItemNameFillColor,fontFamily:r.fontFamily,fontSize:r.legendItemNameFontSize,lineHeight:r.legendItemNameLineHeight,fontWeight:r.legendItemNameFontWeight,textAlign:"start",textBaseline:"middle"}},itemStates:{active:{nameStyle:{opacity:.8}},unchecked:{nameStyle:{fill:"#D8D8D8"},markerStyle:{fill:"#D8D8D8",stroke:"#D8D8D8"}},inactive:{nameStyle:{fill:"#D8D8D8"},markerStyle:{opacity:.2}}},flipPage:!0,pageNavigator:{marker:{style:{size:r.legendPageNavigatorMarkerSize,inactiveFill:r.legendPageNavigatorMarkerInactiveFillColor,inactiveOpacity:r.legendPageNavigatorMarkerInactiveFillOpacity,fill:r.legendPageNavigatorMarkerFillColor,opacity:r.legendPageNavigatorMarkerFillOpacity}},text:{style:{fill:r.legendPageNavigatorTextFillColor,fontSize:r.legendPageNavigatorTextFontSize}}},animate:!1,maxItemWidth:200,itemSpacing:r.legendItemSpacing,itemMarginBottom:r.legendItemMarginBottom,padding:r.legendPadding}}function Ck(r){var t,e={point:{default:{fill:r.pointFillColor,r:r.pointSize,stroke:r.pointBorderColor,lineWidth:r.pointBorder,fillOpacity:r.pointFillOpacity},active:{stroke:r.pointActiveBorderColor,lineWidth:r.pointActiveBorder},selected:{stroke:r.pointSelectedBorderColor,lineWidth:r.pointSelectedBorder},inactive:{fillOpacity:r.pointInactiveFillOpacity,strokeOpacity:r.pointInactiveBorderOpacity}},hollowPoint:{default:{fill:r.hollowPointFillColor,lineWidth:r.hollowPointBorder,stroke:r.hollowPointBorderColor,strokeOpacity:r.hollowPointBorderOpacity,r:r.hollowPointSize},active:{stroke:r.hollowPointActiveBorderColor,strokeOpacity:r.hollowPointActiveBorderOpacity},selected:{lineWidth:r.hollowPointSelectedBorder,stroke:r.hollowPointSelectedBorderColor,strokeOpacity:r.hollowPointSelectedBorderOpacity},inactive:{strokeOpacity:r.hollowPointInactiveBorderOpacity}},area:{default:{fill:r.areaFillColor,fillOpacity:r.areaFillOpacity,stroke:null},active:{fillOpacity:r.areaActiveFillOpacity},selected:{fillOpacity:r.areaSelectedFillOpacity},inactive:{fillOpacity:r.areaInactiveFillOpacity}},hollowArea:{default:{fill:null,stroke:r.hollowAreaBorderColor,lineWidth:r.hollowAreaBorder,strokeOpacity:r.hollowAreaBorderOpacity},active:{fill:null,lineWidth:r.hollowAreaActiveBorder},selected:{fill:null,lineWidth:r.hollowAreaSelectedBorder},inactive:{strokeOpacity:r.hollowAreaInactiveBorderOpacity}},interval:{default:{fill:r.intervalFillColor,fillOpacity:r.intervalFillOpacity},active:{stroke:r.intervalActiveBorderColor,lineWidth:r.intervalActiveBorder},selected:{stroke:r.intervalSelectedBorderColor,lineWidth:r.intervalSelectedBorder},inactive:{fillOpacity:r.intervalInactiveFillOpacity,strokeOpacity:r.intervalInactiveBorderOpacity}},hollowInterval:{default:{fill:r.hollowIntervalFillColor,stroke:r.hollowIntervalBorderColor,lineWidth:r.hollowIntervalBorder,strokeOpacity:r.hollowIntervalBorderOpacity},active:{stroke:r.hollowIntervalActiveBorderColor,lineWidth:r.hollowIntervalActiveBorder,strokeOpacity:r.hollowIntervalActiveBorderOpacity},selected:{stroke:r.hollowIntervalSelectedBorderColor,lineWidth:r.hollowIntervalSelectedBorder,strokeOpacity:r.hollowIntervalSelectedBorderOpacity},inactive:{stroke:r.hollowIntervalInactiveBorderColor,lineWidth:r.hollowIntervalInactiveBorder,strokeOpacity:r.hollowIntervalInactiveBorderOpacity}},line:{default:{stroke:r.lineBorderColor,lineWidth:r.lineBorder,strokeOpacity:r.lineBorderOpacity,fill:null,lineAppendWidth:10,lineCap:"round",lineJoin:"round"},active:{lineWidth:r.lineActiveBorder},selected:{lineWidth:r.lineSelectedBorder},inactive:{strokeOpacity:r.lineInactiveBorderOpacity}}},i=VOt(r),n=GOt(r);return{background:r.backgroundColor,defaultColor:r.brandColor,subColor:r.subColor,semanticRed:r.paletteSemanticRed,semanticGreen:r.paletteSemanticGreen,padding:"auto",fontFamily:r.fontFamily,columnWidthRatio:1/2,maxColumnWidth:null,minColumnWidth:null,roseWidthRatio:.9999999,multiplePieWidthRatio:1/1.3,colors10:r.paletteQualitative10,colors20:r.paletteQualitative20,sequenceColors:r.paletteSequence,shapes:{point:["hollow-circle","hollow-square","hollow-bowtie","hollow-diamond","hollow-hexagon","hollow-triangle","hollow-triangle-down","circle","square","bowtie","diamond","hexagon","triangle","triangle-down","cross","tick","plus","hyphen","line"],line:["line","dash","dot","smooth"],area:["area","smooth","line","smooth-line"],interval:["rect","hollow-rect","line","tick"]},sizes:[1,10],geometries:{interval:{rect:{default:{style:e.interval.default},active:{style:e.interval.active},inactive:{style:e.interval.inactive},selected:{style:function(a){var o=a.geometry.coordinate;if(o.isPolar&&o.isTransposed){var s=Sd(a.getModel(),o),l=s.startAngle,u=s.endAngle,c=(l+u)/2,h=7.5,f=h*Math.cos(c),d=h*Math.sin(c);return{matrix:hr(null,[["t",f,d]])}}return e.interval.selected}}},"hollow-rect":{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}},line:{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}},tick:{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}},funnel:{default:{style:e.interval.default},active:{style:e.interval.active},inactive:{style:e.interval.inactive},selected:{style:e.interval.selected}},pyramid:{default:{style:e.interval.default},active:{style:e.interval.active},inactive:{style:e.interval.inactive},selected:{style:e.interval.selected}}},line:{line:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},dot:{default:{style:S(S({},e.line.default),{lineCap:null,lineDash:[1,1]})},active:{style:S(S({},e.line.active),{lineCap:null,lineDash:[1,1]})},inactive:{style:S(S({},e.line.inactive),{lineCap:null,lineDash:[1,1]})},selected:{style:S(S({},e.line.selected),{lineCap:null,lineDash:[1,1]})}},dash:{default:{style:S(S({},e.line.default),{lineCap:null,lineDash:[5.5,1]})},active:{style:S(S({},e.line.active),{lineCap:null,lineDash:[5.5,1]})},inactive:{style:S(S({},e.line.inactive),{lineCap:null,lineDash:[5.5,1]})},selected:{style:S(S({},e.line.selected),{lineCap:null,lineDash:[5.5,1]})}},smooth:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},hv:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},vh:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},hvh:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},vhv:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}}},polygon:{polygon:{default:{style:e.interval.default},active:{style:e.interval.active},inactive:{style:e.interval.inactive},selected:{style:e.interval.selected}}},point:{circle:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},square:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},bowtie:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},diamond:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},hexagon:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},triangle:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},"triangle-down":{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},"hollow-circle":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-square":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-bowtie":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-diamond":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-hexagon":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-triangle":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-triangle-down":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},cross:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},tick:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},plus:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},hyphen:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},line:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}}},area:{area:{default:{style:e.area.default},active:{style:e.area.active},inactive:{style:e.area.inactive},selected:{style:e.area.selected}},smooth:{default:{style:e.area.default},active:{style:e.area.active},inactive:{style:e.area.inactive},selected:{style:e.area.selected}},line:{default:{style:e.hollowArea.default},active:{style:e.hollowArea.active},inactive:{style:e.hollowArea.inactive},selected:{style:e.hollowArea.selected}},"smooth-line":{default:{style:e.hollowArea.default},active:{style:e.hollowArea.active},inactive:{style:e.hollowArea.inactive},selected:{style:e.hollowArea.selected}}},schema:{candle:{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}},box:{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}}},edge:{line:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},vhv:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},smooth:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},arc:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}}},violin:{violin:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},smooth:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},hollow:{default:{style:e.hollowArea.default},active:{style:e.hollowArea.active},inactive:{style:e.hollowArea.inactive},selected:{style:e.hollowArea.selected}},"hollow-smooth":{default:{style:e.hollowArea.default},active:{style:e.hollowArea.active},inactive:{style:e.hollowArea.inactive},selected:{style:e.hollowArea.selected}}}},components:{axis:{common:i,top:{position:"top",grid:null,title:null,verticalLimitLength:1/2},bottom:{position:"bottom",grid:null,title:null,verticalLimitLength:1/2},left:{position:"left",title:null,line:null,tickLine:null,verticalLimitLength:1/3},right:{position:"right",title:null,line:null,tickLine:null,verticalLimitLength:1/3},circle:{title:null,grid:nt({},i.grid,{line:{type:"line"}})},radius:{title:null,grid:nt({},i.grid,{line:{type:"circle"}})}},legend:{common:n,right:{layout:"vertical",padding:r.legendVerticalPadding},left:{layout:"vertical",padding:r.legendVerticalPadding},top:{layout:"horizontal",padding:r.legendHorizontalPadding},bottom:{layout:"horizontal",padding:r.legendHorizontalPadding},continuous:{title:null,background:null,track:{},rail:{type:"color",size:r.sliderRailHeight,defaultLength:r.sliderRailWidth,style:{fill:r.sliderRailFillColor,stroke:r.sliderRailBorderColor,lineWidth:r.sliderRailBorder}},label:{align:"rail",spacing:4,formatter:null,style:{fill:r.sliderLabelTextFillColor,fontSize:r.sliderLabelTextFontSize,lineHeight:r.sliderLabelTextLineHeight,textBaseline:"middle",fontFamily:r.fontFamily}},handler:{size:r.sliderHandlerWidth,style:{fill:r.sliderHandlerFillColor,stroke:r.sliderHandlerBorderColor}},slidable:!0,padding:n.padding}},tooltip:{showContent:!0,follow:!0,showCrosshairs:!1,showMarkers:!0,shared:!1,enterable:!1,position:"auto",marker:{symbol:"circle",stroke:"#fff",shadowBlur:10,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0,0,0,0.09)",lineWidth:2,r:4},crosshairs:{line:{style:{stroke:r.tooltipCrosshairsBorderColor,lineWidth:r.tooltipCrosshairsBorder}},text:null,textBackground:{padding:2,style:{fill:"rgba(0, 0, 0, 0.25)",lineWidth:0,stroke:null}},follow:!1},domStyles:(t={},t["".concat(Uo)]={position:"absolute",visibility:"hidden",zIndex:8,transition:"left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s",backgroundColor:r.tooltipContainerFillColor,opacity:r.tooltipContainerFillOpacity,boxShadow:r.tooltipContainerShadow,borderRadius:"".concat(r.tooltipContainerBorderRadius,"px"),color:r.tooltipTextFillColor,fontSize:"".concat(r.tooltipTextFontSize,"px"),fontFamily:r.fontFamily,lineHeight:"".concat(r.tooltipTextLineHeight,"px"),padding:"0 12px 0 12px"},t["".concat(zo)]={marginBottom:"12px",marginTop:"12px"},t["".concat(Ed)]={margin:0,listStyleType:"none",padding:0},t["".concat(ly)]={listStyleType:"none",padding:0,marginBottom:"12px",marginTop:"12px",marginLeft:0,marginRight:0},t["".concat(uy)]={width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"8px"},t["".concat(cy)]={display:"inline-block",float:"right",marginLeft:"30px"},t)},annotation:{arc:{style:{stroke:r.annotationArcBorderColor,lineWidth:r.annotationArcBorder},animate:!0},line:{style:{stroke:r.annotationLineBorderColor,lineDash:r.annotationLineDash,lineWidth:r.annotationLineBorder},text:{position:"start",autoRotate:!0,style:{fill:r.annotationTextFillColor,stroke:r.annotationTextBorderColor,lineWidth:r.annotationTextBorder,fontSize:r.annotationTextFontSize,textAlign:"start",fontFamily:r.fontFamily,textBaseline:"bottom"}},animate:!0},text:{style:{fill:r.annotationTextFillColor,stroke:r.annotationTextBorderColor,lineWidth:r.annotationTextBorder,fontSize:r.annotationTextFontSize,textBaseline:"middle",textAlign:"start",fontFamily:r.fontFamily},animate:!0},region:{top:!1,style:{lineWidth:r.annotationRegionBorder,stroke:r.annotationRegionBorderColor,fill:r.annotationRegionFillColor,fillOpacity:r.annotationRegionFillOpacity},animate:!0},image:{top:!1,animate:!0},dataMarker:{top:!0,point:{style:{r:3,stroke:r.brandColor,lineWidth:2}},line:{style:{stroke:r.annotationLineBorderColor,lineWidth:r.annotationLineBorder},length:r.annotationDataMarkerLineLength},text:{style:{textAlign:"start",fill:r.annotationTextFillColor,stroke:r.annotationTextBorderColor,lineWidth:r.annotationTextBorder,fontSize:r.annotationTextFontSize,fontFamily:r.fontFamily}},direction:"upward",autoAdjust:!0,animate:!0},dataRegion:{style:{region:{fill:r.annotationRegionFillColor,fillOpacity:r.annotationRegionFillOpacity},text:{textAlign:"center",textBaseline:"bottom",fill:r.annotationTextFillColor,stroke:r.annotationTextBorderColor,lineWidth:r.annotationTextBorder,fontSize:r.annotationTextFontSize,fontFamily:r.fontFamily}},animate:!0}},slider:{common:{padding:[8,8,8,8],backgroundStyle:{fill:r.cSliderBackgroundFillColor,opacity:r.cSliderBackgroundFillOpacity},foregroundStyle:{fill:r.cSliderForegroundFillColor,opacity:r.cSliderForegroundFillOpacity},handlerStyle:{width:r.cSliderHandlerWidth,height:r.cSliderHandlerHeight,fill:r.cSliderHandlerFillColor,opacity:r.cSliderHandlerFillOpacity,stroke:r.cSliderHandlerBorderColor,lineWidth:r.cSliderHandlerBorder,radius:r.cSliderHandlerBorderRadius,highLightFill:r.cSliderHandlerHighlightFillColor},textStyle:{fill:r.cSliderTextFillColor,opacity:r.cSliderTextFillOpacity,fontSize:r.cSliderTextFontSize,lineHeight:r.cSliderTextLineHeight,fontWeight:r.cSliderTextFontWeight,stroke:r.cSliderTextBorderColor,lineWidth:r.cSliderTextBorder}}},scrollbar:{common:{padding:[8,8,8,8]},default:{style:{trackColor:r.scrollbarTrackFillColor,thumbColor:r.scrollbarThumbFillColor}},hover:{style:{thumbColor:r.scrollbarThumbHighlightFillColor}}}},labels:{offset:12,style:{fill:r.labelFillColor,fontSize:r.labelFontSize,fontFamily:r.fontFamily,stroke:r.labelBorderColor,lineWidth:r.labelBorder},fillColorDark:r.labelFillColorDark,fillColorLight:r.labelFillColorLight,autoRotate:!0},innerLabels:{style:{fill:r.innerLabelFillColor,fontSize:r.innerLabelFontSize,fontFamily:r.fontFamily,stroke:r.innerLabelBorderColor,lineWidth:r.innerLabelBorder},autoRotate:!0},overflowLabels:{style:{fill:r.overflowLabelFillColor,fontSize:r.overflowLabelFontSize,fontFamily:r.fontFamily,stroke:r.overflowLabelBorderColor,lineWidth:r.overflowLabelBorder}},pieLabels:{labelHeight:14,offset:10,labelLine:{style:{lineWidth:r.labelLineBorder}},autoRotate:!0}}}var de={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},Fu={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},XOt=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],YOt=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],jOt=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],Ek=function(r){r===void 0&&(r={});var t=r.paletteQualitative10,e=t===void 0?XOt:t,i=r.paletteQualitative20,n=i===void 0?YOt:i,a=r.brandColor,o=a===void 0?e[0]:a,s={backgroundColor:"transparent",brandColor:o,subColor:"rgba(0,0,0,0.05)",paletteQualitative10:e,paletteQualitative20:n,paletteSemanticRed:"#F4664A",paletteSemanticGreen:"#30BF78",paletteSemanticYellow:"#FAAD14",paletteSequence:jOt,fontFamily:`"Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`,axisLineBorderColor:de[25],axisLineBorder:1,axisLineDash:null,axisTitleTextFillColor:de[65],axisTitleTextFontSize:12,axisTitleTextLineHeight:12,axisTitleTextFontWeight:"normal",axisTitleSpacing:12,axisDescriptionIconFillColor:Fu[85],axisTickLineBorderColor:de[25],axisTickLineLength:4,axisTickLineBorder:1,axisSubTickLineBorderColor:de[15],axisSubTickLineLength:2,axisSubTickLineBorder:1,axisLabelFillColor:de[45],axisLabelFontSize:12,axisLabelLineHeight:12,axisLabelFontWeight:"normal",axisLabelOffset:8,axisGridBorderColor:de[15],axisGridBorder:1,axisGridLineDash:null,legendTitleTextFillColor:de[45],legendTitleTextFontSize:12,legendTitleTextLineHeight:21,legendTitleTextFontWeight:"normal",legendMarkerColor:o,legendMarkerSpacing:8,legendMarkerSize:4,legendCircleMarkerSize:4,legendSquareMarkerSize:4,legendLineMarkerSize:5,legendItemNameFillColor:de[65],legendItemNameFontSize:12,legendItemNameLineHeight:12,legendItemNameFontWeight:"normal",legendItemSpacing:24,legendItemMarginBottom:12,legendPadding:[8,8,8,8],legendHorizontalPadding:[8,0,8,0],legendVerticalPadding:[0,8,0,8],legendPageNavigatorMarkerSize:12,legendPageNavigatorMarkerInactiveFillColor:de[100],legendPageNavigatorMarkerInactiveFillOpacity:.45,legendPageNavigatorMarkerFillColor:de[100],legendPageNavigatorMarkerFillOpacity:1,legendPageNavigatorTextFillColor:de[45],legendPageNavigatorTextFontSize:12,sliderRailFillColor:de[15],sliderRailBorder:0,sliderRailBorderColor:null,sliderRailWidth:100,sliderRailHeight:12,sliderLabelTextFillColor:de[45],sliderLabelTextFontSize:12,sliderLabelTextLineHeight:12,sliderLabelTextFontWeight:"normal",sliderHandlerFillColor:de[6],sliderHandlerWidth:10,sliderHandlerHeight:14,sliderHandlerBorder:1,sliderHandlerBorderColor:de[25],annotationArcBorderColor:de[15],annotationArcBorder:1,annotationLineBorderColor:de[25],annotationLineBorder:1,annotationLineDash:null,annotationTextFillColor:de[65],annotationTextFontSize:12,annotationTextLineHeight:12,annotationTextFontWeight:"normal",annotationTextBorderColor:null,annotationTextBorder:0,annotationRegionFillColor:de[100],annotationRegionFillOpacity:.06,annotationRegionBorder:0,annotationRegionBorderColor:null,annotationDataMarkerLineLength:16,tooltipCrosshairsBorderColor:de[25],tooltipCrosshairsBorder:1,tooltipCrosshairsLineDash:null,tooltipContainerFillColor:"rgb(255, 255, 255)",tooltipContainerFillOpacity:.95,tooltipContainerShadow:"0px 0px 10px #aeaeae",tooltipContainerBorderRadius:3,tooltipTextFillColor:de[65],tooltipTextFontSize:12,tooltipTextLineHeight:12,tooltipTextFontWeight:"bold",labelFillColor:de[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,labelLineHeight:12,labelFontWeight:"normal",labelBorderColor:null,labelBorder:0,innerLabelFillColor:Fu[100],innerLabelFontSize:12,innerLabelLineHeight:12,innerLabelFontWeight:"normal",innerLabelBorderColor:null,innerLabelBorder:0,overflowLabelFillColor:de[65],overflowLabelFontSize:12,overflowLabelLineHeight:12,overflowLabelFontWeight:"normal",overflowLabelBorderColor:Fu[100],overflowLabelBorder:1,labelLineBorder:1,labelLineBorderColor:de[25],cSliderRailHieght:16,cSliderBackgroundFillColor:"#416180",cSliderBackgroundFillOpacity:.05,cSliderForegroundFillColor:"#5B8FF9",cSliderForegroundFillOpacity:.15,cSliderHandlerHeight:24,cSliderHandlerWidth:10,cSliderHandlerFillColor:"#F7F7F7",cSliderHandlerFillOpacity:1,cSliderHandlerHighlightFillColor:"#FFF",cSliderHandlerBorderColor:"#BFBFBF",cSliderHandlerBorder:1,cSliderHandlerBorderRadius:2,cSliderTextFillColor:"#000",cSliderTextFillOpacity:.45,cSliderTextFontSize:12,cSliderTextLineHeight:12,cSliderTextFontWeight:"normal",cSliderTextBorderColor:null,cSliderTextBorder:0,scrollbarTrackFillColor:"rgba(0,0,0,0)",scrollbarThumbFillColor:"rgba(0,0,0,0.15)",scrollbarThumbHighlightFillColor:"rgba(0,0,0,0.2)",pointFillColor:o,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:Fu[100],pointBorderOpacity:1,pointActiveBorderColor:de[100],pointSelectedBorder:2,pointSelectedBorderColor:de[100],pointInactiveFillOpacity:.3,pointInactiveBorderOpacity:.3,hollowPointSize:4,hollowPointBorder:1,hollowPointBorderColor:o,hollowPointBorderOpacity:.95,hollowPointFillColor:Fu[100],hollowPointActiveBorder:1,hollowPointActiveBorderColor:de[100],hollowPointActiveBorderOpacity:1,hollowPointSelectedBorder:2,hollowPointSelectedBorderColor:de[100],hollowPointSelectedBorderOpacity:1,hollowPointInactiveBorderOpacity:.3,lineBorder:2,lineBorderColor:o,lineBorderOpacity:1,lineActiveBorder:3,lineSelectedBorder:3,lineInactiveBorderOpacity:.3,areaFillColor:o,areaFillOpacity:.25,areaActiveFillColor:o,areaActiveFillOpacity:.5,areaSelectedFillColor:o,areaSelectedFillOpacity:.5,areaInactiveFillOpacity:.3,hollowAreaBorderColor:o,hollowAreaBorder:2,hollowAreaBorderOpacity:1,hollowAreaActiveBorder:3,hollowAreaActiveBorderColor:de[100],hollowAreaSelectedBorder:3,hollowAreaSelectedBorderColor:de[100],hollowAreaInactiveBorderOpacity:.3,intervalFillColor:o,intervalFillOpacity:.95,intervalActiveBorder:1,intervalActiveBorderColor:de[100],intervalActiveBorderOpacity:1,intervalSelectedBorder:2,intervalSelectedBorderColor:de[100],intervalSelectedBorderOpacity:1,intervalInactiveBorderOpacity:.3,intervalInactiveFillOpacity:.3,hollowIntervalBorder:2,hollowIntervalBorderColor:o,hollowIntervalBorderOpacity:1,hollowIntervalFillColor:Fu[100],hollowIntervalActiveBorder:2,hollowIntervalActiveBorderColor:de[100],hollowIntervalSelectedBorder:3,hollowIntervalSelectedBorderColor:de[100],hollowIntervalSelectedBorderOpacity:1,hollowIntervalInactiveBorderOpacity:.3};return S(S({},s),r)};Ek();function M0(r){var t=r.styleSheet,e=t===void 0?{}:t,i=Ut(r,["styleSheet"]),n=Ek(e);return nt({},Ck(n),i)}var ZOt=M0({}),IC={default:ZOt};function Pf(r){return L(IC,hu(r),IC.default)}function qOt(r,t){IC[hu(r)]=M0(t)}function nO(r,t,e){var i=e.translate(r),n=e.translate(t);return Br(i,n)}function KOt(r,t){var e=t.coordinate,i=t.getXScale(),n=i.range,a=n[n.length-1],o=n[0],s=e.invert(r),l=s.x;return e.isPolar&&l>(1+a)/2&&(l=o),i.translate(i.invert(l))}function aO(r,t,e){var i=e.coordinate,n=e.getYScale(),a=n.field,o=i.invert(t),s=n.invert(o.y),l=pa(r,function(u){var c=u[Ee];return c[a][0]<=s&&c[a][1]>=s});return l||r[r.length-1]}var QOt=Qc(function(r){if(r.isCategory)return 1;for(var t=r.values,e=t.length,i=r.translate(t[0]),n=i,a=0;a<e;a++){var o=t[a],s=r.translate(o);s<i&&(i=s),s>n&&(n=s)}return(n-i)/(e-1)});function JOt(r,t,e){var i=t.getAttribute("position"),n=i.getFields(),a=t.scales,o=ut(e)||!e?n[0]:e,s=a[o],l=s?s.getText(r[o]):r[o]||o;return ut(e)?e(l,r):l}function tPt(r){var t=K0(r.attributes);return Ur(t,function(e){return gl(Ju,e.type)})}function Sk(r){var t,e,i=tPt(r),n;try{for(var a=qt(i),o=a.next();!o.done;o=a.next()){var s=o.value,l=s.getScale(s.type);if(l&&l.isLinear){var u=L(r.scaleDefs,l.field),c=ek(l,u,s.type,r.type);if(c!=="cat"){n=l;break}}}}catch(d){t={error:d}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}var h=r.getXScale(),f=r.getYScale();return n||f||h}function ePt(r,t){var e=t.field,i=r[e];if(Z(i)){var n=i.map(function(a){return t.getText(a)});return n.join("-")}return t.getText(i)}function rPt(r,t){var e,i=t.getGroupScales();if(i.length&&(e=i[0]),e){var n=e.field;return e.getText(r[n])}var a=Sk(t);return Ad(a)}function Ak(r,t,e){if(t.length===0)return null;var i=e.type,n=e.getXScale(),a=e.getYScale(),o=n.field,s=a.field,l=null;if(i==="heatmap"||i==="point"){for(var u=e.coordinate,c=u.invert(r),h=n.invert(c.x),f=a.invert(c.y),d=1/0,v=0;v<t.length;v++){var p=t[v],g=p[Ee],m=Math.pow(g[o]-h,2)+Math.pow(g[s]-f,2);m<d&&(d=m,l=p)}return l}var y=t[0],_=t[t.length-1],x=KOt(r,e),C=y[Ee][o],A=y[Ee][s],T=_[Ee][o],w=a.isLinear&&Z(A);if(Z(C)){for(var v=0;v<t.length;v++){var M=t[v],g=M[Ee];if(n.translate(g[o][0])<=x&&n.translate(g[o][1])>=x)if(w)Z(l)||(l=[]),l.push(M);else{l=M;break}}Z(l)&&(l=aO(l,r,e))}else{var O=void 0;if(!n.isLinear&&n.type!=="timeCat"){for(var v=0;v<t.length;v++){var M=t[v],g=M[Ee];if(nO(g[o],x,n))if(w)Z(l)||(l=[]),l.push(M);else{l=M;break}else n.translate(g[o])<=x&&(_=M,O=t[v+1])}Z(l)&&(l=aO(l,r,e))}else{if((x>n.translate(T)||x<n.translate(C))&&(x>n.max||x<n.min))return null;for(var P=0,D=t.length-1,z=void 0;P<=D;){z=Math.floor((P+D)/2);var Y=t[z][Ee][o];if(nO(Y,x,n))return t[z];n.translate(Y)<=n.translate(x)?(P=z+1,_=t[z],O=t[z+1]):(D===0&&(_=t[0]),D=z-1)}}_&&O&&Math.abs(n.translate(_[Ee][o])-x)>Math.abs(n.translate(O[Ee][o])-x)&&(_=O)}var H=QOt(e.getXScale());return!l&&Math.abs(n.translate(_[Ee][o])-x)<=H/2&&(l=_),l}function pT(r,t,e,i){var n,a;e===void 0&&(e=""),i===void 0&&(i=!1);var o=r[Ee],s=JOt(o,t,e),l=t.tooltipOption,u=t.theme.defaultColor,c=[],h,f;function d(M,O){if(i||!j(O)&&O!==""){var P={title:s,data:o,mappingData:r,name:M,value:O,color:r.color||u,marker:!0};c.push(P)}}if(re(l)){var v=l.fields,p=l.callback;if(p){var g=v.map(function(M){return r[Ee][M]}),m=p.apply(void 0,_t([],lt(g),!1)),y=S({data:r[Ee],mappingData:r,title:s,color:r.color||u,marker:!0},m);c.push(y)}else{var _=t.scales;try{for(var x=qt(v),C=x.next();!C.done;C=x.next()){var A=C.value;if(!j(o[A])){var T=_[A];h=Ad(T),f=T.getText(o[A]),d(h,f)}}}catch(M){n={error:M}}finally{try{C&&!C.done&&(a=x.return)&&a.call(x)}finally{if(n)throw n.error}}}}else{var w=Sk(t);f=ePt(o,w),h=rPt(o,t),d(h,f)}return c}function oO(r,t,e,i){var n,a,o=i.showNil,s=[],l=r.dataArray;if(!Gi(l)){r.sort(l);try{for(var u=qt(l),c=u.next();!c.done;c=u.next()){var h=c.value,f=Ak(t,h,r);if(f){var d=r.getElementId(f),v=r.elementsMap[d];if(r.type==="heatmap"||v.visible){var p=pT(f,r,e,o);p.length&&s.push(p)}}}}catch(g){n={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}}return s}function sO(r,t,e,i){var n=i.showNil,a=[],o=r.container,s=o.getShape(t.x,t.y);if(s&&s.get("visible")&&s.get("origin")){var l=s.get("origin").mappingData,u=pT(l,r,e,n);u.length&&a.push(u)}return a}function LC(r,t,e){var i,n,a=[],o=r.geometries,s=e.shared,l=e.title,u=e.reversed;try{for(var c=qt(o),h=c.next();!h.done;h=c.next()){var f=h.value;if(f.visible&&f.tooltipOption!==!1){var d=f.type,v=void 0;["point","edge","polygon"].includes(d)?v=sO(f,t,l,e):["area","line","path","heatmap"].includes(d)||s!==!1?v=oO(f,t,l,e):v=sO(f,t,l,e),v.length&&(u&&v.reverse(),a.push(v))}}}catch(p){i={error:p}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}return a}function iPt(r,t,e){var i,n,a=LC(r,t,e);try{for(var o=qt(r.views),s=o.next();!s.done;s=o.next()){var l=s.value;a=a.concat(LC(l,t,e))}}catch(u){i={error:u}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function nPt(r){return!Mt(r)&&!Z(r)}function gT(r){r===void 0&&(r=0);var t=Z(r)?r:[r];switch(t.length){case 0:t=[0,0,0,0];break;case 1:t=new Array(4).fill(t[0]);break;case 2:t=_t(_t([],lt(t),!1),lt(t),!1);break;case 3:t=_t(_t([],lt(t),!1),[t[1]],!1);break;default:t=t.slice(0,4);break}return t}var mT={};function Cu(r,t){mT[r]=t}function aPt(){return Object.keys(mT)}function oPt(r){return mT[r]}var sPt=function(){function r(t){this.option=this.wrapperOption(t)}return r.prototype.update=function(t){return this.option=this.wrapperOption(t),this},r.prototype.hasAction=function(t){var e=this.option.actions;return j0(e,function(i){return i[0]===t})},r.prototype.create=function(t,e){var i=this.option,n=i.type,a=i.cfg,o=n==="theta",s=S({start:t,end:e},a),l=xIt(o?"polar":n);return this.coordinate=new l(s),this.coordinate.type=n,o&&(this.hasAction("transpose")||this.transpose()),this.execActions(),this.coordinate},r.prototype.adjust=function(t,e){return this.coordinate.update({start:t,end:e}),this.coordinate.resetMatrix(),this.execActions(["scale","rotate","translate"]),this.coordinate},r.prototype.rotate=function(t){return this.option.actions.push(["rotate",t]),this},r.prototype.reflect=function(t){return this.option.actions.push(["reflect",t]),this},r.prototype.scale=function(t,e){return this.option.actions.push(["scale",t,e]),this},r.prototype.transpose=function(){return this.option.actions.push(["transpose"]),this},r.prototype.getOption=function(){return this.option},r.prototype.getCoordinate=function(){return this.coordinate},r.prototype.wrapperOption=function(t){return S({type:"rect",actions:[],cfg:{}},t)},r.prototype.execActions=function(t){var e=this,i=this.option.actions;R(i,function(n){var a,o=lt(n),s=o[0],l=o.slice(1),u=j(t)?!0:t.includes(s);u&&(a=e.coordinate)[s].apply(a,_t([],lt(l),!1))})},r}(),He=function(){function r(t,e,i){this.view=t,this.gEvent=e,this.data=i,this.type=e.type}return r.fromData=function(t,e,i){return new r(t,new Gd(e,{}),i)},Object.defineProperty(r.prototype,"target",{get:function(){return this.gEvent.target},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"event",{get:function(){return this.gEvent.originalEvent},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"x",{get:function(){return this.gEvent.x},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this.gEvent.y},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"clientX",{get:function(){return this.gEvent.clientX},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"clientY",{get:function(){return this.gEvent.clientY},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return"[Event (type=".concat(this.type,")]")},r.prototype.clone=function(){return new r(this.view,this.gEvent,this.data)},r}();function lPt(r){var t=r.getController("axis"),e=r.getController("legend"),i=r.getController("annotation"),n=r.getController("slider"),a=r.getController("scrollbar");[t,n,a,e,i].forEach(function(o){o&&o.layout()})}var uPt=function(){function r(){this.scales=new Map,this.syncScales=new Map}return r.prototype.createScale=function(t,e,i,n){var a=i,o=this.getScaleMeta(n);if(e.length===0&&o){var s=o.scale,l={type:s.type};s.isCategory&&(l.values=s.values),a=nt(l,o.scaleDef,i)}var u=sOt(t,e,a);return this.cacheScale(u,i,n),u},r.prototype.sync=function(t,e){var i=this;this.syncScales.forEach(function(n,a){var o=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,l=[];R(n,function(u){var c=i.getScale(u);s=Mt(c.max)?Math.max(s,c.max):s,o=Mt(c.min)?Math.min(o,c.min):o,R(c.values,function(h){l.includes(h)||l.push(h)})}),R(n,function(u){var c=i.getScale(u);if(c.isContinuous)c.change({min:o,max:s,values:l});else if(c.isCategory){var h=c.range,f=i.getScaleMeta(u);l&&!L(f,["scaleDef","range"])&&(h=rk(nt({},c,{values:l}),t,e)),c.change({values:l,range:h})}})})},r.prototype.cacheScale=function(t,e,i){var n=this.getScaleMeta(i);n&&n.scale.type===t.type?(lOt(n.scale,t),n.scaleDef=e):(n={key:i,scale:t,scaleDef:e},this.scales.set(i,n));var a=this.getSyncKey(n);if(n.syncKey=a,this.removeFromSyncScales(i),a){var o=this.syncScales.get(a);o||(o=[],this.syncScales.set(a,o)),o.push(i)}},r.prototype.getScale=function(t){var e=this.getScaleMeta(t);if(!e){var i=fr(t.split("-")),n=this.syncScales.get(i);n&&n.length&&(e=this.getScaleMeta(n[0]))}return e&&e.scale},r.prototype.deleteScale=function(t){var e=this.getScaleMeta(t);if(e){var i=e.syncKey,n=this.syncScales.get(i);if(n&&n.length){var a=n.indexOf(t);a!==-1&&n.splice(a,1)}}this.scales.delete(t)},r.prototype.clear=function(){this.scales.clear(),this.syncScales.clear()},r.prototype.removeFromSyncScales=function(t){var e=this;this.syncScales.forEach(function(i,n){var a=i.indexOf(t);if(a!==-1)return i.splice(a,1),i.length===0&&e.syncScales.delete(n),!1})},r.prototype.getSyncKey=function(t){var e=t.scale,i=t.scaleDef,n=e.field,a=L(i,["sync"]);return a===!0?n:a===!1?void 0:a},r.prototype.getScaleMeta=function(t){return this.scales.get(t)},r}(),cg=function(){function r(t,e,i,n){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=0),this.top=t,this.right=e,this.bottom=i,this.left=n}return r.instance=function(t,e,i,n){return t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=0),new r(t,e,i,n)},r.prototype.max=function(t){var e=lt(t,4),i=e[0],n=e[1],a=e[2],o=e[3];return this.top=Math.max(this.top,i),this.right=Math.max(this.right,n),this.bottom=Math.max(this.bottom,a),this.left=Math.max(this.left,o),this},r.prototype.shrink=function(t){var e=lt(t,4),i=e[0],n=e[1],a=e[2],o=e[3];return this.top+=i,this.right+=n,this.bottom+=a,this.left+=o,this},r.prototype.inc=function(t,e){var i=t.width,n=t.height;switch(e){case it.TOP:case it.TOP_LEFT:case it.TOP_RIGHT:this.top+=n;break;case it.RIGHT:case it.RIGHT_TOP:case it.RIGHT_BOTTOM:this.right+=i;break;case it.BOTTOM:case it.BOTTOM_LEFT:case it.BOTTOM_RIGHT:this.bottom+=n;break;case it.LEFT:case it.LEFT_TOP:case it.LEFT_BOTTOM:this.left+=i;break}return this},r.prototype.getPadding=function(){return[this.top,this.right,this.bottom,this.left]},r.prototype.clone=function(){return new(r.bind.apply(r,_t([void 0],lt(this.getPadding()),!1)))},r}();function cPt(r){var t=r.padding;if(!nPt(t))return new(cg.bind.apply(cg,_t([void 0],lt(gT(t)),!1)));var e=r.viewBBox,i=new cg,n=[],a=[],o=[];return R(r.getComponents(),function(s){var l=s.type;l===Er.AXIS?n.push(s):[Er.LEGEND,Er.SLIDER,Er.SCROLLBAR].includes(l)?a.push(s):l!==Er.GRID&&l!==Er.TOOLTIP&&o.push(s)}),R(n,function(s){var l=s.component,u=l.getLayoutBBox(),c=new Si(u.x,u.y,u.width,u.height),h=c.exceed(e);i.max(h)}),R(a,function(s){var l=s.component,u=s.direction,c=l.getLayoutBBox(),h=l.get("padding"),f=new Si(c.x,c.y,c.width,c.height).expand(h);i.inc(f,u)}),R(o,function(s){var l=s.component,u=s.direction,c=l.getLayoutBBox(),h=new Si(c.x,c.y,c.width,c.height);i.inc(h,u)}),i}function hPt(r,t,e){var i=e.instance();t.forEach(function(n){n.autoPadding=i.max(n.autoPadding.getPadding())})}var Tk=function(r){B(t,r);function t(e){var i=r.call(this,{visible:e.visible})||this;i.views=[],i.geometries=[],i.controllers=[],i.interactions={},i.limitInPlot=!1,i.options={data:[],animate:!0},i.usedControllers=aPt(),i.scalePool=new uPt,i.layoutFunc=lPt,i.isPreMouseInPlot=!1,i.isDataChanged=!1,i.isCoordinateChanged=!1,i.createdScaleKeys=new Map,i.onCanvasEvent=function(_){var x=_.name;if(!x.includes(":")){var C=i.createViewEvent(_);i.doPlotEvent(C),i.emit(x,C)}},i.onDelegateEvents=function(_){var x=_.name;if(x.includes(":")){var C=i.createViewEvent(_);i.emit(x,C)}};var n=e.id,a=n===void 0?Cn("view"):n,o=e.parent,s=e.canvas,l=e.backgroundGroup,u=e.middleGroup,c=e.foregroundGroup,h=e.region,f=h===void 0?{start:{x:0,y:0},end:{x:1,y:1}}:h,d=e.padding,v=e.appendPadding,p=e.theme,g=e.options,m=e.limitInPlot,y=e.syncViewPadding;return i.parent=o,i.canvas=s,i.backgroundGroup=l,i.middleGroup=u,i.foregroundGroup=c,i.region=f,i.padding=d,i.appendPadding=v,i.options=S(S({},i.options),g),i.limitInPlot=m,i.id=a,i.syncViewPadding=y,i.themeObject=re(p)?nt({},Pf("default"),M0(p)):Pf(p),i.init(),i}return t.prototype.setLayout=function(e){this.layoutFunc=e},t.prototype.init=function(){this.calculateViewBBox(),this.initEvents(),this.initComponentController(),this.initOptions()},t.prototype.render=function(e,i){e===void 0&&(e=!1),this.emit(kt.BEFORE_RENDER,He.fromData(this,kt.BEFORE_RENDER,i)),this.paint(e),this.emit(kt.AFTER_RENDER,He.fromData(this,kt.AFTER_RENDER,i)),this.visible===!1&&this.changeVisible(!1)},t.prototype.clear=function(){var e=this;this.emit(kt.BEFORE_CLEAR),this.filteredData=[],this.coordinateInstance=void 0,this.isDataChanged=!1,this.isCoordinateChanged=!1;for(var i=this.geometries,n=0;n<i.length;n++)i[n].clear(),i[n].container.remove(!0),i[n].labelsContainer.remove(!0);this.geometries=[];for(var a=this.controllers,n=0;n<a.length;n++)a[n].name==="annotation"?a[n].clear(!0):a[n].clear();this.createdScaleKeys.forEach(function(s,l){e.getRootView().scalePool.deleteScale(l)}),this.createdScaleKeys.clear();for(var o=this.views,n=0;n<o.length;n++)o[n].clear();this.emit(kt.AFTER_CLEAR)},t.prototype.destroy=function(){this.emit(kt.BEFORE_DESTROY);var e=this.interactions;R(e,function(s){s&&s.destroy()}),this.clear();for(var i=this.controllers,n=0,a=i.length;n<a;n++){var o=i[n];o.destroy()}this.backgroundGroup.remove(!0),this.middleGroup.remove(!0),this.foregroundGroup.remove(!0),r.prototype.destroy.call(this)},t.prototype.changeVisible=function(e){r.prototype.changeVisible.call(this,e);for(var i=this.geometries,n=0,a=i.length;n<a;n++){var o=i[n];o.changeVisible(e)}for(var s=this.controllers,n=0,a=s.length;n<a;n++){var l=s[n];l.changeVisible(e)}return this.foregroundGroup.set("visible",e),this.middleGroup.set("visible",e),this.backgroundGroup.set("visible",e),this.getCanvas().draw(),this},t.prototype.data=function(e){return cr(this.options,"data",e),this.isDataChanged=!0,this},t.prototype.source=function(e){return console.warn("This method will be removed at G2 V4.1. Please use chart.data() instead."),this.data(e)},t.prototype.filter=function(e,i){return ut(i)?(cr(this.options,["filters",e],i),this):(!i&&L(this.options,["filters",e])&&delete this.options.filters[e],this)},t.prototype.axis=function(e,i){return Rs(e)?cr(this.options,["axes"],e):cr(this.options,["axes",e],i),this},t.prototype.legend=function(e,i){return Rs(e)?cr(this.options,["legends"],e):mt(e)?(cr(this.options,["legends",e],i),Va(i)&&(i!=null&&i.selected)&&cr(this.options,["filters",e],function(n){var a;return(a=i==null?void 0:i.selected[n])!==null&&a!==void 0?a:!0})):cr(this.options,["legends"],e),this},t.prototype.scale=function(e,i){var n=this;return mt(e)?cr(this.options,["scales",e],i):re(e)&&R(e,function(a,o){cr(n.options,["scales",o],a)}),this},t.prototype.tooltip=function(e){return cr(this.options,"tooltip",e),this},t.prototype.annotation=function(){return this.getController("annotation")},t.prototype.guide=function(){return console.warn("This method will be removed at G2 V4.1. Please use chart.annotation() instead."),this.annotation()},t.prototype.coordinate=function(e,i){return mt(e)?cr(this.options,"coordinate",{type:e,cfg:i}):cr(this.options,"coordinate",e),this.coordinateController.update(this.options.coordinate),this.coordinateController},t.prototype.coord=function(e,i){return console.warn("This method will be removed at G2 V4.1. Please use chart.coordinate() instead."),this.coordinate(e,i)},t.prototype.facet=function(e,i){this.facetInstance&&this.facetInstance.destroy();var n=fOt(e);if(!n)throw new Error("facet '".concat(e,"' is not exist!"));return this.facetInstance=new n(this,S(S({},i),{type:e})),this},t.prototype.animate=function(e){return cr(this.options,"animate",e),this},t.prototype.updateOptions=function(e){return this.clear(),ye(this.options,e),this.views.forEach(function(i){return i.destroy()}),this.views=[],this.initOptions(),this.coordinateBBox=this.viewBBox,this},t.prototype.option=function(e,i){if(t.prototype[e])throw new Error(`Can't use built in variable name "`.concat(e,'", please change another one.'));return cr(this.options,e,i),this},t.prototype.theme=function(e){return this.themeObject=re(e)?nt({},this.themeObject,M0(e)):Pf(e),this},t.prototype.interaction=function(e,i){var n=this.interactions[e];n&&n.destroy();var a=WOt(e,this,i);return a&&(a.init(),this.interactions[e]=a),this},t.prototype.removeInteraction=function(e){var i=this.interactions[e];i&&(i.destroy(),this.interactions[e]=void 0)},t.prototype.changeData=function(e){this.isDataChanged=!0,this.emit(kt.BEFORE_CHANGE_DATA,He.fromData(this,kt.BEFORE_CHANGE_DATA,null)),this.data(e),this.paint(!0);for(var i=this.views,n=0,a=i.length;n<a;n++){var o=i[n];o.changeData(e)}this.emit(kt.AFTER_CHANGE_DATA,He.fromData(this,kt.AFTER_CHANGE_DATA,null))},t.prototype.createView=function(e){this.parent&&this.parent.parent&&console.warn("The view nesting recursive feature will be removed at G2 V4.1. Please avoid to use it.");var i={data:this.options.data,scales:Dr(this.options.scales),axes:Dr(this.options.axes),coordinate:Dr(this.coordinateController.getOption()),tooltip:Dr(this.options.tooltip),legends:Dr(this.options.legends),animate:this.options.animate,visible:this.visible},n=new t(S(S({parent:this,canvas:this.canvas,backgroundGroup:this.backgroundGroup.addGroup({zIndex:vc.BG}),middleGroup:this.middleGroup.addGroup({zIndex:vc.MID}),foregroundGroup:this.foregroundGroup.addGroup({zIndex:vc.FORE}),theme:this.themeObject,padding:this.padding},e),{options:S(S({},i),L(e,"options",{}))}));return this.views.push(n),n},t.prototype.view=function(e){return console.warn("This method will be removed at G2 V4.1. Please use chart.createView() instead."),this.createView(e)},t.prototype.removeView=function(e){var i=oit(this.views,function(n){return n===e})[0];return i&&i.destroy(),i},t.prototype.getCoordinate=function(){return this.coordinateInstance},t.prototype.getTheme=function(){return this.themeObject},t.prototype.getXScale=function(){var e=this.geometries[0];return e?e.getXScale():null},t.prototype.getYScales=function(){var e={},i=[];return this.geometries.forEach(function(n){var a=n.getYScale(),o=a.field;e[o]||(e[o]=!0,i.push(a))}),i},t.prototype.getScalesByDim=function(e){for(var i=this.geometries,n={},a=0,o=i.length;a<o;a++){var s=i[a],l=e==="x"?s.getXScale():s.getYScale();l&&!n[l.field]&&(n[l.field]=l)}return n},t.prototype.getScale=function(e,i){var n=i||this.getScaleKey(e);return this.getRootView().scalePool.getScale(n)},t.prototype.getScaleByField=function(e,i){return this.getScale(e,i)},t.prototype.getOptions=function(){return this.options},t.prototype.getData=function(){return this.filteredData},t.prototype.getOriginalData=function(){return this.options.data},t.prototype.getPadding=function(){return this.autoPadding.getPadding()},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getElements=function(){return oi(this.geometries,function(e,i){return e.concat(i.getElements())},[])},t.prototype.getElementsBy=function(e){return this.getElements().filter(function(i){return e(i)})},t.prototype.getLayer=function(e){return e===rr.BG?this.backgroundGroup:e===rr.MID?this.middleGroup:e===rr.FORE?this.foregroundGroup:this.foregroundGroup},t.prototype.isPointInPlot=function(e){return iOt(this.getCoordinate(),e)},t.prototype.getLegendAttributes=function(){return vn(this.geometries.map(function(e){return e.getGroupAttributes()}))},t.prototype.getGroupScales=function(){var e=this.geometries.map(function(i){return i.getGroupScales()});return vs(vn(e))},t.prototype.getCanvas=function(){return this.getRootView().canvas},t.prototype.getRootView=function(){for(var e=this;;){if(e.parent){e=e.parent;continue}break}return e},t.prototype.getXY=function(e){var i=this.getCoordinate(),n=this.getScalesByDim("x"),a=this.getScalesByDim("y"),o,s;if(R(e,function(l,u){n[u]&&(o=n[u].scale(l)),a[u]&&(s=a[u].scale(l))}),!j(o)&&!j(s))return i.convert({x:o,y:s})},t.prototype.getController=function(e){return pa(this.controllers,function(i){return i.name===e})},t.prototype.showTooltip=function(e){var i=this.getController("tooltip");return i&&i.showTooltip(e),this},t.prototype.hideTooltip=function(){var e=this.getController("tooltip");return e&&e.hideTooltip(),this},t.prototype.lockTooltip=function(){var e=this.getController("tooltip");return e&&e.lockTooltip(),this},t.prototype.unlockTooltip=function(){var e=this.getController("tooltip");return e&&e.unlockTooltip(),this},t.prototype.isTooltipLocked=function(){var e=this.getController("tooltip");return e&&e.isTooltipLocked()},t.prototype.getTooltipItems=function(e){var i=this.getController("tooltip");return i?i.getTooltipItems(e):[]},t.prototype.getSnapRecords=function(e){for(var i=this.geometries,n=[],a=0,o=i.length;a<o;a++){var s=i[a],l=s.dataArray;s.sort(l);for(var u=void 0,c=0,h=l.length;c<h;c++){var f=l[c];u=Ak(e,f,s),u&&n.push(u)}}for(var d=this.views,a=0,o=d.length;a<o;a++){var v=d[a],p=v.getSnapRecords(e);n=n.concat(p)}return n},t.prototype.getComponents=function(){for(var e=[],i=this.controllers,n=0,a=i.length;n<a;n++){var o=i[n];e=e.concat(o.getComponents())}return e},t.prototype.filterData=function(e){var i=this.options.filters;return Tr(i)===0?e:Ur(e,function(n,a){var o=Object.keys(i);return o.every(function(s){var l=i[s];return l(n[s],n,a)})})},t.prototype.filterFieldData=function(e,i){var n=this.options.filters,a=L(n,e);return Wr(a)?i:i.filter(function(o,s){return a(o[e],o,s)})},t.prototype.adjustCoordinate=function(){var e=this.getCoordinate(),i=e.start,n=e.end,a=this.coordinateBBox.bl,o=this.coordinateBBox.tr;if(Jt(i,a)&&Jt(n,o)){this.isCoordinateChanged=!1;return}this.isCoordinateChanged=!0,this.coordinateInstance=this.coordinateController.adjust(a,o)},t.prototype.paint=function(e){this.renderDataRecursive(e),this.syncScale(),this.emit(kt.BEFORE_PAINT),this.renderPaddingRecursive(e),this.renderLayoutRecursive(e),this.renderBackgroundStyleShape(),this.renderPaintRecursive(e),this.emit(kt.AFTER_PAINT),this.isDataChanged=!1},t.prototype.renderBackgroundStyleShape=function(){if(!this.parent){var e=L(this.themeObject,"background");if(e){this.backgroundStyleRectShape||(this.backgroundStyleRectShape=this.backgroundGroup.addShape("rect",{attrs:{},zIndex:-1,capture:!1}),this.backgroundStyleRectShape.toBack());var i=this.viewBBox,n=i.x,a=i.y,o=i.width,s=i.height;this.backgroundStyleRectShape.attr({fill:e,x:n,y:a,width:o,height:s})}else this.backgroundStyleRectShape&&(this.backgroundStyleRectShape.remove(!0),this.backgroundStyleRectShape=void 0)}},t.prototype.renderPaddingRecursive=function(e){this.calculateViewBBox(),this.adjustCoordinate(),this.initComponents(e),this.autoPadding=cPt(this).shrink(gT(this.appendPadding)),this.coordinateBBox=this.viewBBox.shrink(this.autoPadding.getPadding()),this.adjustCoordinate();var i=this.controllers.find(function(l){return l.name==="tooltip"});i.update();for(var n=this.views,a=0,o=n.length;a<o;a++){var s=n[a];s.renderPaddingRecursive(e)}},t.prototype.renderLayoutRecursive=function(e){var i=this.syncViewPadding===!0?hPt:ut(this.syncViewPadding)?this.syncViewPadding:void 0;i&&(i(this,this.views,cg),this.views.forEach(function(l){l.coordinateBBox=l.viewBBox.shrink(l.autoPadding.getPadding()),l.adjustCoordinate()})),this.doLayout();for(var n=this.views,a=0,o=n.length;a<o;a++){var s=n[a];s.renderLayoutRecursive(e)}},t.prototype.renderPaintRecursive=function(e){var i=this.middleGroup;if(this.limitInPlot){var n=hT(this.coordinateInstance),a=n.type,o=n.attrs;i.setClip({type:a,attrs:o})}else i.setClip(void 0);this.paintGeometries(e),this.renderComponents(e);for(var s=this.views,l=0,u=s.length;l<u;l++){var c=s[l];c.renderPaintRecursive(e)}},t.prototype.createScale=function(e,i,n,a){var o=L(this.options.scales,[e]),s=S(S({},o),n);return this.parent?this.parent.createScale(e,i,s,a):this.scalePool.createScale(e,i,s,a)},t.prototype.renderDataRecursive=function(e){this.doFilterData(),this.createCoordinate(),this.initGeometries(e),this.renderFacet(e);for(var i=this.views,n=0,a=i.length;n<a;n++){var o=i[n];o.renderDataRecursive(e)}},t.prototype.calculateViewBBox=function(){var e,i,n,a;if(this.parent){var o=this.parent.coordinateBBox;e=o.x,i=o.y,n=o.width,a=o.height}else e=0,i=0,n=this.canvas.get("width"),a=this.canvas.get("height");var s=this.region,l=s.start,u=s.end,c=new Si(e+n*l.x,i+a*l.y,n*(u.x-l.x),a*(u.y-l.y));(!this.viewBBox||!this.viewBBox.isEqual(c))&&(this.viewBBox=new Si(e+n*l.x,i+a*l.y,n*(u.x-l.x),a*(u.y-l.y))),this.coordinateBBox=this.viewBBox},t.prototype.initEvents=function(){this.foregroundGroup.on("*",this.onDelegateEvents),this.middleGroup.on("*",this.onDelegateEvents),this.backgroundGroup.on("*",this.onDelegateEvents),this.canvas.on("*",this.onCanvasEvent)},t.prototype.initComponentController=function(){for(var e=this.usedControllers,i=0,n=e.length;i<n;i++){var a=e[i],o=oPt(a);o&&this.controllers.push(new o(this))}},t.prototype.createViewEvent=function(e){var i=e.shape,n=e.name,a=i?i.get("origin"):null,o=new He(this,e,a);return o.type=n,o},t.prototype.doPlotEvent=function(e){var i=e.type,n=e.x,a=e.y,o={x:n,y:a},s=["mousedown","mouseup","mousemove","mouseleave","mousewheel","touchstart","touchmove","touchend","touchcancel","click","dblclick","contextmenu"];if(s.includes(i)){var l=this.isPointInPlot(o),u=e.clone();if(l){var c="plot:".concat(i);u.type=c,this.emit(c,u),(i==="mouseleave"||i==="touchend")&&(this.isPreMouseInPlot=!1)}i==="mousemove"||i==="touchmove"?(this.isPreMouseInPlot&&!l?(i==="mousemove"&&(u.type=Mi.MOUSE_LEAVE,this.emit(Mi.MOUSE_LEAVE,u)),u.type=Mi.LEAVE,this.emit(Mi.LEAVE,u)):!this.isPreMouseInPlot&&l&&(i==="mousemove"&&(u.type=Mi.MOUSE_ENTER,this.emit(Mi.MOUSE_ENTER,u)),u.type=Mi.ENTER,this.emit(Mi.ENTER,u)),this.isPreMouseInPlot=l):(i==="mouseleave"||i==="touchend")&&this.isPreMouseInPlot&&(i==="mouseleave"&&(u.type=Mi.MOUSE_LEAVE,this.emit(Mi.MOUSE_LEAVE,u)),u.type=Mi.LEAVE,this.emit(Mi.LEAVE,u),this.isPreMouseInPlot=!1)}},t.prototype.doFilterData=function(){var e=this.options.data;this.filteredData=this.filterData(e)},t.prototype.initGeometries=function(e){this.createOrUpdateScales();for(var i=this.getCoordinate(),n=L(this.options,"scales",{}),a=this.geometries,o=0,s=a.length;o<s;o++){var l=a[o];l.scales=this.getGeometryScales();var u={coordinate:i,scaleDefs:n,data:this.filteredData,theme:this.themeObject,isDataChanged:this.isDataChanged,isCoordinateChanged:this.isCoordinateChanged};e?l.update(u):l.init(u)}this.adjustScales()},t.prototype.createOrUpdateScales=function(){for(var e=this.getScaleFields(),i=this.getGroupedFields(),n=this.getOptions(),a=n.data,o=n.scales,s=o===void 0?{}:o,l=this.filteredData,u=0,c=e.length;u<c;u++){var h=e[u],f=s[h],d=this.getScaleKey(h);this.createScale(h,i.includes(h)?a:l,f,d),this.createdScaleKeys.set(d,!0)}},t.prototype.syncScale=function(){this.getRootView().scalePool.sync(this.getCoordinate(),this.theme)},t.prototype.getGeometryScales=function(){for(var e=this.getScaleFields(),i={},n=0;n<e.length;n++){var a=e[n];i[a]=this.getScaleByField(a)}return i},t.prototype.getScaleFields=function(){for(var e=[],i=new Map,n=this.geometries,a=0;a<n.length;a++){var o=n[a],s=o.getScaleFields();vs(s,e,i)}return e},t.prototype.getGroupedFields=function(){for(var e=[],i=new Map,n=this.geometries,a=0;a<n.length;a++){var o=n[a],s=o.getGroupFields();vs(s,e,i)}return e},t.prototype.adjustScales=function(){this.adjustCategoryScaleRange()},t.prototype.adjustCategoryScaleRange=function(){var e=this,i=_t([this.getXScale()],lt(this.getYScales()),!1).filter(function(o){return!!o}),n=this.getCoordinate(),a=this.options.scales;R(i,function(o){var s=o.field,l=o.values,u=o.isCategory,c=o.isIdentity;(u||c)&&l&&!L(a,[s,"range"])&&(o.range=rk(o,n,e.theme))})},t.prototype.initComponents=function(e){for(var i=this.controllers,n=0;n<i.length;n++){var a=i[n];e?a.update():(a.clear(),a.render())}},t.prototype.doLayout=function(){this.layoutFunc(this)},t.prototype.createCoordinate=function(){var e=this.coordinateBBox.bl,i=this.coordinateBBox.tr;this.coordinateInstance=this.coordinateController.create(e,i)},t.prototype.paintGeometries=function(e){for(var i=this.options.animate,n=this.getCoordinate(),a={x:this.viewBBox.x,y:this.viewBBox.y,minX:this.viewBBox.minX,minY:this.viewBBox.minY,maxX:this.viewBBox.maxX,maxY:this.viewBBox.maxY,width:this.viewBBox.width,height:this.viewBBox.height},o=this.geometries,s=0;s<o.length;s++){var l=o[s];l.coordinate=n,l.canvasRegion=a,i||l.animate(!1),l.paint(e)}},t.prototype.renderComponents=function(e){for(var i=this.getComponents(),n=0;n<i.length;n++){var a=i[n];a.component.render()}},t.prototype.renderFacet=function(e){this.facetInstance&&(e?this.facetInstance.update():(this.facetInstance.clear(),this.facetInstance.init(),this.facetInstance.render()))},t.prototype.initOptions=function(){var e=this,i=this.options,n=i.geometries,a=n===void 0?[]:n,o=i.interactions,s=o===void 0?[]:o,l=i.views,u=l===void 0?[]:l,c=i.annotations,h=c===void 0?[]:c,f=i.coordinate,d=i.events,v=i.facets;this.coordinateController?f&&this.coordinateController.update(f):this.coordinateController=new sPt(f);for(var p=0;p<a.length;p++){var g=a[p];this.createGeometry(g)}for(var m=0;m<s.length;m++){var y=s[m],_=y.type,x=y.cfg;this.interaction(_,x)}for(var C=0;C<u.length;C++){var A=u[C];this.createView(A)}for(var T=this.getController("annotation"),w=0;w<h.length;w++){var M=h[w];T.annotation(M)}d&&R(d,function(O,P){e.on(P,O)}),v&&R(v,function(O){var P=O.type,D=Ut(O,["type"]);e.facet(P,D)})},t.prototype.createGeometry=function(e){var i=e.type,n=e.cfg,a=n===void 0?{}:n;if(this[i]){var o=this[i](a);R(e,function(s,l){ut(o[l])&&o[l](s)})}},t.prototype.getScaleKey=function(e){return"".concat(this.id,"-").concat(e)},t}(QA);function fo(r,t){Tk.prototype[r.toLowerCase()]=function(e){e===void 0&&(e={});var i=S({container:this.middleGroup.addGroup(),labelsContainer:this.foregroundGroup.addGroup()},e),n=new t(i);return this.geometries.push(n),n}}var fPt=function(r){B(t,r);function t(e){var i=this,n=e.container,a=e.width,o=e.height,s=e.autoFit,l=s===void 0?!1:s,u=e.padding,c=e.appendPadding,h=e.renderer,f=h===void 0?"canvas":h,d=e.pixelRatio,v=e.localRefresh,p=v===void 0?!0:v,g=e.visible,m=g===void 0?!0:g,y=e.supportCSSTransform,_=y===void 0?!1:y,x=e.defaultInteractions,C=x===void 0?["tooltip","legend-filter","legend-active","continuous-filter","ellipsis-text","axis-description"]:x,A=e.options,T=e.limitInPlot,w=e.theme,M=e.syncViewPadding,O=mt(n)?document.getElementById(n):n,P=Lo('<div style="position:relative;"></div>');O.appendChild(P);var D=ML(O,l,a,o),z=l3t(f),Y=new z.Canvas(S({container:P,pixelRatio:d,localRefresh:p,supportCSSTransform:_},D));return i=r.call(this,{parent:null,canvas:Y,backgroundGroup:Y.addGroup({zIndex:vc.BG}),middleGroup:Y.addGroup({zIndex:vc.MID}),foregroundGroup:Y.addGroup({zIndex:vc.FORE}),padding:u,appendPadding:c,visible:m,options:A,limitInPlot:T,theme:w,syncViewPadding:M})||this,i.onResize=WB(function(){i.forceFit()},300),i.ele=O,i.canvas=Y,i.width=D.width,i.height=D.height,i.autoFit=l,i.localRefresh=p,i.renderer=f,i.wrapperElement=P,i.updateCanvasStyle(),i.bindAutoFit(),i.initDefaultInteractions(C),i}return t.prototype.initDefaultInteractions=function(e){var i=this;R(e,function(n){i.interaction(n)})},t.prototype.aria=function(e){var i="aria-label";e===!1?this.ele.removeAttribute(i):this.ele.setAttribute(i,e.label)},t.prototype.changeSize=function(e,i){return this.width===e&&this.height===i?this:(this.emit(kt.BEFORE_CHANGE_SIZE),this.width=e,this.height=i,this.canvas.changeSize(e,i),this.render(!0),this.emit(kt.AFTER_CHANGE_SIZE),this)},t.prototype.clear=function(){r.prototype.clear.call(this),this.aria(!1)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.unbindAutoFit(),this.canvas.destroy(),c3t(this.wrapperElement),this.wrapperElement=null},t.prototype.changeVisible=function(e){return r.prototype.changeVisible.call(this,e),this.wrapperElement.style.display=e?"":"none",this},t.prototype.forceFit=function(){if(!this.destroyed){var e=ML(this.ele,!0,this.width,this.height),i=e.width,n=e.height;this.changeSize(i,n)}},t.prototype.updateCanvasStyle=function(){Te(this.canvas.get("el"),{display:"inline-block",verticalAlign:"middle"})},t.prototype.bindAutoFit=function(){this.autoFit&&window.addEventListener("resize",this.onResize)},t.prototype.unbindAutoFit=function(){this.autoFit&&window.removeEventListener("resize",this.onResize)},t}(Tk),ph=function(){function r(t){this.visible=!0,this.components=[],this.view=t}return r.prototype.clear=function(t){R(this.components,function(e){e.component.destroy()}),this.components=[]},r.prototype.destroy=function(){this.clear()},r.prototype.getComponents=function(){return this.components},r.prototype.changeVisible=function(t){this.visible!==t&&(this.components.forEach(function(e){t?e.component.show():e.component.hide()}),this.visible=t)},r}();function dPt(r){for(var t=[],e=function(n){var a=r[n],o=pa(t,function(s){return s.color===a.color&&s.name===a.name&&s.value===a.value&&s.title===a.title});o||t.push(a)},i=0;i<r.length;i++)e(i);return t}var bk=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isLocked=!1,e}return Object.defineProperty(t.prototype,"name",{get:function(){return"tooltip"},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.isVisible=function(){var e=this.view.getOptions().tooltip;return e!==!1},t.prototype.render=function(){},t.prototype.showTooltip=function(e){if(this.point=e,!!this.isVisible()){var i=this.view,n=this.getTooltipItems(e);if(!n.length){this.hideTooltip();return}var a=this.getTitle(n),o={x:n[0].x,y:n[0].y};i.emit("tooltip:show",He.fromData(i,"tooltip:show",S({items:n,title:a},e)));var s=this.getTooltipCfg(),l=s.follow,u=s.showMarkers,c=s.showCrosshairs,h=s.showContent,f=s.marker,d=this.items,v=this.title;if(!Jt(v,a)||!Jt(d,n)?(i.emit("tooltip:change",He.fromData(i,"tooltip:change",S({items:n,title:a},e))),(ut(h)?h(n):h)&&(this.tooltip||this.renderTooltip(),this.tooltip.update(ye({},s,{items:this.getItemsAfterProcess(n),title:a},l?e:{})),this.tooltip.show()),u&&this.renderTooltipMarkers(n,f)):(this.tooltip&&l&&(this.tooltip.update(e),this.tooltip.show()),this.tooltipMarkersGroup&&this.tooltipMarkersGroup.show()),this.items=n,this.title=a,c){var p=L(s,["crosshairs","follow"],!1);this.renderCrosshairs(p?e:o,s)}}},t.prototype.hideTooltip=function(){var e=this.getTooltipCfg().follow;if(!e){this.point=null;return}var i=this.tooltipMarkersGroup;i&&i.hide();var n=this.xCrosshair,a=this.yCrosshair;n&&n.hide(),a&&a.hide();var o=this.tooltip;o&&o.hide(),this.view.emit("tooltip:hide",He.fromData(this.view,"tooltip:hide",{})),this.point=null},t.prototype.lockTooltip=function(){this.isLocked=!0,this.tooltip&&this.tooltip.setCapture(!0)},t.prototype.unlockTooltip=function(){this.isLocked=!1;var e=this.getTooltipCfg();this.tooltip&&this.tooltip.setCapture(e.capture)},t.prototype.isTooltipLocked=function(){return this.isLocked},t.prototype.clear=function(){var e=this,i=e.tooltip,n=e.xCrosshair,a=e.yCrosshair,o=e.tooltipMarkersGroup;i&&(i.hide(),i.clear()),n&&n.clear(),a&&a.clear(),o&&o.clear(),i!=null&&i.get("customContent")&&(this.tooltip.destroy(),this.tooltip=null),this.title=null,this.items=null},t.prototype.destroy=function(){this.tooltip&&this.tooltip.destroy(),this.xCrosshair&&this.xCrosshair.destroy(),this.yCrosshair&&this.yCrosshair.destroy(),this.guideGroup&&this.guideGroup.remove(!0),this.reset()},t.prototype.reset=function(){this.items=null,this.title=null,this.tooltipMarkersGroup=null,this.tooltipCrosshairsGroup=null,this.xCrosshair=null,this.yCrosshair=null,this.tooltip=null,this.guideGroup=null,this.isLocked=!1,this.point=null},t.prototype.changeVisible=function(e){if(this.visible!==e){var i=this,n=i.tooltip,a=i.tooltipMarkersGroup,o=i.xCrosshair,s=i.yCrosshair;e?(n&&n.show(),a&&a.show(),o&&o.show(),s&&s.show()):(n&&n.hide(),a&&a.hide(),o&&o.hide(),s&&s.hide()),this.visible=e}},t.prototype.getTooltipItems=function(e){var i,n,a,o,s,l,u=this.findItemsFromView(this.view,e);if(u.length){u=vn(u);try{for(var c=qt(u),h=c.next();!h.done;h=c.next()){var f=h.value;try{for(var d=(a=void 0,qt(f)),v=d.next();!v.done;v=d.next()){var p=v.value,g=p.mappingData,m=g.x,y=g.y;p.x=Z(m)?m[m.length-1]:m,p.y=Z(y)?y[y.length-1]:y}}catch(O){a={error:O}}finally{try{v&&!v.done&&(o=d.return)&&o.call(d)}finally{if(a)throw a.error}}}}catch(O){i={error:O}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}var _=this.getTooltipCfg().shared;if(_===!1&&u.length>1){var x=u[0],C=Math.abs(e.y-x[0].y);try{for(var A=qt(u),T=A.next();!T.done;T=A.next()){var w=T.value,M=Math.abs(e.y-w[0].y);M<=C&&(x=w,C=M)}}catch(O){s={error:O}}finally{try{T&&!T.done&&(l=A.return)&&l.call(A)}finally{if(s)throw s.error}}u=[x]}return dPt(vn(u))}return[]},t.prototype.layout=function(){},t.prototype.update=function(){if(this.point&&this.showTooltip(this.point),this.tooltip){var e=this.view.getCanvas();this.tooltip.set("region",{start:{x:0,y:0},end:{x:e.get("width"),y:e.get("height")}})}},t.prototype.isCursorEntered=function(e){if(this.tooltip){var i=this.tooltip.getContainer(),n=this.tooltip.get("capture");if(i&&n){var a=i.getBoundingClientRect(),o=a.x,s=a.y,l=a.width,u=a.height;return new Si(o,s,l,u).isPointIn(e)}}return!1},t.prototype.getTooltipCfg=function(){var e=this.view,i=e.getOptions().tooltip,n=this.processCustomContent(i),a=e.getTheme(),o=L(a,["components","tooltip"],{}),s=L(n,"enterable",o.enterable);return nt({},o,n,{capture:!!(s||this.isLocked)})},t.prototype.processCustomContent=function(e){if(Rs(e)||!L(e,"customContent"))return e;var i=e.customContent,n=function(a,o){var s=i(a,o)||"";return mt(s)?'<div class="g2-tooltip">'+s+"</div>":s};return S(S({},e),{customContent:n})},t.prototype.getTitle=function(e){var i=e[0].title||e[0].name;return this.title=i,i},t.prototype.renderTooltip=function(){var e=this.view.getCanvas(),i={start:{x:0,y:0},end:{x:e.get("width"),y:e.get("height")}},n=this.getTooltipCfg(),a=new hy(S(S({parent:e.get("el").parentNode,region:i},n),{visible:!1,crosshairs:null}));a.init(),this.tooltip=a},t.prototype.renderTooltipMarkers=function(e,i){var n,a,o=this.getTooltipMarkersGroup(),s=this.view.getRootView(),l=s.limitInPlot;try{for(var u=qt(e),c=u.next();!c.done;c=u.next()){var h=c.value,f=h.x,d=h.y;if(l||o!=null&&o.getClip()){var v=hT(s.getCoordinate()),p=v.type,g=v.attrs;o==null||o.setClip({type:p,attrs:g})}else o==null||o.setClip(void 0);var m=this.view.getTheme(),y=L(m,["components","tooltip","marker"],{}),_=S(S({fill:h.color,symbol:"circle",shadowColor:h.color},ut(i)?S(S({},y),i(h)):i),{x:f,y:d});o.addShape("marker",{attrs:_})}}catch(x){n={error:x}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}},t.prototype.renderCrosshairs=function(e,i){var n=L(i,["crosshairs","type"],"x");n==="x"?(this.yCrosshair&&this.yCrosshair.hide(),this.renderXCrosshairs(e,i)):n==="y"?(this.xCrosshair&&this.xCrosshair.hide(),this.renderYCrosshairs(e,i)):n==="xy"&&(this.renderXCrosshairs(e,i),this.renderYCrosshairs(e,i))},t.prototype.renderXCrosshairs=function(e,i){var n=this.getViewWithGeometry(this.view).getCoordinate(),a,o;if(n.isRect)n.isTransposed?(a={x:n.start.x,y:e.y},o={x:n.end.x,y:e.y}):(a={x:e.x,y:n.end.y},o={x:e.x,y:n.start.y});else{var s=$c(n,e),l=n.getCenter(),u=n.getRadius();o=sr(l.x,l.y,u,s),a=l}var c=nt({start:a,end:o,container:this.getTooltipCrosshairsGroup()},L(i,"crosshairs",{}),this.getCrosshairsText("x",e,i));delete c.type;var h=this.xCrosshair;h?h.update(c):(h=new Y8(c),h.init()),h.render(),h.show(),this.xCrosshair=h},t.prototype.renderYCrosshairs=function(e,i){var n=this.getViewWithGeometry(this.view).getCoordinate(),a,o;if(n.isRect){var s=void 0,l=void 0;n.isTransposed?(s={x:e.x,y:n.end.y},l={x:e.x,y:n.start.y}):(s={x:n.start.x,y:e.y},l={x:n.end.x,y:e.y}),a={start:s,end:l},o="Line"}else a={center:n.getCenter(),radius:fy(n,e),startAngle:n.startAngle,endAngle:n.endAngle},o="Circle";a=nt({container:this.getTooltipCrosshairsGroup()},a,L(i,"crosshairs",{}),this.getCrosshairsText("y",e,i)),delete a.type;var u=this.yCrosshair;u?n.isRect&&u.get("type")==="circle"||!n.isRect&&u.get("type")==="line"?(u=new UL[o](a),u.init()):u.update(a):(u=new UL[o](a),u.init()),u.render(),u.show(),this.yCrosshair=u},t.prototype.getCrosshairsText=function(e,i,n){var a=L(n,["crosshairs","text"]),o=L(n,["crosshairs","follow"]),s=this.items;if(a){var l=this.getViewWithGeometry(this.view),u=s[0],c=l.getXScale(),h=l.getYScales()[0],f=void 0,d=void 0;if(o){var v=this.view.getCoordinate().invert(i);f=c.invert(v.x),d=h.invert(v.y)}else f=u.data[c.field],d=u.data[h.field];var p=e==="x"?f:d;return ut(a)?a=a(e,p,s,i):a.content=p,{text:a}}},t.prototype.getGuideGroup=function(){if(!this.guideGroup){var e=this.view.foregroundGroup;this.guideGroup=e.addGroup({name:"tooltipGuide",capture:!1})}return this.guideGroup},t.prototype.getTooltipMarkersGroup=function(){var e=this.tooltipMarkersGroup;return e&&!e.destroyed?(e.clear(),e.show()):(e=this.getGuideGroup().addGroup({name:"tooltipMarkersGroup"}),e.toFront(),this.tooltipMarkersGroup=e),e},t.prototype.getTooltipCrosshairsGroup=function(){var e=this.tooltipCrosshairsGroup;return e||(e=this.getGuideGroup().addGroup({name:"tooltipCrosshairsGroup",capture:!1}),e.toBack(),this.tooltipCrosshairsGroup=e),e},t.prototype.findItemsFromView=function(e,i){var n,a;if(e.getOptions().tooltip===!1)return[];var o=this.getTooltipCfg(),s=LC(e,i,o);try{for(var l=qt(e.views),u=l.next();!u.done;u=l.next()){var c=u.value;s=s.concat(this.findItemsFromView(c,i))}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return s},t.prototype.getViewWithGeometry=function(e){var i=this;return e.geometries.length?e:pa(e.views,function(n){return i.getViewWithGeometry(n)})},t.prototype.getItemsAfterProcess=function(e){var i=this.getTooltipCfg().customItems,n=i||function(a){return a};return n(e)},t}(ph),wk={};function Rk(r){return wk[r.toLowerCase()]}function En(r,t){wk[r.toLowerCase()]=t}var Vc={appear:{duration:450,easing:"easeQuadOut"},update:{duration:400,easing:"easeQuadInOut"},enter:{duration:400,easing:"easeQuadInOut"},leave:{duration:350,easing:"easeQuadIn"}},vPt={interval:function(r){return{enter:{animation:r.isRect?r.isTransposed?"scale-in-x":"scale-in-y":"fade-in"},update:{animation:r.isPolar&&r.isTransposed?"sector-path-update":null},leave:{animation:"fade-out"}}},line:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},path:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},point:{appear:{animation:"zoom-in"},enter:{animation:"zoom-in"},leave:{animation:"zoom-out"}},area:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},polygon:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},schema:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},edge:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},label:{appear:{animation:"fade-in",delay:450},enter:{animation:"fade-in"},update:{animation:"position-update"},leave:{animation:"fade-out"}}},lO={line:function(){return{animation:"wave-in"}},area:function(){return{animation:"wave-in"}},path:function(){return{animation:"fade-in"}},interval:function(r){var t;return r.isRect?t=r.isTransposed?"grow-in-x":"grow-in-y":(t="grow-in-xy",r.isPolar&&r.isTransposed&&(t="wave-in")),{animation:t}},schema:function(r){var t;return r.isRect?t=r.isTransposed?"grow-in-x":"grow-in-y":t="grow-in-xy",{animation:t}},polygon:function(){return{animation:"fade-in",duration:500}},edge:function(){return{animation:"fade-in"}}};function pPt(r,t){return{delay:ut(r.delay)?r.delay(t):r.delay,easing:ut(r.easing)?r.easing(t):r.easing,duration:ut(r.duration)?r.duration(t):r.duration,callback:r.callback,repeat:r.repeat}}function Mk(r,t,e){var i=vPt[r];return i&&(ut(i)&&(i=i(t)),i=nt({},Vc,i),e)?i[e]:i}function gc(r,t,e){var i=L(r.get("origin"),"data",Ee),n=t.animation,a=pPt(t,i);if(n){var o=Rk(n);o&&o(r,a,e)}else r.animate(e.toAttrs,a)}function gPt(r,t,e,i,n){if(lO[e]){var a=lO[e](i),o=Rk(L(a,"animation",""));if(o){var s=S(S(S({},Vc.appear),a),t);r.stopAnimate(),o(r,s,{coordinate:i,minYPoint:n,toAttrs:null})}}}var yT="element-background",Ik=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;i.labelShape=[],i.states=[];var n=e.shapeFactory,a=e.container,o=e.offscreenGroup,s=e.elementIndex,l=e.visible,u=l===void 0?!0:l;return i.shapeFactory=n,i.container=a,i.offscreenGroup=o,i.visible=u,i.elementIndex=s,i}return t.prototype.draw=function(e,i){i===void 0&&(i=!1),this.model=e,this.data=e.data,this.shapeType=this.getShapeType(e),this.drawShape(e,i),this.visible===!1&&this.changeVisible(!1)},t.prototype.update=function(e){var i=this,n=i.shapeFactory,a=i.shape;if(a){this.model=e,this.data=e.data,this.shapeType=this.getShapeType(e),this.setShapeInfo(a,e);var o=this.getOffscreenGroup(),s=n.drawShape(this.shapeType,e,o);s.cfg.data=this.data,s.cfg.origin=e,s.cfg.element=this,this.syncShapeStyle(a,s,this.getStates(),this.getAnimateCfg("update"))}},t.prototype.destroy=function(){var e=this,i=e.shapeFactory,n=e.shape;if(n){var a=this.getAnimateCfg("leave");a?gc(n,a,{coordinate:i.coordinate,toAttrs:S({},n.attr())}):n.remove(!0)}this.states=[],this.shapeFactory=void 0,this.container=void 0,this.shape=void 0,this.animate=void 0,this.geometry=void 0,this.labelShape=[],this.model=void 0,this.data=void 0,this.offscreenGroup=void 0,this.statesStyle=void 0,r.prototype.destroy.call(this)},t.prototype.changeVisible=function(e){r.prototype.changeVisible.call(this,e),e?(this.shape&&this.shape.show(),this.labelShape&&this.labelShape.forEach(function(i){i.show()})):(this.shape&&this.shape.hide(),this.labelShape&&this.labelShape.forEach(function(i){i.hide()}))},t.prototype.setState=function(e,i){var n=this,a=n.states,o=n.shapeFactory,s=n.model,l=n.shape,u=n.shapeType,c=a.indexOf(e);if(i){if(c>-1)return;a.push(e),(e==="active"||e==="selected")&&(l==null||l.toFront())}else{if(c===-1)return;if(a.splice(c,1),e==="active"||e==="selected"){var h=this.geometry,f=h.sortZIndex,d=h.zIndexReversed,v=d?this.geometry.elements.length-this.elementIndex:this.elementIndex;f?l.setZIndex(v):l.set("zIndex",v)}}var p=o.drawShape(u,s,this.getOffscreenGroup());a.length?this.syncShapeStyle(l,p,a,null):this.syncShapeStyle(l,p,["reset"],null),p.remove(!0);var g={state:e,stateStatus:i,element:this,target:this.container};this.container.emit("statechange",g),P8(this.shape,"statechange",g)},t.prototype.clearStates=function(){var e=this,i=this.states;R(i,function(n){e.setState(n,!1)}),this.states=[]},t.prototype.hasState=function(e){return this.states.includes(e)},t.prototype.getStates=function(){return this.states},t.prototype.getData=function(){return this.data},t.prototype.getModel=function(){return this.model},t.prototype.getBBox=function(){var e=this,i=e.shape,n=e.labelShape,a={x:0,y:0,minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};return i&&(a=i.getCanvasBBox()),n&&n.forEach(function(o){var s=o.getCanvasBBox();a.x=Math.min(s.x,a.x),a.y=Math.min(s.y,a.y),a.minX=Math.min(s.minX,a.minX),a.minY=Math.min(s.minY,a.minY),a.maxX=Math.max(s.maxX,a.maxX),a.maxY=Math.max(s.maxY,a.maxY)}),a.width=a.maxX-a.minX,a.height=a.maxY-a.minY,a},t.prototype.getStatesStyle=function(){if(!this.statesStyle){var e=this,i=e.shapeType,n=e.geometry,a=e.shapeFactory,o=n.stateOption,s=a.defaultShapeType,l=a.theme[i]||a.theme[s];this.statesStyle=nt({},l,o)}return this.statesStyle},t.prototype.getStateStyle=function(e,i){var n=this.getStatesStyle(),a=L(n,[e,"style"],{}),o=a[i]||a;return ut(o)?o(this):o},t.prototype.getAnimateCfg=function(e){var i=this,n=this.animate;if(n){var a=n[e];return a&&S(S({},a),{callback:function(){var o;ut(a.callback)&&a.callback(),(o=i.geometry)===null||o===void 0||o.emit(As.AFTER_DRAW_ANIMATE)}})}return null},t.prototype.drawShape=function(e,i){var n;i===void 0&&(i=!1);var a=this,o=a.shapeFactory,s=a.container,l=a.shapeType;if(this.shape=o.drawShape(l,e,s),this.shape){this.setShapeInfo(this.shape,e);var u=this.shape.cfg.name;u?mt(u)&&(this.shape.cfg.name=["element",u]):this.shape.cfg.name=["element",this.shapeFactory.geometryType];var c=i?"enter":"appear",h=this.getAnimateCfg(c);h&&((n=this.geometry)===null||n===void 0||n.emit(As.BEFORE_DRAW_ANIMATE),gc(this.shape,h,{coordinate:o.coordinate,toAttrs:S({},this.shape.attr())}))}},t.prototype.getOffscreenGroup=function(){if(!this.offscreenGroup){var e=this.container.getGroupBase();this.offscreenGroup=new e({})}return this.offscreenGroup},t.prototype.setShapeInfo=function(e,i){var n=this;if(e.cfg.origin=i,e.cfg.element=this,e.isGroup()){var a=e.get("children");a.forEach(function(o){n.setShapeInfo(o,i)})}},t.prototype.syncShapeStyle=function(e,i,n,a,o){var s=this,l;if(n===void 0&&(n=[]),o===void 0&&(o=0),!(!e||!i)){var u=e.get("clipShape"),c=i.get("clipShape");if(this.syncShapeStyle(u,c,n,a),e.isGroup())for(var h=e.get("children"),f=i.get("children"),d=0;d<h.length;d++)this.syncShapeStyle(h[d],f[d],n,a,o+d);else{if(!Gi(n)&&!Jt(n,["reset"])){var v=e.get("name");Z(v)&&(v=v[1]),R(n,function(g){if(i.get("name")!==yT){var m=s.getStateStyle(g,v||o);i.attr(m)}})}var p=tk(e,i);this.animate?a?((l=this.geometry)===null||l===void 0||l.emit(As.BEFORE_DRAW_ANIMATE),gc(e,a,{coordinate:this.shapeFactory.coordinate,toAttrs:p,shapeModel:this.model})):Gi(n)?e.attr(p):(e.stopAnimate(),e.animate(p,{duration:300})):e.attr(p)}}},t.prototype.getShapeType=function(e){var i=L(e,"shape");return Z(i)?i[0]:i},t}(QA),Lk={},Ok={};function mPt(r){return Lk[r.toLowerCase()]}function vv(r,t){Lk[r.toLowerCase()]=t}function yPt(r){return Ok[r.toLowerCase()]}function Qi(r,t){Ok[r.toLowerCase()]=t}var _Pt={coordinate:null,defaultShapeType:null,theme:null,getShapePoints:function(r,t){var e=this.getShape(r);return e.getPoints?e.getPoints(t):this.getDefaultPoints(t)},getShape:function(r){var t=this[r]||this[this.defaultShapeType];return t.coordinate=this.coordinate,t},getDefaultPoints:function(){return[]},getDefaultStyle:function(r){return L(r,[this.defaultShapeType,"default","style"],{})},getMarker:function(r,t){var e=this.getShape(r);if(!e.getMarker){var i=this.defaultShapeType;e=this.getShape(i)}var n=this.theme,a=L(n,[r,"default"],{}),o=e.getMarker(t);return nt({},a,o)},drawShape:function(r,t,e){var i=this.getShape(r);return i.draw(t,e)}},xPt={coordinate:null,parsePath:function(r){var t=this.coordinate,e=AOt(r);return t.isPolar?e=COt(t,e):e=xOt(t,e),e},parsePoint:function(r){var t=this.coordinate;return t.convert(r)},parsePoints:function(r){var t=this.coordinate;return r.map(function(e){return t.convert(e)})},draw:function(r,t){}},_T={};function Ks(r,t){var e=fu(r),i=S(S(S({},_Pt),t),{geometryType:r});return _T[e]=i,i}function he(r,t,e){var i=fu(r),n=_T[i],a=S(S({},xPt),e);return n[t]=a,a}function uO(r){var t=fu(r);return _T[t]}function CPt(r,t,e){var i,n;if(e===void 0&&(e={}),!t)return[r];var a=UB(r,t),o=[];if(t.length===1&&e[t[0]]){var s=e[t[0]];try{for(var l=qt(s),u=l.next();!u.done;u=l.next()){var c=u.value,h=a["_".concat(c)];h&&o.push(h)}}catch(v){i={error:v}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(i)throw i.error}}}else for(var f in a)if(a.hasOwnProperty(f)){var d=a[f];o.push(d)}return o}function Pk(r,t){return j0(["color","shape","size","x","y","isInCircle","data","style","defaultStyle","points","mappingData"],function(e){return!Jt(r[e],t[e])})}function Gh(r){return Z(r)?r:r.split("*")}function Fk(r,t){for(var e=[],i=[],n=[],a=new Map,o=0;o<t.length;o++){var s=t[o];r[s]?i.push(s):e.push(s),a.set(s,!0)}return Object.keys(r).forEach(function(l){a.has(l)||n.push(l)}),{added:e,updated:i,removed:n}}var Qs=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;i.type="base",i.attributes={},i.elements=[],i.elementsMap={},i.animateOption=!0,i.attributeOption={},i.lastElementsMap={},i.generatePoints=!1,i.beforeMappingData=null,i.adjusts={},i.idFields=[],i.hasSorted=!1,i.isCoordinateChanged=!1;var n=e.container,a=e.labelsContainer,o=e.coordinate,s=e.data,l=e.sortable,u=l===void 0?!1:l,c=e.visible,h=c===void 0?!0:c,f=e.theme,d=e.scales,v=d===void 0?{}:d,p=e.scaleDefs,g=p===void 0?{}:p,m=e.intervalPadding,y=e.dodgePadding,_=e.maxColumnWidth,x=e.minColumnWidth,C=e.columnWidthRatio,A=e.roseWidthRatio,T=e.multiplePieWidthRatio,w=e.zIndexReversed,M=e.sortZIndex,O=e.useDeferredLabel;return i.container=n,i.labelsContainer=a,i.coordinate=o,i.data=s,i.sortable=u,i.visible=h,i.userTheme=f,i.scales=v,i.scaleDefs=g,i.intervalPadding=m,i.dodgePadding=y,i.maxColumnWidth=_,i.minColumnWidth=x,i.columnWidthRatio=C,i.roseWidthRatio=A,i.multiplePieWidthRatio=T,i.zIndexReversed=w,i.sortZIndex=M,i.useDeferredLabel=O?typeof O=="number"?O:1/0:null,i}return t.prototype.position=function(e){var i=e;Va(e)||(i={fields:Gh(e)});var n=L(i,"fields");return n.length===1&&(n.unshift("1"),cr(i,"fields",n)),cr(this.attributeOption,"position",i),this},t.prototype.color=function(e,i){return this.createAttrOption("color",e,i),this},t.prototype.shape=function(e,i){return this.createAttrOption("shape",e,i),this},t.prototype.size=function(e,i){return this.createAttrOption("size",e,i),this},t.prototype.adjust=function(e){var i=e;return(mt(e)||Va(e))&&(i=[e]),R(i,function(n,a){re(n)||(i[a]={type:n})}),this.adjustOption=i,this},t.prototype.style=function(e,i){if(mt(e)){var n=Gh(e);this.styleOption={fields:n,callback:i}}else{var a=e,n=a.fields,o=a.callback,s=a.cfg;n||o||s?this.styleOption=e:this.styleOption={cfg:e}}return this},t.prototype.tooltip=function(e,i){if(mt(e)){var n=Gh(e);this.tooltipOption={fields:n,callback:i}}else this.tooltipOption=e;return this},t.prototype.animate=function(e){return this.animateOption=e,this},t.prototype.label=function(e,i,n){if(mt(e)){var a={},o=Gh(e);a.fields=o,ut(i)?a.callback=i:Va(i)&&(a.cfg=i),n&&(a.cfg=n),this.labelOption=a}else this.labelOption=e;return this},t.prototype.state=function(e){return this.stateOption=e,this},t.prototype.customInfo=function(e){return this.customOption=e,this},t.prototype.init=function(e){e===void 0&&(e={}),this.setCfg(e),this.initAttributes(),this.processData(this.data),this.adjustScale()},t.prototype.update=function(e){e===void 0&&(e={});var i=e.data,n=e.isDataChanged,a=e.isCoordinateChanged,o=this,s=o.attributeOption,l=o.lastAttributeOption;Jt(s,l)?i&&(n||!Jt(i,this.data))?(this.setCfg(e),this.initAttributes(),this.processData(i)):this.setCfg(e):this.init(e),this.adjustScale(),this.isCoordinateChanged=a},t.prototype.paint=function(e){var i=this;e===void 0&&(e=!1),this.animateOption&&(this.animateOption=nt({},Mk(this.type,this.coordinate),this.animateOption)),this.defaultSize=void 0,this.elementsMap={},this.elements=[];var n=this.getOffscreenGroup();n.clear();var a=this.beforeMappingData,o=this.beforeMapping(a);this.dataArray=new Array(o.length);for(var s=0;s<o.length;s++){var l=o[s];this.dataArray[s]=this.mapping(l)}if(this.updateElements(this.dataArray,e),this.lastElementsMap=this.elementsMap,this.canDoGroupAnimation(e)){var u=this.container,c=this.type,h=this.coordinate,f=L(this.animateOption,"appear"),d=this.getYScale(),v=h.convert({x:0,y:d.scale(this.getYMinValue())});gPt(u,f,c,h,v)}if(this.labelOption){var p=this.useDeferredLabel,g=(function(){return i.renderLabels(vn(i.dataArray),e)}).bind(this);if(typeof p=="number"){var m=typeof p=="number"&&p!==1/0?p:0;if(!window.requestIdleCallback)setTimeout(g,m);else{var y=m&&m!==1/0?{timeout:m}:void 0;window.requestIdleCallback(g,y)}}else g()}this.lastAttributeOption=S({},this.attributeOption),this.visible===!1&&this.changeVisible(!1)},t.prototype.clear=function(){var e=this,i=e.container,n=e.geometryLabel,a=e.offscreenGroup;i&&i.clear(),n&&n.clear(),a&&a.clear(),this.scaleDefs=void 0,this.attributes={},this.scales={},this.elementsMap={},this.lastElementsMap={},this.elements=[],this.adjusts={},this.dataArray=null,this.beforeMappingData=null,this.lastAttributeOption=void 0,this.defaultSize=void 0,this.idFields=[],this.groupScales=void 0,this.hasSorted=!1,this.isCoordinateChanged=!1},t.prototype.destroy=function(){this.clear();var e=this.container;e.remove(!0),this.offscreenGroup&&(this.offscreenGroup.remove(!0),this.offscreenGroup=null),this.geometryLabel&&(this.geometryLabel.destroy(),this.geometryLabel=null),this.theme=void 0,this.shapeFactory=void 0,r.prototype.destroy.call(this)},t.prototype.getGroupScales=function(){return this.groupScales},t.prototype.getAttribute=function(e){return this.attributes[e]},t.prototype.getXScale=function(){return this.getAttribute("position").scales[0]},t.prototype.getYScale=function(){return this.getAttribute("position").scales[1]},t.prototype.getGroupAttributes=function(){var e=[];return R(this.attributes,function(i){Ju.includes(i.type)&&e.push(i)}),e},t.prototype.getDefaultValue=function(e){var i,n=this.getAttribute(e);return n&&Gi(n.scales)&&(i=n.values[0]),i},t.prototype.getAttributeValues=function(e,i){for(var n=[],a=e.scales,o=0,s=a.length;o<s;o++){var l=a[o],u=l.field;l.isIdentity?n.push(l.values):n.push(i[u])}return e.mapping.apply(e,_t([],lt(n),!1))},t.prototype.getAdjust=function(e){return this.adjusts[e]},t.prototype.getCoordinate=function(){return this.coordinate},t.prototype.getData=function(){return this.data},t.prototype.getShapeMarker=function(e,i){var n=this.getShapeFactory();return n.getMarker(e,i)},t.prototype.getElementsBy=function(e){return this.elements.filter(function(i){return e(i)})},t.prototype.getElements=function(){return this.elements},t.prototype.getElementId=function(e){e=Z(e)?e[0]:e;var i=e[Ee];if(this.idFields.length){for(var n=i[this.idFields[0]],a=1;a<this.idFields.length;a++)n+="-"+i[this.idFields[a]];return n}var o=this.type,s=this.getXScale(),l=this.getYScale(),u=s.field||"x",c=l.field||"y",h=i[c],f;s.type==="identity"?f=s.values[0]:f=i[u];var d;o==="interval"||o==="schema"?d="".concat(f):o==="line"||o==="area"||o==="path"?d=o:d="".concat(f,"-").concat(h);for(var v=this.groupScales,a=0,p=v.length;a<p;a++){var g=v[a],m=g.field;d="".concat(d,"-").concat(i[m])}var y=this.getAdjust("dodge");if(y){var _=y.dodgeBy;_&&(d="".concat(d,"-").concat(i[_]))}return this.getAdjust("jitter")&&(d="".concat(d,"-").concat(e.x,"-").concat(e.y)),d},t.prototype.getScaleFields=function(){var e=[],i=new Map,n=this,a=n.attributeOption,o=n.labelOption,s=n.tooltipOption;for(var l in a)if(a.hasOwnProperty(l)){var u=a[l];u.fields?vs(u.fields,e,i):u.values&&vs(u.values,e,i)}return o&&o.fields&&vs(o.fields,e,i),re(s)&&s.fields&&vs(s.fields,e,i),e},t.prototype.changeVisible=function(e){r.prototype.changeVisible.call(this,e);for(var i=this.elements,n=0,a=i.length;n<a;n++){var o=i[n];o.changeVisible(e)}e?(this.container&&this.container.show(),this.labelsContainer&&this.labelsContainer.show()):(this.container&&this.container.hide(),this.labelsContainer&&this.labelsContainer.hide())},t.prototype.getFields=function(){var e=new Map,i=[];return Object.values(this.attributeOption).forEach(function(n){var a=(n==null?void 0:n.fields)||[];a.forEach(function(o){e.has(o)||i.push(o),e.set(o,!0)})},[]),i},t.prototype.getGroupFields=function(){for(var e=[],i=new Map,n=0,a=Ju.length;n<a;n++){var o=Ju[n],s=this.attributeOption[o];s&&s.fields&&vs(s.fields,e,i)}return e},t.prototype.getXYFields=function(){var e=lt(this.attributeOption.position.fields,2),i=e[0],n=e[1];return[i,n]},t.prototype.getXField=function(){return L(this.getXYFields(),[0])},t.prototype.getYField=function(){return L(this.getXYFields(),[1])},t.prototype.getShapes=function(){return this.elements.map(function(e){return e.shape})},t.prototype.getOffscreenGroup=function(){if(!this.offscreenGroup){var e=this.container.getGroupBase();this.offscreenGroup=new e({})}return this.offscreenGroup},t.prototype.sort=function(e){if(!this.hasSorted)for(var i=this.getXScale(),n=i.field,a=0;a<e.length;a++){var o=e[a];o.sort(function(s,l){return i.translate(s[Ee][n])-i.translate(l[Ee][n])})}this.hasSorted=!0},t.prototype.adjustScale=function(){var e=this.getYScale();e&&this.getAdjust("stack")&&this.updateStackRange(e,this.beforeMappingData)},t.prototype.getShapeFactory=function(){var e=this.shapeType;if(uO(e))return this.shapeFactory||(this.shapeFactory=Dr(uO(e))),this.shapeFactory.coordinate=this.coordinate,this.shapeFactory.theme=this.theme.geometries[e]||{},this.shapeFactory},t.prototype.createShapePointsCfg=function(e){var i=this.getXScale(),n=this.getYScale(),a=this.normalizeValues(e[i.field],i),o;return n?o=this.normalizeValues(e[n.field],n):o=e.y?e.y:.1,{x:a,y:o,y0:n?n.scale(this.getYMinValue()):void 0}},t.prototype.createElement=function(e,i,n){n===void 0&&(n=!1);var a=this.container,o=this.getDrawCfg(e),s=this.getShapeFactory(),l=new Ik({shapeFactory:s,container:a,offscreenGroup:this.getOffscreenGroup(),elementIndex:i});return l.animate=this.animateOption,l.geometry=this,l.draw(o,n),l},t.prototype.getDrawCfg=function(e){var i=e[Ee],n={mappingData:e,data:i,x:e.x,y:e.y,color:e.color,size:e.size,isInCircle:this.coordinate.isPolar,customInfo:this.customOption},a=e.shape;!a&&this.getShapeFactory()&&(a=this.getShapeFactory().defaultShapeType),n.shape=a;var o=this.theme.geometries[this.shapeType];n.defaultStyle=L(o,[a,"default"],{}).style,!n.defaultStyle&&this.getShapeFactory()&&(n.defaultStyle=this.getShapeFactory().getDefaultStyle(o));var s=this.styleOption;return s&&(n.style=this.getStyleCfg(s,i)),this.generatePoints&&(n.points=e.points,n.nextPoints=e.nextPoints),n},t.prototype.updateElements=function(e,i){var n,a,o,s,l,u;i===void 0&&(i=!1);for(var c=new Map,h=[],f=new Map,d=0,v=0;v<e.length;v++)for(var p=e[v],g=0;g<p.length;g++){var m=p[g],y=this.getElementId(m),_=c.has(y)?"".concat(y,"-").concat(v,"-").concat(g):y;h.push(_),c.set(_,m),f.set(_,d),d++}this.elements=new Array(d);var x=Fk(this.lastElementsMap,h),C=x.added,A=x.updated,T=x.removed;try{for(var w=qt(C),M=w.next();!M.done;M=w.next()){var y=M.value,m=c.get(y),v=f.get(y),O=this.createElement(m,v,i);this.elements[v]=O,this.elementsMap[y]=O,O.shape&&O.shape.set("zIndex",this.zIndexReversed?this.elements.length-v:v)}}catch(W){n={error:W}}finally{try{M&&!M.done&&(a=w.return)&&a.call(w)}finally{if(n)throw n.error}}try{for(var P=qt(A),D=P.next();!D.done;D=P.next()){var y=D.value,O=this.lastElementsMap[y],m=c.get(y),z=this.getDrawCfg(m),Y=O.getModel(),v=f.get(y);(this.isCoordinateChanged||Pk(z,Y))&&(O.animate=this.animateOption,O.update(z)),this.elements[v]=O,this.elementsMap[y]=O,O.shape&&O.shape.set("zIndex",this.zIndexReversed?this.elements.length-v:v)}}catch(W){o={error:W}}finally{try{D&&!D.done&&(s=P.return)&&s.call(P)}finally{if(o)throw o.error}}this.container&&this.container.sort();try{for(var H=qt(T),N=H.next();!N.done;N=H.next()){var y=N.value,O=this.lastElementsMap[y];O.animate=this.animateOption,O.destroy()}}catch(W){l={error:W}}finally{try{N&&!N.done&&(u=H.return)&&u.call(H)}finally{if(l)throw l.error}}},t.prototype.getLabelType=function(){var e=this,i=e.labelOption,n=e.coordinate,a=e.type,o=n.type,s=n.isTransposed,l=L(i,["cfg","type"]);return l||(o==="polar"?l=s?"pie":"polar":o==="theta"?l="pie":a==="interval"||a==="polygon"?l="interval":l="base"),l},t.prototype.getYMinValue=function(){var e=this.getYScale(),i=e.min,n=e.max,a;return i>=0?a=i:n<=0?a=n:a=0,a},t.prototype.createAttrOption=function(e,i,n){if(j(i)||re(i))re(i)&&Jt(Object.keys(i),["values"])?cr(this.attributeOption,e,{fields:i.values}):cr(this.attributeOption,e,i);else{var a={};Mt(i)?a.values=[i]:a.fields=Gh(i),n&&(ut(n)?a.callback=n:a.values=n),cr(this.attributeOption,e,a)}},t.prototype.initAttributes=function(){var e=this,i=this,n=i.attributes,a=i.attributeOption,o=i.theme,s=i.shapeType;this.groupScales=[];var l={},u=function(f){if(a.hasOwnProperty(f)){var d=a[f];if(!d)return{value:void 0};var v=S({},d),p=v.callback,g=v.values,m=v.fields,y=m===void 0?[]:m,_=y.map(function(C){var A=e.scales[C];if(!l[C]&&Ju.includes(f)){var T=ek(A,L(e.scaleDefs,C),f,e.type);T==="cat"&&(e.groupScales.push(A),l[C]=!0)}return A});v.scales=_,f!=="position"&&_.length===1&&_[0].type==="identity"?v.values=_[0].values:!p&&!g&&(f==="size"?v.values=o.sizes:f==="shape"?v.values=o.shapes[s]||[]:f==="color"&&(_.length?v.values=_[0].values.length<=10?o.colors10:o.colors20:v.values=o.colors10));var x=I8(f);n[f]=new x(v)}};for(var c in a){var h=u(c);if(typeof h=="object")return h.value}},t.prototype.processData=function(e){var i,n;this.hasSorted=!1;for(var a=this.getAttribute("position").scales,o=a.filter(function(T){return T.isCategory}),s=this.groupData(e),l=[],u=0,c=s.length;u<c;u++){for(var h=s[u],f=[],d=0,v=h.length;d<v;d++){var p=h[d],g={};for(var m in p)g[m]=p[m];g[Ee]=p;try{for(var y=(i=void 0,qt(o)),_=y.next();!_.done;_=y.next()){var x=_.value,C=x.field;g[C]=x.translate(g[C])}}catch(T){i={error:T}}finally{try{_&&!_.done&&(n=y.return)&&n.call(y)}finally{if(i)throw i.error}}f.push(g)}l.push(f)}var A=this.adjustData(l);return this.beforeMappingData=A,A},t.prototype.adjustData=function(e){var i=this.adjustOption,n=this,a=n.intervalPadding,o=n.dodgePadding,s=n.theme,l=this.maxColumnWidth||s.maxColumnWidth,u=this.minColumnWidth||s.minColumnWidth,c=this.columnWidthRatio||s.columnWidthRatio,h=e;if(i){var f=this.getXScale(),d=this.getYScale(),v=f.field,p=d?d.field:null,g=fv(this.coordinate),m=f.values.length,y=this.getAttribute("size"),_=void 0;y&&(_=y.values[0]);for(var x=0,C=i.length;x<C;x++){var A=i[x],T=S({xField:v,yField:p,intervalPadding:a,dodgePadding:o,xDimensionLength:g,groupNum:m,defaultSize:_,maxColumnWidth:l,minColumnWidth:u,columnWidthRatio:c},A),w=A.type;if(w==="dodge"){var M=[];if(f.isCategory||f.type==="identity")M.push("x");else if(!d)M.push("y");else throw new Error("dodge is not support linear attribute, please use category attribute!");T.adjustNames=M,T.dodgeRatio=c}else if(w==="stack"){var O=this.coordinate;if(!d){T.height=O.getHeight();var P=this.getDefaultValue("size")||3;T.size=P}!O.isTransposed&&j(T.reverseOrder)&&(T.reverseOrder=!0)}var D=y8(w);T.dimValuesMap={},f&&f.values&&(T.dimValuesMap[f.field]=f.values.map(function(Y){return f.translate(Y)}));var z=new D(T);h=z.process(h),this.adjusts[w]=z}}return h},t.prototype.groupData=function(e){for(var i=this.getGroupScales(),n=this.scaleDefs,a={},o=[],s=0;s<i.length;s++){var l=i[s],u=l.field;o.push(u),L(n,[u,"values"])&&(a[u]=n[u].values)}return CPt(e,o,a)},t.prototype.updateStackRange=function(e,i){for(var n=vn(i),a=e.field,o=e.min,s=e.max,l=0;l<n.length;l++){var u=n[l],c=Math.min.apply(null,u[a]),h=Math.max.apply(null,u[a]);c<o&&(o=c),h>s&&(s=h)}var f=this.scaleDefs,d={};o<e.min&&!L(f,[a,"min"])&&(d.min=o),s>e.max&&!L(f,[a,"max"])&&(d.max=s),e.change(d)},t.prototype.beforeMapping=function(e){var i=e;if(this.sortable&&this.sort(i),this.generatePoints)for(var n=0,a=i.length;n<a;n++){var o=i[n];this.generateShapePoints(o);var s=i[n+1];s&&(this.generateShapePoints(s),o[0].nextPoints=s[0].points)}return i},t.prototype.generateShapePoints=function(e){for(var i=this.getShapeFactory(),n=this.getAttribute("shape"),a=0;a<e.length;a++){var o=e[a],s=this.createShapePointsCfg(o),l=n?this.getAttributeValues(n,o):null,u=i.getShapePoints(l,s);o.points=u}},t.prototype.normalizeValues=function(e,i){var n=[];if(Z(e))for(var a=0;a<e.length;a++){var o=e[a];n.push(i.scale(o))}else n=i.scale(e);return n},t.prototype.mapping=function(e){for(var i=this.attributes,n=[],a=0;a<e.length;a++){var o=e[a],s={_origin:o[Ee],points:o.points,nextPoints:o.nextPoints};for(var l in i)if(i.hasOwnProperty(l)){var u=i[l],c=u.names,h=this.getAttributeValues(u,o);if(c.length>1)for(var f=0;f<h.length;f+=1){var d=h[f],v=c[f];s[v]=Z(d)&&d.length===1?d[0]:d}else s[c[0]]=h.length===1?h[0]:h}this.convertPoint(s),n.push(s)}return n},t.prototype.convertPoint=function(e){var i=e.x,n=e.y,a,o,s,l=this.coordinate;if(Z(i)&&Z(n)){a=[],o=[];for(var u=0,c=0,h=i.length,f=n.length;u<h&&c<f;u+=1,c+=1)s=l.convert({x:i[u],y:n[c]}),a.push(s.x),o.push(s.y)}else if(Z(n)){o=[];for(var d=0;d<n.length;d++){var v=n[d];s=l.convert({x:i,y:v}),a&&a!==s.x?(Z(a)||(a=[a]),a.push(s.x)):a=s.x,o.push(s.y)}}else if(Z(i)){a=[];for(var d=0;d<i.length;d++){var p=i[d];s=l.convert({x:p,y:n}),o&&o!==s.y?(Z(o)||(o=[o]),o.push(s.y)):o=s.y,a.push(s.x)}}else{var g=l.convert({x:i,y:n});a=g.x,o=g.y}e.x=a,e.y=o},t.prototype.getStyleCfg=function(e,i){var n=e.fields,a=n===void 0?[]:n,o=e.callback,s=e.cfg;if(s)return s;var l=a.map(function(u){return i[u]});return o.apply(void 0,_t([],lt(l),!1))},t.prototype.setCfg=function(e){var i=this,n=e.coordinate,a=e.data,o=e.theme,s=e.scaleDefs;n&&(this.coordinate=n),a&&(this.data=a),s&&(this.scaleDefs=s,this.idFields=[],R(s,function(l,u){l&&l.key&&i.idFields.push(u)})),o&&(this.theme=this.userTheme?nt({},o,this.userTheme):o)},t.prototype.renderLabels=function(e,i){return i===void 0&&(i=!1),xi(this,void 0,void 0,function(){var n,a,o,s,l,u,c,h,f,d,v,p,g=this;return da(this,function(m){switch(m.label){case 0:return n=this.geometryLabel,this.emit(As.BEFORE_RENDER_LABEL),n||(a=this.getLabelType(),o=mPt(a),n=new o(this),this.geometryLabel=n),[4,n.render(e,i)];case 1:m.sent(),s=n.labelsRenderer.shapesMap,l=new Map,R(s,function(y,_){for(var x=y.getChildren()||[],C=0;C<x.length;C++){var A=x[C],T=g.elementsMap[A.get("elementId")||_.split(" ")[0]];if(T){A.cfg.name=["element","label"],A.cfg.element=T;var w=l.get(T)||new Set;w.add(y),l.set(T,w)}}});try{for(u=qt(l.entries()),c=u.next();!c.done;c=u.next())h=lt(c.value,2),f=h[0],d=h[1],f.labelShape=_t([],lt(d),!1)}catch(y){v={error:y}}finally{try{c&&!c.done&&(p=u.return)&&p.call(u)}finally{if(v)throw v.error}}return this.emit(As.AFTER_RENDER_LABEL),[2]}})})},t.prototype.canDoGroupAnimation=function(e){return!e&&this.animateOption&&(L(this.animateOption,"appear")===void 0||L(this.animateOption,"appear")&&L(this.animateOption,["appear","animation"])===void 0)},t}(QA),gy=hr;function pv(r,t,e){var i=gy(r.getMatrix(),[["t",t,e]]);r.setMatrix(i)}function EPt(r,t){var e=r.attr(),i=e.x,n=e.y,a=gy(r.getMatrix(),[["t",-i,-n],["r",t],["t",i,n]]);return a}function xT(r,t){var e=EPt(r,t);r.setMatrix(e)}function SPt(r,t){var e=r.getBBox(),i=(e.minX+e.maxX)/2,n=(e.minY+e.maxY)/2;r.applyToMatrix([i,n,1]);var a=gy(r.getMatrix(),[["t",-i,-n],["s",t,t],["t",i,n]]);r.setMatrix(a)}function ks(r){return r.find(function(t){return t.get("type")==="text"})}function Bk(r,t,e){e===void 0&&(e=[0,0,0,0]);var i=r&&r.getChildren()[0];if(i){var n=i.clone();t!=null&&t.rotate&&xT(n,-t.rotate);var a=n.getCanvasBBox(),o=a.x,s=a.y,l=a.width,u=a.height;n.destroy();var c=e;return j(c)?c=[2,2,2,2]:Mt(c)&&(c=new Array(4).fill(c)),{x:o-c[3],y:s-c[0],width:l+c[1]+c[3],height:u+c[0]+c[2],rotation:(t==null?void 0:t.rotate)||0}}return{x:0,y:0,width:0,height:0,rotation:0}}function APt(r,t,e){e===void 0&&(e=0);var i=Math.max(0,Math.min(r.x+r.width+e,t.x+t.width+e)-Math.max(r.x-e,t.x-e)),n=Math.max(0,Math.min(r.y+r.height+e,t.y+t.height+e)-Math.max(r.y-e,t.y-e));return i*n}function TPt(r,t){var e=r.getBBox();return j0(t,function(i){var n=i.getBBox();return APt(e,n,2)>0})}function Dk(r,t,e){var i=e.data,n=e.origin,a=e.animateCfg,o=e.coordinate,s=L(a,"update");r.set("data",i),r.set("origin",n),r.set("animateCfg",a),r.set("coordinate",o),r.set("visible",t.get("visible")),(r.getChildren()||[]).forEach(function(l,u){var c=t.getChildByIndex(u);if(!c)r.removeChild(l),l.remove(!0);else{l.set("data",i),l.set("origin",n),l.set("animateCfg",a),l.set("coordinate",o);var h=tk(l,c);s?gc(l,s,{toAttrs:h,coordinate:o}):l.attr(h),c.isGroup()&&Dk(l,c,e)}}),R(t.getChildren(),function(l,u){Z(r.getChildren())&&u>=r.getCount()&&(l.destroyed||r.add(l))})}var bPt=function(){function r(t){this.shapesMap={};var e=t.layout,i=t.container;this.layout=e,this.container=i}return r.prototype.render=function(t,e,i){return i===void 0&&(i=!1),xi(this,void 0,void 0,function(){var n,a,o,s,l,u,c,h,f=this;return da(this,function(d){switch(d.label){case 0:if(n={},a=this.createOffscreenGroup(),!t.length)return[3,2];try{for(o=qt(t),s=o.next();!s.done;s=o.next())l=s.value,l&&(n[l.id]=this.renderLabel(l,a))}catch(v){c={error:v}}finally{try{s&&!s.done&&(h=o.return)&&h.call(o)}finally{if(c)throw c.error}}return[4,this.doLayout(t,e,n)];case 1:d.sent(),this.renderLabelLine(t,n),this.renderLabelBackground(t,n),this.adjustLabel(t,n),d.label=2;case 2:return u=this.shapesMap,R(n,function(v,p){if(v.destroyed)delete n[p];else{if(u[p]){var g=v.get("data"),m=v.get("origin"),y=v.get("coordinate"),_=v.get("animateCfg"),x=u[p];Dk(x,n[p],{data:g,origin:m,animateCfg:_,coordinate:y}),n[p]=x}else{if(f.container.destroyed)return;f.container.add(v);var C=L(v.get("animateCfg"),i?"enter":"appear");C&&gc(v,C,{toAttrs:S({},v.attr()),coordinate:v.get("coordinate")})}delete u[p]}}),R(u,function(v){var p=L(v.get("animateCfg"),"leave");p?gc(v,p,{toAttrs:null,coordinate:v.get("coordinate")}):v.remove(!0)}),this.shapesMap=n,a.destroy(),[2]}})})},r.prototype.clear=function(){this.container.clear(),this.shapesMap={}},r.prototype.destroy=function(){this.container.destroy(),this.shapesMap=null},r.prototype.renderLabel=function(t,e){var i=t.id,n=t.elementId,a=t.data,o=t.mappingData,s=t.coordinate,l=t.animate,u=t.content,c=t.capture,h={id:i,elementId:n,capture:c,data:a,origin:S(S({},o),{data:o[Ee]}),coordinate:s},f=e.addGroup(S({name:"label",animateCfg:this.animate===!1||l===null||l===!1?!1:nt({},this.animate,l)},h)),d;if(u.isGroup&&u.isGroup()||u.isShape&&u.isShape()){var v=u.getCanvasBBox(),p=v.width,g=v.height,m=L(t,"textAlign","left"),y=t.x,_=t.y-g/2;m==="center"?y=y-p/2:(m==="right"||m==="end")&&(y=y-p),pv(u,y,_),d=u,f.add(u)}else{var x=L(t,["style","fill"]);d=f.addShape("text",S({attrs:S(S({x:t.x,y:t.y,textAlign:t.textAlign,textBaseline:L(t,"textBaseline","middle"),text:t.content},t.style),{fill:pit(x)?t.color:x})},h))}return t.rotate&&xT(d,t.rotate),f},r.prototype.doLayout=function(t,e,i){return xi(this,void 0,void 0,function(){var n,a=this;return da(this,function(o){switch(o.label){case 0:return this.layout?(n=Z(this.layout)?this.layout:[this.layout],[4,Promise.all(n.map(function(s){var l=yPt(L(s,"type",""));if(l){var u=[],c=[];return R(i,function(h,f){u.push(h),c.push(e[h.get("elementId")])}),l(t,u,c,a.region,s.cfg)}}))]):[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}})})},r.prototype.renderLabelLine=function(t,e){R(t,function(i){var n=L(i,"coordinate");if(!(!i||!n)){var a=n.getCenter(),o=n.getRadius();if(i.labelLine){var s=L(i,"labelLine",{}),l=i.id,u=s.path;if(!u){var c=sr(a.x,a.y,o,i.angle);u=[["M",c.x,c.y],["L",i.x,i.y]]}var h=e[l];h.destroyed||h.addShape("path",{capture:!1,attrs:S({path:u,stroke:i.color?i.color:L(i,["style","fill"],"#000"),fill:null},s.style),id:l,origin:i.mappingData,data:i.data,coordinate:i.coordinate})}}})},r.prototype.renderLabelBackground=function(t,e){R(t,function(i){var n=L(i,"coordinate"),a=L(i,"background");if(!(!a||!n)){var o=i.id,s=e[o];if(!s.destroyed){var l=s.getChildren()[0];if(l){var u=Bk(s,i,a.padding),c=u.rotation,h=Ut(u,["rotation"]),f=s.addShape("rect",{attrs:S(S({},h),a.style||{}),id:o,origin:i.mappingData,data:i.data,coordinate:i.coordinate});if(f.setZIndex(-1),c){var d=l.getMatrix();f.setMatrix(d)}}}}})},r.prototype.createOffscreenGroup=function(){var t=this.container,e=t.getGroupBase(),i=new e({});return i},r.prototype.adjustLabel=function(t,e){R(t,function(i){if(i){var n=i.id,a=e[n];if(!a.destroyed){var o=a.findAll(function(s){return s.get("type")!=="path"});R(o,function(s){s&&(i.offsetX&&s.attr("x",s.attr("x")+i.offsetX),i.offsetY&&s.attr("y",s.attr("y")+i.offsetY))})}}})},r}();function cO(r){var t=0;return R(r,function(e){t+=e}),t/r.length}var yy=function(){function r(t){this.geometry=t}return r.prototype.getLabelItems=function(t){var e=this,i=[],n=this.getLabelCfgs(t);return R(t,function(a,o){var s=n[o];if(!s||j(a.x)||j(a.y)){i.push(null);return}var l=Z(s.content)?s.content:[s.content];s.content=l;var u=l.length;R(l,function(c,h){if(j(c)||c===""){i.push(null);return}var f=S(S({},s),e.getLabelPoint(s,a,h));f.textAlign||(f.textAlign=e.getLabelAlign(f,h,u)),f.offset<=0&&(f.labelLine=null),i.push(f)})}),i},r.prototype.render=function(t,e){return e===void 0&&(e=!1),xi(this,void 0,void 0,function(){var i,n,a;return da(this,function(o){switch(o.label){case 0:return i=this.getLabelItems(t),n=this.getLabelsRenderer(),a=this.getGeometryShapes(),[4,n.render(i,a,e)];case 1:return o.sent(),[2]}})})},r.prototype.clear=function(){var t=this.labelsRenderer;t&&t.clear()},r.prototype.destroy=function(){var t=this.labelsRenderer;t&&t.destroy(),this.labelsRenderer=null},r.prototype.getCoordinate=function(){return this.geometry.coordinate},r.prototype.getDefaultLabelCfg=function(t,e){var i=this.geometry,n=i.type,a=i.theme;return n==="polygon"||n==="interval"&&e==="middle"||t<0&&!["line","point","path"].includes(n)?L(a,"innerLabels",{}):L(a,"labels",{})},r.prototype.getThemedLabelCfg=function(t){var e=this.geometry,i=this.getDefaultLabelCfg(),n=e.type,a=e.theme,o;return n==="polygon"||t.offset<0&&!["line","point","path"].includes(n)?o=nt({},i,a.innerLabels,t):o=nt({},i,a.labels,t),o},r.prototype.setLabelPosition=function(t,e,i,n){},r.prototype.getLabelOffset=function(t){var e=this.getCoordinate(),i=this.getOffsetVector(t);return e.isTransposed?i[0]:i[1]},r.prototype.getLabelOffsetPoint=function(t,e,i){var n=t.offset,a=this.getCoordinate(),o=a.isTransposed,s=o?"x":"y",l=o?1:-1,u={x:0,y:0};return e>0||i===1?u[s]=n*l:u[s]=n*l*-1,u},r.prototype.getLabelPoint=function(t,e,i){var n=this.getCoordinate(),a=t.content.length;function o(g,m,y){y===void 0&&(y=!1);var _=g;return Z(_)&&(t.content.length===1?y?_=cO(_):_.length<=2?_=_[g.length-1]:_=cO(_):_=_[m]),_}var s={content:t.content[i],x:0,y:0,start:{x:0,y:0},color:"#fff"},l=Z(e.shape)?e.shape[0]:e.shape,u=l==="funnel"||l==="pyramid";if(this.geometry.type==="polygon"){var c=JLt(e.x,e.y);s.x=c[0],s.y=c[1]}else this.geometry.type==="interval"&&!u?(s.x=o(e.x,i,!0),s.y=o(e.y,i)):(s.x=o(e.x,i),s.y=o(e.y,i));if(u){var h=L(e,"nextPoints"),f=L(e,"points");if(h){var d=n.convert(f[1]),v=n.convert(h[1]);s.x=(d.x+v.x)/2,s.y=(d.y+v.y)/2}else if(l==="pyramid"){var d=n.convert(f[1]),v=n.convert(f[2]);s.x=(d.x+v.x)/2,s.y=(d.y+v.y)/2}}t.position&&this.setLabelPosition(s,e,i,t.position);var p=this.getLabelOffsetPoint(t,i,a);return s.start={x:s.x,y:s.y},s.x+=p.x,s.y+=p.y,s.color=e.color,s},r.prototype.getLabelAlign=function(t,e,i){var n="center",a=this.getCoordinate();if(a.isTransposed){var o=t.offset;o<0?n="right":o===0?n="center":n="left",i>1&&e===0&&(n==="right"?n="left":n==="left"&&(n="right"))}return n},r.prototype.getLabelId=function(t){var e=this.geometry,i=e.type,n=e.getXScale(),a=e.getYScale(),o=t[Ee],s=e.getElementId(t);return i==="line"||i==="area"?s+=" ".concat(o[n.field]):i==="path"&&(s+=" ".concat(o[n.field],"-").concat(o[a.field])),s},r.prototype.getLabelsRenderer=function(){var t=this.geometry,e=t.labelsContainer,i=t.labelOption,n=t.canvasRegion,a=t.animateOption,o=this.geometry.coordinate,s=this.labelsRenderer;return s||(s=new bPt({container:e,layout:L(i,["cfg","layout"],{type:this.defaultLayout})}),this.labelsRenderer=s),s.region=n,s.animate=a?Mk("label",o):!1,s},r.prototype.getLabelCfgs=function(t){var e=this,i=this.geometry,n=i.labelOption,a=i.scales,o=i.coordinate,s=n,l=s.fields,u=s.callback,c=s.cfg,h=l.map(function(d){return a[d]}),f=[];return R(t,function(d,v){var p=d[Ee],g=e.getLabelText(p,h),m;if(u){var y=l.map(function(T){return p[T]});if(m=u.apply(void 0,_t([],lt(y),!1)),j(m)){f.push(null);return}}var _=S(S({id:e.getLabelId(d),elementId:e.geometry.getElementId(d),data:p,mappingData:d,coordinate:o},c),m);ut(_.position)&&(_.position=_.position(p,d,v));var x=e.getLabelOffset(_.offset||0),C=e.getDefaultLabelCfg(x,_.position);_=nt({},C,_),_.offset=e.getLabelOffset(_.offset||0);var A=_.content;ut(A)?_.content=A(p,d,v):Wr(A)&&(_.content=g[0]),f.push(_)}),f},r.prototype.getLabelText=function(t,e){var i=[];return R(e,function(n){var a=t[n.field];Z(a)?a=a.map(function(o){return n.getText(o)}):a=n.getText(a),j(a)||a===""?i.push(null):i.push(a)}),i},r.prototype.getOffsetVector=function(t){t===void 0&&(t=0);var e=this.getCoordinate(),i=0;return Mt(t)&&(i=t),e.isTransposed?e.applyMatrix(i,0):e.applyMatrix(0,i)},r.prototype.getGeometryShapes=function(){var t=this.geometry,e={};return R(t.elementsMap,function(i,n){e[n]=i.shape}),R(t.getOffscreenGroup().getChildren(),function(i){var n=t.getElementId(i.get("origin").mappingData);e[n]=i}),e},r}();function OC(r,t,e){if(!r)return e;var i;if(r.callback&&r.callback.length>1){var n=Array(r.callback.length-1).fill("");i=r.mapping.apply(r,_t([t],lt(n),!1)).join("")}else i=r.mapping(t).join("");return i||e}var au={hexagon:function(r,t,e){var i=e/2*Math.sqrt(3);return[["M",r,t-e],["L",r+i,t-e/2],["L",r+i,t+e/2],["L",r,t+e],["L",r-i,t+e/2],["L",r-i,t-e/2],["Z"]]},bowtie:function(r,t,e){var i=e-1.5;return[["M",r-e,t-i],["L",r+e,t+i],["L",r+e,t-i],["L",r-e,t+i],["Z"]]},cross:function(r,t,e){return[["M",r-e,t-e],["L",r+e,t+e],["M",r+e,t-e],["L",r-e,t+e]]},tick:function(r,t,e){return[["M",r-e/2,t-e],["L",r+e/2,t-e],["M",r,t-e],["L",r,t+e],["M",r-e/2,t+e],["L",r+e/2,t+e]]},plus:function(r,t,e){return[["M",r-e,t],["L",r+e,t],["M",r,t-e],["L",r,t+e]]},hyphen:function(r,t,e){return[["M",r-e,t],["L",r+e,t]]},line:function(r,t,e){return[["M",r,t-e],["L",r,t+e]]}},wPt=["line","cross","tick","plus","hyphen"];function RPt(r,t){return ut(t)?t(r):nt({},r,t)}function MPt(r,t){var e=r.symbol;if(mt(e)&&wPt.indexOf(e)!==-1){var i=L(r,"style",{}),n=L(i,"lineWidth",1),a=i.stroke||i.fill||t;r.style=nt({},r.style,{lineWidth:n,stroke:a,fill:null})}}function Nk(r){var t=r.symbol;mt(t)&&au[t]&&(r.symbol=au[t])}function W_(r){return r.startsWith(it.LEFT)||r.startsWith(it.RIGHT)?"vertical":"horizontal"}function kk(r,t,e,i,n){var a=e.getScale(e.type);if(a.isCategory){var o=a.field,s=t.getAttribute("color"),l=t.getAttribute("shape"),u=r.getTheme().defaultColor,c=t.coordinate.isPolar;return a.getTicks().map(function(h,f){var d,v=h.text,p=h.value,g=v,m=a.invert(p),y=r.filterFieldData(o,[(d={},d[o]=m,d)]).length===0;R(r.views,function(T){var w;T.filterFieldData(o,[(w={},w[o]=m,w)]).length||(y=!0)});var _=OC(s,m,u),x=OC(l,m,"point"),C=t.getShapeMarker(x,{color:_,isInPolar:c}),A=n;return ut(A)&&(A=A(g,f,S({name:g,value:m},nt({},i,C)))),C=nt({},i,C,Di(S({},A),["style"])),MPt(C,_),A&&A.style&&(C.style=RPt(C.style,A.style)),Nk(C),{id:m,name:g,value:m,marker:C,unchecked:y}})}return[]}function IPt(r,t,e){return e.map(function(i,n){var a=t;ut(a)&&(a=a(i.name,n,nt({},r,i)));var o=ut(i.marker)?i.marker(i.name,n,nt({},r,i)):i.marker,s=nt({},r,a,o);return Nk(s),i.marker=s,i})}function hO(r,t){var e=L(r,["components","legend"],{});return nt({},L(e,["common"],{}),nt({},L(e,[t],{})))}function V_(r){return r?!1:r==null||isNaN(r)}function fO(r){if(Z(r))return V_(r[1].y);var t=r.y;return Z(t)?V_(t[0]):V_(t)}function _y(r,t,e){if(t===void 0&&(t=!1),e===void 0&&(e=!0),!r.length||r.length===1&&!e)return[];if(t){for(var i=[],n=0,a=r.length;n<a;n++){var o=r[n];fO(o)||i.push(o)}return[i]}for(var s=[],l=[],n=0,a=r.length;n<a;n++){var o=r[n];fO(o)?l.length&&(l.length===1&&!e||s.push(l),l=[]):l.push(o)}return l.length&&s.push(l),s}function Uk(r){for(var t=[],e=0;e<r.length;e++){var i=r[e];if(i){var n=e===0?"M":"L";t.push([n,i.x,i.y])}}var a=r[0];return a&&(t.push(["L",a.x,a.y]),t.push(["z"])),t}function zk(r){for(var t=r.length/2,e=[],i=[],n=0;n<r.length;n++)n<t?e.push(r[n]):i.push(r[n]);var a=R0(e,!1),o=R0(i,!1);i.length&&a.push(["L",i[0].x,i[0].y]),o.shift();var s=a.concat(o);return e.length&&s.push(["L",e[0].x,e[0].y]),s.push(["z"]),s}function nr(r,t,e,i){i===void 0&&(i="");var n=r.style,a=n===void 0?{}:n,o=r.defaultStyle,s=r.color,l=r.size,u=S(S({},o),a);return s&&(t&&(a.stroke||(u.stroke=s)),e&&(a.fill||(u.fill=s))),i&&j(a[i])&&!j(l)&&(u[i]=l),u}function Hk(r){return nt({},{fill:"#CCD6EC",fillOpacity:.3},L(r,["background","style"]))}function CT(r){var t=r.x,e=Z(r.y)?r.y:[r.y];return e.map(function(i,n){return{x:Z(t)?t[n]:t,y:i}})}var LPt={line:function(r,t,e){return[["M",r-e,t],["L",r+e,t]]},dot:function(r,t,e){return[["M",r-e,t],["L",r+e,t]]},dash:function(r,t,e){return[["M",r-e,t],["L",r+e,t]]},smooth:function(r,t,e){return[["M",r-e,t],["A",e/2,e/2,0,1,1,r,t],["A",e/2,e/2,0,1,0,r+e,t]]},hv:function(r,t,e){return[["M",r-e-1,t-2.5],["L",r,t-2.5],["L",r,t+2.5],["L",r+e+1,t+2.5]]},vh:function(r,t,e){return[["M",r-e-1,t+2.5],["L",r,t+2.5],["L",r,t-2.5],["L",r+e+1,t-2.5]]},hvh:function(r,t,e){return[["M",r-(e+1),t+2.5],["L",r-e/2,t+2.5],["L",r-e/2,t-2.5],["L",r+e/2,t-2.5],["L",r+e/2,t+2.5],["L",r+e+1,t+2.5]]},vhv:function(r,t){return[["M",r-5,t+2.5],["L",r-5,t],["L",r,t],["L",r,t-3],["L",r,t+3],["L",r+6.5,t+3]]}};function $k(r,t){var e=r.color;return{symbol:LPt[t],style:{lineWidth:2,r:6,stroke:e}}}function OPt(r,t,e){for(var i=r.isStack,n=r.connectNulls,a=r.isInCircle,o=r.showSinglePoint,s=nr(r,!0,!1,"lineWidth"),l=_y(r.points,n,o),u=[],c=0,h=l.length;c<h;c++){var f=l[c];u=u.concat(Wk(f,a,i,t,e,s))}return s.path=u,s}function PC(r,t,e,i,n){if(r.length===1)return[["M",r[0].x,r[0].y-n.lineWidth/2],["L",r[0].x,r[0].y],["L",r[0].x,r[0].y+n.lineWidth/2]];var a;return e?(t&&r.length&&r.push({x:r[0].x,y:r[0].y}),a=R0(r,!1,i)):(a=dv(r,!1),t&&a.push(["Z"])),a}function PPt(r,t,e,i,n,a){var o=[],s=[];R(r,function(c){var h=CT(c);o.push(h[1]),s.push(h[0])});var l=PC(o,t,i,n,a),u=PC(s,t,i,n,a);return e?l:l.concat(u)}function Wk(r,t,e,i,n,a){if(r.length){var o=r[0];return Z(o.y)?PPt(r,t,e,i,n,a):PC(r,t,i,n,a)}return[]}Ks("line",{defaultShapeType:"line"});R(["line","dot","dash","smooth"],function(r){he("line",r,{draw:function(t,e){var i=r==="smooth",n;if(i){var a=this.coordinate,o=a.start,s=a.end;n=[[o.x,s.y],[s.x,o.y]]}var l=OPt(t,i,n),u=e.addShape({type:"path",attrs:l,name:"line",capture:!i});return u},getMarker:function(t){return $k(t,r)}})});var Zi={getLegendItems:kk,translate:pv,rotate:xT,zoom:SPt,transform:gy,getAngle:Sd,getSectorPath:bs,polarToCartesian:sr,getDelegationObject:nu,getTooltipItems:pT,getMappingValue:OC,getPath:Wk,getPathPoints:_y},ns={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},Ce={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},ia=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],FPt=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],BPt=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],DPt=function(r){r===void 0&&(r={});var t=r.paletteQualitative10,e=t===void 0?ia:t,i=r.paletteQualitative20,n=i===void 0?FPt:i,a=r.brandColor,o=a===void 0?e[0]:a,s={backgroundColor:"#141414",brandColor:o,subColor:"rgba(255,255,255,0.05)",paletteQualitative10:e,paletteQualitative20:n,paletteSemanticRed:"#F4664A",paletteSemanticGreen:"#30BF78",paletteSemanticYellow:"#FAAD14",paletteSequence:BPt,fontFamily:`"Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`,axisLineBorderColor:Ce[25],axisLineBorder:1,axisLineDash:null,axisTitleTextFillColor:Ce[65],axisTitleTextFontSize:12,axisTitleTextLineHeight:12,axisTitleTextFontWeight:"normal",axisTitleSpacing:12,axisDescriptionIconFillColor:ns[85],axisTickLineBorderColor:Ce[25],axisTickLineLength:4,axisTickLineBorder:1,axisSubTickLineBorderColor:Ce[15],axisSubTickLineLength:2,axisSubTickLineBorder:1,axisLabelFillColor:Ce[45],axisLabelFontSize:12,axisLabelLineHeight:12,axisLabelFontWeight:"normal",axisLabelOffset:8,axisGridBorderColor:Ce[15],axisGridBorder:1,axisGridLineDash:null,legendTitleTextFillColor:Ce[45],legendTitleTextFontSize:12,legendTitleTextLineHeight:21,legendTitleTextFontWeight:"normal",legendMarkerColor:ia[0],legendMarkerSpacing:8,legendMarkerSize:4,legendCircleMarkerSize:4,legendSquareMarkerSize:4,legendLineMarkerSize:5,legendItemNameFillColor:Ce[65],legendItemNameFontSize:12,legendItemNameLineHeight:12,legendItemNameFontWeight:"normal",legendItemSpacing:24,legendItemMarginBottom:12,legendSpacing:16,legendPadding:[8,8,8,8],legendHorizontalPadding:[8,0,8,0],legendVerticalPadding:[0,8,0,8],legendPageNavigatorMarkerSize:12,legendPageNavigatorMarkerInactiveFillColor:Ce[45],legendPageNavigatorMarkerInactiveFillOpacity:.45,legendPageNavigatorMarkerFillColor:Ce[45],legendPageNavigatorMarkerFillOpacity:1,legendPageNavigatorTextFillColor:Ce[65],legendPageNavigatorTextFontSize:12,sliderRailFillColor:Ce[15],sliderRailBorder:0,sliderRailBorderColor:null,sliderRailWidth:100,sliderRailHeight:12,sliderLabelTextFillColor:Ce[45],sliderLabelTextFontSize:12,sliderLabelTextLineHeight:12,sliderLabelTextFontWeight:"normal",sliderHandlerFillColor:ns[6],sliderHandlerWidth:10,sliderHandlerHeight:14,sliderHandlerBorder:1,sliderHandlerBorderColor:ns[25],annotationArcBorderColor:Ce[15],annotationArcBorder:1,annotationLineBorderColor:Ce[25],annotationLineBorder:1,annotationLineDash:null,annotationTextFillColor:Ce[65],annotationTextFontSize:12,annotationTextLineHeight:12,annotationTextFontWeight:"normal",annotationTextBorderColor:null,annotationTextBorder:0,annotationRegionFillColor:Ce[100],annotationRegionFillOpacity:.06,annotationRegionBorder:0,annotationRegionBorderColor:null,annotationDataMarkerLineLength:16,tooltipCrosshairsBorderColor:Ce[25],tooltipCrosshairsBorder:1,tooltipCrosshairsLineDash:null,tooltipContainerFillColor:"#1f1f1f",tooltipContainerFillOpacity:.95,tooltipContainerShadow:"0px 2px 4px rgba(0,0,0,.5)",tooltipContainerBorderRadius:3,tooltipTextFillColor:Ce[65],tooltipTextFontSize:12,tooltipTextLineHeight:12,tooltipTextFontWeight:"bold",labelFillColor:Ce[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,labelLineHeight:12,labelFontWeight:"normal",labelBorderColor:null,labelBorder:0,innerLabelFillColor:ns[100],innerLabelFontSize:12,innerLabelLineHeight:12,innerLabelFontWeight:"normal",innerLabelBorderColor:null,innerLabelBorder:0,overflowLabelFillColor:Ce[65],overflowLabelFillColorDark:"#2c3542",overflowLabelFillColorLight:"#ffffff",overflowLabelFontSize:12,overflowLabelLineHeight:12,overflowLabelFontWeight:"normal",overflowLabelBorderColor:ns[100],overflowLabelBorder:1,labelLineBorder:1,labelLineBorderColor:Ce[25],cSliderRailHieght:16,cSliderBackgroundFillColor:"#416180",cSliderBackgroundFillOpacity:.05,cSliderForegroundFillColor:"#5B8FF9",cSliderForegroundFillOpacity:.15,cSliderHandlerHeight:24,cSliderHandlerWidth:10,cSliderHandlerFillColor:"#F7F7F7",cSliderHandlerFillOpacity:1,cSliderHandlerHighlightFillColor:"#FFF",cSliderHandlerBorderColor:"#BFBFBF",cSliderHandlerBorder:1,cSliderHandlerBorderRadius:2,cSliderTextFillColor:"#fff",cSliderTextFillOpacity:.45,cSliderTextFontSize:12,cSliderTextLineHeight:12,cSliderTextFontWeight:"normal",cSliderTextBorderColor:null,cSliderTextBorder:0,scrollbarTrackFillColor:"rgba(255,255,255,0.65)",scrollbarThumbFillColor:"rgba(0,0,0,0.35)",scrollbarThumbHighlightFillColor:"rgba(0,0,0,0.45)",pointFillColor:ia[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:ns[100],pointBorderOpacity:1,pointActiveBorderColor:Ce[100],pointSelectedBorder:2,pointSelectedBorderColor:Ce[100],pointInactiveFillOpacity:.3,pointInactiveBorderOpacity:.3,hollowPointSize:4,hollowPointBorder:1,hollowPointBorderColor:ia[0],hollowPointBorderOpacity:.95,hollowPointFillColor:ns[100],hollowPointActiveBorder:1,hollowPointActiveBorderColor:Ce[100],hollowPointActiveBorderOpacity:1,hollowPointSelectedBorder:2,hollowPointSelectedBorderColor:Ce[100],hollowPointSelectedBorderOpacity:1,hollowPointInactiveBorderOpacity:.3,lineBorder:2,lineBorderColor:ia[0],lineBorderOpacity:1,lineActiveBorder:3,lineSelectedBorder:3,lineInactiveBorderOpacity:.3,areaFillColor:ia[0],areaFillOpacity:.25,areaActiveFillColor:ia[0],areaActiveFillOpacity:.5,areaSelectedFillColor:ia[0],areaSelectedFillOpacity:.5,areaInactiveFillOpacity:.3,hollowAreaBorderColor:ia[0],hollowAreaBorder:2,hollowAreaBorderOpacity:1,hollowAreaActiveBorder:3,hollowAreaActiveBorderColor:Ce[100],hollowAreaSelectedBorder:3,hollowAreaSelectedBorderColor:Ce[100],hollowAreaInactiveBorderOpacity:.3,intervalFillColor:ia[0],intervalFillOpacity:.95,intervalActiveBorder:1,intervalActiveBorderColor:Ce[100],intervalActiveBorderOpacity:1,intervalSelectedBorder:2,intervalSelectedBorderColor:Ce[100],intervalSelectedBorderOpacity:1,intervalInactiveBorderOpacity:.3,intervalInactiveFillOpacity:.3,hollowIntervalBorder:2,hollowIntervalBorderColor:ia[0],hollowIntervalBorderOpacity:1,hollowIntervalFillColor:ns[100],hollowIntervalActiveBorder:2,hollowIntervalActiveBorderColor:Ce[100],hollowIntervalSelectedBorder:3,hollowIntervalSelectedBorderColor:Ce[100],hollowIntervalSelectedBorderOpacity:1,hollowIntervalInactiveBorderOpacity:.3};return S(S({},s),r)},NPt=DPt(),FC={rect:"path",circle:"circle",line:"line",path:"path",marker:"path",text:"text",polyline:"polyline",polygon:"polygon",image:"image",ellipse:"ellipse",dom:"foreignObject"},oe={opacity:"opacity",fillStyle:"fill",fill:"fill",fillOpacity:"fill-opacity",strokeStyle:"stroke",strokeOpacity:"stroke-opacity",stroke:"stroke",x:"x",y:"y",r:"r",rx:"rx",ry:"ry",width:"width",height:"height",x1:"x1",x2:"x2",y1:"y1",y2:"y2",lineCap:"stroke-linecap",lineJoin:"stroke-linejoin",lineWidth:"stroke-width",lineDash:"stroke-dasharray",lineDashOffset:"stroke-dashoffset",miterLimit:"stroke-miterlimit",font:"font",fontSize:"font-size",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",fontFamily:"font-family",startArrow:"marker-start",endArrow:"marker-end",path:"d",class:"class",id:"id",style:"style",preserveAspectRatio:"preserveAspectRatio"};function Zn(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Vk(r){var t=FC[r.type],e=r.getParent();if(!t)throw new Error("the type "+r.type+" is not supported by svg");var i=Zn(t);if(r.get("id")&&(i.id=r.get("id")),r.set("el",i),r.set("attrs",{}),e){var n=e.get("el");n||(n=e.createDom(),e.set("el",n)),n.appendChild(i)}return i}function Gk(r,t){var e=r.get("el"),i=Tit(e.children).sort(t),n=document.createDocumentFragment();i.forEach(function(a){n.appendChild(a)}),e.appendChild(n)}function kPt(r,t){var e=r.parentNode,i=Array.from(e.childNodes).filter(function(s){return s.nodeType===1&&s.nodeName.toLowerCase()!=="defs"}),n=i[t],a=i.indexOf(r);if(n){if(a>t)e.insertBefore(r,n);else if(a<t){var o=i[t+1];o?e.insertBefore(r,o):e.appendChild(r)}}else e.appendChild(r)}function UPt(r,t){var e=r.cfg.el,i=r.attr(),n={dx:i.shadowOffsetX,dy:i.shadowOffsetY,blur:i.shadowBlur,color:i.shadowColor};if(!n.dx&&!n.dy&&!n.blur&&!n.color)e.removeAttribute("filter");else{var a=t.find("filter",n);a||(a=t.addShadow(n)),e.setAttribute("filter","url(#"+a+")")}}function gv(r){var t=r.attr().matrix;if(t){for(var e=r.cfg.el,i=[],n=0;n<9;n+=3)i.push(t[n]+","+t[n+1]);i=i.join(","),i.indexOf("NaN")===-1?e.setAttribute("transform","matrix("+i+")"):console.warn("invalid matrix:",t)}}function wd(r,t){var e=r.getClip(),i=r.get("el");if(!e)i.removeAttribute("clip-path");else if(e&&!i.hasAttribute("clip-path")){Vk(e),e.createPath(t);var n=t.addClip(e);i.setAttribute("clip-path","url(#"+n+")")}}function Xk(r,t){t.forEach(function(e){e.draw(r)})}function Yk(r,t){var e=r.get("canvas");if(e&&e.get("autoDraw")){var i=e.get("context"),n=r.getParent(),a=n?n.getChildren():[e],o=r.get("el");if(t==="remove"){var s=r.get("isClipShape");if(s){var l=o&&o.parentNode,u=l&&l.parentNode;l&&u&&u.removeChild(l)}else o&&o.parentNode&&o.parentNode.removeChild(o)}else if(t==="show")o.setAttribute("visibility","visible");else if(t==="hide")o.setAttribute("visibility","hidden");else if(t==="zIndex")kPt(o,a.indexOf(r));else if(t==="sort"){var c=r.get("children");c&&c.length&&Gk(r,function(h,f){return c.indexOf(h)-c.indexOf(f)?1:0})}else t==="clear"?o&&(o.innerHTML=""):t==="matrix"?gv(r):t==="clip"?wd(r,i):t==="attr"||t==="add"&&r.draw(i)}}var ET=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isEntityGroup=function(){return!0},t.prototype.createDom=function(){var e=Zn("g");this.set("el",e);var i=this.getParent();if(i){var n=i.get("el");n||(n=i.createDom(),i.set("el",n)),n.appendChild(e)}return e},t.prototype.afterAttrsChange=function(e){r.prototype.afterAttrsChange.call(this,e);var i=this.get("canvas");if(i&&i.get("autoDraw")){var n=i.get("context");this.createPath(n,e)}},t.prototype.onCanvasChange=function(e){Yk(this,e)},t.prototype.getShapeBase=function(){return U0},t.prototype.getGroupBase=function(){return t},t.prototype.draw=function(e){var i=this.getChildren(),n=this.get("el");this.get("destroyed")?n&&n.parentNode.removeChild(n):(n||this.createDom(),wd(this,e),this.createPath(e),i.length&&Xk(e,i))},t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");R(i||n,function(o,s){oe[s]&&a.setAttribute(oe[s],o)}),gv(this)},t}(rm),Jn=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="svg",e.canFill=!1,e.canStroke=!1,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},t.prototype.afterAttrsChange=function(e){r.prototype.afterAttrsChange.call(this,e);var i=this.get("canvas");if(i&&i.get("autoDraw")){var n=i.get("context");this.draw(n,e)}},t.prototype.getShapeBase=function(){return U0},t.prototype.getGroupBase=function(){return ET},t.prototype.onCanvasChange=function(e){Yk(this,e)},t.prototype.calculateBBox=function(){var e=this.get("el"),i=null;if(e)i=e.getBBox();else{var n=nm(this.get("type"));n&&(i=n(this))}if(i){var a=i.x,o=i.y,s=i.width,l=i.height,u=this.getHitLineWidth(),c=u/2,h=a-c,f=o-c,d=a+s+c,v=o+l+c;return{x:h,y:f,minX:h,minY:f,maxX:d,maxY:v,width:s+u,height:l+u}}return{x:0,y:0,minX:0,minY:0,maxX:0,maxY:0,width:0,height:0}},t.prototype.isFill=function(){var e=this.attr(),i=e.fill,n=e.fillStyle;return(i||n||this.isClipShape())&&this.canFill},t.prototype.isStroke=function(){var e=this.attr(),i=e.stroke,n=e.strokeStyle;return(i||n)&&this.canStroke},t.prototype.draw=function(e,i){var n=this.get("el");this.get("destroyed")?n&&n.parentNode.removeChild(n):(n||Vk(this),wd(this,e),this.createPath(e,i),this.shadow(e,i),this.strokeAndFill(e,i),this.transform(i))},t.prototype.createPath=function(e,i){},t.prototype.strokeAndFill=function(e,i){var n=i||this.attr(),a=n.fill,o=n.fillStyle,s=n.stroke,l=n.strokeStyle,u=n.fillOpacity,c=n.strokeOpacity,h=n.lineWidth,f=this.get("el");this.canFill&&(i?"fill"in n?this._setColor(e,"fill",a):"fillStyle"in n&&this._setColor(e,"fill",o):this._setColor(e,"fill",a||o),u&&f.setAttribute(oe.fillOpacity,u)),this.canStroke&&h>0&&(i?"stroke"in n?this._setColor(e,"stroke",s):"strokeStyle"in n&&this._setColor(e,"stroke",l):this._setColor(e,"stroke",s||l),c&&f.setAttribute(oe.strokeOpacity,c),h&&f.setAttribute(oe.lineWidth,h))},t.prototype._setColor=function(e,i,n){var a=this.get("el");if(!n){a.setAttribute(oe[i],"none");return}if(n=n.trim(),/^[r,R,L,l]{1}[\s]*\(/.test(n)){var o=e.find("gradient",n);o||(o=e.addGradient(n)),a.setAttribute(oe[i],"url(#"+o+")")}else if(/^[p,P]{1}[\s]*\(/.test(n)){var o=e.find("pattern",n);o||(o=e.addPattern(n)),a.setAttribute(oe[i],"url(#"+o+")")}else a.setAttribute(oe[i],n)},t.prototype.shadow=function(e,i){var n=this.attr(),a=i||n,o=a.shadowOffsetX,s=a.shadowOffsetY,l=a.shadowBlur,u=a.shadowColor;(o||s||l||u)&&UPt(this,e)},t.prototype.transform=function(e){var i=this.attr(),n=(e||i).matrix;n&&gv(this)},t.prototype.isInShape=function(e,i){return this.isPointInPath(e,i)},t.prototype.isPointInPath=function(e,i){var n=this.get("el"),a=this.get("canvas"),o=a.get("el").getBoundingClientRect(),s=e+o.left,l=i+o.top,u=document.elementFromPoint(s,l);return!!(u&&u.isEqualNode(n))},t.prototype.getHitLineWidth=function(){var e=this.attrs,i=e.lineWidth,n=e.lineAppendWidth;return this.isStroke()?i+n:0},t}(im),zPt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="circle",e.canFill=!0,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,r:0})},t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");R(i||n,function(o,s){s==="x"||s==="y"?a.setAttribute("c"+s,o):oe[s]&&a.setAttribute(oe[s],o)})},t}(Jn),HPt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="dom",e.canFill=!1,e.canStroke=!1,e}return t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");if(R(i||n,function(u,c){oe[c]&&a.setAttribute(oe[c],u)}),typeof n.html=="function"){var o=n.html.call(this,n);if(o instanceof Element||o instanceof HTMLDocument){for(var s=a.childNodes,l=s.length-1;l>=0;l--)a.removeChild(s[l]);a.appendChild(o)}else a.innerHTML=o}else a.innerHTML=n.html},t}(Jn),$Pt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="ellipse",e.canFill=!0,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,rx:0,ry:0})},t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");R(i||n,function(o,s){s==="x"||s==="y"?a.setAttribute("c"+s,o):oe[s]&&a.setAttribute(oe[s],o)})},t}(Jn),WPt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="image",e.canFill=!1,e.canStroke=!1,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,width:0,height:0})},t.prototype.createPath=function(e,i){var n=this,a=this.attr(),o=this.get("el");R(i||a,function(s,l){l==="img"?n._setImage(a.img):oe[l]&&o.setAttribute(oe[l],s)})},t.prototype.setAttr=function(e,i){this.attrs[e]=i,e==="img"&&this._setImage(i)},t.prototype._setImage=function(e){var i=this.attr(),n=this.get("el");if(mt(e))n.setAttribute("href",e);else if(e instanceof window.Image)i.width||(n.setAttribute("width",e.width),this.attr("width",e.width)),i.height||(n.setAttribute("height",e.height),this.attr("height",e.height)),n.setAttribute("href",e.src);else if(e instanceof HTMLElement&&mt(e.nodeName)&&e.nodeName.toUpperCase()==="CANVAS")n.setAttribute("href",e.toDataURL());else if(e instanceof ImageData){var a=document.createElement("canvas");a.setAttribute("width",""+e.width),a.setAttribute("height",""+e.height),a.getContext("2d").putImageData(e,0,0),i.width||(n.setAttribute("width",""+e.width),this.attr("width",e.width)),i.height||(n.setAttribute("height",""+e.height),this.attr("height",e.height)),n.setAttribute("href",a.toDataURL())}},t}(Jn),VPt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="line",e.canFill=!1,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");R(i||n,function(o,s){if(s==="startArrow"||s==="endArrow")if(o){var l=re(o)?e.addArrow(n,oe[s]):e.getDefaultArrow(n,oe[s]);a.setAttribute(oe[s],"url(#"+l+")")}else a.removeAttribute(oe[s]);else oe[s]&&a.setAttribute(oe[s],o)})},t.prototype.getTotalLength=function(){var e=this.attr(),i=e.x1,n=e.y1,a=e.x2,o=e.y2;return Nr.length(i,n,a,o)},t.prototype.getPoint=function(e){var i=this.attr(),n=i.x1,a=i.y1,o=i.x2,s=i.y2;return Nr.pointAt(n,a,o,s,e)},t}(Jn),bp={circle:function(r,t,e){return[["M",r,t],["m",-e,0],["a",e,e,0,1,0,e*2,0],["a",e,e,0,1,0,-e*2,0]]},square:function(r,t,e){return[["M",r-e,t-e],["L",r+e,t-e],["L",r+e,t+e],["L",r-e,t+e],["Z"]]},diamond:function(r,t,e){return[["M",r-e,t],["L",r,t-e],["L",r+e,t],["L",r,t+e],["Z"]]},triangle:function(r,t,e){var i=e*Math.sin(.3333333333333333*Math.PI);return[["M",r-e,t+i],["L",r,t-i],["L",r+e,t+i],["z"]]},triangleDown:function(r,t,e){var i=e*Math.sin(.3333333333333333*Math.PI);return[["M",r-e,t-i],["L",r+e,t-i],["L",r,t+i],["Z"]]}};const dO={get:function(r){return bp[r]},register:function(r,t){bp[r]=t},remove:function(r){delete bp[r]},getAll:function(){return bp}};var GPt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="marker",e.canFill=!0,e.canStroke=!0,e}return t.prototype.createPath=function(e){var i=this.get("el");i.setAttribute("d",this._assembleMarker())},t.prototype._assembleMarker=function(){var e=this._getPath();return Z(e)?e.map(function(i){return i.join(" ")}).join(""):e},t.prototype._getPath=function(){var e=this.attr(),i=e.x,n=e.y,a=e.r||e.radius,o=e.symbol||"circle",s;return ut(o)?s=o:s=dO.get(o),s?s(i,n,a):(console.warn(s+" symbol is not exist."),null)},t.symbolsFactory=dO,t}(Jn),XPt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="path",e.canFill=!0,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{startArrow:!1,endArrow:!1})},t.prototype.createPath=function(e,i){var n=this,a=this.attr(),o=this.get("el");R(i||a,function(s,l){if(l==="path"&&Z(s))o.setAttribute("d",n._formatPath(s));else if(l==="startArrow"||l==="endArrow")if(s){var u=re(s)?e.addArrow(a,oe[l]):e.getDefaultArrow(a,oe[l]);o.setAttribute(oe[l],"url(#"+u+")")}else o.removeAttribute(oe[l]);else oe[l]&&o.setAttribute(oe[l],s)})},t.prototype._formatPath=function(e){var i=e.map(function(n){return n.join(" ")}).join("");return~i.indexOf("NaN")?"":i},t.prototype.getTotalLength=function(){var e=this.get("el");return e?e.getTotalLength():null},t.prototype.getPoint=function(e){var i=this.get("el"),n=this.getTotalLength();if(n===0)return null;var a=i?i.getPointAtLength(e*n):null;return a?{x:a.x,y:a.y}:null},t}(Jn),YPt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="polygon",e.canFill=!0,e.canStroke=!0,e}return t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");R(i||n,function(o,s){s==="points"&&Z(o)&&o.length>=2?a.setAttribute("points",o.map(function(l){return l[0]+","+l[1]}).join(" ")):oe[s]&&a.setAttribute(oe[s],o)})},t}(Jn),jPt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="polyline",e.canFill=!0,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{startArrow:!1,endArrow:!1})},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),["points"].indexOf(e)!==-1&&this._resetCache()},t.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");R(i||n,function(o,s){s==="points"&&Z(o)&&o.length>=2?a.setAttribute("points",o.map(function(l){return l[0]+","+l[1]}).join(" ")):oe[s]&&a.setAttribute(oe[s],o)})},t.prototype.getTotalLength=function(){var e=this.attr().points,i=this.get("totalLength");return j(i)?(this.set("totalLength",vD.length(e)),this.get("totalLength")):i},t.prototype.getPoint=function(e){var i=this.attr().points,n=this.get("tCache");n||(this._setTcache(),n=this.get("tCache"));var a,o;return R(n,function(s,l){e>=s[0]&&e<=s[1]&&(a=(e-s[0])/(s[1]-s[0]),o=l)}),Nr.pointAt(i[o][0],i[o][1],i[o+1][0],i[o+1][1],a)},t.prototype._setTcache=function(){var e=this.attr().points;if(!(!e||e.length===0)){var i=this.getTotalLength();if(!(i<=0)){var n=0,a=[],o,s;R(e,function(l,u){e[u+1]&&(o=[],o[0]=n/i,s=Nr.length(l[0],l[1],e[u+1][0],e[u+1][1]),n+=s,o[1]=n/i,a.push(o))}),this.set("tCache",a)}}},t.prototype.getStartTangent=function(){var e=this.attr().points,i=[];return i.push([e[1][0],e[1][1]]),i.push([e[0][0],e[0][1]]),i},t.prototype.getEndTangent=function(){var e=this.attr().points,i=e.length-1,n=[];return n.push([e[i-1][0],e[i-1][1]]),n.push([e[i][0],e[i][1]]),n},t}(Jn);function ZPt(r){var t=0,e=0,i=0,n=0;return Z(r)?r.length===1?t=e=i=n=r[0]:r.length===2?(t=i=r[0],e=n=r[1]):r.length===3?(t=r[0],e=n=r[1],i=r[2]):(t=r[0],e=r[1],i=r[2],n=r[3]):t=e=i=n=r,{r1:t,r2:e,r3:i,r4:n}}var qPt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="rect",e.canFill=!0,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,width:0,height:0,radius:0})},t.prototype.createPath=function(e,i){var n=this,a=this.attr(),o=this.get("el"),s=!1,l=["x","y","width","height","radius"];R(i||a,function(u,c){l.indexOf(c)!==-1&&!s?(o.setAttribute("d",n._assembleRect(a)),s=!0):l.indexOf(c)===-1&&oe[c]&&o.setAttribute(oe[c],u)})},t.prototype._assembleRect=function(e){var i=e.x,n=e.y,a=e.width,o=e.height,s=e.radius;if(!s)return"M "+i+","+n+" l "+a+",0 l 0,"+o+" l"+-a+" 0 z";var l=ZPt(s);Z(s)?s.length===1?l.r1=l.r2=l.r3=l.r4=s[0]:s.length===2?(l.r1=l.r3=s[0],l.r2=l.r4=s[1]):s.length===3?(l.r1=s[0],l.r2=l.r4=s[1],l.r3=s[2]):(l.r1=s[0],l.r2=s[1],l.r3=s[2],l.r4=s[3]):l.r1=l.r2=l.r3=l.r4=s;var u=[["M "+(i+l.r1)+","+n],["l "+(a-l.r1-l.r2)+",0"],["a "+l.r2+","+l.r2+",0,0,1,"+l.r2+","+l.r2],["l 0,"+(o-l.r2-l.r3)],["a "+l.r3+","+l.r3+",0,0,1,"+-l.r3+","+l.r3],["l "+(l.r3+l.r4-a)+",0"],["a "+l.r4+","+l.r4+",0,0,1,"+-l.r4+","+-l.r4],["l 0,"+(l.r4+l.r1-o)],["a "+l.r1+","+l.r1+",0,0,1,"+l.r1+","+-l.r1],["z"]];return u.join(" ")},t}(Jn),vO=.3,KPt={top:"before-edge",middle:"central",bottom:"after-edge",alphabetic:"baseline",hanging:"hanging"},QPt={top:"text-before-edge",middle:"central",bottom:"text-after-edge",alphabetic:"alphabetic",hanging:"hanging"},JPt={left:"left",start:"left",center:"middle",right:"end",end:"end"},tFt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="text",e.canFill=!0,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},t.prototype.createPath=function(e,i){var n=this,a=this.attr(),o=this.get("el");this._setFont(),R(i||a,function(s,l){l==="text"?n._setText(""+s):l==="matrix"&&s?gv(n):oe[l]&&o.setAttribute(oe[l],s)}),o.setAttribute("paint-order","stroke"),o.setAttribute("style","stroke-linecap:butt; stroke-linejoin:miter;")},t.prototype._setFont=function(){var e=this.get("el"),i=this.attr(),n=i.textBaseline,a=i.textAlign,o=IP();o&&o.name==="firefox"?e.setAttribute("dominant-baseline",QPt[n]||"alphabetic"):e.setAttribute("alignment-baseline",KPt[n]||"baseline"),e.setAttribute("text-anchor",JPt[a]||"left")},t.prototype._setText=function(e){var i=this.get("el"),n=this.attr(),a=n.x,o=n.textBaseline,s=o===void 0?"bottom":o;if(!e)i.innerHTML="";else if(~e.indexOf(`
`)){var l=e.split(`
`),u=l.length-1,c="";R(l,function(h,f){f===0?s==="alphabetic"?c+='<tspan x="'+a+'" dy="'+-u+'em">'+h+"</tspan>":s==="top"?c+='<tspan x="'+a+'" dy="0.9em">'+h+"</tspan>":s==="middle"?c+='<tspan x="'+a+'" dy="'+-(u-1)/2+'em">'+h+"</tspan>":s==="bottom"?c+='<tspan x="'+a+'" dy="-'+(u+vO)+'em">'+h+"</tspan>":s==="hanging"&&(c+='<tspan x="'+a+'" dy="'+(-(u-1)-vO)+'em">'+h+"</tspan>"):c+='<tspan x="'+a+'" dy="1em">'+h+"</tspan>"}),i.innerHTML=c}else i.innerHTML=e},t}(Jn),eFt=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,rFt=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,iFt=/[\d.]+:(#[^\s]+|[^)]+\))/gi;function jk(r){var t=r.match(iFt);if(!t)return"";var e="";return t.sort(function(i,n){return i=i.split(":"),n=n.split(":"),Number(i[0])-Number(n[0])}),R(t,function(i){i=i.split(":"),e+='<stop offset="'+i[0]+'" stop-color="'+i[1]+'"></stop>'}),e}function nFt(r,t){var e=eFt.exec(r),i=Z0(q0(parseFloat(e[1])),Math.PI*2),n=e[2],a,o;i>=0&&i<.5*Math.PI?(a={x:0,y:0},o={x:1,y:1}):.5*Math.PI<=i&&i<Math.PI?(a={x:1,y:0},o={x:0,y:1}):Math.PI<=i&&i<1.5*Math.PI?(a={x:1,y:1},o={x:0,y:0}):(a={x:0,y:1},o={x:1,y:0});var s=Math.tan(i),l=s*s,u=(o.x-a.x+s*(o.y-a.y))/(l+1)+a.x,c=s*(o.x-a.x+s*(o.y-a.y))/(l+1)+a.y;t.setAttribute("x1",a.x),t.setAttribute("y1",a.y),t.setAttribute("x2",u),t.setAttribute("y2",c),t.innerHTML=jk(n)}function aFt(r,t){var e=rFt.exec(r),i=parseFloat(e[1]),n=parseFloat(e[2]),a=parseFloat(e[3]),o=e[4];t.setAttribute("cx",i),t.setAttribute("cy",n),t.setAttribute("r",a),t.innerHTML=jk(o)}var oFt=function(){function r(t){this.cfg={};var e=null,i=Cn("gradient_");return t.toLowerCase()[0]==="l"?(e=Zn("linearGradient"),nFt(t,e)):(e=Zn("radialGradient"),aFt(t,e)),e.setAttribute("id",i),this.el=e,this.id=i,this.cfg=t,this}return r.prototype.match=function(t,e){return this.cfg===e},r}(),sFt={shadowColor:"color",shadowOpacity:"opacity",shadowBlur:"blur",shadowOffsetX:"dx",shadowOffsetY:"dy"},lFt={x:"-40%",y:"-40%",width:"200%",height:"200%"},uFt=function(){function r(t){this.type="filter",this.cfg={},this.type="filter";var e=Zn("filter");return R(lFt,function(i,n){e.setAttribute(n,i)}),this.el=e,this.id=Cn("filter_"),this.el.id=this.id,this.cfg=t,this._parseShadow(t,e),this}return r.prototype.match=function(t,e){if(this.type!==t)return!1;var i=!0,n=this.cfg;return R(Object.keys(n),function(a){if(n[a]!==e[a])return i=!1,!1}),i},r.prototype.update=function(t,e){var i=this.cfg;return i[sFt[t]]=e,this._parseShadow(i,this.el),this},r.prototype._parseShadow=function(t,e){var i=`<feDropShadow
      dx="`+(t.dx||0)+`"
      dy="`+(t.dy||0)+`"
      stdDeviation="`+(t.blur?t.blur/10:0)+`"
      flood-color="`+(t.color?t.color:"#000")+`"
      flood-opacity="`+(t.opacity?t.opacity:1)+`"
      />`;e.innerHTML=i},r}(),pO=function(){function r(t,e){this.cfg={};var i=Zn("marker"),n=Cn("marker_");i.setAttribute("id",n);var a=Zn("path");a.setAttribute("stroke",t.stroke||"none"),a.setAttribute("fill",t.fill||"none"),i.appendChild(a),i.setAttribute("overflow","visible"),i.setAttribute("orient","auto-start-reverse"),this.el=i,this.child=a,this.id=n;var o=t[e==="marker-start"?"startArrow":"endArrow"];return this.stroke=t.stroke||"#000",o===!0?this._setDefaultPath(e,a):(this.cfg=o,this._setMarker(t.lineWidth,a)),this}return r.prototype.match=function(){return!1},r.prototype._setDefaultPath=function(t,e){var i=this.el;e.setAttribute("d","M0,0 L"+10*Math.cos(Math.PI/6)+",5 L0,10"),i.setAttribute("refX",""+10*Math.cos(Math.PI/6)),i.setAttribute("refY","5")},r.prototype._setMarker=function(t,e){var i=this.el,n=this.cfg.path,a=this.cfg.d;Z(n)&&(n=n.map(function(o){return o.join(" ")}).join("")),e.setAttribute("d",n),i.appendChild(e),a&&i.setAttribute("refX",""+a/t)},r.prototype.update=function(t){var e=this.child;e.attr?e.attr("fill",t):e.setAttribute("fill",t)},r}(),cFt=function(){function r(t){this.type="clip",this.cfg={};var e=Zn("clipPath");this.el=e,this.id=Cn("clip_"),e.id=this.id;var i=t.cfg.el;return e.appendChild(i),this.cfg=t,this}return r.prototype.match=function(){return!1},r.prototype.remove=function(){var t=this.el;t.parentNode.removeChild(t)},r}(),hFt=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,fFt=function(){function r(t){this.cfg={};var e=Zn("pattern");e.setAttribute("patternUnits","userSpaceOnUse");var i=Zn("image");e.appendChild(i);var n=Cn("pattern_");e.id=n,this.el=e,this.id=n,this.cfg=t;var a=hFt.exec(t),o=a[2];i.setAttribute("href",o);var s=new Image;o.match(/^data:/i)||(s.crossOrigin="Anonymous"),s.src=o;function l(){e.setAttribute("width",""+s.width),e.setAttribute("height",""+s.height)}return s.complete?l():(s.onload=l,s.src=s.src),this}return r.prototype.match=function(t,e){return this.cfg===e},r}(),dFt=function(){function r(t){var e=Zn("defs"),i=Cn("defs_");e.id=i,t.appendChild(e),this.children=[],this.defaultArrow={},this.el=e,this.canvas=t}return r.prototype.find=function(t,e){for(var i=this.children,n=null,a=0;a<i.length;a++)if(i[a].match(t,e)){n=i[a].id;break}return n},r.prototype.findById=function(t){for(var e=this.children,i=null,n=0;n<e.length;n++)if(e[n].id===t){i=e[n];break}return i},r.prototype.add=function(t){this.children.push(t),t.canvas=this.canvas,t.parent=this},r.prototype.getDefaultArrow=function(t,e){var i=t.stroke||t.strokeStyle;if(this.defaultArrow[i])return this.defaultArrow[i].id;var n=new pO(t,e);return this.defaultArrow[i]=n,this.el.appendChild(n.el),this.add(n),n.id},r.prototype.addGradient=function(t){var e=new oFt(t);return this.el.appendChild(e.el),this.add(e),e.id},r.prototype.addArrow=function(t,e){var i=new pO(t,e);return this.el.appendChild(i.el),this.add(i),i.id},r.prototype.addShadow=function(t){var e=new uFt(t);return this.el.appendChild(e.el),this.add(e),e.id},r.prototype.addPattern=function(t){var e=new fFt(t);return this.el.appendChild(e.el),this.add(e),e.id},r.prototype.addClip=function(t){var e=new cFt(t);return this.el.appendChild(e.el),this.add(e),e.id},r}(),vFt=function(r){B(t,r);function t(e){return r.call(this,S(S({},e),{autoDraw:!0,renderer:"svg"}))||this}return t.prototype.getShapeBase=function(){return U0},t.prototype.getGroupBase=function(){return ET},t.prototype.getShape=function(e,i,n){var a=n.target||n.srcElement;if(!FC[a.tagName]){for(var o=a.parentNode;o&&!FC[o.tagName];)o=o.parentNode;a=o}return this.find(function(s){return s.get("el")===a})},t.prototype.createDom=function(){var e=Zn("svg"),i=new dFt(e);return e.setAttribute("width",""+this.get("width")),e.setAttribute("height",""+this.get("height")),this.set("context",i),e},t.prototype.onCanvasChange=function(e){var i=this.get("context"),n=this.get("el");if(e==="sort"){var a=this.get("children");a&&a.length&&Gk(this,function(s,l){return a.indexOf(s)-a.indexOf(l)?1:0})}else if(e==="clear"){if(n){n.innerHTML="";var o=i.el;o.innerHTML="",n.appendChild(o)}}else e==="matrix"?gv(this):e==="clip"?wd(this,i):e==="changeSize"&&(n.setAttribute("width",""+this.get("width")),n.setAttribute("height",""+this.get("height")))},t.prototype.draw=function(){var e=this.get("context"),i=this.getChildren();wd(this,e),i.length&&Xk(e,i)},t}(em),pFt="0.5.6";const gFt=Object.freeze(Object.defineProperty({__proto__:null,AbstractCanvas:em,AbstractGroup:rm,AbstractShape:im,Base:J0,Canvas:vFt,Event:Gd,Group:ET,PathUtil:kE,Shape:U0,assembleFont:lm,getBBoxMethod:nm,getOffScreenContext:om,getTextHeight:sm,invert:tm,isAllowCapture:Xf,multiplyVec2:Ao,registerBBox:Kn,registerEasing:aD,version:pFt},Symbol.toStringTag,{value:"Module"}));var ST=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;i.type="path",i.shapeType="line";var n=e.connectNulls,a=n===void 0?!1:n,o=e.showSinglePoint,s=o===void 0?!0:o;return i.connectNulls=a,i.showSinglePoint=s,i}return t.prototype.updateElements=function(e,i){var n,a,o,s,l,u;i===void 0&&(i=!1);for(var c=new Map,h=new Map,f=[],d=0,v=0;v<e.length;v++){var p=e[v],g=this.getElementId(p);f.push(g),c.set(g,p),h.set(g,d),d++}this.elements=new Array(d);var m=Fk(this.lastElementsMap,f),y=m.added,_=m.updated,x=m.removed;try{for(var C=qt(y),A=C.next();!A.done;A=C.next()){var g=A.value,p=c.get(g),T=this.getShapeFactory(),w=this.getShapeInfo(p),v=h.get(g),M=new Ik({shapeFactory:T,container:this.container,offscreenGroup:this.getOffscreenGroup(),elementIndex:v});M.geometry=this,M.animate=this.animateOption,M.draw(w,i),this.elementsMap[g]=M,this.elements[v]=M}}catch(H){n={error:H}}finally{try{A&&!A.done&&(a=C.return)&&a.call(C)}finally{if(n)throw n.error}}try{for(var O=qt(_),P=O.next();!P.done;P=O.next()){var g=P.value,p=c.get(g),M=this.lastElementsMap[g],v=h.get(g),w=this.getShapeInfo(p),D=M.getModel();(this.isCoordinateChanged||Pk(D,w))&&(M.animate=this.animateOption,M.update(w)),this.elementsMap[g]=M,this.elements[v]=M}}catch(H){o={error:H}}finally{try{P&&!P.done&&(s=O.return)&&s.call(O)}finally{if(o)throw o.error}}try{for(var z=qt(x),Y=z.next();!Y.done;Y=z.next()){var g=Y.value,M=this.lastElementsMap[g];M.animate=this.animateOption,M.destroy()}}catch(H){l={error:H}}finally{try{Y&&!Y.done&&(u=z.return)&&u.call(z)}finally{if(l)throw l.error}}},t.prototype.getPointsAndData=function(e){for(var i=[],n=[],a=0,o=e.length;a<o;a++){var s=e[a];i.push({x:s.x,y:s.y}),n.push(s[Ee])}return{points:i,data:n}},t.prototype.getShapeInfo=function(e){var i=this.getDrawCfg(e[0]),n=this.getPointsAndData(e),a=n.points,o=n.data;return i.mappingData=e,i.data=o,i.isStack=!!this.getAdjust("stack"),i.points=a,i.connectNulls=this.connectNulls,i.showSinglePoint=this.showSinglePoint,i},t}(Qs);function mFt(r,t,e,i,n){var a=[];if(r.length){for(var o=[],s=[],l=0,u=r.length;l<u;l++){var c=r[l];o.push(c[1]),s.push(c[0])}s=s.reverse(),R([o,s],function(h,f){var d=[],v=i.parsePoints(h),p=v[0];o.length===1&&s.length===1?d=f===0?[["M",p.x-.5,p.y],["L",p.x+.5,p.y]]:[["L",p.x+.5,p.y],["L",p.x-.5,p.y]]:(t&&v.push({x:p.x,y:p.y}),e?d=R0(v,!1,n):d=dv(v,!1),f>0&&(d[0][0]="L")),a=a.concat(d)}),a.push(["Z"])}return a}function xy(r,t,e,i,n){for(var a=nr(r,t,!t,"lineWidth"),o=r.connectNulls,s=r.isInCircle,l=r.points,u=r.showSinglePoint,c=_y(l,o,u),h=[],f=0,d=c.length;f<d;f++){var v=c[f];h=h.concat(mFt(v,s,e,i,n))}return a.path=h,a}function Zk(r){var t=r.start,e=r.end;return[[t.x,e.y],[e.x,t.y]]}Ks("area",{defaultShapeType:"area",getDefaultPoints:function(r){var t=r.x,e=r.y0,i=Z(r.y)?r.y:[e,r.y];return i.map(function(n){return{x:t,y:n}})}});he("area","area",{draw:function(r,t){var e=xy(r,!1,!1,this),i=t.addShape({type:"path",attrs:e,name:"area"});return i},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){return n===void 0&&(n=5.5),[["M",e-n,i-4],["L",e+n,i-4],["L",e+n,i+4],["L",e-n,i+4],["Z"]]},style:{r:5,fill:t,fillOpacity:1}}}});var yFt=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;i.type="area",i.shapeType="area",i.generatePoints=!0,i.startOnZero=!0;var n=e.startOnZero,a=n===void 0?!0:n,o=e.sortable,s=o===void 0?!1:o,l=e.showSinglePoint,u=l===void 0?!1:l;return i.startOnZero=a,i.sortable=s,i.showSinglePoint=u,i}return t.prototype.getPointsAndData=function(e){for(var i=[],n=[],a=0,o=e.length;a<o;a++){var s=e[a];i.push(s.points),n.push(s[Ee])}return{points:i,data:n}},t.prototype.getYMinValue=function(){if(this.startOnZero)return r.prototype.getYMinValue.call(this);var e=this.getYScale();return e.min},t}(ST);Ks("edge",{defaultShapeType:"line",getDefaultPoints:function(r){return CT(r)}});he("edge","line",{draw:function(r,t){var e=nr(r,!0,!1,"lineWidth"),i=dv(this.parsePoints(r.points),this.coordinate.isPolar);return t.addShape("path",{attrs:S(S({},e),{path:i})})},getMarker:function(r){return{symbol:"circle",style:{r:4.5,fill:r.color}}}});var _Ft=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="edge",e.shapeType="edge",e.generatePoints=!0,e}return t}(Qs),xFt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="heatmap",e.paletteCache={},e}return t.prototype.updateElements=function(e,i){for(var n=0;n<e.length;n++){var a=e[n],o=this.prepareRange(a),s=this.prepareSize(),l=L(this.styleOption,["cfg","shadowBlur"]);Mt(l)||(l=s/2),this.prepareGreyScaleBlurredCircle(s,l),this.drawWithRange(a,o,s,l)}},t.prototype.color=function(e,i){return this.createAttrOption("color",e,typeof i!="function"?i:""),this},t.prototype.clear=function(){r.prototype.clear.call(this),this.clearShadowCanvasCtx(),this.paletteCache={}},t.prototype.prepareRange=function(e){var i=this.getAttribute("color"),n=i.getFields()[0],a=1/0,o=-1/0;return e.forEach(function(s){var l=s[Ee][n];l>o&&(o=l),l<a&&(a=l)}),a===o&&(a=o-1),[a,o]},t.prototype.prepareSize=function(){var e=this.getDefaultValue("size");return Mt(e)||(e=this.getDefaultSize()),e},t.prototype.prepareGreyScaleBlurredCircle=function(e,i){var n=this.getGrayScaleBlurredCanvas(),a=e+i,o=n.getContext("2d");n.width=n.height=a*2,o.clearRect(0,0,n.width,n.height),o.shadowOffsetX=o.shadowOffsetY=a*2,o.shadowBlur=i,o.shadowColor="black",o.beginPath(),o.arc(-a,-a,e,0,Math.PI*2,!0),o.closePath(),o.fill()},t.prototype.drawWithRange=function(e,i,n,a){var o,s,l=this.coordinate,u=l.start,c=l.end,h=this.coordinate.getWidth(),f=this.coordinate.getHeight(),d=this.getAttribute("color"),v=d.getFields()[0];this.clearShadowCanvasCtx();var p=this.getShadowCanvasCtx();i&&(e=e.filter(function(O){return O[Ee][v]<=i[1]&&O[Ee][v]>=i[0]}));var g=this.scales[v];try{for(var m=qt(e),y=m.next();!y.done;y=m.next()){var _=y.value,x=this.getDrawCfg(_),C=x.x,A=x.y,T=g.scale(_[Ee][v]);this.drawGrayScaleBlurredCircle(C-u.x,A-c.y,n+a,T,p)}}catch(O){o={error:O}}finally{try{y&&!y.done&&(s=m.return)&&s.call(m)}finally{if(o)throw o.error}}var w=p.getImageData(0,0,h,f);this.clearShadowCanvasCtx(),this.colorize(w),p.putImageData(w,0,0);var M=this.getImageShape();M.attr("x",u.x),M.attr("y",c.y),M.attr("width",h),M.attr("height",f),M.attr("img",p.canvas),M.set("origin",this.getShapeInfo(e))},t.prototype.getDefaultSize=function(){var e=this.getAttribute("position"),i=this.coordinate;return Math.min(i.getWidth()/(e.scales[0].ticks.length*4),i.getHeight()/(e.scales[1].ticks.length*4))},t.prototype.clearShadowCanvasCtx=function(){var e=this.getShadowCanvasCtx();e.clearRect(0,0,e.canvas.width,e.canvas.height)},t.prototype.getShadowCanvasCtx=function(){var e=this.shadowCanvas;return e||(e=document.createElement("canvas"),this.shadowCanvas=e),e.width=this.coordinate.getWidth(),e.height=this.coordinate.getHeight(),e.getContext("2d")},t.prototype.getGrayScaleBlurredCanvas=function(){return this.grayScaleBlurredCanvas||(this.grayScaleBlurredCanvas=document.createElement("canvas")),this.grayScaleBlurredCanvas},t.prototype.drawGrayScaleBlurredCircle=function(e,i,n,a,o){var s=this.getGrayScaleBlurredCanvas();o.globalAlpha=a,o.drawImage(s,e-n,i-n)},t.prototype.colorize=function(e){for(var i=this.getAttribute("color"),n=e.data,a=this.paletteCache,o=3;o<n.length;o+=4){var s=n[o];if(Mt(s)){var l=a[s]?a[s]:Ts.rgb2arr(i.gradient(s/256));n[o-3]=l[0],n[o-2]=l[1],n[o-1]=l[2],n[o]=s}}},t.prototype.getImageShape=function(){var e=this.imageShape;if(e)return e;var i=this.container;return e=i.addShape({type:"image",attrs:{}}),this.imageShape=e,e},t.prototype.getShapeInfo=function(e){var i=this.getDrawCfg(e[0]),n=e.map(function(a){return a[Ee]});return S(S({},i),{mappingData:e,data:n})},t}(Qs);function AT(r){var t,e,i=r.x,n=r.y,a=r.y0,o=r.size,s,l;Z(n)?(t=lt(n,2),s=t[0],l=t[1]):(s=a,l=n);var u,c;Z(i)?(e=lt(i,2),u=e[0],c=e[1]):(u=i-o/2,c=i+o/2);var h=[{x:u,y:s},{x:u,y:l}];return h.push({x:c,y:l},{x:c,y:s}),h}function TT(r,t){t===void 0&&(t=!0);var e=[],i=r[0];e.push(["M",i.x,i.y]);for(var n=1,a=r.length;n<a;n++)e.push(["L",r[n].x,r[n].y]);return t&&(e.push(["L",i.x,i.y]),e.push(["z"])),e}function qk(r,t){var e=0,i=0,n=0,a=0;return Z(r)?r.length===1?e=i=n=a=r[0]:r.length===2?(e=n=r[0],i=a=r[1]):r.length===3?(e=r[0],i=a=r[1],n=r[2]):(e=r[0],i=r[1],n=r[2],a=r[3]):e=i=n=a=r,e+i>t&&(e=e?t/(1+i/e):0,i=t-e),n+a>t&&(n=n?t/(1+a/n):0,a=t-n),[e||0,i||0,n||0,a||0]}function Kk(r,t,e){var i=[];if(e.isRect){var n=e.isTransposed?{x:e.start.x,y:t[0].y}:{x:t[0].x,y:e.start.y},a=e.isTransposed?{x:e.end.x,y:t[2].y}:{x:t[3].x,y:e.end.y},o=L(r,["background","style","radius"]);if(o){var s=e.isTransposed?Math.abs(t[0].y-t[2].y):t[2].x-t[1].x,l=e.isTransposed?e.getWidth():e.getHeight(),u=lt(qk(o,Math.min(s,l)),4),c=u[0],h=u[1],f=u[2],d=u[3],v=e.isTransposed&&e.isReflect("y"),p=v?0:1,g=function(A){return v?-A:A};i.push(["M",n.x,a.y+g(c)]),c!==0&&i.push(["A",c,c,0,0,p,n.x+c,a.y]),i.push(["L",a.x-h,a.y]),h!==0&&i.push(["A",h,h,0,0,p,a.x,a.y+g(h)]),i.push(["L",a.x,n.y-g(f)]),f!==0&&i.push(["A",f,f,0,0,p,a.x-f,n.y]),i.push(["L",n.x+d,n.y]),d!==0&&i.push(["A",d,d,0,0,p,n.x,n.y-g(d)])}else i.push(["M",n.x,n.y]),i.push(["L",a.x,n.y]),i.push(["L",a.x,a.y]),i.push(["L",n.x,a.y]),i.push(["L",n.x,n.y]);i.push(["z"])}if(e.isPolar){var m=e.getCenter(),y=Sd(r,e),_=y.startAngle,x=y.endAngle;if(e.type!=="theta"&&!e.isTransposed)i=bs(m.x,m.y,e.getRadius(),_,x);else{var C=function(w){return Math.pow(w,2)},c=Math.sqrt(C(m.x-t[0].x)+C(m.y-t[0].y)),h=Math.sqrt(C(m.x-t[2].x)+C(m.y-t[2].y));i=bs(m.x,m.y,c,e.startAngle,e.endAngle,h)}}return i}function CFt(r,t,e){var i=e.getWidth(),n=e.getHeight(),a=e.type==="rect",o=[],s=(r[2].x-r[1].x)/2,l=e.isTransposed?s*n/i:s*i/n;return t==="round"?(a?(o.push(["M",r[0].x,r[0].y+l]),o.push(["L",r[1].x,r[1].y-l]),o.push(["A",s,s,0,0,1,r[2].x,r[2].y-l]),o.push(["L",r[3].x,r[3].y+l]),o.push(["A",s,s,0,0,1,r[0].x,r[0].y+l])):(o.push(["M",r[0].x,r[0].y]),o.push(["L",r[1].x,r[1].y]),o.push(["A",s,s,0,0,1,r[2].x,r[2].y]),o.push(["L",r[3].x,r[3].y]),o.push(["A",s,s,0,0,1,r[0].x,r[0].y])),o.push(["z"])):o=TT(r),o}function Qk(r,t,e){var i=[];return j(t)?e?i.push(["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["L",(r[2].x+r[3].x)/2,(r[2].y+r[3].y)/2],["Z"]):i.push(["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["L",r[2].x,r[2].y],["L",r[3].x,r[3].y],["Z"]):i.push(["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["L",t[1].x,t[1].y],["L",t[0].x,t[0].y],["Z"]),i}function Xh(r,t){return[t,r]}function EFt(r,t,e){var i,n,a,o,s,l,u,c=lt(_t([],lt(r),!1),4),h=c[0],f=c[1],d=c[2],v=c[3],p=lt(typeof e=="number"?Array(4).fill(e):e,4),g=p[0],m=p[1],y=p[2],_=p[3];t.isTransposed&&(i=lt(Xh(f,v),2),f=i[0],v=i[1]),t.isReflect("y")&&(n=lt(Xh(h,f),2),h=n[0],f=n[1],a=lt(Xh(d,v),2),d=a[0],v=a[1]),t.isReflect("x")&&(o=lt(Xh(h,v),2),h=o[0],v=o[1],s=lt(Xh(f,d),2),f=s[0],d=s[1]);var x=[],C=function(A){return Math.abs(A)};return l=lt(qk([g,m,y,_],Math.min(C(v.x-h.x),C(f.y-h.y))).map(function(A){return C(A)}),4),g=l[0],m=l[1],y=l[2],_=l[3],t.isTransposed&&(u=lt([_,g,m,y],4),g=u[0],m=u[1],y=u[2],_=u[3]),h.y<f.y?(x.push(["M",v.x,v.y+y]),y!==0&&x.push(["A",y,y,0,0,0,v.x-y,v.y]),x.push(["L",h.x+_,h.y]),_!==0&&x.push(["A",_,_,0,0,0,h.x,h.y+_]),x.push(["L",f.x,f.y-g]),g!==0&&x.push(["A",g,g,0,0,0,f.x+g,f.y]),x.push(["L",d.x-m,d.y]),m!==0&&x.push(["A",m,m,0,0,0,d.x,d.y-m]),x.push(["L",v.x,v.y+y]),x.push(["z"])):v.x<h.x?(x.push(["M",d.x+m,d.y]),m!==0&&x.push(["A",m,m,0,0,0,d.x,d.y+m]),x.push(["L",v.x,v.y-y]),y!==0&&x.push(["A",y,y,0,0,0,v.x+y,v.y]),x.push(["L",h.x-_,h.y]),_!==0&&x.push(["A",_,_,0,0,0,h.x,h.y-_]),x.push(["L",f.x,f.y+g]),g!==0&&x.push(["A",g,g,0,0,0,f.x-g,f.y]),x.push(["L",d.x+m,d.y]),x.push(["z"])):(x.push(["M",f.x,f.y+g]),g!==0&&x.push(["A",g,g,0,0,1,f.x+g,f.y]),x.push(["L",d.x-m,d.y]),m!==0&&x.push(["A",m,m,0,0,1,d.x,d.y+m]),x.push(["L",v.x,v.y-y]),y!==0&&x.push(["A",y,y,0,0,1,v.x-y,v.y]),x.push(["L",h.x+_,h.y]),_!==0&&x.push(["A",_,_,0,0,1,h.x,h.y-_]),x.push(["L",f.x,f.y+g]),x.push(["z"])),x}Ks("interval",{defaultShapeType:"rect",getDefaultPoints:function(r){return AT(r)}});he("interval","rect",{draw:function(r,t){var e=nr(r,!1,!0),i=t,n=r==null?void 0:r.background;if(n){i=t.addGroup({name:"interval-group"});var a=Hk(r),o=Kk(r,this.parsePoints(r.points),this.coordinate);i.addShape("path",{attrs:S(S({},a),{path:o}),capture:!1,zIndex:-1,name:yT})}var s;e.radius&&this.coordinate.isRect?s=EFt(this.parsePoints(r.points),this.coordinate,e.radius):s=this.parsePath(CFt(r.points,e.lineCap,this.coordinate));var l=i.addShape("path",{attrs:S(S({},e),{path:s}),name:"interval"});return n?i:l},getMarker:function(r){var t=r.color,e=r.isInPolar;return e?{symbol:"circle",style:{r:4.5,fill:t}}:{symbol:"square",style:{r:4,fill:t}}}});function SFt(r,t){var e=r.length,i=r;mt(i[0])&&(i=r.map(function(s){return t.translate(s)}));for(var n=i[1]-i[0],a=2;a<e;a++){var o=i[a]-i[a-1];n>o&&(n=o)}return n}function AFt(r,t){if(t){var e=vn(r),i=xa(e,t);return i.length}return r.length}function bT(r){var t=r.theme,e=r.coordinate,i=r.getXScale(),n=i.values,a=r.beforeMappingData,o=n.length,s=fv(r.coordinate),l=r.intervalPadding,u=r.dodgePadding,c=r.maxColumnWidth||t.maxColumnWidth,h=r.minColumnWidth||t.minColumnWidth,f=r.columnWidthRatio||t.columnWidthRatio,d=r.multiplePieWidthRatio||t.multiplePieWidthRatio,v=r.roseWidthRatio||t.roseWidthRatio;if(i.isLinear&&n.length>1){n.sort();var p=SFt(n,i);o=(i.max-i.min)/p,n.length>o&&(o=n.length)}var g=i.range,m=1/o,y=1;if(e.isPolar?e.isTransposed&&o>1?y=d:y=v:(i.isLinear&&(m*=g[1]-g[0]),y=f),!j(l)&&l>=0){var _=l/s;m=(1-(o-1)*_)/o}else m*=y;if(r.getAdjust("dodge")){var x=r.getAdjust("dodge"),C=x.dodgeBy,A=AFt(a,C);if(!j(u)&&u>=0){var T=u/s;m=(m-T*(A-1))/A}else!j(l)&&l>=0&&(m*=y),m=m/A;m=m>=0?m:0}if(!j(c)&&c>=0){var w=c/s;m>w&&(m=w)}if(!j(h)&&h>=0){var M=h/s;m<M&&(m=M)}return m}var TFt=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;i.type="interval",i.shapeType="interval",i.generatePoints=!0;var n=e.background;return i.background=n,i}return t.prototype.createShapePointsCfg=function(e){var i=r.prototype.createShapePointsCfg.call(this,e),n,a=this.getAttribute("size");if(a){n=this.getAttributeValues(a,e)[0];var o=this.coordinate,s=fv(o);n=n/s}else this.defaultSize||(this.defaultSize=bT(this)),n=this.defaultSize;return i.size=n,i},t.prototype.adjustScale=function(){r.prototype.adjustScale.call(this);var e=this.getYScale();if(this.coordinate.type==="theta")e.change({nice:!1,min:0,max:uOt(e)});else{var i=this.scaleDefs,n=e.field,a=e.min,o=e.max,s=e.type;s!=="time"&&(a>0&&!L(i,[n,"min"])&&e.change({min:0}),o<=0&&!L(i,[n,"max"])&&e.change({max:0}))}},t.prototype.getDrawCfg=function(e){var i=r.prototype.getDrawCfg.call(this,e);return i.background=this.background,i},t}(Qs),bFt=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;i.type="line";var n=e.sortable,a=n===void 0?!1:n;return i.sortable=a,i}return t}(ST),Jk=["circle","square","bowtie","diamond","hexagon","triangle","triangle-down"],wFt=["cross","tick","plus","hyphen","line"];function wT(r,t,e,i,n){var a,o,s=nr(t,n,!n,"r"),l=r.parsePoints(t.points),u=l[0];if(t.isStack)u=l[1];else if(l.length>1){var c=e.addGroup();try{for(var h=qt(l),f=h.next();!f.done;f=h.next()){var d=f.value;c.addShape({type:"marker",attrs:S(S(S({},s),{symbol:au[i]||i}),d)})}}catch(v){a={error:v}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(a)throw a.error}}return c}return e.addShape({type:"marker",attrs:S(S(S({},s),{symbol:au[i]||i}),u)})}Ks("point",{defaultShapeType:"hollow-circle",getDefaultPoints:function(r){return CT(r)}});R(Jk,function(r){he("point","hollow-".concat(r),{draw:function(t,e){return wT(this,t,e,r,!0)},getMarker:function(t){var e=t.color;return{symbol:au[r]||r,style:{r:4.5,stroke:e,fill:null}}}})});var RFt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="point",e.shapeType="point",e.generatePoints=!0,e}return t.prototype.getDrawCfg=function(e){var i=r.prototype.getDrawCfg.call(this,e);return S(S({},i),{isStack:!!this.getAdjust("stack")})},t}(Qs);function MFt(r){for(var t=r[0],e=1,i=[["M",t.x,t.y]];e<r.length;){var n=r[e];(n.x!==r[e-1].x||n.y!==r[e-1].y)&&(i.push(["L",n.x,n.y]),n.x===t.x&&n.y===t.y&&e<r.length-1&&(t=r[e+1],i.push(["Z"]),i.push(["M",t.x,t.y]),e++)),e++}return Jt(fr(i),t)||i.push(["L",t.x,t.y]),i.push(["Z"]),i}Ks("polygon",{defaultShapeType:"polygon",getDefaultPoints:function(r){var t=[];return R(r.x,function(e,i){var n=r.y[i];t.push({x:e,y:n})}),t}});he("polygon","polygon",{draw:function(r,t){if(!Gi(r.points)){var e=nr(r,!0,!0),i=this.parsePath(MFt(r.points));return t.addShape("path",{attrs:S(S({},e),{path:i}),name:"polygon"})}},getMarker:function(r){var t=r.color;return{symbol:"square",style:{r:4,fill:t}}}});var IFt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="polygon",e.shapeType="polygon",e.generatePoints=!0,e}return t.prototype.createShapePointsCfg=function(e){var i=r.prototype.createShapePointsCfg.call(this,e),n=i.x,a=i.y,o;if(!(Z(n)&&Z(a))){var s=this.getXScale(),l=this.getYScale(),u=s.values.length,c=l.values.length,h=.5*1/u,f=.5*1/c;s.isCategory&&l.isCategory?(n=[n-h,n-h,n+h,n+h],a=[a-f,a+f,a+f,a-f]):Z(n)?(o=n,n=[o[0],o[0],o[1],o[1]],a=[a-f/2,a+f/2,a+f/2,a-f/2]):Z(a)&&(o=a,a=[o[0],o[1],o[1],o[0]],n=[n-h/2,n-h/2,n+h/2,n+h/2]),i.x=n,i.y=a}return i},t}(Qs);Ks("schema",{defaultShapeType:""});var LFt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="schema",e.shapeType="schema",e.generatePoints=!0,e}return t.prototype.createShapePointsCfg=function(e){var i=r.prototype.createShapePointsCfg.call(this,e),n,a=this.getAttribute("size");if(a){n=this.getAttributeValues(a,e)[0];var o=this.coordinate,s=fv(o);n=n/s}else this.defaultSize||(this.defaultSize=bT(this)),n=this.defaultSize;return i.size=n,i},t}(Qs);function OFt(r){if(!Z(r))return[];var t=pn(r);return Ne(r,function(e){return e/t})}Ks("violin",{defaultShapeType:"violin",getDefaultPoints:function(r){var t=r.size/2,e=[],i=OFt(r._size);return R(r.y,function(n,a){var o=i[a]*t,s=a===0,l=a===r.y.length-1;e.push({isMin:s,isMax:l,x:r.x-o,y:n}),e.unshift({isMin:s,isMax:l,x:r.x+o,y:n})}),e}});he("violin","violin",{draw:function(r,t){var e=nr(r,!0,!0),i=this.parsePath(Uk(r.points));return t.addShape("path",{attrs:S(S({},e),{path:i}),name:"violin"})},getMarker:function(r){var t=r.color;return{symbol:"circle",style:{r:4,fill:t}}}});var PFt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="violin",e.shapeType="violin",e.generatePoints=!0,e}return t.prototype.createShapePointsCfg=function(e){var i=r.prototype.createShapePointsCfg.call(this,e),n,a=this.getAttribute("size");if(a){n=this.getAttributeValues(a,e)[0];var o=this.coordinate,s=fv(o);n=n/s}else this.defaultSize||(this.defaultSize=bT(this)),n=this.defaultSize;return i.size=n,i._size=L(e[Ee],[this._sizeField]),i},t.prototype.initAttributes=function(){var e=this.attributeOption,i=e.size?e.size.fields[0]:this._sizeField?this._sizeField:"size";this._sizeField=i,delete e.size,r.prototype.initAttributes.call(this)},t}(Qs);he("area","line",{draw:function(r,t){var e=xy(r,!0,!1,this),i=t.addShape({type:"path",attrs:e,name:"area"});return i},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){return n===void 0&&(n=5.5),[["M",e-n,i-4],["L",e+n,i-4],["L",e+n,i+4],["L",e-n,i+4],["Z"]]},style:{r:5,stroke:t,fill:null}}}});he("area","smooth",{draw:function(r,t){var e=this.coordinate,i=xy(r,!1,!0,this,Zk(e)),n=t.addShape({type:"path",attrs:i,name:"area"});return n},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){return n===void 0&&(n=5.5),[["M",e-n,i-4],["L",e+n,i-4],["L",e+n,i+4],["L",e-n,i+4],["Z"]]},style:{r:5,fill:t,fillOpacity:1}}}});he("area","smooth-line",{draw:function(r,t){var e=this.coordinate,i=xy(r,!0,!0,this,Zk(e)),n=t.addShape({type:"path",attrs:i,name:"area"});return n},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){return n===void 0&&(n=5.5),[["M",e-n,i-4],["L",e+n,i-4],["L",e+n,i+4],["L",e-n,i+4],["Z"]]},style:{r:5,stroke:t,fill:null}}}});function BC(r,t){return["C",r.x*1/2+t.x*1/2,r.y,r.x*1/2+t.x*1/2,t.y,t.x,t.y]}function DC(r,t){var e=[];e.push({x:t.x,y:t.y}),e.push(r);var i=["Q"];return R(e,function(n){i.push(n.x,n.y)}),i}function FFt(r,t,e){var i=DC(t,e),n=[["M",r.x,r.y]];return n.push(i),n}function BFt(r,t){var e=DC(r[1],t),i=DC(r[3],t),n=[["M",r[0].x,r[0].y]];return n.push(i),n.push(["L",r[3].x,r[3].y]),n.push(["L",r[2].x,r[2].y]),n.push(e),n.push(["L",r[1].x,r[1].y]),n.push(["L",r[0].x,r[0].y]),n.push(["Z"]),n}he("edge","arc",{draw:function(r,t){var e=nr(r,!0,!1,"lineWidth"),i=r.points,n=i.length>2?"weight":"normal",a;if(r.isInCircle){var o={x:0,y:1};return n==="normal"?a=FFt(i[0],i[1],o):(e.fill=e.stroke,a=BFt(i,o)),a=this.parsePath(a),t.addShape("path",{attrs:S(S({},e),{path:a})})}else{if(n==="normal")return i=this.parsePoints(i),a=J8((i[1].x+i[0].x)/2,i[0].y,Math.abs(i[1].x-i[0].x)/2,Math.PI,Math.PI*2),t.addShape("path",{attrs:S(S({},e),{path:a})});var s=BC(i[1],i[3]),l=BC(i[2],i[0]);return a=[["M",i[0].x,i[0].y],["L",i[1].x,i[1].y],s,["L",i[3].x,i[3].y],["L",i[2].x,i[2].y],l,["Z"]],a=this.parsePath(a),e.fill=e.stroke,t.addShape("path",{attrs:S(S({},e),{path:a})})}},getMarker:function(r){return{symbol:"circle",style:{r:4.5,fill:r.color}}}});function DFt(r,t){var e=BC(r,t),i=[["M",r.x,r.y]];return i.push(e),i}he("edge","smooth",{draw:function(r,t){var e=nr(r,!0,!1,"lineWidth"),i=r.points,n=this.parsePath(DFt(i[0],i[1]));return t.addShape("path",{attrs:S(S({},e),{path:n})})},getMarker:function(r){return{symbol:"circle",style:{r:4.5,fill:r.color}}}});var wp=1/3;function NFt(r,t){var e=[];e.push({x:r.x,y:r.y*(1-wp)+t.y*wp}),e.push({x:t.x,y:r.y*(1-wp)+t.y*wp}),e.push(t);var i=[["M",r.x,r.y]];return R(e,function(n){i.push(["L",n.x,n.y])}),i}he("edge","vhv",{draw:function(r,t){var e=nr(r,!0,!1,"lineWidth"),i=r.points,n=this.parsePath(NFt(i[0],i[1]));return t.addShape("path",{attrs:S(S({},e),{path:n})})},getMarker:function(r){return{symbol:"circle",style:{r:4.5,fill:r.color}}}});he("interval","funnel",{getPoints:function(r){return r.size=r.size*2,AT(r)},draw:function(r,t){var e=nr(r,!1,!0),i=this.parsePath(Qk(r.points,r.nextPoints,!1)),n=t.addShape("path",{attrs:S(S({},e),{path:i}),name:"interval"});return n},getMarker:function(r){var t=r.color;return{symbol:"square",style:{r:4,fill:t}}}});he("interval","hollow-rect",{draw:function(r,t){var e=nr(r,!0,!1),i=t,n=r==null?void 0:r.background;if(n){i=t.addGroup();var a=Hk(r),o=Kk(r,this.parsePoints(r.points),this.coordinate);i.addShape("path",{attrs:S(S({},a),{path:o}),capture:!1,zIndex:-1,name:yT})}var s=this.parsePath(TT(r.points)),l=i.addShape("path",{attrs:S(S({},e),{path:s}),name:"interval"});return n?i:l},getMarker:function(r){var t=r.color,e=r.isInPolar;return e?{symbol:"circle",style:{r:4.5,stroke:t,fill:null}}:{symbol:"square",style:{r:4,stroke:t,fill:null}}}});function kFt(r){var t=r.x,e=r.y,i=r.y0;return Z(e)?e.map(function(n,a){return{x:Z(t)?t[a]:t,y:n}}):[{x:t,y:i},{x:t,y:e}]}he("interval","line",{getPoints:function(r){return kFt(r)},draw:function(r,t){var e=nr(r,!0,!1,"lineWidth"),i=Di(S({},e),["fill"]),n=this.parsePath(TT(r.points,!1)),a=t.addShape("path",{attrs:S(S({},i),{path:n}),name:"interval"});return a},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){return[["M",e,i-n],["L",e,i+n]]},style:{r:5,stroke:t}}}});he("interval","pyramid",{getPoints:function(r){return r.size=r.size*2,AT(r)},draw:function(r,t){var e=nr(r,!1,!0),i=this.parsePath(Qk(r.points,r.nextPoints,!0)),n=t.addShape("path",{attrs:S(S({},e),{path:i}),name:"interval"});return n},getMarker:function(r){var t=r.color;return{symbol:"square",style:{r:4,fill:t}}}});function UFt(r){var t,e=r.x,i=r.y,n=r.y0,a=r.size,o,s;Z(i)?(t=lt(i,2),o=t[0],s=t[1]):(o=n,s=i);var l=e+a/2,u=e-a/2;return[{x:e,y:o},{x:e,y:s},{x:u,y:o},{x:l,y:o},{x:u,y:s},{x:l,y:s}]}function zFt(r){return[["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["M",r[2].x,r[2].y],["L",r[3].x,r[3].y],["M",r[4].x,r[4].y],["L",r[5].x,r[5].y]]}he("interval","tick",{getPoints:function(r){return UFt(r)},draw:function(r,t){var e=nr(r,!0,!1),i=this.parsePath(zFt(r.points)),n=t.addShape("path",{attrs:S(S({},e),{path:i}),name:"interval"});return n},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){return[["M",e-n/2,i-n],["L",e+n/2,i-n],["M",e,i-n],["L",e,i+n],["M",e-n/2,i+n],["L",e+n/2,i+n]]},style:{r:5,stroke:t}}}});var HFt=function(r,t,e){var i=r.x,n=r.y,a=t.x,o=t.y,s;switch(e){case"hv":s=[{x:a,y:n}];break;case"vh":s=[{x:i,y:o}];break;case"hvh":var l=(a+i)/2;s=[{x:l,y:n},{x:l,y:o}];break;case"vhv":var u=(n+o)/2;s=[{x:i,y:u},{x:a,y:u}];break}return s};function $Ft(r,t){var e=[];return R(r,function(i,n){var a=r[n+1];if(e.push(i),a){var o=HFt(i,a,t);e=e.concat(o)}}),e}function WFt(r){return r.map(function(t,e){return e===0?["M",t.x,t.y]:["L",t.x,t.y]})}function VFt(r,t){var e=_y(r.points,r.connectNulls,r.showSinglePoint),i=[];return R(e,function(n){var a=$Ft(n,t);i=i.concat(WFt(a))}),S(S({},nr(r,!0,!1,"lineWidth")),{path:i})}R(["hv","vh","hvh","vhv"],function(r){he("line",r,{draw:function(t,e){var i=VFt(t,r),n=e.addShape({type:"path",attrs:i,name:"line"});return n},getMarker:function(t){return $k(t,r)}})});R(wFt,function(r){he("point",r,{draw:function(t,e){return wT(this,t,e,r,!0)},getMarker:function(t){var e=t.color;return{symbol:au[r],style:{r:4.5,stroke:e,fill:null}}}})});he("point","image",{draw:function(r,t){var e,i,n=nr(r,!1,!1,"r").r,a=this.parsePoints(r.points),o=a[0];if(r.isStack)o=a[1];else if(a.length>1){var s=t.addGroup();try{for(var l=qt(a),u=l.next();!u.done;u=l.next()){var c=u.value;s.addShape("image",{attrs:{x:c.x-n/2,y:c.y-n,width:n,height:n,img:r.shape[1]}})}}catch(h){e={error:h}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(e)throw e.error}}return s}return t.addShape("image",{attrs:{x:o.x-n/2,y:o.y-n,width:n,height:n,img:r.shape[1]}})},getMarker:function(r){var t=r.color;return{symbol:"circle",style:{r:4.5,fill:t}}}});R(Jk,function(r){he("point",r,{draw:function(t,e){return wT(this,t,e,r,!1)},getMarker:function(t){var e=t.color;return{symbol:au[r]||r,style:{r:4.5,fill:e}}}})});function gO(r){var t=Z(r)?r:[r],e=t[0],i=t[t.length-1],n=t.length>1?t[1]:e,a=t.length>3?t[3]:i,o=t.length>2?t[2]:n;return{min:e,max:i,min1:n,max1:a,median:o}}function mO(r,t,e){var i=e/2,n;if(Z(t)){var a=gO(t),o=a.min,s=a.max,l=a.median,u=a.min1,c=a.max1,h=r-i,f=r+i;n=[[h,s],[f,s],[r,s],[r,c],[h,u],[h,c],[f,c],[f,u],[r,u],[r,o],[h,o],[f,o],[h,l],[f,l]]}else{t=j(t)?.5:t;var d=gO(r),o=d.min,s=d.max,l=d.median,u=d.min1,c=d.max1,v=t-i,p=t+i;n=[[o,v],[o,p],[o,t],[u,t],[u,v],[u,p],[c,p],[c,v],[c,t],[s,t],[s,v],[s,p],[l,v],[l,p]]}return n.map(function(g){return{x:g[0],y:g[1]}})}function GFt(r){return[["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["M",r[2].x,r[2].y],["L",r[3].x,r[3].y],["M",r[4].x,r[4].y],["L",r[5].x,r[5].y],["L",r[6].x,r[6].y],["L",r[7].x,r[7].y],["L",r[4].x,r[4].y],["Z"],["M",r[8].x,r[8].y],["L",r[9].x,r[9].y],["M",r[10].x,r[10].y],["L",r[11].x,r[11].y],["M",r[12].x,r[12].y],["L",r[13].x,r[13].y]]}he("schema","box",{getPoints:function(r){var t=r.x,e=r.y,i=r.size;return mO(t,e,i)},draw:function(r,t){var e=nr(r,!0,!1),i=this.parsePath(GFt(r.points)),n=t.addShape("path",{attrs:S(S({},e),{path:i,name:"schema"})});return n},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){var a=[i-6,i-3,i,i+3,i+6],o=mO(e,a,n);return[["M",o[0].x+1,o[0].y],["L",o[1].x-1,o[1].y],["M",o[2].x,o[2].y],["L",o[3].x,o[3].y],["M",o[4].x,o[4].y],["L",o[5].x,o[5].y],["L",o[6].x,o[6].y],["L",o[7].x,o[7].y],["L",o[4].x,o[4].y],["Z"],["M",o[8].x,o[8].y],["L",o[9].x,o[9].y],["M",o[10].x+1,o[10].y],["L",o[11].x-1,o[11].y],["M",o[12].x,o[12].y],["L",o[13].x,o[13].y]]},style:{r:6,lineWidth:1,stroke:t}}}});function XFt(r){var t=Z(r)?r:[r],e=t.sort(function(i,n){return n-i});return tOt(e,4,e[e.length-1])}function yO(r,t,e){var i=XFt(t);return[{x:r,y:i[0]},{x:r,y:i[1]},{x:r-e/2,y:i[2]},{x:r-e/2,y:i[1]},{x:r+e/2,y:i[1]},{x:r+e/2,y:i[2]},{x:r,y:i[2]},{x:r,y:i[3]}]}function YFt(r){return[["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["M",r[2].x,r[2].y],["L",r[3].x,r[3].y],["L",r[4].x,r[4].y],["L",r[5].x,r[5].y],["Z"],["M",r[6].x,r[6].y],["L",r[7].x,r[7].y]]}he("schema","candle",{getPoints:function(r){var t=r.x,e=r.y,i=r.size;return yO(t,e,i)},draw:function(r,t){var e=nr(r,!0,!0),i=this.parsePath(YFt(r.points)),n=t.addShape("path",{attrs:S(S({},e),{path:i,name:"schema"})});return n},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){var a=[i+7.5,i+3,i-3,i-7.5],o=yO(e,a,n);return[["M",o[0].x,o[0].y],["L",o[1].x,o[1].y],["M",o[2].x,o[2].y],["L",o[3].x,o[3].y],["L",o[4].x,o[4].y],["L",o[5].x,o[5].y],["Z"],["M",o[6].x,o[6].y],["L",o[7].x,o[7].y]]},style:{lineWidth:1,stroke:t,fill:t,r:6}}}});function jFt(r,t){var e=Math.abs(r[0].x-r[2].x),i=Math.abs(r[0].y-r[2].y),n=Math.min(e,i);t&&(n=Be(t,0,Math.min(e,i))),n=n/2;var a=(r[0].x+r[2].x)/2,o=(r[0].y+r[2].y)/2;return{x:a-n,y:o-n,width:n*2,height:n*2}}he("polygon","square",{draw:function(r,t){if(!Gi(r.points)){var e=nr(r,!0,!0),i=this.parsePoints(r.points);return t.addShape("rect",{attrs:S(S({},e),jFt(i,r.size)),name:"polygon"})}},getMarker:function(r){var t=r.color;return{symbol:"square",style:{r:4,fill:t}}}});he("violin","smooth",{draw:function(r,t){var e=nr(r,!0,!0),i=this.parsePath(zk(r.points));return t.addShape("path",{attrs:S(S({},e),{path:i})})},getMarker:function(r){var t=r.color;return{symbol:"circle",style:{stroke:null,r:4,fill:t}}}});he("violin","hollow",{draw:function(r,t){var e=nr(r,!0,!1),i=this.parsePath(Uk(r.points));return t.addShape("path",{attrs:S(S({},e),{path:i})})},getMarker:function(r){var t=r.color;return{symbol:"circle",style:{r:4,fill:null,stroke:t}}}});he("violin","hollow-smooth",{draw:function(r,t){var e=nr(r,!0,!1),i=this.parsePath(zk(r.points));return t.addShape("path",{attrs:S(S({},e),{path:i})})},getMarker:function(r){var t=r.color;return{symbol:"circle",style:{r:4,fill:null,stroke:t}}}});var ZFt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getLabelValueDir=function(e){var i="y",n=e.points;return n[0][i]<=n[2][i]?1:-1},t.prototype.getLabelOffsetPoint=function(e,i,n,a){var o,s=r.prototype.getLabelOffsetPoint.call(this,e,i,n),l=this.getCoordinate(),u=l.isTransposed,c=u?"x":"y",h=this.getLabelValueDir(e.mappingData);return s=S(S({},s),(o={},o[c]=s[c]*h,o)),l.isReflect("x")&&(s=S(S({},s),{x:s.x*-1})),l.isReflect("y")&&(s=S(S({},s),{y:s.y*-1})),s},t.prototype.getThemedLabelCfg=function(e){var i=this.geometry,n=this.getDefaultLabelCfg(),a=i.theme;return nt({},n,a.labels,e.position==="middle"?{offset:0}:{},e)},t.prototype.setLabelPosition=function(e,i,n,a){var o=this.getCoordinate(),s=o.isTransposed,l=i.points,u=o.convert(l[0]),c=o.convert(l[2]),h=this.getLabelValueDir(i),f,d,v,p,g=Z(i.shape)?i.shape[0]:i.shape;if(g==="funnel"||g==="pyramid"){var m=L(i,"nextPoints"),y=L(i,"points");if(m){var _=o.convert(y[0]),x=o.convert(y[1]),C=o.convert(m[0]),A=o.convert(m[1]);s?(f=Math.min(C.y,_.y),v=Math.max(C.y,_.y),d=(x.x+A.x)/2,p=(_.x+C.x)/2):(f=Math.min((x.y+A.y)/2,(_.y+C.y)/2),v=Math.max((x.y+A.y)/2,(_.y+C.y)/2),d=A.x,p=_.x)}else f=Math.min(c.y,u.y),v=Math.max(c.y,u.y),d=c.x,p=u.x}else f=Math.min(c.y,u.y),v=Math.max(c.y,u.y),d=c.x,p=u.x;switch(a){case"right":e.x=d,e.y=(f+v)/2,e.textAlign=L(e,"textAlign",h>0?"left":"right");break;case"left":e.x=p,e.y=(f+v)/2,e.textAlign=L(e,"textAlign",h>0?"left":"right");break;case"bottom":s&&(e.x=(d+p)/2),e.y=v,e.textAlign=L(e,"textAlign","center"),e.textBaseline=L(e,"textBaseline",h>0?"bottom":"top");break;case"middle":s&&(e.x=(d+p)/2),e.y=(f+v)/2,e.textAlign=L(e,"textAlign","center"),e.textBaseline=L(e,"textBaseline","middle");break;case"top":s&&(e.x=(d+p)/2),e.y=f,e.textAlign=L(e,"textAlign","center"),e.textBaseline=L(e,"textBaseline",h>0?"bottom":"top");break}},t}(yy),Rp=Math.PI/2,tU=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getLabelOffset=function(e){var i=this.getCoordinate(),n=0;if(Mt(e))n=e;else if(mt(e)&&e.indexOf("%")!==-1){var a=i.getRadius();i.innerRadius>0&&(a=a*(1-i.innerRadius)),n=parseFloat(e)*.01*a}return n},t.prototype.getLabelItems=function(e){var i=r.prototype.getLabelItems.call(this,e),n=this.geometry.getYScale();return Ne(i,function(a){if(a&&n){var o=n.scale(L(a.data,n.field));return S(S({},a),{percent:o})}return a})},t.prototype.getLabelAlign=function(e){var i=this.getCoordinate(),n;if(e.labelEmit)n=e.angle<=Math.PI/2&&e.angle>=-Math.PI/2?"left":"right";else if(!i.isTransposed)n="center";else{var a=i.getCenter(),o=e.offset;Math.abs(e.x-a.x)<1?n="center":e.angle>Math.PI||e.angle<=0?n=o>0?"left":"right":n=o>0?"right":"left"}return n},t.prototype.getLabelPoint=function(e,i,n){var a=1,o,s=e.content[n];this.isToMiddle(i)?o=this.getMiddlePoint(i.points):(e.content.length===1&&n===0?n=1:n===0&&(a=-1),o=this.getArcPoint(i,n));var l=e.offset*a,u=this.getPointAngle(o),c=e.labelEmit,h=this.getCirclePoint(u,l,o,c);return h.r===0?h.content="":(h.content=s,h.angle=u,h.color=i.color),h.rotate=e.autoRotate?this.getLabelRotate(u,l,c):e.rotate,h.start={x:o.x,y:o.y},h},t.prototype.getArcPoint=function(e,i){return i===void 0&&(i=0),!Z(e.x)&&!Z(e.y)?{x:e.x,y:e.y}:{x:Z(e.x)?e.x[i]:e.x,y:Z(e.y)?e.y[i]:e.y}},t.prototype.getPointAngle=function(e){return $c(this.getCoordinate(),e)},t.prototype.getCirclePoint=function(e,i,n,a){var o=this.getCoordinate(),s=o.getCenter(),l=fy(o,n);if(l===0)return S(S({},s),{r:l});var u=e;if(o.isTransposed&&l>i&&!a){var c=Math.asin(i/(2*l));u=e+c*2}else l=l+i;return{x:s.x+l*Math.cos(u),y:s.y+l*Math.sin(u),r:l}},t.prototype.getLabelRotate=function(e,i,n){var a=e+Rp;return n&&(a-=Rp),a&&(a>Rp?a=a-Math.PI:a<-Rp&&(a=a+Math.PI)),a},t.prototype.getMiddlePoint=function(e){var i=this.getCoordinate(),n=e.length,a={x:0,y:0};return R(e,function(o){a.x+=o.x,a.y+=o.y}),a.x/=n,a.y/=n,a=i.convert(a),a},t.prototype.isToMiddle=function(e){return e.x.length>2},t}(yy),qFt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.defaultLayout="distribute",e}return t.prototype.getDefaultLabelCfg=function(e,i){var n=r.prototype.getDefaultLabelCfg.call(this,e,i);return nt({},n,L(this.geometry.theme,"pieLabels",{}))},t.prototype.getLabelOffset=function(e){return r.prototype.getLabelOffset.call(this,e)||0},t.prototype.getLabelRotate=function(e,i,n){var a;return i<0&&(a=e,a>Math.PI/2&&(a=a-Math.PI),a<-Math.PI/2&&(a=a+Math.PI)),a},t.prototype.getLabelAlign=function(e){var i=this.getCoordinate(),n=i.getCenter(),a;return e.angle<=Math.PI/2&&e.x>=n.x?a="left":a="right",e.offset<=0&&(a==="right"?a="left":a="right"),a},t.prototype.getArcPoint=function(e){return e},t.prototype.getPointAngle=function(e){var i=this.getCoordinate(),n={x:Z(e.x)?e.x[0]:e.x,y:e.y[0]},a={x:Z(e.x)?e.x[1]:e.x,y:e.y[1]},o,s=$c(i,n);if(e.points&&e.points[0].y===e.points[1].y)o=s;else{var l=$c(i,a);s>=l&&(l=l+Math.PI*2),o=s+(l-s)/2}return o},t.prototype.getCirclePoint=function(e,i){var n=this.getCoordinate(),a=n.getCenter(),o=n.getRadius()+i;return S(S({},sr(a.x,a.y,o,e)),{angle:e,r:o})},t}(tU),_O=4;function KFt(r,t,e,i,n,a){var o,s,l=!0,u=i.start,c=i.end,h=Math.min(u.y,c.y),f=Math.abs(u.y-c.y),d,v=0,p=Number.MIN_VALUE,g=t.map(function(T){return T.y>v&&(v=T.y),T.y<p&&(p=T.y),{size:e,targets:[T.y-h]}});for(p-=h,v-h>f&&(f=v-h);l;)for(g.forEach(function(T){var w=(Math.min.apply(p,T.targets)+Math.max.apply(p,T.targets))/2;T.pos=Math.min(Math.max(p,w-T.size/2),f-T.size)}),l=!1,d=g.length;d--;)if(d>0){var m=g[d-1],y=g[d];m.pos+m.size>y.pos&&(m.size+=y.size,m.targets=m.targets.concat(y.targets),m.pos+m.size>f&&(m.pos=f-m.size),g.splice(d,1),l=!0)}d=0,g.forEach(function(T){var w=h+e/2;T.targets.forEach(function(){t[d].y=T.pos+w,w+=e,d++})});var _={};try{for(var x=qt(r),C=x.next();!C.done;C=x.next()){var A=C.value;_[A.get("id")]=A}}catch(T){o={error:T}}finally{try{C&&!C.done&&(s=x.return)&&s.call(x)}finally{if(o)throw o.error}}t.forEach(function(T){var w=T.r*T.r,M=Math.pow(Math.abs(T.y-n.y),2);if(w<M)T.x=n.x;else{var O=Math.sqrt(w-M);a?T.x=n.x+O:T.x=n.x-O}var P=_[T.id];P.attr("x",T.x),P.attr("y",T.y);var D=pa(P.getChildren(),function(z){return z.get("type")==="text"});D&&(D.attr("y",T.y),D.attr("x",T.x))})}function QFt(r,t,e,i){if(!(!r.length||!t.length)){var n=r[0]?r[0].offset:0,a=t[0].get("coordinate"),o=a.getRadius(),s=a.getCenter();if(n>0){var l=14,u=o+n,c=u*2+l*2,h={start:a.start,end:a.end},f=[[],[]];r.forEach(function(d){d&&(d.textAlign==="right"?f[0].push(d):f[1].push(d))}),f.forEach(function(d,v){var p=c/l;d.length>p&&(d.sort(function(g,m){return m["..percent"]-g["..percent"]}),d.splice(p,d.length-p)),d.sort(function(g,m){return g.y-m.y}),KFt(t,d,l,h,s,v)})}R(r,function(d){if(d&&d.labelLine){var v=d.offset,p=d.angle,g=sr(s.x,s.y,o,p),m=sr(s.x,s.y,o+v/2,p),y=d.x+L(d,"offsetX",0),_=d.y+L(d,"offsetY",0),x={x:y-Math.cos(p)*_O,y:_-Math.sin(p)*_O};re(d.labelLine)||(d.labelLine={}),d.labelLine.path=["M ".concat(g.x),"".concat(g.y," Q").concat(m.x),"".concat(m.y," ").concat(x.x),x.y].join(",")}})}}function eU(r,t,e){var i=r.filter(function(v){return!v.invisible});i.sort(function(v,p){return v.y-p.y});var n=!0,a=e.minY,o=e.maxY,s=Math.abs(a-o),l,u=0,c=Number.MIN_VALUE,h=i.map(function(v){return v.y>u&&(u=v.y),v.y<c&&(c=v.y),{content:v.content,size:t,targets:[v.y-a],pos:null}});for(c-=a,u-a>s&&(s=u-a);n;)for(h.forEach(function(v){var p=(Math.min.apply(c,v.targets)+Math.max.apply(c,v.targets))/2;v.pos=Math.min(Math.max(c,p-v.size/2),s-v.size),v.pos=Math.max(0,v.pos)}),n=!1,l=h.length;l--;)if(l>0){var f=h[l-1],d=h[l];f.pos+f.size>d.pos&&(f.size+=d.size,f.targets=f.targets.concat(d.targets),f.pos+f.size>s&&(f.pos=s-f.size),h.splice(l,1),n=!0)}l=0,h.forEach(function(v){var p=a+t/2;v.targets.forEach(function(){i[l].y=v.pos+p,p+=t,l++})})}var xO=4;function JFt(r,t){var e=t.getCenter(),i=t.getRadius();if(r&&r.labelLine){var n=r.angle,a=r.offset,o=sr(e.x,e.y,i,n),s=r.x+L(r,"offsetX",0)*(Math.cos(n)>0?1:-1),l=r.y+L(r,"offsetY",0)*(Math.sin(n)>0?1:-1),u={x:s-Math.cos(n)*xO,y:l-Math.sin(n)*xO},c=r.labelLine.smooth,h=[],f=u.x-e.x,d=u.y-e.y,v=Math.atan(d/f);if(f<0&&(v+=Math.PI),c===!1){re(r.labelLine)||(r.labelLine={});var p=0;(n<0&&n>-Math.PI/2||n>Math.PI*1.5)&&u.y>o.y&&(p=1),n>=0&&n<Math.PI/2&&u.y>o.y&&(p=1),n>=Math.PI/2&&n<Math.PI&&o.y>u.y&&(p=1),(n<-Math.PI/2||n>=Math.PI&&n<Math.PI*1.5)&&o.y>u.y&&(p=1);var g=a/2>4?4:Math.max(a/2-1,0),m=sr(e.x,e.y,i+g,n),y=sr(e.x,e.y,i+a/2,v),_=0;h.push("M ".concat(o.x," ").concat(o.y)),h.push("L ".concat(m.x," ").concat(m.y)),h.push("A ".concat(e.x," ").concat(e.y," 0 ").concat(_," ").concat(p," ").concat(y.x," ").concat(y.y)),h.push("L ".concat(u.x," ").concat(u.y))}else{var m=sr(e.x,e.y,i+(a/2>4?4:Math.max(a/2-1,0)),n),x=o.x<e.x?1:-1;h.push("M ".concat(u.x," ").concat(u.y));var C=(o.y-e.y)/(o.x-e.x),A=(u.y-e.y)/(u.x-e.x);Math.abs(C-A)>Math.pow(Math.E,-16)&&h.push.apply(h,["C",u.x+x*4,u.y,2*m.x-o.x,2*m.y-o.y,o.x,o.y]),h.push("L ".concat(o.x," ").concat(o.y))}r.labelLine.path=h.join(" ")}}function tBt(r,t,e,i){var n,a,o=Ur(r,function(w){return!j(w)}),s=t[0]&&t[0].get("coordinate");if(s){var l=s.getCenter(),u=s.getRadius(),c={};try{for(var h=qt(t),f=h.next();!f.done;f=h.next()){var d=f.value;c[d.get("id")]=d}}catch(w){n={error:w}}finally{try{f&&!f.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}var v=L(o[0],"labelHeight",14),p=L(o[0],"offset",0);if(!(p<=0)){var g="left",m="right",y=cn(o,function(w){return w.x<l.x?g:m}),_=s.start,x=s.end,C=Math.min((u+p+v)*2,s.getHeight()),A=C/2,T={minX:_.x,maxX:x.x,minY:l.y-A,maxY:l.y+A};R(y,function(w,M){var O=Math.floor(C/v);w.length>O&&(w.sort(function(P,D){return D.percent-P.percent}),R(w,function(P,D){D+1>O&&(c[P.id].set("visible",!1),P.invisible=!0)})),eU(w,v,T)}),R(y,function(w,M){R(w,function(O){var P=M===m,D=c[O.id],z=D.getChildByIndex(0);if(z){var Y=u+p,H=O.y-l.y,N=Math.pow(Y,2),W=Math.pow(H,2),Q=N-W>0?N-W:0,q=Math.sqrt(Q),J=Math.abs(Math.cos(O.angle)*Y);P?O.x=l.x+Math.max(q,J):O.x=l.x-Math.max(q,J)}z&&(z.attr("y",O.y),z.attr("x",O.x)),JFt(O,s)})})}}}var NC=4,eBt=4,CO=4;function rBt(r,t,e){var i=t.getCenter(),n=t.getRadius(),a={x:r.x-(e?CO:-CO),y:r.y},o=sr(i.x,i.y,n+NC,r.angle),s={x:a.x,y:a.y},l={x:o.x,y:o.y},u=sr(i.x,i.y,n,r.angle),c="";if(a.y!==o.y){var h=e?4:-4;s.y=a.y,r.angle<0&&r.angle>=-Math.PI/2&&(s.x=Math.max(o.x,a.x-h),a.y<o.y?l.y=s.y:(l.y=o.y,l.x=Math.max(l.x,s.x-h))),r.angle>0&&r.angle<Math.PI/2&&(s.x=Math.max(o.x,a.x-h),a.y>o.y?l.y=s.y:(l.y=o.y,l.x=Math.max(l.x,s.x-h))),r.angle>Math.PI/2&&(s.x=Math.min(o.x,a.x-h),a.y>o.y?l.y=s.y:(l.y=o.y,l.x=Math.min(l.x,s.x-h))),r.angle<-Math.PI/2&&(s.x=Math.min(o.x,a.x-h),a.y<o.y?l.y=s.y:(l.y=o.y,l.x=Math.min(l.x,s.x-h)))}c=["M ".concat(a.x,",").concat(a.y),"L ".concat(s.x,",").concat(s.y),"L ".concat(l.x,",").concat(l.y),"L ".concat(o.x,",").concat(o.y),"L ".concat(u.x,",").concat(u.y)].join(" "),r.labelLine=nt({},r.labelLine,{path:c})}function iBt(r,t,e,i){var n,a,o=t[0]&&t[0].get("coordinate");if(o){var s=o.getCenter(),l=o.getRadius(),u={};try{for(var c=qt(t),h=c.next();!h.done;h=c.next()){var f=h.value;u[f.get("id")]=f}}catch(w){n={error:w}}finally{try{h&&!h.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}var d=L(r[0],"labelHeight",14),v=Math.max(L(r[0],"offset",0),NC);R(r,function(w){if(w){var M=L(u,[w.id]);if(M){var O=w.x>s.x||w.x===s.x&&w.y>s.y,P=j(w.offsetX)?eBt:w.offsetX,D=sr(s.x,s.y,l+NC,w.angle),z=v+P;w.x=s.x+(O?1:-1)*(l+z),w.y=D.y}}});var p=o.start,g=o.end,m="left",y="right",_=cn(r,function(w){return w.x<s.x?m:y}),x=(l+v)*2+d;R(_,function(w){var M=w.length*d;M>x&&(x=Math.min(M,Math.abs(p.y-g.y)))});var C={minX:p.x,maxX:g.x,minY:s.y-x/2,maxY:s.y+x/2};R(_,function(w,M){var O=x/d;w.length>O&&(w.sort(function(P,D){return D.percent-P.percent}),R(w,function(P,D){D>O&&(u[P.id].set("visible",!1),P.invisible=!0)})),eU(w,d,C)});var A=C.minY,T=C.maxY;R(_,function(w,M){var O=M===y;R(w,function(P){var D=L(u,P&&[P.id]);if(D){if(P.y<A||P.y>T){D.set("visible",!1);return}var z=D.getChildByIndex(0),Y=z.getCanvasBBox(),H={x:O?Y.x:Y.maxX,y:Y.y+Y.height/2};pv(z,P.x-H.x,P.y-H.y),P.labelLine&&rBt(P,o,O)}})})}}function nBt(r,t,e,i){R(t,function(n){var a=i.minX,o=i.minY,s=i.maxX,l=i.maxY,u=n.getCanvasBBox(),c=u.minX,h=u.minY,f=u.maxX,d=u.maxY,v=u.x,p=u.y,g=u.width,m=u.height,y=v,_=p;(c<a||f<a)&&(y=a),(h<o||d<o)&&(_=o),c>s?y=s-g:f>s&&(y=y-(f-s)),h>l?_=l-m:d>l&&(_=_-(d-l)),(y!==v||_!==p)&&pv(n,y-v,_-p)})}function aBt(r,t,e,i){R(t,function(n,a){var o=n.getCanvasBBox(),s=e[a].getBBox();(o.minX<s.minX||o.minY<s.minY||o.maxX>s.maxX||o.maxY>s.maxY)&&n.remove(!0)})}var oBt=100,rU=function(){function r(t){t===void 0&&(t={}),this.bitmap={};var e=t.xGap,i=e===void 0?1:e,n=t.yGap,a=n===void 0?8:n;this.xGap=i,this.yGap=a}return r.prototype.hasGap=function(t){for(var e=!0,i=this.bitmap,n=Math.round(t.minX),a=Math.round(t.maxX),o=Math.round(t.minY),s=Math.round(t.maxY),l=n;l<=a;l+=1){if(!i[l]){i[l]={};continue}if(l===n||l===a){for(var u=o;u<=s;u++)if(i[l][u]){e=!1;break}}else if(i[l][o]||i[l][s]){e=!1;break}}return e},r.prototype.fillGap=function(t){for(var e=this.bitmap,i=Math.round(t.minX),n=Math.round(t.maxX),a=Math.round(t.minY),o=Math.round(t.maxY),s=i;s<=n;s+=1)e[s]||(e[s]={});for(var s=i;s<=n;s+=this.xGap){for(var l=a;l<=o;l+=this.yGap)e[s][l]=!0;e[s][o]=!0}if(this.yGap!==1)for(var s=a;s<=o;s+=1)e[i][s]=!0,e[n][s]=!0;if(this.xGap!==1)for(var s=i;s<=n;s+=1)e[s][a]=!0,e[s][o]=!0},r.prototype.destroy=function(){this.bitmap={}},r}();function sBt(r,t,e){e===void 0&&(e=oBt);var i=-1,n=r.attr(),a=n.x,o=n.y,s=r.getCanvasBBox(),l=Math.sqrt(s.width*s.width+s.height*s.height),u,c=-i,h=0,f=0,d=function(m){var y=m*.1;return[y*Math.cos(y),y*Math.sin(y)]};if(t.hasGap(s))return t.fillGap(s),!0;for(var v=!1,p=0,g={};Math.min(Math.abs(h),Math.abs(f))<l&&p<e;)if(u=d(c+=i),h=~~u[0],f=~~u[1],!(!h&&!f||g["".concat(h,"-").concat(f)])&&(r.attr({x:a+h,y:o+f}),h+f<0&&r.attr("textAlign","right"),p++,t.hasGap(r.getCanvasBBox()))){t.fillGap(r.getCanvasBBox()),v=!0,g["".concat(h,"-").concat(f)]=!0;break}return v}function lBt(r,t,e,i){var n=r.getCanvasBBox(),a=n.width,o=n.height,s={x:t,y:e,textAlign:"center"};switch(i){case 0:s.y-=o+1,s.x+=1,s.textAlign="left";break;case 1:s.y-=o+1,s.x-=1,s.textAlign="right";break;case 2:s.y+=o+1,s.x-=1,s.textAlign="right";break;case 3:s.y+=o+1,s.x+=1,s.textAlign="left";break;case 5:s.y-=o*2+2;break;case 6:s.y+=o*2+2;break;case 7:s.x+=a+1,s.textAlign="left";break;case 8:s.x-=a+1,s.textAlign="right";break}return r.attr(s),r.getCanvasBBox()}function uBt(r,t,e,i){var n=new rU;R(t,function(a){var o=a.find(function(s){return s.get("type")==="text"});sBt(o,n)||a.remove(!0)}),n.destroy()}function cBt(r,t,e,i){var n=new rU;R(t,function(a){for(var o=a.find(function(d){return d.get("type")==="text"}),s=o.attr(),l=s.x,u=s.y,c=!1,h=0;h<=8;h++){var f=lBt(o,l,u,h);if(n.hasGap(f)){n.fillGap(f),c=!0;break}}c||a.remove(!0)}),n.destroy()}function hBt(r,t){return(r[0]||0)*(t[0]||0)+(r[1]||0)*(t[1]||0)+(r[2]||0)*(t[2]||0)}function EO(r){if(r.length>4)return[];var t=function(n,a){return[a.x-n.x,a.y-n.y]},e=t(r[0],r[1]),i=t(r[1],r[2]);return[e,i]}function Mp(r,t,e){t===void 0&&(t=0),e===void 0&&(e={x:0,y:0});var i=r.x,n=r.y;return{x:(i-e.x)*Math.cos(-t)+(n-e.y)*Math.sin(-t)+e.x,y:(e.x-i)*Math.sin(-t)+(n-e.y)*Math.cos(-t)+e.y}}function SO(r){var t=[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}],e=r.rotation;return e?[Mp(t[0],e,t[0]),Mp(t[1],e,t[0]),Mp(t[2],e,t[0]),Mp(t[3],e,t[0])]:t}function AO(r,t){if(r.length>4)return{min:0,max:0};var e=[];return r.forEach(function(i){e.push(hBt([i.x,i.y],t))}),{min:Math.min.apply(Math,_t([],lt(e),!1)),max:Math.max.apply(Math,_t([],lt(e),!1))}}function fBt(r,t){return r.max>t.min&&r.min<t.max}function dBt(r){return typeof r=="number"&&!Number.isNaN(r)&&r!==1/0&&r!==-1/0}function TO(r){return["x","y","width","height"].every(function(t){return dBt(r[t])})}function vBt(r,t,e){return e===void 0&&(e=0),!(t.x>r.x+r.width+e||t.x+t.width<r.x-e||t.y>r.y+r.height+e||t.y+t.height<r.y-e)}function pBt(r,t,e){if(e===void 0&&(e=0),!TO(r)||!TO(t))return!1;if(!r.rotation&&!t.rotation)return vBt(r,t,e);for(var i=SO(r),n=SO(t),a=EO(i).concat(EO(n)),o=0;o<a.length;o++){var s=a[o],l=AO(i,s),u=AO(n,s);if(!fBt(l,u))return!1}return!0}var gBt=function(){function r(t){var e=this;this.queue=[],this.worker=new Worker(t),this.worker.onmessage=function(i){var n;(n=e.queue.shift())===null||n===void 0||n.resolve(i)},this.worker.onmessageerror=function(i){var n;console.warn("[AntV G2] Web worker is not available"),(n=e.queue.shift())===null||n===void 0||n.reject(i)}}return r.prototype.post=function(t,e){var i=this;return new Promise(function(n,a){i.queue.push({resolve:n,reject:a});try{i.worker.postMessage(t)}catch{console.warn("[AntV G2] Web worker is not available"),ut(e)&&e()}})},r.prototype.destroy=function(){this.worker.terminate()},r}();function mBt(r){if(!(typeof window>"u")){var t;try{t=new Blob([r.toString()],{type:"application/javascript"})}catch{t=new window.BlobBuilder,t.append(r.toString()),t=t.getBlob()}return new gBt(URL.createObjectURL(t))}}var yBt=function(r){function t(){function u(_,x){return(_[0]||0)*(x[0]||0)+(_[1]||0)*(x[1]||0)+(_[2]||0)*(x[2]||0)}function c(_){if(_.length>4)return[];var x=function(T,w){return[w.x-T.x,w.y-T.y]},C=x(_[0],_[1]),A=x(_[1],_[2]);return[C,A]}function h(_,x,C){x===void 0&&(x=0),C===void 0&&(C={x:0,y:0});var A=_.x,T=_.y;return{x:(A-C.x)*Math.cos(-x)+(T-C.y)*Math.sin(-x)+C.x,y:(C.x-A)*Math.sin(-x)+(T-C.y)*Math.cos(-x)+C.y}}function f(_){var x=[{x:_.x,y:_.y},{x:_.x+_.width,y:_.y},{x:_.x+_.width,y:_.y+_.height},{x:_.x,y:_.y+_.height}],C=_.rotation;return C?[h(x[0],C,x[0]),h(x[1],C,x[0]),h(x[2],C,x[0]),h(x[3],C,x[0])]:x}function d(_,x){if(_.length>4)return{min:0,max:0};var C=[];return _.forEach(function(A){C.push(u([A.x,A.y],x))}),{min:Math.min.apply(null,C),max:Math.max.apply(null,C)}}function v(_,x){return _.max>x.min&&_.min<x.max}function p(_){return typeof _=="number"&&!Number.isNaN(_)&&_!==1/0&&_!==-1/0}function g(_){return["x","y","width","height"].every(function(x){return p(_[x])})}function m(_,x,C){return C===void 0&&(C=0),!(x.x>_.x+_.width+C||x.x+x.width<_.x-C||x.y>_.y+_.height+C||x.y+x.height<_.y-C)}function y(_,x,C){if(C===void 0&&(C=0),!g(_)||!g(x))return!1;if(!_.rotation&&!x.rotation)return m(_,x,C);for(var A=f(_),T=f(x),w=c(A).concat(c(T)),M=0;M<w.length;M++){var O=w[M],P=d(A,O),D=d(T,O);if(!v(P,D))return!1}return!0}return{intersect:y}}var e=t().intersect;function i(u){for(var c=u.slice(),h=0;h<c.length;h++){var f=c[h];if(f.visible)for(var d=h+1;d<c.length;d++){var v=c[d];f!==v&&v.visible&&e(f,v)&&(v.visible=!1)}}return c}var n={"hide-overlap":i};try{var a=JSON.parse(r.data);if(!a||!a.type||!n[a.type])return;var o=a.type,s=a.items,l=n[o](s);self.postMessage(l)}catch(u){throw u}},_Bt=`
   self.onmessage = `.concat(yBt.toString(),`
`),G_=function(r){for(var t=r.slice(),e=0;e<t.length;e++){var i=t[e];if(i.visible)for(var n=e+1;n<t.length;n++){var a=t[n];i!==a&&a.visible&&pBt(i,a)&&(a.visible=!1)}}return t},X_=new Map,bO=mBt(_Bt);function xBt(r,t,e,i){return xi(this,void 0,void 0,function(){var n,a,o,s,l,u;return da(this,function(c){switch(c.label){case 0:return n=t.map(function(h,f){return S(S({},Bk(h,r[f],L(r[f],"background.padding"))),{visible:!0})}),a=JSON.stringify(n),o=function(h){return X_.set(a,h),R(h,function(f,d){var v=f.visible,p=t[d];v?p==null||p.show():p==null||p.hide()}),h},X_.get(a)?(o(X_.get(a)),[3,7]):[3,1];case 1:if(!bO)return[3,6];c.label=2;case 2:return c.trys.push([2,4,,5]),s=JSON.stringify({type:"hide-overlap",items:n}),[4,bO.post(s,function(){return o(G_(n))})];case 3:return l=c.sent(),o(Array.isArray(l.data)?l.data:[]),[3,5];case 4:return u=c.sent(),console.error(u),o(G_(n)),[3,5];case 5:return[3,7];case 6:o(G_(n)),c.label=7;case 7:return[2]}})})}var wO={"#5B8FF9":!0},CBt=function(r){var t=Ts.toRGB(r).toUpperCase();if(wO[t])return wO[t];var e=lt(Ts.rgb2arr(t),3),i=e[0],n=e[1],a=e[2],o=(i*299+n*587+a*114)/1e3<128;return o};function EBt(r,t,e){if(e.length!==0){var i=e[0].get("element"),n=i.geometry.theme,a=n.labels||{},o=a.fillColorLight,s=a.fillColorDark;e.forEach(function(l,u){var c=t[u],h=c.find(function(m){return m.get("type")==="text"}),f=Si.fromObject(l.getBBox()),d=Si.fromObject(h.getCanvasBBox()),v=!f.contains(d),p=l.attr("fill"),g=CBt(p);v?h.attr(n.overflowLabels.style):g?o&&h.attr("fill",o):s&&h.attr("fill",s)})}}function SBt(r,t,e){var i=r.coordinate,n=ks(t),a=Si.fromObject(n.getCanvasBBox()),o=Si.fromObject(e.getBBox());return i.isTransposed?o.height>=a.height:o.width>=a.width}function ABt(r,t,e){var i=!!r.getAdjust("stack");return i||t.every(function(n,a){var o=e[a];return SBt(r,n,o)})}function TBt(r,t,e){var i=r.coordinate,n=Si.fromObject(e.getBBox()),a=ks(t);i.isTransposed?a.attr({x:n.minX+n.width/2,textAlign:"center"}):a.attr({y:n.minY+n.height/2,textBaseline:"middle"})}function bBt(r,t,e){var i;if(e.length!==0){var n=(i=e[0])===null||i===void 0?void 0:i.get("element"),a=n==null?void 0:n.geometry;if(!(!a||a.type!=="interval")){var o=ABt(a,t,e);o&&e.forEach(function(s,l){var u=t[l];TBt(a,u,s)})}}}function wBt(r){var t=500,e=[],i=Math.max(Math.floor(r.length/t),1);return R(r,function(n,a){a%i===0?e.push(n):n.set("visible",!1)}),e}function RBt(r,t,e){var i;if(e.length!==0){var n=(i=e[0])===null||i===void 0?void 0:i.get("element"),a=n==null?void 0:n.geometry;if(!(!a||a.type!=="interval")){var o=wBt(t),s=lt(a.getXYFields(),1),l=s[0],u=[],c=[],h=cn(o,function(g){return g.get("data")[l]}),f=Gl(Ne(o,function(g){return g.get("data")[l]})),d;o.forEach(function(g){g.set("visible",!0)});var v=function(g){g&&(g.length&&c.push(g.pop()),c.push.apply(c,_t([],lt(g),!1)))};for(Tr(f)>0&&(d=f.shift(),v(h[d])),Tr(f)>0&&(d=f.pop(),v(h[d])),R(f.reverse(),function(g){v(h[g])});c.length>0;){var p=c.shift();p.get("visible")&&(TPt(p,u)?p.set("visible",!1):u.push(p))}}}}function MBt(r,t){var e=r.getXYFields()[1],i=[],n=t.sort(function(a,o){return a.get("data")[e]-a.get("data")[e]});return n.length>0&&i.push(n.shift()),n.length>0&&i.push(n.pop()),i.push.apply(i,_t([],lt(n),!1)),i}function iU(r,t,e){return r.some(function(i){return e(i,t)})}function IBt(r,t,e){e===void 0&&(e=0);var i=Math.max(0,Math.min(r.x+r.width+e,t.x+t.width+e)-Math.max(r.x-e,t.x-e)),n=Math.max(0,Math.min(r.y+r.height+e,t.y+t.height+e)-Math.max(r.y-e,t.y-e));return i*n}function RO(r,t){return iU(r,t,function(e,i){var n=ks(e),a=ks(i);return IBt(n.getCanvasBBox(),a.getCanvasBBox(),2)>0})}function LBt(r,t,e,i,n){var a,o;if(e.length!==0){var s=(a=e[0])===null||a===void 0?void 0:a.get("element"),l=s==null?void 0:s.geometry;if(!(!l||l.type!=="point")){var u=lt(l.getXYFields(),2),c=u[0],h=u[1],f=cn(t,function(p){return p.get("data")[c]}),d=[],v=n&&n.offset||((o=r[0])===null||o===void 0?void 0:o.offset)||12;Ne(Kc(f).reverse(),function(p){for(var g=MBt(l,f[p]);g.length;){var m=g.shift(),y=ks(m);if(iU(d,m,function(C,A){return C.get("data")[c]===A.get("data")[c]&&C.get("data")[h]===A.get("data")[h]})){y.set("visible",!1);continue}var _=RO(d,m),x=!1;if(_&&(y.attr("y",y.attr("y")+2*v),x=RO(d,m)),x){y.set("visible",!1);continue}d.push(m)}})}}}function OBt(r,t){var e=r.getXYFields()[1],i=[],n=t.sort(function(a,o){return a.get("data")[e]-a.get("data")[e]});return n.length>0&&i.push(n.shift()),n.length>0&&i.push(n.pop()),i.push.apply(i,_t([],lt(n),!1)),i}function nU(r,t,e){return r.some(function(i){return e(i,t)})}function PBt(r,t,e){e===void 0&&(e=0);var i=Math.max(0,Math.min(r.x+r.width+e,t.x+t.width+e)-Math.max(r.x-e,t.x-e)),n=Math.max(0,Math.min(r.y+r.height+e,t.y+t.height+e)-Math.max(r.y-e,t.y-e));return i*n}function MO(r,t){return nU(r,t,function(e,i){var n=ks(e),a=ks(i);return PBt(n.getCanvasBBox(),a.getCanvasBBox(),2)>0})}function FBt(r,t,e,i,n){var a,o;if(e.length!==0){var s=(a=e[0])===null||a===void 0?void 0:a.get("element"),l=s==null?void 0:s.geometry;if(!(!l||["path","line","area"].indexOf(l.type)<0)){var u=lt(l.getXYFields(),2),c=u[0],h=u[1],f=cn(t,function(p){return p.get("data")[c]}),d=[],v=n&&n.offset||((o=r[0])===null||o===void 0?void 0:o.offset)||12;Ne(Kc(f).reverse(),function(p){for(var g=OBt(l,f[p]);g.length;){var m=g.shift(),y=ks(m);if(nU(d,m,function(C,A){return C.get("data")[c]===A.get("data")[c]&&C.get("data")[h]===A.get("data")[h]})){y.set("visible",!1);continue}var _=MO(d,m),x=!1;if(_&&(y.attr("y",y.attr("y")+2*v),x=MO(d,m)),x){y.set("visible",!1);continue}d.push(m)}})}}}var Y_;function BBt(){return Y_||(Y_=document.createElement("canvas").getContext("2d")),Y_}var Ip=Qc(function(r,t){t===void 0&&(t={});var e=t.fontSize,i=t.fontFamily,n=t.fontWeight,a=t.fontStyle,o=t.fontVariant,s=BBt();return s.font=[a,o,n,"".concat(e,"px"),i].join(" "),s.measureText(mt(r)?r:"").width},function(r,t){return t===void 0&&(t={}),_t([r],lt(K0(t)),!1).join("")}),DBt=function(r,t,e){var i=16,n=Ip("...",e),a;mt(r)?a=r:a=Vd(r);var o=t,s=[],l,u;if(Ip(r,e)<=t)return r;for(;l=a.substr(0,i),u=Ip(l,e),!(u+n>o&&u>o);)if(s.push(l),o-=u,a=a.substr(i),!a)return s.join("");for(;l=a.substr(0,1),u=Ip(l,e),!(u+n>o);)if(s.push(l),o-=u,a=a.substr(1),!a)return s.join("");return"".concat(s.join(""),"...")};function NBt(r,t,e,i,n){if(!(t.length<=0)){var a=(n==null?void 0:n.direction)||["top","right","bottom","left"],o=(n==null?void 0:n.action)||"translate",s=(n==null?void 0:n.margin)||0,l=t[0].get("coordinate");if(l){var u=nOt(l,s),c=u.minX,h=u.minY,f=u.maxX,d=u.maxY;R(t,function(v){var p=v.getCanvasBBox(),g=p.minX,m=p.minY,y=p.maxX,_=p.maxY,x=p.x,C=p.y,A=p.width,T=p.height,w=x,M=C;if(a.indexOf("left")>=0&&(g<c||y<c)&&(w=c),a.indexOf("top")>=0&&(m<h||_<h)&&(M=h),a.indexOf("right")>=0&&(g>f?w=f-A:y>f&&(w=w-(y-f))),a.indexOf("bottom")>=0&&(m>d?M=d-T:_>d&&(M=M-(_-d))),w!==x||M!==C){var O=w-x;if(o==="translate")pv(v,O,M-C);else if(o==="ellipsis"){var P=v.findAll(function(D){return D.get("type")==="text"});P.forEach(function(D){var z=Ga(D.attr(),["fontSize","fontFamily","fontWeight","fontStyle","fontVariant"]),Y=D.getCanvasBBox(),H=DBt(D.attr("text"),Y.width-Math.abs(O),z);D.attr("text",H)})}else v.hide()}})}}}function kBt(r,t,e){var i={fillOpacity:j(r.attr("fillOpacity"))?1:r.attr("fillOpacity"),strokeOpacity:j(r.attr("strokeOpacity"))?1:r.attr("strokeOpacity"),opacity:j(r.attr("opacity"))?1:r.attr("opacity")};r.attr({fillOpacity:0,strokeOpacity:0,opacity:0}),r.animate(i,t)}function UBt(r,t,e){var i={fillOpacity:0,strokeOpacity:0,opacity:0},n=t.easing,a=t.duration,o=t.delay;r.animate(i,a,n,function(){r.remove(!0)},o)}function zBt(r,t,e){var i,n=lt(t,2),a=n[0],o=n[1];return r.applyToMatrix([a,o,1]),e==="x"?(r.setMatrix(hr(r.getMatrix(),[["t",-a,-o],["s",.01,1],["t",a,o]])),i=hr(r.getMatrix(),[["t",-a,-o],["s",100,1],["t",a,o]])):e==="y"?(r.setMatrix(hr(r.getMatrix(),[["t",-a,-o],["s",1,.01],["t",a,o]])),i=hr(r.getMatrix(),[["t",-a,-o],["s",1,100],["t",a,o]])):e==="xy"&&(r.setMatrix(hr(r.getMatrix(),[["t",-a,-o],["s",.01,.01],["t",a,o]])),i=hr(r.getMatrix(),[["t",-a,-o],["s",100,100],["t",a,o]])),i}function RT(r,t,e,i,n){var a=e.start,o=e.end,s=e.getWidth(),l=e.getHeight(),u,c;n==="y"?(u=a.x+s/2,c=i.y<a.y?i.y:a.y):n==="x"?(u=i.x>a.x?i.x:a.x,c=a.y+l/2):n==="xy"&&(e.isPolar?(u=e.getCenter().x,c=e.getCenter().y):(u=(a.x+o.x)/2,c=(a.y+o.y)/2));var h=zBt(r,[u,c],n);r.animate({matrix:h},t)}function HBt(r,t,e){var i=e.coordinate,n=e.minYPoint;RT(r,t,i,n,"x")}function $Bt(r,t,e){var i=e.coordinate,n=e.minYPoint;RT(r,t,i,n,"y")}function WBt(r,t,e){var i=e.coordinate,n=e.minYPoint;RT(r,t,i,n,"xy")}function VBt(r,t,e){var i=r.getTotalLength();r.attr("lineDash",[i]),r.animate(function(n){return{lineDashOffset:(1-n)*i}},t)}function GBt(r,t,e){var i=e.toAttrs,n=i.x,a=i.y;delete i.x,delete i.y,r.attr(i),r.animate({x:n,y:a},t)}function XBt(r,t,e){var i=r.getBBox(),n=r.get("origin").mappingData,a=n.points,o=a[0].y-a[1].y>0?i.maxX:i.minX,s=(i.minY+i.maxY)/2;r.applyToMatrix([o,s,1]);var l=hr(r.getMatrix(),[["t",-o,-s],["s",.01,1],["t",o,s]]);r.setMatrix(l),r.animate({matrix:hr(r.getMatrix(),[["t",-o,-s],["s",100,1],["t",o,s]])},t)}function YBt(r,t,e){var i=r.getBBox(),n=r.get("origin").mappingData,a=(i.minX+i.maxX)/2,o=n.points,s=o[0].y-o[1].y<=0?i.maxY:i.minY;r.applyToMatrix([a,s,1]);var l=hr(r.getMatrix(),[["t",-a,-s],["s",1,.01],["t",a,s]]);r.setMatrix(l),r.animate({matrix:hr(r.getMatrix(),[["t",-a,-s],["s",1,100],["t",a,s]])},t)}function IO(r,t){var e,i=Hg(r,t),n=i.startAngle,a=i.endAngle;return!Br(n,-Math.PI*.5)&&n<-Math.PI*.5&&(n+=Math.PI*2),!Br(a,-Math.PI*.5)&&a<-Math.PI*.5&&(a+=Math.PI*2),t[5]===0&&(e=lt([a,n],2),n=e[0],a=e[1]),Br(n,Math.PI*1.5)&&(n=Math.PI*-.5),Br(a,Math.PI*-.5)&&!Br(n,a)&&(a=Math.PI*1.5),{startAngle:n,endAngle:a}}function LO(r){var t;return r[0]==="M"||r[0]==="L"?t=[r[1],r[2]]:(r[0]==="a"||r[0]==="A"||r[0]==="C")&&(t=[r[r.length-2],r[r.length-1]]),t}function OO(r){var t,e,i,n=r.filter(function(_){return _[0]==="A"||_[0]==="a"});if(n.length===0)return{startAngle:0,endAngle:0,radius:0,innerRadius:0};var a=n[0],o=n.length>1?n[1]:n[0],s=r.indexOf(a),l=r.indexOf(o),u=LO(r[s-1]),c=LO(r[l-1]),h=IO(u,a),f=h.startAngle,d=h.endAngle,v=IO(c,o),p=v.startAngle,g=v.endAngle;Br(f,p)&&Br(d,g)?(e=f,i=d):(e=Math.min(f,p),i=Math.max(d,g));var m=a[1],y=n[n.length-1][1];return m<y?(t=lt([y,m],2),m=t[0],y=t[1]):m===y&&(y=0),{startAngle:e,endAngle:i,radius:m,innerRadius:y}}function jBt(r,t,e){var i=e.toAttrs,n=e.coordinate,a=i.path||[],o=a.map(function(y){return y[0]});if(!(a.length<1)){var s=OO(a),l=s.startAngle,u=s.endAngle,c=s.radius,h=s.innerRadius,f=OO(r.attr("path")),d=f.startAngle,v=f.endAngle,p=n.getCenter(),g=l-d,m=u-v;if(g===0&&m===0){r.attr(i);return}r.animate(function(y){var _=d+y*g,x=v+y*m;return S(S({},i),{path:Jt(o,["M","A","A","Z"])?J8(p.x,p.y,c,_,x):bs(p.x,p.y,c,_,x,h)})},S(S({},t),{callback:function(){r.attr("path",a),ut(t.callback)&&t.callback()}}))}}function ZBt(r,t,e){var i=hT(e.coordinate,20),n=i.type,a=i.startState,o=i.endState,s=r.setClip({type:n,attrs:a});e.toAttrs&&r.attr(e.toAttrs),s.animate(o,S(S({},t),{callback:function(){r&&!r.get("destroyed")&&r.set("clipShape",null),s.remove(!0),ut(t.callback)&&t.callback()}}))}function MT(r,t,e){if(r.isGroup())R(r.getChildren(),function(s){MT(s,t,e)});else{var i=r.getBBox(),n=(i.minX+i.maxX)/2,a=(i.minY+i.maxY)/2;if(r.applyToMatrix([n,a,1]),e==="zoomIn"){var o=hr(r.getMatrix(),[["t",-n,-a],["s",.01,.01],["t",n,a]]);r.setMatrix(o),r.animate({matrix:hr(r.getMatrix(),[["t",-n,-a],["s",100,100],["t",n,a]])},t)}else r.animate({matrix:hr(r.getMatrix(),[["t",-n,-a],["s",.01,.01],["t",n,a]])},S(S({},t),{callback:function(){r.remove(!0),ut(t.callback)&&t.callback()}}))}}function qBt(r,t,e){MT(r,t,"zoomIn")}function KBt(r,t,e){MT(r,t,"zoomOut")}function Ho(r){return[it.TOP,it.BOTTOM].includes(r)?{offsetX:0,offsetY:r===it.TOP?-8:8,style:{textAlign:"center",textBaseline:r===it.TOP?"bottom":"top"}}:[it.LEFT,it.RIGHT].includes(r)?{offsetX:r===it.LEFT?-8:8,offsetY:0,style:{textAlign:r===it.LEFT?"right":"left",textBaseline:"middle",rotate:Math.PI/2}}:{}}function j_(r,t,e){return{x:r.x+t*Math.cos(e),y:r.y+t*Math.sin(e)}}var QBt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){return nt({},r.prototype.getDefaultCfg.call(this),{type:"circle",showTitle:!0,title:r.prototype.getDefaultTitleCfg.call(this)})},t.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.getRegion=function(e,i){var n=.5,a={x:.5,y:.5},o=Math.PI*2/e,s=-1*Math.PI/2+o*i,l=n/(1+1/Math.sin(o/2)),u=j_(a,n-l,s),c=Math.PI*5/4,h=Math.PI*1/4;return{start:j_(u,l,c),end:j_(u,l,h)}},t.prototype.afterEachView=function(e,i){this.processAxis(e,i)},t.prototype.beforeEachView=function(e,i){},t.prototype.generateFacets=function(e){var i=this,n=this.cfg,a=n.fields,o=n.type,s=lt(a,1),l=s[0];if(!l)throw new Error("No `fields` specified!");var u=this.getFieldValues(e,l),c=u.length,h=[];return u.forEach(function(f,d){var v=[{field:l,value:f,values:u}],p=Ur(e,i.getFacetDataFilter(v)),g={type:o,data:p,region:i.getRegion(c,d),columnValue:f,columnField:l,columnIndex:d,columnValuesLength:c,rowValue:null,rowField:null,rowIndex:0,rowValuesLength:1};h.push(g)}),h},t.prototype.getXAxisOption=function(e,i,n,a){return n},t.prototype.getYAxisOption=function(e,i,n,a){return n},t.prototype.renderTitle=function(){var e=this;R(this.facets,function(i){var n=i.columnValue,a=i.view,o=L(e.cfg.title,"formatter"),s=nt({position:["50%","0%"],content:o?o(n):n},Ho(it.TOP),e.cfg.title);a.annotation().text(s)})},t}(dh),JBt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){return nt({},r.prototype.getDefaultCfg.call(this),{type:"list",cols:null,showTitle:!0,title:r.prototype.getDefaultTitleCfg.call(this)})},t.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.afterEachView=function(e,i){this.processAxis(e,i)},t.prototype.beforeEachView=function(e,i){},t.prototype.generateFacets=function(e){var i=this,n=this.cfg.fields,a=this.cfg.cols,o=lt(n,1),s=o[0];if(!s)throw new Error("No `fields` specified!");var l=this.getFieldValues(e,s),u=l.length;a=a||u;var c=this.getPageCount(u,a),h=[];return l.forEach(function(f,d){var v=i.getRowCol(d,a),p=v.row,g=v.col,m=[{field:s,value:f,values:l}],y=Ur(e,i.getFacetDataFilter(m)),_={type:i.cfg.type,data:y,region:i.getRegion(c,a,g,p),columnValue:f,rowValue:f,columnField:s,rowField:null,columnIndex:g,rowIndex:p,columnValuesLength:a,rowValuesLength:c,total:u};h.push(_)}),h},t.prototype.getXAxisOption=function(e,i,n,a){return a.rowIndex!==a.rowValuesLength-1&&a.columnValuesLength*a.rowIndex+a.columnIndex+1+a.columnValuesLength<=a.total?S(S({},n),{label:null,title:null}):n},t.prototype.getYAxisOption=function(e,i,n,a){return a.columnIndex!==0?S(S({},n),{title:null,label:null}):n},t.prototype.renderTitle=function(){var e=this;R(this.facets,function(i){var n=i.columnValue,a=i.view,o=L(e.cfg.title,"formatter"),s=nt({position:["50%","0%"],content:o?o(n):n},Ho(it.TOP),e.cfg.title);a.annotation().text(s)})},t.prototype.getPageCount=function(e,i){return Math.floor((e+i-1)/i)},t.prototype.getRowCol=function(e,i){var n=Math.floor(e/i),a=e%i;return{row:n,col:a}},t}(dh),tDt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){return nt({},r.prototype.getDefaultCfg.call(this),{type:"matrix",showTitle:!1,columnTitle:S({},r.prototype.getDefaultTitleCfg.call(this)),rowTitle:S({},r.prototype.getDefaultTitleCfg.call(this))})},t.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.afterEachView=function(e,i){this.processAxis(e,i)},t.prototype.beforeEachView=function(e,i){},t.prototype.generateFacets=function(e){for(var i=this.cfg,n=i.fields,a=i.type,o=n.length,s=o,l=[],u=0;u<s;u++)for(var c=n[u],h=0;h<o;h++){var f=n[h],d={type:a,data:e,region:this.getRegion(o,s,u,h),columnValue:c,rowValue:f,columnField:c,rowField:f,columnIndex:u,rowIndex:h,columnValuesLength:s,rowValuesLength:o};l.push(d)}return l},t.prototype.getXAxisOption=function(e,i,n,a){return a.rowIndex!==a.rowValuesLength-1?S(S({},n),{label:null,title:null}):n},t.prototype.getYAxisOption=function(e,i,n,a){return a.columnIndex!==0?S(S({},n),{title:null,label:null}):n},t.prototype.renderTitle=function(){var e=this;R(this.facets,function(i,n){var a=i.columnIndex,o=i.rowIndex,s=i.columnValuesLength;i.rowValuesLength;var l=i.columnValue,u=i.rowValue,c=i.view;if(o===0){var h=L(e.cfg.columnTitle,"formatter"),f=nt({position:["50%","0%"],content:h?h(l):l},Ho(it.TOP),e.cfg.columnTitle);c.annotation().text(f)}if(a===s-1){var h=L(e.cfg.rowTitle,"formatter"),f=nt({position:["100%","50%"],content:h?h(u):u},Ho(it.RIGHT),e.cfg.rowTitle);c.annotation().text(f)}})},t}(dh),eDt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){return nt({},r.prototype.getDefaultCfg.call(this),{type:"mirror",showTitle:!0,title:r.prototype.getDefaultTitleCfg.call(this),transpose:!1})},t.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.beforeEachView=function(e,i){this.cfg.transpose?i.columnIndex%2===0?e.coordinate().transpose().reflect("x"):e.coordinate().transpose():i.rowIndex%2!==0&&e.coordinate().reflect("y")},t.prototype.afterEachView=function(e,i){this.processAxis(e,i)},t.prototype.generateFacets=function(e){var i=this,n=lt(this.cfg.fields,1),a=n[0],o=[],s=1,l=1,u=[""],c=[""],h,f;return this.cfg.transpose?(h=a,u=this.getFieldValues(e,h).slice(0,2),s=u.length):(f=a,c=this.getFieldValues(e,f).slice(0,2),l=c.length),u.forEach(function(d,v){c.forEach(function(p,g){var m=[{field:h,value:d,values:u},{field:f,value:p,values:c}],y=Ur(e,i.getFacetDataFilter(m)),_={type:i.cfg.type,data:y,region:i.getRegion(l,s,v,g),columnValue:d,rowValue:p,columnField:h,rowField:f,columnIndex:v,rowIndex:g,columnValuesLength:s,rowValuesLength:l};o.push(_)})}),o},t.prototype.getXAxisOption=function(e,i,n,a){return a.columnIndex===1||a.rowIndex===1?S(S({},n),{label:null,title:null}):n},t.prototype.getYAxisOption=function(e,i,n,a){return n},t.prototype.renderTitle=function(){var e=this;R(this.facets,function(i,n){var a=i.columnValue,o=i.rowValue,s=i.view,l=L(e.cfg.title,"formatter");if(e.cfg.transpose){var u=nt({position:["50%","0%"],content:l?l(a):a},Ho(it.TOP),e.cfg.title);s.annotation().text(u)}else{var u=nt({position:["100%","50%"],content:l?l(o):o},Ho(it.RIGHT),e.cfg.title);s.annotation().text(u)}})},t}(dh),rDt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.afterEachView=function(e,i){this.processAxis(e,i)},t.prototype.beforeEachView=function(e,i){},t.prototype.getDefaultCfg=function(){return nt({},r.prototype.getDefaultCfg.call(this),{type:"rect",columnTitle:S({},r.prototype.getDefaultTitleCfg.call(this)),rowTitle:S({},r.prototype.getDefaultTitleCfg.call(this))})},t.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.generateFacets=function(e){var i=this,n=lt(this.cfg.fields,2),a=n[0],o=n[1],s=[],l=1,u=1,c=[""],h=[""];return a&&(c=this.getFieldValues(e,a),l=c.length),o&&(h=this.getFieldValues(e,o),u=h.length),c.forEach(function(f,d){h.forEach(function(v,p){var g=[{field:a,value:f,values:c},{field:o,value:v,values:h}],m=Ur(e,i.getFacetDataFilter(g)),y={type:i.cfg.type,data:m,region:i.getRegion(u,l,d,p),columnValue:f,rowValue:v,columnField:a,rowField:o,columnIndex:d,rowIndex:p,columnValuesLength:l,rowValuesLength:u};s.push(y)})}),s},t.prototype.renderTitle=function(){var e=this;R(this.facets,function(i,n){var a=i.columnIndex,o=i.rowIndex,s=i.columnValuesLength,l=i.columnValue,u=i.rowValue,c=i.view;if(o===0){var h=L(e.cfg.columnTitle,"formatter"),f=nt({position:["50%","0%"],content:h?h(l):l},Ho(it.TOP),e.cfg.columnTitle);c.annotation().text(f)}if(a===s-1){var h=L(e.cfg.rowTitle,"formatter"),f=nt({position:["100%","50%"],content:h?h(u):u},Ho(it.RIGHT),e.cfg.rowTitle);c.annotation().text(f)}})},t.prototype.getXAxisOption=function(e,i,n,a){return a.rowIndex!==a.rowValuesLength-1?S(S({},n),{title:null,label:null}):a.columnIndex!==Math.floor((a.columnValuesLength-1)/2)?S(S({},n),{title:null}):n},t.prototype.getYAxisOption=function(e,i,n,a){return a.columnIndex!==0?S(S({},n),{title:null,label:null}):a.rowIndex!==Math.floor((a.rowValuesLength-1)/2)?S(S({},n),{title:null}):n},t}(dh),iDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.afterChartRender=function(){e.facets&&e.cfg.line&&(e.container.clear(),e.drawLines(e.facets))},e}return t.prototype.afterEachView=function(e,i){this.processAxis(e,i)},t.prototype.beforeEachView=function(e,i){},t.prototype.init=function(){r.prototype.init.call(this),this.view.on(kt.AFTER_RENDER,this.afterChartRender)},t.prototype.getDefaultCfg=function(){return nt({},r.prototype.getDefaultCfg.call(this),{type:"tree",line:{style:{lineWidth:1,stroke:"#ddd"},smooth:!1},showTitle:!0,title:r.prototype.getDefaultTitleCfg.call(this)})},t.prototype.generateFacets=function(e){var i=this.cfg.fields;if(!i.length)throw new Error("Please specify for the fields for rootFacet!");var n=[],a={type:this.cfg.type,data:e,region:null,rowValuesLength:this.getRows(),columnValuesLength:1,rowIndex:0,columnIndex:0,rowField:"",columnField:"",rowValue:"",columnValue:""};return n.push(a),a.children=this.getChildFacets(e,1,n),this.setRegion(n),n},t.prototype.setRegion=function(e){var i=this;this.forceColIndex(e),e.forEach(function(n){n.region=i.getRegion(n.rowValuesLength,n.columnValuesLength,n.columnIndex,n.rowIndex)})},t.prototype.getRegion=function(e,i,n,a){var o=1/i,s=1/e,l={x:o*n,y:s*a},u={x:l.x+o,y:l.y+s*2/3};return{start:l,end:u}},t.prototype.forceColIndex=function(e){var i,n,a=this,o=[],s=0;e.forEach(function(v){a.isLeaf(v)&&(o.push(v),v.columnIndex=s,s++)}),o.forEach(function(v){v.columnValuesLength=o.length});for(var l=this.cfg.fields.length,u=l-1;u>=0;u--){var c=this.getFacetsByLevel(e,u);try{for(var h=(i=void 0,qt(c)),f=h.next();!f.done;f=h.next()){var d=f.value;this.isLeaf(d)||(d.originColIndex=d.columnIndex,d.columnIndex=this.getRegionIndex(d.children),d.columnValuesLength=o.length)}}catch(v){i={error:v}}finally{try{f&&!f.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}}},t.prototype.getFacetsByLevel=function(e,i){var n=[];return e.forEach(function(a){a.rowIndex===i&&n.push(a)}),n},t.prototype.getRegionIndex=function(e){var i=e[0],n=e[e.length-1];return(n.columnIndex-i.columnIndex)/2+i.columnIndex},t.prototype.isLeaf=function(e){return!e.children||!e.children.length},t.prototype.getRows=function(){return this.cfg.fields.length+1},t.prototype.getChildFacets=function(e,i,n){var a=this,o=this.cfg.fields,s=o.length;if(!(s<i)){var l=[],u=o[i-1],c=this.getFieldValues(e,u);return c.forEach(function(h,f){var d=[{field:u,value:h,values:c}],v=e.filter(a.getFacetDataFilter(d));if(v.length){var p={type:a.cfg.type,data:v,region:null,columnValue:h,rowValue:"",columnField:u,rowField:"",columnIndex:f,rowValuesLength:a.getRows(),columnValuesLength:1,rowIndex:i,children:a.getChildFacets(v,i+1,n)};l.push(p),n.push(p)}}),l}},t.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.renderTitle=function(){var e=this;R(this.facets,function(i){var n=i.columnValue,a=i.view,o=L(e.cfg.title,"formatter"),s=nt({position:["50%","0%"],content:o?o(n):n},Ho(it.TOP),e.cfg.title);a.annotation().text(s)})},t.prototype.drawLines=function(e){var i=this;e.forEach(function(n){if(!i.isLeaf(n)){var a=n.children;i.addFacetLines(n,a)}})},t.prototype.addFacetLines=function(e,i){var n=this,a=e.view,o=a.coordinateBBox,s={x:o.x+o.width/2,y:o.y+o.height};i.forEach(function(l){var u=l.view.coordinateBBox,c={x:u.bl.x+(u.tr.x-u.bl.x)/2,y:u.tr.y},h={x:s.x,y:s.y+(c.y-s.y)/2},f={x:c.x,y:h.y};n.drawLine([s,h,f,c])})},t.prototype.getPath=function(e){var i=[],n=this.cfg.line.smooth;return n?(i.push(["M",e[0].x,e[0].y]),i.push(["C",e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y])):e.forEach(function(a,o){o===0?i.push(["M",a.x,a.y]):i.push(["L",a.x,a.y])}),i},t.prototype.drawLine=function(e){var i=this.getPath(e),n=this.cfg.line.style;this.container.addShape("path",{attrs:ye({path:i},n)})},t.prototype.getXAxisOption=function(e,i,n,a){return a.rowIndex!==a.rowValuesLength-1?S(S({},n),{title:null,label:null}):n},t.prototype.getYAxisOption=function(e,i,n,a){return a.originColIndex!==0&&a.columnIndex!==0?S(S({},n),{title:null,label:null}):n},t}(dh);function PO(r){var t=_t([],lt(r),!1);t.sort(function(i,n){return i-n});var e=t.length;return e===0?0:e%2===1?t[(e-1)/2]:(t[e/2]+t[e/2-1])/2}function nDt(r){var t=oi(r,function(e,i){return e+=isNaN(i)||!Mt(i)?0:i},0);return r.length===0?0:t/r.length}function Lp(r,t){if(!t)return null;var e;switch(r){case"start":return 0;case"center":return .5;case"end":return 1;case"median":{e=t.isCategory?PO(t.values.map(function(i,n){return n})):PO(t.values);break}case"mean":{e=t.isCategory?(t.values.length-1)/2:nDt(t.values);break}case"min":e=t.isCategory?0:t[r];break;case"max":e=t.isCategory?t.values.length-1:t[r];break;default:e=r;break}return t.scale(e)}var Op=["regionFilter","shape"],aDt=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.cache=new Map,i.foregroundContainer=i.view.getLayer(rr.FORE).addGroup(),i.backgroundContainer=i.view.getLayer(rr.BG).addGroup(),i.option=[],i}return Object.defineProperty(t.prototype,"name",{get:function(){return"annotation"},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.layout=function(){this.update()},t.prototype.render=function(){},t.prototype.update=function(){var e=this;this.onAfterRender(function(){var n=new Map;R(e.option,function(a){if(gl(Op,a.type)){var o=e.updateOrCreate(a);o&&n.set(e.getCacheKey(a),o)}}),e.cache=e.syncCache(n)});var i=new Map;R(this.option,function(n){if(!gl(Op,n.type)){var a=e.updateOrCreate(n);a&&i.set(e.getCacheKey(n),a)}}),this.cache=this.syncCache(i)},t.prototype.clear=function(e){e===void 0&&(e=!1),r.prototype.clear.call(this),this.clearComponents(),this.foregroundContainer.clear(),this.backgroundContainer.clear(),e&&(this.option=[])},t.prototype.destroy=function(){this.clear(!0),this.foregroundContainer.remove(!0),this.backgroundContainer.remove(!0)},t.prototype.getComponents=function(){var e=[];return this.cache.forEach(function(i){e.push(i)}),e},t.prototype.clearComponents=function(){this.getComponents().forEach(function(e){e.component.destroy()}),this.cache.clear()},t.prototype.onAfterRender=function(e){var i=!1;this.view.getOptions().animate&&this.view.geometries.forEach(function(n){n.animateOption&&(n.once(As.AFTER_DRAW_ANIMATE,function(){e()}),i=!0)}),i||this.view.getRootView().once(kt.AFTER_RENDER,function(){e()})},t.prototype.createAnnotation=function(e){var i=e.type,n=jIt[fu(i)];if(n){var a=this.getAnnotationTheme(i),o=this.getAnnotationCfg(i,e,a);if(!o)return null;var s=new n(o);return{component:s,layer:this.isTop(o)?rr.FORE:rr.BG,direction:it.NONE,type:Er.ANNOTATION,extra:e}}},t.prototype.annotation=function(e){this.option.push(e)},t.prototype.arc=function(e){return this.annotation(S({type:"arc"},e)),this},t.prototype.image=function(e){return this.annotation(S({type:"image"},e)),this},t.prototype.line=function(e){return this.annotation(S({type:"line"},e)),this},t.prototype.region=function(e){return this.annotation(S({type:"region"},e)),this},t.prototype.text=function(e){return this.annotation(S({type:"text"},e)),this},t.prototype.dataMarker=function(e){return this.annotation(S({type:"dataMarker"},e)),this},t.prototype.dataRegion=function(e){this.annotation(S({type:"dataRegion"},e))},t.prototype.regionFilter=function(e){this.annotation(S({type:"regionFilter"},e))},t.prototype.shape=function(e){this.annotation(S({type:"shape"},e))},t.prototype.html=function(e){this.annotation(S({type:"html"},e))},t.prototype.parsePosition=function(e){var i,n,a=this.view.getXScale(),o=this.view.getScalesByDim("y"),s=ut(e)?e.call(null,a,o):e,l=0,u=0;if(Z(s)){var c=lt(s,2),h=c[0],f=c[1];if(mt(h)&&h.indexOf("%")!==-1&&!isNaN(h.slice(0,-1)))return this.parsePercentPosition(s);l=Lp(h,a),u=Lp(f,Object.values(o)[0])}else if(!j(s))try{for(var d=qt(Kc(s)),v=d.next();!v.done;v=d.next()){var p=v.value,g=s[p];p===a.field&&(l=Lp(g,a)),o[p]&&(u=Lp(g,o[p]))}}catch(m){i={error:m}}finally{try{v&&!v.done&&(n=d.return)&&n.call(d)}finally{if(i)throw i.error}}return isNaN(l)||isNaN(u)?null:this.view.getCoordinate().convert({x:l,y:u})},t.prototype.getRegionPoints=function(e,i){var n=this,a=this.view.getXScale(),o=this.view.getScalesByDim("y"),s=Object.values(o)[0],l=a.field,u=this.view.getData(),c=Z(e)?e[0]:e[l],h=Z(i)?i[0]:i[l],f=[],d;return R(u,function(v,p){if(v[l]===c&&(d=p),p>=d){var g=n.parsePosition([v[l],v[s.field]]);g&&f.push(g)}if(v[l]===h)return!1}),f},t.prototype.parsePercentPosition=function(e){var i=parseFloat(e[0])/100,n=parseFloat(e[1])/100,a=this.view.getCoordinate(),o=a.start,s=a.end,l={x:Math.min(o.x,s.x),y:Math.min(o.y,s.y)},u=a.getWidth()*i+l.x,c=a.getHeight()*n+l.y;return{x:u,y:c}},t.prototype.getCoordinateBBox=function(){var e=this.view.getCoordinate(),i=e.start,n=e.end,a=e.getWidth(),o=e.getHeight(),s={x:Math.min(i.x,n.x),y:Math.min(i.y,n.y)};return{x:s.x,y:s.y,minX:s.x,minY:s.y,maxX:s.x+a,maxY:s.y+o,width:a,height:o}},t.prototype.getAnnotationCfg=function(e,i,n){var a=this,o=this.view.getCoordinate(),s=this.view.getCanvas(),l={};if(j(i))return null;var u=i.start,c=i.end,h=i.position,f=this.parsePosition(u),d=this.parsePosition(c),v=this.parsePosition(h);if(["arc","image","line","region","regionFilter"].includes(e)&&(!f||!d))return null;if(["text","dataMarker","html"].includes(e)&&!v)return null;if(e==="arc"){var p=i;p.start,p.end;var g=Ut(p,["start","end"]),m=$c(o,f),y=$c(o,d);m>y&&(y=Math.PI*2+y),l=S(S({},g),{center:o.getCenter(),radius:fy(o,f),startAngle:m,endAngle:y})}else if(e==="image"){var _=i;_.start,_.end;var g=Ut(_,["start","end"]);l=S(S({},g),{start:f,end:d,src:i.src})}else if(e==="line"){var x=i;x.start,x.end;var g=Ut(x,["start","end"]);l=S(S({},g),{start:f,end:d,text:L(i,"text",null)})}else if(e==="region"){var C=i;C.start,C.end;var g=Ut(C,["start","end"]);l=S(S({},g),{start:f,end:d})}else if(e==="text"){var A=this.view.getData(),T=i;T.position;var w=T.content,g=Ut(T,["position","content"]),M=w;ut(w)&&(M=w(A)),l=S(S(S({},v),g),{content:M})}else if(e==="dataMarker"){var O=i;O.position;var P=O.point,D=O.line,z=O.text,Y=O.autoAdjust,H=O.direction,g=Ut(O,["position","point","line","text","autoAdjust","direction"]);l=S(S(S({},g),v),{coordinateBBox:this.getCoordinateBBox(),point:P,line:D,text:z,autoAdjust:Y,direction:H})}else if(e==="dataRegion"){var N=i,W=N.start,Q=N.end,q=N.region,z=N.text,J=N.lineLength,g=Ut(N,["start","end","region","text","lineLength"]);l=S(S({},g),{points:this.getRegionPoints(W,Q),region:q,text:z,lineLength:J})}else if(e==="regionFilter"){var et=i;et.start,et.end;var ft=et.apply,Ct=et.color,g=Ut(et,["start","end","apply","color"]),ct=this.view.geometries,dt=[],Rt=function(La){La&&(La.isGroup()?La.getChildren().forEach(function(_h){return Rt(_h)}):dt.push(La))};R(ct,function(La){ft?gl(ft,La.type)&&R(La.elements,function(_h){Rt(_h.shape)}):R(La.elements,function(_h){Rt(_h.shape)})}),l=S(S({},g),{color:Ct,shapes:dt,start:f,end:d})}else if(e==="shape"){var le=i,me=le.render,We=Ut(le,["render"]),Ri=function(yz){if(ut(i.render))return me(yz,a.view,{parsePosition:a.parsePosition.bind(a)})};l=S(S({},We),{render:Ri})}else if(e==="html"){var tn=i,ea=tn.html;tn.position;var We=Ut(tn,["html","position"]),tl=function(La){return ut(ea)?ea(La,a.view):ea};l=S(S(S({},We),v),{parent:s.get("el").parentNode,html:tl})}var Qo=nt({},n,S(S({},l),{top:i.top,style:i.style,offsetX:i.offsetX,offsetY:i.offsetY}));return e!=="html"&&(Qo.container=this.getComponentContainer(Qo)),Qo.animate=this.view.getOptions().animate&&Qo.animate&&L(i,"animate",Qo.animate),Qo.animateOption=nt({},Vc,Qo.animateOption,i.animateOption),Qo},t.prototype.isTop=function(e){return L(e,"top",!0)},t.prototype.getComponentContainer=function(e){return this.isTop(e)?this.foregroundContainer:this.backgroundContainer},t.prototype.getAnnotationTheme=function(e){return L(this.view.getTheme(),["components","annotation",e],{})},t.prototype.updateOrCreate=function(e){var i=this.cache.get(this.getCacheKey(e));if(i){var n=e.type,a=this.getAnnotationTheme(n),o=this.getAnnotationCfg(n,e,a);o&&Di(o,["container"]),i.component.update(S(S({},o||{}),{visible:!!o})),gl(Op,e.type)&&i.component.render()}else i=this.createAnnotation(e),i&&(i.component.init(),gl(Op,e.type)&&i.component.render());return i},t.prototype.syncCache=function(e){var i=this,n=new Map(this.cache);return e.forEach(function(a,o){n.set(o,a)}),n.forEach(function(a,o){pa(i.option,function(s){return o===i.getCacheKey(s)})||(a.component.destroy(),n.delete(o))}),n},t.prototype.getCacheKey=function(e){return e},t}(ph);function FO(r,t){var e=nt({},L(r,["components","axis","common"]),L(r,["components","axis",t]));return L(e,["grid"],{})}function Pp(r,t,e,i){var n=[],a=t.getTicks();return r.isPolar&&a.push({value:1,text:"",tickValue:""}),a.reduce(function(o,s,l){var u=s.value;if(i)n.push({points:[r.convert(e==="y"?{x:0,y:u}:{x:u,y:0}),r.convert(e==="y"?{x:1,y:u}:{x:u,y:1})]});else if(l){var c=o.value,h=(c+u)/2;n.push({points:[r.convert(e==="y"?{x:0,y:h}:{x:h,y:0}),r.convert(e==="y"?{x:1,y:h}:{x:h,y:1})]})}return s},a[0]),n}function Z_(r,t,e,i,n){var a=t.values.length,o=[],s=e.getTicks();return s.reduce(function(l,u){var c=l?l.value:u.value,h=u.value,f=(c+h)/2;return n==="x"?o.push({points:[r.convert({x:i?h:f,y:0}),r.convert({x:i?h:f,y:1})]}):o.push({points:Ne(Array(a+1),function(d,v){return r.convert({x:v/a,y:i?h:f})})}),u},s[0]),o}function BO(r,t){var e=L(t,"grid");if(e===null)return!1;var i=L(r,"grid");return!(e===void 0&&i===null)}var as=["container"],DO=S(S({},Vc),{appear:null}),oDt=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.cache=new Map,i.gridContainer=i.view.getLayer(rr.BG).addGroup(),i.gridForeContainer=i.view.getLayer(rr.FORE).addGroup(),i.axisContainer=i.view.getLayer(rr.BG).addGroup(),i.axisForeContainer=i.view.getLayer(rr.FORE).addGroup(),i}return Object.defineProperty(t.prototype,"name",{get:function(){return"axis"},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.render=function(){this.update()},t.prototype.layout=function(){var e=this,i=this.view.getCoordinate();R(this.getComponents(),function(n){var a=n.component,o=n.direction,s=n.type,l=n.extra,u=l.dim,c=l.scale,h=l.alignTick,f;if(s===Er.AXIS)i.isPolar?u==="x"?f=i.isTransposed?Ap(i,o):H_(i):u==="y"&&(f=i.isTransposed?H_(i):Ap(i,o)):f=Ap(i,o);else if(s===Er.GRID)if(i.isPolar){var d=void 0;i.isTransposed?d=u==="x"?Z_(i,e.view.getYScales()[0],c,h,u):Pp(i,c,u,h):d=u==="x"?Pp(i,c,u,h):Z_(i,e.view.getXScale(),c,h,u),f={items:d,center:e.view.getCoordinate().getCenter()}}else f={items:Pp(i,c,u,h)};a.update(f)})},t.prototype.update=function(){this.option=this.view.getOptions().axes;var e=new Map;this.updateXAxes(e),this.updateYAxes(e);var i=new Map;this.cache.forEach(function(n,a){e.has(a)?i.set(a,n):n.component.destroy()}),this.cache=i},t.prototype.clear=function(){r.prototype.clear.call(this),this.cache.clear(),this.gridContainer.clear(),this.gridForeContainer.clear(),this.axisContainer.clear(),this.axisForeContainer.clear()},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.gridContainer.remove(!0),this.gridForeContainer.remove(!0),this.axisContainer.remove(!0),this.axisForeContainer.remove(!0)},t.prototype.getComponents=function(){var e=[];return this.cache.forEach(function(i){e.push(i)}),e},t.prototype.updateXAxes=function(e){var i=this.view.getXScale();if(!(!i||i.isIdentity)){var n=w0(this.option,i.field);if(n!==!1){var a=jL(n,it.BOTTOM),o=rr.BG,s="x",l=this.view.getCoordinate(),u=this.getId("axis",i.field),c=this.getId("grid",i.field);if(l.isRect){var h=this.cache.get(u);if(h){var f=this.getLineAxisCfg(i,n,a);Di(f,as),h.component.update(f),e.set(u,h)}else h=this.createLineAxis(i,n,o,a,s),this.cache.set(u,h),e.set(u,h);var d=this.cache.get(c);if(d){var f=this.getLineGridCfg(i,n,a,s);Di(f,as),d.component.update(f),e.set(c,d)}else d=this.createLineGrid(i,n,o,a,s),d&&(this.cache.set(c,d),e.set(c,d))}else if(l.isPolar){var h=this.cache.get(u);if(h){var f=l.isTransposed?this.getLineAxisCfg(i,n,it.RADIUS):this.getCircleAxisCfg(i,n,a);Di(f,as),h.component.update(f),e.set(u,h)}else{if(l.isTransposed){if(Wr(n))return;h=this.createLineAxis(i,n,o,it.RADIUS,s)}else h=this.createCircleAxis(i,n,o,a,s);this.cache.set(u,h),e.set(u,h)}var d=this.cache.get(c);if(d){var f=l.isTransposed?this.getCircleGridCfg(i,n,it.RADIUS,s):this.getLineGridCfg(i,n,it.CIRCLE,s);Di(f,as),d.component.update(f),e.set(c,d)}else{if(l.isTransposed){if(Wr(n))return;d=this.createCircleGrid(i,n,o,it.RADIUS,s)}else d=this.createLineGrid(i,n,o,it.CIRCLE,s);d&&(this.cache.set(c,d),e.set(c,d))}}}}},t.prototype.updateYAxes=function(e){var i=this,n=this.view.getYScales();R(n,function(a,o){if(!(!a||a.isIdentity)){var s=a.field,l=w0(i.option,s);if(l!==!1){var u=rr.BG,c="y",h=i.getId("axis",s),f=i.getId("grid",s),d=i.view.getCoordinate();if(d.isRect){var v=jL(l,o===0?it.LEFT:it.RIGHT),p=i.cache.get(h);if(p){var g=i.getLineAxisCfg(a,l,v);Di(g,as),p.component.update(g),e.set(h,p)}else p=i.createLineAxis(a,l,u,v,c),i.cache.set(h,p),e.set(h,p);var m=i.cache.get(f);if(m){var g=i.getLineGridCfg(a,l,v,c);Di(g,as),m.component.update(g),e.set(f,m)}else m=i.createLineGrid(a,l,u,v,c),m&&(i.cache.set(f,m),e.set(f,m))}else if(d.isPolar){var p=i.cache.get(h);if(p){var g=d.isTransposed?i.getCircleAxisCfg(a,l,it.CIRCLE):i.getLineAxisCfg(a,l,it.RADIUS);Di(g,as),p.component.update(g),e.set(h,p)}else{if(d.isTransposed){if(Wr(l))return;p=i.createCircleAxis(a,l,u,it.CIRCLE,c)}else p=i.createLineAxis(a,l,u,it.RADIUS,c);i.cache.set(h,p),e.set(h,p)}var m=i.cache.get(f);if(m){var g=d.isTransposed?i.getLineGridCfg(a,l,it.CIRCLE,c):i.getCircleGridCfg(a,l,it.RADIUS,c);Di(g,as),m.component.update(g),e.set(f,m)}else{if(d.isTransposed){if(Wr(l))return;m=i.createLineGrid(a,l,u,it.CIRCLE,c)}else m=i.createCircleGrid(a,l,u,it.RADIUS,c);m&&(i.cache.set(f,m),e.set(f,m))}}}}})},t.prototype.createLineAxis=function(e,i,n,a,o){var s={component:new YLt(this.getLineAxisCfg(e,i,a)),layer:n,direction:a===it.RADIUS?it.NONE:a,type:Er.AXIS,extra:{dim:o,scale:e}};return s.component.set("field",e.field),s.component.init(),s},t.prototype.createLineGrid=function(e,i,n,a,o){var s=this.getLineGridCfg(e,i,a,o);if(s){var l={component:new ZLt(s),layer:n,direction:it.NONE,type:Er.GRID,extra:{dim:o,scale:e,alignTick:L(s,"alignTick",!0)}};return l.component.init(),l}},t.prototype.createCircleAxis=function(e,i,n,a,o){var s={component:new jLt(this.getCircleAxisCfg(e,i,a)),layer:n,direction:a,type:Er.AXIS,extra:{dim:o,scale:e}};return s.component.set("field",e.field),s.component.init(),s},t.prototype.createCircleGrid=function(e,i,n,a,o){var s=this.getCircleGridCfg(e,i,a,o);if(s){var l={component:new qLt(s),layer:n,direction:it.NONE,type:Er.GRID,extra:{dim:o,scale:e,alignTick:L(s,"alignTick",!0)}};return l.component.init(),l}},t.prototype.getLineAxisCfg=function(e,i,n){var a=L(i,["top"])?this.axisForeContainer:this.axisContainer,o=this.view.getCoordinate(),s=Ap(o,n),l=ZL(e,i),u=Tp(this.view.getTheme(),n),c=L(i,["title"])?nt({title:{style:{text:l}}},{title:YL(this.view.getTheme(),n,i.title)},i):i,h=nt(S(S({container:a},s),{ticks:e.getTicks().map(function(_){return{id:"".concat(_.tickValue),name:_.text,value:_.value}}),verticalFactor:o.isPolar?XL(s,o.getCenter())*-1:XL(s,o.getCenter()),theme:u}),u,c),f=this.getAnimateCfg(h),d=f.animate,v=f.animateOption;h.animateOption=v,h.animate=d;var p=ik(s),g=L(h,"verticalLimitLength",p?1/3:1/2);if(g<=1){var m=this.view.getCanvas().get("width"),y=this.view.getCanvas().get("height");h.verticalLimitLength=g*(p?m:y)}return h},t.prototype.getLineGridCfg=function(e,i,n,a){if(BO(Tp(this.view.getTheme(),n),i)){var o=FO(this.view.getTheme(),n),s=nt({container:L(i,["top"])?this.gridForeContainer:this.gridContainer},o,L(i,"grid"),this.getAnimateCfg(i));return s.items=Pp(this.view.getCoordinate(),e,a,L(s,"alignTick",!0)),s}},t.prototype.getCircleAxisCfg=function(e,i,n){var a=L(i,["top"])?this.axisForeContainer:this.axisContainer,o=this.view.getCoordinate(),s=e.getTicks().map(function(p){return{id:"".concat(p.tickValue),name:p.text,value:p.value}});!e.isCategory&&Math.abs(o.endAngle-o.startAngle)===Math.PI*2&&s.length&&(s[s.length-1].name="");var l=ZL(e,i),u=Tp(this.view.getTheme(),it.CIRCLE),c=L(i,["title"])?nt({title:{style:{text:l}}},{title:YL(this.view.getTheme(),n,i.title)},i):i,h=nt(S(S({container:a},H_(this.view.getCoordinate())),{ticks:s,verticalFactor:1,theme:u}),u,c),f=this.getAnimateCfg(h),d=f.animate,v=f.animateOption;return h.animate=d,h.animateOption=v,h},t.prototype.getCircleGridCfg=function(e,i,n,a){if(BO(Tp(this.view.getTheme(),n),i)){var o=FO(this.view.getTheme(),it.RADIUS),s=nt({container:L(i,["top"])?this.gridForeContainer:this.gridContainer,center:this.view.getCoordinate().getCenter()},o,L(i,"grid"),this.getAnimateCfg(i)),l=L(s,"alignTick",!0),u=a==="x"?this.view.getYScales()[0]:this.view.getXScale();return s.items=Z_(this.view.getCoordinate(),u,e,l,a),s}},t.prototype.getId=function(e,i){var n=this.view.getCoordinate();return"".concat(e,"-").concat(i,"-").concat(n.type)},t.prototype.getAnimateCfg=function(e){return{animate:this.view.getOptions().animate&&L(e,"animate"),animateOption:e&&e.animateOption?nt({},DO,e.animateOption):DO}},t}(ph);function Cs(r,t,e){return e===it.TOP?[r.minX+r.width/2-t.width/2,r.minY]:e===it.BOTTOM?[r.minX+r.width/2-t.width/2,r.maxY-t.height]:e===it.LEFT?[r.minX,r.minY+r.height/2-t.height/2]:e===it.RIGHT?[r.maxX-t.width,r.minY+r.height/2-t.height/2]:e===it.TOP_LEFT||e===it.LEFT_TOP?[r.tl.x,r.tl.y]:e===it.TOP_RIGHT||e===it.RIGHT_TOP?[r.tr.x-t.width,r.tr.y]:e===it.BOTTOM_LEFT||e===it.LEFT_BOTTOM?[r.bl.x,r.bl.y-t.height]:e===it.BOTTOM_RIGHT||e===it.RIGHT_BOTTOM?[r.br.x-t.width,r.br.y-t.height]:[0,0]}function NO(r,t){return Rs(r)?r===!1?!1:{}:L(r,[t],r)}function Fp(r){return L(r,"position",it.BOTTOM)}var sDt=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.container=i.view.getLayer(rr.FORE).addGroup(),i}return Object.defineProperty(t.prototype,"name",{get:function(){return"legend"},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.render=function(){this.update()},t.prototype.layout=function(){var e=this;this.layoutBBox=this.view.viewBBox,R(this.components,function(i){var n=i.component,a=i.direction,o=W_(a),s=n.get("maxWidthRatio"),l=n.get("maxHeightRatio"),u=e.getCategoryLegendSizeCfg(o,s,l),c=n.get("maxWidth"),h=n.get("maxHeight");n.update({maxWidth:Math.min(u.maxWidth,c||0),maxHeight:Math.min(u.maxHeight,h||0)});var f=n.get("padding"),d=n.getLayoutBBox(),v=new Si(d.x,d.y,d.width,d.height).expand(f),p=lt(Cs(e.view.viewBBox,v,a),2),g=p[0],m=p[1],y=lt(Cs(e.layoutBBox,v,a),2),_=y[0],x=y[1],C=0,A=0;a.startsWith("top")||a.startsWith("bottom")?(C=g,A=x):(C=_,A=m),n.setLocation({x:C+f[3],y:A+f[0]}),e.layoutBBox=e.layoutBBox.cut(v,a)})},t.prototype.update=function(){var e=this;this.option=this.view.getOptions().legends;var i={},n=function(f,d,v){var p=e.getId(v.field),g=e.getComponentById(p);if(g){var m=void 0,y=NO(e.option,v.field);y!==!1&&(L(y,"custom")?m=e.getCategoryCfg(f,d,v,y,!0):v.isLinear?m=e.getContinuousCfg(f,d,v,y):v.isCategory&&(m=e.getCategoryCfg(f,d,v,y))),m&&(Di(m,["container"]),g.direction=Fp(y),g.component.update(m),i[p]=!0)}else{var _=e.createFieldLegend(f,d,v);_&&(_.component.init(),e.components.push(_),i[p]=!0)}};if(L(this.option,"custom")){var a="global-custom",o=this.getComponentById(a);if(o){var s=this.getCategoryCfg(void 0,void 0,void 0,this.option,!0);Di(s,["container"]),o.component.update(s),i[a]=!0}else{var l=this.createCustomLegend(void 0,void 0,void 0,this.option);if(l){l.init();var u=rr.FORE,c=Fp(this.option);this.components.push({id:a,component:l,layer:u,direction:c,type:Er.LEGEND,extra:void 0}),i[a]=!0}}}else this.loopLegends(n);var h=[];R(this.getComponents(),function(f){i[f.id]?h.push(f):f.component.destroy()}),this.components=h},t.prototype.clear=function(){r.prototype.clear.call(this),this.container.clear()},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.container.remove(!0)},t.prototype.getGeometries=function(e){var i=this,n=e.geometries;return R(e.views,function(a){n=n.concat(i.getGeometries(a))}),n},t.prototype.loopLegends=function(e){var i=this.view.getRootView()===this.view;if(i){var n=this.getGeometries(this.view),a={};R(n,function(o){var s=o.getGroupAttributes();R(s,function(l){var u=l.getScale(l.type);!u||u.type==="identity"||a[u.field]||(e(o,l,u),a[u.field]=!0)})})}},t.prototype.createFieldLegend=function(e,i,n){var a,o=NO(this.option,n.field),s=rr.FORE,l=Fp(o);if(o!==!1&&(L(o,"custom")?a=this.createCustomLegend(e,i,n,o):n.isLinear?a=this.createContinuousLegend(e,i,n,o):n.isCategory&&(a=this.createCategoryLegend(e,i,n,o))),a)return a.set("field",n.field),{id:this.getId(n.field),component:a,layer:s,direction:l,type:Er.LEGEND,extra:{scale:n}}},t.prototype.createCustomLegend=function(e,i,n,a){var o=this.getCategoryCfg(e,i,n,a,!0);return new WL(o)},t.prototype.createContinuousLegend=function(e,i,n,a){var o=this.getContinuousCfg(e,i,n,Di(a,["value"]));return new KLt(o)},t.prototype.createCategoryLegend=function(e,i,n,a){var o=this.getCategoryCfg(e,i,n,a);return new WL(o)},t.prototype.getContinuousCfg=function(e,i,n,a){var o=n.getTicks(),s=pa(o,function(p){return p.value===0}),l=pa(o,function(p){return p.value===1}),u=o.map(function(p){var g=p.value,m=p.tickValue,y=i.mapping(n.invert(g)).join("");return{value:m,attrValue:y,color:y,scaleValue:g}});s||u.push({value:n.min,attrValue:i.mapping(n.invert(0)).join(""),color:i.mapping(n.invert(0)).join(""),scaleValue:0}),l||u.push({value:n.max,attrValue:i.mapping(n.invert(1)).join(""),color:i.mapping(n.invert(1)).join(""),scaleValue:1}),u.sort(function(p,g){return p.value-g.value});var c={min:un(u).value,max:fr(u).value,colors:[],rail:{type:i.type},track:{}};i.type==="size"&&(c.track={style:{fill:i.type==="size"?this.view.getTheme().defaultColor:void 0}}),i.type==="color"&&(c.colors=u.map(function(p){return p.attrValue}));var h=this.container,f=Fp(a),d=W_(f),v=L(a,"title");return v&&(v=nt({text:Ad(n)},v)),c.container=h,c.layout=d,c.title=v,c.animateOption=Vc,this.mergeLegendCfg(c,a,"continuous")},t.prototype.getCategoryCfg=function(e,i,n,a,o){var s=this.container,l=L(a,"position",it.BOTTOM),u=hO(this.view.getTheme(),l),c=L(u,["marker"]),h=L(a,"marker"),f=W_(l),d=L(u,["pageNavigator"]),v=L(a,"pageNavigator"),p=o?IPt(c,h,a.items):kk(this.view,e,i,c,h),g=L(a,"title");g&&(g=nt({text:n?Ad(n):""},g));var m=L(a,"maxWidthRatio"),y=L(a,"maxHeightRatio"),_=this.getCategoryLegendSizeCfg(f,m,y);_.container=s,_.layout=f,_.items=p,_.title=g,_.animateOption=Vc,_.pageNavigator=nt({},d,v);var x=this.mergeLegendCfg(_,a,l);x.reversed&&x.items.reverse();var C=L(x,"maxItemWidth");return C&&C<=1&&(x.maxItemWidth=this.view.viewBBox.width*C),x},t.prototype.mergeLegendCfg=function(e,i,n){var a=n.split("-")[0],o=hO(this.view.getTheme(),a);return nt({},o,e,i)},t.prototype.getId=function(e){return"".concat(this.name,"-").concat(e)},t.prototype.getComponentById=function(e){return pa(this.components,function(i){return i.id===e})},t.prototype.getCategoryLegendSizeCfg=function(e,i,n){i===void 0&&(i=wL),n===void 0&&(n=wL);var a=this.view.viewBBox,o=a.width,s=a.height;return e==="vertical"?{maxWidth:o*i,maxHeight:s}:{maxWidth:o,maxHeight:s*n}},t}(ph),lDt=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.onChangeFn=ms,i.resetMeasure=function(){i.clear()},i.onValueChange=function(n){var a=lt(n,2),o=a[0],s=a[1];i.start=o,i.end=s,i.changeViewData(o,s)},i.container=i.view.getLayer(rr.FORE).addGroup(),i.onChangeFn=NE(i.onValueChange,20,{leading:!0}),i.width=0,i.view.on(kt.BEFORE_CHANGE_DATA,i.resetMeasure),i.view.on(kt.BEFORE_CHANGE_SIZE,i.resetMeasure),i}return Object.defineProperty(t.prototype,"name",{get:function(){return"slider"},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){r.prototype.destroy.call(this),this.view.off(kt.BEFORE_CHANGE_DATA,this.resetMeasure),this.view.off(kt.BEFORE_CHANGE_SIZE,this.resetMeasure)},t.prototype.init=function(){},t.prototype.render=function(){this.option=this.view.getOptions().slider;var e=this.getSliderCfg(),i=e.start,n=e.end;j(this.start)&&(this.start=i,this.end=n);var a=this.view.getOptions().data;this.option&&!Gi(a)?this.slider?this.slider=this.updateSlider():(this.slider=this.createSlider(),this.slider.component.on("sliderchange",this.onChangeFn)):this.slider&&(this.slider.component.destroy(),this.slider=void 0)},t.prototype.layout=function(){var e=this;if(this.option&&!this.width&&(this.measureSlider(),setTimeout(function(){e.view.destroyed||e.changeViewData(e.start,e.end)},0)),this.slider){var i=this.view.coordinateBBox.width,n=this.slider.component.get("padding"),a=lt(n,4),o=a[0];a[1],a[2];var s=a[3],l=this.slider.component.getLayoutBBox(),u=new Si(l.x,l.y,Math.min(l.width,i),l.height).expand(n),c=this.getMinMaxText(this.start,this.end),h=c.minText,f=c.maxText,d=lt(Cs(this.view.viewBBox,u,it.BOTTOM),2);d[0];var v=d[1],p=lt(Cs(this.view.coordinateBBox,u,it.BOTTOM),2),g=p[0];p[1],this.slider.component.update(S(S({},this.getSliderCfg()),{x:g+s,y:v+o,width:this.width,start:this.start,end:this.end,minText:h,maxText:f})),this.view.viewBBox=this.view.viewBBox.cut(u,it.BOTTOM)}},t.prototype.update=function(){this.render()},t.prototype.createSlider=function(){var e=this.getSliderCfg(),i=new VLt(S({container:this.container},e));return i.init(),{component:i,layer:rr.FORE,direction:it.BOTTOM,type:Er.SLIDER}},t.prototype.updateSlider=function(){var e=this.getSliderCfg();if(this.width){var i=this.getMinMaxText(this.start,this.end),n=i.minText,a=i.maxText;e=S(S({},e),{width:this.width,start:this.start,end:this.end,minText:n,maxText:a})}return this.slider.component.update(e),this.slider},t.prototype.measureSlider=function(){var e=this.getSliderCfg().width;this.width=e},t.prototype.getSliderCfg=function(){var e={height:16,start:0,end:1,minText:"",maxText:"",x:0,y:0,width:this.view.coordinateBBox.width};if(re(this.option)){var i=S({data:this.getData()},L(this.option,"trendCfg",{}));e=nt({},e,this.getThemeOptions(),this.option),e=S(S({},e),{trendCfg:i})}return e.start=Be(Math.min(j(e.start)?0:e.start,j(e.end)?1:e.end),0,1),e.end=Be(Math.max(j(e.start)?0:e.start,j(e.end)?1:e.end),0,1),e},t.prototype.getData=function(){var e=this.view.getOptions().data,i=lt(this.view.getYScales(),1),n=i[0],a=this.view.getGroupScales();if(a.length){var o=a[0],s=o.field,l=o.ticks;return e.reduce(function(u,c){return c[s]===l[0]&&u.push(c[n.field]),u},[])}return e.map(function(u){return u[n.field]||0})},t.prototype.getThemeOptions=function(){var e=this.view.getTheme();return L(e,["components","slider","common"],{})},t.prototype.getMinMaxText=function(e,i){var n=this.view.getOptions().data,a=this.view.getXScale(),o=xa(n,a.field);a.isLinear&&(o=o.sort());var s=o,l=Tr(n);if(!a||!l)return{};var u=Tr(s),c=Math.round(e*(u-1)),h=Math.round(i*(u-1)),f=L(s,[c]),d=L(s,[h]),v=this.getSliderCfg().formatter;return v&&(f=v(f,n[c],c),d=v(d,n[h],h)),{minText:f,maxText:d}},t.prototype.changeViewData=function(e,i){var n=this.view.getOptions().data,a=this.view.getXScale(),o=Tr(n);if(!(!a||!o)){var s=xa(n,a.field),l=this.view.getXScale().isLinear?s.sort(function(d,v){return Number(d)-Number(v)}):s,u=l,c=Tr(u),h=Math.round(e*(c-1)),f=Math.round(i*(c-1));this.view.filter(a.field,function(d,v){var p=u.indexOf(d);return p>-1?tc(p,h,f):!0}),this.view.render(!0)}},t.prototype.getComponents=function(){return this.slider?[this.slider]:[]},t.prototype.clear=function(){this.slider&&(this.slider.component.destroy(),this.slider=void 0),this.width=0,this.start=void 0,this.end=void 0},t}(ph),Bp=0,kO=8,uDt=32,cDt=20,hDt=function(r){B(t,r);function t(e){var i=r.call(this,e)||this;return i.onChangeFn=ms,i.resetMeasure=function(){i.clear()},i.onValueChange=function(n){var a=n.ratio,o=i.getValidScrollbarCfg().animate;i.ratio=Be(a,0,1);var s=i.view.getOptions().animate;o||i.view.animate(!1),i.changeViewData(i.getScrollRange(),!0),i.view.animate(s)},i.container=i.view.getLayer(rr.FORE).addGroup(),i.onChangeFn=NE(i.onValueChange,20,{leading:!0}),i.trackLen=0,i.thumbLen=0,i.ratio=0,i.view.on(kt.BEFORE_CHANGE_DATA,i.resetMeasure),i.view.on(kt.BEFORE_CHANGE_SIZE,i.resetMeasure),i}return Object.defineProperty(t.prototype,"name",{get:function(){return"scrollbar"},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){r.prototype.destroy.call(this),this.view.off(kt.BEFORE_CHANGE_DATA,this.resetMeasure),this.view.off(kt.BEFORE_CHANGE_SIZE,this.resetMeasure)},t.prototype.init=function(){},t.prototype.render=function(){this.option=this.view.getOptions().scrollbar,this.option?this.scrollbar?this.scrollbar=this.updateScrollbar():(this.scrollbar=this.createScrollbar(),this.scrollbar.component.on("scrollchange",this.onChangeFn)):this.scrollbar&&(this.scrollbar.component.destroy(),this.scrollbar=void 0)},t.prototype.layout=function(){var e=this;if(this.option&&!this.trackLen&&(this.measureScrollbar(),setTimeout(function(){e.view.destroyed||e.changeViewData(e.getScrollRange(),!0)})),this.scrollbar){var i=this.view.coordinateBBox.width,n=this.scrollbar.component.get("padding"),a=this.scrollbar.component.getLayoutBBox(),o=new Si(a.x,a.y,Math.min(a.width,i),a.height).expand(n),s=this.getScrollbarComponentCfg(),l=void 0,u=void 0;if(s.isHorizontal){var c=lt(Cs(this.view.viewBBox,o,it.BOTTOM),2);c[0];var h=c[1],f=lt(Cs(this.view.coordinateBBox,o,it.BOTTOM),2),d=f[0];f[1],l=d,u=h}else{var v=lt(Cs(this.view.viewBBox,o,it.RIGHT),2);v[0];var h=v[1],p=lt(Cs(this.view.viewBBox,o,it.RIGHT),2),d=p[0];p[1],l=d,u=h}l+=n[3],u+=n[0],this.trackLen?this.scrollbar.component.update(S(S({},s),{x:l,y:u,trackLen:this.trackLen,thumbLen:this.thumbLen,thumbOffset:(this.trackLen-this.thumbLen)*this.ratio})):this.scrollbar.component.update(S(S({},s),{x:l,y:u})),this.view.viewBBox=this.view.viewBBox.cut(o,s.isHorizontal?it.BOTTOM:it.RIGHT)}},t.prototype.update=function(){this.render()},t.prototype.getComponents=function(){return this.scrollbar?[this.scrollbar]:[]},t.prototype.clear=function(){this.scrollbar&&(this.scrollbar.component.destroy(),this.scrollbar=void 0),this.trackLen=0,this.thumbLen=0,this.ratio=0,this.cnt=0,this.step=0,this.data=void 0,this.xScaleCfg=void 0,this.yScalesCfg=[]},t.prototype.setValue=function(e){this.onValueChange({ratio:e})},t.prototype.getValue=function(){return this.ratio},t.prototype.getThemeOptions=function(){var e=this.view.getTheme();return L(e,["components","scrollbar","common"],{})},t.prototype.getScrollbarTheme=function(e){var i=L(this.view.getTheme(),["components","scrollbar"]),n=e||{},a=n.thumbHighlightColor,o=Ut(n,["thumbHighlightColor"]);return{default:nt({},L(i,["default","style"],{}),o),hover:nt({},L(i,["hover","style"],{}),{thumbColor:a})}},t.prototype.measureScrollbar=function(){var e=this.view.getXScale(),i=this.view.getYScales().slice();this.data=this.getScrollbarData(),this.step=this.getStep(),this.cnt=this.getCnt();var n=this.getScrollbarComponentCfg(),a=n.trackLen,o=n.thumbLen;this.trackLen=a,this.thumbLen=o,this.xScaleCfg={field:e.field,values:e.values||[]},this.yScalesCfg=i},t.prototype.getScrollRange=function(){var e=Math.floor((this.cnt-this.step)*Be(this.ratio,0,1)),i=Math.min(e+this.step-1,this.cnt-1);return[e,i]},t.prototype.changeViewData=function(e,i){var n=this,a=lt(e,2),o=a[0],s=a[1],l=this.getValidScrollbarCfg().type,u=l!=="vertical",c=xa(this.data,this.xScaleCfg.field),h=this.view.getXScale().isLinear?c.sort(function(d,v){return Number(d)-Number(v)}):c,f=u?h:h.reverse();this.yScalesCfg.forEach(function(d){n.view.scale(d.field,{formatter:d.formatter,type:d.type,min:d.min,max:d.max,tickMethod:d.tickMethod})}),this.view.filter(this.xScaleCfg.field,function(d){var v=f.indexOf(d);return v>-1?tc(v,o,s):!0}),this.view.render(!0)},t.prototype.createScrollbar=function(){var e=this.getValidScrollbarCfg().type,i=e!=="vertical",n=new XLt(S(S({container:this.container},this.getScrollbarComponentCfg()),{x:0,y:0}));return n.init(),{component:n,layer:rr.FORE,direction:i?it.BOTTOM:it.RIGHT,type:Er.SCROLLBAR}},t.prototype.updateScrollbar=function(){var e=this.getScrollbarComponentCfg(),i=this.trackLen?S(S({},e),{trackLen:this.trackLen,thumbLen:this.thumbLen,thumbOffset:(this.trackLen-this.thumbLen)*this.ratio}):S({},e);return this.scrollbar.component.update(i),this.scrollbar},t.prototype.getStep=function(){if(this.step)return this.step;var e=this.view.coordinateBBox,i=this.getValidScrollbarCfg(),n=i.type,a=i.categorySize,o=n!=="vertical";return Math.floor((o?e.width:e.height)/a)},t.prototype.getCnt=function(){if(this.cnt)return this.cnt;var e=this.view.getXScale(),i=this.getScrollbarData(),n=xa(i,e.field);return Tr(n)},t.prototype.getScrollbarComponentCfg=function(){var e=this.view,i=e.coordinateBBox,n=e.viewBBox,a=this.getValidScrollbarCfg(),o=a.type,s=a.padding,l=a.width,u=a.height,c=a.style,h=o!=="vertical",f=lt(s,4),d=f[0],v=f[1],p=f[2],g=f[3],m=h?{x:i.minX+g,y:n.maxY-u-p}:{x:n.maxX-l-v,y:i.minY+d},y=this.getStep(),_=this.getCnt(),x=h?i.width-g-v:i.height-d-p,C=Math.max(x*Be(y/_,0,1),cDt);return S(S({},this.getThemeOptions()),{x:m.x,y:m.y,size:h?u:l,isHorizontal:h,trackLen:x,thumbLen:C,thumbOffset:0,theme:this.getScrollbarTheme(c)})},t.prototype.getValidScrollbarCfg=function(){var e={type:"horizontal",categorySize:uDt,width:kO,height:kO,padding:[0,0,0,0],animate:!0,style:{}};return re(this.option)&&(e=S(S({},e),this.option)),(!re(this.option)||!this.option.padding)&&(e.padding=e.type==="horizontal"?[Bp,0,Bp,0]:[0,Bp,0,Bp]),e},t.prototype.getScrollbarData=function(){var e=this.view.getCoordinate(),i=this.getValidScrollbarCfg(),n=this.view.getOptions().data||[];return e.isReflect("y")&&i.type==="vertical"&&(n=_t([],lt(n),!1).reverse()),n},t}(ph),fDt={fill:"#CCD6EC",opacity:.3};function dDt(r,t,e){var i,n,a,o,s,l,u=iPt(r,t,e);if(u.length){u=vn(u);try{for(var c=qt(u),h=c.next();!h.done;h=c.next()){var f=h.value;try{for(var d=(a=void 0,qt(f)),v=d.next();!v.done;v=d.next()){var p=v.value,g=p.mappingData,m=g.x,y=g.y;p.x=Z(m)?m[m.length-1]:m,p.y=Z(y)?y[y.length-1]:y}}catch(O){a={error:O}}finally{try{v&&!v.done&&(o=d.return)&&o.call(d)}finally{if(a)throw a.error}}}}catch(O){i={error:O}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}var _=e.shared;if(_===!1&&u.length>1){var x=u[0],C=Math.abs(t.y-x[0].y);try{for(var A=qt(u),T=A.next();!T.done;T=A.next()){var w=T.value,M=Math.abs(t.y-w[0].y);M<=C&&(x=w,C=M)}}catch(O){s={error:O}}finally{try{T&&!T.done&&(l=A.return)&&l.call(A)}finally{if(s)throw s.error}}u=[x]}return Gl(vn(u))}return[]}var vDt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.show=function(e){var i=this.context.view,n=this.context.event,a=i.getController("tooltip").getTooltipCfg(),o=dDt(i,{x:n.x,y:n.y},a);if(!Jt(o,this.items)&&(this.items=o,o.length)){var s=i.getXScale().field,l=o[0].data[s],u=[],c=i.geometries;if(R(c,function(Q){if(Q.type==="interval"||Q.type==="schema"){var q=Q.getElementsBy(function(J){var et=J.getData();return et[s]===l});u=u.concat(q)}}),u.length){var h=i.getCoordinate(),f=u[0].shape.getCanvasBBox(),d=u[0].shape.getCanvasBBox(),v=f;R(u,function(Q){var q=Q.shape.getCanvasBBox();h.isTransposed?(q.minY<f.minY&&(f=q),q.maxY>d.maxY&&(d=q)):(q.minX<f.minX&&(f=q),q.maxX>d.maxX&&(d=q)),v.x=Math.min(q.minX,v.minX),v.y=Math.min(q.minY,v.minY),v.width=Math.max(q.maxX,v.maxX)-v.x,v.height=Math.max(q.maxY,v.maxY)-v.y});var p=i.backgroundGroup,g=i.coordinateBBox,m=void 0;if(h.isRect){var y=i.getXScale(),_=e||{},x=_.appendRatio,C=_.appendWidth;j(C)&&(x=j(x)?y.isLinear?0:.25:x,C=h.isTransposed?x*d.height:x*f.width);var A=void 0,T=void 0,w=void 0,M=void 0;h.isTransposed?(A=g.minX,T=Math.min(d.minY,f.minY)-C,w=g.width,M=v.height+C*2):(A=Math.min(f.minX,d.minX)-C,T=g.minY,w=v.width+C*2,M=g.height),m=[["M",A,T],["L",A+w,T],["L",A+w,T+M],["L",A,T+M],["Z"]]}else{var O=un(u),P=fr(u),D=Sd(O.getModel(),h).startAngle,z=Sd(P.getModel(),h).endAngle,Y=h.getCenter(),H=h.getRadius(),N=h.innerRadius*H;m=bs(Y.x,Y.y,H,D,z,N)}if(this.regionPath)this.regionPath.attr("path",m),this.regionPath.show();else{var W=L(e,"style",fDt);this.regionPath=p.addShape({type:"path",name:"active-region",capture:!1,attrs:S(S({},W),{path:m})})}}}},t.prototype.hide=function(){this.regionPath&&this.regionPath.hide(),this.items=null},t.prototype.destroy=function(){this.hide(),this.regionPath&&this.regionPath.remove(!0),r.prototype.destroy.call(this)},t}(Fe),aU=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.timeStamp=0,e}return t.prototype.show=function(){var e=this.context,i=e.event,n=e.view,a=n.isTooltipLocked();if(!a){var o=this.timeStamp,s=+new Date,l=L(e.view.getOptions(),"tooltip.showDelay",16);if(s-o>l){var u=this.location,c={x:i.x,y:i.y};(!u||!Jt(u,c))&&this.showTooltip(n,c),this.timeStamp=s,this.location=c}}},t.prototype.hide=function(){var e=this.context.view,i=e.getController("tooltip"),n=this.context.event,a=n.clientX,o=n.clientY;i.isCursorEntered({x:a,y:o})||e.isTooltipLocked()||(this.hideTooltip(e),this.location=null)},t.prototype.showTooltip=function(e,i){e.showTooltip(i)},t.prototype.hideTooltip=function(e){e.hideTooltip()},t}(Fe),pDt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.showTooltip=function(e,i){var n=Za(e);R(n,function(a){var o=MC(e,a,i);a.showTooltip(o)})},t.prototype.hideTooltip=function(e){var i=Za(e);R(i,function(n){n.hideTooltip()})},t}(aU),gDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.timeStamp=0,e}return t.prototype.destroy=function(){r.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},t.prototype.show=function(){var e=this.context,i=e.event,n=this.timeStamp,a=+new Date;if(a-n>16){var o=this.location,s={x:i.x,y:i.y};(!o||!Jt(o,s))&&this.showTooltip(s),this.timeStamp=a,this.location=s}},t.prototype.hide=function(){this.hideTooltip(),this.location=null},t.prototype.showTooltip=function(e){var i=this.context,n=i.event,a=n.target;if(a&&a.get("tip")){if(!this.tooltip)this.renderTooltip();else{var o=i.view,s=o.canvas,l={start:{x:0,y:0},end:{x:s.get("width"),y:s.get("height")}};this.tooltip.set("region",l)}var u=a.get("tip");this.tooltip.update(S({title:u},e)),this.tooltip.show()}},t.prototype.hideTooltip=function(){this.tooltip&&this.tooltip.hide()},t.prototype.renderTooltip=function(){var e,i=this.context.view,n=i.canvas,a={start:{x:0,y:0},end:{x:n.get("width"),y:n.get("height")}},o=i.getTheme(),s=L(o,["components","tooltip","domStyles"],{}),l=new hy({parent:n.get("el").parentNode,region:a,visible:!1,crosshairs:null,domStyles:S({},nt({},s,(e={},e[Uo]={"max-width":"50%"},e[zo]={"word-break":"break-all"},e)))});l.init(),l.setCapture(!1),this.tooltip=l},t}(Fe),IT=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="",e}return t.prototype.hasState=function(e){return e.hasState(this.stateName)},t.prototype.setElementState=function(e,i){e.setState(this.stateName,i)},t.prototype.setState=function(){this.setStateEnable(!0)},t.prototype.clear=function(){var e=this.context.view;this.clearViewState(e)},t.prototype.clearViewState=function(e){var i=this,n=gk(e,this.stateName);R(n,function(a){i.setElementState(a,!1)})},t}(Fe);function UO(r){return L(r.get("delegateObject"),"item")}var LT=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.ignoreListItemStates=["unchecked"],e}return t.prototype.isItemIgnore=function(e,i){var n=this.ignoreListItemStates,a=n.filter(function(o){return i.hasState(e,o)});return!!a.length},t.prototype.setStateByComponent=function(e,i,n){var a=this.context.view,o=e.get("field"),s=kr(a);this.setElementsStateByItem(s,o,i,n)},t.prototype.setStateByElement=function(e,i){this.setElementState(e,i)},t.prototype.isMathItem=function(e,i,n){var a=this.context.view,o=Wc(a,i),s=Aa(e,i);return!j(s)&&n.name===o.getText(s)},t.prototype.setElementsStateByItem=function(e,i,n,a){var o=this;R(e,function(s){o.isMathItem(s,i,n)&&s.setState(o.stateName,a)})},t.prototype.setStateEnable=function(e){var i=Ns(this.context);if(i)fk(this.context)&&this.setStateByElement(i,e);else{var n=nu(this.context);if(Td(n)){var a=n.item,o=n.component;if(a&&o&&!this.isItemIgnore(a,o)){var s=this.context.event.gEvent;if(s&&s.fromShape&&s.toShape&&UO(s.fromShape)===UO(s.toShape))return;this.setStateByComponent(o,a,e)}}}},t.prototype.toggle=function(){var e=Ns(this.context);if(e){var i=e.hasState(this.stateName);this.setElementState(e,!i)}},t.prototype.reset=function(){this.setStateEnable(!1)},t}(IT),mDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="active",e}return t.prototype.active=function(){this.setState()},t}(LT),yDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.cache={},e}return t.prototype.getColorScale=function(e,i){var n=i.geometry.getAttribute("color");if(!n)return null;var a=e.getScaleByField(n.getFields()[0]);return a},t.prototype.getLinkPath=function(e,i){var n=this.context.view,a=n.getCoordinate().isTransposed,o=e.shape.getCanvasBBox(),s=i.shape.getCanvasBBox(),l=a?[["M",o.minX,o.minY],["L",s.minX,s.maxY],["L",s.maxX,s.maxY],["L",o.maxX,o.minY],["Z"]]:[["M",o.maxX,o.minY],["L",s.minX,s.minY],["L",s.minX,s.maxY],["L",o.maxX,o.maxY],["Z"]];return l},t.prototype.addLinkShape=function(e,i,n,a){var o={opacity:.4,fill:i.shape.attr("fill")};e.addShape({type:"path",attrs:S(S({},nt({},o,ut(a)?a(o,i):a)),{path:this.getLinkPath(i,n)})})},t.prototype.linkByElement=function(e,i){var n=this,a=this.context.view,o=this.getColorScale(a,e);if(o){var s=Aa(e,o.field);if(!this.cache[s]){var l=BOt(a,o.field,s),u=this.linkGroup,c=u.addGroup();this.cache[s]=c;var h=l.length;R(l,function(f,d){if(d<h-1){var v=l[d+1];n.addLinkShape(c,f,v,i)}})}}},t.prototype.removeLink=function(e){var i=this.getColorScale(this.context.view,e);if(i){var n=Aa(e,i.field);this.cache[n]&&(this.cache[n].remove(),this.cache[n]=null)}},t.prototype.link=function(e){var i=this.context;this.linkGroup||(this.linkGroup=i.view.foregroundGroup.addGroup({id:"link-by-color-group",capture:!1}));var n=Ns(i);n&&this.linkByElement(n,e==null?void 0:e.style)},t.prototype.unlink=function(){var e=Ns(this.context);e&&this.removeLink(e)},t.prototype.clear=function(){this.linkGroup&&this.linkGroup.clear(),this.cache={}},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.linkGroup&&this.linkGroup.remove()},t}(Fe),OT=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.startPoint=null,e.endPoint=null,e.isStarted=!1,e.effectSiblings=!1,e.effectByRecord=!1,e}return t.prototype.getCurrentPoint=function(){var e=this.context.event;return{x:e.x,y:e.y}},t.prototype.start=function(){this.clear(),this.startPoint=this.getCurrentPoint(),this.isStarted=!0},t.prototype.getIntersectElements=function(){var e=null;if(bd(this.context))e=dT(this.context,10);else{var i=this.startPoint,n=this.isStarted?this.getCurrentPoint():this.endPoint;if(!i||!n)return;var a={minX:Math.min(i.x,n.x),minY:Math.min(i.y,n.y),maxX:Math.max(i.x,n.x),maxY:Math.max(i.y,n.y)},o=this.context.view;e=py(o,a)}return e},t.prototype.setStateEnable=function(e){if(this.effectSiblings&&!this.effectByRecord)this.setSiblingsState(e);else{var i=kr(this.context.view),n=this.getIntersectElements();n&&n.length?this.effectByRecord?this.setSiblingsStateByRecord(n,e):this.setElementsState(n,e,i):this.clear()}},t.prototype.setSiblingsStateByRecord=function(e,i){var n=this,a=this.context.view,o=Za(a),s=e.map(function(c){return c.getModel().data}),l=a.getXScale().field,u=a.getYScales()[0].field;R(o,function(c){var h=kr(c),f=h.filter(function(d){var v=d.getModel().data;return _k(s,v,l,u)});n.setElementsState(f,i,h)})},t.prototype.setSiblingsState=function(e){var i=this,n=this.context.view,a=Za(n);bd(this.context)&&R(a,function(o){var s=kr(o),l=vk(i.context,o,10);l&&l.length?i.setElementsState(l,e,s):i.clearViewState(o)})},t.prototype.setElementsState=function(e,i,n){var a=this;R(n,function(o){e.includes(o)?a.setElementState(o,i):a.setElementState(o,!1)})},t.prototype.end=function(){this.isStarted=!1,this.endPoint=this.getCurrentPoint()},t.prototype.clear=function(){var e=this,i=this.context.view;if(this.effectSiblings){var n=Za(i);R(n,function(a){e.clearViewState(a)})}else this.clearViewState(i)},t}(IT),_Dt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="active",e}return t.prototype.active=function(){this.setState()},t}(OT),PT=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.setStateEnable=function(e){var i=Ns(this.context);if(i){if(!fk(this.context))return;e?(this.clear(),this.setElementState(i,!0)):this.hasState(i)&&this.setElementState(i,!1)}},t.prototype.toggle=function(){var e=Ns(this.context);if(e){var i=this.hasState(e);i||this.clear(),this.setElementState(e,!i)}},t.prototype.reset=function(){this.setStateEnable(!1)},t}(IT),xDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="active",e}return t.prototype.active=function(){this.setState()},t}(PT),Ff="inactive",Bf="active";function FT(r){var t=kr(r);R(t,function(e){e.hasState(Bf)&&e.setState(Bf,!1),e.hasState(Ff)&&e.setState(Ff,!1)})}function oU(r,t,e){R(r,function(i){t(i)?(i.hasState(Ff)&&i.setState(Ff,!1),i.setState(Bf,e)):(i.hasState(Bf)&&i.setState(Bf,!1),i.setState(Ff,e))})}var bl=E0.INACTIVE,Co=E0.ACTIVE,BT=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName=Co,e}return t.prototype.setElementsStateByItem=function(e,i,n,a){var o=this,s=function(l){return o.isMathItem(l,i,n)};this.setHighlightBy(e,s,a)},t.prototype.setElementHighlight=function(e,i){i(e)?(e.hasState(bl)&&e.setState(bl,!1),e.setState(Co,!0)):e.hasState(Co)||e.setState(bl,!0)},t.prototype.setHighlightBy=function(e,i,n){var a=this;if(n)R(e,function(l){a.setElementHighlight(l,i)});else{var o=gk(this.context.view,Co),s=!0;R(o,function(l){if(!i(l))return s=!1,!1}),s?this.clear():R(e,function(l){i(l)&&(l.hasState(Co)&&l.setState(Co,!1),l.setState(bl,!0))})}},t.prototype.setElementState=function(e,i){var n=this.context.view,a=kr(n);this.setHighlightBy(a,function(o){return e===o},i)},t.prototype.highlight=function(){this.setState()},t.prototype.clear=function(){var e=this.context.view;FT(e)},t}(LT),CDt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.setStateByElement=function(e,i){var n=this.context.view,a=e.geometry.getAttribute("color");if(a){var o=n.getScaleByField(a.getFields()[0]),s=Aa(e,o.field),l=kr(n),u=l.filter(function(c){return Aa(c,o.field)===s});this.setHighlightBy(l,function(c){return u.includes(c)},i)}},t}(BT),EDt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.setElementHighlight=function(e,i){i(e)?(e.hasState(bl)&&e.setState(bl,!1),e.setState(Co,!0)):(e.setState(bl,!0),e.hasState(Co)&&e.setState(Co,!1))},t.prototype.setStateByElement=function(e,i){var n=this.context.view,a=n.getXScale(),o=Aa(e,a.field),s=kr(n),l=s.filter(function(u){return Aa(u,a.field)===o});this.setHighlightBy(s,function(u){return l.includes(u)},i)},t.prototype.toggle=function(){var e=Ns(this.context);if(e){var i=e.hasState(this.stateName);this.setStateByElement(e,!i)}},t}(BT),Fa;(function(r){r.BEFORE_HIGHLIGHT="element-range-highlight:beforehighlight",r.AFTER_HIGHLIGHT="element-range-highlight:afterhighlight",r.BEFORE_CLEAR="element-range-highlight:beforeclear",r.AFTER_CLEAR="element-range-highlight:afterclear"})(Fa||(Fa={}));var sU=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="active",e}return t.prototype.clearViewState=function(e){FT(e)},t.prototype.highlight=function(){var e=this.context,i=e.view,n=e.event,a=this.getIntersectElements(),o={view:i,event:n,highlightElements:a};i.emit(Fa.BEFORE_HIGHLIGHT,He.fromData(i,Fa.BEFORE_HIGHLIGHT,o)),this.setState(),i.emit(Fa.AFTER_HIGHLIGHT,He.fromData(i,Fa.AFTER_HIGHLIGHT,o))},t.prototype.clear=function(){var e=this.context.view;e.emit(Fa.BEFORE_CLEAR,He.fromData(e,Fa.BEFORE_CLEAR,{})),r.prototype.clear.call(this),e.emit(Fa.AFTER_CLEAR,He.fromData(e,Fa.AFTER_CLEAR,{}))},t.prototype.setElementsState=function(e,i,n){oU(n,function(a){return e.indexOf(a)>=0},i)},t}(OT),SDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="active",e}return t.prototype.highlight=function(){this.setState()},t.prototype.setElementState=function(e,i){var n=this.context.view,a=kr(n);oU(a,function(o){return e===o},i)},t.prototype.clear=function(){var e=this.context.view;FT(e)},t}(PT),ADt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="selected",e}return t.prototype.selected=function(){this.setState()},t}(OT),TDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="selected",e}return t.prototype.selected=function(){this.setState()},t}(LT),bDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="selected",e}return t.prototype.selected=function(){this.setState()},t}(PT),Eu=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="",e.ignoreItemStates=[],e}return t.prototype.getTriggerListInfo=function(){var e=nu(this.context),i=null;return Td(e)&&(i={item:e.item,list:e.component}),i},t.prototype.getAllowComponents=function(){var e=this,i=this.context.view,n=yk(i),a=[];return R(n,function(o){o.isList()&&e.allowSetStateByElement(o)&&a.push(o)}),a},t.prototype.hasState=function(e,i){return e.hasState(i,this.stateName)},t.prototype.clearAllComponentsState=function(){var e=this,i=this.getAllowComponents();R(i,function(n){n.clearItemsState(e.stateName)})},t.prototype.allowSetStateByElement=function(e){var i=e.get("field");if(!i)return!1;if(this.cfg&&this.cfg.componentNames){var n=e.get("name");if(this.cfg.componentNames.indexOf(n)===-1)return!1}var a=this.context.view,o=Wc(a,i);return o&&o.isCategory},t.prototype.allowSetStateByItem=function(e,i){var n=this.ignoreItemStates;if(n.length){var a=n.filter(function(o){return i.hasState(e,o)});return a.length===0}return!0},t.prototype.setStateByElement=function(e,i,n){var a=e.get("field"),o=this.context.view,s=Wc(o,a),l=Aa(i,a),u=s.getText(l);this.setItemsState(e,u,n)},t.prototype.setStateEnable=function(e){var i=this,n=Ns(this.context);if(n){var a=this.getAllowComponents();R(a,function(u){i.setStateByElement(u,n,e)})}else{var o=nu(this.context);if(Td(o)){var s=o.item,l=o.component;this.allowSetStateByElement(l)&&this.allowSetStateByItem(s,l)&&this.setItemState(l,s,e)}}},t.prototype.setItemsState=function(e,i,n){var a=this,o=e.getItems();R(o,function(s){s.name===i&&a.setItemState(e,s,n)})},t.prototype.setItemState=function(e,i,n){e.setItemState(i,this.stateName,n)},t.prototype.setState=function(){this.setStateEnable(!0)},t.prototype.reset=function(){this.setStateEnable(!1)},t.prototype.toggle=function(){var e=this.getTriggerListInfo();if(e&&e.item){var i=e.list,n=e.item,a=this.hasState(i,n);this.setItemState(i,n,!a)}},t.prototype.clear=function(){var e=this.getTriggerListInfo();e?e.list.clearItemsState(this.stateName):this.clearAllComponentsState()},t}(Fe),wDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="active",e}return t.prototype.active=function(){this.setState()},t}(Eu),zO="inactive",HO="active";function RDt(r){var t=r.getItems();R(t,function(e){r.hasState(e,HO)&&r.setItemState(e,HO,!1),r.hasState(e,zO)&&r.setItemState(e,zO,!1)})}var Yh="inactive",ll="active",DT=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName=ll,e.ignoreItemStates=["unchecked"],e}return t.prototype.setItemsState=function(e,i,n){this.setHighlightBy(e,function(a){return a.name===i},n)},t.prototype.setItemState=function(e,i,n){e.getItems(),this.setHighlightBy(e,function(a){return a===i},n)},t.prototype.setHighlightBy=function(e,i,n){var a=e.getItems();if(n)R(a,function(l){i(l)?(e.hasState(l,Yh)&&e.setItemState(l,Yh,!1),e.setItemState(l,ll,!0)):e.hasState(l,ll)||e.setItemState(l,Yh,!0)});else{var o=e.getItemsByState(ll),s=!0;R(o,function(l){if(!i(l))return s=!1,!1}),s?this.clear():R(a,function(l){i(l)&&(e.hasState(l,ll)&&e.setItemState(l,ll,!1),e.setItemState(l,Yh,!0))})}},t.prototype.highlight=function(){this.setState()},t.prototype.clear=function(){var e=this.getTriggerListInfo();if(e)RDt(e.list);else{var i=this.getAllowComponents();R(i,function(n){n.clearItemsState(ll),n.clearItemsState(Yh)})}},t}(Eu),MDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="selected",e}return t.prototype.selected=function(){this.setState()},t}(Eu),IDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="unchecked",e}return t.prototype.unchecked=function(){this.setState()},t}(Eu),Bu="unchecked",Dp="checked",LDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName=Dp,e}return t.prototype.setItemState=function(e,i,n){this.setCheckedBy(e,function(a){return a===i},n)},t.prototype.setCheckedBy=function(e,i,n){var a=e.getItems();n&&R(a,function(o){i(o)?(e.hasState(o,Bu)&&e.setItemState(o,Bu,!1),e.setItemState(o,Dp,!0)):e.hasState(o,Dp)||e.setItemState(o,Bu,!0)})},t.prototype.toggle=function(){var e=this.getTriggerListInfo();if(e&&e.item){var i=e.list,n=e.item,a=!j0(i.getItems(),function(o){return i.hasState(o,Bu)});a||i.hasState(n,Bu)?this.setItemState(i,n,!0):this.reset()}},t.prototype.checked=function(){this.setState()},t.prototype.reset=function(){var e=this.getAllowComponents();R(e,function(i){i.clearItemsState(Dp),i.clearItemsState(Bu)})},t}(Eu),Du="unchecked",ODt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.toggle=function(){var e,i,n,a,o,s,l,u,c=this.getTriggerListInfo();if(c!=null&&c.item){var h=c.list,f=c.item,d=h.getItems(),v=d.filter(function(O){return!h.hasState(O,Du)}),p=d.filter(function(O){return h.hasState(O,Du)}),g=v[0];if(d.length===v.length)try{for(var m=qt(d),y=m.next();!y.done;y=m.next()){var _=y.value;h.setItemState(_,Du,_.id!==f.id)}}catch(O){e={error:O}}finally{try{y&&!y.done&&(i=m.return)&&i.call(m)}finally{if(e)throw e.error}}else if(d.length-p.length===1)if(g.id===f.id)try{for(var x=qt(d),C=x.next();!C.done;C=x.next()){var _=C.value;h.setItemState(_,Du,!1)}}catch(O){n={error:O}}finally{try{C&&!C.done&&(a=x.return)&&a.call(x)}finally{if(n)throw n.error}}else try{for(var A=qt(d),T=A.next();!T.done;T=A.next()){var _=T.value;h.setItemState(_,Du,_.id!==f.id)}}catch(O){o={error:O}}finally{try{T&&!T.done&&(s=A.return)&&s.call(A)}finally{if(o)throw o.error}}else try{for(var w=qt(d),M=w.next();!M.done;M=w.next()){var _=M.value;h.setItemState(_,Du,_.id!==f.id)}}catch(O){l={error:O}}finally{try{M&&!M.done&&(u=w.return)&&u.call(w)}finally{if(l)throw l.error}}}},t}(Eu),$O="showRadio",q_="legend-radio-tip",PDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.timeStamp=0,e}return t.prototype.show=function(){var e=this.getTriggerListInfo();if(e!=null&&e.item){var i=e.list,n=e.item;i.setItemState(n,$O,!0)}},t.prototype.hide=function(){var e=this.getTriggerListInfo();if(e!=null&&e.item){var i=e.list,n=e.item;i.setItemState(n,$O,!1)}},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},t.prototype.showTip=function(){var e=this.context,i=e.event,n=this.timeStamp,a=+new Date,o=this.context.event.target;if(a-n>16&&o.get("name")==="legend-item-radio"){var s=this.location,l={x:i.x,y:i.y};this.timeStamp=a,this.location=l,(!s||!Jt(s,l))&&this.showTooltip(l)}},t.prototype.hideTip=function(){this.hideTooltip(),this.location=null},t.prototype.showTooltip=function(e){var i=this.context,n=i.event,a=n.target;if(a&&a.get("tip")){this.tooltip||this.renderTooltip();var o=i.view.getCanvas().get("el").getBoundingClientRect(),s=o.x,l=o.y;this.tooltip.update(S(S({title:a.get("tip")},e),{x:e.x+s,y:e.y+l})),this.tooltip.show()}},t.prototype.hideTooltip=function(){this.tooltip&&this.tooltip.hide()},t.prototype.renderTooltip=function(){var e,i=(e={},e[Uo]={padding:"6px 8px",transform:"translate(-50%, -80%)",background:"rgba(0,0,0,0.75)",color:"#fff","border-radius":"2px","z-index":100},e[zo]={"font-size":"12px","line-height":"14px","margin-bottom":0,"word-break":"break-all"},e);document.getElementById(q_)&&document.body.removeChild(document.getElementById(q_));var n=new hy({parent:document.body,region:null,visible:!1,crosshairs:null,domStyles:i,containerId:q_});n.init(),n.setCapture(!1),this.tooltip=n},t}(Eu),NT=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.maskShape=null,e.points=[],e.starting=!1,e.moving=!1,e.preMovePoint=null,e.shapeType="path",e}return t.prototype.getCurrentPoint=function(){var e=this.context.event;return{x:e.x,y:e.y}},t.prototype.emitEvent=function(e){var i="mask:".concat(e),n=this.context.view,a=this.context.event;n.emit(i,{target:this.maskShape,shape:this.maskShape,points:this.points,x:a.x,y:a.y})},t.prototype.createMask=function(){var e=this.context.view,i=this.getMaskAttrs(),n=e.foregroundGroup.addShape({type:this.shapeType,name:"mask",draggable:!0,attrs:S({fill:"#C5D4EB",opacity:.3},i)});return n},t.prototype.getMaskPath=function(){return[]},t.prototype.show=function(){this.maskShape&&(this.maskShape.show(),this.emitEvent("show"))},t.prototype.start=function(e){this.starting=!0,this.moving=!1,this.points=[this.getCurrentPoint()],this.maskShape||(this.maskShape=this.createMask(),this.maskShape.set("capture",!1)),this.updateMask(e==null?void 0:e.maskStyle),this.emitEvent("start")},t.prototype.moveStart=function(){this.moving=!0,this.preMovePoint=this.getCurrentPoint()},t.prototype.move=function(){if(!(!this.moving||!this.maskShape)){var e=this.getCurrentPoint(),i=this.preMovePoint,n=e.x-i.x,a=e.y-i.y,o=this.points;R(o,function(s){s.x+=n,s.y+=a}),this.updateMask(),this.emitEvent("change"),this.preMovePoint=e}},t.prototype.updateMask=function(e){var i=nt({},this.getMaskAttrs(),e);this.maskShape.attr(i)},t.prototype.moveEnd=function(){this.moving=!1,this.preMovePoint=null},t.prototype.end=function(){this.starting=!1,this.emitEvent("end"),this.maskShape&&this.maskShape.set("capture",!0)},t.prototype.hide=function(){this.maskShape&&(this.maskShape.hide(),this.emitEvent("hide"))},t.prototype.resize=function(){this.starting&&this.maskShape&&(this.points.push(this.getCurrentPoint()),this.updateMask(),this.emitEvent("change"))},t.prototype.destroy=function(){this.points=[],this.maskShape&&this.maskShape.remove(),this.maskShape=null,this.preMovePoint=null,r.prototype.destroy.call(this)},t}(Fe);function lU(r){var t=fr(r),e=0,i=0,n=0;if(r.length){var a=r[0];e=vT(a,t)/2,i=(t.x+a.x)/2,n=(t.y+a.y)/2}return{x:i,y:n,r:e}}var FDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.shapeType="circle",e}return t.prototype.getMaskAttrs=function(){return lU(this.points)},t}(NT);function uU(r){return{start:un(r),end:fr(r)}}function cU(r,t){var e=Math.min(r.x,t.x),i=Math.min(r.y,t.y),n=Math.abs(t.x-r.x),a=Math.abs(t.y-r.y);return{x:e,y:i,width:n,height:a}}var hU=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.shapeType="rect",e}return t.prototype.getRegion=function(){return uU(this.points)},t.prototype.getMaskAttrs=function(){var e=this.getRegion(),i=e.start,n=e.end;return cU(i,n)},t}(NT);function WO(r){r.x=Be(r.x,0,1),r.y=Be(r.y,0,1)}function fU(r,t,e,i){var n=null,a=null,o=i.invert(un(r)),s=i.invert(fr(r));return e&&(WO(o),WO(s)),t==="x"?(n=i.convert({x:o.x,y:0}),a=i.convert({x:s.x,y:1})):(n=i.convert({x:0,y:o.y}),a=i.convert({x:1,y:s.y})),{start:n,end:a}}var dU=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.dim="x",e.inPlot=!0,e}return t.prototype.getRegion=function(){var e=this.context.view.getCoordinate();return fU(this.points,this.dim,this.inPlot,e)},t}(hU);function kT(r){var t=[];return r.length&&(R(r,function(e,i){i===0?t.push(["M",e.x,e.y]):t.push(["L",e.x,e.y])}),t.push(["L",r[0].x,r[0].y])),t}function vU(r){return{path:kT(r)}}var pU=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getMaskPath=function(){return kT(this.points)},t.prototype.getMaskAttrs=function(){return vU(this.points)},t.prototype.addPoint=function(){this.resize()},t}(NT);function UT(r){return NOt(r,!0)}function gU(r){return{path:UT(r)}}var BDt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getMaskPath=function(){return UT(this.points)},t.prototype.getMaskAttrs=function(){return gU(this.points)},t}(pU),zT=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.maskShapes=[],e.starting=!1,e.moving=!1,e.recordPoints=null,e.preMovePoint=null,e.shapeType="path",e.maskType="multi-mask",e}return t.prototype.getCurrentPoint=function(){var e=this.context.event;return{x:e.x,y:e.y}},t.prototype.emitEvent=function(e){var i="".concat(this.maskType,":").concat(e),n=this.context.view,a=this.context.event,o={type:this.shapeType,name:this.maskType,get:function(s){return o.hasOwnProperty(s)?o[s]:void 0}};n.emit(i,{target:o,maskShapes:this.maskShapes,multiPoints:this.recordPoints,x:a.x,y:a.y})},t.prototype.createMask=function(e){var i=this.context.view,n=this.recordPoints[e],a=this.getMaskAttrs(n),o=i.foregroundGroup.addShape({type:this.shapeType,name:"mask",draggable:!0,attrs:S({fill:"#C5D4EB",opacity:.3},a)});this.maskShapes.push(o)},t.prototype.getMaskPath=function(e){return[]},t.prototype.show=function(){this.maskShapes.length>0&&(this.maskShapes.forEach(function(e){return e.show()}),this.emitEvent("show"))},t.prototype.start=function(e){this.recordPointStart(),this.starting=!0,this.moving=!1;var i=this.recordPoints.length-1;this.createMask(i),this.updateShapesCapture(!1),this.updateMask(e==null?void 0:e.maskStyle),this.emitEvent("start")},t.prototype.moveStart=function(){this.moving=!0,this.preMovePoint=this.getCurrentPoint(),this.updateShapesCapture(!1)},t.prototype.move=function(){if(!(!this.moving||this.maskShapes.length===0)){var e=this.getCurrentPoint(),i=this.preMovePoint,n=e.x-i.x,a=e.y-i.y,o=this.getCurMaskShapeIndex();o>-1&&(this.recordPoints[o].forEach(function(s){s.x+=n,s.y+=a}),this.updateMask(),this.emitEvent("change"),this.preMovePoint=e)}},t.prototype.updateMask=function(e){var i=this;this.recordPoints.forEach(function(n,a){var o=nt({},i.getMaskAttrs(n),e);i.maskShapes[a].attr(o)})},t.prototype.resize=function(){this.starting&&this.maskShapes.length>0&&(this.recordPointContinue(),this.updateMask(),this.emitEvent("change"))},t.prototype.moveEnd=function(){this.moving=!1,this.preMovePoint=null,this.updateShapesCapture(!0)},t.prototype.end=function(){this.starting=!1,this.emitEvent("end"),this.updateShapesCapture(!0)},t.prototype.hide=function(){this.maskShapes.length>0&&(this.maskShapes.forEach(function(e){return e.hide()}),this.emitEvent("hide"))},t.prototype.remove=function(){var e=this.getCurMaskShapeIndex();e>-1&&(this.recordPoints.splice(e,1),this.maskShapes[e].remove(),this.maskShapes.splice(e,1),this.preMovePoint=null,this.updateShapesCapture(!0),this.emitEvent("change"))},t.prototype.clearAll=function(){this.recordPointClear(),this.maskShapes.forEach(function(e){return e.remove()}),this.maskShapes=[],this.preMovePoint=null},t.prototype.clear=function(){var e=this.getCurMaskShapeIndex();e===-1?(this.recordPointClear(),this.maskShapes.forEach(function(i){return i.remove()}),this.maskShapes=[],this.emitEvent("clearAll")):(this.recordPoints.splice(e,1),this.maskShapes[e].remove(),this.maskShapes.splice(e,1),this.preMovePoint=null,this.emitEvent("clearSingle")),this.preMovePoint=null},t.prototype.destroy=function(){this.clear(),r.prototype.destroy.call(this)},t.prototype.getRecordPoints=function(){var e;return _t([],lt((e=this.recordPoints)!==null&&e!==void 0?e:[]),!1)},t.prototype.recordPointStart=function(){var e=this.getRecordPoints(),i=this.getCurrentPoint();this.recordPoints=_t(_t([],lt(e),!1),[[i]],!1)},t.prototype.recordPointContinue=function(){var e=this.getRecordPoints(),i=this.getCurrentPoint(),n=e.splice(-1,1)[0]||[];n.push(i),this.recordPoints=_t(_t([],lt(e),!1),[n],!1)},t.prototype.recordPointClear=function(){this.recordPoints=[]},t.prototype.updateShapesCapture=function(e){this.maskShapes.forEach(function(i){return i.set("capture",e)})},t.prototype.getCurMaskShapeIndex=function(){var e=this.getCurrentPoint();return this.maskShapes.findIndex(function(i){var n=i.attrs,a=n.width,o=n.height,s=n.r,l=a===0||o===0||s===0;return!l&&i.isHit(e.x,e.y)})},t}(Fe),mU=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.shapeType="rect",e}return t.prototype.getRegion=function(e){return uU(e)},t.prototype.getMaskAttrs=function(e){var i=this.getRegion(e),n=i.start,a=i.end;return cU(n,a)},t}(zT),yU=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.dim="x",e.inPlot=!0,e}return t.prototype.getRegion=function(e){var i=this.context.view.getCoordinate();return fU(e,this.dim,this.inPlot,i)},t}(mU),DDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.shapeType="circle",e.getMaskAttrs=lU,e}return t}(zT),_U=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.getMaskPath=kT,e.getMaskAttrs=vU,e}return t.prototype.addPoint=function(){this.resize()},t}(zT),NDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.getMaskPath=UT,e.getMaskAttrs=gU,e}return t}(_U),kDt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.setCursor=function(e){var i=this.context.view;i.getCanvas().setCursor(e)},t.prototype.default=function(){this.setCursor("default")},t.prototype.pointer=function(){this.setCursor("pointer")},t.prototype.move=function(){this.setCursor("move")},t.prototype.crosshair=function(){this.setCursor("crosshair")},t.prototype.wait=function(){this.setCursor("wait")},t.prototype.help=function(){this.setCursor("help")},t.prototype.text=function(){this.setCursor("text")},t.prototype.eResize=function(){this.setCursor("e-resize")},t.prototype.wResize=function(){this.setCursor("w-resize")},t.prototype.nResize=function(){this.setCursor("n-resize")},t.prototype.sResize=function(){this.setCursor("s-resize")},t.prototype.neResize=function(){this.setCursor("ne-resize")},t.prototype.nwResize=function(){this.setCursor("nw-resize")},t.prototype.seResize=function(){this.setCursor("se-resize")},t.prototype.swResize=function(){this.setCursor("sw-resize")},t.prototype.nsResize=function(){this.setCursor("ns-resize")},t.prototype.ewResize=function(){this.setCursor("ew-resize")},t.prototype.zoomIn=function(){this.setCursor("zoom-in")},t.prototype.zoomOut=function(){this.setCursor("zoom-out")},t}(Fe),UDt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.filterView=function(e,i,n){var a=this;e.getScaleByField(i)&&e.filter(i,n),e.views&&e.views.length&&R(e.views,function(o){a.filterView(o,i,n)})},t.prototype.filter=function(){var e=nu(this.context);if(e){var i=this.context.view,n=e.component,a=n.get("field");if(Td(e)){if(a){var o=n.getItemsByState("unchecked"),s=Wc(i,a),l=o.map(function(d){return d.name});l.length?this.filterView(i,a,function(d){var v=s.getText(d);return!l.includes(v)}):this.filterView(i,a,null),i.render(!0)}}else if(dk(e)){var u=n.getValue(),c=lt(u,2),h=c[0],f=c[1];this.filterView(i,a,function(d){return d>=h&&d<=f}),i.render(!0)}}},t}(Fe);function VO(r,t,e,i){var n=Math.min(e[t],i[t]),a=Math.max(e[t],i[t]),o=lt(r.range,2),s=o[0],l=o[1];if(n<s&&(n=s),a>l&&(a=l),n===l&&a===l)return null;var u=r.invert(n),c=r.invert(a);if(r.isCategory){var h=r.values.indexOf(u),f=r.values.indexOf(c),d=r.values.slice(h,f+1);return function(v){return d.includes(v)}}else return function(v){return v>=u&&v<=c}}var Ii;(function(r){r.FILTER="brush-filter-processing",r.RESET="brush-filter-reset",r.BEFORE_FILTER="brush-filter:beforefilter",r.AFTER_FILTER="brush-filter:afterfilter",r.BEFORE_RESET="brush-filter:beforereset",r.AFTER_RESET="brush-filter:afterreset"})(Ii||(Ii={}));var Cy=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.dims=["x","y"],e.startPoint=null,e.isStarted=!1,e}return t.prototype.hasDim=function(e){return this.dims.includes(e)},t.prototype.start=function(){var e=this.context;this.isStarted=!0,this.startPoint=e.getCurrentPoint()},t.prototype.filter=function(){var e,i;if(bd(this.context)){var n=this.context.event.target,a=n.getCanvasBBox();e={x:a.x,y:a.y},i={x:a.maxX,y:a.maxY}}else{if(!this.isStarted)return;e=this.startPoint,i=this.context.getCurrentPoint()}if(!(Math.abs(e.x-i.x)<5||Math.abs(e.x-i.y)<5)){var o=this.context,s=o.view,l=o.event,u={view:s,event:l,dims:this.dims};s.emit(Ii.BEFORE_FILTER,He.fromData(s,Ii.BEFORE_FILTER,u));var c=s.getCoordinate(),h=c.invert(i),f=c.invert(e);if(this.hasDim("x")){var d=s.getXScale(),v=VO(d,"x",h,f);this.filterView(s,d.field,v)}if(this.hasDim("y")){var p=s.getYScales()[0],v=VO(p,"y",h,f);this.filterView(s,p.field,v)}this.reRender(s,{source:Ii.FILTER}),s.emit(Ii.AFTER_FILTER,He.fromData(s,Ii.AFTER_FILTER,u))}},t.prototype.end=function(){this.isStarted=!1},t.prototype.reset=function(){var e=this.context.view;if(e.emit(Ii.BEFORE_RESET,He.fromData(e,Ii.BEFORE_RESET,{})),this.isStarted=!1,this.hasDim("x")){var i=e.getXScale();this.filterView(e,i.field,null)}if(this.hasDim("y")){var n=e.getYScales()[0];this.filterView(e,n.field,null)}this.reRender(e,{source:Ii.RESET}),e.emit(Ii.AFTER_RESET,He.fromData(e,Ii.AFTER_RESET,{}))},t.prototype.filterView=function(e,i,n){e.filter(i,n)},t.prototype.reRender=function(e,i){e.render(!0,i)},t}(Fe),HT=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.filterView=function(e,i,n){var a=Za(e);R(a,function(o){o.filter(i,n)})},t.prototype.reRender=function(e){var i=Za(e);R(i,function(n){n.render(!0)})},t}(Cy),zDt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.filter=function(){var e=nu(this.context),i=this.context.view,n=kr(i);if(bd(this.context)){var a=dT(this.context,10);a&&R(n,function(p){a.includes(p)?p.show():p.hide()})}else if(e){var o=e.component,s=o.get("field");if(Td(e)){if(s){var l=o.getItemsByState("unchecked"),u=Wc(i,s),c=l.map(function(p){return p.name});R(n,function(p){var g=Aa(p,s),m=u.getText(g);c.indexOf(m)>=0?p.hide():p.show()})}}else if(dk(e)){var h=o.getValue(),f=lt(h,2),d=f[0],v=f[1];R(n,function(p){var g=Aa(p,s);g>=d&&g<=v?p.show():p.hide()})}}},t.prototype.clear=function(){var e=kr(this.context.view);R(e,function(i){i.show()})},t.prototype.reset=function(){this.clear()},t}(Fe),xU=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.byRecord=!1,e}return t.prototype.filter=function(){bd(this.context)&&(this.byRecord?this.filterByRecord():this.filterByBBox())},t.prototype.filterByRecord=function(){var e=this.context.view,i=dT(this.context,10);if(i){var n=e.getXScale().field,a=e.getYScales()[0].field,o=i.map(function(l){return l.getModel().data}),s=Za(e);R(s,function(l){var u=kr(l);R(u,function(c){var h=c.getModel().data;_k(o,h,n,a)?c.show():c.hide()})})}},t.prototype.filterByBBox=function(){var e=this,i=this.context.view,n=Za(i);R(n,function(a){var o=vk(e.context,a,10),s=kr(a);o&&R(s,function(l){o.includes(l)?l.show():l.hide()})})},t.prototype.reset=function(){var e=Za(this.context.view);R(e,function(i){var n=kr(i);R(n,function(a){a.show()})})},t}(Fe),HDt=10,$Dt=5,WDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.buttonGroup=null,e.buttonCfg={name:"button",text:"button",textStyle:{x:0,y:0,fontSize:12,fill:"#333333",cursor:"pointer"},padding:[8,10],style:{fill:"#f7f7f7",stroke:"#cccccc",cursor:"pointer"},activeStyle:{fill:"#e6e6e6"}},e}return t.prototype.getButtonCfg=function(){return nt(this.buttonCfg,this.cfg)},t.prototype.drawButton=function(){var e=this.getButtonCfg(),i=this.context.view.foregroundGroup.addGroup({name:e.name}),n=i.addShape({type:"text",name:"button-text",attrs:S({text:e.text},e.textStyle)}),a=n.getBBox(),o=gT(e.padding),s=i.addShape({type:"rect",name:"button-rect",attrs:S({x:a.x-o[3],y:a.y-o[0],width:a.width+o[1]+o[3],height:a.height+o[0]+o[2]},e.style)});s.toBack(),i.on("mouseenter",function(){s.attr(e.activeStyle)}),i.on("mouseleave",function(){s.attr(e.style)}),this.buttonGroup=i},t.prototype.resetPosition=function(){var e=this.context.view,i=e.getCoordinate(),n=i.convert({x:1,y:1}),a=this.buttonGroup,o=a.getBBox(),s=hr(null,[["t",n.x-o.width-HDt,n.y+o.height+$Dt]]);a.setMatrix(s)},t.prototype.show=function(){this.buttonGroup||this.drawButton(),this.resetPosition(),this.buttonGroup.show()},t.prototype.hide=function(){this.buttonGroup&&this.buttonGroup.hide()},t.prototype.destroy=function(){var e=this.buttonGroup;e&&e.remove(),r.prototype.destroy.call(this)},t}(Fe),VDt=4,GDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.starting=!1,e.dragStart=!1,e}return t.prototype.start=function(){this.starting=!0,this.startPoint=this.context.getCurrentPoint()},t.prototype.drag=function(){if(this.startPoint){var e=this.context.getCurrentPoint(),i=this.context.view,n=this.context.event;this.dragStart?i.emit("drag",{target:n.target,x:n.x,y:n.y}):vT(e,this.startPoint)>VDt&&(i.emit("dragstart",{target:n.target,x:n.x,y:n.y}),this.dragStart=!0)}},t.prototype.end=function(){if(this.dragStart){var e=this.context.view,i=this.context.event;e.emit("dragend",{target:i.target,x:i.x,y:i.y})}this.starting=!1,this.dragStart=!1},t}(Fe),XDt=5,YDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.starting=!1,e.isMoving=!1,e.startPoint=null,e.startMatrix=null,e}return t.prototype.start=function(){this.starting=!0,this.startPoint=this.context.getCurrentPoint(),this.startMatrix=this.context.view.middleGroup.getMatrix()},t.prototype.move=function(){if(this.starting){var e=this.startPoint,i=this.context.getCurrentPoint(),n=vT(e,i);if(n>XDt&&!this.isMoving&&(this.isMoving=!0),this.isMoving){var a=this.context.view,o=hr(this.startMatrix,[["t",i.x-e.x,i.y-e.y]]);a.backgroundGroup.setMatrix(o),a.foregroundGroup.setMatrix(o),a.middleGroup.setMatrix(o)}}},t.prototype.end=function(){this.isMoving&&(this.isMoving=!1),this.startMatrix=null,this.starting=!1,this.startPoint=null},t.prototype.reset=function(){this.starting=!1,this.startPoint=null,this.isMoving=!1;var e=this.context.view;e.backgroundGroup.resetMatrix(),e.foregroundGroup.resetMatrix(),e.middleGroup.resetMatrix(),this.isMoving=!1},t}(Fe),GO="x",XO="y",CU=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.dims=[GO,XO],e.cfgFields=["dims"],e.cacheScaleDefs={},e}return t.prototype.hasDim=function(e){return this.dims.includes(e)},t.prototype.getScale=function(e){var i=this.context.view;return e==="x"?i.getXScale():i.getYScales()[0]},t.prototype.resetDim=function(e){var i=this.context.view;if(this.hasDim(e)&&this.cacheScaleDefs[e]){var n=this.getScale(e);i.scale(n.field,this.cacheScaleDefs[e]),this.cacheScaleDefs[e]=null}},t.prototype.reset=function(){this.resetDim(GO),this.resetDim(XO);var e=this.context.view;e.render(!0)},t}(Fe),jDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.startPoint=null,e.starting=!1,e.startCache={},e}return t.prototype.start=function(){var e=this;this.startPoint=this.context.getCurrentPoint(),this.starting=!0;var i=this.dims;R(i,function(n){var a=e.getScale(n),o=a.min,s=a.max,l=a.values;e.startCache[n]={min:o,max:s,values:l}})},t.prototype.end=function(){this.startPoint=null,this.starting=!1,this.startCache={}},t.prototype.translate=function(){var e=this;if(this.starting){var i=this.startPoint,n=this.context.view.getCoordinate(),a=this.context.getCurrentPoint(),o=n.invert(i),s=n.invert(a),l=s.x-o.x,u=s.y-o.y,c=this.context.view,h=this.dims;R(h,function(f){e.translateDim(f,{x:l*-1,y:u*-1})}),c.render(!0)}},t.prototype.translateDim=function(e,i){if(this.hasDim(e)){var n=this.getScale(e);n.isLinear&&this.translateLinear(e,n,i)}},t.prototype.translateLinear=function(e,i,n){var a=this.context.view,o=this.startCache[e],s=o.min,l=o.max,u=l-s,c=n[e]*u;this.cacheScaleDefs[e]||(this.cacheScaleDefs[e]={nice:i.nice,min:s,max:l}),a.scale(i.field,{nice:!1,min:s+c,max:l+c})},t.prototype.reset=function(){r.prototype.reset.call(this),this.startPoint=null,this.starting=!1},t}(CU),ZDt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.zoomRatio=.05,e}return t.prototype.zoomIn=function(){this.zoom(this.zoomRatio)},t.prototype.zoom=function(e){var i=this,n=this.dims;R(n,function(a){i.zoomDim(a,e)}),this.context.view.render(!0)},t.prototype.zoomOut=function(){this.zoom(-1*this.zoomRatio)},t.prototype.zoomDim=function(e,i){if(this.hasDim(e)){var n=this.getScale(e);n.isLinear&&this.zoomLinear(e,n,i)}},t.prototype.zoomLinear=function(e,i,n){var a=this.context.view;this.cacheScaleDefs[e]||(this.cacheScaleDefs[e]={nice:i.nice,min:i.min,max:i.max});var o=this.cacheScaleDefs[e],s=o.max-o.min,l=i.min,u=i.max,c=n*s,h=l-c,f=u+c,d=f-h,v=d/s;f>h&&v<100&&v>.01&&a.scale(i.field,{nice:!1,min:l-c,max:u+c})},t}(CU);function qDt(r){var t=r.gEvent.originalEvent;return t.deltaY>0}var KDt=1,QDt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.scroll=function(e){var i=this.context,n=i.view,a=i.event;if(n.getOptions().scrollbar){var o=(e==null?void 0:e.wheelDelta)||KDt,s=n.getController("scrollbar"),l=n.getXScale(),u=n.getOptions().data,c=Tr(xa(u,l.field)),h=Tr(l.values),f=s.getValue(),d=Math.floor((c-h)*f),v=d+(qDt(a)?o:-o),p=o/(c-h)/1e4,g=Be(v/(c-h)+p,0,1);s.setValue(g)}},t}(Fe),JDt="aixs-description-tooltip",t5t=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.show=function(){var e=this.context,i=nu(e).axis,n=i.cfg.title,a=n.description,o=n.text,s=n.descriptionTooltipStyle,l=e.event,u=l.x,c=l.y;this.tooltip||this.renderTooltip(),this.tooltip.update({title:o||"",customContent:function(){return`
          <div class="`.concat(Uo,'" style={').concat(s,`}>
            <div class="`).concat(zo,`">
              字段说明：`).concat(a,`
            </div>
          </div>
        `)},x:u,y:c}),this.tooltip.show()},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},t.prototype.hide=function(){this.tooltip&&this.tooltip.hide()},t.prototype.renderTooltip=function(){var e,i=this.context.view,n=i.canvas,a={start:{x:0,y:0},end:{x:n.get("width"),y:n.get("height")}},o=new hy({parent:n.get("el").parentNode,region:a,visible:!1,containerId:JDt,domStyles:S({},nt({},(e={},e[Uo]={"max-width":"50%",padding:"10px","line-height":"15px","font-size":"12px",color:"rgba(0, 0, 0, .65)"},e[zo]={"word-break":"break-all","margin-bottom":"3px"},e)))});o.init(),o.setCapture(!1),this.tooltip=o},t}(Fe);qOt("dark",Ck(NPt));g8("canvas",Lat);g8("svg",gFt);fo("Polygon",IFt);fo("Interval",TFt);fo("Schema",LFt);fo("Path",ST);fo("Point",RFt);fo("Line",bFt);fo("Area",yFt);fo("Edge",_Ft);fo("Heatmap",xFt);fo("Violin",PFt);vv("base",yy);vv("interval",ZFt);vv("pie",qFt);vv("polar",tU);Qi("overlap",cBt);Qi("distribute",QFt);Qi("fixed-overlap",uBt);Qi("hide-overlap",xBt);Qi("limit-in-shape",aBt);Qi("limit-in-canvas",nBt);Qi("limit-in-plot",NBt);Qi("pie-outer",tBt);Qi("adjust-color",EBt);Qi("interval-adjust-position",bBt);Qi("interval-hide-overlap",RBt);Qi("point-adjust-position",LBt);Qi("pie-spider",iBt);Qi("path-adjust-position",FBt);En("fade-in",kBt);En("fade-out",UBt);En("grow-in-x",HBt);En("grow-in-xy",WBt);En("grow-in-y",$Bt);En("scale-in-x",XBt);En("scale-in-y",YBt);En("wave-in",ZBt);En("zoom-in",qBt);En("zoom-out",KBt);En("position-update",GBt);En("sector-path-update",jBt);En("path-in",VBt);vh("rect",rDt);vh("mirror",eDt);vh("list",JBt);vh("matrix",tDt);vh("circle",QBt);vh("tree",iDt);Cu("axis",oDt);Cu("legend",sDt);Cu("tooltip",bk);Cu("annotation",aDt);Cu("slider",lDt);Cu("scrollbar",hDt);xt("tooltip",aU);xt("sibling-tooltip",pDt);xt("ellipsis-text",gDt);xt("element-active",mDt);xt("element-single-active",xDt);xt("element-range-active",_Dt);xt("element-highlight",BT);xt("element-highlight-by-x",EDt);xt("element-highlight-by-color",CDt);xt("element-single-highlight",SDt);xt("element-range-highlight",sU);xt("element-sibling-highlight",sU,{effectSiblings:!0,effectByRecord:!0});xt("element-selected",TDt);xt("element-single-selected",bDt);xt("element-range-selected",ADt);xt("element-link-by-color",yDt);xt("active-region",vDt);xt("list-active",wDt);xt("list-selected",MDt);xt("list-highlight",DT);xt("list-unchecked",IDt);xt("list-checked",LDt);xt("list-focus",ODt);xt("list-radio",PDt);xt("legend-item-highlight",DT,{componentNames:["legend"]});xt("axis-label-highlight",DT,{componentNames:["axis"]});xt("axis-description",t5t);xt("rect-mask",hU);xt("x-rect-mask",dU,{dim:"x"});xt("y-rect-mask",dU,{dim:"y"});xt("circle-mask",FDt);xt("path-mask",pU);xt("smooth-path-mask",BDt);xt("rect-multi-mask",mU);xt("x-rect-multi-mask",yU,{dim:"x"});xt("y-rect-multi-mask",yU,{dim:"y"});xt("circle-multi-mask",DDt);xt("path-multi-mask",_U);xt("smooth-path-multi-mask",NDt);xt("cursor",kDt);xt("data-filter",UDt);xt("brush",Cy);xt("brush-x",Cy,{dims:["x"]});xt("brush-y",Cy,{dims:["y"]});xt("sibling-filter",HT);xt("sibling-x-filter",HT,{dims:"x"});xt("sibling-y-filter",HT,{dims:"y"});xt("element-filter",zDt);xt("element-sibling-filter",xU);xt("element-sibling-filter-record",xU,{byRecord:!0});xt("view-drag",GDt);xt("view-move",YDt);xt("scale-translate",jDt);xt("scale-zoom",ZDt);xt("reset-button",WDt,{name:"reset-button",text:"reset"});xt("mousewheel-scroll",QDt);function Bo(r){return r.isInPlot()}Ot("tooltip",{start:[{trigger:"plot:mousemove",action:"tooltip:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"plot:touchmove",action:"tooltip:show",throttle:{wait:50,leading:!0,trailing:!1}}],end:[{trigger:"plot:mouseleave",action:"tooltip:hide"},{trigger:"plot:leave",action:"tooltip:hide"},{trigger:"plot:touchend",action:"tooltip:hide"}]});Ot("ellipsis-text",{start:[{trigger:"legend-item-name:mousemove",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"legend-item-name:touchstart",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"axis-label:mousemove",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"axis-label:touchstart",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}}],end:[{trigger:"legend-item-name:mouseleave",action:"ellipsis-text:hide"},{trigger:"legend-item-name:touchend",action:"ellipsis-text:hide"},{trigger:"axis-label:mouseleave",action:"ellipsis-text:hide"},{trigger:"axis-label:mouseout",action:"ellipsis-text:hide"},{trigger:"axis-label:touchend",action:"ellipsis-text:hide"}]});Ot("element-active",{start:[{trigger:"element:mouseenter",action:"element-active:active"}],end:[{trigger:"element:mouseleave",action:"element-active:reset"}]});Ot("element-selected",{start:[{trigger:"element:click",action:"element-selected:toggle"}]});Ot("element-highlight",{start:[{trigger:"element:mouseenter",action:"element-highlight:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight:reset"}]});Ot("element-highlight-by-x",{start:[{trigger:"element:mouseenter",action:"element-highlight-by-x:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight-by-x:reset"}]});Ot("element-highlight-by-color",{start:[{trigger:"element:mouseenter",action:"element-highlight-by-color:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight-by-color:reset"}]});Ot("legend-active",{start:[{trigger:"legend-item:mouseenter",action:["list-active:active","element-active:active"]}],end:[{trigger:"legend-item:mouseleave",action:["list-active:reset","element-active:reset"]}]});Ot("legend-highlight",{start:[{trigger:"legend-item:mouseenter",action:["legend-item-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"legend-item:mouseleave",action:["legend-item-highlight:reset","element-highlight:reset"]}]});Ot("axis-label-highlight",{start:[{trigger:"axis-label:mouseenter",action:["axis-label-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"axis-label:mouseleave",action:["axis-label-highlight:reset","element-highlight:reset"]}]});Ot("element-list-highlight",{start:[{trigger:"element:mouseenter",action:["list-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"element:mouseleave",action:["list-highlight:reset","element-highlight:reset"]}]});Ot("element-range-highlight",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"mask:mouseenter",action:"cursor:move"},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:function(r){return!r.isInShape("mask")},action:["rect-mask:start","rect-mask:show"]},{trigger:"mask:dragstart",action:["rect-mask:moveStart"]}],processing:[{trigger:"plot:mousemove",action:["rect-mask:resize"]},{trigger:"mask:drag",action:["rect-mask:move"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["rect-mask:end"]},{trigger:"mask:dragend",action:["rect-mask:moveEnd"]},{trigger:"document:mouseup",isEnable:function(r){return!r.isInPlot()},action:["element-range-highlight:clear","rect-mask:end","rect-mask:hide"]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","rect-mask:hide"]}]});Ot("brush",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:Bo,action:["brush:start","rect-mask:start","rect-mask:show"]}],processing:[{trigger:"mousemove",isEnable:Bo,action:["rect-mask:resize"]}],end:[{trigger:"mouseup",isEnable:Bo,action:["brush:filter","brush:end","rect-mask:end","rect-mask:hide","reset-button:show"]}],rollback:[{trigger:"reset-button:click",action:["brush:reset","reset-button:hide","cursor:crosshair"]}]});Ot("brush-visible",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"plot:mousedown",action:["rect-mask:start","rect-mask:show"]}],processing:[{trigger:"plot:mousemove",action:["rect-mask:resize"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["rect-mask:end","rect-mask:hide","element-filter:filter","element-range-highlight:clear"]}],rollback:[{trigger:"dblclick",action:["element-filter:clear"]}]});Ot("brush-x",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:Bo,action:["brush-x:start","x-rect-mask:start","x-rect-mask:show"]}],processing:[{trigger:"mousemove",isEnable:Bo,action:["x-rect-mask:resize"]}],end:[{trigger:"mouseup",isEnable:Bo,action:["brush-x:filter","brush-x:end","x-rect-mask:end","x-rect-mask:hide"]}],rollback:[{trigger:"dblclick",action:["brush-x:reset"]}]});Ot("element-path-highlight",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:Bo,action:"path-mask:start"},{trigger:"mousedown",isEnable:Bo,action:"path-mask:show"}],processing:[{trigger:"mousemove",action:"path-mask:addPoint"}],end:[{trigger:"mouseup",action:"path-mask:end"}],rollback:[{trigger:"dblclick",action:"path-mask:hide"}]});Ot("brush-x-multi",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"mask:mouseenter",action:"cursor:move"},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"mousedown",isEnable:Bo,action:["x-rect-multi-mask:start","x-rect-multi-mask:show"]},{trigger:"mask:dragstart",action:["x-rect-multi-mask:moveStart"]}],processing:[{trigger:"mousemove",isEnable:function(r){return!vy(r)},action:["x-rect-multi-mask:resize"]},{trigger:"multi-mask:change",action:"element-range-highlight:highlight"},{trigger:"mask:drag",action:["x-rect-multi-mask:move"]}],end:[{trigger:"mouseup",action:["x-rect-multi-mask:end"]},{trigger:"mask:dragend",action:["x-rect-multi-mask:moveEnd"]}],rollback:[{trigger:"dblclick",action:["x-rect-multi-mask:clear","cursor:crosshair"]},{trigger:"multi-mask:clearAll",action:["element-range-highlight:clear"]},{trigger:"multi-mask:clearSingle",action:["element-range-highlight:highlight"]}]});Ot("element-single-selected",{start:[{trigger:"element:click",action:"element-single-selected:toggle"}]});Ot("legend-filter",{showEnable:[{trigger:"legend-item:mouseenter",action:["cursor:pointer","list-radio:show"]},{trigger:"legend-item:mouseleave",action:["cursor:default","list-radio:hide"]}],start:[{trigger:"legend-item:click",isEnable:function(r){return!r.isInShape("legend-item-radio")},action:["legend-item-highlight:reset","element-highlight:reset","list-unchecked:toggle","data-filter:filter","list-radio:show"]},{trigger:"legend-item-radio:mouseenter",action:["list-radio:showTip"]},{trigger:"legend-item-radio:mouseleave",action:["list-radio:hideTip"]},{trigger:"legend-item-radio:click",action:["list-focus:toggle","data-filter:filter","list-radio:show"]}]});Ot("continuous-filter",{start:[{trigger:"legend:valuechanged",action:"data-filter:filter"}]});Ot("continuous-visible-filter",{start:[{trigger:"legend:valuechanged",action:"element-filter:filter"}]});Ot("legend-visible-filter",{showEnable:[{trigger:"legend-item:mouseenter",action:"cursor:pointer"},{trigger:"legend-item:mouseleave",action:"cursor:default"}],start:[{trigger:"legend-item:click",action:["legend-item-highlight:reset","element-highlight:reset","list-unchecked:toggle","element-filter:filter"]}]});Ot("active-region",{start:[{trigger:"plot:mousemove",action:"active-region:show"}],end:[{trigger:"plot:mouseleave",action:"active-region:hide"}]});Ot("axis-description",{start:[{trigger:"axis-description:mousemove",action:"axis-description:show"}],end:[{trigger:"axis-description:mouseleave",action:"axis-description:hide"}]});function YO(r){return r.gEvent.preventDefault(),r.gEvent.originalEvent.deltaY>0}Ot("view-zoom",{start:[{trigger:"plot:mousewheel",isEnable:function(r){return YO(r.event)},action:"scale-zoom:zoomOut",throttle:{wait:100,leading:!0,trailing:!1}},{trigger:"plot:mousewheel",isEnable:function(r){return!YO(r.event)},action:"scale-zoom:zoomIn",throttle:{wait:100,leading:!0,trailing:!1}}]});Ot("sibling-tooltip",{start:[{trigger:"plot:mousemove",action:"sibling-tooltip:show"}],end:[{trigger:"plot:mouseleave",action:"sibling-tooltip:hide"}]});Ot("plot-mousewheel-scroll",{start:[{trigger:"plot:mousewheel",action:"mousewheel-scroll:scroll"}]});var zi=["type","alias","tickCount","tickInterval","min","max","nice","minLimit","maxLimit","range","tickMethod","base","exponent","mask","sync"],Ta;(function(r){r.ERROR="error",r.WARN="warn",r.INFO="log"})(Ta||(Ta={}));var e5t="AntV/G2Plot";function r5t(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];var i=0;return"".concat(e5t,": ").concat(r.replace(/%s/g,function(){return"".concat(t[i++])}))}function $o(r,t,e){for(var i=[],n=3;n<arguments.length;n++)i[n-3]=arguments[n];t||console[r](r5t.apply(void 0,_t([e],i,!1)))}function ge(r,t){var e={};return r!==null&&typeof r=="object"&&t.forEach(function(i){var n=r[i];n!==void 0&&(e[i]=n)}),e}function $T(r,t){if(!r)return{};var e=r.filter(function(a){var o=L(a,[t]);return Mt(o)&&!isNaN(o)}),i=e.every(function(a){return L(a,[t])>=0}),n=e.every(function(a){return L(a,[t])<=0});return i?{min:0}:n?{max:0}:{}}function EU(r,t,e,i,n){if(n===void 0&&(n=[]),!Array.isArray(r))return{nodes:[],links:[]};var a=[],o={},s=-1;return r.forEach(function(l){var u=l[t],c=l[e],h=l[i],f=ge(l,n);o[u]||(o[u]=S({id:++s,name:u},f)),o[c]||(o[c]=S({id:++s,name:c},f)),a.push(S({source:o[u].id,target:o[c].id,value:h},f))}),{nodes:Object.values(o).sort(function(l,u){return l.id-u.id}),links:a}}function Gc(r,t){var e=Ur(r,function(i){var n=i[t];return n===null||typeof n=="number"&&!isNaN(n)});return $o(Ta.WARN,e.length===r.length,"illegal data existed in chart data."),e}var i5t=5,n5t={}.toString,SU=function(r,t){return n5t.call(r)==="[object "+t+"]"},a5t=function(r){return SU(r,"Array")},o5t=function(r){return typeof r=="object"&&r!==null},jO=function(r){if(!o5t(r)||!SU(r,"Object"))return!1;for(var t=r;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(r)===t},AU=function(r,t,e,i){e=e||0,i=i||i5t;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var a=t[n];a?jO(a)?(jO(r[n])||(r[n]={}),e<i?AU(r[n],a,e+1,i):r[n]=t[n]):a5t(a)?(r[n]=[],r[n]=r[n].concat(a)):r[n]=a:r[n]=a}},$=function(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];for(var i=0;i<t.length;i+=1)AU(r,t[i]);return r};function kC(r){if(!r)return{width:0,height:0};var t=getComputedStyle(r);return{width:(r.clientWidth||parseInt(t.width,10))-parseInt(t.paddingLeft,10)-parseInt(t.paddingRight,10),height:(r.clientHeight||parseInt(t.height,10))-parseInt(t.paddingTop,10)-parseInt(t.paddingBottom,10)}}function bt(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return function(e){return r.reduce(function(i,n){return n(i)},e)}}function qr(r,t){return r.geometries.find(function(e){return e.type===t})}function I0(r){return oi(r.geometries,function(t,e){return t.concat(e.elements)},[])}function Rd(r){return L(r,["views","length"],0)<=0?I0(r):oi(r.views,function(t,e){return t.concat(Rd(e))},I0(r))}function s5t(r){return L(r,["views","length"],0)<=0?r.geometries:oi(r.views,function(t,e){return t.concat(e.geometries)},r.geometries)}function ZO(r){if(!r)return r;var t=r.match(/(([A-Z]{0,1}[a-z]*[^A-Z])|([A-Z]{1}))/g);return t.map(function(e){return e.toLowerCase()}).join("-")}function Mr(r){if(!Ws(r,"Object"))return r;var t=S({},r);return t.formatter&&!t.content&&(t.content=t.formatter),t}var K_;function l5t(){return K_||(K_=document.createElement("canvas").getContext("2d")),K_}Qc(function(r,t){t===void 0&&(t={});var e=t.fontSize,i=t.fontFamily,n=i===void 0?"sans-serif":i,a=t.fontWeight,o=t.fontStyle,s=t.fontVariant,l=l5t();l.font=[o,a,s,"".concat(e,"px"),n].join(" ");var u=l.measureText(mt(r)?r:"");return u.width},function(r,t){return t===void 0&&(t={}),_t([r],K0(t),!0).join("")});function ou(r){return typeof r=="number"&&!isNaN(r)}function u5t(r,t,e){var i=Math.min(t,e),n=Math.max(t,e);return r>=i&&r<=n}function Us(r){if(Mt(r))return[r,r,r,r];if(Z(r)){var t=r.length;if(t===1)return[r[0],r[0],r[0],r[0]];if(t===2)return[r[0],r[1],r[0],r[1]];if(t===3)return[r[0],r[1],r[2],r[1]];if(t===4)return r}return[0,0,0,0]}function Ey(r,t,e){t===void 0&&(t="bottom"),e===void 0&&(e=25);var i=Us(r),n=[t.startsWith("top")?e:0,t.startsWith("right")?e:0,t.startsWith("bottom")?e:0,t.startsWith("left")?e:0];return[i[0]+n[0],i[1]+n[1],i[2]+n[2],i[3]+n[3]]}function WT(r){var t=r.map(function(i){return Us(i)}),e=[0,0,0,0];return t.length>0&&(e=e.map(function(i,n){return t.forEach(function(a,o){i+=t[o][n]}),i})),e}function c5t(r,t){var e=[];if(r.length){e.push(["M",r[0].x,r[0].y]);for(var i=1,n=r.length;i<n;i+=1){var a=r[i];e.push(["L",a.x,a.y])}t&&e.push(["Z"])}return e}var h5t=function(r,t,e,i){var n=[],a,o,s=!!i,l,u;if(s){l=[1/0,1/0],u=[-1/0,-1/0];for(var c=0,h=r.length;c<h;c++){var f=r[c];l=Pr([0,0],l,f),u=Fr([0,0],u,f)}l=Pr([0,0],l,i[0]),u=Fr([0,0],u,i[1])}for(var c=0,d=r.length;c<d;c++){var f=r[c];if(e)a=r[c?c-1:d-1],o=r[(c+1)%d];else if(c===0||c===d-1){n.push(f);continue}else a=r[c-1],o=r[c+1];var v=[0,0];v=Io(v,o,a),v=_i(v,v,t);var p=_c(f,a),g=_c(f,o),m=p+g;m!==0&&(p/=m,g/=m);var y=_i([0,0],v,-p),_=_i([0,0],v,g),x=ri([0,0],f,y),C=ri([0,0],f,_);s&&(x=Fr([0,0],x,l),x=Pr([0,0],x,u),C=Fr([0,0],C,l),C=Pr([0,0],C,u)),n.push(x),n.push(C)}return e&&n.push(n.shift()),n};function f5t(r,t,e){for(var i=!!t,n=[],a=0,o=r.length;a<o;a+=2)n.push([r[a],r[a+1]]);for(var s=h5t(n,.4,i,e),l=n.length,u=[],c,h,f,a=0;a<l-1;a++)c=s[a*2],h=s[a*2+1],f=n[a+1],u.push(["C",c[0],c[1],h[0],h[1],f[0],f[1]]);return i&&(c=s[l],h=s[l+1],f=n[0],u.push(["C",c[0],c[1],h[0],h[1],f[0],f[1]])),u}function d5t(r,t,e){var i=[],n=r[0],a=null;if(r.length<=2)return c5t(r,t);for(var o=0,s=r.length;o<s;o++){var l=r[o];(!a||!(a.x===l.x&&a.y===l.y))&&(i.push(l.x),i.push(l.y),a=l)}var u=e||[[0,0],[1,1]],c=f5t(i,t,u);return c.unshift(["M",n.x,n.y]),c}function TU(r){var t={overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",display:"flex",justifyContent:"center",alignItems:"center"},e=["stroke","lineWidth","shadowColor","strokeOpacity","shadowBlur","shadowOffsetX","shadowOffsetY","fill"];L(r,"fill")&&(t.color=r.fill);var i=ge(r,e),n=i.shadowColor,a=i.shadowBlur,o=a===void 0?0:a,s=i.shadowOffsetX,l=s===void 0?0:s,u=i.shadowOffsetY,c=u===void 0?0:u;t["text-shadow"]="".concat([n,"".concat(l,"px"),"".concat(c,"px"),"".concat(o,"px")].join(" "));var h=ge(r,e),f=h.stroke,d=h.lineWidth,v=d===void 0?0:d;return t["-webkit-text-stroke"]="".concat(["".concat(v,"px"),f].join(" ")),R(r,function(p,g){["fontSize"].includes(g)&&Mt(p)?t[ZO(g)]="".concat(p,"px"):g&&!e.includes(g)&&(t[ZO(g)]="".concat(p))}),t}function bU(r,t){r.style["pointer-events"]="none",R(t,function(e,i){i&&e&&(r.style[i]=e)})}var Sy=function(r,t,e){var i=t.statistic,n=t.plotType,a=i.title,o=i.content;[a,o].forEach(function(s,l){if(s){var u="";l===0?u=o?"translate(-50%, -100%)":"translate(-50%, -50%)":u=a?"translate(-50%, 0)":"translate(-50%, -50%)";var c=ut(s.style)?s.style(e):s.style;r.annotation().html(S({position:["50%","50%"],html:function(h,f){var d=f.getCoordinate(),v=0;if(n==="pie"||n==="ring-progress")v=d.getRadius()*d.innerRadius*2;else if(n==="liquid"){var p=L(f.geometries,[0,"elements",0,"shape"]);if(p){var g=p.find(function(x){return x.get("name")==="wrap"}),m=g.getCanvasBBox().width;v=m}}else v||(v=d.getWidth());bU(h,S({width:"".concat(v,"px"),transform:u},TU(c)));var y=f.getData();if(s.customHtml)return s.customHtml(h,f,e,y);var _=s.content;return s.formatter&&(_=s.formatter(e,y)),_?mt(_)?_:"".concat(_):"<div></div>"},key:"".concat(l===0?"top":"bottom","-statistic")},ge(s,["offsetX","offsetY","rotate","style","formatter"])))}})},v5t=function(r,t,e){var i=t.statistic,n=i.title,a=i.content;[n,a].forEach(function(o){if(o){var s=ut(o.style)?o.style(e):o.style;r.annotation().html(S({position:["50%","100%"],html:function(l,u){var c=u.getCoordinate(),h=u.views[0].getCoordinate(),f=h.getCenter(),d=h.getRadius(),v=Math.max(Math.sin(h.startAngle),Math.sin(h.endAngle))*d,p=f.y+v-c.y.start-parseFloat(L(s,"fontSize",0)),g=c.getRadius()*c.innerRadius*2;bU(l,S({width:"".concat(g,"px"),transform:"translate(-50%, ".concat(p,"px)")},TU(s)));var m=u.getData();if(o.customHtml)return o.customHtml(l,u,e,m);var y=o.content;return o.formatter&&(y=o.formatter(e,m)),y?mt(y)?y:"".concat(y):"<div></div>"}},ge(o,["offsetX","offsetY","rotate","style","formatter"])))}})};function wU(r,t){return t?oi(t,function(e,i,n){return e.replace(new RegExp("{\\s*".concat(n,"\\s*}"),"g"),i)},r):r}function zt(r,t){return r.views.find(function(e){return e.id===t})}function hf(r){var t=r.parent;return t?t.views:[]}function qO(r){return hf(r).filter(function(t){return t!==r})}function mv(r,t,e){e===void 0&&(e=r.geometries),typeof t=="boolean"?r.animate(t):r.animate(!0),R(e,function(i){var n;ut(t)?n=t(i.type||i.shapeType,i)||!0:n=t,i.animate(n)})}function Ay(){return typeof window=="object"?window==null?void 0:window.devicePixelRatio:2}function VT(r,t){t===void 0&&(t=r);var e=document.createElement("canvas"),i=Ay();e.width=r*i,e.height=t*i,e.style.width="".concat(r,"px"),e.style.height="".concat(t,"px");var n=e.getContext("2d");return n.scale(i,i),e}function GT(r,t,e,i){i===void 0&&(i=e);var n=t.backgroundColor,a=t.opacity;r.globalAlpha=a,r.fillStyle=n,r.beginPath(),r.fillRect(0,0,e,i),r.closePath()}function RU(r,t,e){var i=r+t;return e?i*2:i}function MU(r,t){var e=t?[[r*.25,r*.25],[r*.75,r*.75]]:[[r*.5,r*.5]];return e}function XT(r,t){var e=t*Math.PI/180,i={a:Math.cos(e)*(1/r),b:Math.sin(e)*(1/r),c:-Math.sin(e)*(1/r),d:Math.cos(e)*(1/r),e:0,f:0};return i}var p5t={size:6,padding:2,backgroundColor:"transparent",opacity:1,rotation:0,fill:"#fff",fillOpacity:.5,stroke:"transparent",lineWidth:0,isStagger:!0};function g5t(r,t,e,i){var n=t.size,a=t.fill,o=t.lineWidth,s=t.stroke,l=t.fillOpacity;r.beginPath(),r.globalAlpha=l,r.fillStyle=a,r.strokeStyle=s,r.lineWidth=o,r.arc(e,i,n/2,0,2*Math.PI,!1),r.fill(),o&&r.stroke(),r.closePath()}function m5t(r){var t=$({},p5t,r),e=t.size,i=t.padding,n=t.isStagger,a=t.rotation,o=RU(e,i,n),s=MU(o,n),l=VT(o,o),u=l.getContext("2d");GT(u,t,o);for(var c=0,h=s;c<h.length;c++){var f=h[c],d=f[0],v=f[1];g5t(u,t,d,v)}var p=u.createPattern(l,"repeat");if(p){var g=Ay(),m=XT(g,a);p.setTransform(m)}return p}var y5t={rotation:45,spacing:5,opacity:1,backgroundColor:"transparent",strokeOpacity:.5,stroke:"#fff",lineWidth:2};function _5t(r,t,e){var i=t.stroke,n=t.lineWidth,a=t.strokeOpacity,o=new Path2D(e);r.globalAlpha=a,r.lineCap="square",r.strokeStyle=n?i:"transparent",r.lineWidth=n,r.stroke(o)}function x5t(r){var t=$({},y5t,r),e=t.spacing,i=t.rotation,n=t.lineWidth,a=e+n||1,o=e+n||1,s=`
            M 0 0 L `.concat(a,` 0
            M 0 `).concat(o," L ").concat(a," ").concat(o,`
            `),l=VT(a,o),u=l.getContext("2d");GT(u,t,a,o),_5t(u,t,s);var c=u.createPattern(l,"repeat");if(c){var h=Ay(),f=XT(h,i);c.setTransform(f)}return c}var C5t={size:6,padding:1,isStagger:!0,backgroundColor:"transparent",opacity:1,rotation:0,fill:"#fff",fillOpacity:.5,stroke:"transparent",lineWidth:0};function E5t(r,t,e,i){var n=t.stroke,a=t.size,o=t.fill,s=t.lineWidth,l=t.fillOpacity;r.globalAlpha=l,r.strokeStyle=n,r.lineWidth=s,r.fillStyle=o,r.strokeRect(e-a/2,i-a/2,a,a),r.fillRect(e-a/2,i-a/2,a,a)}function S5t(r){var t=$({},C5t,r),e=t.size,i=t.padding,n=t.isStagger,a=t.rotation,o=RU(e,i,n),s=MU(o,n),l=VT(o,o),u=l.getContext("2d");GT(u,t,o);for(var c=0,h=s;c<h.length;c++){var f=h[c],d=f[0],v=f[1];E5t(u,t,d,v)}var p=u.createPattern(l,"repeat");if(p){var g=Ay(),m=XT(g,a);p.setTransform(m)}return p}function A5t(r){var t=r.type,e=r.cfg,i;switch(t){case"dot":i=m5t(e);break;case"line":i=x5t(e);break;case"square":i=S5t(e);break}return i}function Sn(r){var t=this;return function(e){var i,n=e.options,a=e.chart,o=n.pattern;if(!o)return e;var s=function(l){for(var u,c,h,f=[],d=1;d<arguments.length;d++)f[d-1]=arguments[d];var v=a.getTheme().defaultColor,p=v,g=(c=(u=a.geometries)===null||u===void 0?void 0:u[0])===null||c===void 0?void 0:c.getAttribute("color");if(g){var m=g.getFields()[0],y=L(l,m);p=Zi.getMappingValue(g,y,((h=g.values)===null||h===void 0?void 0:h[0])||v)}var _=o;typeof o=="function"&&(_=o.call(t,l,p)),_ instanceof CanvasPattern||(_=A5t($({},{cfg:{backgroundColor:p}},_)));var x=n[r];return S(S({},typeof x=="function"?x.call.apply(x,_t([t,l],f,!1)):x||{}),{fill:_||p})};return $({},e,{options:(i={},i[r]=s,i)})}}function gh(r){var t=r.chart,e=r.options,i=e.legend,n=e.colorField,a=e.seriesField;return i===!1?t.legend(!1):(n||a)&&t.legend(n||a,i),r}function yr(r){var t=r.chart,e=r.options,i=e.tooltip;return i!==void 0&&t.tooltip(i),r}function Ue(r){var t=r.chart,e=r.options,i=e.interactions;return R(i,function(n){n.enable===!1?t.removeInteraction(n.type):t.interaction(n.type,n.cfg||{})}),r}function xe(r){var t=r.chart,e=r.options,i=e.animation;return mv(t,i),r}function ae(r){var t=r.chart,e=r.options,i=e.theme;return i&&t.theme(i),r}function Js(r){var t=r.chart,e=r.options,i=e.state;return i&&R(t.geometries,function(n){n.state(i)}),r}function yv(r){var t=r.chart,e=r.options,i=e.slider;return t.option("slider",i),r}function YT(r){var t=r.chart,e=r.options,i=e.scrollbar;return t.option("scrollbar",i),r}function Je(r,t){return function(e){var i=e.chart,n=e.options,a={};return R(r,function(o,s){a[s]=ge(o,zi)}),a=$({},t,n.meta,a),i.scale(a),e}}function $e(r){return function(t){var e=t.chart,i=t.options,n=e.getController("annotation");return R(_t(_t([],i.annotations||[],!0),r||[],!0),function(a){n.annotation(a)}),t}}function su(r){var t=r.chart,e=r.options,i=e.yAxis,n=e.limitInPlot,a=n;return re(i)&&j(n)&&(Object.values(ge(i,["min","max","minLimit","maxLimit"])).some(function(o){return!j(o)})?a=!0:a=!1),t.limitInPlot=a,r}function IU(r){return r===void 0&&(r="rect"),function(t){var e=t.chart,i=t.options,n=i.coordinate,a=Array.from(n||[]).map(function(o){return o.type==="reflectX"?["reflect","x"]:o.type==="reflectY"?["reflect","y"]:o.type==="transpose"?["transpose"]:null}).filter(function(o){return!!o});return a.length!==0&&e.coordinate({type:r,actions:a}),t}}var T5t={locale:"en-US"},hg={};function LU(r,t){hg[r]=t}function Ty(r){return{get:function(t,e){return wU(L(hg[r],t)||L(hg[T5t.locale],t)||L(hg["en-US"],t)||t,e)}}}var b5t={locale:"en-US",general:{increase:"Increase",decrease:"Decrease",root:"Root"},statistic:{total:"Total"},conversionTag:{label:"Rate"},legend:{},tooltip:{},slider:{},scrollbar:{},waterfall:{total:"Total"}},w5t={locale:"zh-CN",general:{increase:"增加",decrease:"减少",root:"初始"},statistic:{total:"总计"},conversionTag:{label:"转化率"},legend:{},tooltip:{},slider:{},scrollbar:{},waterfall:{total:"总计"}};function ta(r,t){if(r===!1)return{fields:!1};var e=L(r,"fields"),i=L(r,"formatter");return i&&!e&&(e=t),{fields:e,formatter:i}}function Np(r,t){var e=r.type,i=r.xField,n=r.yField,a=r.colorField,o=r.shapeField,s=r.sizeField,l=r.styleField,u=r.rawFields,c=[];if(u=(ut(u)?u(e,t):u)||[],t==="color")c=_t([a||i],u,!0);else if(t==="shape")c=_t([o||i],u,!0);else if(t==="size")c=_t([s||i],u,!0);else{c=_t([i,n,a,o,s,l],u,!0);var h=["x","y","color","shape","size","style"].indexOf(t),f=c[h];c.splice(h,1),c.unshift(f)}var d=Gl(c.filter(function(p){return!!p})),v=e==="line"&&[i,n].includes(d.join("*"))?"":d.join("*");return{mappingFields:d,tileMappingField:v}}function Hu(r,t){if(t)return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n={};return r.forEach(function(a,o){n[a]=e[o]}),delete n.undefined,t(n)}}function Ji(r){var t=r.chart,e=r.options,i=e.type,n=e.args,a=e.mapping,o=e.xField,s=e.yField,l=e.colorField,u=e.shapeField,c=e.sizeField,h=e.tooltipFields,f=e.label,d=e.state,v=e.customInfo,p=e.customMappingField;if(!a)return r;var g=a.color,m=a.shape,y=a.size,_=a.style,x=a.tooltip,C=t[i](n).position("".concat(o,"*").concat(s));if(mt(g))l?C.color(l,g):C.color(g);else if(ut(g)){var A=Np(e,"color"),T=A.mappingFields,w=A.tileMappingField;C.color(p||w,Hu(T,g))}else l&&C.color(l,g);if(mt(m))u?C.shape(u,[m]):C.shape(m);else if(ut(m)){var M=Np(e,"shape"),T=M.mappingFields,w=M.tileMappingField;C.shape(w,Hu(T,m))}else u&&C.shape(u,m);if(Mt(y))c?C.size(c,y):C.size(y);else if(ut(y)){var O=Np(e,"size"),T=O.mappingFields,w=O.tileMappingField;C.size(w,Hu(T,y))}else c&&C.size(c,y);if(ut(_)){var P=Np(e,"style"),T=P.mappingFields,w=P.tileMappingField;C.style(w,Hu(T,_))}else re(_)&&C.style(_);if(h===!1?C.tooltip(!1):Gi(h)||C.tooltip(h.join("*"),Hu(h,x)),f===!1)C.label(!1);else if(f){var D=f.callback,z=f.fields,Y=Ut(f,["callback","fields"]);C.label({fields:z||[s],callback:D,cfg:Mr(Y)})}return d&&C.state(d),v&&C.customInfo(v),[o,s].filter(function(H){return H!==l}).forEach(function(H){t.legend(H,!1)}),S(S({},r),{ext:{geometry:C}})}function by(r){var t=r.options,e=t.area,i=t.xField,n=t.yField,a=t.seriesField,o=t.smooth,s=t.tooltip,l=t.useDeferredLabel,u=ta(s,[i,n,a]),c=u.fields,h=u.formatter;return e?Ji($({},r,{options:{type:"area",colorField:a,tooltipFields:c,mapping:nt({shape:o?"smooth":"area",tooltip:h},e),args:{useDeferredLabel:l}}})):r}function OU(r){var t=r.options,e=t.edge,i=t.xField,n=t.yField,a=t.seriesField,o=t.tooltip,s=t.useDeferredLabel,l=ta(o,[i,n,a]),u=l.fields,c=l.formatter;return e?Ji($({},r,{options:{type:"edge",colorField:a,tooltipFields:u,mapping:S({tooltip:c},e),args:{useDeferredLabel:s}}})):r}function R5t(r){var t=r.chart,e=r.options,i=r.ext,n=e.seriesField,a=e.isGroup,o=e.isStack,s=e.marginRatio,l=e.widthRatio,u=e.groupField,c=e.theme,h=[];if(n&&(a&&h.push({type:"dodge",dodgeBy:u||n,marginRatio:s}),o&&h.push({type:"stack",marginRatio:s})),h.length&&(i!=null&&i.geometry)){var f=i==null?void 0:i.geometry;f.adjust(h)}return j(l)||t.theme($({},re(c)?c:Pf(c),{columnWidthRatio:l})),r}function Kr(r){var t=r.options,e=t.xField,i=t.yField,n=t.interval,a=t.seriesField,o=t.tooltip,s=t.minColumnWidth,l=t.maxColumnWidth,u=t.columnBackground,c=t.dodgePadding,h=t.intervalPadding,f=t.useDeferredLabel,d=ta(o,[e,i,a]),v=d.fields,p=d.formatter,g=(n?Ji($({},r,{options:{type:"interval",colorField:a,tooltipFields:v,mapping:S({tooltip:p},n),args:{dodgePadding:c,intervalPadding:h,minColumnWidth:s,maxColumnWidth:l,background:u,useDeferredLabel:f}}})):r).ext;return R5t(S(S({},r),{ext:g}))}function mh(r){var t=r.options,e=t.line,i=t.stepType,n=t.xField,a=t.yField,o=t.seriesField,s=t.smooth,l=t.connectNulls,u=t.tooltip,c=t.useDeferredLabel,h=ta(u,[n,a,o]),f=h.fields,d=h.formatter;return e?Ji($({},r,{options:{type:"line",colorField:o,tooltipFields:f,mapping:nt({shape:i||(s?"smooth":"line"),tooltip:d},e),args:{connectNulls:l,useDeferredLabel:c}}})):r}function An(r){var t=r.options,e=t.point,i=t.xField,n=t.yField,a=t.seriesField,o=t.sizeField,s=t.shapeField,l=t.tooltip,u=t.useDeferredLabel,c=ta(l,[i,n,a,o,s]),h=c.fields,f=c.formatter;return e?Ji($({},r,{options:{type:"point",colorField:a,shapeField:s,tooltipFields:h,mapping:S({tooltip:f},e),args:{useDeferredLabel:u}}})):r}function wy(r){var t=r.options,e=t.polygon,i=t.xField,n=t.yField,a=t.seriesField,o=t.tooltip,s=t.useDeferredLabel,l=ta(o,[i,n,a]),u=l.fields,c=l.formatter;return e?Ji($({},r,{options:{type:"polygon",colorField:a,tooltipFields:u,mapping:S({tooltip:c},e),args:{useDeferredLabel:s}}})):r}function jT(r){var t=r.options,e=t.schema,i=t.xField,n=t.yField,a=t.seriesField,o=t.tooltip,s=t.useDeferredLabel,l=ta(o,[i,n,a]),u=l.fields,c=l.formatter;return e?Ji($({},r,{options:{type:"schema",colorField:a,tooltipFields:u,mapping:S({tooltip:c},e),args:{useDeferredLabel:s}}})):r}function M5t(r){var t=r.options,e=t.violin,i=t.xField,n=t.yField,a=t.seriesField,o=t.sizeField,s=t.tooltip,l=ta(s,[i,n,a,o]),u=l.fields,c=l.formatter;return e?Ji($({},r,{options:{type:"violin",colorField:a,tooltipFields:u,mapping:S({tooltip:c},e)}})):r}var KO="data-chart-source-type",PU=["padding","appendPadding","renderer","pixelRatio","syncViewPadding","supportCSSTransform","limitInPlot"],Ft=function(r){B(t,r);function t(e,i){var n=r.call(this)||this;return n.container=typeof e=="string"?document.getElementById(e):e,n.options=$({},n.getDefaultOptions(),i),n.createG2(),n.bindEvents(),n}return t.getDefaultOptions=function(){return{renderer:"canvas",xAxis:{nice:!0,label:{autoRotate:!1,autoHide:{type:"equidistance",cfg:{minGap:6}}}},yAxis:{nice:!0,label:{autoHide:!0,autoRotate:!1}},animation:!0}},t.prototype.createG2=function(){var e=this.options,i=e.width,n=e.height,a=e.defaultInteractions;this.chart=new fPt(S(S(S(S({container:this.container,autoFit:!1},this.getChartSize(i,n)),{localRefresh:!1}),ge(this.options,PU)),{defaultInteractions:a})),this.container.setAttribute(KO,"G2Plot")},t.prototype.getChartSize=function(e,i){var n=kC(this.container);return{width:e||n.width||400,height:i||n.height||400}},t.prototype.bindEvents=function(){var e=this;this.chart&&this.chart.on("*",function(i){i!=null&&i.type&&e.emit(i.type,i)})},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.render=function(){this.chart.clear(),this.chart.options={data:[],animate:!0},this.chart.views=[],this.execAdaptor(),this.chart.render(),this.bindSizeSensor()},t.prototype.update=function(e){this.updateOption(e),this.render()},t.prototype.updateOption=function(e){this.options=$({},this.options,e)},t.prototype.setState=function(e,i,n){n===void 0&&(n=!0);var a=Rd(this.chart);R(a,function(o){i(o.getData())&&o.setState(e,n)})},t.prototype.getStates=function(){var e=Rd(this.chart),i=[];return R(e,function(n){var a=n.getData(),o=n.getStates();R(o,function(s){i.push({data:a,state:s,geometry:n.geometry,element:n})})}),i},t.prototype.changeData=function(e){this.update({data:e})},t.prototype.changeSize=function(e,i){this.chart.changeSize(e,i)},t.prototype.addAnnotations=function(e,i){i=i||this.chart;var n=_t([],e,!0),a=i.getController("annotation"),o=a.getComponents().map(function(u){return u.extra});a.clear(!0);for(var s=function(u){var c=o[u],h=n.findIndex(function(f){return f.id&&f.id===c.id});h!==-1&&(c=$({},c,n[h]),n.splice(h,1)),a.annotation(c)},l=0;l<o.length;l++)s(l);n.forEach(function(u){return a.annotation(u)}),i.render(!0)},t.prototype.removeAnnotations=function(e){var i=this.chart.getController("annotation"),n=i.getComponents().map(function(s){return s.extra});i.clear(!0);for(var a=function(s){var l=n[s];e.find(function(u){return u.id&&u.id===l.id})||i.annotation(l)},o=0;o<n.length;o++)a(o);this.chart.render(!0)},t.prototype.destroy=function(){this.unbindSizeSensor(),this.chart.destroy(),this.off(),this.container.removeAttribute(KO)},t.prototype.execAdaptor=function(){var e=this.getSchemaAdaptor(),i=this.options,n=i.padding,a=i.appendPadding;this.chart.padding=n,this.chart.appendPadding=a,e({chart:this.chart,options:this.options})},t.prototype.triggerResize=function(){this.chart.forceFit()},t.prototype.bindSizeSensor=function(){var e=this;if(!this.unbind){var i=this.options.autoFit,n=i===void 0?!0:i;n&&(this.unbind=kH(this.container,function(){var a=kC(e.container),o=a.width,s=a.height;(o!==e.chart.width||s!==e.chart.height)&&e.triggerResize()}))}},t.prototype.unbindSizeSensor=function(){this.unbind&&(this.unbind(),this.unbind=void 0)},t}(du);function FU(r,t,e,i){var n=oi(r,function(a,o){var s=o[e],l=a.has(s)?a.get(s):0,u=o[t];return l=ou(u)?l+u:l,a.set(s,l),a},new Map);return Ne(r,function(a){var o,s=a[t],l=a[e],u=ou(s)&&n.get(l)!==0?s/n.get(l):0;return S(S({},a),(o={},o[i]=u,o))})}function I5t(r,t,e,i){var n=oi(r,function(a,o){var s=oi(e,function(c,h){return"".concat(c).concat(o[h])},""),l=a.has(s)?a.get(s):0,u=o[t];return l=ou(u)?l+u:l,a.set(s,l),a},new Map);return Ne(r,function(a){var o,s=a[t],l=oi(e,function(c,h){return"".concat(c).concat(a[h])},""),u=ou(s)&&n.get(l)!==0?s/n.get(l):0;return S(S({},a),(o={},o[i]=u,o))})}function _v(r,t,e,i,n){return n?FU(r,t,e,i):r}function L5t(r){var t=r.chart,e=r.options,i=e.data,n=e.color,a=e.lineStyle,o=e.lineShape,s=e.point,l=e.area,u=e.seriesField,c=s==null?void 0:s.state,h=l==null?void 0:l.state;t.data(i);var f=$({},r,{options:{shapeField:u,line:{color:n,style:a,shape:o},point:s&&S({color:n,shape:"circle"},s),area:l&&S({color:n},l),label:void 0}}),d=$({},f,{options:{tooltip:!1,state:c}}),v=$({},f,{options:{tooltip:!1,state:h}});return mh(f),An(d),by(v),r}function Ry(r){var t,e,i=r.options,n=i.xAxis,a=i.yAxis,o=i.xField,s=i.yField,l=i.data;return bt(Je((t={},t[o]=n,t[s]=a,t),(e={},e[o]={type:"cat"},e[s]=$T(l,s),e)))(r)}function O5t(r){var t=r.chart,e=r.options,i=e.reflect;if(i){var n=i;Z(n)||(n=[n]);var a=n.map(function(o){return["reflect",o]});t.coordinate({type:"rect",actions:a})}return r}function BU(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return i===!1?t.axis(a,!1):t.axis(a,i),n===!1?t.axis(o,!1):t.axis(o,n),r}function DU(r){var t=r.chart,e=r.options,i=e.legend,n=e.seriesField;return i&&n?t.legend(n,i):i===!1&&t.legend(!1),r}function P5t(r){var t=r.chart,e=r.options,i=e.label,n=e.yField,a=qr(t,"line");if(!i)a.label(!1);else{var o=i.fields,s=i.callback,l=Ut(i,["fields","callback"]);a.label({fields:o||[n],callback:s,cfg:S({layout:[{type:"limit-in-plot"},{type:"path-adjust-position"},{type:"point-adjust-position"},{type:"limit-in-plot",cfg:{action:"hide"}}]},Mr(l))})}return r}function F5t(r){var t=r.chart,e=r.options,i=e.isStack;return i&&R(t.geometries,function(n){n.adjust("stack")}),r}function NU(r){return bt(L5t,Ry,F5t,ae,O5t,BU,DU,yr,P5t,yv,YT,Ue,xe,$e(),su)(r)}function B5t(r){var t=r.chart,e=r.options,i=e.data,n=e.areaStyle,a=e.areaShape,o=e.color,s=e.point,l=e.line,u=e.isPercent,c=e.xField,h=e.yField,f=e.tooltip,d=e.seriesField,v=e.startOnZero,p=s==null?void 0:s.state,g=_v(i,h,c,h,u);t.data(g);var m=u?S({formatter:function(C){return{name:C[d]||C[c],value:(Number(C[h])*100).toFixed(2)+"%"}}},f):f,y=$({},r,{options:{area:{color:o,style:n,shape:a},point:s&&S({color:o},s),tooltip:m,label:void 0,args:{startOnZero:v}}}),_={chart:t,options:$({line:{size:2}},Q0(e,["state"]),{line:l&&S({color:o},l),sizeField:d,state:l==null?void 0:l.state,tooltip:!1,label:void 0,args:{startOnZero:v}})},x=$({},y,{options:{tooltip:!1,state:p}});return by(y),mh(_),An(x),r}function D5t(r){var t=r.chart,e=r.options,i=e.label,n=e.yField,a=qr(t,"area");if(!i)a.label(!1);else{var o=i.fields,s=i.callback,l=Ut(i,["fields","callback"]);a.label({fields:o||[n],callback:s,cfg:S({layout:[{type:"limit-in-plot"},{type:"path-adjust-position"},{type:"point-adjust-position"},{type:"limit-in-plot",cfg:{action:"hide"}}]},Mr(l))})}return r}function N5t(r){var t=r.chart,e=r.options,i=e.isStack,n=e.isPercent,a=e.seriesField;return(n||i)&&a&&R(t.geometries,function(o){o.adjust("stack")}),r}function kU(r){return bt(ae,Sn("areaStyle"),IU("rect"),B5t,Ry,N5t,BU,DU,yr,D5t,yv,$e(),Ue,xe,su)(r)}var k5t=$({},Ft.getDefaultOptions(),{tooltip:{shared:!0,showMarkers:!0,showCrosshairs:!0,crosshairs:{type:"x"}},isStack:!0,line:{},legend:{position:"top-left",radio:{}}}),UU=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="area",e}return t.getDefaultOptions=function(){return k5t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this.options,n=i.isPercent,a=i.xField,o=i.yField,s=this,l=s.chart,u=s.options;Ry({chart:l,options:u}),this.chart.changeData(_v(e,o,a,o,n))},t.prototype.getSchemaAdaptor=function(){return kU},t}(Ft);const Mzt=Object.freeze(Object.defineProperty({__proto__:null,Area:UU},Symbol.toStringTag,{value:"Module"}));var U5t=10,z5t=5,H5t={padding:[8,10],text:"reset",textStyle:{default:{x:0,y:0,fontSize:12,fill:"#333333",cursor:"pointer"}},buttonStyle:{default:{fill:"#f7f7f7",stroke:"#cccccc",cursor:"pointer"},active:{fill:"#e6e6e6"}}},$5t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.buttonGroup=null,e.buttonCfg=S({name:"button"},H5t),e}return t.prototype.getButtonCfg=function(){var e=this.context.view,i=L(e,["interactions","filter-action","cfg","buttonConfig"]);return $(this.buttonCfg,i,this.cfg)},t.prototype.drawButton=function(){var e=this.getButtonCfg(),i=this.context.view.foregroundGroup.addGroup({name:e.name}),n=this.drawText(i);this.drawBackground(i,n.getBBox()),this.buttonGroup=i},t.prototype.drawText=function(e){var i,n=this.getButtonCfg();return e.addShape({type:"text",name:"button-text",attrs:S({text:n.text},(i=n.textStyle)===null||i===void 0?void 0:i.default)})},t.prototype.drawBackground=function(e,i){var n,a=this.getButtonCfg(),o=Us(a.padding),s=e.addShape({type:"rect",name:"button-rect",attrs:S({x:i.x-o[3],y:i.y-o[0],width:i.width+o[1]+o[3],height:i.height+o[0]+o[2]},(n=a.buttonStyle)===null||n===void 0?void 0:n.default)});return s.toBack(),e.on("mouseenter",function(){var l;s.attr((l=a.buttonStyle)===null||l===void 0?void 0:l.active)}),e.on("mouseleave",function(){var l;s.attr((l=a.buttonStyle)===null||l===void 0?void 0:l.default)}),s},t.prototype.resetPosition=function(){var e=this.context.view,i=e.getCoordinate(),n=i.convert({x:1,y:1}),a=this.buttonGroup,o=a.getBBox(),s=Zi.transform(null,[["t",n.x-o.width-U5t,n.y+o.height+z5t]]);a.setMatrix(s)},t.prototype.show=function(){this.buttonGroup||this.drawButton(),this.resetPosition(),this.buttonGroup.show()},t.prototype.hide=function(){this.buttonGroup&&this.buttonGroup.hide()},t.prototype.destroy=function(){var e=this.buttonGroup;e&&e.remove(),r.prototype.destroy.call(this)},t}(Fe);xt("brush-reset-button",$5t,{name:"brush-reset-button"});Ot("filter-action",{});function mo(r){return r.isInPlot()}function Su(r,t,e){var i=e||{},n=i.mask,a=i.isStartEnable,o=t||"rect";switch(r){case"brush":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:a||mo,action:["brush:start","".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[null,{maskStyle:n==null?void 0:n.style}]}],processing:[{trigger:"mousemove",isEnable:mo,action:["".concat(o,"-mask:resize")]}],end:[{trigger:"mouseup",isEnable:mo,action:["brush:filter","brush:end","".concat(o,"-mask:end"),"".concat(o,"-mask:hide"),"brush-reset-button:show"]}],rollback:[{trigger:"brush-reset-button:click",action:["brush:reset","brush-reset-button:hide","cursor:crosshair"]}]};case"brush-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mousemove",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mousemove",action:"cursor:default",isEnable:function(s){return a?!a(s):!1}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:a||function(s){return!s.isInShape("mask")},action:["".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[{maskStyle:n==null?void 0:n.style}]},{trigger:"mask:dragstart",action:["".concat(o,"-mask:moveStart")]}],processing:[{trigger:"plot:mousemove",action:["".concat(o,"-mask:resize")]},{trigger:"mask:drag",action:["".concat(o,"-mask:move")]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["".concat(o,"-mask:end")]},{trigger:"mask:dragend",action:["".concat(o,"-mask:moveEnd")]},{trigger:"document:mouseup",isEnable:function(s){return!s.isInPlot()},action:["element-range-highlight:clear","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","".concat(o,"-mask:hide")]}]};case"brush-x":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:a||mo,action:["brush-x:start","".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[null,{maskStyle:n==null?void 0:n.style}]}],processing:[{trigger:"mousemove",isEnable:mo,action:["".concat(o,"-mask:resize")]}],end:[{trigger:"mouseup",isEnable:mo,action:["brush-x:filter","brush-x:end","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["brush-x:reset"]}]};case"brush-x-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:a||function(s){return!s.isInShape("mask")},action:["".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[{maskStyle:n==null?void 0:n.style}]},{trigger:"mask:dragstart",action:["".concat(o,"-mask:moveStart")]}],processing:[{trigger:"plot:mousemove",action:["".concat(o,"-mask:resize")]},{trigger:"mask:drag",action:["".concat(o,"-mask:move")]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["".concat(o,"-mask:end")]},{trigger:"mask:dragend",action:["".concat(o,"-mask:moveEnd")]},{trigger:"document:mouseup",isEnable:function(s){return!s.isInPlot()},action:["element-range-highlight:clear","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","".concat(o,"-mask:hide")]}]};case"brush-y":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:a||mo,action:["brush-y:start","".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[null,{maskStyle:n==null?void 0:n.style}]}],processing:[{trigger:"mousemove",isEnable:mo,action:["".concat(o,"-mask:resize")]}],end:[{trigger:"mouseup",isEnable:mo,action:["brush-y:filter","brush-y:end","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["brush-y:reset"]}]};case"brush-y-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:a||function(s){return!s.isInShape("mask")},action:["".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[{maskStyle:n==null?void 0:n.style}]},{trigger:"mask:dragstart",action:["".concat(o,"-mask:moveStart")]}],processing:[{trigger:"plot:mousemove",action:["".concat(o,"-mask:resize")]},{trigger:"mask:drag",action:["".concat(o,"-mask:move")]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["".concat(o,"-mask:end")]},{trigger:"mask:dragend",action:["".concat(o,"-mask:moveEnd")]},{trigger:"document:mouseup",isEnable:function(s){return!s.isInPlot()},action:["element-range-highlight:clear","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","".concat(o,"-mask:hide")]}]};default:return{}}}Ot("brush",Su("brush"));Ot("brush-highlight",Su("brush-highlight"));Ot("brush-x",Su("brush-x","x-rect"));Ot("brush-y",Su("brush-y","y-rect"));Ot("brush-x-highlight",Su("brush-x-highlight","x-rect"));Ot("brush-y-highlight",Su("brush-y-highlight","y-rect"));var QO=["brush","brush-x","brush-y","brush-highlight","brush-x-highlight","brush-y-highlight"];function zU(r){var t=r.options,e=t.brush,i=Ur(t.interactions||[],function(n){return QO.indexOf(n.type)===-1});return e!=null&&e.enabled&&(QO.forEach(function(n){var a=!1;switch(e.type){case"x-rect":a=n===(e.action==="highlight"?"brush-x-highlight":"brush-x");break;case"y-rect":a=n===(e.action==="highlight"?"brush-y-highlight":"brush-y");break;default:a=n===(e.action==="highlight"?"brush-highlight":"brush");break}var o={type:n,enable:a};e&&(o.cfg=Su(n,e.type,e)),i.push(o)}),(e==null?void 0:e.action)!=="highlight"&&i.push({type:"filter-action",cfg:{buttonConfig:e.button}})),$({},r,{options:{interactions:i}})}var zl={hover:"__interval-connected-area-hover__",click:"__interval-connected-area-click__"},ZT=function(r,t){return r==="hover"?[{trigger:"interval:mouseenter",action:["element-highlight-by-color:highlight","element-link-by-color:link"],arg:[null,{style:t}]}]:[{trigger:"interval:click",action:["element-highlight-by-color:clear","element-highlight-by-color:highlight","element-link-by-color:clear","element-link-by-color:unlink","element-link-by-color:link"],arg:[null,null,null,null,{style:t}]}]};Ot(zl.hover,{start:ZT(zl.hover),end:[{trigger:"interval:mouseleave",action:["element-highlight-by-color:reset","element-link-by-color:unlink"]}]});Ot(zl.click,{start:ZT(zl.click),end:[{trigger:"document:mousedown",action:["element-highlight-by-color:clear","element-link-by-color:clear"]}]});function W5t(r){return r===void 0&&(r=!1),function(t){var e=t.chart,i=t.options,n=i.connectedArea,a=function(){e.removeInteraction(zl.hover),e.removeInteraction(zl.click)};if(!r&&n){var o=n.trigger||"hover";a(),e.interaction(zl[o],{start:ZT(o,n.style)})}else a();return t}}function HU(r,t){return!Mt(r)||!Mt(t)||r===0&&t===0?"-":r===t?"100%":r===0?"∞":"".concat((100*t/r).toFixed(2),"%")}function V5t(r,t){return $({size:t?32:80,spacing:t?8:12,offset:t?32:0,arrow:r.arrow!==!1&&{headSize:12,style:{fill:"rgba(0, 0, 0, 0.05)"}},text:r.text!==!1&&{style:{fontSize:12,fill:"rgba(0, 0, 0, 0.85)",textAlign:"center",textBaseline:"middle"},formatter:HU}},r)}function L0(r,t){return Ne(t.getModel().points,function(e){return r.convertPoint(e)})}function G5t(r,t,e){var i=r.view,n=r.geometry,a=r.group,o=r.options,s=r.horizontal,l=o.offset,u=o.size,c=o.arrow,h=i.getCoordinate(),f=L0(h,t)[3],d=L0(h,e)[0],v=d.y-f.y,p=d.x-f.x;if(typeof c!="boolean"){var g=c.headSize,m=o.spacing,y;s?(p-g)/2<m?(m=Math.max(1,(p-g)/2),y=[[f.x+m,f.y-l],[f.x+m,f.y-l-u],[d.x-m,d.y-l-u/2]]):y=[[f.x+m,f.y-l],[f.x+m,f.y-l-u],[d.x-m-g,d.y-l-u],[d.x-m,d.y-l-u/2],[d.x-m-g,d.y-l]]:(v-g)/2<m?(m=Math.max(1,(v-g)/2),y=[[f.x+l,f.y+m],[f.x+l+u,f.y+m],[d.x+l+u/2,d.y-m]]):y=[[f.x+l,f.y+m],[f.x+l+u,f.y+m],[d.x+l+u,d.y-m-g],[d.x+l+u/2,d.y-m],[d.x+l,d.y-m-g]],a.addShape("polygon",{id:"".concat(i.id,"-conversion-tag-arrow-").concat(n.getElementId(t.getModel().mappingData)),name:"conversion-tag-arrow",origin:{element:t,nextElement:e},attrs:S(S({},c.style||{}),{points:y})})}}function X5t(r,t,e){var i,n,a,o=r.view,s=r.geometry,l=r.group,u=r.options,c=r.field,h=r.horizontal,f=u.offset,d=u.size;if(typeof u.text!="boolean"){var v=o.getCoordinate(),p=((i=u.text)===null||i===void 0?void 0:i.formatter)&&((n=u.text)===null||n===void 0?void 0:n.formatter(t.getData()[c],e.getData()[c])),g=L0(v,t)[h?3:0],m=L0(v,e)[h?0:3],y=l.addShape("text",{id:"".concat(o.id,"-conversion-tag-text-").concat(s.getElementId(t.getModel().mappingData)),name:"conversion-tag-text",origin:{element:t,nextElement:e},attrs:S(S({},((a=u.text)===null||a===void 0?void 0:a.style)||{}),{text:p,x:h?(g.x+m.x)/2:g.x+f+d/2,y:h?g.y-f-d/2:(g.y+m.y)/2})});if(h){var _=m.x-g.x,x=y.getBBox().width;if(x>_){var C=x/p.length,A=Math.max(1,Math.ceil(_/C)-1),T="".concat(p.slice(0,A),"...");y.attr("text",T)}}}}function Y5t(r,t,e){G5t(r,t,e),X5t(r,t,e)}function j5t(r,t,e){return t===void 0&&(t=!0),e===void 0&&(e=!1),function(i){var n=i.options,a=i.chart,o=n.conversionTag,s=n.theme;return o&&!e&&(a.theme($({},re(s)?s:Pf(s),{columnWidthRatio:1/3})),a.annotation().shape({render:function(l,u){var c=l.addGroup({id:"".concat(a.id,"-conversion-tag-group"),name:"conversion-tag-group"}),h=pa(a.geometries,function(v){return v.type==="interval"}),f={view:u,geometry:h,group:c,field:r,horizontal:t,options:V5t(o,t)},d=h.elements;R(d,function(v,p){p>0&&Y5t(f,d[p-1],v)})}})),i}}function Z5t(r){var t=r.options,e=t.legend,i=t.seriesField,n=t.isStack;return i?e!==!1&&(e=S({position:n?"right-top":"top-left"},e)):e=!1,r.options.legend=e,r}function q5t(r){var t=r.chart,e=r.options,i=e.data,n=e.columnStyle,a=e.color,o=e.columnWidthRatio,s=e.isPercent,l=e.isGroup,u=e.isStack,c=e.xField,h=e.yField,f=e.seriesField,d=e.groupField,v=e.tooltip,p=e.shape,g=s&&l&&u?I5t(i,h,[c,d],h):_v(i,h,c,h,s),m=[];u&&f&&!l?g.forEach(function(x){var C=m.find(function(A){return A[c]===x[c]&&A[f]===x[f]});C?C[h]+=x[h]||0:m.push(S({},x))}):m=g,t.data(m);var y=s?S({formatter:function(x){var C;return{name:l&&u?"".concat(x[f]," - ").concat(x[d]):(C=x[f])!==null&&C!==void 0?C:x[c],value:(Number(x[h])*100).toFixed(2)+"%"}}},v):v,_=$({},r,{options:{data:m,widthRatio:o,tooltip:y,interval:{shape:p,style:n,color:a}}});return Kr(_),_}function qT(r){var t,e,i=r.options,n=i.xAxis,a=i.yAxis,o=i.xField,s=i.yField,l=i.data,u=i.isPercent,c=u?{max:1,min:0,minLimit:0,maxLimit:1}:{};return bt(Je((t={},t[o]=n,t[s]=a,t),(e={},e[o]={type:"cat"},e[s]=S(S({},$T(l,s)),c),e)))(r)}function K5t(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return i===!1?t.axis(a,!1):t.axis(a,i),n===!1?t.axis(o,!1):t.axis(o,n),r}function Q5t(r){var t=r.chart,e=r.options,i=e.legend,n=e.seriesField;return i&&n?t.legend(n,i):i===!1&&t.legend(!1),r}function J5t(r){var t=r.chart,e=r.options,i=e.label,n=e.yField,a=e.isRange,o=qr(t,"interval");if(!i)o.label(!1);else{var s=i.callback,l=Ut(i,["callback"]);o.label({fields:[n],callback:s,cfg:S({layout:l!=null&&l.position?void 0:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"},{type:"limit-in-plot",cfg:{action:"hide"}}]},Mr(a?S({content:function(u){var c;return(c=u[n])===null||c===void 0?void 0:c.join("-")}},l):l))})}return r}function t4t(r){var t=r.chart,e=r.options,i=e.tooltip,n=e.isGroup,a=e.isStack,o=e.groupField,s=e.data,l=e.xField,u=e.yField,c=e.seriesField;if(i===!1)t.tooltip(!1);else{var h=i;if(n&&a){var f=h.customItems,d=(h==null?void 0:h.formatter)||function(v){return{name:"".concat(v[c]," - ").concat(v[o]),value:v[u]}};h=S(S({},h),{customItems:function(v){var p=[];return R(v,function(g){var m=Ur(s,function(y){return DB(y,ge(g.data,[l,c]))});m.forEach(function(y){p.push(S(S(S({},g),{value:y[u],data:y,mappingData:{_origin:y}}),d(y)))})}),f?f(p):p}})}t.tooltip(h)}return r}function My(r,t){t===void 0&&(t=!1);var e=r.options,i=e.seriesField;return bt(Z5t,ae,Sn("columnStyle"),Js,IU("rect"),q5t,qT,K5t,Q5t,t4t,yv,YT,J5t,zU,Ue,xe,$e(),j5t(e.yField,!t,!!i),W5t(!e.isStack),su)(r)}function e4t(r){var t=r.options,e=t.xField,i=t.yField,n=t.xAxis,a=t.yAxis,o={left:"bottom",right:"top",top:"left",bottom:"right"},s=a!==!1?S({position:o[(a==null?void 0:a.position)||"left"]},a):!1,l=n!==!1?S({position:o[(n==null?void 0:n.position)||"bottom"]},n):!1;return S(S({},r),{options:S(S({},t),{xField:i,yField:e,xAxis:s,yAxis:l})})}function r4t(r){var t=r.options,e=t.label;return e&&!e.position&&(e.position="left",e.layout||(e.layout=[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"},{type:"limit-in-plot",cfg:{action:"hide"}}])),$({},r,{options:{label:e}})}function i4t(r){var t=r.options,e=t.seriesField,i=t.isStack,n=t.legend;return e?n!==!1&&(n=S({position:i?"top-left":"right-top"},n||{})):n=!1,$({},r,{options:{legend:n}})}function n4t(r){var t=r.options,e=[{type:"transpose"},{type:"reflectY"}].concat(t.coordinate||[]);return $({},r,{options:{coordinate:e}})}function a4t(r){var t=r.chart,e=r.options,i=e.barStyle,n=e.barWidthRatio,a=e.minBarWidth,o=e.maxBarWidth,s=e.barBackground;return My({chart:t,options:S(S({},e),{columnStyle:i,columnWidthRatio:n,minColumnWidth:a,maxColumnWidth:o,columnBackground:s})},!0)}function $U(r){return bt(e4t,r4t,i4t,yr,n4t,a4t)(r)}var o4t=$({},Ft.getDefaultOptions(),{barWidthRatio:.6,marginRatio:1/32,tooltip:{shared:!0,showMarkers:!1,offset:20},legend:{radio:{}},interactions:[{type:"active-region"}]}),WU=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="bar",e}return t.getDefaultOptions=function(){return o4t},t.prototype.changeData=function(e){var i,n;this.updateOption({data:e});var a=this,o=a.chart,s=a.options,l=s.isPercent,u=s.xField,c=s.yField,h=s.xAxis,f=s.yAxis;i=[c,u],u=i[0],c=i[1],n=[f,h],h=n[0],f=n[1];var d=S(S({},s),{xField:u,yField:c,yAxis:f,xAxis:h});qT({chart:o,options:d}),o.changeData(_v(e,u,c,u,l))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return $U},t}(Ft);const Izt=Object.freeze(Object.defineProperty({__proto__:null,Bar:WU},Symbol.toStringTag,{value:"Module"}));var s4t=$({},Ft.getDefaultOptions(),{columnWidthRatio:.6,marginRatio:1/32,tooltip:{shared:!0,showMarkers:!1,offset:20},legend:{radio:{}},interactions:[{type:"active-region"}]}),VU=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="column",e}return t.getDefaultOptions=function(){return s4t},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this.options,n=i.yField,a=i.xField,o=i.isPercent,s=this,l=s.chart,u=s.options;qT({chart:l,options:u}),this.chart.changeData(_v(e,n,a,n,o))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return My},t}(Ft);const Lzt=Object.freeze(Object.defineProperty({__proto__:null,Column:VU},Symbol.toStringTag,{value:"Module"}));var Q_,zs="$$percentage$$",Hs="$$mappingValue$$",qa="$$conversion$$",UC="$$totalPercentage$$",Md="$$x$$",Id="$$y$$",l4t={appendPadding:[0,80],minSize:0,maxSize:1,meta:(Q_={},Q_[Hs]={min:0,max:1,nice:!1},Q_),label:{style:{fill:"#fff",fontSize:12}},tooltip:{showTitle:!1,showMarkers:!1,shared:!1},conversionTag:{offsetX:10,offsetY:0,style:{fontSize:12,fill:"rgba(0,0,0,0.45)"}}},GU="CONVERSION_TAG_NAME";function KT(r,t,e){var i=[],n=e.yField,a=e.maxSize,o=e.minSize,s=L(zB(t,n),[n]),l=Mt(a)?a:1,u=Mt(o)?o:0;return i=Ne(r,function(c,h){var f=(c[n]||0)/s;return c[zs]=f,c[Hs]=(l-u)*f+u,c[qa]=[L(r,[h-1,n]),c[n]],c}),i}function QT(r){return function(t){var e=t.chart,i=t.options,n=i.conversionTag,a=i.filteredData,o=a||e.getOptions().data;if(n){var s=n.formatter;o.forEach(function(l,u){if(!(u<=0||Number.isNaN(l[Hs]))){var c=r(l,u,o,{top:!0,name:GU,text:{content:ut(s)?s(l,o):s,offsetX:n.offsetX,offsetY:n.offsetY,position:"end",autoRotate:!1,style:S({textAlign:"start",textBaseline:"middle"},n.style)}});e.annotation().line(c)}})}return t}}function u4t(r){var t=r.chart,e=r.options,i=e.data,n=i===void 0?[]:i,a=e.yField,o=e.maxSize,s=e.minSize,l=KT(n,n,{yField:a,maxSize:o,minSize:s});return t.data(l),r}function c4t(r){var t=r.chart,e=r.options,i=e.xField,n=e.yField,a=e.color,o=e.tooltip,s=e.label,l=e.shape,u=l===void 0?"funnel":l,c=e.funnelStyle,h=e.state,f=ta(o,[i,n]),d=f.fields,v=f.formatter;Ji({chart:t,options:{type:"interval",xField:i,yField:Hs,colorField:i,tooltipFields:Z(d)&&d.concat([zs,qa]),mapping:{shape:u,tooltip:v,color:a,style:c},label:s,state:h}});var p=qr(r.chart,"interval");return p.adjust("symmetric"),r}function h4t(r){var t=r.chart,e=r.options,i=e.isTransposed;return t.coordinate({type:"rect",actions:i?[]:[["transpose"],["scale",1,-1]]}),r}function XU(r){var t=r.options,e=r.chart,i=t.maxSize,n=L(e,["geometries","0","dataArray"],[]),a=L(e,["options","data","length"]),o=Ne(n,function(l){return L(l,["0","nextPoints","0","x"])*a-.5}),s=function(l,u,c,h){var f=i-(i-l[Hs])/2;return S(S({},h),{start:[o[u-1]||u-.5,f],end:[o[u-1]||u-.5,f+.05]})};return QT(s)(r),r}function YU(r){return bt(u4t,c4t,h4t,XU)(r)}function f4t(r){var t,e=r.chart,i=r.options,n=i.data,a=n===void 0?[]:n,o=i.yField;return e.data(a),e.scale((t={},t[o]={sync:!0},t)),r}function d4t(r){var t=r.chart,e=r.options,i=e.data,n=e.xField,a=e.yField,o=e.color,s=e.compareField,l=e.isTransposed,u=e.tooltip,c=e.maxSize,h=e.minSize,f=e.label,d=e.funnelStyle,v=e.state,p=e.showFacetTitle;return t.facet("mirror",{fields:[s],transpose:!l,padding:l?0:[32,0,0,0],showTitle:p,eachView:function(g,m){var y=l?m.rowIndex:m.columnIndex;l||g.coordinate({type:"rect",actions:[["transpose"],["scale",y===0?-1:1,-1]]});var _=KT(m.data,i,{yField:a,maxSize:c,minSize:h});g.data(_);var x=ta(u,[n,a,s]),C=x.fields,A=x.formatter,T=l?{offset:y===0?10:-23,position:y===0?"bottom":"top"}:{offset:10,position:"left",style:{textAlign:y===0?"end":"start"}};Ji({chart:g,options:{type:"interval",xField:n,yField:Hs,colorField:n,tooltipFields:Z(C)&&C.concat([zs,qa]),mapping:{shape:"funnel",tooltip:A,color:o,style:d},label:f===!1?!1:$({},T,f),state:v}})}}),r}function jU(r){var t=r.chart,e=r.index,i=r.options,n=i.conversionTag,a=i.isTransposed;(Mt(e)?[t]:t.views).forEach(function(o,s){var l=L(o,["geometries","0","dataArray"],[]),u=L(o,["options","data","length"]),c=Ne(l,function(f){return L(f,["0","nextPoints","0","x"])*u-.5}),h=function(f,d,v,p){var g=(e||s)===0?-1:1;return $({},p,{start:[c[d-1]||d-.5,f[Hs]],end:[c[d-1]||d-.5,f[Hs]+.05],text:a?{style:{textAlign:"start"}}:{offsetX:n!==!1?g*n.offsetX:0,style:{textAlign:(e||s)===0?"end":"start"}}})};QT(h)($({},{chart:o,options:i}))})}function v4t(r){var t=r.chart;return t.once("beforepaint",function(){return jU(r)}),r}function p4t(r){return bt(f4t,d4t,v4t)(r)}function g4t(r){var t=r.chart,e=r.options,i=e.data,n=i===void 0?[]:i,a=e.yField,o=oi(n,function(u,c){return u+(c[a]||0)},0),s=zB(n,a)[a],l=Ne(n,function(u,c){var h=[],f=[];if(u[UC]=(u[a]||0)/o,c){var d=n[c-1][Md],v=n[c-1][Id];h[0]=d[3],f[0]=v[3],h[1]=d[2],f[1]=v[2]}else h[0]=-.5,f[0]=1,h[1]=.5,f[1]=1;return f[2]=f[1]-u[UC],h[2]=(f[2]+1)/4,f[3]=f[2],h[3]=-h[2],u[Md]=h,u[Id]=f,u[zs]=(u[a]||0)/s,u[qa]=[L(n,[c-1,a]),u[a]],u});return t.data(l),r}function m4t(r){var t=r.chart,e=r.options,i=e.xField,n=e.yField,a=e.color,o=e.tooltip,s=e.label,l=e.funnelStyle,u=e.state,c=ta(o,[i,n]),h=c.fields,f=c.formatter;return Ji({chart:t,options:{type:"polygon",xField:Md,yField:Id,colorField:i,tooltipFields:Z(h)&&h.concat([zs,qa]),label:s,state:u,mapping:{tooltip:f,color:a,style:l}}}),r}function y4t(r){var t=r.chart,e=r.options,i=e.isTransposed;return t.coordinate({type:"rect",actions:i?[["transpose"],["reflect","x"]]:[]}),r}function _4t(r){var t=function(e,i,n,a){return S(S({},a),{start:[e[Md][1],e[Id][1]],end:[e[Md][1]+.05,e[Id][1]]})};return QT(t)(r),r}function x4t(r){return bt(g4t,m4t,y4t,_4t)(r)}function C4t(r){var t,e=r.chart,i=r.options,n=i.data,a=n===void 0?[]:n,o=i.yField;return e.data(a),e.scale((t={},t[o]={sync:!0},t)),r}function E4t(r){var t=r.chart,e=r.options,i=e.seriesField,n=e.isTransposed,a=e.showFacetTitle;return t.facet("rect",{fields:[i],padding:[n?0:32,10,0,10],showTitle:a,eachView:function(o,s){YU($({},r,{chart:o,options:{data:s.data}}))}}),r}function S4t(r){return bt(C4t,E4t)(r)}var A4t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.rendering=!1,e}return t.prototype.change=function(e){var i=this;if(!this.rendering){var n=e.seriesField,a=e.compareField,o=a?jU:XU,s=this.context.view,l=n||a?s.views:[s];Ne(l,function(u,c){var h=u.getController("annotation"),f=Ur(L(h,["option"],[]),function(v){var p=v.name;return p!==GU});h.clear(!0),R(f,function(v){typeof v=="object"&&u.annotation()[v.type](v)});var d=L(u,["filteredData"],u.getOptions().data);o({chart:u,index:c,options:S(S({},e),{filteredData:KT(d,d,e)})}),u.filterData(d),i.rendering=!0,u.render(!0)})}this.rendering=!1},t}(Fe),ZU="funnel-conversion-tag",zC="funnel-afterrender",qU={trigger:"afterrender",action:"".concat(ZU,":change")};xt(ZU,A4t);Ot(zC,{start:[qU]});function T4t(r){var t=r.options,e=t.compareField,i=t.xField,n=t.yField,a=t.locale,o=t.funnelStyle,s=t.data,l=Ty(a),u={label:e?{fields:[i,n,e,zs,qa],formatter:function(h){return"".concat(h[n])}}:{fields:[i,n,zs,qa],offset:0,position:"middle",formatter:function(h){return"".concat(h[i]," ").concat(h[n])}},tooltip:{title:i,formatter:function(h){return{name:h[i],value:h[n]}}},conversionTag:{formatter:function(h){return"".concat(l.get(["conversionTag","label"]),": ").concat(HU.apply(void 0,h[qa]))}}},c;return(e||o)&&(c=function(h){return $({},e&&{lineWidth:1,stroke:"#fff"},ut(o)?o(h):o)}),$({options:u},r,{options:{funnelStyle:c,data:Dr(s)}})}function b4t(r){var t=r.options,e=t.compareField,i=t.dynamicHeight,n=t.seriesField;return n?S4t(r):e?p4t(r):i?x4t(r):YU(r)}function w4t(r){var t,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return bt(Je((t={},t[a]=i,t[o]=n,t)))(r)}function R4t(r){var t=r.chart;return t.axis(!1),r}function M4t(r){var t=r.chart,e=r.options,i=e.legend;return i===!1?t.legend(!1):t.legend(i),r}function I4t(r){var t=r.chart,e=r.options,i=e.interactions,n=e.dynamicHeight;return R(i,function(a){a.enable===!1?t.removeInteraction(a.type):t.interaction(a.type,a.cfg||{})}),n?t.removeInteraction(zC):t.interaction(zC,{start:[S(S({},qU),{arg:e})]}),r}function KU(r){return bt(T4t,b4t,w4t,R4t,yr,I4t,M4t,xe,ae,$e())(r)}var QU=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="funnel",e}return t.getDefaultOptions=function(){return l4t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return KU},t.prototype.setState=function(e,i,n){n===void 0&&(n=!0);var a=Rd(this.chart);R(a,function(o){i(o.getData())&&o.setState(e,n)})},t.prototype.getStates=function(){var e=Rd(this.chart),i=[];return R(e,function(n){var a=n.getData(),o=n.getStates();R(o,function(s){i.push({data:a,state:s,geometry:n.geometry,element:n})})}),i},t.CONVERSATION_FIELD=qa,t.PERCENT_FIELD=zs,t.TOTAL_PERCENT_FIELD=UC,t}(Ft);const Ozt=Object.freeze(Object.defineProperty({__proto__:null,FUNNEL_CONVERSATION_FIELD:qa,Funnel:QU},Symbol.toStringTag,{value:"Module"}));var kp,JT="range",JU="type",Ro="percent",L4t="#f0f0f0",t9="indicator-view",e9="range-view",O4t={percent:0,range:{ticks:[]},innerRadius:.9,radius:.95,startAngle:-7/6*Math.PI,endAngle:1/6*Math.PI,syncViewPadding:!0,axis:{line:null,label:{offset:-24,style:{textAlign:"center",textBaseline:"middle"}},subTickLine:{length:-8},tickLine:{length:-12},grid:null},indicator:{pointer:{style:{lineWidth:5,lineCap:"round"}},pin:{style:{r:9.75,lineWidth:4.5,fill:"#fff"}}},statistic:{title:!1},meta:(kp={},kp[JT]={sync:"v"},kp[Ro]={sync:"v",tickCount:5,tickInterval:.2},kp),animation:!1};function P4t(r,t){return r.map(function(e,i){var n;return n={},n[JT]=e-(r[i-1]||0),n[JU]="".concat(i),n[Ro]=t,n})}function r9(r){var t;return[(t={},t[Ro]=Be(r,0,1),t)]}function i9(r,t){var e=L(t,["ticks"],[]),i=Tr(e)?Gl(e):[0,Be(r,0,1),1];return i[0]||i.shift(),P4t(i,r)}function F4t(r){var t=r.chart,e=r.options,i=e.percent,n=e.range,a=e.radius,o=e.innerRadius,s=e.startAngle,l=e.endAngle,u=e.axis,c=e.indicator,h=e.gaugeStyle,f=e.type,d=e.meter,v=n.color,p=n.width;if(c){var g=r9(i),m=t.createView({id:t9});m.data(g),m.point().position("".concat(Ro,"*1")).shape(c.shape||"gauge-indicator").customInfo({defaultColor:t.getTheme().defaultColor,indicator:c}),m.coordinate("polar",{startAngle:s,endAngle:l,radius:o*a}),m.axis(Ro,u),m.scale(Ro,ge(u,zi))}var y=i9(i,e.range),_=t.createView({id:e9});_.data(y);var x=mt(v)?[v,L4t]:v,C=Kr({chart:_,options:{xField:"1",yField:JT,seriesField:JU,rawFields:[Ro],isStack:!0,interval:{color:x,style:h,shape:f==="meter"?"meter-gauge":null},args:{zIndexReversed:!0,sortZIndex:!0},minColumnWidth:p,maxColumnWidth:p}}).ext,A=C.geometry;return A.customInfo({meter:d}),_.coordinate("polar",{innerRadius:o,radius:a,startAngle:s,endAngle:l}).transpose(),r}function B4t(r){var t;return bt(Je((t={range:{min:0,max:1,maxLimit:1,minLimit:0}},t[Ro]={},t)))(r)}function n9(r,t){var e=r.chart,i=r.options,n=i.statistic,a=i.percent;if(e.getController("annotation").clear(!0),n){var o=n.content,s=void 0;o&&(s=$({},{content:"".concat((a*100).toFixed(2),"%"),style:{opacity:.75,fontSize:"30px",lineHeight:1,textAlign:"center",color:"rgba(44,53,66,0.85)"}},o)),v5t(e,{statistic:S(S({},n),{content:s})},{percent:a})}return t&&e.render(!0),r}function D4t(r){var t=r.chart,e=r.options,i=e.tooltip;return i?t.tooltip($({showTitle:!1,showMarkers:!1,containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',domStyles:{"g2-tooltip":{padding:"4px 8px",fontSize:"10px"}},customContent:function(n,a){var o=L(a,[0,"data",Ro],0);return"".concat((o*100).toFixed(2),"%")}},i)):t.tooltip(!1),r}function N4t(r){var t=r.chart;return t.legend(!1),r}function a9(r){return bt(ae,xe,F4t,B4t,D4t,n9,Ue,$e(),N4t)(r)}he("point","gauge-indicator",{draw:function(r,t){var e=r.customInfo,i=e.indicator,n=e.defaultColor,a=i,o=a.pointer,s=a.pin,l=t.addGroup(),u=this.parsePoint({x:0,y:0});return o&&l.addShape("line",{name:"pointer",attrs:S({x1:u.x,y1:u.y,x2:r.x,y2:r.y,stroke:n},o.style)}),s&&l.addShape("circle",{name:"pin",attrs:S({x:u.x,y:u.y,stroke:n},s.style)}),l}});he("interval","meter-gauge",{draw:function(r,t){var e=r.customInfo.meter,i=e===void 0?{}:e,n=i.steps,a=n===void 0?50:n,o=i.stepRatio,s=o===void 0?.5:o;a=a<1?1:a,s=Be(s,0,1);var l=this.coordinate,u=l.startAngle,c=l.endAngle,h=0;if(s>0&&s<1){var f=c-u;h=f/a/(s/(1-s)+1-1/a)}for(var d=h/(1-s)*s,v=t.addGroup(),p=this.coordinate.getCenter(),g=this.coordinate.getRadius(),m=Zi.getAngle(r,this.coordinate),y=m.startAngle,_=m.endAngle,x=y;x<_;){var C=void 0,A=(x-u)%(d+h);A<d?C=x+(d-A):(x+=d+h-A,C=x+d);var T=Zi.getSectorPath(p.x,p.y,g,x,Math.min(C,_),g*this.coordinate.innerRadius);v.addShape("path",{name:"meter-gauge",attrs:{path:T,fill:r.color,stroke:r.color,lineWidth:.5}}),x=C+h}return v}});var o9=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="gauge",e}return t.getDefaultOptions=function(){return O4t},t.prototype.changeData=function(e){this.chart.emit(kt.BEFORE_CHANGE_DATA,He.fromData(this.chart,kt.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:e});var i=this.chart.views.find(function(a){return a.id===t9});i&&i.data(r9(e));var n=this.chart.views.find(function(a){return a.id===e9});n&&n.data(i9(e,this.options.range)),n9({chart:this.chart,options:this.options},!0),this.chart.emit(kt.AFTER_CHANGE_DATA,He.fromData(this.chart,kt.AFTER_CHANGE_DATA,null))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return a9},t}(Ft);const Pzt=Object.freeze(Object.defineProperty({__proto__:null,Gauge:o9},Symbol.toStringTag,{value:"Module"}));function JO(r,t,e){if(e===1)return[0,t];var i=Math.floor(r/t);return[t*i,t*(i+1)]}function k4t(r){return Math.ceil(Math.log(r.length)/Math.LN2)+1}function s9(r,t,e,i,n){var a=Dr(r);sit(a,t);var o=xa(a,t),s=kB(o),l=s.max-s.min,u=e;if(!e&&i&&(u=i>1?l/(i-1):s.max),!e&&!i){var c=k4t(o);u=l/c}var h={},f=cn(a,n);Gi(f)?R(a,function(v){var p=v[t],g=JO(p,u,i),m="".concat(g[0],"-").concat(g[1]);ws(h,m)||(h[m]={range:g,count:0}),h[m].count+=1}):Object.keys(f).forEach(function(v){R(f[v],function(p){var g=p[t],m=JO(g,u,i),y="".concat(m[0],"-").concat(m[1]),_="".concat(y,"-").concat(v);ws(h,_)||(h[_]={range:m,count:0},h[_][n]=v),h[_].count+=1})});var d=[];return R(h,function(v){d.push(v)}),d}var O0="range",Ld="count",U4t=$({},Ft.getDefaultOptions(),{columnStyle:{stroke:"#FFFFFF"},tooltip:{shared:!0,showMarkers:!1},interactions:[{type:"active-region"}]});function z4t(r){var t=r.chart,e=r.options,i=e.data,n=e.binField,a=e.binNumber,o=e.binWidth,s=e.color,l=e.stackField,u=e.legend,c=e.columnStyle,h=s9(i,n,o,a,l);t.data(h);var f=$({},r,{options:{xField:O0,yField:Ld,seriesField:l,isStack:!0,interval:{color:s,style:c}}});return Kr(f),u&&l?t.legend(l,u):t.legend(!1),r}function H4t(r){var t,e=r.options,i=e.xAxis,n=e.yAxis;return bt(Je((t={},t[O0]=i,t[Ld]=n,t)))(r)}function $4t(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis;return i===!1?t.axis(O0,!1):t.axis(O0,i),n===!1?t.axis(Ld,!1):t.axis(Ld,n),r}function W4t(r){var t=r.chart,e=r.options,i=e.label,n=qr(t,"interval");if(!i)n.label(!1);else{var a=i.callback,o=Ut(i,["callback"]);n.label({fields:[Ld],callback:a,cfg:Mr(o)})}return r}function l9(r){return bt(ae,Sn("columnStyle"),z4t,H4t,$4t,Js,W4t,yr,Ue,xe)(r)}var V4t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="histogram",e}return t.getDefaultOptions=function(){return U4t},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this.options,n=i.binField,a=i.binNumber,o=i.binWidth,s=i.stackField;this.chart.changeData(s9(e,n,o,a,s))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return l9},t}(Ft),G4t=$({},Ft.getDefaultOptions(),{tooltip:{shared:!0,showMarkers:!0,showCrosshairs:!0,crosshairs:{type:"x"}},legend:{position:"top-left",radio:{}},isStack:!1}),X4t=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.active=function(){var e=this.getView(),i=this.context.event;if(i.data){var n=i.data.items,a=e.geometries.filter(function(o){return o.type==="point"});R(a,function(o){R(o.elements,function(s){var l=NB(n,function(u){return u.data===s.data})!==-1;s.setState("active",l)})})}},t.prototype.reset=function(){var e=this.getView(),i=e.geometries.filter(function(n){return n.type==="point"});R(i,function(n){R(n.elements,function(a){a.setState("active",!1)})})},t.prototype.getView=function(){return this.context.view},t}(Fe);xt("marker-active",X4t);Ot("marker-active",{start:[{trigger:"tooltip:show",action:"marker-active:active"}],end:[{trigger:"tooltip:hide",action:"marker-active:reset"}]});var u9=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="line",e}return t.getDefaultOptions=function(){return G4t},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this,n=i.chart,a=i.options;Ry({chart:n,options:a}),this.chart.changeData(e)},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return NU},t}(Ft);const Fzt=Object.freeze(Object.defineProperty({__proto__:null,Line:u9},Symbol.toStringTag,{value:"Module"}));var c9=$({},Ft.getDefaultOptions(),{legend:{position:"right",radio:{}},tooltip:{shared:!1,showTitle:!1,showMarkers:!1},label:{layout:{type:"limit-in-plot",cfg:{action:"ellipsis"}}},pieStyle:{stroke:"white",lineWidth:1},statistic:{title:{style:{fontWeight:300,color:"#4B535E",textAlign:"center",fontSize:"20px",lineHeight:1}},content:{style:{fontWeight:"bold",color:"rgba(44,53,66,0.85)",textAlign:"center",fontSize:"32px",lineHeight:1}}},theme:{components:{annotation:{text:{animate:!1}}}}}),Y4t=[1,0,0,0,1,0,0,0,1];function HC(r,t){var e=t?_t([],t,!0):_t([],Y4t,!0);return Zi.transform(e,r)}var j4t=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getActiveElements=function(){var e=Zi.getDelegationObject(this.context);if(e){var i=this.context.view,n=e.component,a=e.item,o=n.get("field");if(o){var s=i.geometries[0].elements;return s.filter(function(l){return l.getModel().data[o]===a.value})}}return[]},t.prototype.getActiveElementLabels=function(){var e=this.context.view,i=this.getActiveElements(),n=e.geometries[0].labelsContainer.getChildren();return n.filter(function(a){return i.find(function(o){return Jt(o.getData(),a.get("data"))})})},t.prototype.transfrom=function(e){e===void 0&&(e=7.5);var i=this.getActiveElements(),n=this.getActiveElementLabels();i.forEach(function(a,o){var s=n[o],l=a.geometry.coordinate;if(l.isPolar&&l.isTransposed){var u=Zi.getAngle(a.getModel(),l),c=u.startAngle,h=u.endAngle,f=(c+h)/2,d=e,v=d*Math.cos(f),p=d*Math.sin(f);a.shape.setMatrix(HC([["t",v,p]])),s.setMatrix(HC([["t",v,p]]))}})},t.prototype.active=function(){this.transfrom()},t.prototype.reset=function(){this.transfrom(0)},t}(Fe);function Z4t(r){var t=r.event,e,i=t.target;return i&&(e=i.get("element")),e}var q4t=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getAnnotations=function(e){var i=e||this.context.view;return i.getController("annotation").option},t.prototype.getInitialAnnotation=function(){return this.initialAnnotation},t.prototype.init=function(){var e=this,i=this.context.view;i.removeInteraction("tooltip"),i.on("afterchangesize",function(){var n=e.getAnnotations(i);e.initialAnnotation=n})},t.prototype.change=function(e){var i=this.context,n=i.view,a=i.event;this.initialAnnotation||(this.initialAnnotation=this.getAnnotations());var o=L(a,["data","data"]);if(a.type.match("legend-item")){var s=Zi.getDelegationObject(this.context),l=n.getGroupedFields()[0];if(s&&l){var u=s.item;o=n.getData().find(function(d){return d[l]===u.value})}}if(o){var c=L(e,"annotations",[]),h=L(e,"statistic",{});n.getController("annotation").clear(!0),R(c,function(d){typeof d=="object"&&n.annotation()[d.type](d)}),Sy(n,{statistic:h,plotType:"pie"},o),n.render(!0)}var f=Z4t(this.context);f&&f.shape.toFront()},t.prototype.reset=function(){var e=this.context.view,i=e.getController("annotation");i.clear(!0);var n=this.getInitialAnnotation();R(n,function(a){e.annotation()[a.type](a)}),e.render(!0)},t}(Fe),h9="pie-statistic";xt(h9,q4t);Ot("pie-statistic-active",{start:[{trigger:"element:mouseenter",action:"pie-statistic:change"}],end:[{trigger:"element:mouseleave",action:"pie-statistic:reset"}]});xt("pie-legend",j4t);Ot("pie-legend-active",{start:[{trigger:"legend-item:mouseenter",action:"pie-legend:active"}],end:[{trigger:"legend-item:mouseleave",action:"pie-legend:reset"}]});function K4t(r,t){var e=null;return R(r,function(i){typeof i[t]=="number"&&(e+=i[t])}),e}function Q4t(r,t){var e;switch(r){case"inner":return e="-30%",mt(t)&&t.endsWith("%")?parseFloat(t)*.01>0?e:t:t<0?t:e;case"outer":return e=12,mt(t)&&t.endsWith("%")?parseFloat(t)*.01<0?e:t:t>0?t:e;default:return t}}function P0(r,t){return DE(Gc(r,t),function(e){return e[t]===0})}function J4t(r){var t=r.chart,e=r.options,i=e.data,n=e.angleField,a=e.colorField,o=e.color,s=e.pieStyle,l=e.shape,u=Gc(i,n);if(P0(u,n)){var c="$$percentage$$";u=u.map(function(f){var d;return S(S({},f),(d={},d[c]=1/u.length,d))}),t.data(u);var h=$({},r,{options:{xField:"1",yField:c,seriesField:a,isStack:!0,interval:{color:o,shape:l,style:s},args:{zIndexReversed:!0,sortZIndex:!0}}});Kr(h)}else{t.data(u);var h=$({},r,{options:{xField:"1",yField:n,seriesField:a,isStack:!0,interval:{color:o,shape:l,style:s},args:{zIndexReversed:!0,sortZIndex:!0}}});Kr(h)}return r}function tNt(r){var t,e=r.chart,i=r.options,n=i.meta,a=i.colorField,o=$({},n);return e.scale(o,(t={},t[a]={type:"cat"},t)),r}function eNt(r){var t=r.chart,e=r.options,i=e.radius,n=e.innerRadius,a=e.startAngle,o=e.endAngle;return t.coordinate({type:"theta",cfg:{radius:i,innerRadius:n,startAngle:a,endAngle:o}}),r}function rNt(r){var t=r.chart,e=r.options,i=e.label,n=e.colorField,a=e.angleField,o=t.geometries[0];if(!i)o.label(!1);else{var s=i.callback,l=Ut(i,["callback"]),u=Mr(l);if(u.content){var c=u.content;u.content=function(v,p,g){var m=v[n],y=v[a],_=t.getScaleByField(a),x=_==null?void 0:_.scale(y);return ut(c)?c(S(S({},v),{percent:x}),p,g):mt(c)?wU(c,{value:y,name:m,percentage:Mt(x)&&!j(y)?"".concat((x*100).toFixed(2),"%"):null}):c}}var h={inner:"",outer:"pie-outer",spider:"pie-spider"},f=u.type?h[u.type]:"pie-outer",d=u.layout?Z(u.layout)?u.layout:[u.layout]:[];u.layout=(f?[{type:f}]:[]).concat(d),o.label({fields:n?[a,n]:[a],callback:s,cfg:S(S({},u),{offset:Q4t(u.type,u.offset),type:"pie"})})}return r}function f9(r){var t=r.innerRadius,e=r.statistic,i=r.angleField,n=r.colorField,a=r.meta,o=r.locale,s=Ty(o);if(t&&e){var l=$({},c9.statistic,e),u=l.title,c=l.content;return u!==!1&&(u=$({},{formatter:function(h){var f=h?h[n]:j(u.content)?s.get(["statistic","total"]):u.content,d=L(a,[n,"formatter"])||function(v){return v};return d(f)}},u)),c!==!1&&(c=$({},{formatter:function(h,f){var d=h?h[i]:K4t(f,i),v=L(a,[i,"formatter"])||function(p){return p};return h||j(c.content)?v(d):c.content}},c)),$({},{statistic:{title:u,content:c}},r)}return r}function d9(r){var t=r.chart,e=r.options,i=f9(e),n=i.innerRadius,a=i.statistic;return t.getController("annotation").clear(!0),bt($e())(r),n&&a&&Sy(t,{statistic:a,plotType:"pie"}),r}function iNt(r){var t=r.chart,e=r.options,i=e.tooltip,n=e.colorField,a=e.angleField,o=e.data;if(i===!1)t.tooltip(i);else if(t.tooltip($({},i,{shared:!1})),P0(o,a)){var s=L(i,"fields"),l=L(i,"formatter");Gi(L(i,"fields"))&&(s=[n,a],l=l||function(u){return{name:u[n],value:Vd(u[a])}}),t.geometries[0].tooltip(s.join("*"),Hu(s,l))}return r}function nNt(r){var t=r.chart,e=r.options,i=f9(e),n=i.interactions,a=i.statistic,o=i.annotations;return R(n,function(s){var l,u;if(s.enable===!1)t.removeInteraction(s.type);else if(s.type==="pie-statistic-active"){var c=[];!((l=s.cfg)===null||l===void 0)&&l.start||(c=[{trigger:"element:mouseenter",action:"".concat(h9,":change"),arg:{statistic:a,annotations:o}}]),R((u=s.cfg)===null||u===void 0?void 0:u.start,function(h){c.push(S(S({},h),{arg:{statistic:a,annotations:o}}))}),t.interaction(s.type,$({},s.cfg,{start:c}))}else t.interaction(s.type,s.cfg||{})}),r}function v9(r){return bt(Sn("pieStyle"),J4t,tNt,ae,eNt,gh,iNt,rNt,Js,d9,nNt,xe)(r)}var p9=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="pie",e}return t.getDefaultOptions=function(){return c9},t.prototype.changeData=function(e){this.chart.emit(kt.BEFORE_CHANGE_DATA,He.fromData(this.chart,kt.BEFORE_CHANGE_DATA,null));var i=this.options,n=this.options.angleField,a=Gc(i.data,n),o=Gc(e,n);P0(a,n)||P0(o,n)?this.update({data:e}):(this.updateOption({data:e}),this.chart.data(o),d9({chart:this.chart,options:this.options}),this.chart.render(!0)),this.chart.emit(kt.AFTER_CHANGE_DATA,He.fromData(this.chart,kt.AFTER_CHANGE_DATA,null))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return v9},t}(Ft);const Bzt=Object.freeze(Object.defineProperty({__proto__:null,Pie:p9},Symbol.toStringTag,{value:"Module"}));var g9=["#FAAD14","#E8EDF3"],aNt={percent:.2,color:g9,animation:{}};function tb(r){var t=Be(ou(r)?r:0,0,1);return[{current:"".concat(t),type:"current",percent:t},{current:"".concat(t),type:"target",percent:1}]}function m9(r){var t=r.chart,e=r.options,i=e.percent,n=e.progressStyle,a=e.color,o=e.barWidthRatio;t.data(tb(i));var s=$({},r,{options:{xField:"current",yField:"percent",seriesField:"type",widthRatio:o,interval:{style:n,color:mt(a)?[a,g9[1]]:a},args:{zIndexReversed:!0,sortZIndex:!0}}});return Kr(s),t.tooltip(!1),t.axis(!1),t.legend(!1),r}function oNt(r){var t=r.chart;return t.coordinate("rect").transpose(),r}function y9(r){return bt(m9,Je({}),oNt,xe,ae,$e())(r)}var sNt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="process",e}return t.getDefaultOptions=function(){return aNt},t.prototype.changeData=function(e){this.updateOption({percent:e}),this.chart.changeData(tb(e))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return y9},t}(Ft);function lNt(r){var t=r.chart,e=r.options,i=e.innerRadius,n=e.radius;return t.coordinate("theta",{innerRadius:i,radius:n}),r}function _9(r,t){var e=r.chart,i=r.options,n=i.innerRadius,a=i.statistic,o=i.percent,s=i.meta;if(e.getController("annotation").clear(!0),n&&a){var l=L(s,["percent","formatter"])||function(c){return"".concat((c*100).toFixed(2),"%")},u=a.content;u&&(u=$({},u,{content:j(u.content)?l(o):u.content})),Sy(e,{statistic:S(S({},a),{content:u}),plotType:"ring-progress"},{percent:o})}return t&&e.render(!0),r}function x9(r){return bt(m9,Je({}),lNt,_9,xe,ae,$e())(r)}var uNt={percent:.2,innerRadius:.8,radius:.98,color:["#FAAD14","#E8EDF3"],statistic:{title:!1,content:{style:{fontSize:"14px",fontWeight:300,fill:"#4D4D4D",textAlign:"center",textBaseline:"middle"}}},animation:{}},cNt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="ring-process",e}return t.getDefaultOptions=function(){return uNt},t.prototype.changeData=function(e){this.chart.emit(kt.BEFORE_CHANGE_DATA,He.fromData(this.chart,kt.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:e}),this.chart.data(tb(e)),_9({chart:this.chart,options:this.options},!0),this.chart.emit(kt.AFTER_CHANGE_DATA,He.fromData(this.chart,kt.AFTER_CHANGE_DATA,null))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return x9},t}(Ft),hNt={exp:UH,linear:zH,loess:HH,log:$H,poly:WH,pow:VH,quad:GH};function fNt(r,t){var e=10,i={regionStyle:[{position:{start:[r,"max"],end:["max",t]},style:{fill:"#d8d0c0",opacity:.4}},{position:{start:["min","max"],end:[r,t]},style:{fill:"#a3dda1",opacity:.4}},{position:{start:["min",t],end:[r,"min"]},style:{fill:"#d8d0c0",opacity:.4}},{position:{start:[r,t],end:["max","min"]},style:{fill:"#a3dda1",opacity:.4}}],lineStyle:{stroke:"#9ba29a",lineWidth:1},labelStyle:[{position:["max",t],offsetX:-e,offsetY:-e,style:{textAlign:"right",textBaseline:"bottom",fontSize:14,fill:"#ccc"}},{position:["min",t],offsetX:e,offsetY:-e,style:{textAlign:"left",textBaseline:"bottom",fontSize:14,fill:"#ccc"}},{position:["min",t],offsetX:e,offsetY:e,style:{textAlign:"left",textBaseline:"top",fontSize:14,fill:"#ccc"}},{position:["max",t],offsetX:-e,offsetY:e,style:{textAlign:"right",textBaseline:"top",fontSize:14,fill:"#ccc"}}]};return i}var dNt=function(r,t){var e=t.view,i=t.options,n=i.xField,a=i.yField,o=e.getScaleByField(n),s=e.getScaleByField(a),l=r.map(function(u){return e.getCoordinate().convert({x:o.scale(u[0]),y:s.scale(u[1])})});return d5t(l,!1)},vNt=function(r){var t=r.options,e=t.xField,i=t.yField,n=t.data,a=t.regressionLine,o=a.type,s=o===void 0?"linear":o,l=a.algorithm,u=a.equation,c,h=null;if(l)c=Z(l)?l:l(n),h=u;else{var f=hNt[s]().x(function(d){return d[e]}).y(function(d){return d[i]});c=f(n),h=gNt(s,c)}return[dNt(c,r),h]},pNt=function(r){var t,e=r.meta,i=e===void 0?{}:e,n=r.xField,a=r.yField,o=r.data,s=o[0][n],l=o[0][a],u=s>0,c=l>0;function h(f,d){var v=L(i,[f]);function p(m){return L(v,m)}var g={};return d==="x"?(Mt(s)&&(Mt(p("min"))||(g.min=u?0:s*2),Mt(p("max"))||(g.max=u?s*2:0)),g):(Mt(l)&&(Mt(p("min"))||(g.min=c?0:l*2),Mt(p("max"))||(g.max=c?l*2:0)),g)}return S(S({},i),(t={},t[n]=S(S({},i[n]),h(n,"x")),t[a]=S(S({},i[a]),h(a,"y")),t))};function gNt(r,t){var e,i,n,a=function(u,c){return c===void 0&&(c=4),Math.round(u*Math.pow(10,c))/Math.pow(10,c)},o=function(u){return Number.isFinite(u)?a(u):"?"};switch(r){case"linear":return"y = ".concat(o(t.a),"x + ").concat(o(t.b),", R^2 = ").concat(o(t.rSquared));case"exp":return"y = ".concat(o(t.a),"e^(").concat(o(t.b),"x), R^2 = ").concat(o(t.rSquared));case"log":return"y = ".concat(o(t.a),"ln(x) + ").concat(o(t.b),", R^2 = ").concat(o(t.rSquared));case"quad":return"y = ".concat(o(t.a),"x^2 + ").concat(o(t.b),"x + ").concat(o(t.c),", R^2 = ").concat(o(t.rSquared));case"poly":for(var s="y = ".concat(o((e=t.coefficients)===null||e===void 0?void 0:e[0])," + ").concat(o((i=t.coefficients)===null||i===void 0?void 0:i[1]),"x + ").concat(o((n=t.coefficients)===null||n===void 0?void 0:n[2]),"x^2"),l=3;l<t.coefficients.length;++l)s+=" + ".concat(o(t.coefficients[l]),"x^").concat(l);return"".concat(s,", R^2 = ").concat(o(t.rSquared));case"pow":return"y = ".concat(o(t.a),"x^").concat(o(t.b),", R^2 = ").concat(o(t.rSquared))}return null}function C9(r){var t=r.data,e=t===void 0?[]:t,i=r.xField,n=r.yField;if(e.length){for(var a=!0,o=!0,s=e[0],l=void 0,u=1;u<e.length&&(l=e[u],s[i]!==l[i]&&(a=!1),s[n]!==l[n]&&(o=!1),!(!a&&!o));u++)s=l;var c=[];a&&c.push(i),o&&c.push(n);var h=ge(pNt(r),c);return $({},r,{meta:h})}return r}function mNt(r){var t=r.chart,e=r.options,i=e.data,n=e.type,a=e.color,o=e.shape,s=e.pointStyle,l=e.shapeField,u=e.colorField,c=e.xField,h=e.yField,f=e.sizeField,d=e.size,v=e.tooltip;f&&(d||(d=[2,8]),Mt(d)&&(d=[d,d])),v&&!v.fields&&(v=S(S({},v),{fields:[c,h,u,f,l]})),t.data(i),An($({},r,{options:{seriesField:u,point:{color:a,shape:o,size:d,style:s},tooltip:v}}));var p=qr(t,"point");return n&&p.adjust(n),r}function fg(r){var t,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField,s=C9(e);return bt(Je((t={},t[a]=i,t[o]=n,t)))($({},r,{options:s}))}function yNt(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return t.axis(a,i),t.axis(o,n),r}function _Nt(r){var t=r.chart,e=r.options,i=e.legend,n=e.colorField,a=e.shapeField,o=e.sizeField,s=e.shapeLegend,l=e.sizeLegend,u=i!==!1;return n&&t.legend(n,u?i:!1),a&&(s?t.legend(a,s):t.legend(a,s===!1?!1:i)),o&&t.legend(o,l||!1),!u&&!s&&!l&&t.legend(!1),r}function xNt(r){var t=r.chart,e=r.options,i=e.label,n=e.yField,a=qr(t,"point");if(!i)a.label(!1);else{var o=i.callback,s=Ut(i,["callback"]);a.label({fields:[n],callback:o,cfg:Mr(s)})}return r}function CNt(r){var t=r.options,e=t.quadrant,i=[];if(e){var n=e.xBaseline,a=n===void 0?0:n,o=e.yBaseline,s=o===void 0?0:o,l=e.labels,u=e.regionStyle,c=e.lineStyle,h=fNt(a,s),f=new Array(4).join(",").split(",");f.forEach(function(d,v){i.push(S(S({type:"region",top:!1},h.regionStyle[v].position),{style:$({},h.regionStyle[v].style,u==null?void 0:u[v])}),S({type:"text",top:!0},$({},h.labelStyle[v],l==null?void 0:l[v])))}),i.push({type:"line",top:!1,start:["min",s],end:["max",s],style:$({},h.lineStyle,c)},{type:"line",top:!1,start:[a,"min"],end:[a,"max"],style:$({},h.lineStyle,c)})}return bt($e(i))(r)}function ENt(r){var t=r.options,e=r.chart,i=t.regressionLine;if(i){var n=i.style,a=i.equationStyle,o=a===void 0?{}:a,s=i.top,l=s===void 0?!1:s,u=i.showEquation,c=u===void 0?!1:u,h={stroke:"#9ba29a",lineWidth:2,opacity:.5},f={x:20,y:20,textAlign:"left",textBaseline:"middle",fontSize:14,fillOpacity:.5};e.annotation().shape({top:l,render:function(d,v){var p=d.addGroup({id:"".concat(e.id,"-regression-line"),name:"regression-line-group"}),g=vNt({view:v,options:t}),m=g[0],y=g[1];p.addShape("path",{name:"regression-line",attrs:S(S({path:m},h),n)}),c&&p.addShape("text",{name:"regression-equation",attrs:S(S(S({},f),o),{text:y})})}})}return r}function SNt(r){var t=r.chart,e=r.options,i=e.tooltip;return i?t.tooltip(i):i===!1&&t.tooltip(!1),r}function E9(r){return bt(mNt,fg,yNt,_Nt,SNt,xNt,zU,yv,YT,Ue,CNt,xe,ae,ENt)(r)}var ANt=$({},Ft.getDefaultOptions(),{size:4,tooltip:{showTitle:!1,showMarkers:!1,showCrosshairs:!0,crosshairs:{type:"xy"}}});Ot("drag-move",{start:[{trigger:"plot:mousedown",action:"scale-translate:start"}],processing:[{trigger:"plot:mousemove",action:"scale-translate:translate",throttle:{wait:100,leading:!0,trailing:!1}}],end:[{trigger:"plot:mouseup",action:"scale-translate:end"}]});var S9=function(r){B(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.type="scatter",n.on(kt.BEFORE_RENDER,function(a){var o,s,l=n,u=l.options,c=l.chart;if(((o=a.data)===null||o===void 0?void 0:o.source)===Ii.FILTER){var h=n.chart.filterData(n.chart.getData());fg({chart:c,options:S(S({},u),{data:h})})}((s=a.data)===null||s===void 0?void 0:s.source)===Ii.RESET&&fg({chart:c,options:u})}),n}return t.getDefaultOptions=function(){return ANt},t.prototype.changeData=function(e){this.updateOption(C9($({},this.options,{data:e})));var i=this,n=i.options,a=i.chart;fg({chart:a,options:n}),this.chart.changeData(e)},t.prototype.getSchemaAdaptor=function(){return E9},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(Ft);const Dzt=Object.freeze(Object.defineProperty({__proto__:null,Scatter:S9},Symbol.toStringTag,{value:"Module"}));var Od="$$stock-range$$",Iy="trend",A9="up",T9="down",TNt={showMarkers:!1,showCrosshairs:!0,shared:!0,crosshairs:{type:"xy",follow:!0,text:function(r,t,e){var i;if(r==="x"){var n=e[0];i=n?n.title:t}else i=t;return{position:r==="y"?"start":"end",content:i,style:{fill:"#dfdfdf"}}},textBackground:{padding:[2,4],style:{fill:"#666"}}}},bNt=$({},Ft.getDefaultOptions(),{tooltip:TNt,interactions:[{type:"tooltip"}],legend:{position:"top-left"},risingFill:"#ef5350",fallingFill:"#26a69a"});function b9(r,t){return Ne(r,function(e){var i=e&&S({},e);if(Z(t)&&i){var n=t[0],a=t[1],o=t[2],s=t[3];i[Iy]=i[n]<=i[a]?A9:T9,i[Od]=[i[n],i[a],i[o],i[s]]}return i})}function wNt(r){var t=r.chart,e=r.options,i=e.yField,n=e.data,a=e.risingFill,o=e.fallingFill,s=e.tooltip,l=e.stockStyle;t.data(b9(n,i));var u=s;return u!==!1&&(u=$({},{fields:i},u)),jT($({},r,{options:{schema:{shape:"candle",color:[a,o],style:l},yField:Od,seriesField:Iy,rawFields:i,tooltip:u}})),r}function RNt(r){var t,e,i=r.chart,n=r.options,a=n.meta,o=n.xAxis,s=n.yAxis,l=n.xField,u=(t={},t[l]={type:"timeCat",tickCount:6},t[Iy]={values:[A9,T9]},t),c=$(u,a,(e={},e[l]=ge(o,zi),e[Od]=ge(s,zi),e));return i.scale(c),r}function MNt(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField;return i===!1?t.axis(a,!1):t.axis(a,i),n===!1?t.axis(Od,!1):t.axis(Od,n),r}function INt(r){var t=r.chart,e=r.options,i=e.tooltip;return i!==!1?t.tooltip(i):t.tooltip(!1),r}function LNt(r){var t=r.chart,e=r.options,i=e.legend;return i?t.legend(Iy,i):i===!1&&t.legend(!1),r}function w9(r){bt(ae,wNt,RNt,MNt,INt,LNt,Ue,xe,$e(),yv)(r)}var ONt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="stock",e}return t.getDefaultOptions=function(){return bNt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return w9},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this.options.yField;this.chart.changeData(b9(e,i))},t}(Ft);function Au(r){return Ne(r||[],function(t,e){return{x:"".concat(e),y:t}})}var Pd="x",mc="y",R9={showTitle:!1,shared:!0,showMarkers:!1,customContent:function(r,t){return"".concat(L(t,[0,"data","y"],0))},containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',itemTpl:"<span>{value}</span>",domStyles:{"g2-tooltip":{padding:"2px 4px",fontSize:"10px"}},showCrosshairs:!0,crosshairs:{type:"x"}},PNt={appendPadding:2,tooltip:S({},R9),animation:{}};function FNt(r){var t=r.chart,e=r.options,i=e.data,n=e.color,a=e.areaStyle,o=e.point,s=e.line,l=o==null?void 0:o.state,u=Au(i);t.data(u);var c=$({},r,{options:{xField:Pd,yField:mc,area:{color:n,style:a},line:s,point:o}}),h=$({},c,{options:{tooltip:!1}}),f=$({},c,{options:{tooltip:!1,state:l}});return by(c),mh(h),An(f),t.axis(!1),t.legend(!1),r}function yh(r){var t,e,i=r.options,n=i.xAxis,a=i.yAxis,o=i.data,s=Au(o);return bt(Je((t={},t[Pd]=n,t[mc]=a,t),(e={},e[Pd]={type:"cat"},e[mc]=$T(s,mc),e)))(r)}function M9(r){return bt(Sn("areaStyle"),FNt,yh,yr,ae,xe,$e())(r)}var BNt={appendPadding:2,tooltip:S({},R9),color:"l(90) 0:#E5EDFE 1:#ffffff",areaStyle:{fillOpacity:.6},line:{size:1,color:"#5B8FF9"},animation:{}},DNt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="tiny-area",e}return t.getDefaultOptions=function(){return BNt},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this,n=i.chart,a=i.options;yh({chart:n,options:a}),n.changeData(Au(e))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return M9},t}(Ft);function NNt(r){var t=r.chart,e=r.options,i=e.data,n=e.color,a=e.columnStyle,o=e.columnWidthRatio,s=Au(i);t.data(s);var l=$({},r,{options:{xField:Pd,yField:mc,widthRatio:o,interval:{style:a,color:n}}});return Kr(l),t.axis(!1),t.legend(!1),t.interaction("element-active"),r}function I9(r){return bt(ae,Sn("columnStyle"),NNt,yh,yr,xe,$e())(r)}var kNt={showTitle:!1,shared:!0,showMarkers:!1,customContent:function(r,t){return"".concat(L(t,[0,"data","y"],0))},containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',itemTpl:"<span>{value}</span>",domStyles:{"g2-tooltip":{padding:"2px 4px",fontSize:"10px"}}},UNt={appendPadding:2,tooltip:S({},kNt),animation:{}},zNt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="tiny-column",e}return t.getDefaultOptions=function(){return UNt},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this,n=i.chart,a=i.options;yh({chart:n,options:a}),n.changeData(Au(e))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return I9},t}(Ft);function HNt(r){var t=r.chart,e=r.options,i=e.data,n=e.color,a=e.lineStyle,o=e.point,s=o==null?void 0:o.state,l=Au(i);t.data(l);var u=$({},r,{options:{xField:Pd,yField:mc,line:{color:n,style:a},point:o}}),c=$({},u,{options:{tooltip:!1,state:s}});return mh(u),An(c),t.axis(!1),t.legend(!1),r}function L9(r){return bt(HNt,yh,ae,yr,xe,$e())(r)}var $Nt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="tiny-line",e}return t.getDefaultOptions=function(){return PNt},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this,n=i.chart,a=i.options;yh({chart:n,options:a}),n.changeData(Au(e))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return L9},t}(Ft),WNt={line:NU,pie:v9,column:My,bar:$U,area:kU,gauge:a9,"tiny-line":L9,"tiny-column":I9,"tiny-area":M9,"ring-progress":x9,progress:y9,scatter:E9,histogram:l9,funnel:KU,stock:w9},VNt={line:u9,pie:p9,column:VU,bar:WU,area:UU,gauge:o9,"tiny-line":$Nt,"tiny-column":zNt,"tiny-area":DNt,"ring-progress":cNt,progress:sNt,scatter:S9,histogram:V4t,funnel:QU,stock:ONt},GNt={pie:{label:!1},column:{tooltip:{showMarkers:!1}},bar:{tooltip:{showMarkers:!1}}};function $C(r,t,e){var i=VNt[r];if(!i){console.error("could not find ".concat(r," plot"));return}var n=WNt[r];n({chart:t,options:$({},i.getDefaultOptions(),L(GNt,r,{}),e)})}function XNt(r){var t=r.chart,e=r.options,i=e.views,n=e.legend;return R(i,function(a){var o=a.region,s=a.data,l=a.meta,u=a.axes,c=a.coordinate,h=a.interactions,f=a.annotations,d=a.tooltip,v=a.geometries,p=t.createView({region:o});p.data(s);var g={};u&&R(u,function(m,y){g[y]=ge(m,zi)}),g=$({},l,g),p.scale(g),u?R(u,function(m,y){p.axis(y,m)}):p.axis(!1),p.coordinate(c),R(v,function(m){var y=Ji({chart:p,options:m}).ext,_=m.adjust;_&&y.geometry.adjust(_)}),R(h,function(m){m.enable===!1?p.removeInteraction(m.type):p.interaction(m.type,m.cfg)}),R(f,function(m){p.annotation()[m.type](S({},m))}),typeof a.animation=="boolean"?p.animate(!1):(p.animate(!0),R(p.geometries,function(m){m.animate(a.animation)})),d&&(p.interaction("tooltip"),p.tooltip(d))}),n?R(n,function(a,o){t.legend(o,a)}):t.legend(!1),t.tooltip(e.tooltip),r}function YNt(r){var t=r.chart,e=r.options,i=e.plots,n=e.data,a=n===void 0?[]:n;return R(i,function(o){var s=o.type,l=o.region,u=o.options,c=u===void 0?{}:u,h=o.top,f=c.tooltip;if(h){$C(s,t,S(S({},c),{data:a}));return}var d=t.createView(S({region:l},ge(c,PU)));f&&d.interaction("tooltip"),$C(s,d,S({data:a},c))}),r}function jNt(r){var t=r.chart,e=r.options;return t.option("slider",e.slider),r}function ZNt(r){return bt(xe,XNt,YNt,Ue,xe,ae,yr,jNt,$e())(r)}function qNt(r,t){var e=r.getModel(),i=e.data,n;return Z(i)?n=i[0][t]:n=i[t],n}function KNt(r){var t=I0(r);R(t,function(e){e.hasState("active")&&e.setState("active",!1),e.hasState("selected")&&e.setState("selected",!1),e.hasState("inactive")&&e.setState("inactive",!1)})}var QNt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getAssociationItems=function(e,i){var n,a=this.context.event,o=i||{},s=o.linkField,l=o.dim,u=[];if(!((n=a.data)===null||n===void 0)&&n.data){var c=a.data.data;R(e,function(h){var f,d,v=s;if(l==="x"?v=h.getXScale().field:l==="y"?v=(f=h.getYScales().find(function(g){return g.field===v}))===null||f===void 0?void 0:f.field:v||(v=(d=h.getGroupScales()[0])===null||d===void 0?void 0:d.field),!!v){var p=Ne(I0(h),function(g){var m=!1,y=!1,_=Z(c)?L(c[0],v):L(c,v);return qNt(g,v)===_?m=!0:y=!0,{element:g,view:h,active:m,inactive:y}});u.push.apply(u,p)}})}return u},t.prototype.showTooltip=function(e){var i=qO(this.context.view),n=this.getAssociationItems(i,e);R(n,function(a){if(a.active){var o=a.element.shape.getCanvasBBox();a.view.showTooltip({x:o.minX+o.width/2,y:o.minY+o.height/2})}})},t.prototype.hideTooltip=function(){var e=qO(this.context.view);R(e,function(i){i.hideTooltip()})},t.prototype.active=function(e){var i=hf(this.context.view),n=this.getAssociationItems(i,e);R(n,function(a){var o=a.active,s=a.element;o&&s.setState("active",!0)})},t.prototype.selected=function(e){var i=hf(this.context.view),n=this.getAssociationItems(i,e);R(n,function(a){var o=a.active,s=a.element;o&&s.setState("selected",!0)})},t.prototype.highlight=function(e){var i=hf(this.context.view),n=this.getAssociationItems(i,e);R(n,function(a){var o=a.inactive,s=a.element;o&&s.setState("inactive",!0)})},t.prototype.reset=function(){var e=hf(this.context.view);R(e,function(i){KNt(i)})},t}(Fe);xt("association",QNt);Ot("association-active",{start:[{trigger:"element:mouseenter",action:"association:active"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});Ot("association-selected",{start:[{trigger:"element:mouseenter",action:"association:selected"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});Ot("association-highlight",{start:[{trigger:"element:mouseenter",action:"association:highlight"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});Ot("association-tooltip",{start:[{trigger:"element:mousemove",action:"association:showTooltip"}],end:[{trigger:"element:mouseleave",action:"association:hideTooltip"}]});var JNt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="mix",e}return t.prototype.getSchemaAdaptor=function(){return ZNt},t}(Ft);const Nzt=Object.freeze(Object.defineProperty({__proto__:null,Mix:JNt},Symbol.toStringTag,{value:"Module"}));var tP;(function(r){r.DEV="DEV",r.BETA="BETA",r.STABLE="STABLE"})(tP||(tP={}));var to="first-axes-view",eo="second-axes-view",wl="series-field-key";function O9(r,t,e,i,n){var a=[];t.forEach(function(h){i.forEach(function(f){var d,v=(d={},d[r]=f[r],d[e]=h,d[h]=f[h],d);a.push(v)})});var o=Object.values(cn(a,e)),s=o[0],l=s===void 0?[]:s,u=o[1],c=u===void 0?[]:u;return n?[l.reverse(),c.reverse()]:[l,c]}function Mo(r){return r!=="vertical"}function t6t(r,t,e){var i=t[0],n=t[1],a=i.autoPadding,o=n.autoPadding,s=r.__axisPosition,l=s.layout,u=s.position;if(Mo(l)&&u==="top"&&(i.autoPadding=e.instance(a.top,0,a.bottom,a.left),n.autoPadding=e.instance(o.top,a.left,o.bottom,0)),Mo(l)&&u==="bottom"&&(i.autoPadding=e.instance(a.top,a.right/2+5,a.bottom,a.left),n.autoPadding=e.instance(o.top,o.right,o.bottom,a.right/2+5)),!Mo(l)&&u==="bottom"){var c=a.left>=o.left?a.left:o.left;i.autoPadding=e.instance(a.top,a.right,a.bottom/2+5,c),n.autoPadding=e.instance(a.bottom/2+5,o.right,o.bottom,c)}if(!Mo(l)&&u==="top"){var c=a.left>=o.left?a.left:o.left;i.autoPadding=e.instance(a.top,a.right,0,c),n.autoPadding=e.instance(0,o.right,a.top,c)}}function e6t(r){var t=r.chart,e=r.options,i=e.data,n=e.xField,a=e.yField,o=e.color,s=e.barStyle,l=e.widthRatio,u=e.legend,c=e.layout,h=O9(n,a,wl,i,Mo(c));u?t.legend(wl,u):u===!1&&t.legend(!1);var f,d,v=h[0],p=h[1];Mo(c)?(f=t.createView({region:{start:{x:0,y:0},end:{x:.5,y:1}},id:to}),f.coordinate().transpose().reflect("x"),d=t.createView({region:{start:{x:.5,y:0},end:{x:1,y:1}},id:eo}),d.coordinate().transpose(),f.data(v),d.data(p)):(f=t.createView({region:{start:{x:0,y:0},end:{x:1,y:.5}},id:to}),d=t.createView({region:{start:{x:0,y:.5},end:{x:1,y:1}},id:eo}),d.coordinate().reflect("y"),f.data(v),d.data(p));var g=$({},r,{chart:f,options:{widthRatio:l,xField:n,yField:a[0],seriesField:wl,interval:{color:o,style:s}}});Kr(g);var m=$({},r,{chart:d,options:{xField:n,yField:a[1],seriesField:wl,widthRatio:l,interval:{color:o,style:s}}});return Kr(m),r}function r6t(r){var t,e,i,n=r.options,a=r.chart,o=n.xAxis,s=n.yAxis,l=n.xField,u=n.yField,c=zt(a,to),h=zt(a,eo),f={};return Kc((n==null?void 0:n.meta)||{}).map(function(d){L(n==null?void 0:n.meta,[d,"alias"])&&(f[d]=n.meta[d].alias)}),a.scale((t={},t[wl]={sync:!0,formatter:function(d){return L(f,d,d)}},t)),Je((e={},e[l]=o,e[u[0]]=s[u[0]],e))($({},r,{chart:c})),Je((i={},i[l]=o,i[u[1]]=s[u[1]],i))($({},r,{chart:h})),r}function i6t(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField,s=e.layout,l=zt(t,to),u=zt(t,eo);return(i==null?void 0:i.position)==="bottom"?u.axis(a,S(S({},i),{label:{formatter:function(){return""}}})):u.axis(a,!1),i===!1?l.axis(a,!1):l.axis(a,S({position:Mo(s)?"top":"bottom"},i)),n===!1?(l.axis(o[0],!1),u.axis(o[1],!1)):(l.axis(o[0],n[o[0]]),u.axis(o[1],n[o[1]])),t.__axisPosition={position:l.getOptions().axes[a].position,layout:s},r}function n6t(r){var t=r.chart;return Ue($({},r,{chart:zt(t,to)})),Ue($({},r,{chart:zt(t,eo)})),r}function a6t(r){var t=r.chart,e=r.options,i=e.yField,n=e.yAxis;return su($({},r,{chart:zt(t,to),options:{yAxis:n[i[0]]}})),su($({},r,{chart:zt(t,eo),options:{yAxis:n[i[1]]}})),r}function o6t(r){var t=r.chart;return ae($({},r,{chart:zt(t,to)})),ae($({},r,{chart:zt(t,eo)})),ae(r),r}function s6t(r){var t=r.chart;return xe($({},r,{chart:zt(t,to)})),xe($({},r,{chart:zt(t,eo)})),r}function l6t(r){var t=this,e,i,n=r.chart,a=r.options,o=a.label,s=a.yField,l=a.layout,u=zt(n,to),c=zt(n,eo),h=qr(u,"interval"),f=qr(c,"interval");if(!o)h.label(!1),f.label(!1);else{var d=o.callback,v=Ut(o,["callback"]);v.position||(v.position="middle"),v.offset===void 0&&(v.offset=2);var p=S({},v);if(Mo(l)){var g=((e=p.style)===null||e===void 0?void 0:e.textAlign)||(v.position==="middle"?"center":"left");v.style=$({},v.style,{textAlign:g});var m={left:"right",right:"left",center:"center"};p.style=$({},p.style,{textAlign:m[g]})}else{var y={top:"bottom",bottom:"top",middle:"middle"};typeof v.position=="string"?v.position=y[v.position]:typeof v.position=="function"&&(v.position=function(){for(var C=[],A=0;A<arguments.length;A++)C[A]=arguments[A];return y[v.position.apply(t,C)]});var _=((i=p.style)===null||i===void 0?void 0:i.textBaseline)||"bottom";p.style=$({},p.style,{textBaseline:_});var x={top:"bottom",bottom:"top",middle:"middle"};v.style=$({},v.style,{textBaseline:x[_]})}h.label({fields:[s[0]],callback:d,cfg:Mr(p)}),f.label({fields:[s[1]],callback:d,cfg:Mr(v)})}return r}function u6t(r){return bt(e6t,r6t,i6t,a6t,o6t,l6t,yr,n6t,s6t)(r)}var c6t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="bidirectional-bar",e}return t.getDefaultOptions=function(){return $({},r.getDefaultOptions.call(this),{syncViewPadding:t6t})},t.prototype.changeData=function(e){e===void 0&&(e=[]),this.chart.emit(kt.BEFORE_CHANGE_DATA,He.fromData(this.chart,kt.BEFORE_CHANGE_DATA,null)),this.updateOption({data:e});var i=this.options,n=i.xField,a=i.yField,o=i.layout,s=O9(n,a,wl,e,Mo(o)),l=s[0],u=s[1],c=zt(this.chart,to),h=zt(this.chart,eo);c.data(l),h.data(u),this.chart.render(!0),this.chart.emit(kt.AFTER_CHANGE_DATA,He.fromData(this.chart,kt.AFTER_CHANGE_DATA,null))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return u6t},t.SERIES_FIELD_KEY=wl,t}(Ft);const kzt=Object.freeze(Object.defineProperty({__proto__:null,BidirectionalBar:c6t},Symbol.toStringTag,{value:"Module"}));var J_,Xc="$$range$$",h6t="low-q1-median-q3-high",f6t="$$y_outliers$$",P9="outliers_view",d6t=$({},Ft.getDefaultOptions(),{meta:(J_={},J_[Xc]={min:0,alias:h6t},J_),interactions:[{type:"active-region"}],tooltip:{showMarkers:!1,shared:!0},boxStyle:{lineWidth:1}}),F9=function(r,t){var e=r;if(Array.isArray(t)){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4];e=Ne(r,function(l){return l[Xc]=[l[i],l[n],l[a],l[o],l[s]],l})}return e};function v6t(r){var t=r.chart,e=r.options,i=e.xField,n=e.yField,a=e.groupField,o=e.color,s=e.tooltip,l=e.boxStyle;t.data(F9(e.data,n));var u=Z(n)?Xc:n,c=n?Z(n)?n:[n]:[],h=s;h!==!1&&(h=$({},{fields:Z(n)?n:[]},h));var f=jT($({},r,{options:{xField:i,yField:u,seriesField:a,tooltip:h,rawFields:c,label:!1,schema:{shape:"box",color:o,style:l}}})).ext;return a&&f.geometry.adjust("dodge"),r}function p6t(r){var t=r.chart,e=r.options,i=e.xField,n=e.data,a=e.outliersField,o=e.outliersStyle,s=e.padding,l=e.label;if(!a)return r;var u=t.createView({padding:s,id:P9}),c=n.reduce(function(h,f){var d=f[a];return d.forEach(function(v){var p;return h.push(S(S({},f),(p={},p[a]=v,p)))}),h},[]);return u.data(c),An({chart:u,options:{xField:i,yField:a,point:{shape:"circle",style:o},label:l}}),u.axis(!1),r}function g6t(r){var t,e,i=r.chart,n=r.options,a=n.meta,o=n.xAxis,s=n.yAxis,l=n.xField,u=n.yField,c=n.outliersField,h=Array.isArray(u)?Xc:u,f={};if(c){var d=f6t;f=(t={},t[c]={sync:d,nice:!0},t[h]={sync:d,nice:!0},t)}var v=$(f,a,(e={},e[l]=ge(o,zi),e[h]=ge(s,zi),e));return i.scale(v),r}function m6t(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField,s=Array.isArray(o)?Xc:o;return i===!1?t.axis(a,!1):t.axis(a,i),n===!1?t.axis(Xc,!1):t.axis(s,n),r}function y6t(r){var t=r.chart,e=r.options,i=e.legend,n=e.groupField;return n?i?t.legend(n,i):t.legend(n,{position:"bottom"}):t.legend(!1),r}function _6t(r){return bt(v6t,p6t,g6t,m6t,y6t,yr,$e(),Ue,xe,ae)(r)}(function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="box",e}return t.getDefaultOptions=function(){return d6t},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this.options.yField,n=this.chart.views.find(function(a){return a.id===P9});n&&n.data(e),this.chart.changeData(F9(e,i))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return _6t},t})(Ft);function eP(r,t,e){return r.length>1?"".concat(t,"_").concat(e):"".concat(t)}function B9(r){var t=r.data,e=r.xField,i=r.measureField,n=r.rangeField,a=r.targetField,o=r.layout,s=[],l=[];t.forEach(function(h,f){var d=[h[n]].flat();d.sort(function(g,m){return g-m}),d.forEach(function(g,m){var y,_=m===0?g:d[m]-d[m-1];s.push((y={rKey:"".concat(n,"_").concat(m)},y[e]=e?h[e]:String(f),y[n]=_,y))});var v=[h[i]].flat();v.forEach(function(g,m){var y;s.push((y={mKey:eP(v,i,m)},y[e]=e?h[e]:String(f),y[i]=g,y))});var p=[h[a]].flat();p.forEach(function(g,m){var y;s.push((y={tKey:eP(p,a,m)},y[e]=e?h[e]:String(f),y[a]=g,y))}),l.push(h[n],h[i],h[a])});var u=Math.min.apply(Math,l.flat(1/0)),c=Math.max.apply(Math,l.flat(1/0));return u=u>0?0:u,o==="vertical"&&s.reverse(),{min:u,max:c,ds:s}}function x6t(r){var t=r.chart,e=r.options,i=e.bulletStyle,n=e.targetField,a=e.rangeField,o=e.measureField,s=e.xField,l=e.color,u=e.layout,c=e.size,h=e.label,f=B9(e),d=f.min,v=f.max,p=f.ds;t.data(p);var g=$({},r,{options:{xField:s,yField:a,seriesField:"rKey",isStack:!0,label:L(h,"range"),interval:{color:L(l,"range"),style:L(i,"range"),size:L(c,"range")}}});Kr(g),t.geometries[0].tooltip(!1);var m=$({},r,{options:{xField:s,yField:o,seriesField:"mKey",isStack:!0,label:L(h,"measure"),interval:{color:L(l,"measure"),style:L(i,"measure"),size:L(c,"measure")}}});Kr(m);var y=$({},r,{options:{xField:s,yField:n,seriesField:"tKey",label:L(h,"target"),point:{color:L(l,"target"),style:L(i,"target"),size:ut(L(c,"target"))?function(_){return L(c,"target")(_)/2}:L(c,"target")/2,shape:u==="horizontal"?"line":"hyphen"}}});return An(y),u==="horizontal"&&t.coordinate().transpose(),S(S({},r),{ext:{data:{min:d,max:v}}})}function D9(r){var t,e,i=r.options,n=r.ext,a=i.xAxis,o=i.yAxis,s=i.targetField,l=i.rangeField,u=i.measureField,c=i.xField,h=n.data;return bt(Je((t={},t[c]=a,t[u]=o,t),(e={},e[u]={min:h==null?void 0:h.min,max:h==null?void 0:h.max,sync:!0},e[s]={sync:"".concat(u)},e[l]={sync:"".concat(u)},e)))(r)}function C6t(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.measureField,s=e.rangeField,l=e.targetField;return t.axis("".concat(s),!1),t.axis("".concat(l),!1),i===!1?t.axis("".concat(a),!1):t.axis("".concat(a),i),n===!1?t.axis("".concat(o),!1):t.axis("".concat(o),n),r}function E6t(r){var t=r.chart,e=r.options,i=e.legend;return t.removeInteraction("legend-filter"),t.legend(i),t.legend("rKey",!1),t.legend("mKey",!1),t.legend("tKey",!1),r}function S6t(r){var t=r.chart,e=r.options,i=e.label,n=e.measureField,a=e.targetField,o=e.rangeField,s=t.geometries,l=s[0],u=s[1],c=s[2];return L(i,"range")?l.label("".concat(o),S({layout:[{type:"limit-in-plot"}]},Mr(i.range))):l.label(!1),L(i,"measure")?u.label("".concat(n),S({layout:[{type:"limit-in-plot"}]},Mr(i.measure))):u.label(!1),L(i,"target")?c.label("".concat(a),S({layout:[{type:"limit-in-plot"}]},Mr(i.target))):c.label(!1),r}function A6t(r){bt(x6t,D9,C6t,E6t,ae,S6t,yr,Ue,xe)(r)}var T6t=$({},Ft.getDefaultOptions(),{layout:"horizontal",size:{range:30,measure:20,target:20},xAxis:{tickLine:!1,line:null},bulletStyle:{range:{fillOpacity:.5}},label:{measure:{position:"right"}},tooltip:{showMarkers:!1}});(function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="bullet",e}return t.getDefaultOptions=function(){return T6t},t.prototype.changeData=function(e){this.updateOption({data:e});var i=B9(this.options),n=i.min,a=i.max,o=i.ds;D9({options:this.options,ext:{data:{min:n,max:a}},chart:this.chart}),this.chart.changeData(o)},t.prototype.getSchemaAdaptor=function(){return A6t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t})(Ft);var b6t={y:0,nodeWidthRatio:.05,weight:!1,nodePaddingRatio:.1,id:function(r){return r.id},source:function(r){return r.source},target:function(r){return r.target},sourceWeight:function(r){return r.value||1},targetWeight:function(r){return r.value||1},sortBy:null};function w6t(r,t,e){R(r,function(i,n){i.inEdges=t.filter(function(a){return"".concat(e.target(a))==="".concat(n)}),i.outEdges=t.filter(function(a){return"".concat(e.source(a))==="".concat(n)}),i.edges=i.outEdges.concat(i.inEdges),i.frequency=i.edges.length,i.value=0,i.inEdges.forEach(function(a){i.value+=e.targetWeight(a)}),i.outEdges.forEach(function(a){i.value+=e.sourceWeight(a)})})}function R6t(r,t){var e={weight:function(n,a){return a.value-n.value},frequency:function(n,a){return a.frequency-n.frequency},id:function(n,a){return"".concat(t.id(n)).localeCompare("".concat(t.id(a)))}},i=e[t.sortBy];!i&&ut(t.sortBy)&&(i=t.sortBy),i&&r.sort(i)}function M6t(r,t){var e=r.length;if(!e)throw new TypeError("Invalid nodes: it's empty!");if(t.weight){var i=t.nodePaddingRatio;if(i<0||i>=1)throw new TypeError("Invalid nodePaddingRatio: it must be in range [0, 1)!");var n=i/(2*e),a=t.nodeWidthRatio;if(a<=0||a>=1)throw new TypeError("Invalid nodeWidthRatio: it must be in range (0, 1)!");var o=0;r.forEach(function(l){o+=l.value}),r.forEach(function(l){l.weight=l.value/o,l.width=l.weight*(1-i),l.height=a}),r.forEach(function(l,u){for(var c=0,h=u-1;h>=0;h--)c+=r[h].width+2*n;var f=l.minX=n+c,d=l.maxX=l.minX+l.width,v=l.minY=t.y-a/2,p=l.maxY=v+a;l.x=[f,d,d,f],l.y=[v,v,p,p]})}else{var s=1/e;r.forEach(function(l,u){l.x=(u+.5)*s,l.y=t.y})}return r}function I6t(r,t,e){if(e.weight){var i={};R(r,function(n,a){i[a]=n.value}),t.forEach(function(n){var a=e.source(n),o=e.target(n),s=r[a],l=r[o];if(s&&l){var u=i[a],c=e.sourceWeight(n),h=s.minX+(s.value-u)/s.value*s.width,f=h+c/s.value*s.width;i[a]-=c;var d=i[o],v=e.targetWeight(n),p=l.minX+(l.value-d)/l.value*l.width,g=p+v/l.value*l.width;i[o]-=v;var m=e.y;n.x=[h,f,p,g],n.y=[m,m,m,m],n.source=s,n.target=l}})}else t.forEach(function(n){var a=r[e.source(n)],o=r[e.target(n)];a&&o&&(n.x=[a.x,o.x],n.y=[a.y,o.y],n.source=a,n.target=o)});return t}function L6t(r){return ye({},b6t,r)}function O6t(r,t){var e=L6t(r),i={},n=t.nodes,a=t.links;n.forEach(function(l){var u=e.id(l);i[u]=l}),w6t(i,a,e),R6t(n,e);var o=M6t(n,e),s=I6t(i,a,e);return{nodes:o,links:s}}var N9="x",k9="y",U9="name",z9="source",P6t={nodeStyle:{opacity:1,fillOpacity:1,lineWidth:1},edgeStyle:{opacity:.5,lineWidth:2},label:{fields:["x","name"],callback:function(r,t){var e=(r[0]+r[1])/2,i=e>.5?-4:4;return{offsetX:i,content:t}},labelEmit:!0,style:{fill:"#8c8c8c"}},tooltip:{showTitle:!1,showMarkers:!1,fields:["source","target","value","isNode"],showContent:function(r){return!L(r,[0,"data","isNode"])},formatter:function(r){var t=r.source,e=r.target,i=r.value;return{name:"".concat(t," -> ").concat(e),value:i}}},interactions:[{type:"element-active"}],weight:!0,nodePaddingRatio:.1,nodeWidthRatio:.05};function F6t(r){var t=r.options,e=t.data,i=t.sourceField,n=t.targetField,a=t.weightField,o=t.nodePaddingRatio,s=t.nodeWidthRatio,l=t.rawFields,u=l===void 0?[]:l,c=EU(e,i,n,a),h=O6t({weight:!0,nodePaddingRatio:o,nodeWidthRatio:s},c),f=h.nodes,d=h.links,v=f.map(function(g){return S(S({},ge(g,_t(["id","x","y","name"],u,!0))),{isNode:!0})}),p=d.map(function(g){return S(S({source:g.source.name,target:g.target.name,name:g.source.name||g.target.name},ge(g,_t(["x","y","value"],u,!0))),{isNode:!1})});return S(S({},r),{ext:S(S({},r.ext),{chordData:{nodesData:v,edgesData:p}})})}function B6t(r){var t,e=r.chart;return e.scale((t={x:{sync:!0,nice:!0},y:{sync:!0,nice:!0,max:1}},t[U9]={sync:"color"},t[z9]={sync:"color"},t)),r}function D6t(r){var t=r.chart;return t.axis(!1),r}function N6t(r){var t=r.chart;return t.legend(!1),r}function k6t(r){var t=r.chart,e=r.options,i=e.tooltip;return t.tooltip(i),r}function U6t(r){var t=r.chart;return t.coordinate("polar").reflect("y"),r}function z6t(r){var t=r.chart,e=r.options,i=r.ext.chordData.nodesData,n=e.nodeStyle,a=e.label,o=e.tooltip,s=t.createView();return s.data(i),wy({chart:s,options:{xField:N9,yField:k9,seriesField:U9,polygon:{style:n},label:a,tooltip:o}}),r}function H6t(r){var t=r.chart,e=r.options,i=r.ext.chordData.edgesData,n=e.edgeStyle,a=e.tooltip,o=t.createView();o.data(i);var s={xField:N9,yField:k9,seriesField:z9,edge:{style:n,shape:"arc"},tooltip:a};return OU({chart:o,options:s}),r}function $6t(r){var t=r.chart,e=r.options,i=e.animation;return mv(t,i,s5t(t)),r}function W6t(r){return bt(ae,F6t,U6t,B6t,D6t,N6t,k6t,H6t,z6t,Ue,Js,$6t)(r)}(function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="chord",e}return t.getDefaultOptions=function(){return P6t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return W6t},t})(Ft);var V6t=["x","y","r","name","value","path","depth"],G6t={colorField:"name",autoFit:!0,pointStyle:{lineWidth:0,stroke:"#fff"},legend:!1,hierarchyConfig:{size:[1,1],padding:0},label:{fields:["name"],layout:{type:"limit-in-shape"}},tooltip:{showMarkers:!1,showTitle:!1},drilldown:{enabled:!1}},rP=4,X6t=0,iP=5,nP="drilldown-bread-crumb",Y6t={position:"top-left",dividerText:"/",textStyle:{fontSize:12,fill:"rgba(0, 0, 0, 0.65)",cursor:"pointer"},activeTextStyle:{fill:"#87B5FF"}},Fd="hierarchy-data-transform-params",j6t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.name="drill-down",e.historyCache=[],e.breadCrumbGroup=null,e.breadCrumbCfg=Y6t,e}return t.prototype.click=function(){var e=L(this.context,["event","data","data"]);if(!e)return!1;this.drill(e),this.drawBreadCrumb()},t.prototype.resetPosition=function(){if(this.breadCrumbGroup){var e=this.context.view.getCoordinate(),i=this.breadCrumbGroup,n=i.getBBox(),a=this.getButtonCfg().position,o={x:e.start.x,y:e.end.y-(n.height+iP*2)};e.isPolar&&(o={x:0,y:0}),a==="bottom-left"&&(o={x:e.start.x,y:e.start.y});var s=Zi.transform(null,[["t",o.x+X6t,o.y+n.height+iP]]);i.setMatrix(s)}},t.prototype.back=function(){Tr(this.historyCache)&&this.backTo(this.historyCache.slice(0,-1))},t.prototype.reset=function(){this.historyCache[0]&&this.backTo(this.historyCache.slice(0,1)),this.historyCache=[],this.hideCrumbGroup()},t.prototype.drill=function(e){var i=this.context.view,n=L(i,["interactions","drill-down","cfg","transformData"],function(u){return u}),a=n(S({data:e.data},e[Fd]));i.changeData(a);for(var o=[],s=e;s;){var l=s.data;o.unshift({id:"".concat(l.name,"_").concat(s.height,"_").concat(s.depth),name:l.name,children:n(S({data:l},e[Fd]))}),s=s.parent}this.historyCache=(this.historyCache||[]).slice(0,-1).concat(o)},t.prototype.backTo=function(e){if(!(!e||e.length<=0)){var i=this.context.view,n=fr(e).children;i.changeData(n),e.length>1?(this.historyCache=e,this.drawBreadCrumb()):(this.historyCache=[],this.hideCrumbGroup())}},t.prototype.getButtonCfg=function(){var e=this.context.view,i=L(e,["interactions","drill-down","cfg","drillDownConfig"]);return $(this.breadCrumbCfg,i==null?void 0:i.breadCrumb,this.cfg)},t.prototype.drawBreadCrumb=function(){this.drawBreadCrumbGroup(),this.resetPosition(),this.breadCrumbGroup.show()},t.prototype.drawBreadCrumbGroup=function(){var e=this,i=this.getButtonCfg(),n=this.historyCache;this.breadCrumbGroup?this.breadCrumbGroup.clear():this.breadCrumbGroup=this.context.view.foregroundGroup.addGroup({name:nP});var a=0;n.forEach(function(o,s){var l=e.breadCrumbGroup.addShape({type:"text",id:o.id,name:"".concat(nP,"_").concat(o.name,"_text"),attrs:S(S({text:s===0&&!j(i.rootText)?i.rootText:o.name},i.textStyle),{x:a,y:0})}),u=l.getBBox();if(a+=u.width+rP,l.on("click",function(f){var d,v=f.target.get("id");if(v!==((d=fr(n))===null||d===void 0?void 0:d.id)){var p=n.slice(0,n.findIndex(function(g){return g.id===v})+1);e.backTo(p)}}),l.on("mouseenter",function(f){var d,v=f.target.get("id");v!==((d=fr(n))===null||d===void 0?void 0:d.id)?l.attr(i.activeTextStyle):l.attr({cursor:"default"})}),l.on("mouseleave",function(){l.attr(i.textStyle)}),s<n.length-1){var c=e.breadCrumbGroup.addShape({type:"text",name:"".concat(i.name,"_").concat(o.name,"_divider"),attrs:S(S({text:i.dividerText},i.textStyle),{x:a,y:0})}),h=c.getBBox();a+=h.width+rP}})},t.prototype.hideCrumbGroup=function(){this.breadCrumbGroup&&this.breadCrumbGroup.hide()},t.prototype.destroy=function(){this.breadCrumbGroup&&this.breadCrumbGroup.remove(),r.prototype.destroy.call(this)},t}(Fe),H9="nodeIndex",$9="childNodeCount",eb="nodeAncestor",t1="Invalid field: it must be a string!";function rb(r,t){var e=r.field,i=r.fields;if(mt(e))return e;if(Z(e))return console.warn(t1),e[0];if(console.warn("".concat(t1," will try to get fields instead.")),mt(i))return i;if(Z(i)&&i.length)return i[0];if(t)return t;throw new TypeError(t1)}function ib(r){var t=[];if(r&&r.each){var e,i;r.each(function(n){var a,o;n.parent!==e?(e=n.parent,i=0):i+=1;var s=Ur((((a=n.ancestors)===null||a===void 0?void 0:a.call(n))||[]).map(function(l){return t.find(function(u){return u.name===l.name})||l}),function(l){var u=l.depth;return u>0&&u<n.depth});n[eb]=s,n[$9]=((o=n.children)===null||o===void 0?void 0:o.length)||0,n[H9]=i,t.push(n)})}else r&&r.eachNode&&r.eachNode(function(n){t.push(n)});return t}var Z6t={field:"value",as:["x","y","r"],sort:function(r,t){return t.value-r.value}};function q6t(r,t){t=ye({},Z6t,t);var e=t.as;if(!Z(e)||e.length!==3)throw new TypeError('Invalid as: it must be an array with 3 strings (e.g. [ "x", "y", "r" ])!');var i;try{i=rb(t)}catch(u){console.warn(u)}var n=function(u){return XH().size(t.size).padding(t.padding)(ZC(u).sum(function(c){return c[i]}).sort(t.sort))},a=n(r),o=e[0],s=e[1],l=e[2];return a.each(function(u){u[o]=u.x,u[s]=u.y,u[l]=u.r}),ib(a)}function W9(r){var t=r.data,e=r.hierarchyConfig,i=r.rawFields,n=i===void 0?[]:i,a=r.enableDrillDown,o=q6t(t,S(S({},e),{field:"value",as:["x","y","r"]})),s=[];return o.forEach(function(l){for(var u,c=l.data.name,h=S({},l);h.depth>1;)c="".concat((u=h.parent.data)===null||u===void 0?void 0:u.name," / ").concat(c),h=h.parent;if(a&&l.depth>2)return null;var f=$({},l.data,S(S(S({},ge(l.data,n)),{path:c}),l));f.ext=e,f[Fd]={hierarchyConfig:e,rawFields:n,enableDrillDown:a},s.push(f)}),s}function V9(r,t,e){var i=WT([r,t]),n=i[0],a=i[1],o=i[2],s=i[3],l=e.width,u=e.height,c=l-(s+a),h=u-(n+o),f=Math.min(c,h),d=(c-f)/2,v=(h-f)/2,p=n+v,g=a+d,m=o+v,y=s+d,_=[p,g,m,y],x=f<0?0:f;return{finalPadding:_,finalSize:x}}function K6t(r){var t=r.chart,e=Math.min(t.viewBBox.width,t.viewBBox.height);return $({options:{size:function(i){var n=i.r;return n*e}}},r)}function Q6t(r){var t=r.options,e=r.chart,i=e.viewBBox,n=t.padding,a=t.appendPadding,o=t.drilldown,s=a;if(o!=null&&o.enabled){var l=Ey(e.appendPadding,L(o,["breadCrumb","position"]));s=WT([l,a])}var u=V9(n,s,i).finalPadding;return e.padding=u,e.appendPadding=0,r}function J6t(r){var t=r.chart,e=r.options,i=t.padding,n=t.appendPadding,a=e.color,o=e.colorField,s=e.pointStyle,l=e.hierarchyConfig,u=e.sizeField,c=e.rawFields,h=c===void 0?[]:c,f=e.drilldown,d=W9({data:e.data,hierarchyConfig:l,enableDrillDown:f==null?void 0:f.enabled,rawFields:h});t.data(d);var v=t.viewBBox,p=V9(i,n,v).finalSize,g=function(m){var y=m.r;return y*p};return u&&(g=function(m){return m[u]*p}),An($({},r,{options:{xField:"x",yField:"y",seriesField:o,sizeField:u,rawFields:_t(_t([],V6t,!0),h,!0),point:{color:a,style:s,shape:"circle",size:g}}})),r}function t7t(r){return bt(Je({},{x:{min:0,max:1,minLimit:0,maxLimit:1,nice:!0},y:{min:0,max:1,minLimit:0,maxLimit:1,nice:!0}}))(r)}function e7t(r){var t=r.chart,e=r.options,i=e.tooltip;if(i===!1)t.tooltip(!1);else{var n=i;L(i,"fields")||(n=$({},{customItems:function(a){return a.map(function(o){var s=L(t.getOptions(),"scales"),l=L(s,["name","formatter"],function(c){return c}),u=L(s,["value","formatter"],function(c){return c});return S(S({},o),{name:l(o.data.name),value:u(o.data.value)})})}},n)),t.tooltip(n)}return r}function r7t(r){var t=r.chart;return t.axis(!1),r}function i7t(r){var t=r.drilldown,e=r.interactions,i=e===void 0?[]:e;return t!=null&&t.enabled?$({},r,{interactions:_t(_t([],i,!0),[{type:"drill-down",cfg:{drillDownConfig:t,transformData:W9,enableDrillDown:!0}}],!1)}):r}function n7t(r){var t=r.chart,e=r.options;return Ue({chart:t,options:i7t(e)}),r}function a7t(r){return bt(Sn("pointStyle"),K6t,Q6t,ae,t7t,J6t,r7t,gh,e7t,n7t,xe,$e())(r)}function aP(r){var t=L(r,["event","data","data"],{});return Z(t.children)&&t.children.length>0}function oP(r){var t=r.view.getCoordinate(),e=t.innerRadius;if(e){var i=r.event,n=i.x,a=i.y,o=t.center,s=o.x,l=o.y,u=t.getRadius()*e,c=Math.sqrt(Math.pow(s-n,2)+Math.pow(l-a,2));return c<u}return!1}xt("drill-down-action",j6t);Ot("drill-down",{showEnable:[{trigger:"element:mouseenter",action:"cursor:pointer",isEnable:aP},{trigger:"element:mouseleave",action:"cursor:default"},{trigger:"element:mouseleave",action:"cursor:pointer",isEnable:oP}],start:[{trigger:"element:click",isEnable:aP,action:["drill-down-action:click"]},{trigger:"afterchangesize",action:["drill-down-action:resetPosition"]},{trigger:"click",isEnable:oP,action:["drill-down-action:back"]}]});var o7t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="circle-packing",e}return t.getDefaultOptions=function(){return G6t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return a7t},t.prototype.triggerResize=function(){this.chart.destroyed||(this.chart.forceFit(),this.chart.clear(),this.execAdaptor(),this.chart.render(!0))},t}(Ft);const Uzt=Object.freeze(Object.defineProperty({__proto__:null,CirclePacking:o7t},Symbol.toStringTag,{value:"Module"}));var Tn="left-axes-view",bn="right-axes-view",G9={nice:!0,label:{autoHide:!0,autoRotate:!1}},s7t=S(S({},G9),{position:"left"}),l7t=S(S({},G9),{position:"right",grid:null}),Yc;(function(r){r.Left="Left",r.Right="Right"})(Yc||(Yc={}));var lu;(function(r){r.Line="line",r.Column="column"})(lu||(lu={}));function WC(r){return L(r,"geometry")===lu.Line}function nb(r){return L(r,"geometry")===lu.Column}function sP(r,t,e){return nb(e)?$({},{geometry:lu.Column,label:e.label&&e.isRange?{content:function(i){var n;return(n=i[t])===null||n===void 0?void 0:n.join("-")}}:void 0},e):S({geometry:lu.Line},e)}function lP(r,t){var e=r[0],i=r[1];if(Z(t)){var n=t[0],a=t[1];return[n,a]}var o=L(t,e),s=L(t,i);return[o,s]}function uP(r,t){return t===Yc.Left?r===!1?!1:$({},s7t,r):t===Yc.Right?r===!1?!1:$({},l7t,r):r}function u7t(r){var t=r.options,e=r.chart,i=t.geometryOption,n=i.isStack,a=i.color,o=i.seriesField,s=i.groupField,l=i.isGroup,u=["xField","yField"];if(WC(i)){mh($({},r,{options:S(S(S({},ge(t,u)),i),{line:{color:i.color,style:i.lineStyle}})})),An($({},r,{options:S(S(S({},ge(t,u)),i),{point:i.point&&S({color:a,shape:"circle"},i.point)})}));var c=[];l&&c.push({type:"dodge",dodgeBy:s||o,customOffset:0}),n&&c.push({type:"stack"}),c.length&&R(e.geometries,function(h){h.adjust(c)})}return nb(i)&&My($({},r,{options:S(S(S({},ge(t,u)),i),{widthRatio:i.columnWidthRatio,interval:S(S({},ge(i,["color"])),{style:i.columnStyle})})})),r}function cP(r){var t=r.view,e=r.geometryOption,i=r.yField,n=r.legend,a=L(n,"marker"),o=qr(t,WC(e)?"line":"interval");if(!e.seriesField){var s=L(t,"options.scales.".concat(i,".alias"))||i,l=o.getAttribute("color"),u=t.getTheme().defaultColor;l&&(u=Zi.getMappingValue(l,s,L(l,["values",0],u)));var c=(ut(a)?a:!Gi(a)&&$({},{style:{stroke:u,fill:u}},a))||(WC(e)?{symbol:function(f,d,v){return[["M",f-v,d],["L",f+v,d]]},style:{lineWidth:2,r:6,stroke:u}}:{symbol:"square",style:{fill:u}});return[{value:i,name:s,marker:c,isGeometry:!0,viewId:t.id}]}var h=o.getGroupAttributes();return oi(h,function(f,d){var v=Zi.getLegendItems(t,o,d,t.getTheme(),a);return f.concat(v)},[])}var hP=function(r,t){var e=t[0],i=t[1],n=r.getOptions().data,a=r.getXScale(),o=Tr(n);if(!(!a||!o)){var s=xa(n,a.field),l=s,u=Tr(l),c=Math.round(e*(u-1)),h=Math.round(i*(u-1));r.filter(a.field,function(f){var d=l.indexOf(f);return d>-1?u5t(d,c,h):!0}),r.getRootView().render(!0)}};function c7t(r){var t,e=r.options,i=e.geometryOptions,n=i===void 0?[]:i,a=e.xField,o=e.yField,s=DE(n,function(l){var u=l.geometry;return u===lu.Line||u===void 0});return $({},{options:{geometryOptions:[],meta:(t={},t[a]={type:"cat",sync:!0,range:s?[0,1]:void 0},t),tooltip:{showMarkers:s,showCrosshairs:s,shared:!0,crosshairs:{type:"x"}},interactions:s?[{type:"legend-visible-filter"}]:[{type:"legend-visible-filter"},{type:"active-region"}],legend:{position:"top-left"}}},r,{options:{yAxis:lP(o,e.yAxis),geometryOptions:[sP(a,o[0],n[0]),sP(a,o[1],n[1])],annotations:lP(o,e.annotations)}})}function h7t(r){var t,e,i=r.chart,n=r.options,a=n.geometryOptions,o={line:0,column:1},s=[{type:(t=a[0])===null||t===void 0?void 0:t.geometry,id:Tn},{type:(e=a[1])===null||e===void 0?void 0:e.geometry,id:bn}];return s.sort(function(l,u){return-o[l.type]+o[u.type]}).forEach(function(l){return i.createView({id:l.id})}),r}function f7t(r){var t=r.chart,e=r.options,i=e.xField,n=e.yField,a=e.geometryOptions,o=e.data,s=e.tooltip,l=[S(S({},a[0]),{id:Tn,data:o[0],yField:n[0]}),S(S({},a[1]),{id:bn,data:o[1],yField:n[1]})];return l.forEach(function(u){var c=u.id,h=u.data,f=u.yField,d=nb(u)&&u.isPercent,v=d?FU(h,f,i,f):h,p=zt(t,c).data(v),g=d?S({formatter:function(m){return{name:m[u.seriesField]||f,value:(Number(m[f])*100).toFixed(2)+"%"}}},s):s;u7t({chart:p,options:{xField:i,yField:f,tooltip:g,geometryOption:u}})}),r}function d7t(r){var t,e=r.chart,i=r.options,n=i.geometryOptions,a=((t=e.getTheme())===null||t===void 0?void 0:t.colors10)||[],o=0;return e.once("beforepaint",function(){R(n,function(s,l){var u=zt(e,l===0?Tn:bn);if(!s.color){var c=u.getGroupScales(),h=L(c,[0,"values","length"],1),f=a.slice(o,o+h).concat(l===0?[]:a);u.geometries.forEach(function(d){s.seriesField?d.color(s.seriesField,f):d.color(f[0])}),o+=h}}),e.render(!0)}),r}function v7t(r){var t,e,i=r.chart,n=r.options,a=n.xAxis,o=n.yAxis,s=n.xField,l=n.yField;return Je((t={},t[s]=a,t[l[0]]=o[0],t))($({},r,{chart:zt(i,Tn)})),Je((e={},e[s]=a,e[l[1]]=o[1],e))($({},r,{chart:zt(i,bn)})),r}function p7t(r){var t=r.chart,e=r.options,i=zt(t,Tn),n=zt(t,bn),a=e.xField,o=e.yField,s=e.xAxis,l=e.yAxis;return t.axis(a,!1),t.axis(o[0],!1),t.axis(o[1],!1),i.axis(a,s),i.axis(o[0],uP(l[0],Yc.Left)),n.axis(a,!1),n.axis(o[1],uP(l[1],Yc.Right)),r}function g7t(r){var t=r.chart,e=r.options,i=e.tooltip,n=zt(t,Tn),a=zt(t,bn);return t.tooltip(i),n.tooltip({shared:!0}),a.tooltip({shared:!0}),r}function m7t(r){var t=r.chart;return Ue($({},r,{chart:zt(t,Tn)})),Ue($({},r,{chart:zt(t,bn)})),r}function y7t(r){var t=r.chart,e=r.options,i=e.annotations,n=L(i,[0]),a=L(i,[1]);return $e(n)($({},r,{chart:zt(t,Tn),options:{annotations:n}})),$e(a)($({},r,{chart:zt(t,bn),options:{annotations:a}})),r}function _7t(r){var t=r.chart;return ae($({},r,{chart:zt(t,Tn)})),ae($({},r,{chart:zt(t,bn)})),ae(r),r}function x7t(r){var t=r.chart;return xe($({},r,{chart:zt(t,Tn)})),xe($({},r,{chart:zt(t,bn)})),r}function C7t(r){var t=r.chart,e=r.options,i=e.yAxis;return su($({},r,{chart:zt(t,Tn),options:{yAxis:i[0]}})),su($({},r,{chart:zt(t,bn),options:{yAxis:i[1]}})),r}function E7t(r){var t=r.chart,e=r.options,i=e.legend,n=e.geometryOptions,a=e.yField,o=e.data,s=zt(t,Tn),l=zt(t,bn);if(i===!1)t.legend(!1);else if(re(i)&&i.custom===!0)t.legend(i);else{var u=L(n,[0,"legend"],i),c=L(n,[1,"legend"],i);t.once("beforepaint",function(){var h=o[0].length?cP({view:s,geometryOption:n[0],yField:a[0],legend:u}):[],f=o[1].length?cP({view:l,geometryOption:n[1],yField:a[1],legend:c}):[];t.legend($({},i,{custom:!0,items:h.concat(f)}))}),n[0].seriesField&&s.legend(n[0].seriesField,u),n[1].seriesField&&l.legend(n[1].seriesField,c),t.on("legend-item:click",function(h){var f=L(h,"gEvent.delegateObject",{});if(f&&f.item){var d=f.item,v=d.value,p=d.isGeometry,g=d.viewId;if(p){var m=NB(a,function(x){return x===v});if(m>-1){var y=L(zt(t,g),"geometries");R(y,function(x){x.changeVisible(!f.item.unchecked)})}}else{var _=L(t.getController("legend"),"option.items",[]);R(t.views,function(x){var C=x.getGroupScales();R(C,function(A){A.values&&A.values.indexOf(v)>-1&&x.filter(A.field,function(T){var w=pa(_,function(M){return M.value===T});return!w.unchecked})}),t.render(!0)})}}})}return r}function S7t(r){var t=r.chart,e=r.options,i=e.slider,n=zt(t,Tn),a=zt(t,bn);return i&&(n.option("slider",i),n.on("slider:valuechanged",function(o){var s=o.event,l=s.value,u=s.originValue;Jt(l,u)||hP(a,l)}),t.once("afterpaint",function(){if(!Rs(i)){var o=i.start,s=i.end;(o||s)&&hP(a,[o,s])}})),r}function A7t(r){return bt(c7t,h7t,_7t,f7t,v7t,p7t,C7t,g7t,m7t,y7t,x7t,d7t,E7t,S7t)(r)}var T7t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="dual-axes",e}return t.prototype.getDefaultOptions=function(){return $({},r.prototype.getDefaultOptions.call(this),{yAxis:[],syncViewPadding:!0})},t.prototype.getSchemaAdaptor=function(){return A7t},t}(Ft);const zzt=Object.freeze(Object.defineProperty({__proto__:null,DualAxes:T7t},Symbol.toStringTag,{value:"Module"}));function b7t(r,t){var e=t.data,i=t.coordinate,n=t.interactions,a=t.annotations,o=t.animation,s=t.tooltip,l=t.axes,u=t.meta,c=t.geometries;e&&r.data(e);var h={};l&&R(l,function(f,d){h[d]=ge(f,zi)}),h=$({},u,h),r.scale(h),i&&r.coordinate(i),l===!1?r.axis(!1):R(l,function(f,d){r.axis(d,f)}),R(c,function(f){var d=Ji({chart:r,options:f}).ext,v=f.adjust;v&&d.geometry.adjust(v)}),R(n,function(f){f.enable===!1?r.removeInteraction(f.type):r.interaction(f.type,f.cfg)}),R(a,function(f){r.annotation()[f.type](S({},f))}),mv(r,o),s?(r.interaction("tooltip"),r.tooltip(s)):s===!1&&r.removeInteraction("tooltip")}function w7t(r){var t=r.chart,e=r.options,i=e.type,n=e.data,a=e.fields,o=e.eachView,s=Q0(e,["type","data","fields","eachView","axes","meta","tooltip","coordinate","theme","legend","interactions","annotations"]);return t.data(n),t.facet(i,S(S({},s),{fields:a,eachView:function(l,u){var c=o(l,u);if(c.geometries)b7t(l,c);else{var h=c,f=h.options;f.tooltip&&l.interaction("tooltip"),$C(h.type,l,f)}}})),r}function R7t(r){var t=r.chart,e=r.options,i=e.axes,n=e.meta,a=e.tooltip,o=e.coordinate,s=e.theme,l=e.legend,u=e.interactions,c=e.annotations,h={};return i&&R(i,function(f,d){h[d]=ge(f,zi)}),h=$({},n,h),t.scale(h),t.coordinate(o),i?R(i,function(f,d){t.axis(d,f)}):t.axis(!1),a?(t.interaction("tooltip"),t.tooltip(a)):a===!1&&t.removeInteraction("tooltip"),t.legend(l),s&&t.theme(s),R(u,function(f){f.enable===!1?t.removeInteraction(f.type):t.interaction(f.type,f.cfg)}),R(c,function(f){t.annotation()[f.type](S({},f))}),r}function M7t(r){return bt(ae,w7t,R7t)(r)}var I7t={title:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}},rowTitle:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}},columnTitle:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}}};(function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="area",e}return t.getDefaultOptions=function(){return I7t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return M7t},t})(Ft);function L7t(r){var t=r.chart,e=r.options,i=e.data,n=e.type,a=e.xField,o=e.yField,s=e.colorField,l=e.sizeField,u=e.sizeRatio,c=e.shape,h=e.color,f=e.tooltip,d=e.heatmapStyle,v=e.meta;t.data(i);var p="polygon";n==="density"&&(p="heatmap");var g=ta(f,[a,o,s]),m=g.fields,y=g.formatter,_=1;return(u||u===0)&&(!c&&!l?console.warn("sizeRatio is not in effect: Must define shape or sizeField first"):u<0||u>1?console.warn("sizeRatio is not in effect: It must be a number in [0,1]"):_=u),Ji($({},r,{options:{type:p,colorField:s,tooltipFields:m,shapeField:l||"",label:void 0,mapping:{tooltip:y,shape:c&&(l?function(x){var C=i.map(function(M){return M[l]}),A=(v==null?void 0:v[l])||{},T=A.min,w=A.max;return T=Mt(T)?T:Math.min.apply(Math,C),w=Mt(w)?w:Math.max.apply(Math,C),[c,(L(x,l)-T)/(w-T),_]}:function(){return[c,1,_]}),color:h||s&&t.getTheme().sequenceColors.join("-"),style:d}}})),r}function O7t(r){var t,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return bt(Je((t={},t[a]=i,t[o]=n,t)))(r)}function P7t(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return i===!1?t.axis(a,!1):t.axis(a,i),n===!1?t.axis(o,!1):t.axis(o,n),r}function F7t(r){var t=r.chart,e=r.options,i=e.legend,n=e.colorField,a=e.sizeField,o=e.sizeLegend,s=i!==!1;return n&&t.legend(n,s?i:!1),a&&t.legend(a,o===void 0?i:o),!s&&!o&&t.legend(!1),r}function B7t(r){var t=r.chart,e=r.options,i=e.label,n=e.colorField,a=e.type,o=qr(t,a==="density"?"heatmap":"polygon");if(!i)o.label(!1);else if(n){var s=i.callback,l=Ut(i,["callback"]);o.label({fields:[n],callback:s,cfg:Mr(l)})}return r}function D7t(r){var t,e,i=r.chart,n=r.options,a=n.coordinate,o=n.reflect,s=$({actions:[]},a??{type:"rect"});return o&&((e=(t=s.actions)===null||t===void 0?void 0:t.push)===null||e===void 0||e.call(t,["reflect",o])),i.coordinate(s),r}function N7t(r){return bt(ae,Sn("heatmapStyle"),O7t,D7t,L7t,P7t,F7t,yr,B7t,$e(),Ue,xe,Js)(r)}var k7t=$({},Ft.getDefaultOptions(),{type:"polygon",legend:!1,coordinate:{type:"rect"},xAxis:{tickLine:null,line:null,grid:{alignTick:!1,line:{style:{lineWidth:1,lineDash:null,stroke:"#f0f0f0"}}}},yAxis:{grid:{alignTick:!1,line:{style:{lineWidth:1,lineDash:null,stroke:"#f0f0f0"}}}}});he("polygon","circle",{draw:function(r,t){var e,i,n=r.x,a=r.y,o=this.parsePoints(r.points),s=Math.abs(o[2].x-o[1].x),l=Math.abs(o[1].y-o[0].y),u=Math.min(s,l)/2,c=Number(r.shape[1]),h=Number(r.shape[2]),f=Math.sqrt(h),d=u*f*Math.sqrt(c),v=((e=r.style)===null||e===void 0?void 0:e.fill)||r.color||((i=r.defaultStyle)===null||i===void 0?void 0:i.fill),p=t.addShape("circle",{attrs:S(S(S({x:n,y:a,r:d},r.defaultStyle),r.style),{fill:v})});return p}});he("polygon","square",{draw:function(r,t){var e,i,n=r.x,a=r.y,o=this.parsePoints(r.points),s=Math.abs(o[2].x-o[1].x),l=Math.abs(o[1].y-o[0].y),u=Math.min(s,l),c=Number(r.shape[1]),h=Number(r.shape[2]),f=Math.sqrt(h),d=u*f*Math.sqrt(c),v=((e=r.style)===null||e===void 0?void 0:e.fill)||r.color||((i=r.defaultStyle)===null||i===void 0?void 0:i.fill),p=t.addShape("rect",{attrs:S(S(S({x:n-d/2,y:a-d/2,width:d,height:d},r.defaultStyle),r.style),{fill:v})});return p}});var U7t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="heatmap",e}return t.getDefaultOptions=function(){return k7t},t.prototype.getSchemaAdaptor=function(){return N7t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(Ft);const Hzt=Object.freeze(Object.defineProperty({__proto__:null,Heatmap:U7t},Symbol.toStringTag,{value:"Module"}));var z7t="liquid";function X9(r){return[{percent:r,type:z7t}]}function H7t(r){var t=r.chart,e=r.options,i=e.percent,n=e.liquidStyle,a=e.radius,o=e.outline,s=e.wave,l=e.shape,u=e.shapeStyle,c=e.animation;t.scale({percent:{min:0,max:1}}),t.data(X9(i));var h=e.color||t.getTheme().defaultColor,f=$({},r,{options:{xField:"type",yField:"percent",widthRatio:a,interval:{color:h,style:n,shape:"liquid-fill-gauge"}}}),d=Kr(f).ext,v=d.geometry,p=t.getTheme().background,g={percent:i,radius:a,outline:o,wave:s,shape:l,shapeStyle:u,background:p,animation:c};return v.customInfo(g),t.legend(!1),t.axis(!1),t.tooltip(!1),r}function Y9(r,t){var e=r.chart,i=r.options,n=i.statistic,a=i.percent,o=i.meta;e.getController("annotation").clear(!0);var s=L(o,["percent","formatter"])||function(u){return"".concat((u*100).toFixed(2),"%")},l=n.content;return l&&(l=$({},l,{content:j(l.content)?s(a):l.content})),Sy(e,{statistic:S(S({},n),{content:l}),plotType:"liquid"},{percent:a}),t&&e.render(!0),r}function $7t(r){return bt(ae,Sn("liquidStyle"),H7t,Y9,Je({}),xe,Ue)(r)}var W7t={radius:.9,statistic:{title:!1,content:{style:{opacity:.75,fontSize:"30px",lineHeight:"30px",textAlign:"center"}}},outline:{border:2,distance:0},wave:{count:3,length:192},shape:"circle"},fP=5e3;function dP(r,t,e){return r+(t-r)*e}function V7t(r){var t=S({opacity:1},r.style);return r.color&&!t.fill&&(t.fill=r.color),t}function G7t(r){var t={fill:"#fff",fillOpacity:0,lineWidth:4},e=ye({},t,r.style);return r.color&&!e.stroke&&(e.stroke=r.color),Mt(r.opacity)&&(e.opacity=e.strokeOpacity=r.opacity),e}function X7t(r,t,e,i){return t===0?[[r+1/2*e/Math.PI/2,i/2],[r+1/2*e/Math.PI,i],[r+e/4,i]]:t===1?[[r+1/2*e/Math.PI/2*(Math.PI-2),i],[r+1/2*e/Math.PI/2*(Math.PI-1),i/2],[r+e/4,0]]:t===2?[[r+1/2*e/Math.PI/2,-i/2],[r+1/2*e/Math.PI,-i],[r+e/4,-i]]:[[r+1/2*e/Math.PI/2*(Math.PI-2),-i],[r+1/2*e/Math.PI/2*(Math.PI-1),-i/2],[r+e/4,0]]}function Y7t(r,t,e,i,n,a,o){for(var s=Math.ceil(2*r/e*4)*4,l=[],u=i;u<-Math.PI*2;)u+=Math.PI*2;for(;u>0;)u-=Math.PI*2;u=u/Math.PI/2*e;var c=a-r+u-r*2;l.push(["M",c,t]);for(var h=0,f=0;f<s;++f){var d=f%4,v=X7t(f*e/4,d,e,n);l.push(["C",v[0][0]+c,-v[0][1]+t,v[1][0]+c,-v[1][1]+t,v[2][0]+c,-v[2][1]+t]),f===s-1&&(h=v[2][0])}return l.push(["L",h+c,o+r]),l.push(["L",c,o+r]),l.push(["Z"]),l}function j9(r,t,e,i,n,a,o,s,l,u){for(var c=n.fill,h=n.opacity,f=o.getBBox(),d=f.maxX-f.minX,v=f.maxY-f.minY,p=0;p<i;p++){var g=i<=1?1:p/(i-1),m=a.addShape("path",{name:"waterwave-path",attrs:{path:Y7t(s,f.minY+v*e,l,0,d/32,r,t),fill:c,opacity:dP(.2,.9,g)*h}});try{if(u===!1)return;var y=HC([["t",l,0]]);m.stopAnimate(),m.animate({matrix:y},{duration:dP(.5*fP,fP,g),repeat:!0})}catch{console.warn("off-screen group animate error!")}}}function j7t(r,t,e,i){var n=e*2/3,a=Math.max(n,i),o=n/2,s=r,l=o+t-a/2,u=Math.asin(o/((a-o)*.85)),c=Math.sin(u)*o,h=Math.cos(u)*o,f=s-h,d=l+c,v=r,p=l+o/Math.sin(u);return`
      M `.concat(f," ").concat(d,`
      A `).concat(o," ").concat(o," 0 1 1 ").concat(f+h*2," ").concat(d,`
      Q `).concat(v," ").concat(p," ").concat(r," ").concat(t+a/2,`
      Q `).concat(v," ").concat(p," ").concat(f," ").concat(d,`
      Z 
    `)}function Z7t(r,t,e,i){var n=e/2,a=i/2;return`
      M `.concat(r," ").concat(t-a,` 
      a `).concat(n," ").concat(a," 0 1 0 0 ").concat(a*2,`
      a `).concat(n," ").concat(a," 0 1 0 0 ").concat(-a*2,`
      Z
    `)}function q7t(r,t,e,i){var n=i/2,a=e/2;return`
      M `.concat(r," ").concat(t-n,`
      L `).concat(r+a," ").concat(t,`
      L `).concat(r," ").concat(t+n,`
      L `).concat(r-a," ").concat(t,`
      Z
    `)}function K7t(r,t,e,i){var n=i/2,a=e/2;return`
      M `.concat(r," ").concat(t-n,`
      L `).concat(r+a," ").concat(t+n,`
      L `).concat(r-a," ").concat(t+n,`
      Z
    `)}function Q7t(r,t,e,i){var n=.618,a=i/2,o=e/2*n;return`
      M `.concat(r-o," ").concat(t-a,`
      L `).concat(r+o," ").concat(t-a,`
      L `).concat(r+o," ").concat(t+a,`
      L `).concat(r-o," ").concat(t+a,`
      Z
    `)}var vP={pin:j7t,circle:Z7t,diamond:q7t,triangle:K7t,rect:Q7t};he("interval","liquid-fill-gauge",{draw:function(r,t){var e=.5,i=.5,n=r.customInfo,a=n,o=a.percent,s=a.radius,l=a.shape,u=a.shapeStyle,c=a.background,h=a.animation,f=n.outline,d=n.wave,v=f.border,p=f.distance,g=d.count,m=d.length,y=oi(r.points,function(Y,H){return Math.min(Y,H.x)},1/0),_=this.parsePoint({x:e,y:i}),x=this.parsePoint({x:y,y:i}),C=_.x-x.x,A=Math.min(C,x.y*s),T=V7t(r),w=G7t(ye({},r,f)),M=A-v/2,O=typeof l=="function"?l:vP[l]||vP.circle,P=O(_.x,_.y,M*2,M*2);if(u&&t.addShape("path",{name:"shape",attrs:S({path:P},u)}),o>0){var D=t.addGroup({name:"waves"}),z=D.setClip({type:"path",attrs:{path:P}});j9(_.x,_.y,1-r.points[1].y,g,T,D,z,A*2,m,h)}return t.addShape("path",{name:"distance",attrs:{path:P,fill:"transparent",lineWidth:v+p*2,stroke:c==="transparent"?"#fff":c}}),t.addShape("path",{name:"wrap",attrs:ye(w,{path:P,fill:"transparent",lineWidth:v})}),t}});var J7t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="liquid",e}return t.getDefaultOptions=function(){return W7t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.changeData=function(e){this.chart.emit(kt.BEFORE_CHANGE_DATA,He.fromData(this.chart,kt.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:e}),this.chart.data(X9(e)),Y9({chart:this.chart,options:this.options},!0),this.chart.emit(kt.AFTER_CHANGE_DATA,He.fromData(this.chart,kt.AFTER_CHANGE_DATA,null))},t.prototype.getSchemaAdaptor=function(){return $7t},t}(Ft);const $zt=Object.freeze(Object.defineProperty({__proto__:null,Liquid:J7t,addWaterWave:j9},Symbol.toStringTag,{value:"Module"}));function t8t(r){var t=r.chart,e=r.options,i=e.data,n=e.lineStyle,a=e.color,o=e.point,s=e.area;t.data(i);var l=$({},r,{options:{line:{style:n,color:a},point:o&&S({color:a},o),area:s&&S({color:a},s),label:void 0}}),u=$({},l,{options:{tooltip:!1}}),c=(o==null?void 0:o.state)||e.state,h=$({},l,{options:{tooltip:!1,state:c}});return mh(l),An(h),by(u),r}function e8t(r){var t,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return bt(Je((t={},t[a]=i,t[o]=n,t)))(r)}function r8t(r){var t=r.chart,e=r.options,i=e.radius,n=e.startAngle,a=e.endAngle;return t.coordinate("polar",{radius:i,startAngle:n,endAngle:a}),r}function i8t(r){var t=r.chart,e=r.options,i=e.xField,n=e.xAxis,a=e.yField,o=e.yAxis;return t.axis(i,n),t.axis(a,o),r}function n8t(r){var t=r.chart,e=r.options,i=e.label,n=e.yField,a=qr(t,"line");if(!i)a.label(!1);else{var o=i.fields,s=i.callback,l=Ut(i,["fields","callback"]);a.label({fields:o||[n],callback:s,cfg:Mr(l)})}return r}function a8t(r){return bt(t8t,e8t,ae,r8t,i8t,gh,yr,n8t,Ue,xe,$e())(r)}var o8t=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"name",{get:function(){return"radar-tooltip"},enumerable:!1,configurable:!0}),t.prototype.getTooltipItems=function(e){var i=this.getTooltipCfg(),n=i.shared,a=i.title,o=r.prototype.getTooltipItems.call(this,e);if(o.length>0){var s=this.view.geometries[0],l=s.dataArray,u=o[0].name,c=[];return l.forEach(function(h){h.forEach(function(f){var d=Zi.getTooltipItems(f,s),v=d[0];if(!n&&v&&v.name===u){var p=j(a)?u:a;c.push(S(S({},v),{name:v.title,title:p}))}else if(n&&v){var p=j(a)?v.name||u:a;c.push(S(S({},v),{name:v.title,title:p}))}})}),c}return[]},t}(bk);Cu("radar-tooltip",o8t);var s8t=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.init=function(){var e=this.context.view;e.removeInteraction("tooltip")},t.prototype.show=function(){var e=this.context.event,i=this.getTooltipController();i.showTooltip({x:e.x,y:e.y})},t.prototype.hide=function(){var e=this.getTooltipController();e.hideTooltip()},t.prototype.getTooltipController=function(){var e=this.context.view;return e.getController("radar-tooltip")},t}(Fe);xt("radar-tooltip",s8t);Ot("radar-tooltip",{start:[{trigger:"plot:mousemove",action:"radar-tooltip:show"}],end:[{trigger:"plot:mouseleave",action:"radar-tooltip:hide"}]});var l8t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="radar",e}return t.prototype.changeData=function(e){this.updateOption({data:e}),this.chart.changeData(e)},t.prototype.getDefaultOptions=function(){return $({},r.prototype.getDefaultOptions.call(this),{xAxis:{label:{offset:15},grid:{line:{type:"line"}}},yAxis:{grid:{line:{type:"circle"}}},legend:{position:"top"},tooltip:{shared:!0,showCrosshairs:!0,showMarkers:!0,crosshairs:{type:"xy",line:{style:{stroke:"#565656",lineDash:[4]}},follow:!0}}})},t.prototype.getSchemaAdaptor=function(){return a8t},t}(Ft);const Wzt=Object.freeze(Object.defineProperty({__proto__:null,Radar:l8t},Symbol.toStringTag,{value:"Module"}));function u8t(r,t,e){var i=e.map(function(o){return o[t]}).filter(function(o){return o!==void 0}),n=i.length>0?Math.max.apply(Math,i):0,a=Math.abs(r)%360;return a?n*360/a:n}function c8t(r,t,e){var i=[];return r.forEach(function(n){var a=i.find(function(o){return o[t]===n[t]});a?a[e]+=n[e]||null:i.push(S({},n))}),i}function h8t(r){var t=r.chart,e=r.options,i=e.barStyle,n=e.color,a=e.tooltip,o=e.colorField,s=e.type,l=e.xField,u=e.yField,c=e.data,h=e.shape,f=Gc(c,u);t.data(f);var d=$({},r,{options:{tooltip:a,seriesField:o,interval:{style:i,color:n,shape:h||(s==="line"?"line":"intervel")},minColumnWidth:e.minBarWidth,maxColumnWidth:e.maxBarWidth,columnBackground:e.barBackground}});return Kr(d),s==="line"&&An({chart:t,options:{xField:l,yField:u,seriesField:o,point:{shape:"circle",color:n}}}),r}function Z9(r){var t,e=r.options,i=e.yField,n=e.xField,a=e.data,o=e.isStack,s=e.isGroup,l=e.colorField,u=e.maxAngle,c=o&&!s&&l?c8t(a,n,i):a,h=Gc(c,i);return bt(Je((t={},t[i]={min:0,max:u8t(u,i,h)},t)))(r)}function f8t(r){var t=r.chart,e=r.options,i=e.radius,n=e.innerRadius,a=e.startAngle,o=e.endAngle;return t.coordinate({type:"polar",cfg:{radius:i,innerRadius:n,startAngle:a,endAngle:o}}).transpose(),r}function d8t(r){var t=r.chart,e=r.options,i=e.xField,n=e.xAxis;return t.axis(i,n),r}function v8t(r){var t=r.chart,e=r.options,i=e.label,n=e.yField,a=qr(t,"interval");if(!i)a.label(!1);else{var o=i.callback,s=Ut(i,["callback"]);a.label({fields:[n],callback:o,cfg:S(S({},Mr(s)),{type:"polar"})})}return r}function p8t(r){return bt(Sn("barStyle"),h8t,Z9,d8t,f8t,Ue,xe,ae,yr,gh,$e(),v8t)(r)}var g8t=$({},Ft.getDefaultOptions(),{interactions:[{type:"element-active"}],legend:!1,tooltip:{showMarkers:!1},xAxis:{grid:null,tickLine:null,line:null},maxAngle:240});(function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="radial-bar",e}return t.getDefaultOptions=function(){return g8t},t.prototype.changeData=function(e){this.updateOption({data:e}),Z9({chart:this.chart,options:this.options}),this.chart.changeData(e)},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return p8t},t})(Ft);function m8t(r){var t=r.chart,e=r.options,i=e.data,n=e.sectorStyle,a=e.shape,o=e.color;return t.data(i),bt(Kr)($({},r,{options:{marginRatio:1,interval:{style:n,color:o,shape:a}}})),r}function y8t(r){var t=r.chart,e=r.options,i=e.label,n=e.xField,a=qr(t,"interval");if(i===!1)a.label(!1);else if(re(i)){var o=i.callback,s=i.fields,l=Ut(i,["callback","fields"]),u=l.offset,c=l.layout;(u===void 0||u>=0)&&(c=c?Z(c)?c:[c]:[],l.layout=Ur(c,function(h){return h.type!=="limit-in-shape"}),l.layout.length||delete l.layout),a.label({fields:s||[n],callback:o,cfg:Mr(l)})}else $o(Ta.WARN,i===null,"the label option must be an Object."),a.label({fields:[n]});return r}function _8t(r){var t=r.chart,e=r.options,i=e.legend,n=e.seriesField;return i===!1?t.legend(!1):n&&t.legend(n,i),r}function x8t(r){var t=r.chart,e=r.options,i=e.radius,n=e.innerRadius,a=e.startAngle,o=e.endAngle;return t.coordinate({type:"polar",cfg:{radius:i,innerRadius:n,startAngle:a,endAngle:o}}),r}function C8t(r){var t,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return bt(Je((t={},t[a]=i,t[o]=n,t)))(r)}function E8t(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return i?t.axis(a,i):t.axis(a,!1),n?t.axis(o,n):t.axis(o,!1),r}function S8t(r){bt(Sn("sectorStyle"),m8t,C8t,y8t,x8t,E8t,_8t,yr,Ue,xe,ae,$e(),Js)(r)}var A8t=$({},Ft.getDefaultOptions(),{xAxis:!1,yAxis:!1,legend:{position:"right",radio:{}},sectorStyle:{stroke:"#fff",lineWidth:1},label:{layout:{type:"limit-in-shape"}},tooltip:{shared:!0,showMarkers:!1},interactions:[{type:"active-region"}]}),T8t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="rose",e}return t.getDefaultOptions=function(){return A8t},t.prototype.changeData=function(e){this.updateOption({data:e}),this.chart.changeData(e)},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return S8t},t}(Ft);const Vzt=Object.freeze(Object.defineProperty({__proto__:null,Rose:T8t},Symbol.toStringTag,{value:"Module"}));var pP="x",gP="y",mP="name",Ly="nodes",Oy="edges";function b8t(r,t,e){var i=[];return r.forEach(function(n){var a=n[t],o=n[e];i.includes(a)||i.push(a),i.includes(o)||i.push(o)}),i}function w8t(r,t,e,i){var n={};return t.forEach(function(a){n[a]={},t.forEach(function(o){n[a][o]=0})}),r.forEach(function(a){n[a[e]][a[i]]=1}),n}function R8t(r,t,e){if(!Z(r))return[];var i=[],n=b8t(r,t,e),a=w8t(r,n,t,e),o={};n.forEach(function(l){o[l]=0});function s(l){o[l]=1,n.forEach(function(u){if(a[l][u]!=0)if(o[u]==1)i.push("".concat(l,"_").concat(u));else{if(o[u]==-1)return;s(u)}}),o[l]=-1}return n.forEach(function(l){o[l]!=-1&&s(l)}),i.length!==0&&console.warn("sankey data contains circle, ".concat(i.length," records removed."),i),r.filter(function(l){return i.findIndex(function(u){return u==="".concat(l[t],"_").concat(l[e])})<0})}function M8t(r){return r.target.depth}function I8t(r){return r.depth}function L8t(r,t){return t-1-r.height}function ab(r,t){return r.sourceLinks.length?r.depth:t-1}function O8t(r){return r.targetLinks.length?r.depth:r.sourceLinks.length?hit(r.sourceLinks,M8t)-1:0}function Up(r){return function(){return r}}function e1(r,t){for(var e=0,i=0;i<r.length;i++)e+=t(r[i]);return e}function r1(r,t){for(var e=-1/0,i=0;i<r.length;i++)e=Math.max(t(r[i]),e);return e}function P8t(r,t){for(var e=1/0,i=0;i<r.length;i++)e=Math.min(t(r[i]),e);return e}function yP(r,t){return F0(r.source,t.source)||r.index-t.index}function _P(r,t){return F0(r.target,t.target)||r.index-t.index}function F0(r,t){return r.y0-t.y0}function i1(r){return r.value}function F8t(r){return r.index}function B8t(r){return r.nodes}function D8t(r){return r.links}function xP(r,t){var e=r.get(t);if(!e)throw new Error("missing: "+t);return e}function CP(r){for(var t=r.nodes,e=0,i=t;e<i.length;e++){for(var n=i[e],a=n.y0,o=a,s=0,l=n.sourceLinks;s<l.length;s++){var u=l[s];u.y0=a+u.width/2,a+=u.width}for(var c=0,h=n.targetLinks;c<h.length;c++){var u=h[c];u.y1=o+u.width/2,o+=u.width}}}function N8t(){var r=0,t=0,e=1,i=1,n=24,a=8,o,s=F8t,l=ab,u,c,h,f=B8t,d=D8t,v=6;function p(N){var W={nodes:f(N),links:d(N)};return g(W),m(W),y(W),_(W),A(W),CP(W),W}p.update=function(N){return CP(N),N},p.nodeId=function(N){return arguments.length?(s=typeof N=="function"?N:Up(N),p):s},p.nodeAlign=function(N){return arguments.length?(l=typeof N=="function"?N:Up(N),p):l},p.nodeDepth=function(N){return arguments.length?(u=N,p):u},p.nodeSort=function(N){return arguments.length?(c=N,p):c},p.nodeWidth=function(N){return arguments.length?(n=+N,p):n},p.nodePadding=function(N){return arguments.length?(a=o=+N,p):a},p.nodes=function(N){return arguments.length?(f=typeof N=="function"?N:Up(N),p):f},p.links=function(N){return arguments.length?(d=typeof N=="function"?N:Up(N),p):d},p.linkSort=function(N){return arguments.length?(h=N,p):h},p.size=function(N){return arguments.length?(r=t=0,e=+N[0],i=+N[1],p):[e-r,i-t]},p.extent=function(N){return arguments.length?(r=+N[0][0],e=+N[1][0],t=+N[0][1],i=+N[1][1],p):[[r,t],[e,i]]},p.iterations=function(N){return arguments.length?(v=+N,p):v};function g(N){var W=N.nodes,Q=N.links;W.forEach(function(dt,Rt){dt.index=Rt,dt.sourceLinks=[],dt.targetLinks=[]});var q=new Map(W.map(function(dt){return[s(dt),dt]}));if(Q.forEach(function(dt,Rt){dt.index=Rt;var le=dt.source,me=dt.target;typeof le!="object"&&(le=dt.source=xP(q,le)),typeof me!="object"&&(me=dt.target=xP(q,me)),le.sourceLinks.push(dt),me.targetLinks.push(dt)}),h!=null)for(var J=0,et=W;J<et.length;J++){var ft=et[J],Ct=ft.sourceLinks,ct=ft.targetLinks;Ct.sort(h),ct.sort(h)}}function m(N){for(var W=N.nodes,Q=0,q=W;Q<q.length;Q++){var J=q[Q];J.value=J.fixedValue===void 0?Math.max(e1(J.sourceLinks,i1),e1(J.targetLinks,i1)):J.fixedValue}}function y(N){for(var W=N.nodes,Q=W.length,q=new Set(W),J=new Set,et=0;q.size;){if(q.forEach(function(dt){dt.depth=et;for(var Rt=0,le=dt.sourceLinks;Rt<le.length;Rt++){var me=le[Rt].target;J.add(me)}}),++et>Q)throw new Error("circular link");q=J,J=new Set}if(u)for(var ft=Math.max(r1(W,function(dt){return dt.depth})+1,0),Ct=void 0,ct=0;ct<W.length;ct++)Ct=W[ct],Ct.depth=u.call(null,Ct,ft)}function _(N){for(var W=N.nodes,Q=W.length,q=new Set(W),J=new Set,et=0;q.size;){if(q.forEach(function(ft){ft.height=et;for(var Ct=0,ct=ft.targetLinks;Ct<ct.length;Ct++){var dt=ct[Ct].source;J.add(dt)}}),++et>Q)throw new Error("circular link");q=J,J=new Set}}function x(N){for(var W=N.nodes,Q=Math.max(r1(W,function(me){return me.depth})+1,0),q=(e-r-n)/(Q-1),J=new Array(Q).fill(0).map(function(){return[]}),et=0,ft=W;et<ft.length;et++){var Ct=ft[et],ct=Math.max(0,Math.min(Q-1,Math.floor(l.call(null,Ct,Q))));Ct.layer=ct,Ct.x0=r+ct*q,Ct.x1=Ct.x0+n,J[ct]?J[ct].push(Ct):J[ct]=[Ct]}if(c)for(var dt=0,Rt=J;dt<Rt.length;dt++){var le=Rt[dt];le.sort(c)}return J}function C(N){for(var W=P8t(N,function(We){return(i-t-(We.length-1)*o)/e1(We,i1)}),Q=0,q=N;Q<q.length;Q++){for(var J=q[Q],et=t,ft=0,Ct=J;ft<Ct.length;ft++){var ct=Ct[ft];ct.y0=et,ct.y1=et+ct.value*W,et=ct.y1+o;for(var dt=0,Rt=ct.sourceLinks;dt<Rt.length;dt++){var le=Rt[dt];le.width=le.value*W}}et=(i-et+o)/(J.length+1);for(var me=0;me<J.length;++me){var ct=J[me];ct.y0+=et*(me+1),ct.y1+=et*(me+1)}z(J)}}function A(N){var W=x(N);o=Math.min(a,(i-t)/(r1(W,function(et){return et.length})-1)),C(W);for(var Q=0;Q<v;++Q){var q=Math.pow(.99,Q),J=Math.max(1-q,(Q+1)/v);w(W,q,J),T(W,q,J)}}function T(N,W,Q){for(var q=1,J=N.length;q<J;++q){for(var et=N[q],ft=0,Ct=et;ft<Ct.length;ft++){for(var ct=Ct[ft],dt=0,Rt=0,le=0,me=ct.targetLinks;le<me.length;le++){var We=me[le],Ri=We.source,tn=We.value,ea=tn*(ct.layer-Ri.layer);dt+=Y(Ri,ct)*ea,Rt+=ea}if(Rt>0){var tl=(dt/Rt-ct.y0)*W;ct.y0+=tl,ct.y1+=tl,D(ct)}}c===void 0&&et.sort(F0),et.length&&M(et,Q)}}function w(N,W,Q){for(var q=N.length,J=q-2;J>=0;--J){for(var et=N[J],ft=0,Ct=et;ft<Ct.length;ft++){for(var ct=Ct[ft],dt=0,Rt=0,le=0,me=ct.sourceLinks;le<me.length;le++){var We=me[le],Ri=We.target,tn=We.value,ea=tn*(Ri.layer-ct.layer);dt+=H(ct,Ri)*ea,Rt+=ea}if(Rt>0){var tl=(dt/Rt-ct.y0)*W;ct.y0+=tl,ct.y1+=tl,D(ct)}}c===void 0&&et.sort(F0),et.length&&M(et,Q)}}function M(N,W){var Q=N.length>>1,q=N[Q];P(N,q.y0-o,Q-1,W),O(N,q.y1+o,Q+1,W),P(N,i,N.length-1,W),O(N,t,0,W)}function O(N,W,Q,q){for(;Q<N.length;++Q){var J=N[Q],et=(W-J.y0)*q;et>1e-6&&(J.y0+=et,J.y1+=et),W=J.y1+o}}function P(N,W,Q,q){for(;Q>=0;--Q){var J=N[Q],et=(J.y1-W)*q;et>1e-6&&(J.y0-=et,J.y1-=et),W=J.y0-o}}function D(N){var W=N.sourceLinks,Q=N.targetLinks;if(h===void 0){for(var q=0,J=Q;q<J.length;q++){var et=J[q].source.sourceLinks;et.sort(_P)}for(var ft=0,Ct=W;ft<Ct.length;ft++){var ct=Ct[ft].target.targetLinks;ct.sort(yP)}}}function z(N){if(h===void 0)for(var W=0,Q=N;W<Q.length;W++){var q=Q[W],J=q.sourceLinks,et=q.targetLinks;J.sort(_P),et.sort(yP)}}function Y(N,W){for(var Q=N.y0-(N.sourceLinks.length-1)*o/2,q=0,J=N.sourceLinks;q<J.length;q++){var et=J[q],ft=et.target,Ct=et.width;if(ft===W)break;Q+=Ct+o}for(var ct=0,dt=W.targetLinks;ct<dt.length;ct++){var Rt=dt[ct],ft=Rt.source,Ct=Rt.width;if(ft===N)break;Q-=Ct}return Q}function H(N,W){for(var Q=W.y0-(W.targetLinks.length-1)*o/2,q=0,J=W.targetLinks;q<J.length;q++){var et=J[q],ft=et.source,Ct=et.width;if(ft===N)break;Q+=Ct+o}for(var ct=0,dt=N.sourceLinks;ct<dt.length;ct++){var Rt=dt[ct],ft=Rt.target,Ct=Rt.width;if(ft===W)break;Q-=Ct}return Q}return p}var k8t={left:I8t,right:L8t,center:O8t,justify:ab},U8t={nodeId:function(r){return r.index},nodeAlign:"justify",nodeWidth:.008,nodePadding:.03,nodeSort:void 0};function z8t(r){var t=mt(r)?k8t[r]:ut(r)?r:null;return t||ab}function H8t(r){return ye({},U8t,r)}function $8t(r,t){var e=H8t(r),i=e.nodeId,n=e.nodeSort,a=e.nodeAlign,o=e.nodeWidth,s=e.nodePadding,l=e.nodeDepth,u=N8t().nodeSort(n).nodeWidth(o).nodePadding(s).nodeDepth(l).nodeAlign(z8t(a)).extent([[0,0],[1,1]]).nodeId(i),c=u(t),h=c.nodes.map(function(d){var v=d.x0,p=d.x1,g=d.y0,m=d.y1;return d.x=[v,p,p,v],d.y=[g,g,m,m],d}).filter(function(d){return d.name!==null}),f=c.links.map(function(d){var v=d.source,p=d.target,g=v.x1,m=p.x0;d.x=[g,g,m,m];var y=d.width/2;return d.y=[d.y0+y,d.y0-y,d.y1+y,d.y1-y],d}).filter(function(d){var v=d.source,p=d.target;return v.name!==null&&p.name!==null});return{nodes:h,links:f}}function W8t(r){return r==="node-link"}function V8t(r,t,e){return ou(r)?r/e:t}function G8t(r,t,e){return ou(r)?r/e:t}function q9(r,t,e){var i=r.dataType,n=r.data,a=r.sourceField,o=r.targetField,s=r.weightField,l=r.nodeAlign,u=r.nodeSort,c=r.nodePadding,h=r.nodePaddingRatio,f=r.nodeWidth,d=r.nodeWidthRatio,v=r.nodeDepth,p=r.rawFields,g=p===void 0?[]:p,m;W8t(i)?m=n:m=EU(R8t(n,a,o),a,o,s,g);var y=$8t({nodeAlign:l,nodePadding:G8t(c,h,e),nodeWidth:V8t(f,d,t),nodeSort:u,nodeDepth:v},m),_=y.nodes,x=y.links;return{nodes:_.map(function(C){return S(S({},ge(C,_t(["x","y","name"],g,!0))),{isNode:!0})}),edges:x.map(function(C){return S(S({source:C.source.name,target:C.target.name,name:C.source.name||C.target.name},ge(C,_t(["x","y","value"],g,!0))),{isNode:!1})})}}function X8t(r){var t=r.options,e=t.rawFields,i=e===void 0?[]:e;return $({},{options:{tooltip:{fields:Gl(_t(["name","source","target","value","isNode"],i,!0))},label:{fields:Gl(_t(["x","name"],i,!0))}}},r)}function Y8t(r){var t=r.chart,e=r.options,i=e.color,n=e.nodeStyle,a=e.edgeStyle,o=e.label,s=e.tooltip,l=e.nodeState,u=e.edgeState,c=e.rawFields,h=c===void 0?[]:c;t.legend(!1),t.tooltip(s),t.axis(!1),t.coordinate().reflect("y");var f=q9(e,t.width,t.height),d=f.nodes,v=f.edges,p=t.createView({id:Oy});p.data(v),OU({chart:p,options:{xField:pP,yField:gP,seriesField:mP,rawFields:_t(["source","target"],h,!0),edge:{color:i,style:a,shape:"arc"},tooltip:s,state:u}});var g=t.createView({id:Ly});return g.data(d),wy({chart:g,options:{xField:pP,yField:gP,seriesField:mP,polygon:{color:i,style:n},label:o,tooltip:s,state:l}}),t.interaction("element-active"),t.scale({x:{sync:!0,nice:!0,min:0,max:1,minLimit:0,maxLimit:1},y:{sync:!0,nice:!0,min:0,max:1,minLimit:0,maxLimit:1},name:{sync:"color",type:"cat"}}),r}function j8t(r){var t=r.chart,e=r.options,i=e.animation,n=_t(_t([],t.views[0].geometries,!0),t.views[1].geometries,!0);return mv(t,i,n),r}function Z8t(r){var t=r.chart,e=r.options,i=e.nodeDraggable,n="sankey-node-draggable";return i?t.interaction(n):t.removeInteraction(n),r}function q8t(r){var t=r.chart,e=r.options,i=e.interactions,n=i===void 0?[]:i,a=[].concat(n,e.nodeInteractions||[]),o=[].concat(n,e.edgeInteractions||[]),s=zt(t,Ly),l=zt(t,Oy);return a.forEach(function(u){(u==null?void 0:u.enable)===!1?s.removeInteraction(u.type):s.interaction(u.type,u.cfg||{})}),o.forEach(function(u){(u==null?void 0:u.enable)===!1?l.removeInteraction(u.type):l.interaction(u.type,u.cfg||{})}),r}function K8t(r){return bt(X8t,Y8t,q8t,Z8t,j8t,ae)(r)}var Q8t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isDragging=!1,e}return t.prototype.isNodeElement=function(){var e=L(this.context,"event.target");if(e){var i=e.get("element");return i&&i.getModel().data.isNode}return!1},t.prototype.getNodeView=function(){return zt(this.context.view,Ly)},t.prototype.getEdgeView=function(){return zt(this.context.view,Oy)},t.prototype.getCurrentDatumIdx=function(e){return this.getNodeView().geometries[0].elements.indexOf(e)},t.prototype.start=function(){if(this.isNodeElement()){this.prevPoint={x:L(this.context,"event.x"),y:L(this.context,"event.y")};var e=this.context.event.target.get("element"),i=this.getCurrentDatumIdx(e);if(i===-1)return;this.currentElementIdx=i,this.context.isDragging=!0,this.isDragging=!0,this.prevNodeAnimateCfg=this.getNodeView().getOptions().animate,this.prevEdgeAnimateCfg=this.getEdgeView().getOptions().animate,this.getNodeView().animate(!1),this.getEdgeView().animate(!1)}},t.prototype.translate=function(){if(this.isDragging){var e=this.context.view,i={x:L(this.context,"event.x"),y:L(this.context,"event.y")},n=i.x-this.prevPoint.x,a=i.y-this.prevPoint.y,o=this.getNodeView(),s=o.geometries[0].elements[this.currentElementIdx];if(s&&s.getModel()){var l=s.getModel().data,u=o.getOptions().data,c=o.getCoordinate(),h={x:n/c.getWidth(),y:a/c.getHeight()},f=S(S({},l),{x:l.x.map(function(m){return m+=h.x}),y:l.y.map(function(m){return m+=h.y})}),d=_t([],u,!0);d[this.currentElementIdx]=f,o.data(d);var v=l.name,p=this.getEdgeView(),g=p.getOptions().data;g.forEach(function(m){m.source===v&&(m.x[0]+=h.x,m.x[1]+=h.x,m.y[0]+=h.y,m.y[1]+=h.y),m.target===v&&(m.x[2]+=h.x,m.x[3]+=h.x,m.y[2]+=h.y,m.y[3]+=h.y)}),p.data(g),this.prevPoint=i,e.render(!0)}}},t.prototype.end=function(){this.isDragging=!1,this.context.isDragging=!1,this.prevPoint=null,this.currentElementIdx=null,this.getNodeView().animate(this.prevNodeAnimateCfg),this.getEdgeView().animate(this.prevEdgeAnimateCfg)},t}(Fe);xt("sankey-node-drag",Q8t);Ot("sankey-node-draggable",{showEnable:[{trigger:"polygon:mouseenter",action:"cursor:pointer"},{trigger:"polygon:mouseleave",action:"cursor:default"}],start:[{trigger:"polygon:mousedown",action:"sankey-node-drag:start"}],processing:[{trigger:"plot:mousemove",action:"sankey-node-drag:translate"},{isEnable:function(r){return r.isDragging},trigger:"plot:mousemove",action:"cursor:move"}],end:[{trigger:"plot:mouseup",action:"sankey-node-drag:end"}]});var J8t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="sankey",e}return t.getDefaultOptions=function(){return{appendPadding:8,syncViewPadding:!0,nodeStyle:{opacity:1,fillOpacity:1,lineWidth:1},edgeStyle:{opacity:.3,lineWidth:0},edgeState:{active:{style:{opacity:.8,lineWidth:0}}},label:{formatter:function(e){var i=e.name;return i},callback:function(e){var i=e[1]===1;return{style:{fill:"#545454",textAlign:i?"end":"start"},offsetX:i?-8:8}},layout:[{type:"hide-overlap"}]},tooltip:{showTitle:!1,showMarkers:!1,shared:!1,showContent:function(e){return!L(e,[0,"data","isNode"])},formatter:function(e){var i=e.source,n=e.target,a=e.value;return{name:i+" -> "+n,value:a}}},nodeWidthRatio:.008,nodePaddingRatio:.01,animation:{appear:{animation:"wave-in"},enter:{animation:"wave-in"}}}},t.prototype.changeData=function(e){this.updateOption({data:e});var i=q9(this.options,this.chart.width,this.chart.height),n=i.nodes,a=i.edges,o=zt(this.chart,Ly),s=zt(this.chart,Oy);o.changeData(n),s.changeData(a)},t.prototype.getSchemaAdaptor=function(){return K8t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(Ft);const Gzt=Object.freeze(Object.defineProperty({__proto__:null,Sankey:J8t},Symbol.toStringTag,{value:"Module"}));var ob="ancestor-node",K9="value",Bd="path",tkt=[Bd,H9,eb,$9,"name","depth","height"],ekt=$({},Ft.getDefaultOptions(),{innerRadius:0,radius:.85,hierarchyConfig:{field:"value"},tooltip:{shared:!0,showMarkers:!1,offset:20,showTitle:!1},legend:!1,sunburstStyle:{lineWidth:.5,stroke:"#FFF"},drilldown:{enabled:!0}}),rkt={field:"value",size:[1,1],round:!1,padding:0,sort:function(r,t){return t.value-r.value},as:["x","y"],ignoreParentValue:!0};function ikt(r,t){t=ye({},rkt,t);var e=t.as;if(!Z(e)||e.length!==2)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');var i;try{i=rb(t)}catch(l){console.warn(l)}var n=function(l){return YH().size(t.size).round(t.round).padding(t.padding)(ZC(l).sum(function(u){return Tr(u.children)?t.ignoreParentValue?0:u[i]-oi(u.children,function(c,h){return c+h[i]},0):u[i]}).sort(t.sort))},a=n(r),o=e[0],s=e[1];return a.each(function(l){var u,c;l[o]=[l.x0,l.x1,l.x1,l.x0],l[s]=[l.y1,l.y1,l.y0,l.y0],l.name=l.name||((u=l.data)===null||u===void 0?void 0:u.name)||((c=l.data)===null||c===void 0?void 0:c.label),l.data.name=l.name,["x0","x1","y0","y1"].forEach(function(h){e.indexOf(h)===-1&&delete l[h]})}),ib(a)}var nkt={field:"value",tile:"treemapSquarify",size:[1,1],round:!1,ignoreParentValue:!0,padding:0,paddingInner:0,paddingOuter:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,as:["x","y"],sort:function(r,t){return t.value-r.value},ratio:.5*(1+Math.sqrt(5))};function akt(r,t){return r==="treemapSquarify"?Eb[r].ratio(t):Eb[r]}function Q9(r,t){t=ye({},nkt,t);var e=t.as;if(!Z(e)||e.length!==2)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');var i;try{i=rb(t)}catch(u){console.warn(u)}var n=akt(t.tile,t.ratio),a=function(u){return jH().tile(n).size(t.size).round(t.round).padding(t.padding).paddingInner(t.paddingInner).paddingOuter(t.paddingOuter).paddingTop(t.paddingTop).paddingRight(t.paddingRight).paddingBottom(t.paddingBottom).paddingLeft(t.paddingLeft)(ZC(u).sum(function(c){return t.ignoreParentValue&&c.children?0:c[i]}).sort(t.sort))},o=a(r),s=e[0],l=e[1];return o.each(function(u){u[s]=[u.x0,u.x1,u.x1,u.x0],u[l]=[u.y1,u.y1,u.y0,u.y0],["x0","x1","y0","y1"].forEach(function(c){e.indexOf(c)===-1&&delete u[c]})}),ib(o)}function J9(r){var t=r.data,e=r.colorField,i=r.rawFields,n=r.hierarchyConfig,a=n===void 0?{}:n,o=a.activeDepth,s={partition:ikt,treemap:Q9},l=r.seriesField,u=r.type||"partition",c=s[u](t,S(S({field:l||"value"},Q0(a,["activeDepth"])),{type:"hierarchy.".concat(u),as:["x","y"]})),h=[];return c.forEach(function(f){var d,v,p,g,m,y;if(f.depth===0||o>0&&f.depth>o)return null;for(var _=f.data.name,x=S({},f);x.depth>1;)_="".concat((v=x.parent.data)===null||v===void 0?void 0:v.name," / ").concat(_),x=x.parent;var C=S(S(S({},ge(f.data,_t(_t([],i||[],!0),[a.field],!1))),(d={},d[Bd]=_,d[ob]=x.data.name,d)),f);l&&(C[l]=f.data[l]||((g=(p=f.parent)===null||p===void 0?void 0:p.data)===null||g===void 0?void 0:g[l])),e&&(C[e]=f.data[e]||((y=(m=f.parent)===null||m===void 0?void 0:m.data)===null||y===void 0?void 0:y[e])),C.ext=a,C[Fd]={hierarchyConfig:a,colorField:e,rawFields:i},h.push(C)}),h}function okt(r){var t=r.chart,e=r.options,i=e.color,n=e.colorField,a=n===void 0?ob:n,o=e.sunburstStyle,s=e.rawFields,l=s===void 0?[]:s,u=e.shape,c=J9(e);t.data(c);var h;return o&&(h=function(f){return $({},{fillOpacity:Math.pow(.85,f.depth)},ut(o)?o(f):o)}),wy($({},r,{options:{xField:"x",yField:"y",seriesField:a,rawFields:Gl(_t(_t([],tkt,!0),l,!0)),polygon:{color:i,style:h,shape:u}}})),r}function skt(r){var t=r.chart;return t.axis(!1),r}function lkt(r){var t=r.chart,e=r.options,i=e.label,n=qr(t,"polygon");if(!i)n.label(!1);else{var a=i.fields,o=a===void 0?["name"]:a,s=i.callback,l=Ut(i,["fields","callback"]);n.label({fields:o,callback:s,cfg:Mr(l)})}return r}function ukt(r){var t=r.chart,e=r.options,i=e.innerRadius,n=e.radius,a=e.reflect,o=t.coordinate({type:"polar",cfg:{innerRadius:i,radius:n}});return a&&o.reflect(a),r}function ckt(r){var t,e=r.options,i=e.hierarchyConfig,n=e.meta;return bt(Je({},(t={},t[K9]=L(n,L(i,["field"],"value")),t)))(r)}function hkt(r){var t=r.chart,e=r.options,i=e.tooltip;if(i===!1)t.tooltip(!1);else{var n=i;L(i,"fields")||(n=$({},{customItems:function(a){return a.map(function(o){var s=L(t.getOptions(),"scales"),l=L(s,[Bd,"formatter"],function(c){return c}),u=L(s,[K9,"formatter"],function(c){return c});return S(S({},o),{name:l(o.data[Bd]),value:u(o.data.value)})})}},n)),t.tooltip(n)}return r}function fkt(r){var t=r.drilldown,e=r.interactions,i=e===void 0?[]:e;return t!=null&&t.enabled?$({},r,{interactions:_t(_t([],i,!0),[{type:"drill-down",cfg:{drillDownConfig:t,transformData:J9}}],!1)}):r}function dkt(r){var t=r.chart,e=r.options,i=e.drilldown;return Ue({chart:t,options:fkt(e)}),i!=null&&i.enabled&&(t.appendPadding=Ey(t.appendPadding,L(i,["breadCrumb","position"]))),r}function vkt(r){return bt(ae,Sn("sunburstStyle"),okt,skt,ckt,gh,ukt,hkt,lkt,dkt,xe,$e())(r)}(function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="sunburst",e}return t.getDefaultOptions=function(){return ekt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return vkt},t.SUNBURST_ANCESTOR_FIELD=ob,t.SUNBURST_PATH_FIELD=Bd,t.NODE_ANCESTORS_FIELD=eb,t})(Ft);function tz(r,t){if(Z(r))return r.find(function(e){return e.type===t})}function ez(r,t){var e=tz(r,t);return e&&e.enable!==!1}function sb(r){var t=r.interactions,e=r.drilldown;return L(e,"enabled")||ez(t,"treemap-drill-down")}function pkt(r){var t=r.interactions["drill-down"];if(t){var e=t.context.actions.find(function(i){return i.name==="drill-down-action"});e.reset()}}function lb(r){var t=r.data,e=r.colorField,i=r.enableDrillDown,n=r.hierarchyConfig,a=Q9(t,S(S({},n),{type:"hierarchy.treemap",field:"value",as:["x","y"]})),o=[];return a.forEach(function(s){if(s.depth===0||i&&s.depth!==1||!i&&s.children)return null;var l=s.ancestors().map(function(f){return{data:f.data,height:f.height,value:f.value}}),u=i&&Z(t.path)?l.concat(t.path.slice(1)):l,c=Object.assign({},s.data,S({x:s.x,y:s.y,depth:s.depth,value:s.value,path:u},s));if(!s.data[e]&&s.parent){var h=s.ancestors().find(function(f){return f.data[e]});c[e]=h==null?void 0:h.data[e]}else c[e]=s.data[e];c[Fd]={hierarchyConfig:n,colorField:e,enableDrillDown:i},o.push(c)}),o}function gkt(r){var t=r.options,e=t.colorField;return $({options:{rawFields:["value"],tooltip:{fields:["name","value",e,"path"],formatter:function(i){return{name:i.name,value:i.value}}}}},r)}function mkt(r){var t=r.chart,e=r.options,i=e.color,n=e.colorField,a=e.rectStyle,o=e.hierarchyConfig,s=e.rawFields,l=lb({data:e.data,colorField:e.colorField,enableDrillDown:sb(e),hierarchyConfig:o});return t.data(l),wy($({},r,{options:{xField:"x",yField:"y",seriesField:n,rawFields:s,polygon:{color:i,style:a}}})),t.coordinate().reflect("y"),r}function ykt(r){var t=r.chart;return t.axis(!1),r}function _kt(r){var t=r.drilldown,e=r.interactions,i=e===void 0?[]:e,n=sb(r);return n?$({},r,{interactions:_t(_t([],i,!0),[{type:"drill-down",cfg:{drillDownConfig:t,transformData:lb}}],!1)}):r}function xkt(r){var t=r.chart,e=r.options,i=e.interactions,n=e.drilldown;Ue({chart:t,options:_kt(e)});var a=tz(i,"view-zoom");a&&(a.enable!==!1?t.getCanvas().on("mousewheel",function(s){s.preventDefault()}):t.getCanvas().off("mousewheel"));var o=sb(e);return o&&(t.appendPadding=Ey(t.appendPadding,L(n,["breadCrumb","position"]))),r}function Ckt(r){return bt(gkt,ae,Sn("rectStyle"),mkt,ykt,gh,yr,xkt,xe,$e())(r)}var Ekt={colorField:"name",rectStyle:{lineWidth:1,stroke:"#fff"},hierarchyConfig:{tile:"treemapSquarify"},label:{fields:["name"],layout:{type:"limit-in-shape"}},tooltip:{showMarkers:!1,showTitle:!1},drilldown:{enabled:!1,breadCrumb:{position:"bottom-left",rootText:"初始",dividerText:"/",textStyle:{fontSize:12,fill:"rgba(0, 0, 0, 0.65)",cursor:"pointer"},activeTextStyle:{fill:"#87B5FF"}}}},Skt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="treemap",e}return t.getDefaultOptions=function(){return Ekt},t.prototype.changeData=function(e){var i=this.options,n=i.colorField,a=i.interactions,o=i.hierarchyConfig;this.updateOption({data:e});var s=lb({data:e,colorField:n,enableDrillDown:ez(a,"treemap-drill-down"),hierarchyConfig:o});this.chart.changeData(s),pkt(this.chart)},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Ckt},t}(Ft);const Xzt=Object.freeze(Object.defineProperty({__proto__:null,Treemap:Skt},Symbol.toStringTag,{value:"Module"}));var Do="id",VC="path",Akt={appendPadding:[10,0,20,0],blendMode:"multiply",tooltip:{showTitle:!1,showMarkers:!1,fields:["id","size"],formatter:function(r){return{name:r.id,value:r.size}}},legend:{position:"top-left"},label:{style:{textAlign:"center",fill:"#fff"}},interactions:[{type:"legend-filter",enable:!1}],state:{active:{style:{stroke:"#000"}},selected:{style:{stroke:"#000",lineWidth:2}},inactive:{style:{fillOpacity:.3,strokeOpacity:.3}}},defaultInteractions:["tooltip","venn-legend-active"]};function Py(r){if(r){var t=r.geometries[0].elements;t.forEach(function(e){e.shape.toFront()})}}var Tkt=dy("element-active"),bkt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.syncElementsPos=function(){Py(this.context.view)},t.prototype.active=function(){r.prototype.active.call(this),this.syncElementsPos()},t.prototype.toggle=function(){r.prototype.toggle.call(this),this.syncElementsPos()},t.prototype.reset=function(){r.prototype.reset.call(this),this.syncElementsPos()},t}(Tkt),wkt=dy("element-highlight"),Rkt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.syncElementsPos=function(){Py(this.context.view)},t.prototype.highlight=function(){r.prototype.highlight.call(this),this.syncElementsPos()},t.prototype.toggle=function(){r.prototype.toggle.call(this),this.syncElementsPos()},t.prototype.clear=function(){r.prototype.clear.call(this),this.syncElementsPos()},t.prototype.reset=function(){r.prototype.reset.call(this),this.syncElementsPos()},t}(wkt),Mkt=dy("element-selected"),Ikt=dy("element-single-selected"),Lkt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.syncElementsPos=function(){Py(this.context.view)},t.prototype.selected=function(){r.prototype.selected.call(this),this.syncElementsPos()},t.prototype.toggle=function(){r.prototype.toggle.call(this),this.syncElementsPos()},t.prototype.reset=function(){r.prototype.reset.call(this),this.syncElementsPos()},t}(Mkt),Okt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.syncElementsPos=function(){Py(this.context.view)},t.prototype.selected=function(){r.prototype.selected.call(this),this.syncElementsPos()},t.prototype.toggle=function(){r.prototype.toggle.call(this),this.syncElementsPos()},t.prototype.reset=function(){r.prototype.reset.call(this),this.syncElementsPos()},t}(Ikt);xt("venn-element-active",bkt);xt("venn-element-highlight",Rkt);xt("venn-element-selected",Lkt);xt("venn-element-single-selected",Okt);Ot("venn-element-active",{start:[{trigger:"element:mouseenter",action:"venn-element-active:active"}],end:[{trigger:"element:mouseleave",action:"venn-element-active:reset"}]});Ot("venn-element-highlight",{start:[{trigger:"element:mouseenter",action:"venn-element-highlight:highlight"}],end:[{trigger:"element:mouseleave",action:"venn-element-highlight:reset"}]});Ot("venn-element-selected",{start:[{trigger:"element:click",action:"venn-element-selected:toggle"}],rollback:[{trigger:"dblclick",action:["venn-element-selected:reset"]}]});Ot("venn-element-single-selected",{start:[{trigger:"element:click",action:"venn-element-single-selected:toggle"}],rollback:[{trigger:"dblclick",action:["venn-element-single-selected:reset"]}]});Ot("venn-legend-active",{start:[{trigger:"legend-item:mouseenter",action:["list-active:active","venn-element-active:active"]}],end:[{trigger:"legend-item:mouseleave",action:["list-active:reset","venn-element-active:reset"]}]});Ot("venn-legend-highlight",{start:[{trigger:"legend-item:mouseenter",action:["legend-item-highlight:highlight","venn-element-highlight:highlight"]}],end:[{trigger:"legend-item:mouseleave",action:["legend-item-highlight:reset","venn-element-highlight:reset"]}]});var Pkt=function(r){B(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getLabelPoint=function(e,i,n){var a=e.data,o=a.x,s=a.y,l=e.customLabelInfo,u=l.offsetX,c=l.offsetY;return{content:e.content[n],x:o+u,y:s+c}},t}(yy);vv("venn",Pkt);var Df=`	
\v\f\r   ᠎             　\u2028\u2029`,Fkt=new RegExp("([a-z])["+Df+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+Df+"]*,?["+Df+"]*)+)","ig"),Bkt=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+Df+"]*,?["+Df+"]*","ig");function Dkt(r){if(!r)return null;if(RH(r))return r;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(r).replace(Fkt,function(i,n,a){var o=[],s=n.toLowerCase();if(a.replace(Bkt,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(e.push([n].concat(o.splice(0,2))),s="l",n=n==="m"?"l":"L"),s==="o"&&o.length===1&&e.push([n,o[0]]),s==="r")e.push([n].concat(o));else for(;o.length>=t[s]&&(e.push([n].concat(o.splice(0,t[s]))),!!t[s]););return""}),e}function Nkt(r){return $({},r.defaultStyle,{fill:r.color},r.style)}he("schema","venn",{draw:function(r,t){var e=r.data,i=Dkt(e[VC]),n=Nkt(r),a=t.addGroup({name:"venn-shape"});a.addShape("path",{attrs:S(S({},n),{path:i}),name:"venn-path"});var o=r.customInfo,s=o.offsetX,l=o.offsetY,u=Zi.transform(null,[["t",s,l]]);return a.setMatrix(u),a},getMarker:function(r){var t=r.color;return{symbol:"circle",style:{lineWidth:0,stroke:t,fill:t,r:4}}}});var kkt=function(r){return function(t,e){var i=[];return i[0]=r(t[0],e[0]),i[1]=r(t[1],e[1]),i[2]=r(t[2],e[2]),i}},EP={normal:function(r){return r},multiply:function(r,t){return r*t/255},screen:function(r,t){return 255*(1-(1-r/255)*(1-t/255))},overlay:function(r,t){return t<128?2*r*t/255:255*(1-2*(1-r/255)*(1-t/255))},darken:function(r,t){return r>t?t:r},lighten:function(r,t){return r>t?r:t},dodge:function(r,t){return r===255?255:(r=255*(t/255)/(1-r/255),r>255?255:r)},burn:function(r,t){return t===255?255:r===0?0:255*(1-Math.min(1,(1-t/255)/(r/255)))}},Ukt=function(r){if(!EP[r])throw new Error("unknown blend mode "+r);return EP[r]};function zkt(r,t,e){e===void 0&&(e="normal");var i=kkt(Ukt(e))(zp(r),zp(t)),n=zp(r),a=n[0],o=n[1],s=n[2],l=n[3],u=zp(t),c=u[0],h=u[1],f=u[2],d=u[3],v=Number((l+d*(1-l)).toFixed(2)),p=Math.round((l*(1-d)*(a/255)+l*d*(i[0]/255)+(1-l)*d*(c/255))/v*255),g=Math.round((l*(1-d)*(o/255)+l*d*(i[1]/255)+(1-l)*d*(h/255))/v*255),m=Math.round((l*(1-d)*(s/255)+l*d*(i[2]/255)+(1-l)*d*(f/255))/v*255);return"rgba(".concat(p,", ").concat(g,", ").concat(m,", ").concat(v,")")}function zp(r){var t=r.replace("/s+/g",""),e;return typeof t=="string"&&!t.startsWith("rgba")&&!t.startsWith("#")?e=Ts.rgb2arr(Ts.toRGB(t)).concat([1]):(t.startsWith("rgba")&&(e=t.replace("rgba(","").replace(")","").split(",")),t.startsWith("#")&&(e=Ts.rgb2arr(t).concat([1])),e.map(function(i,n){return n===3?Number(i):i|0}))}var rz=1e-10;function ub(r,t){var e=$kt(r),i=e.filter(function(T){return Hkt(T,r)}),n=0,a=0,o,s=[];if(i.length>1){var l=az(i);for(o=0;o<i.length;++o){var u=i[o];u.angle=Math.atan2(u.x-l.x,u.y-l.y)}i.sort(function(T,w){return w.angle-T.angle});var c=i[i.length-1];for(o=0;o<i.length;++o){var h=i[o];a+=(c.x+h.x)*(h.y-c.y);for(var f={x:(h.x+c.x)/2,y:(h.y+c.y)/2},d=null,v=0;v<h.parentIndex.length;++v)if(c.parentIndex.indexOf(h.parentIndex[v])>-1){var p=r[h.parentIndex[v]],g=Math.atan2(h.x-p.x,h.y-p.y),m=Math.atan2(c.x-p.x,c.y-p.y),y=m-g;y<0&&(y+=2*Math.PI);var _=m-y/2,x=_a(f,{x:p.x+p.radius*Math.sin(_),y:p.y+p.radius*Math.cos(_)});x>p.radius*2&&(x=p.radius*2),(d===null||d.width>x)&&(d={circle:p,width:x,p1:h,p2:c})}d!==null&&(s.push(d),n+=GC(d.circle.radius,d.width),c=h)}}else{var C=r[0];for(o=1;o<r.length;++o)r[o].radius<C.radius&&(C=r[o]);var A=!1;for(o=0;o<r.length;++o)if(_a(r[o],C)>Math.abs(C.radius-r[o].radius)){A=!0;break}A?n=a=0:(n=C.radius*C.radius*Math.PI,s.push({circle:C,p1:{x:C.x,y:C.y+C.radius},p2:{x:C.x-rz,y:C.y+C.radius},width:C.radius*2}))}return a/=2,t&&(t.area=n+a,t.arcArea=n,t.polygonArea=a,t.arcs=s,t.innerPoints=i,t.intersectionPoints=e),n+a}function Hkt(r,t){for(var e=0;e<t.length;++e)if(_a(r,t[e])>t[e].radius+rz)return!1;return!0}function $kt(r){for(var t=[],e=0;e<r.length;++e)for(var i=e+1;i<r.length;++i)for(var n=nz(r[e],r[i]),a=0;a<n.length;++a){var o=n[a];o.parentIndex=[e,i],t.push(o)}return t}function GC(r,t){return r*r*Math.acos(1-t/r)-(r-t)*Math.sqrt(t*(2*r-t))}function _a(r,t){return Math.sqrt((r.x-t.x)*(r.x-t.x)+(r.y-t.y)*(r.y-t.y))}function iz(r,t,e){if(e>=r+t)return 0;if(e<=Math.abs(r-t))return Math.PI*Math.min(r,t)*Math.min(r,t);var i=r-(e*e-t*t+r*r)/(2*e),n=t-(e*e-r*r+t*t)/(2*e);return GC(r,i)+GC(t,n)}function nz(r,t){var e=_a(r,t),i=r.radius,n=t.radius;if(e>=i+n||e<=Math.abs(i-n))return[];var a=(i*i-n*n+e*e)/(2*e),o=Math.sqrt(i*i-a*a),s=r.x+a*(t.x-r.x)/e,l=r.y+a*(t.y-r.y)/e,u=-(t.y-r.y)*(o/e),c=-(t.x-r.x)*(o/e);return[{x:s+u,y:l-c},{x:s-u,y:l+c}]}function az(r){for(var t={x:0,y:0},e=0;e<r.length;++e)t.x+=r[e].x,t.y+=r[e].y;return t.x/=r.length,t.y/=r.length,t}function n1(r,t,e){var i=t[0].radius-_a(t[0],r),n,a;for(n=1;n<t.length;++n)a=t[n].radius-_a(t[n],r),a<=i&&(i=a);for(n=0;n<e.length;++n)a=_a(e[n],r)-e[n].radius,a<=i&&(i=a);return i}function oz(r,t){var e=[],i;for(i=0;i<r.length;++i){var n=r[i];e.push({x:n.x,y:n.y}),e.push({x:n.x+n.radius/2,y:n.y}),e.push({x:n.x-n.radius/2,y:n.y}),e.push({x:n.x,y:n.y+n.radius/2}),e.push({x:n.x,y:n.y-n.radius/2})}var a=e[0],o=n1(e[0],r,t);for(i=1;i<e.length;++i){var s=n1(e[i],r,t);s>=o&&(a=e[i],o=s)}var l=LP(function(f){return-1*n1({x:f[0],y:f[1]},r,t)},[a.x,a.y],{maxIterations:500,minErrorDelta:1e-10}).x,u={x:l[0],y:l[1]},c=!0;for(i=0;i<r.length;++i)if(_a(u,r[i])>r[i].radius){c=!1;break}for(i=0;i<t.length;++i)if(_a(u,t[i])<t[i].radius){c=!1;break}if(!c)if(r.length==1)u={x:r[0].x,y:r[0].y};else{var h={};ub(r,h),h.arcs.length===0?u={x:0,y:-1e3,disjoint:!0}:h.arcs.length==1?u={x:h.arcs[0].circle.x,y:h.arcs[0].circle.y}:t.length?u=oz(r,[]):u=az(h.arcs.map(function(f){return f.p1}))}return u}function Wkt(r){var t={},e=[];for(var i in r)e.push(i),t[i]=[];for(var n=0;n<e.length;n++)for(var a=r[e[n]],o=n+1;o<e.length;++o){var s=r[e[o]],l=_a(a,s);l+s.radius<=a.radius+1e-10?t[e[o]].push(e[n]):l+a.radius<=s.radius+1e-10&&t[e[n]].push(e[o])}return t}function Vkt(r,t){for(var e={},i=Wkt(r),n=0;n<t.length;++n){for(var a=t[n].sets,o={},s={},l=0;l<a.length;++l){o[a[l]]=!0;for(var u=i[a[l]],c=0;c<u.length;++c)s[u[c]]=!0}var h=[],f=[];for(var d in r)d in o?h.push(r[d]):d in s||f.push(r[d]);var v=oz(h,f);e[a]=v,v.disjoint&&t[n].size>0&&console.log("WARNING: area "+a+" not represented on screen")}return e}function Gkt(r,t,e){var i=[],n=r-e,a=t;return i.push("M",n,a),i.push("A",e,e,0,1,0,n+2*e,a),i.push("A",e,e,0,1,0,n,a),i.join(" ")}function Xkt(r){var t={};ub(r,t);var e=t.arcs;if(e.length===0)return"M 0 0";if(e.length==1){var i=e[0].circle;return Gkt(i.x,i.y,i.radius)}else{for(var n=[`
M`,e[0].p2.x,e[0].p2.y],a=0;a<e.length;++a){var o=e[a],s=o.circle.radius,l=o.width>s;n.push(`
A`,s,s,0,l?1:0,1,o.p1.x,o.p1.y)}return n.join(" ")}}function Ykt(r,t){t=t||{},t.maxIterations=t.maxIterations||500;var e=t.initialLayout||Kkt,i=t.lossFunction||cb;r=jkt(r);var n=e(r,t),a=[],o=[],s;for(s in n)n.hasOwnProperty(s)&&(a.push(n[s].x),a.push(n[s].y),o.push(s));for(var l=LP(function(h){for(var f={},d=0;d<o.length;++d){var v=o[d];f[v]={x:h[2*d],y:h[2*d+1],radius:n[v].radius}}return i(f,r)},a,t),u=l.x,c=0;c<o.length;++c)s=o[c],n[s].x=u[2*c],n[s].y=u[2*c+1];return n}var sz=1e-10;function XC(r,t,e){return Math.min(r,t)*Math.min(r,t)*Math.PI<=e+sz?Math.abs(r-t):QH(function(i){return iz(r,t,i)-e},0,r+t)}function jkt(r){r=r.slice();var t=[],e={},i,n,a,o;for(i=0;i<r.length;++i){var s=r[i];s.sets.length==1?t.push(s.sets[0]):s.sets.length==2&&(a=s.sets[0],o=s.sets[1],e[[a,o]]=!0,e[[o,a]]=!0)}for(t.sort(function(l,u){return l>u?1:-1}),i=0;i<t.length;++i)for(a=t[i],n=i+1;n<t.length;++n)o=t[n],[a,o]in e||r.push({sets:[a,o],size:0});return r}function Zkt(r,t,e){var i=Ab(t.length,t.length),n=Ab(t.length,t.length);return r.filter(function(a){return a.sets.length==2}).map(function(a){var o=e[a.sets[0]],s=e[a.sets[1]],l=Math.sqrt(t[o].size/Math.PI),u=Math.sqrt(t[s].size/Math.PI),c=XC(l,u,a.size);i[o][s]=i[s][o]=c;var h=0;a.size+1e-10>=Math.min(t[o].size,t[s].size)?h=1:a.size<=1e-10&&(h=-1),n[o][s]=n[s][o]=h}),{distances:i,constraints:n}}function qkt(r,t,e,i){var n=0,a;for(a=0;a<t.length;++a)t[a]=0;for(a=0;a<e.length;++a)for(var o=r[2*a],s=r[2*a+1],l=a+1;l<e.length;++l){var u=r[2*l],c=r[2*l+1],h=e[a][l],f=i[a][l],d=(u-o)*(u-o)+(c-s)*(c-s),v=Math.sqrt(d),p=d-h*h;f>0&&v<=h||f<0&&v>=h||(n+=2*p*p,t[2*a]+=4*p*(o-u),t[2*a+1]+=4*p*(s-c),t[2*l]+=4*p*(u-o),t[2*l+1]+=4*p*(c-s))}return n}function Kkt(r,t){var e=Jkt(r,t),i=t.lossFunction||cb;if(r.length>=8){var n=Qkt(r,t),a=i(n,r),o=i(e,r);a+1e-8<o&&(e=n)}return e}function Qkt(r,t){t=t||{};var e=t.restarts||10,i=[],n={},a;for(a=0;a<r.length;++a){var o=r[a];o.sets.length==1&&(n[o.sets[0]]=i.length,i.push(o))}var s=Zkt(r,i,n),l=s.distances,u=s.constraints,c=Sb(l.map(Sb))/l.length;l=l.map(function(y){return y.map(function(_){return _/c})});var h=function(y,_){return qkt(y,_,l,u)},f,d;for(a=0;a<e;++a){var v=ZH(l.length*2).map(Math.random);d=qH(h,v,t),(!f||d.fx<f.fx)&&(f=d)}var p=f.x,g={};for(a=0;a<i.length;++a){var m=i[a];g[m.sets[0]]={x:p[2*a]*c,y:p[2*a+1]*c,radius:Math.sqrt(m.size/Math.PI)}}if(t.history)for(a=0;a<t.history.length;++a)KH(t.history[a].x,c);return g}function Jkt(r,t){for(var e=t&&t.lossFunction?t.lossFunction:cb,i={},n={},a,o=0;o<r.length;++o){var s=r[o];s.sets.length==1&&(a=s.sets[0],i[a]={x:1e10,y:1e10,rowid:Object.keys(i).length,size:s.size,radius:Math.sqrt(s.size/Math.PI)},n[a]=[])}r=r.filter(function(N){return N.sets.length==2});for(var o=0;o<r.length;++o){var l=r[o],u=l.hasOwnProperty("weight")?l.weight:1,c=l.sets[0],h=l.sets[1];l.size+sz>=Math.min(i[c].size,i[h].size)&&(u=0),n[c].push({set:h,size:l.size,weight:u}),n[h].push({set:c,size:l.size,weight:u})}var f=[];for(a in n)if(n.hasOwnProperty(a)){for(var d=0,o=0;o<n[a].length;++o)d+=n[a][o].size*n[a][o].weight;f.push({set:a,size:d})}function v(N,W){return W.size-N.size}f.sort(v);var p={};function g(N){return N.set in p}function m(N,W){i[W].x=N.x,i[W].y=N.y,p[W]=!0}m({x:0,y:0},f[0].set);for(var o=1;o<f.length;++o){var y=f[o].set,_=n[y].filter(g);if(a=i[y],_.sort(v),_.length===0)throw"ERROR: missing pairwise overlap information";for(var x=[],C=0;C<_.length;++C){var A=i[_[C].set],T=XC(a.radius,A.radius,_[C].size);x.push({x:A.x+T,y:A.y}),x.push({x:A.x-T,y:A.y}),x.push({y:A.y+T,x:A.x}),x.push({y:A.y-T,x:A.x});for(var w=C+1;w<_.length;++w)for(var M=i[_[w].set],O=XC(a.radius,M.radius,_[w].size),P=nz({x:A.x,y:A.y,radius:T},{x:M.x,y:M.y,radius:O}),D=0;D<P.length;++D)x.push(P[D])}for(var z=1e50,Y=x[0],C=0;C<x.length;++C){i[y].x=x[C].x,i[y].y=x[C].y;var H=e(i,r);H<z&&(z=H,Y=x[C])}m(Y,y)}return i}function cb(r,t){var e=0;function i(c){return c.map(function(h){return r[h]})}for(var n=0;n<t.length;++n){var a=t[n],o=void 0;if(a.sets.length!=1){if(a.sets.length==2){var s=r[a.sets[0]],l=r[a.sets[1]];o=iz(s.radius,l.radius,_a(s,l))}else o=ub(i(a.sets));var u=a.hasOwnProperty("weight")?a.weight:1;e+=u*(o-a.size)*(o-a.size)}}return e}function tUt(r){var t=function(e){var i=Math.max.apply(null,r.map(function(a){return a[e]+a.radius})),n=Math.min.apply(null,r.map(function(a){return a[e]-a.radius}));return{max:i,min:n}};return{xRange:t("x"),yRange:t("y")}}function eUt(r,t,e,i){var n=[],a=[];for(var o in r)r.hasOwnProperty(o)&&(a.push(o),n.push(r[o]));t-=2*i,e-=2*i;var s=tUt(n),l=s.xRange,u=s.yRange;if(l.max==l.min||u.max==u.min)return console.log("not scaling solution: zero size detected"),r;for(var c=t/(l.max-l.min),h=e/(u.max-u.min),f=Math.min(h,c),d=(t-(l.max-l.min)*f)/2,v=(e-(u.max-u.min)*f)/2,p={},g=0;g<n.length;++g){var m=n[g];p[a[g]]={radius:f*m.radius,x:i+d+(m.x-l.min)*f,y:i+v+(m.y-u.min)*f}}return p}var rUt=Qc(function(r,t,e,i){var n=new Map,a=r.length;return t.forEach(function(o,s){if(o[i].length===1)n.set(o[Do],r[(s+a)%a]);else{var l=o[i].map(function(u){return n.get(u)});n.set(o[Do],l.slice(1).reduce(function(u,c){return zkt(u,c,e)},l[0]))}}),n},function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return JSON.stringify(r)});function iUt(r,t,e,i){i===void 0&&(i=0);var n=r.data,a=r.setsField,o=r.sizeField;if(n.length===0)return $o(Ta.WARN,!1,"warn: %s","数据不能为空"),[];var s=n.map(function(h){var f;return S(S({},h),(f={sets:h[a]||[],size:h[o]},f[VC]="",f[Do]="",f))});s.sort(function(h,f){return h.sets.length-f.sets.length});var l=Ykt(s),u=eUt(l,t,e,i),c=Vkt(u,s);return s.forEach(function(h){var f=h.sets,d=f.join(",");h[Do]=d;var v=f.map(function(m){return u[m]}),p=Xkt(v);/[zZ]$/.test(p)||(p+=" Z"),h[VC]=p;var g=c[d]||{x:0,y:0};ye(h,g)}),s}function nUt(r,t){for(var e=0;e<t.length;e++)if(!r.includes(t[e]))return!1;return!0}var aUt=40;function lz(r,t,e){var i=r.chart,n=r.options,a=n.blendMode,o=n.setsField,s=i.getTheme(),l=s.colors10,u=s.colors20,c=e;Z(c)||(c=t.filter(function(f){return f[o].length===1}).length<=10?l:u);var h=rUt(c,t,a,o);return function(f){return h.get(f)||c[0]}}function oUt(r,t){var e=r.options,i=e.color;if(typeof i!="function"){var n=typeof i=="string"?[i]:i,a=lz(r,t,n);return function(o){return a(o[Do])}}return i}function sUt(r){var t=r.chart,e=r.options,i=e.legend,n=e.appendPadding,a=e.padding,o=Us(n);return i!==!1&&(o=Ey(n,L(i,"position"),aUt)),t.appendPadding=WT([o,a]),r}function lUt(r){var t=r.options,e=t.data;e||($o(Ta.WARN,!1,"warn: %s","数据不能为空"),e=[]);var i=e.filter(function(a){return a.sets.length===1}).map(function(a){return a.sets[0]}),n=e.filter(function(a){var o=a.sets;return nUt(i,o)});return Jt(n,e)||$o(Ta.WARN,!1,"warn: %s","交集中不能出现不存在的集合, 请输入合法数据"),nt({},r,{options:{data:n}})}function uUt(r){var t=r.chart,e=r.options,i=e.pointStyle,n=e.setsField,a=e.sizeField,o=Us(t.appendPadding),s=o[0],l=o[1],u=o[2],c=o[3],h={offsetX:c,offsetY:s},f=t.viewBBox,d=f.width,v=f.height,p=iUt(e,Math.max(d-(l+c),0),Math.max(v-(s+u),0),0);t.data(p);var g=jT($({},r,{options:{xField:"x",yField:"y",sizeField:a,seriesField:Do,rawFields:[n,a],schema:{shape:"venn",style:i}}})).ext,m=g.geometry;m.customInfo(h);var y=oUt(r,p);return typeof y=="function"&&m.color(Do,function(_){var x=p.find(function(A){return A[Do]===_}),C=lz(r,p)(_);return y(x,C)}),r}function cUt(r){var t=r.chart,e=r.options,i=e.label,n=Us(t.appendPadding),a=n[0],o=n[3],s={offsetX:o,offsetY:a},l=qr(t,"schema");if(!i)l.label(!1);else{var u=i.callback,c=Ut(i,["callback"]);l.label({fields:["id"],callback:u,cfg:nt({},Mr(c),{type:"venn",customLabelInfo:s})})}return r}function hUt(r){var t=r.chart,e=r.options,i=e.legend,n=e.sizeField;return t.legend(Do,i),t.legend(n,!1),r}function fUt(r){var t=r.chart;return t.axis(!1),r}function dUt(r){var t=r.options,e=r.chart,i=t.interactions;if(i){var n={"legend-active":"venn-legend-active","legend-highlight":"venn-legend-highlight"};Ue($({},r,{options:{interactions:i.map(function(a){return S(S({},a),{type:n[a.type]||a.type})})}}))}return e.removeInteraction("legend-active"),e.removeInteraction("legend-highlight"),r}function vUt(r){return bt(sUt,ae,lUt,uUt,cUt,Je({}),hUt,fUt,yr,dUt,xe)(r)}(function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="venn",e}return t.getDefaultOptions=function(){return Akt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return vUt},t.prototype.triggerResize=function(){this.chart.destroyed||(this.chart.forceFit(),this.chart.clear(),this.execAdaptor(),this.chart.render(!0))},t})(Ft);var Fn="x",Rl="violinY",pUt="violinSize",uz="minMax",cz="quantile",hz="median",hb="violin_view",gUt="min_max_view",mUt="quantile_view",yUt="median_view",_Ut=$({},Ft.getDefaultOptions(),{syncViewPadding:!0,kde:{type:"triangular",sampleSize:32,width:3},violinStyle:{lineWidth:1,fillOpacity:.3,strokeOpacity:.75},xAxis:{grid:{line:null},tickLine:{alignTick:!1}},yAxis:{grid:{line:{style:{lineWidth:.5,lineDash:[4,4]}}}},legend:{position:"top-left"},tooltip:{showMarkers:!1}});function SP(r,t){var e=r.length*t;if(r.length===0)throw new Error("quantile requires at least one data point.");if(t<0||t>1)throw new Error("quantiles must be between 0 and 1");return t===1?r[r.length-1]:t===0?r[0]:e%1!==0?r[Math.ceil(e)-1]:r.length%2===0?(r[e-1]+r[e])/2:r[e]}function jh(r,t,e){var i=r[t];r[t]=r[e],r[e]=i}function dg(r,t,e,i){for(e=e||0,i=i||r.length-1;i>e;){if(i-e>600){var n=i-e+1,a=t-e+1,o=Math.log(n),s=.5*Math.exp(2*o/3),l=.5*Math.sqrt(o*s*(n-s)/n);a-n/2<0&&(l*=-1);var u=Math.max(e,Math.floor(t-a*s/n+l)),c=Math.min(i,Math.floor(t+(n-a)*s/n+l));dg(r,t,u,c)}var h=r[t],f=e,d=i;for(jh(r,e,t),r[i]>h&&jh(r,e,i);f<d;){for(jh(r,f,d),f++,d--;r[f]<h;)f++;for(;r[d]>h;)d--}r[e]===h?jh(r,e,d):(d++,jh(r,d,i)),d<=t&&(e=d+1),t<=d&&(i=d-1)}}function Zh(r,t){var e=r.slice();if(Array.isArray(t)){xUt(e,t);for(var i=[],n=0;n<t.length;n++)i[n]=SP(e,t[n]);return i}else{var a=dz(e.length,t);return fz(e,a,0,e.length-1),SP(e,t)}}function fz(r,t,e,i){t%1===0?dg(r,t,e,i):(t=Math.floor(t),dg(r,t,e,i),dg(r,t+1,t+1,i))}function xUt(r,t){for(var e=[0],i=0;i<t.length;i++)e.push(dz(r.length,t[i]));e.push(r.length-1),e.sort(CUt);for(var n=[0,e.length-1];n.length;){var a=Math.ceil(n.pop()),o=Math.floor(n.pop());if(!(a-o<=1)){var s=Math.floor((o+a)/2);fz(r,e[s],Math.floor(e[o]),Math.ceil(e[a])),n.push(o,s,s,a)}}}function CUt(r,t){return r-t}function dz(r,t){var e=r*t;return t===1?r-1:t===0?0:e%1!==0?Math.ceil(e)-1:r%2===0?e-.5:e}var AP=function(r){return{low:Wn(r),high:pn(r),q1:Zh(r,.25),q3:Zh(r,.75),median:Zh(r,[.5]),minMax:[Wn(r),pn(r)],quantile:[Zh(r,.25),Zh(r,.75)]}},TP=function(r,t){var e=JH.create(r,t);return{violinSize:e.map(function(i){return i.y}),violinY:e.map(function(i){return i.x})}},vz=function(r){var t=r.xField,e=r.yField,i=r.seriesField,n=r.data,a=r.kde,o={min:a.min,max:a.max,size:a.sampleSize,width:a.width};if(!i){var s=cn(n,t);return Object.keys(s).map(function(c){var h=s[c],f=h.map(function(d){return d[e]});return S(S({x:c},TP(f,o)),AP(f))})}var l=[],u=cn(n,i);return Object.keys(u).forEach(function(c){var h=cn(u[c],t);return Object.keys(h).forEach(function(f){var d,v=h[f],p=v.map(function(g){return g[e]});l.push(S(S((d={x:f},d[i]=c,d),TP(p,o)),AP(p)))})}),l},vg=["low","high","q1","q3","median"],pg=[{type:"dodge",marginRatio:1/32}];function EUt(r){var t=r.chart,e=r.options;return t.data(vz(e)),r}function SUt(r){var t=r.chart,e=r.options,i=e.seriesField,n=e.color,a=e.shape,o=a===void 0?"violin":a,s=e.violinStyle,l=e.tooltip,u=e.state,c=t.createView({id:hb});return M5t({chart:c,options:{xField:Fn,yField:Rl,seriesField:i||Fn,sizeField:pUt,tooltip:S({fields:vg},l),violin:{style:s,color:n,shape:o},state:u}}),c.geometries[0].adjust(pg),r}function AUt(r){var t=r.chart,e=r.options,i=e.seriesField,n=e.color,a=e.tooltip,o=e.box;if(o===!1)return r;var s=t.createView({id:gUt});Kr({chart:s,options:{xField:Fn,yField:uz,seriesField:i||Fn,tooltip:S({fields:vg},a),state:typeof o=="object"?o.state:{},interval:{color:n,size:1,style:{lineWidth:0}}}}),s.geometries[0].adjust(pg);var l=t.createView({id:mUt});Kr({chart:l,options:{xField:Fn,yField:cz,seriesField:i||Fn,tooltip:S({fields:vg},a),state:typeof o=="object"?o.state:{},interval:{color:n,size:8,style:{fillOpacity:1}}}}),l.geometries[0].adjust(pg);var u=t.createView({id:yUt});return An({chart:u,options:{xField:Fn,yField:hz,seriesField:i||Fn,tooltip:S({fields:vg},a),state:typeof o=="object"?o.state:{},point:{color:n,size:1,style:{fill:"white",lineWidth:0}}}}),u.geometries[0].adjust(pg),l.axis(!1),s.axis(!1),u.axis(!1),u.legend(!1),s.legend(!1),l.legend(!1),r}function TUt(r){var t,e=r.chart,i=r.options,n=i.meta,a=i.xAxis,o=i.yAxis,s={},l=$(s,n,(t={},t[Fn]=S(S({sync:!0},ge(a,zi)),{type:"cat"}),t[Rl]=S({sync:!0},ge(o,zi)),t[uz]=S({sync:Rl},ge(o,zi)),t[cz]=S({sync:Rl},ge(o,zi)),t[hz]=S({sync:Rl},ge(o,zi)),t));return e.scale(l),r}function bUt(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=zt(t,hb);return i===!1?a.axis(Fn,!1):a.axis(Fn,i),n===!1?a.axis(Rl,!1):a.axis(Rl,n),t.axis(!1),r}function wUt(r){var t=r.chart,e=r.options,i=e.legend,n=e.seriesField,a=e.shape;if(i===!1)t.legend(!1);else{var o=n||Fn,s=Q0(i,["selected"]);(!a||!a.startsWith("hollow"))&&(L(s,["marker","style","lineWidth"])||cr(s,["marker","style","lineWidth"],0)),t.legend(o,s),L(i,"selected")&&R(t.views,function(l){return l.legend(o,i)})}return r}function RUt(r){var t=r.chart,e=zt(t,hb);return $e()(S(S({},r),{chart:e})),r}function MUt(r){var t=r.chart,e=r.options,i=e.animation;return R(t.views,function(n){mv(n,i)}),r}function IUt(r){return bt(ae,EUt,SUt,AUt,TUt,yr,bUt,wUt,Ue,RUt,MUt)(r)}(function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="violin",e}return t.getDefaultOptions=function(){return _Ut},t.prototype.changeData=function(e){this.updateOption({data:e}),this.chart.changeData(vz(this.options))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return IUt},t})(Ft);var Un="$$yField$$",Fy="$$diffField$$",fb="$$absoluteField$$",YC="$$isTotal$$",LUt={label:{},leaderLine:{style:{lineWidth:1,stroke:"#8c8c8c",lineDash:[4,2]}},total:{style:{fill:"rgba(0, 0, 0, 0.25)"}},interactions:[{type:"element-active"}],risingFill:"#f4664a",fallingFill:"#30bf78",waterfallStyle:{fill:"rgba(0, 0, 0, 0.25)"},yAxis:{grid:{line:{style:{lineDash:[4,2]}}}}};function OUt(r){for(var t=[],e=0;e<r.length;e++){var i=r[e];if(i){var n=e===0?"M":"L";t.push([n,i.x,i.y])}}var a=r[0];return t.push(["L",a.x,a.y]),t.push(["z"]),t}function PUt(r){return $({},r.defaultStyle,r.style,{fill:r.color})}he("interval","waterfall",{draw:function(r,t){var e=r.customInfo,i=r.points,n=r.nextPoints,a=t.addGroup(),o=this.parsePath(OUt(i)),s=PUt(r);a.addShape("path",{attrs:S(S({},s),{path:o})});var l=L(e,"leaderLine");if(l&&n){var u=[["M",i[2].x,i[2].y],["L",n[0].x,n[0].y]];i[2].y===n[1].y&&(u[1]=["L",n[1].x,n[1].y]),u=this.parsePath(u),a.addShape("path",{attrs:S({path:u},l.style||{})})}return a}});function FUt(r,t,e,i,n){var a,o=[];if(oi(r,function(l,u){var c;$o(Ta.WARN,Mt(u[e]),"".concat(u[e]," is not a valid number"));var h=Wr(u[e])?null:u[e];return o.push(S(S({},u),(c={},c[i]=[l,l+h],c))),l+h},0),o.length&&n){var s=L(o,[[r.length-1],i,[1]]);o.push((a={},a[t]=n.label,a[e]=s,a[i]=[0,s],a))}return o}function pz(r,t,e,i){var n=FUt(r,t,e,Un,i);return n.map(function(a,o){var s;return re(a)?S(S({},a),(s={},s[fb]=a[Un][1],s[Fy]=a[Un][1]-a[Un][0],s[YC]=o===r.length,s)):a})}function BUt(r){var t=r.options,e=t.locale,i=t.total,n=Ty(e).get(["waterfall","total"]);return i&&typeof i.label!="string"&&n&&(r.options.total.label=n),r}function DUt(r){var t=r.chart,e=r.options,i=e.data,n=e.xField,a=e.yField,o=e.total,s=e.leaderLine,l=e.columnWidthRatio,u=e.waterfallStyle,c=e.risingFill,h=e.fallingFill,f=e.color,d=e.shape,v=e.customInfo;t.data(pz(i,n,a,o));var p=f||function(_){return L(_,[YC])?L(o,["style","fill"],""):L(_,[Un,1])-L(_,[Un,0])>0?c:h},g=$({},r,{options:{xField:n,yField:Un,seriesField:n,rawFields:[a,Fy,YC,Un],widthRatio:l,interval:{style:u,shape:d||"waterfall",color:p}}}),m=Kr(g).ext,y=m.geometry;return y.customInfo(S(S({},v),{leaderLine:s})),r}function NUt(r){var t,e,i=r.options,n=i.xAxis,a=i.yAxis,o=i.xField,s=i.yField,l=i.meta,u=$({},{alias:s},L(l,s));return bt(Je((t={},t[o]=n,t[s]=a,t[Un]=a,t),$({},l,(e={},e[Un]=u,e[Fy]=u,e[fb]=u,e))))(r)}function kUt(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return i===!1?t.axis(a,!1):t.axis(a,i),n===!1?(t.axis(o,!1),t.axis(Un,!1)):(t.axis(o,n),t.axis(Un,n)),r}function UUt(r){var t=r.chart,e=r.options,i=e.legend,n=e.total,a=e.risingFill,o=e.fallingFill,s=e.locale,l=Ty(s);if(i===!1)t.legend(!1);else{var u=[{name:l.get(["general","increase"]),value:"increase",marker:{symbol:"square",style:{r:5,fill:a}}},{name:l.get(["general","decrease"]),value:"decrease",marker:{symbol:"square",style:{r:5,fill:o}}}];n&&u.push({name:n.label||"",value:"total",marker:{symbol:"square",style:$({},{r:5},L(n,"style"))}}),t.legend($({},{custom:!0,position:"top",items:u},i)),t.removeInteraction("legend-filter")}return r}function zUt(r){var t=r.chart,e=r.options,i=e.label,n=e.labelMode,a=e.xField,o=qr(t,"interval");if(!i)o.label(!1);else{var s=i.callback,l=Ut(i,["callback"]);o.label({fields:n==="absolute"?[fb,a]:[Fy,a],callback:s,cfg:Mr(l)})}return r}function HUt(r){var t=r.chart,e=r.options,i=e.tooltip,n=e.xField,a=e.yField;if(i!==!1){t.tooltip(S({showCrosshairs:!1,showMarkers:!1,shared:!0,fields:[a]},i));var o=t.geometries[0];i!=null&&i.formatter?o.tooltip("".concat(n,"*").concat(a),i.formatter):o.tooltip(a)}else t.tooltip(!1);return r}function $Ut(r){return bt(BUt,ae,DUt,NUt,kUt,UUt,HUt,zUt,Js,Ue,xe,$e())(r)}var WUt=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="waterfall",e}return t.getDefaultOptions=function(){return LUt},t.prototype.changeData=function(e){var i=this.options,n=i.xField,a=i.yField,o=i.total;this.updateOption({data:e}),this.chart.changeData(pz(e,n,a,o))},t.prototype.getSchemaAdaptor=function(){return $Ut},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(Ft);const Yzt=Object.freeze(Object.defineProperty({__proto__:null,Waterfall:WUt},Symbol.toStringTag,{value:"Module"}));var db="color",VUt=$({},Ft.getDefaultOptions(),{timeInterval:2e3,legend:!1,tooltip:{showTitle:!1,showMarkers:!1,showCrosshairs:!1,fields:["text","value",db],formatter:function(r){return{name:r.text,value:r.value}}},wordStyle:{fontFamily:"Verdana",fontWeight:"normal",padding:1,fontSize:[12,60],rotation:[0,90],rotationSteps:2,rotateRatio:.5}}),GUt={font:function(){return"serif"},padding:1,size:[500,500],spiral:"archimedean",timeInterval:3e3};function XUt(r,t){return t=ye({},GUt,t),YUt(r,t)}function YUt(r,t){var e=o9t();["font","fontSize","fontWeight","padding","rotate","size","spiral","timeInterval","random"].forEach(function(l){j(t[l])||e[l](t[l])}),e.words(r),t.imageMask&&e.createMask(t.imageMask);var i=e.start(),n=i._tags;n.forEach(function(l){l.x+=t.size[0]/2,l.y+=t.size[1]/2});var a=t.size,o=a[0],s=a[1];return n.push({text:"",value:0,x:0,y:0,opacity:0}),n.push({text:"",value:0,x:o,y:s,opacity:0}),n}var a1=Math.PI/180,ff=64,gg=2048;function jUt(r){return r.text}function ZUt(){return"serif"}function bP(){return"normal"}function qUt(r){return r.value}function KUt(){return~~(Math.random()*2)*90}function QUt(){return 1}function JUt(r,t,e,i){if(!t.sprite){var n=r.context,a=r.ratio;n.clearRect(0,0,(ff<<5)/a,gg/a);var o=0,s=0,l=0,u=e.length;for(--i;++i<u;){t=e[i],n.save(),n.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font;var c=n.measureText(t.text+"m").width*a,h=t.size<<1;if(t.rotate){var f=Math.sin(t.rotate*a1),d=Math.cos(t.rotate*a1),v=c*d,p=c*f,g=h*d,m=h*f;c=Math.max(Math.abs(v+m),Math.abs(v-m))+31>>5<<5,h=~~Math.max(Math.abs(p+g),Math.abs(p-g))}else c=c+31>>5<<5;if(h>l&&(l=h),o+c>=ff<<5&&(o=0,s+=l,l=0),s+h>=gg)break;n.translate((o+(c>>1))/a,(s+(h>>1))/a),t.rotate&&n.rotate(t.rotate*a1),n.fillText(t.text,0,0),t.padding&&(n.lineWidth=2*t.padding,n.strokeText(t.text,0,0)),n.restore(),t.width=c,t.height=h,t.xoff=o,t.yoff=s,t.x1=c>>1,t.y1=h>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,o+=c}for(var y=n.getImageData(0,0,(ff<<5)/a,gg/a).data,_=[];--i>=0;)if(t=e[i],!!t.hasText){for(var c=t.width,x=c>>5,h=t.y1-t.y0,C=0;C<h*x;C++)_[C]=0;if(o=t.xoff,o==null)return;s=t.yoff;for(var A=0,T=-1,w=0;w<h;w++){for(var C=0;C<c;C++){var M=x*w+(C>>5),O=y[(s+w)*(ff<<5)+(o+C)<<2]?1<<31-C%32:0;_[M]|=O,A|=O}A?T=w:(t.y0++,h--,w--,s++)}t.y1=t.y0+T,t.sprite=_.slice(0,(t.y1-t.y0)*x)}}}function t9t(r,t,e){e>>=5;for(var i=r.sprite,n=r.width>>5,a=r.x-(n<<4),o=a&127,s=32-o,l=r.y1-r.y0,u=(r.y+r.y0)*e+(a>>5),c,h=0;h<l;h++){c=0;for(var f=0;f<=n;f++)if((c<<s|(f<n?(c=i[h*n+f])>>>o:0))&t[u+f])return!0;u+=e}return!1}function e9t(r,t){var e=r[0],i=r[1];t.x+t.x0<e.x&&(e.x=t.x+t.x0),t.y+t.y0<e.y&&(e.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function r9t(r,t){return r.x+r.x1>t[0].x&&r.x+r.x0<t[1].x&&r.y+r.y1>t[0].y&&r.y+r.y0<t[1].y}function gz(r){var t=r[0]/r[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function i9t(r){var t=4,e=t*r[0]/r[1],i=0,n=0;return function(a){var o=a<0?-1:1;switch(Math.sqrt(1+4*o*a)-o&3){case 0:i+=e;break;case 1:n+=t;break;case 2:i-=e;break;default:n-=t;break}return[i,n]}}function wP(r){for(var t=[],e=-1;++e<r;)t[e]=0;return t}function n9t(){return document.createElement("canvas")}function Da(r){return ut(r)?r:function(){return r}}var a9t={archimedean:gz,rectangular:i9t};function o9t(){var r=[256,256],t=ZUt,e=qUt,i=bP,n=KUt,a=QUt,o=gz,s=Math.random,l=[],u=1/0,c=jUt,h=bP,f=n9t,d={};d.start=function(){var g=r[0],m=r[1],y=v(f()),_=d.board?d.board:wP((r[0]>>5)*r[1]),x=l.length,C=[],A=l.map(function(O,P,D){return O.text=c.call(this,O,P,D),O.font=t.call(this,O,P,D),O.style=h.call(this,O,P,D),O.weight=i.call(this,O,P,D),O.rotate=n.call(this,O,P,D),O.size=~~e.call(this,O,P,D),O.padding=a.call(this,O,P,D),O}).sort(function(O,P){return P.size-O.size}),T=-1,w=d.board?[{x:0,y:0},{x:g,y:m}]:null;M();function M(){for(var O=Date.now();Date.now()-O<u&&++T<x;){var P=A[T];P.x=g*(s()+.5)>>1,P.y=m*(s()+.5)>>1,JUt(y,P,A,T),P.hasText&&p(_,P,w)&&(C.push(P),w?d.hasImage||e9t(w,P):w=[{x:P.x+P.x0,y:P.y+P.y0},{x:P.x+P.x1,y:P.y+P.y1}],P.x-=r[0]>>1,P.y-=r[1]>>1)}d._tags=C,d._bounds=w}return d};function v(g){g.width=g.height=1;var m=Math.sqrt(g.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,1,1).data.length>>2);g.width=(ff<<5)/m,g.height=gg/m;var y=g.getContext("2d",{willReadFrequently:!0});return y.fillStyle=y.strokeStyle="red",y.textAlign="center",{context:y,ratio:m}}function p(g,m,y){for(var _=m.x,x=m.y,C=Math.sqrt(r[0]*r[0]+r[1]*r[1]),A=o(r),T=s()<.5?1:-1,w,M=-T,O,P;(w=A(M+=T))&&(O=~~w[0],P=~~w[1],!(Math.min(Math.abs(O),Math.abs(P))>=C));)if(m.x=_+O,m.y=x+P,!(m.x+m.x0<0||m.y+m.y0<0||m.x+m.x1>r[0]||m.y+m.y1>r[1])&&(!y||!t9t(m,g,r[0]))&&(!y||r9t(m,y))){for(var D=m.sprite,z=m.width>>5,Y=r[0]>>5,H=m.x-(z<<4),N=H&127,W=32-N,Q=m.y1-m.y0,q=void 0,J=(m.y+m.y0)*Y+(H>>5),et=0;et<Q;et++){q=0;for(var ft=0;ft<=z;ft++)g[J+ft]|=q<<W|(ft<z?(q=D[et*z+ft])>>>N:0);J+=Y}return delete m.sprite,!0}return!1}return d.createMask=function(g){var m=document.createElement("canvas"),y=r[0],_=r[1];if(!(!y||!_)){var x=y>>5,C=wP((y>>5)*_);m.width=y,m.height=_;var A=m.getContext("2d");A.drawImage(g,0,0,g.width,g.height,0,0,y,_);for(var T=A.getImageData(0,0,y,_).data,w=0;w<_;w++)for(var M=0;M<y;M++){var O=x*w+(M>>5),P=w*y+M<<2,D=T[P]>=250&&T[P+1]>=250&&T[P+2]>=250,z=D?1<<31-M%32:0;C[O]|=z}d.board=C,d.hasImage=!0}},d.timeInterval=function(g){u=g??1/0},d.words=function(g){l=g},d.size=function(g){r=[+g[0],+g[1]]},d.font=function(g){t=Da(g)},d.fontWeight=function(g){i=Da(g)},d.rotate=function(g){n=Da(g)},d.spiral=function(g){o=a9t[g]||g},d.fontSize=function(g){e=Da(g)},d.padding=function(g){a=Da(g)},d.random=function(g){s=Da(g)},d}function mz(r){var t=r.options,e=r.chart,i=e,n=i.width,a=i.height,o=i.padding,s=i.appendPadding,l=i.ele,u=t.data,c=t.imageMask,h=t.wordField,f=t.weightField,d=t.colorField,v=t.wordStyle,p=t.timeInterval,g=t.random,m=t.spiral,y=t.autoFit,_=y===void 0?!0:y,x=t.placementStrategy;if(!u||!u.length)return[];var C=v.fontFamily,A=v.fontWeight,T=v.padding,w=v.fontSize,M=h9t(u,f),O=[v9t(M),p9t(M)],P=u.map(function(Y){return{text:Y[h],value:Y[f],color:Y[d],datum:Y}}),D={imageMask:c,font:C,fontSize:c9t(w,O),fontWeight:A,size:s9t({width:n,height:a,padding:o,appendPadding:s,autoFit:_,container:l}),padding:T,timeInterval:p,random:g,spiral:m,rotate:f9t(t)};if(ut(x)){var z=P.map(function(Y,H,N){return S(S(S({},Y),{hasText:!!Y.text,font:Da(D.font)(Y,H,N),weight:Da(D.fontWeight)(Y,H,N),rotate:Da(D.rotate)(Y,H,N),size:Da(D.fontSize)(Y,H,N),style:"normal"}),x.call(e,Y,H,N))});return z.push({text:"",value:0,x:0,y:0,opacity:0}),z.push({text:"",value:0,x:D.size[0],y:D.size[1],opacity:0}),z}return XUt(P,D)}function s9t(r){var t=r.width,e=r.height,i=r.container,n=r.autoFit,a=r.padding,o=r.appendPadding;if(n){var s=kC(i);t=s.width,e=s.height}t=t||400,e=e||400;var l=l9t({padding:a,appendPadding:o}),u=l[0],c=l[1],h=l[2],f=l[3],d=[t-(f+c),e-(u+h)];return d}function l9t(r){var t=Us(r.padding),e=Us(r.appendPadding),i=t[0]+e[0],n=t[1]+e[1],a=t[2]+e[2],o=t[3]+e[3];return[i,n,a,o]}function u9t(r){return new Promise(function(t,e){if(r instanceof HTMLImageElement){t(r);return}if(mt(r)){var i=new Image;i.crossOrigin="anonymous",i.src=r,i.onload=function(){t(i)},i.onerror=function(){$o(Ta.ERROR,!1,"image %s load failed !!!",r),e()};return}$o(Ta.WARN,r===void 0,"The type of imageMask option must be String or HTMLImageElement."),e()})}function c9t(r,t){if(ut(r))return r;if(Z(r)){var e=r[0],i=r[1];if(!t)return function(){return(i+e)/2};var n=t[0],a=t[1];return a===n?function(){return(i+e)/2}:function(s){var l=s.value;return(i-e)/(a-n)*(l-n)+e}}return function(){return r}}function h9t(r,t){return r.map(function(e){return e[t]}).filter(function(e){return typeof e=="number"&&!isNaN(e)})}function f9t(r){var t=d9t(r),e=t.rotation,i=t.rotationSteps;if(!Z(e))return e;var n=e[0],a=e[1],o=i===1?0:(a-n)/(i-1);return function(){return a===n?a:Math.floor(Math.random()*i)*o}}function d9t(r){var t=r.wordStyle.rotationSteps;return t<1&&($o(Ta.WARN,!1,"The rotationSteps option must be greater than or equal to 1."),t=1),{rotation:r.wordStyle.rotation,rotationSteps:t}}function v9t(r){return Math.min.apply(Math,r)}function p9t(r){return Math.max.apply(Math,r)}function g9t(r){var t=r.chart,e=r.options,i=e.colorField,n=e.color,a=mz(r);t.data(a);var o=$({},r,{options:{xField:"x",yField:"y",seriesField:i&&db,rawFields:ut(n)&&_t(_t([],L(e,"rawFields",[]),!0),["datum"],!1),point:{color:n,shape:"word-cloud"}}}),s=An(o).ext;return s.geometry.label(!1),t.coordinate().reflect("y"),t.axis(!1),r}function m9t(r){return bt(Je({x:{nice:!1},y:{nice:!1}}))(r)}function y9t(r){var t=r.chart,e=r.options,i=e.legend,n=e.colorField;return i===!1?t.legend(!1):n&&t.legend(db,i),r}function _9t(r){bt(g9t,m9t,yr,y9t,Ue,xe,ae,Js)(r)}he("point","word-cloud",{draw:function(r,t){var e=r.x,i=r.y,n=t.addShape("text",{attrs:S(S({},x9t(r)),{x:e,y:i})}),a=r.data.rotate;return typeof a=="number"&&Zi.rotate(n,a*Math.PI/180),n}});function x9t(r){return{fontSize:r.data.size,text:r.data.text,textAlign:"center",fontFamily:r.data.font,fontWeight:r.data.weight,fill:r.color||r.defaultStyle.stroke,textBaseline:"alphabetic"}}var C9t=function(r){B(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="word-cloud",e}return t.getDefaultOptions=function(){return VUt},t.prototype.changeData=function(e){this.updateOption({data:e}),this.options.imageMask?this.render():this.chart.changeData(mz({chart:this.chart,options:this.options}))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.render=function(){var e=this;return new Promise(function(i){var n=e.options.imageMask;if(!n){r.prototype.render.call(e),i();return}var a=function(o){e.options=S(S({},e.options),{imageMask:o||null}),r.prototype.render.call(e),i()};u9t(n).then(a).catch(a)})},t.prototype.getSchemaAdaptor=function(){return _9t},t.prototype.triggerResize=function(){var e=this;this.chart.destroyed||(this.execAdaptor(),window.setTimeout(function(){r.prototype.triggerResize.call(e)}))},t}(Ft);const jzt=Object.freeze(Object.defineProperty({__proto__:null,WordCloud:C9t},Symbol.toStringTag,{value:"Module"}));(function(r){B(t,r);function t(e,i,n,a){var o=r.call(this,e,$({},a,i))||this;return o.type="g2-plot",o.defaultOptions=a,o.adaptor=n,o}return t.prototype.getDefaultOptions=function(){return this.defaultOptions},t.prototype.getSchemaAdaptor=function(){return this.adaptor},t})(Ft);LU("en-US",b5t);LU("zh-CN",w5t);export{Lzt as $,Al as A,AL as B,e$ as C,nS as D,Ka as E,ra as F,XE as G,lzt as H,Tb as I,Zt as J,wzt as K,QC as L,q2t as M,gC as N,VU as O,Ec as P,Dn as Q,u9 as R,tit as S,um as T,p9 as U,$i as V,azt as W,bzt as X,Mzt as Y,mQ as Z,Izt as _,kd as a,Ozt as a0,Pzt as a1,Fzt as a2,Bzt as a3,Dzt as a4,Nzt as a5,kzt as a6,Uzt as a7,zzt as a8,Hzt as a9,$zt as aa,Wzt as ab,Vzt as ac,Gzt as ad,Xzt as ae,Yzt as af,jzt as ag,yQ as b,Lo as c,th as d,XJ as e,nc as f,Wf as g,gzt as h,VRt as i,WRt as j,_p as k,At as l,vi as m,Ym as n,w7 as o,xu as p,G as q,eu as r,Nd as s,jl as t,In as u,twt as v,Fbt as w,an as x,e0 as y,Rzt as z};
